from typing import Annotated, Optional

from cyclopts import App, Group, Parameter

from .context import AuditHubContext

app = App(
    help="""\
This is the Veridise AuditHub CLI client, that allows access to AuditHub via its REST API. 
When you have Veridise AuditHub credentials, you can use this tool to, 
e.g., create new versions for projects, launch Veridise tools, monitor their progress, and obtain the results.
This tool can be used in CI/CD pipelines to assist in verifying new versions of projects. 
""",
)

app.meta.group_parameters = Group("Global Parameters", sort_key=9)


AuditHubContextType = Annotated[AuditHubContext, Parameter(name="*")]

OrganizationIdType = Annotated[
    int,
    Parameter(
        name=["--organization-id", "-o"],
        env_var="AUDITHUB_ORGANIZATION_ID",
        help="The organization id.",
    ),
]
ProjectIdType = Annotated[
    int,
    Parameter(
        name=["--project-id", "-p"],
        env_var="AUDITHUB_PROJECT_ID",
        help="The project id, inside the selected organization.",
    ),
]
VersionIdType = Annotated[
    int,
    Parameter(
        name=["--version-id", "-v"],
        env_var="AUDITHUB_VERSION_ID",
        help="The version id, inside the selected project.",
    ),
]
TaskIdType = Annotated[
    int,
    Parameter(name=["--task-id", "-t"], env_var="AUDITHUB_TASK_ID", help="The task id"),
]


TaskWaitType = Annotated[
    bool,
    Parameter(
        negative_bool=(),
        help="If specified, this script will monitor the task and wait for it to finish. The exit code will reflect the success or failure of the task, regardless of findings produced by the analysis.",
    ),
]

TaskNameType = Annotated[
    Optional[str],
    Parameter(
        help="An optional task name for this task. If not specified, one will automatically be generated by AuditHub."
    ),
]

BooleanArg = Annotated[bool, Parameter(negative_bool=())]
