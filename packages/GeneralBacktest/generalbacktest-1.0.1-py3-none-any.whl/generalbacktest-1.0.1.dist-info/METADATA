Metadata-Version: 2.4
Name: GeneralBacktest
Version: 1.0.1
Summary: ä¸€ä¸ªçµæ´»é«˜æ•ˆçš„é‡åŒ–ç­–ç•¥å›æµ‹æ¡†æ¶ï¼Œæ”¯æŒå¤šèµ„äº§ç»„åˆã€ä»»æ„è°ƒä»“é¢‘ç‡ã€å‘é‡åŒ–è®¡ç®—å’Œä¸°å¯Œçš„æ€§èƒ½åˆ†æ
Author-email: Elen Young <yang13515360252@163.com>
License: MIT
Project-URL: Homepage, https://github.com/ElenYoung/GeneralBacktest
Project-URL: Bug Reports, https://github.com/ElenYoung/GeneralBacktest/issues
Project-URL: Source, https://github.com/ElenYoung/GeneralBacktest
Project-URL: Documentation, https://github.com/ElenYoung/GeneralBacktest#readme
Keywords: backtest,quantitative,trading,finance,portfolio
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Financial and Insurance Industry
Classifier: Intended Audience :: Science/Research
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Classifier: Topic :: Office/Business :: Financial :: Investment
Classifier: Topic :: Scientific/Engineering
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: numpy>=1.20.0
Requires-Dist: pandas>=1.3.0
Requires-Dist: matplotlib>=3.3.0
Provides-Extra: database
Requires-Dist: quantchdb>=0.1.0; extra == "database"
Provides-Extra: excel
Requires-Dist: openpyxl>=3.0.0; extra == "excel"
Provides-Extra: full
Requires-Dist: quantchdb>=0.1.0; extra == "full"
Requires-Dist: openpyxl>=3.0.0; extra == "full"
Dynamic: license-file

# GeneralBacktest

[![PyPI version](https://badge.fury.io/py/GeneralBacktest.svg)](https://badge.fury.io/py/GeneralBacktest)
[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

**GeneralBacktest** æ˜¯ä¸€ä¸ªçµæ´»é«˜æ•ˆçš„é‡åŒ–ç­–ç•¥å›æµ‹æ¡†æ¶ï¼Œä¸“ä¸ºå¤šèµ„äº§ç»„åˆç­–ç•¥è®¾è®¡ã€‚æ ¸å¿ƒç†å¿µæ˜¯"æƒé‡â†’äº¤æ˜“â†’å‡€å€¼"ï¼Œæ”¯æŒä»»æ„è°ƒä»“é¢‘ç‡ã€çœŸå®äº¤æ˜“ç»†èŠ‚æ¨¡æ‹Ÿã€å‘é‡åŒ–é«˜æ€§èƒ½è®¡ç®—å’Œä¸°å¯Œçš„æ€§èƒ½åˆ†æã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

- ğŸ¯ **çµæ´»çš„è°ƒä»“ç­–ç•¥**ï¼šæ”¯æŒä»»æ„è°ƒä»“é¢‘ç‡å’Œæ—¶é—´ç‚¹ï¼Œæ— éœ€å›ºå®šå‘¨æœŸ
- ğŸš€ **é«˜æ€§èƒ½è®¡ç®—**ï¼šå‘é‡åŒ–å®ç°ï¼Œæ”¯æŒæ•°åƒæ ‡çš„ã€æ•°å¹´æ•°æ®çš„å¿«é€Ÿå›æµ‹
- ğŸ’° **çœŸå®äº¤æ˜“æ¨¡æ‹Ÿ**ï¼š
  - è°ƒä»“é˜ˆå€¼æ§åˆ¶ï¼ˆé¿å…å¾®å°è°ƒæ•´ï¼‰
  - ä¹°å–åˆ†å¼€è®¡è´¹
  - æ»‘ç‚¹æ¨¡æ‹Ÿ
  - è°ƒä»“æ—¥ç›ˆäºæ‹†åˆ†ï¼ˆæŒä»“/å–å‡º/ä¹°å…¥ï¼‰
- ğŸ“Š **ä¸°å¯Œçš„æ€§èƒ½æŒ‡æ ‡**ï¼š15+ å¸¸ç”¨æŒ‡æ ‡
  - æ”¶ç›Šç‡æŒ‡æ ‡ï¼šç´¯è®¡æ”¶ç›Šã€å¹´åŒ–æ”¶ç›Š
  - é£é™©æŒ‡æ ‡ï¼šæ³¢åŠ¨ç‡ã€æœ€å¤§å›æ’¤
  - é£é™©è°ƒæ•´æŒ‡æ ‡ï¼šå¤æ™®æ¯”ç‡ã€ç´¢æè¯ºæ¯”ç‡ã€å¡ç›æ¯”ç‡
  - å°¾éƒ¨é£é™©ï¼šVaRã€CVaR
  - ç›¸å¯¹æŒ‡æ ‡ï¼šä¿¡æ¯æ¯”ç‡ã€è¶…é¢æ”¶ç›Š
  - äº¤æ˜“æŒ‡æ ‡ï¼šæ¢æ‰‹ç‡
- ğŸ“ˆ **ä¸“ä¸šçš„å¯è§†åŒ–**ï¼š8+ å›¾è¡¨ç±»å‹
  - å‡€å€¼æ›²çº¿ä¸å›æ’¤
  - ç­–ç•¥å¯¹æ¯”
  - è¶…é¢æ”¶ç›Šåˆ†æ
  - æœˆåº¦æ”¶ç›Šçƒ­åŠ›å›¾
  - æ¢æ‰‹ç‡åˆ†æ
  - æŒä»“å˜åŒ–
  - ç»¼åˆ Dashboard

## ğŸ“¦ å®‰è£…

### åŸºç¡€å®‰è£…

```bash
pip install GeneralBacktest
```

### å®Œæ•´å®‰è£…ï¼ˆåŒ…å«æ•°æ®åº“æ”¯æŒï¼‰

å¦‚æœéœ€è¦ä½¿ç”¨ `run_backtest_ETF()` æˆ– `run_backtest_stock()` æ–¹æ³•è¿æ¥æ•°æ®åº“ï¼š

```bash
pip install GeneralBacktest[database]
```

æˆ–å®‰è£…æ‰€æœ‰å¯é€‰ä¾èµ–ï¼š

```bash
pip install GeneralBacktest[full]
```

### ä¾èµ–è¯´æ˜

- **å¿…éœ€ä¾èµ–**ï¼š`numpy`, `pandas`, `matplotlib`
- **å¯é€‰ä¾èµ–**ï¼š
  - `quantchdb`ï¼šç”¨äºæ•°æ®åº“è¿æ¥ï¼ˆETF/è‚¡ç¥¨æ•°æ®ï¼‰
  - `openpyxl`ï¼šç”¨äºå¯¼å‡º Excel æŠ¥å‘Š

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºç¡€ç”¨æ³• - æœ¬åœ°æ•°æ®å›æµ‹

```python
from GeneralBacktest import GeneralBacktest
import pandas as pd

# å‡†å¤‡æƒé‡æ•°æ®ï¼ˆè°ƒä»“ä¿¡å·ï¼‰
weights_data = pd.DataFrame({
    'date': ['2023-01-01', '2023-01-01', '2023-06-01', '2023-06-01'],
    'code': ['stock_A', 'stock_B', 'stock_A', 'stock_B'],
    'weight': [0.6, 0.4, 0.3, 0.7]
})

# å‡†å¤‡ä»·æ ¼æ•°æ®ï¼ˆæ—¥çº¿è¡Œæƒ…ï¼‰
price_data = pd.DataFrame({
    'date': pd.date_range('2023-01-01', '2023-12-31', freq='D'),
    'code': 'stock_A',
    'open': [...],
    'close': [...],
    'adj_factor': [...]  # å¤æƒå› å­
})
# ... æ›´å¤šè‚¡ç¥¨æ•°æ®

# åˆ›å»ºå›æµ‹å®ä¾‹
bt = GeneralBacktest(start_date="2023-01-01", end_date="2023-12-31")

# è¿è¡Œå›æµ‹
results = bt.run_backtest(
    weights_data=weights_data,
    price_data=price_data,
    buy_price="open",              # ä¹°å…¥ä»·æ ¼å­—æ®µ
    sell_price="close",            # å–å‡ºä»·æ ¼å­—æ®µ
    adj_factor_col="adj_factor",   # å¤æƒå› å­å­—æ®µ
    close_price_col="close",       # æ”¶ç›˜ä»·å­—æ®µ
    rebalance_threshold=0.005,     # è°ƒä»“é˜ˆå€¼ï¼š0.5%
    transaction_cost=[0.001, 0.001],  # ä¹°å–æˆæœ¬å„ 0.1%
    slippage=0.0005,               # æ»‘ç‚¹ï¼š0.05%
    initial_capital=1.0
)

# æŸ¥çœ‹æ€§èƒ½æŒ‡æ ‡
bt.print_metrics()

# ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Š
bt.plot_all()  # ç»¼åˆ Dashboard
bt.plot_nav_curve()  # å‡€å€¼æ›²çº¿
bt.plot_monthly_returns()  # æœˆåº¦æ”¶ç›Šçƒ­åŠ›å›¾
```

### é«˜çº§ç”¨æ³• - ETF æ•°æ®åº“å›æµ‹ï¼ˆéœ€è¦æ•°æ®åº“é…ç½®ï¼‰

> **æ³¨æ„**ï¼š`run_backtest_ETF()` å’Œ `run_backtest_stock()` æ–¹æ³•éœ€è¦ç‰¹å®šçš„æ•°æ®åº“é…ç½®ï¼ˆ`db_config`ï¼‰ï¼Œè¿™äº›æ–¹æ³•éœ€è¦æœ‰ç‰¹å®šæ•°æ®åº“æ”¯æŒã€‚ä¸€èˆ¬å»ºè®®ä½¿ç”¨ `run_backtest()` æ–¹æ³•ã€‚

```python
from GeneralBacktest import GeneralBacktest
import pandas as pd

# å‡†å¤‡æƒé‡æ•°æ®
weights_data = pd.DataFrame({
    'date': ['2023-01-01', '2023-01-01'],
    'code': ['510300', '510500'],  # ETF ä»£ç 
    'weight': [0.6, 0.4]
})

# æ•°æ®åº“é…ç½®ï¼ˆéœ€è¦æœ‰æ•ˆçš„æ•°æ®åº“è®¿é—®æƒé™ï¼‰
db_config = {
    'host': 'your_host',
    'port': 9000,
    'user': 'your_user',
    'password': 'your_password',
    'database': 'etf'
}

# åˆ›å»ºå›æµ‹å®ä¾‹
bt = GeneralBacktest(start_date="2023-01-01", end_date="2023-12-31")

# è¿è¡Œ ETF å›æµ‹ï¼ˆè‡ªåŠ¨ä»æ•°æ®åº“è·å–ä»·æ ¼æ•°æ®ï¼‰
results = bt.run_backtest_ETF(
    etf_db_config=db_config,
    weights_data=weights_data,
    buy_price='open',
    sell_price='open',
    transaction_cost=[0.001, 0.001],
    rebalance_threshold=0.005
)

bt.print_metrics()
bt.plot_all()
```

## ğŸ“š æ ¸å¿ƒæ¦‚å¿µ

### æƒé‡æ•°æ®æ ¼å¼

æƒé‡æ•°æ®è¡¨ç¤ºç»„åˆåœ¨å„ä¸ªè°ƒä»“æ—¥çš„ç›®æ ‡ä»“ä½ï¼š

| date       | code    | weight |
|------------|---------|--------|
| 2023-01-01 | stock_A | 0.6    |
| 2023-01-01 | stock_B | 0.4    |
| 2023-06-01 | stock_A | 0.3    |
| 2023-06-01 | stock_B | 0.7    |

- æ¯ä¸ªè°ƒä»“æ—¥çš„æƒé‡å’Œåº”ä¸º 1.0
- ä¸åŒè°ƒä»“æ—¥å¯ä»¥æœ‰ä¸åŒçš„æŒä»“æ•°é‡

### ä»·æ ¼æ•°æ®æ ¼å¼

ä»·æ ¼æ•°æ®åŒ…å«èµ„äº§çš„æ—¥çº¿è¡Œæƒ…ï¼š

| date       | code    | open | high | low  | close | adj_factor |
|------------|---------|------|------|------|-------|------------|
| 2023-01-01 | stock_A | 10.0 | 10.5 | 9.8  | 10.2  | 1.0        |
| 2023-01-02 | stock_A | 10.2 | 10.8 | 10.1 | 10.5  | 1.0        |

- `adj_factor`ï¼šå¤æƒå› å­ï¼Œç”¨äºè®¡ç®—çœŸå®æ”¶ç›Š
- ä¹°å–ä»·æ ¼å¯ä»¥çµæ´»æŒ‡å®šï¼ˆå¼€ç›˜ä»·ã€æ”¶ç›˜ä»·ç­‰ï¼‰

### è°ƒä»“æœºåˆ¶

1. **è°ƒä»“é˜ˆå€¼**ï¼šåªæœ‰å½“ç›®æ ‡æƒé‡ä¸å½“å‰æƒé‡å·®å¼‚è¶…è¿‡é˜ˆå€¼æ—¶æ‰äº¤æ˜“
2. **ä¹°å–æ‹†åˆ†**ï¼šå…ˆå–å‡ºä¸éœ€è¦çš„ä»“ä½ï¼Œå†ä¹°å…¥æ–°ä»“ä½
3. **æˆæœ¬è®¡ç®—**ï¼šä¹°å–åˆ†å¼€è®¡è´¹ï¼Œå¯è®¾ç½®ä¸åŒè´¹ç‡
4. **æ»‘ç‚¹æ¨¡æ‹Ÿ**ï¼šä¹°å…¥ä»·æ ¼ä¸Šæµ®ã€å–å‡ºä»·æ ¼ä¸‹å‹

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡è¯´æ˜

| æŒ‡æ ‡ç±»åˆ« | æŒ‡æ ‡åç§° | è¯´æ˜ |
|---------|---------|------|
| **æ”¶ç›ŠæŒ‡æ ‡** | ç´¯è®¡æ”¶ç›Šç‡ | æœŸæœ«/æœŸåˆ - 1 |
| | å¹´åŒ–æ”¶ç›Šç‡ | æŒ‰äº¤æ˜“æ—¥å¹´åŒ– |
| **é£é™©æŒ‡æ ‡** | å¹´åŒ–æ³¢åŠ¨ç‡ | æ—¥æ”¶ç›Šç‡æ ‡å‡†å·®å¹´åŒ– |
| | æœ€å¤§å›æ’¤ | ä»å³°å€¼åˆ°è°·åº•çš„æœ€å¤§æŸå¤± |
| | æœ€å¤§å›æ’¤æŒç»­æœŸ | æœ€é•¿å›æ’¤æ—¶é—´ï¼ˆå¤©ï¼‰ |
| **é£é™©è°ƒæ•´** | å¤æ™®æ¯”ç‡ | å¹´åŒ–æ”¶ç›Š/å¹´åŒ–æ³¢åŠ¨ç‡ |
| | ç´¢æè¯ºæ¯”ç‡ | å¹´åŒ–æ”¶ç›Š/ä¸‹è¡Œæ³¢åŠ¨ç‡ |
| | å¡ç›æ¯”ç‡ | å¹´åŒ–æ”¶ç›Š/æœ€å¤§å›æ’¤ |
| **å°¾éƒ¨é£é™©** | VaR (95%) | 5%åˆ†ä½æ•°æŸå¤± |
| | CVaR (95%) | è¶…è¿‡VaRçš„å¹³å‡æŸå¤± |
| **ç›¸å¯¹æŒ‡æ ‡** | ä¿¡æ¯æ¯”ç‡ | è¶…é¢æ”¶ç›Š/è·Ÿè¸ªè¯¯å·® |
| | è¶…é¢å¹´åŒ–æ”¶ç›Š | ç›¸å¯¹åŸºå‡†çš„å¹´åŒ–è¶…é¢ |
| **äº¤æ˜“æŒ‡æ ‡** | æ¢æ‰‹ç‡ | è°ƒä»“æ—¶çš„ä¹°å–é‡‘é¢ |

## ğŸ¨ å¯è§†åŒ–ç¤ºä¾‹

æ¡†æ¶æä¾›å¤šç§å¯è§†åŒ–æ–¹æ³•ï¼š

```python
# 1. ç»¼åˆ Dashboardï¼ˆæ¨èï¼‰
bt.plot_all()

# 2. å‡€å€¼æ›²çº¿å’Œå›æ’¤
bt.plot_nav_curve()

# 3. ç­–ç•¥ä¸åŸºå‡†å¯¹æ¯”
bt.plot_comparison()

# 4. è¶…é¢æ”¶ç›Šåˆ†æ
bt.plot_excess_returns()

# 5. æœˆåº¦æ”¶ç›Šçƒ­åŠ›å›¾
bt.plot_monthly_returns()

# 6. æ¢æ‰‹ç‡åˆ†æ
bt.plot_turnover()

# 7. æŒä»“å˜åŒ–çƒ­åŠ›å›¾
bt.plot_positions()

# 8. æ”¶ç›Šåˆ†å¸ƒç›´æ–¹å›¾
bt.plot_return_distribution()
```

## ğŸ”§ é«˜çº§é…ç½®

### è‡ªå®šä¹‰åŸºå‡†

```python
# æä¾›åŸºå‡†æƒé‡æ•°æ®
benchmark_weights = pd.DataFrame({
    'date': ['2023-01-01'],
    'code': ['index_300'],
    'weight': [1.0]
})

results = bt.run_backtest(
    weights_data=weights_data,
    price_data=price_data,
    benchmark_weights=benchmark_weights,
    benchmark_name="HS300",
    ...
)
```

### å¯¼å‡ºç»“æœ

```python
# è·å–å›æµ‹ç»“æœ
nav_series = bt.daily_nav  # æ—¥åº¦å‡€å€¼åºåˆ—
positions = bt.daily_positions  # æŒä»“æ˜ç»†
trade_records = bt.trade_records  # äº¤æ˜“è®°å½•
metrics = bt.metrics  # æ€§èƒ½æŒ‡æ ‡å­—å…¸

# å¯¼å‡ºä¸º DataFrame
import pandas as pd
pd.DataFrame(metrics, index=[0]).to_excel('metrics.xlsx')
```

## ğŸ“– API æ–‡æ¡£

### GeneralBacktest ç±»

#### åˆå§‹åŒ–
```python
GeneralBacktest(start_date: str, end_date: str)
```

#### ä¸»è¦æ–¹æ³•

- `run_backtest(...)`: é€šç”¨å›æµ‹æ–¹æ³•ï¼ˆæ¨èï¼‰
- `run_backtest_ETF(...)`: ETF å›æµ‹ï¼ˆéœ€æ•°æ®åº“é…ç½®ï¼‰
- `run_backtest_stock(...)`: è‚¡ç¥¨å›æµ‹ï¼ˆéœ€æ•°æ®åº“é…ç½®ï¼‰
- `print_metrics()`: æ‰“å°æ€§èƒ½æŒ‡æ ‡
- `plot_all()`: ç”Ÿæˆç»¼åˆæŠ¥å‘Š
- `plot_nav_curve()`: ç»˜åˆ¶å‡€å€¼æ›²çº¿
- `plot_comparison()`: ç­–ç•¥å¯¹æ¯”å›¾
- `plot_excess_returns()`: è¶…é¢æ”¶ç›Šå›¾
- `plot_monthly_returns()`: æœˆåº¦æ”¶ç›Šçƒ­åŠ›å›¾
- `plot_turnover()`: æ¢æ‰‹ç‡å›¾
- `plot_positions()`: æŒä»“çƒ­åŠ›å›¾
- `plot_return_distribution()`: æ”¶ç›Šåˆ†å¸ƒå›¾

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ‘¨â€ğŸ’» ä½œè€…

Elen Young - yang13515360252@example.com

## ğŸ”— ç›¸å…³é“¾æ¥

- [GitHub ä»“åº“](https://github.com/ElenYoung/GeneralBacktest)
- [é—®é¢˜åé¦ˆ](https://github.com/ElenYoung/GeneralBacktest/issues)
- [æ›´æ–°æ—¥å¿—](https://github.com/ElenYoung/GeneralBacktest/releases)

## âš ï¸ å…è´£å£°æ˜

æœ¬æ¡†æ¶ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚ä½¿ç”¨æœ¬æ¡†æ¶è¿›è¡Œçš„ä»»ä½•æŠ•èµ„å†³ç­–ï¼Œé£é™©è‡ªè´Ÿã€‚

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2026-01-24)
- ğŸ‰ é¦–æ¬¡å‘å¸ƒ
- âœ¨ æ”¯æŒçµæ´»è°ƒä»“é¢‘ç‡
- âœ¨ å‘é‡åŒ–é«˜æ€§èƒ½è®¡ç®—
- âœ¨ 15+ æ€§èƒ½æŒ‡æ ‡
- âœ¨ 8+ å¯è§†åŒ–å›¾è¡¨
- âœ¨ æ”¯æŒåŸºå‡†å¯¹æ¯”
- âœ¨ çœŸå®äº¤æ˜“ç»†èŠ‚æ¨¡æ‹Ÿ
