apiVersion: v1
kind: Pod
metadata:
  name: chmod-cs-store
  annotations:
    "helm.sh/hook": pre-install
    "helm.sh/hook-weight": "-2"
    "helm.sh/hook-delete-policy": before-hook-creation
spec:
  containers:
  - image: harbor.cta-observatory.org/proxy_cache/alpine:3.22.1
    imagePullPolicy: IfNotPresent
    name: init-diracx-volume
    command:
      - /bin/sh
      - -c
      - |
        # if initialRepo stays from previous install in a PV, install will not work
        rm -rfv /cs_store/initialRepo
        chmod -vR 777 /cs_store
    resources: {}
    volumeMounts:
    - mountPath: /cs_store
      name: cs-store-mount
    securityContext:
      runAsUser: 0
      runAsGroup: 0
  restartPolicy: Never
  volumes:
  - name: cs-store-mount
    persistentVolumeClaim:
      claimName: pvc-cs-store
