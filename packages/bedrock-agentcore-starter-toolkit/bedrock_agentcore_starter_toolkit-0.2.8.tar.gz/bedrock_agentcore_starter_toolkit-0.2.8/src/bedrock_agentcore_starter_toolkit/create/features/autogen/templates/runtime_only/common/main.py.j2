import os
from autogen_agentchat.agents import AssistantAgent
from bedrock_agentcore.runtime import BedrockAgentCoreApp
from autogen_core.tools import FunctionTool
from mcp_client.client import get_streamable_http_mcp_tools
from model.load import load_model

# Define a simple function tool
def add_numbers(a: int, b: int) -> int:
    """Return the sum of two numbers"""
    return a+b
add_numbers_function_tool = FunctionTool(add_numbers, description="Return the sum of two numbers")

# Integrate with Bedrock AgentCore
app = BedrockAgentCoreApp()

@app.entrypoint
async def main(payload):
    # assume payload input is structured as { "prompt": "<user input>" }

    # Import AgentCore Gateway tools as Streamable HTTP MCP Tools
    tools = await get_streamable_http_mcp_tools()

    # Define an AssistantAgent with the model and tool
    agent = AssistantAgent(
        name="{{ agent_name }}",
        model_client=load_model(),
        tools=[add_numbers_function_tool] + tools,
        system_message="You are a helpful assistant."
    )

    # Process the user prompt
    prompt = payload.get("prompt", "What is Agentic AI?")

    # Run the agent
    result = await agent.run(task=prompt)

    # Return result
    return {"result": result.messages[-1].content}


if __name__ == "__main__":
    app.run()
