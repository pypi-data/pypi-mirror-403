# Generated by Django 5.2.10 on 2026-01-23 11:58

import django.db.models.deletion
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('django_agent_runtime', '0004_add_anonymous_session_id'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='AgentDefinition',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('slug', models.SlugField(help_text='Unique identifier for this agent (used as agent_key)', max_length=100, unique=True)),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('icon', models.CharField(blank=True, help_text='Icon identifier (emoji or icon class)', max_length=100)),
                ('is_public', models.BooleanField(default=False, help_text='Whether this agent is publicly accessible')),
                ('is_template', models.BooleanField(default=False, help_text='Whether this agent can be used as a template for others')),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('owner', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='agent_definitions', to=settings.AUTH_USER_MODEL)),
                ('parent', models.ForeignKey(blank=True, help_text='Parent agent to inherit configuration from', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='children', to='django_agent_runtime.agentdefinition')),
            ],
            options={
                'verbose_name': 'Agent Definition',
                'verbose_name_plural': 'Agent Definitions',
                'ordering': ['-updated_at'],
            },
        ),
        migrations.CreateModel(
            name='AgentKnowledge',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(help_text='Name/title of this knowledge source', max_length=255)),
                ('knowledge_type', models.CharField(choices=[('text', 'Static Text'), ('file', 'File/Document'), ('url', 'URL/Webpage'), ('dynamic', 'Dynamic Source')], default='text', max_length=20)),
                ('content', models.TextField(blank=True, help_text='Text content (for text type)')),
                ('file', models.FileField(blank=True, help_text='Uploaded file (for file type)', null=True, upload_to='agent_knowledge/')),
                ('url', models.URLField(blank=True, help_text='URL to fetch content from (for url type)')),
                ('dynamic_config', models.JSONField(blank=True, default=dict, help_text='Configuration for dynamic knowledge source')),
                ('inclusion_mode', models.CharField(choices=[('always', 'Always Include'), ('on_demand', 'On Demand (via tool)'), ('rag', 'RAG (similarity search)')], default='always', max_length=20)),
                ('is_active', models.BooleanField(default=True)),
                ('order', models.PositiveIntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('agent', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='knowledge_sources', to='django_agent_runtime.agentdefinition')),
            ],
            options={
                'verbose_name': 'Agent Knowledge',
                'verbose_name_plural': 'Agent Knowledge Sources',
                'ordering': ['order', 'name'],
            },
        ),
        migrations.CreateModel(
            name='AgentTool',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(help_text='Tool name (must be unique within agent)', max_length=100)),
                ('tool_type', models.CharField(choices=[('builtin', 'Built-in Tool'), ('function', 'Custom Function'), ('subagent', 'Sub-Agent')], default='function', max_length=20)),
                ('description', models.TextField(help_text='Description of what the tool does (shown to LLM)')),
                ('parameters_schema', models.JSONField(blank=True, default=dict, help_text='JSON Schema for tool parameters')),
                ('builtin_ref', models.CharField(blank=True, help_text="Reference to built-in tool (e.g., 'web_search')", max_length=100)),
                ('config', models.JSONField(blank=True, default=dict, help_text='Additional tool configuration')),
                ('is_active', models.BooleanField(default=True)),
                ('order', models.PositiveIntegerField(default=0)),
                ('agent', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tools', to='django_agent_runtime.agentdefinition')),
                ('subagent', models.ForeignKey(blank=True, help_text='Agent to delegate to (for subagent tools)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='used_as_tool_in', to='django_agent_runtime.agentdefinition')),
            ],
            options={
                'verbose_name': 'Agent Tool',
                'verbose_name_plural': 'Agent Tools',
                'ordering': ['order', 'name'],
                'unique_together': {('agent', 'name')},
            },
        ),
        migrations.CreateModel(
            name='AgentVersion',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('version', models.CharField(help_text="Version string (e.g., '1.0.0', 'draft')", max_length=50)),
                ('system_prompt', models.TextField(blank=True, help_text='The system prompt for this agent')),
                ('model', models.CharField(default='gpt-4o', help_text="LLM model to use (e.g., 'gpt-4o', 'claude-3-opus')", max_length=100)),
                ('model_settings', models.JSONField(blank=True, default=dict, help_text='Model-specific settings (temperature, max_tokens, etc.)')),
                ('extra_config', models.JSONField(blank=True, default=dict, help_text='Additional configuration options')),
                ('is_active', models.BooleanField(default=False, help_text='Whether this is the active version')),
                ('is_draft', models.BooleanField(default=True, help_text='Whether this version is still being edited')),
                ('notes', models.TextField(blank=True, help_text='Release notes or change description')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('published_at', models.DateTimeField(blank=True, null=True)),
                ('agent', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='versions', to='django_agent_runtime.agentdefinition')),
            ],
            options={
                'verbose_name': 'Agent Version',
                'verbose_name_plural': 'Agent Versions',
                'ordering': ['-created_at'],
                'unique_together': {('agent', 'version')},
            },
        ),
    ]
