# docker-compose.yml template

services:
  app:
    build: .
    ports:
      - "{{ port | default(8000) }}:{{ port | default(8000) }}"
{% if command and command != 'None' %}
    command: {{ command }}
{% else %}
    command: ["uvicorn", "{{ entrypoint | default('src.main:app') }}", "--host", "0.0.0.0", "--port", "{{ port | default(8000) }}"]
{% endif %}
{% if database == 'postgres' or database == 'postgresql' %}
    depends_on:
      - db
    environment:
      - DATABASE_URL=postgresql://{{ db_user | default('user') }}:{{ db_password | default('password') }}@db:5432/{{ db_name | default('appdb') }}

  db:
    image: postgres:15-alpine
    volumes:
      - postgres_data:/var/lib/postgresql/data/
    environment:
      - POSTGRES_USER={{ db_user | default('user') }}
      - POSTGRES_PASSWORD={{ db_password | default('password') }}
      - POSTGRES_DB={{ db_name | default('appdb') }}

volumes:
  postgres_data:
{% endif %}
