import{C as H,D as g,c as f,d as B,f as _,x as w,j as e,v as r,m as p,o as I,E as L,k as v,u as O,F as W,r as z}from"./vue-vendor-w28tHAkY.js";import{g as N,a as U}from"./index-BYCcWbA5.js";import{H as A}from"./echarts-BywJijcg.js";import{d as V}from"./dayjs.min-CxMP4GVf.js";const K=H("metrics",()=>{const n=g(null),i=g(null),o=g(!1),d=g(null),h=g(null),c=f(()=>n.value?n.value.error_rate*100:0);return{summary:n,timeline:i,loading:o,error:d,lastUpdated:h,errorRate:c,fetchMetrics:async(x=1)=>{o.value=!0,d.value=null;try{const u=await N({hours:x});n.value=u.summary,h.value=new Date}catch(u){d.value=u.message||"Failed to fetch metrics"}finally{o.value=!1}},fetchTimeline:async(x=1,u=60)=>{try{const s=await U({hours:x,interval:u});i.value=s.timeline}catch(s){console.error("Failed to fetch timeline:",s)}}}}),G={class:"flex items-center justify-between"},J={class:"card-header"},Q={class:"card-value"},X={class:"text-3xl opacity-50"},b=B({__name:"StatCard",props:{title:{},value:{},icon:{},color:{}},setup(n){const i=n,o=f(()=>({blue:"border-l-4 border-l-blue-500",green:"border-l-4 border-l-green-500",red:"border-l-4 border-l-red-500",purple:"border-l-4 border-l-purple-500",yellow:"border-l-4 border-l-yellow-500"})[i.color||"blue"]);return(d,h)=>(p(),_("div",{class:w(["card",o.value])},[e("div",G,[e("div",null,[e("div",J,r(n.title),1),e("div",Q,r(n.value),1)]),e("div",X,r(n.icon),1)])],2))}}),Y={class:"space-y-6"},Z={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},ee={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},te={class:"card"},se={class:"h-64"},oe={class:"card"},re={class:"h-64"},ae={class:"card"},le={class:"grid grid-cols-5 gap-4 mt-4"},ie={class:"text-center"},ne={class:"text-xl font-bold"},de={class:"text-center"},ce={class:"text-xl font-bold"},ue={class:"text-center"},me={class:"text-xl font-bold text-yellow-600"},ve={class:"text-center"},_e={class:"text-xl font-bold text-orange-600"},pe={class:"text-center"},fe={class:"text-xl font-bold text-red-600"},he={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},xe={class:"card"},ge={class:"mt-4 space-y-2"},ye={class:"flex items-center space-x-2"},be={class:"text-gray-700"},we={class:"text-gray-500"},qe={class:"card"},Re={class:"mt-4 space-y-2"},Se={class:"flex items-center space-x-2"},Me={class:"text-gray-700"},$e={class:"text-orange-600"},je=B({__name:"Dashboard",setup(n){const i=K(),o=f(()=>i.summary),d=f(()=>i.timeline),h=s=>s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(1)+"K":s.toString(),c=s=>s<1?"<1ms":s<1e3?Math.round(s)+"ms":(s/1e3).toFixed(2)+"s",q=s=>(s*100).toFixed(2)+"%",R=f(()=>{var s,t,m;return{tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["Requests","Errors"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:((s=d.value)==null?void 0:s.points.map(a=>V(a.timestamp).format("HH:mm")))||[]},yAxis:[{type:"value",name:"Requests"}],series:[{name:"Requests",type:"line",smooth:!0,areaStyle:{opacity:.3},data:((t=d.value)==null?void 0:t.points.map(a=>a.requests))||[]},{name:"Errors",type:"line",smooth:!0,itemStyle:{color:"#ef4444"},data:((m=d.value)==null?void 0:m.points.map(a=>a.errors))||[]}]}}),x=f(()=>{var m;const s=((m=o.value)==null?void 0:m.status_code_counts)||{},t=Object.entries(s).map(([a,y])=>({name:a,value:y,itemStyle:{color:a.startsWith("2")?"#22c55e":a.startsWith("3")?"#3b82f6":a.startsWith("4")?"#f59e0b":"#ef4444"}}));return{tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},series:[{type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!0,formatter:"{b}: {c}"},data:t}]}});let u=null;return I(()=>{i.fetchMetrics(1),i.fetchTimeline(1,60),u=window.setInterval(()=>{i.fetchMetrics(1),i.fetchTimeline(1,60)},3e4)}),L(()=>{u&&clearInterval(u)}),(s,t)=>{var m,a,y,S,M,$,T,F,C,E,j,D,P,k;return p(),_("div",Y,[e("div",Z,[v(b,{title:"Total Requests",value:h(((m=o.value)==null?void 0:m.total_requests)||0),icon:"ðŸ“Š",color:"blue"},null,8,["value"]),v(b,{title:"Avg Response Time",value:c(((a=o.value)==null?void 0:a.avg_duration_ms)||0),icon:"â±ï¸",color:"green"},null,8,["value"]),v(b,{title:"Error Rate",value:q(((y=o.value)==null?void 0:y.error_rate)||0),icon:"âŒ",color:(((S=o.value)==null?void 0:S.error_rate)||0)>.05?"red":"green"},null,8,["value","color"]),v(b,{title:"Requests/sec",value:(((M=o.value)==null?void 0:M.requests_per_second)||0).toFixed(2),icon:"ðŸš€",color:"purple"},null,8,["value"])]),e("div",ee,[e("div",te,[t[0]||(t[0]=e("div",{class:"card-header"},"Request Timeline",-1)),e("div",se,[v(O(A),{option:R.value,autoresize:""},null,8,["option"])])]),e("div",oe,[t[1]||(t[1]=e("div",{class:"card-header"},"Status Code Distribution",-1)),e("div",re,[v(O(A),{option:x.value,autoresize:""},null,8,["option"])])])]),e("div",ae,[t[7]||(t[7]=e("div",{class:"card-header"},"Response Time Percentiles",-1)),e("div",le,[e("div",ie,[t[2]||(t[2]=e("div",{class:"text-sm text-gray-500"},"Min",-1)),e("div",ne,r(c((($=o.value)==null?void 0:$.min_duration_ms)||0)),1)]),e("div",de,[t[3]||(t[3]=e("div",{class:"text-sm text-gray-500"},"P50",-1)),e("div",ce,r(c(((T=o.value)==null?void 0:T.p50_duration_ms)||0)),1)]),e("div",ue,[t[4]||(t[4]=e("div",{class:"text-sm text-gray-500"},"P95",-1)),e("div",me,r(c(((F=o.value)==null?void 0:F.p95_duration_ms)||0)),1)]),e("div",ve,[t[5]||(t[5]=e("div",{class:"text-sm text-gray-500"},"P99",-1)),e("div",_e,r(c(((C=o.value)==null?void 0:C.p99_duration_ms)||0)),1)]),e("div",pe,[t[6]||(t[6]=e("div",{class:"text-sm text-gray-500"},"Max",-1)),e("div",fe,r(c(((E=o.value)==null?void 0:E.max_duration_ms)||0)),1)])])]),e("div",he,[e("div",xe,[t[8]||(t[8]=e("div",{class:"card-header"},"Top Endpoints by Requests",-1)),e("div",ge,[(p(!0),_(W,null,z((D=(j=o.value)==null?void 0:j.top_endpoints)==null?void 0:D.slice(0,5),l=>(p(),_("div",{key:`${l.method}-${l.path}`,class:"flex items-center justify-between py-2 border-b border-gray-100"},[e("div",ye,[e("span",{class:w([`method-${l.method}`,"font-mono text-sm font-medium"])},r(l.method),3),e("span",be,r(l.path),1)]),e("span",we,r(l.total_requests)+" reqs",1)]))),128))])]),e("div",qe,[t[9]||(t[9]=e("div",{class:"card-header"},"Slowest Endpoints",-1)),e("div",Re,[(p(!0),_(W,null,z((k=(P=o.value)==null?void 0:P.slowest_endpoints)==null?void 0:k.slice(0,5),l=>(p(),_("div",{key:`${l.method}-${l.path}`,class:"flex items-center justify-between py-2 border-b border-gray-100"},[e("div",Se,[e("span",{class:w([`method-${l.method}`,"font-mono text-sm font-medium"])},r(l.method),3),e("span",Me,r(l.path),1)]),e("span",$e,r(c(l.avg_duration_ms)),1)]))),128))])])])])}}});export{je as default};
