import{C as T,D as v,d as D,o as F,f as u,j as t,G as _,H as E,I as P,u as n,J as M,F as S,r as R,v as r,K as $,x as c,L as f,M as q,m,q as z}from"./vue-vendor-w28tHAkY.js";import{b as N,c as V}from"./index-BYCcWbA5.js";import{d as j}from"./dayjs.min-CxMP4GVf.js";const B=T("requests",()=>{const y=v([]),l=v(0),d=v(1),a=v(50),p=v(!1),g=v(null),i=v({path:"",method:"",statusCode:null}),x=async()=>{p.value=!0;try{const s={page:d.value,page_size:a.value};i.value.path&&(s.path=i.value.path),i.value.method&&(s.method=i.value.method),i.value.statusCode&&(s.status_code=i.value.statusCode);const e=await N(s);y.value=e.items,l.value=e.total}catch(s){console.error("Failed to fetch requests:",s)}finally{p.value=!1}};return{items:y,total:l,currentPage:d,pageSize:a,loading:p,selectedRequest:g,filters:i,fetchRequests:x,fetchRequestDetail:async s=>{try{const e=await V(s);g.value=e.record}catch(e){console.error("Failed to fetch request detail:",e)}},setPage:s=>{d.value=s,x()},setFilters:s=>{Object.assign(i.value,s),d.value=1,x()},clearFilters:()=>{i.value={path:"",method:"",statusCode:null},d.value=1,x()}}}),H={class:"space-y-4"},U={class:"card"},L={class:"flex flex-wrap gap-4 items-center"},O={class:"card"},A={class:"table-container"},I={class:"data-table"},Y=["onClick"],G={class:"text-gray-500 text-xs"},J={class:"font-mono text-sm max-w-md truncate"},K={class:"text-gray-500 text-sm"},Q={class:"flex items-center justify-between mt-4 pt-4 border-t"},W={class:"text-sm text-gray-500"},X={class:"flex space-x-2"},Z=["disabled"],tt=["disabled"],et={class:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto m-4"},st={class:"sticky top-0 bg-white border-b px-6 py-4 flex items-center justify-between"},ot={class:"p-6 space-y-4"},lt={class:"grid grid-cols-2 gap-4"},at={class:"font-medium"},nt={class:"font-mono"},rt={class:"font-mono text-sm bg-gray-100 p-2 rounded break-all"},dt={class:"bg-gray-100 p-2 rounded text-sm font-mono max-h-40 overflow-y-auto"},it={class:"text-gray-600"},ut={key:0},mt={class:"bg-gray-100 p-3 rounded text-sm font-mono max-h-60 overflow-auto whitespace-pre-wrap break-all"},vt={key:1},pt={class:"bg-green-50 p-3 rounded text-sm font-mono max-h-60 overflow-auto whitespace-pre-wrap break-all"},xt={key:2},ct={class:"bg-red-50 text-red-700 p-2 rounded text-sm"},bt=D({__name:"Requests",setup(y){const l=B(),d=q({path:"",method:"",statusCode:null}),a=v(null);let p=null;const g=()=>{p&&clearTimeout(p),p=window.setTimeout(()=>{l.setFilters(d)},300)},i=s=>{a.value=s},x=s=>j(s).format("YYYY-MM-DD HH:mm:ss"),b=s=>s<1?"<1ms":s<1e3?Math.round(s)+"ms":(s/1e3).toFixed(2)+"s",h=s=>s>=500?"status-5xx":s>=400?"status-4xx":s>=300?"status-3xx":"status-2xx",k=s=>s>1e3?"text-red-600 font-medium":s>500?"text-yellow-600":"text-green-600",C=s=>{try{const e=JSON.parse(s);return JSON.stringify(e,null,2)}catch{return s}};return F(()=>{l.fetchRequests()}),(s,e)=>(m(),u("div",H,[t("div",U,[t("div",L,[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm text-gray-500 mb-1"},"Path",-1)),_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>d.path=o),type:"text",placeholder:"Filter by path",class:"px-3 py-2 border border-gray-300 rounded-md text-sm",onInput:g},null,544),[[E,d.path]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm text-gray-500 mb-1"},"Method",-1)),_(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>d.method=o),class:"px-3 py-2 border border-gray-300 rounded-md text-sm",onChange:e[2]||(e[2]=o=>n(l).setFilters(d))},[...e[12]||(e[12]=[M('<option value="">All</option><option value="GET">GET</option><option value="POST">POST</option><option value="PUT">PUT</option><option value="DELETE">DELETE</option><option value="PATCH">PATCH</option>',6)])],544),[[P,d.method]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm text-gray-500 mb-1"},"Status",-1)),_(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>d.statusCode=o),class:"px-3 py-2 border border-gray-300 rounded-md text-sm",onChange:e[4]||(e[4]=o=>n(l).setFilters(d))},[...e[14]||(e[14]=[t("option",{value:null},"All",-1),t("option",{value:200},"2xx Success",-1),t("option",{value:300},"3xx Redirect",-1),t("option",{value:400},"4xx Client Error",-1),t("option",{value:500},"5xx Server Error",-1)])],544),[[P,d.statusCode]])]),e[16]||(e[16]=t("div",{class:"flex-grow"},null,-1)),t("button",{onClick:e[5]||(e[5]=o=>n(l).clearFilters()),class:"px-4 py-2 text-sm text-gray-600 hover:text-gray-900"}," Clear Filters "),t("button",{onClick:e[6]||(e[6]=o=>n(l).fetchRequests()),class:"px-4 py-2 bg-primary-500 text-white rounded-md text-sm hover:bg-primary-600"}," Refresh ")])]),t("div",O,[t("div",A,[t("table",I,[e[17]||(e[17]=t("thead",null,[t("tr",null,[t("th",null,"Time"),t("th",null,"Method"),t("th",null,"Path"),t("th",null,"Status"),t("th",null,"Duration"),t("th",null,"Client IP")])],-1)),t("tbody",null,[(m(!0),u(S,null,R(n(l).items,o=>(m(),u("tr",{key:o.id,class:"cursor-pointer",onClick:w=>i(o)},[t("td",G,r(x(o.timestamp)),1),t("td",null,[t("span",{class:c([`method-${o.method}`,"font-mono font-medium"])},r(o.method),3)]),t("td",J,r(o.path),1),t("td",null,[t("span",{class:c([h(o.status_code),"font-medium"])},r(o.status_code),3)]),t("td",{class:c(k(o.duration_ms))},r(b(o.duration_ms)),3),t("td",K,r(o.client_ip),1)],8,Y))),128))])])]),t("div",Q,[t("div",W," Showing "+r((n(l).currentPage-1)*n(l).pageSize+1)+" - "+r(Math.min(n(l).currentPage*n(l).pageSize,n(l).total))+" of "+r(n(l).total),1),t("div",X,[t("button",{disabled:n(l).currentPage<=1,class:"px-3 py-1 border rounded text-sm disabled:opacity-50",onClick:e[7]||(e[7]=o=>n(l).setPage(n(l).currentPage-1))}," Previous ",8,Z),t("button",{disabled:n(l).currentPage*n(l).pageSize>=n(l).total,class:"px-3 py-1 border rounded text-sm disabled:opacity-50",onClick:e[8]||(e[8]=o=>n(l).setPage(n(l).currentPage+1))}," Next ",8,tt)])])]),a.value?(m(),u("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e[10]||(e[10]=$(o=>a.value=null,["self"]))},[t("div",et,[t("div",st,[e[18]||(e[18]=t("h2",{class:"text-lg font-semibold"},"Request Detail",-1)),t("button",{onClick:e[9]||(e[9]=o=>a.value=null),class:"text-gray-400 hover:text-gray-600"}," âœ• ")]),t("div",ot,[t("div",lt,[t("div",null,[e[19]||(e[19]=t("div",{class:"text-sm text-gray-500"},"Method",-1)),t("div",{class:c([`method-${a.value.method}`,"font-mono font-bold"])},r(a.value.method),3)]),t("div",null,[e[20]||(e[20]=t("div",{class:"text-sm text-gray-500"},"Status Code",-1)),t("div",{class:c([h(a.value.status_code),"font-bold"])},r(a.value.status_code),3)]),t("div",null,[e[21]||(e[21]=t("div",{class:"text-sm text-gray-500"},"Duration",-1)),t("div",at,r(b(a.value.duration_ms)),1)]),t("div",null,[e[22]||(e[22]=t("div",{class:"text-sm text-gray-500"},"Client IP",-1)),t("div",nt,r(a.value.client_ip),1)])]),t("div",null,[e[23]||(e[23]=t("div",{class:"text-sm text-gray-500"},"Full URL",-1)),t("div",rt,r(a.value.full_url),1)]),t("div",null,[e[24]||(e[24]=t("div",{class:"text-sm text-gray-500 mb-2"},"Request Headers",-1)),t("div",dt,[(m(!0),u(S,null,R(a.value.headers,(o,w)=>(m(),u("div",{key:w},[t("span",it,r(w)+":",1),z(" "+r(o),1)]))),128))])]),a.value.body?(m(),u("div",ut,[e[25]||(e[25]=t("div",{class:"text-sm text-gray-500 mb-2"},"Request Body",-1)),t("pre",mt,r(C(a.value.body)),1)])):f("",!0),a.value.response_body?(m(),u("div",vt,[e[26]||(e[26]=t("div",{class:"text-sm text-gray-500 mb-2"},"Response Body",-1)),t("pre",pt,r(C(a.value.response_body)),1)])):f("",!0),a.value.error?(m(),u("div",xt,[e[27]||(e[27]=t("div",{class:"text-sm text-gray-500 mb-2"},"Error",-1)),t("div",ct,r(a.value.error),1)])):f("",!0)])])])):f("",!0)]))}});export{bt as default};
