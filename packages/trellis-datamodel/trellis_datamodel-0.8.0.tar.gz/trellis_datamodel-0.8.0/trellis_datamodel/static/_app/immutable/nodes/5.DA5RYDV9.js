import{d as Ut,c as rt,a as o,f as u,e as lt,t as za}from"../chunks/CjZGm4I-.js";import{y as Ft,z as _,A as ht,B as Rt,F as t,w as be,J as Bt,H as r,I as a,L as n,bo as br,C as e,K as Ue,x as z,M as Z,G as Ja,u as Na,f as mr,$ as pr}from"../chunks/QnYduk6G.js";import{s as q}from"../chunks/B9JYo02m.js";import{i as h,p as At,b as Za,a as pa,c as ra}from"../chunks/DjhwXl_d.js";import{s as Ve,j as Xt,b as Dt,r as jt,a as _r,d as yr,e as _a,h as hr}from"../chunks/9BfctgED.js";import{n as Ka,d as Sa,m as Ia,s as xr,c as wr,v as Er}from"../chunks/CX-jWEeK.js";import{f as Ma,I as W,e as at,i as xt,h as ya,j as kr,k as Cr,l as aa,m as Dr,n as ua,o as Sr,p as Pr,s as Ir,q as Mr,t as Ua,w as Pa,a as Ar,b as jr}from"../chunks/CfnWWzkx.js";import{b as na}from"../chunks/1eVKCY12.js";import{b as Ha}from"../chunks/6fX-1bKn.js";import{g as Fr,m as Br,n as qa}from"../chunks/NVXBPEyd.js";import{D as Wr}from"../chunks/DH-fSuOj.js";import{g as Or}from"../chunks/DF7JV_1b.js";var Lr=u('<span class="text-xs text-red-600">Event text is required</span>'),Rr=u('<span class="text-xs text-red-600"></span>'),Tr=u("<option> </option>"),zr=u('<div class="flex items-center gap-3 text-red-700 bg-red-50 border border-red-200 rounded-lg px-4 py-3"><!> <span class="text-sm"> </span></div>'),Nr=u("<!> <span>Saving...</span>",1),Kr=u("<!> <span> </span>",1),Ur=u(`<div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center backdrop-blur-sm" role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="event-modal-title"><div class="bg-white rounded-lg shadow-xl p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto" role="document" tabindex="-1"><div class="flex items-center justify-between mb-6"><h2 id="event-modal-title" class="text-xl font-semibold text-gray-900"> </h2> <button class="p-2 rounded-md hover:bg-gray-100 text-gray-500" aria-label="Close"><!></button></div> <div class="space-y-4"><div><label for="event-text" class="block text-sm font-medium text-gray-700 mb-2">Event Description</label> <textarea id="event-text" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed" placeholder="e.g., customer buys product"></textarea> <div class="flex items-center justify-between mt-1"><span class="text-xs text-gray-500"> </span> <!></div></div> <div><div class="flex items-center gap-2 mb-2"><label for="event-type" class="block text-sm font-medium text-gray-700">Event Type</label> <div class="group relative"><!> <div class="absolute left-0 bottom-full mb-2 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-opacity z-10"><div class="space-y-2"><div><strong class="text-blue-300">Discrete:</strong> One-time
                                        events (e.g., "customer buys product")</div> <div><strong class="text-yellow-300">Evolving:</strong> Events
                                        that change over time (e.g., "sales opportunity funnel")</div> <div><strong class="text-purple-300">Recurring:</strong> Events
                                        that repeat (e.g., "monthly account statement")</div></div> <div class="absolute left-4 top-full w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"></div></div></div></div> <select id="event-type" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed"><option>Discrete</option><option>Evolving</option><option>Recurring</option></select></div> <div><div class="flex items-center gap-2 mb-2"><label for="event-domain" class="block text-sm font-medium text-gray-700">Business Domain</label> <div class="group relative"><!> <div class="absolute left-0 bottom-full mb-2 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-opacity z-10"><div class="space-y-2"><div>Optional business domain classification (e.g., Sales, Marketing, Finance).
                                        Helps organize and filter events.</div></div> <div class="absolute left-4 top-full w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"></div></div></div></div> <select id="event-domain" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed"><option>No Domain</option><!></select></div> <!> <div class="flex justify-end gap-3 pt-4 border-t border-gray-200"><button class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed">Cancel</button> <button class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"><!></button></div></div></div></div>`);function Va(He,s){Ft(s,!0);let L=_(""),g=_("discrete"),A=_(null),C=_(!1),v=_(null),m=_(ht([]));function R(y){return y.trim().charAt(0).toUpperCase()+y.trim().slice(1).toLowerCase()}const Q=500;let k=Z(()=>e(L).length),H=Z(()=>Q-e(k)),T=Z(()=>!(e(L).trim().length===0||e(L).length>Q||!e(g)||e(C)));Rt(()=>{if(s.open){async function y(){try{t(m,await Ma(),!0)}catch(S){console.warn("Failed to load domains:",S),t(m,[],!0)}}y(),s.event?(t(L,s.event.text,!0),t(g,s.event.type,!0),t(A,s.event.domain||null,!0)):(t(L,""),t(g,"discrete"),t(A,null)),t(v,null),t(C,!1)}});function Y(y){y.key==="Escape"?s.onCancel():y.key==="Enter"&&(y.ctrlKey||y.metaKey)&&X()}function De(y){y.target===y.currentTarget&&s.onCancel()}async function X(){if(e(L).length>Q){t(v,`Event text cannot exceed ${Q} characters`);return}if(e(T)){t(v,null),t(C,!0);try{s.event?await ya(s.event.id,{text:e(L).trim(),type:e(g),domain:e(A)??void 0}):await kr(e(L).trim(),e(g),e(A)??void 0),s.onSave()}catch(y){const S=y instanceof Error?y.message:"Failed to save event";S.includes("400")||S.includes("validation")?t(v,"Invalid event data. Please check your input and try again."):S.includes("500")||S.includes("server")?t(v,"Server error. Please try again later."):S.includes("annotation_type")?t(v,"Invalid annotation data. Please check your entries and try again."):t(v,S,!0)}finally{t(C,!1)}}}function ye(){t(v,null),t(C,!1),s.onCancel()}var me=rt(),he=be(me);{var w=y=>{var S=Ur();S.__click=De,S.__keydown=Y;var re=r(S),N=r(re),Ee=r(N),Ie=r(Ee,!0);a(Ee);var Oe=n(Ee,2);Oe.__click=ye;var je=r(Oe);W(je,{icon:"lucide:x",class:"w-5 h-5"}),a(Oe),a(N);var P=n(N,2),c=r(P),K=n(r(c),2);br(K),Ve(K,"maxlength",Q);var p=n(K,2),ee=r(p),ve=r(ee);a(ee);var oe=n(ee,2);{var G=de=>{var j=Lr();o(de,j)},Le=de=>{var j=rt(),te=be(j);{var ne=Fe=>{var Ge=Rr();Ge.textContent="Event text cannot exceed 500 characters",o(Fe,Ge)};h(te,Fe=>{e(L).length>Q&&Fe(ne)},!0)}o(de,j)};h(oe,de=>{e(L).trim().length===0?de(G):de(Le,!1)})}a(p),a(c);var I=n(c,2),d=r(I),l=n(r(d),2),f=r(l);W(f,{icon:"lucide:help-circle",class:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"}),Ue(2),a(l),a(d);var D=n(d,2),O=r(D);O.value=O.__value="discrete";var V=n(O);V.value=V.__value="evolving";var J=n(V);J.value=J.__value="recurring",a(D),a(I);var ke=n(I,2),pe=r(ke),se=n(r(pe),2),Ce=r(se);W(Ce,{icon:"lucide:help-circle",class:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"}),Ue(2),a(se),a(pe);var le=n(pe,2),_e=r(le);_e.value=(_e.__value=null)??"";var E=n(_e);at(E,17,()=>e(m),xt,(de,j)=>{var te=Tr(),ne=r(te,!0);a(te);var Fe={};z(Ge=>{q(ne,Ge),Fe!==(Fe=e(j))&&(te.value=(te.__value=e(j))??"")},[()=>R(e(j))]),o(de,te)}),a(le),a(ke);var M=n(ke,2);{var F=de=>{var j=zr(),te=r(j);W(te,{icon:"lucide:alert-triangle",class:"w-5 h-5 flex-shrink-0"});var ne=n(te,2),Fe=r(ne,!0);a(ne),a(j),z(()=>q(Fe,e(v))),o(de,j)};h(M,de=>{e(v)&&de(F)})}var $=n(M,2),ie=r($);ie.__click=ye;var fe=n(ie,2);fe.__click=X;var Re=r(fe);{var Qe=de=>{var j=Nr(),te=be(j);W(te,{icon:"lucide:loader-2",class:"w-4 h-4 animate-spin"}),Ue(2),o(de,j)},St=de=>{var j=Kr(),te=be(j);W(te,{icon:"lucide:save",class:"w-4 h-4"});var ne=n(te,2),Fe=r(ne,!0);a(ne),z(()=>q(Fe,s.event?"Update":"Create")),o(de,j)};h(Re,de=>{e(C)?de(Qe):de(St,!1)})}a(fe),a($),a(P),a(re),a(S),z(()=>{q(Ie,s.event?"Edit Event":"Create Event"),Oe.disabled=e(C),K.disabled=e(C),q(ve,`${e(H)??""} characters remaining`),D.disabled=e(C),le.disabled=e(C),ie.disabled=e(C),fe.disabled=!e(T)}),na(K,()=>e(L),de=>t(L,de)),Xt(D,()=>e(g),de=>t(g,de)),Xt(le,()=>e(A),de=>t(A,de)),o(y,S)};h(he,y=>{s.open&&y(w)})}o(He,me),Bt()}Ut(["click","keydown"]);var Hr=u("<span><!></span>");function Ya(He,s){let L=At(s,"sizeClass",3,"w-4 h-4");var g=Hr();let A;var C=r(g);W(C,{icon:"lucide:chevron-down",get class(){return L()}}),a(g),z(()=>A=Dt(g,1,`inline-flex ${L()} transition-transform`,null,A,{"-rotate-90":!s.expanded})),o(He,g)}var qr=u('<button class="p-1 text-gray-400 hover:text-gray-600 cursor-grab active:cursor-grabbing" draggable="true" title="Drag to reorder"><!></button>'),Vr=u('<input type="checkbox" class="w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500 cursor-pointer"/>'),Yr=u(`<span title="No 'How Many' entries - fact table incomplete" class="inline-flex items-center"><!></span>`),Xr=u('<span title="Annotations completion status"> <!></span>'),Qr=u('<span class="p-1 rounded bg-green-100 text-green-800 border border-green-300 flex items-center" title="Entities have been generated from this event"><!></span>'),Jr=u('<button class="p-1.5 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded transition-colors" title="Edit event properties (text, type, domain)"><!></button>'),Zr=u('<a class="p-1.5 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors" title="View entities on canvas"><!></a>'),Gr=u('<div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center" role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="delete-event-modal-title"><div class="bg-white rounded-lg shadow-xl p-8 max-w-lg w-full mx-4" role="document" tabindex="-1"><h2 id="delete-event-modal-title" class="text-xl font-semibold text-gray-900 mb-3">Delete Business Event?</h2> <p class="text-sm text-gray-600 mb-8">Are you sure you want to delete this business event? This action cannot be undone.</p> <div class="flex justify-end gap-3"><button class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Cancel</button> <button class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">Delete</button></div></div></div>'),$r=u('<div><div class="flex items-center gap-4"><!> <!> <div class="flex-1 min-w-0 text-sm text-gray-700 leading-relaxed"> </div> <div class="flex items-center gap-2 flex-shrink-0"><!> <!></div> <div class="flex items-center gap-2 flex-shrink-0"><span> </span></div> <div class="flex items-center gap-1 flex-shrink-0"><!> <button class="p-1.5 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors"><!></button> <button><!></button> <!> <button class="p-1.5 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded transition-colors" title="Delete this event"><!></button></div></div></div> <!>',1);function Xa(He,s){Ft(s,!0);let L=At(s,"selected",3,!1),g=At(s,"draggable",3,!1);At(s,"dragOver",3,!1);let A=_(!1);const C=Z(()=>s.event.annotations||{who:[],what:[],when:[],where:[],how:[],how_many:[],why:[]}),v=Z(()=>Object.values(e(C)).filter(E=>E.length>0).length),m=Z(()=>()=>e(v)===0?"bg-gray-100 text-gray-700 border-gray-300":e(v)===7?"bg-green-100 text-green-800 border-green-300":"bg-amber-100 text-amber-800 border-amber-300"),R=Z(()=>e(C).how_many.length>0),Q=Z(()=>e(C).who.length>0||e(C).what.length>0||e(C).when.length>0||e(C).where.length>0||e(C).how.length>0||e(C).why.length>0),k=Z(()=>e(Q)&&e(R)),H=Z(()=>s.event.derived_entities.length>0),T=Z(()=>()=>{switch(s.event.type){case"discrete":return"bg-blue-100 text-blue-800 border-blue-300";case"evolving":return"bg-yellow-100 text-yellow-800 border-yellow-300";case"recurring":return"bg-purple-100 text-purple-800 border-purple-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}});function Y(){t(A,!0)}function De(){Cr(s.event.id).then(()=>{t(A,!1),s.onDelete()}).catch(E=>{console.error("Error deleting event:",E),alert(`Failed to delete event: ${E.message}`)})}function X(){t(A,!1)}function ye(E){E.key==="Escape"&&X()}function me(E){E.target===E.currentTarget&&X()}function he(){return(s.event.derived_entities??[]).map(M=>typeof M=="string"?M:M.entity_id).filter(M=>!!M)}var w=$r(),y=be(w);let S;var re=r(y),N=r(re);{var Ee=E=>{var M=qr(),F=r(M);W(F,{icon:"lucide:grip-vertical",class:"w-4 h-4"}),a(M),z(()=>Ve(M,"aria-label",`Reorder ${s.event.text}`)),lt("dragstart",M,$=>s.onDragStart?.(s.event,$)),lt("dragend",M,()=>s.onDragEnd?.()),o(E,M)};h(N,E=>{g()&&E(Ee)})}var Ie=n(N,2);{var Oe=E=>{var M=Vr();jt(M),M.__change=F=>s.onSelect?.(F.currentTarget.checked),z(()=>{_r(M,L()),Ve(M,"aria-label",`Select ${s.event.text}`)}),o(E,M)};h(Ie,E=>{s.onSelect&&E(Oe)})}var je=n(Ie,2),P=r(je,!0);a(je);var c=n(je,2),K=r(c);{var p=E=>{var M=Xr(),F=r(M),$=n(F);{var ie=fe=>{var Re=Yr(),Qe=r(Re);W(Qe,{icon:"lucide:alert-triangle",class:"w-3 h-3 text-amber-600"}),a(Re),o(fe,Re)};h($,fe=>{e(R)||fe(ie)})}a(M),z(fe=>{Dt(M,1,`px-2 py-1 rounded text-xs font-medium border ${fe??""} flex items-center gap-1`),q(F,`${e(v)??""}/7 `)},[()=>e(m)()]),o(E,M)};h(K,E=>{e(v)>0&&E(p)})}var ee=n(K,2);{var ve=E=>{var M=Qr(),F=r(M);W(F,{icon:"lucide:check-circle",class:"w-3.5 h-3.5"}),a(M),o(E,M)};h(ee,E=>{e(H)&&E(ve)})}a(c);var oe=n(c,2),G=r(oe),Le=r(G,!0);a(G),a(oe);var I=n(oe,2),d=r(I);{var l=E=>{var M=Jr();M.__click=()=>s.onEditEvent(s.event);var F=r(M);W(F,{icon:"lucide:edit",class:"w-4 h-4"}),a(M),o(E,M)};h(d,E=>{s.onEditEvent&&E(l)})}var f=n(d,2);f.__click=()=>s.onEditSevenWs(s.event);var D=r(f);W(D,{icon:"lucide:highlighter",class:"w-4 h-4"}),a(f);var O=n(f,2);O.__click=()=>s.onGenerateEntities(s.event);let V;var J=r(O);W(J,{icon:"lucide:sparkles",class:"w-4 h-4"}),a(O);var ke=n(O,2);{var pe=E=>{var M=Zr(),F=r(M);W(F,{icon:"lucide:layout-dashboard",class:"w-4 h-4"}),a(M),z(($,ie)=>Ve(M,"href",`/canvas?entities=${$??""}&eventText=${ie??""}`),[()=>he().join(","),()=>encodeURIComponent(s.event.text)]),o(E,M)};h(ke,E=>{e(H)&&E(pe)})}var se=n(ke,2);se.__click=Y;var Ce=r(se);W(Ce,{icon:"lucide:trash-2",class:"w-4 h-4"}),a(se),a(I),a(re),a(y);var le=n(y,2);{var _e=E=>{var M=Gr();M.__click=me,M.__keydown=ye;var F=r(M),$=n(r(F),4),ie=r($);ie.__click=X;var fe=n(ie,2);fe.__click=De,a($),a(F),a(M),o(E,M)};h(le,E=>{e(A)&&E(_e)})}z(()=>{S=Dt(y,1,"border-b border-gray-200 bg-white hover:bg-gray-50 transition-colors duration-150 py-3 px-4",null,S,{"bg-primary-50":L(),"border-primary-200":L()}),q(P,s.event.text),Dt(G,1,`px-2 py-1 rounded text-xs font-medium border ${e(T)??""}`),q(Le,s.event.type),Ve(f,"title",e(v)>0?"Edit annotations":"Add annotations (Who, What, When, Where, How, How Many, Why)"),O.disabled=!e(k),V=Dt(O,1,"p-1.5 rounded transition-colors",null,V,{"text-blue-600":e(k),"hover:text-blue-700":e(k),"hover:bg-blue-50":e(k),"text-gray-400":!e(k),"cursor-not-allowed":!e(k),"cursor-pointer":e(k)}),Ve(O,"title",e(k)?"Generate dimensional entities from annotations":e(R)?"Add dimension entries (Who, What, When, Where, How, or Why) to generate entities":"Add 'How Many' entries to generate fact table")}),lt("dragover",y,E=>{s.onDragOver&&(E.preventDefault(),E.stopPropagation(),s.onDragOver(s.event,E))}),lt("drop",y,E=>{s.onDrop&&(E.preventDefault(),E.stopPropagation(),s.onDrop(s.event,E))}),o(He,w),Bt()}Ut(["change","click","keydown"]);var en=u('<div class="bg-gray-50 border-b border-gray-200 px-4 py-3 flex items-center justify-between gap-4" role="group"><div class="flex-1 flex items-center gap-3 min-w-0"><div class="flex flex-col min-w-0"><span class="text-sm font-semibold text-slate-800 truncate"> </span> <span class="text-xs font-medium text-slate-600 uppercase tracking-wide"> </span> <div class="flex items-center gap-2 text-[11px] text-slate-500"><span> </span></div></div></div> <div class="flex items-center gap-1"><button type="button" class="p-1.5 rounded text-gray-600 hover:text-green-600 hover:bg-green-50 transition-colors disabled:text-gray-300 disabled:hover:bg-transparent disabled:cursor-not-allowed" title="Edit process details"><!></button> <button type="button" class="p-1.5 rounded text-gray-600 hover:text-green-600 hover:bg-green-50 transition-colors disabled:text-gray-300 disabled:hover:bg-transparent disabled:cursor-not-allowed" title="Annotate process"><!></button> <button type="button" class="p-1.5 rounded text-gray-600 hover:text-blue-600 hover:bg-blue-50 transition-colors disabled:text-gray-300 disabled:hover:bg-transparent disabled:cursor-not-allowed" title="Generate dimensional entities from process"><!></button> <button type="button" class="p-1.5 rounded text-gray-600 hover:text-blue-600 hover:bg-blue-50 transition-colors disabled:text-gray-300 disabled:hover:bg-transparent disabled:cursor-not-allowed" title="Open process on canvas"><!></button> <button type="button" class="p-1.5 rounded text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition-colors disabled:text-gray-300 disabled:hover:bg-transparent disabled:cursor-not-allowed" title="Resolve process"><!></button></div></div>');function tn(He,s){Ft(s,!0);let L=_(!1);async function g(){if(!(!s.onResolve||e(L))){t(L,!0);try{const Ie=s.onResolve(s.process.id);Ie instanceof Promise&&await Ie}finally{t(L,!1)}}}var A=en(),C=r(A),v=r(C),m=r(v),R=r(m,!0);a(m);var Q=n(m,2),k=r(Q);a(Q);var H=n(Q,2),T=r(H),Y=r(T,!0);a(T),a(H),a(v),a(C);var De=n(C,2),X=r(De),ye=r(X);W(ye,{icon:"lucide:edit",class:"w-4 h-4"}),a(X);var me=n(X,2),he=r(me);W(he,{icon:"lucide:highlighter",class:"w-4 h-4"}),a(me);var w=n(me,2),y=r(w);W(y,{icon:"lucide:sparkles",class:"w-4 h-4"}),a(w);var S=n(w,2),re=r(S);W(re,{icon:"lucide:layout-dashboard",class:"w-4 h-4"}),a(S);var N=n(S,2),Ee=r(N);W(Ee,{icon:"lucide:x",class:"w-4 h-4"}),a(N),a(De),a(A),z(()=>{q(R,s.process.name),q(k,`Process of ${s.eventCount??""} event${s.eventCount===1?"":"s"}`),q(Y,s.process.type),X.disabled=!s.onEdit,me.disabled=!s.onAnnotate,w.disabled=!s.onGenerateEntities,S.disabled=!s.onOpenCanvas,N.disabled=!s.onResolve||e(L)}),lt("click",X,()=>s.onEdit?.()),lt("click",me,()=>s.onAnnotate?.()),lt("click",w,()=>s.onGenerateEntities?.()),lt("click",S,()=>s.onOpenCanvas?.()),lt("click",N,g),o(He,A),Bt()}var an=u('<span class="text-xs text-red-600">Process name is required</span>'),rn=u('<span class="text-xs text-red-600"></span>'),nn=u("<option></option>"),sn=u('<div class="flex items-center gap-3 text-red-700 bg-red-50 border border-red-200 rounded-lg px-4 py-3"><!> <span class="text-sm"> </span></div>'),on=u("<!> <span>Saving...</span>",1),ln=u("<!> <span>Update Process</span>",1),dn=u(`<div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center backdrop-blur-sm" role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="process-edit-modal-title"><div class="bg-white rounded-lg shadow-xl p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto" role="document" tabindex="-1"><div class="flex items-center justify-between mb-6"><h2 id="process-edit-modal-title" class="text-xl font-semibold text-gray-900">Edit Process</h2> <button class="p-2 rounded-md hover:bg-gray-100 text-gray-500" aria-label="Close"><!></button></div> <div class="space-y-4"><div><label for="process-edit-name" class="block text-sm font-medium text-gray-700 mb-2">Process Name</label> <input id="process-edit-name" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed" placeholder="e.g., Customer Order Fulfillment"/> <div class="flex items-center justify-between mt-1"><span class="text-xs text-gray-500"> </span> <!></div></div> <div><div class="flex items-center gap-2 mb-2"><label for="process-edit-type" class="block text-sm font-medium text-gray-700">Process Type</label> <div class="group relative"><!> <div class="absolute left-0 bottom-full mb-2 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-opacity z-10"><div class="space-y-2"><div><strong class="text-blue-300">Discrete:</strong> One-time
                                        events grouped together (e.g., "order fulfillment")</div> <div><strong class="text-yellow-300">Evolving:</strong> Events
                                        that change over time (e.g., "sales opportunity funnel")</div> <div><strong class="text-purple-300">Recurring:</strong> Events
                                        that repeat (e.g., "monthly account statement")</div></div> <div class="absolute left-4 top-full w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"></div></div></div></div> <select id="process-edit-type" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed"><option>Discrete</option><option>Evolving</option><option>Recurring</option></select></div> <div><label for="process-edit-domain" class="block text-sm font-medium text-gray-700 mb-2">Process Domain</label> <input id="process-edit-domain" type="text" list="process-edit-domain-suggestions" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed" placeholder="e.g., Sales (leave blank to unassign)"/> <datalist id="process-edit-domain-suggestions"></datalist></div> <!> <div class="flex justify-end gap-3 pt-4 border-t border-gray-200"><button class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed">Cancel</button> <button class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"><!></button></div></div></div></div>`);function cn(He,s){Ft(s,!0);let L=At(s,"domains",19,()=>[]),g=_(""),A=_("discrete"),C=_(""),v=_(!1),m=_(null);const R=200;let Q=Z(()=>e(g).length),k=Z(()=>R-e(Q)),H=Z(()=>!(!s.process||e(g).trim().length===0||e(g).length>R||!e(A)||e(v)));Rt(()=>{s.open&&(t(g,s.process?.name??"",!0),t(A,s.process?.type??"discrete",!0),t(C,s.process?.domain??"",!0),t(m,null),t(v,!1))});function T(w){w.key==="Escape"?s.onCancel():w.key==="Enter"&&(w.ctrlKey||w.metaKey)&&De()}function Y(w){w.target===w.currentTarget&&s.onCancel()}async function De(){if(s.process){if(e(g).length>R){t(m,`Process name cannot exceed ${R} characters`);return}if(e(H)){t(m,null),t(v,!0);try{const w=e(C).trim(),y={name:e(g).trim(),type:e(A),domain:w.length>0?w:null};await aa(s.process.id,y),s.onSave()}catch(w){const y=w instanceof Error?w.message:"Failed to update process";y.includes("400")||y.includes("validation")?t(m,"Invalid process data. Please check your input and try again."):y.includes("404")||y.includes("not found")?t(m,"Process not found. Please refresh and try again."):y.includes("500")||y.includes("server")?t(m,"Server error. Please try again later."):t(m,y,!0)}finally{t(v,!1)}}}}function X(){t(m,null),t(v,!1),s.onCancel()}var ye=rt(),me=be(ye);{var he=w=>{var y=dn();y.__click=Y,y.__keydown=T;var S=r(y),re=r(S),N=n(r(re),2);N.__click=X;var Ee=r(N);W(Ee,{icon:"lucide:x",class:"w-5 h-5"}),a(N),a(re);var Ie=n(re,2),Oe=r(Ie),je=n(r(Oe),2);jt(je),Ve(je,"maxlength",R);var P=n(je,2),c=r(P),K=r(c);a(c);var p=n(c,2);{var ee=F=>{var $=an();o(F,$)},ve=F=>{var $=rt(),ie=be($);{var fe=Re=>{var Qe=rn();Qe.textContent="Process name cannot exceed 200 characters",o(Re,Qe)};h(ie,Re=>{e(g).length>R&&Re(fe)},!0)}o(F,$)};h(p,F=>{e(g).trim().length===0?F(ee):F(ve,!1)})}a(P),a(Oe);var oe=n(Oe,2),G=r(oe),Le=n(r(G),2),I=r(Le);W(I,{icon:"lucide:help-circle",class:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"}),Ue(2),a(Le),a(G);var d=n(G,2),l=r(d);l.value=l.__value="discrete";var f=n(l);f.value=f.__value="evolving";var D=n(f);D.value=D.__value="recurring",a(d),a(oe);var O=n(oe,2),V=n(r(O),2);jt(V);var J=n(V,2);at(J,21,L,xt,(F,$)=>{var ie=nn(),fe={};z(()=>{fe!==(fe=e($))&&(ie.value=(ie.__value=e($))??"")}),o(F,ie)}),a(J),a(O);var ke=n(O,2);{var pe=F=>{var $=sn(),ie=r($);W(ie,{icon:"lucide:alert-triangle",class:"w-5 h-5 flex-shrink-0"});var fe=n(ie,2),Re=r(fe,!0);a(fe),a($),z(()=>q(Re,e(m))),o(F,$)};h(ke,F=>{e(m)&&F(pe)})}var se=n(ke,2),Ce=r(se);Ce.__click=X;var le=n(Ce,2);le.__click=De;var _e=r(le);{var E=F=>{var $=on(),ie=be($);W(ie,{icon:"lucide:loader-2",class:"w-4 h-4 animate-spin"}),Ue(2),o(F,$)},M=F=>{var $=ln(),ie=be($);W(ie,{icon:"lucide:save",class:"w-4 h-4"}),Ue(2),o(F,$)};h(_e,F=>{e(v)?F(E):F(M,!1)})}a(le),a(se),a(Ie),a(S),a(y),z(()=>{N.disabled=e(v),je.disabled=e(v),q(K,`${e(k)??""} characters remaining`),d.disabled=e(v),V.disabled=e(v),Ce.disabled=e(v),le.disabled=!e(H)}),na(je,()=>e(g),F=>t(g,F)),Xt(d,()=>e(A),F=>t(A,F)),na(V,()=>e(C),F=>t(C,F)),o(w,y)};h(me,w=>{s.open&&w(he)})}o(He,ye),Bt()}Ut(["click","keydown"]);var un=u('<span class="text-xs px-2 py-0.5 bg-gray-100 text-gray-600 rounded"> </span>'),vn=u('<button type="button"><div class="flex items-center justify-between"><div class="flex items-center gap-2"><span class="font-medium text-gray-900"> </span> <span class="text-xs text-gray-500 font-mono"> </span></div> <!></div></button>'),fn=u('<button type="button" class="w-full text-left px-3 py-2 text-sm text-blue-600 hover:bg-blue-50 focus:bg-blue-50 focus:outline-none border-t border-gray-200"><div class="flex items-center gap-2"><!> <span>Create new dimension: <strong> </strong></span></div></button>'),gn=u('<div class="bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto" role="listbox"><!> <!></div>'),bn=u('<div class="relative"><input type="text" class="w-full px-3 py-2 pr-8 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed text-sm"/> <!> <!></div>');function mn(He,s){Ft(s,!0);let L=At(s,"allowedIds",3,null),g=At(s,"disabled",3,!1),A=At(s,"placeholder",3,"Select or create dimension..."),C=At(s,"loading",3,!1),v=_(!1),m=_(""),R=_(0),Q=_(void 0),k=_(void 0),H=_(""),T=Z(()=>s.dimensions.filter(c=>{if(L()&&!L().has(c.id)||s.filterBy&&c.annotation_type&&c.annotation_type!==s.filterBy)return!1;const K=e(m).toLowerCase();return c.label.toLowerCase().includes(K)||c.id.toLowerCase().includes(K)})),Y=Z(()=>e(T).find(c=>c.label.toLowerCase()===e(m).toLowerCase())),De=Z(()=>e(v)&&(e(T).length>0||e(m).trim()&&!e(Y)));function X(){t(v,!0),t(R,0)}function ye(){setTimeout(()=>{t(v,!1)},200)}function me(){t(v,!0),t(R,0),s.onTextChange(e(m))}function he(c){t(m,c.label,!0),s.onTextChange(c.label),s.onSelectDimension&&s.onSelectDimension(c),t(v,!1)}function w(){e(m).trim()&&s.onCreateNew&&(s.onCreateNew(e(m).trim()),t(m,""),t(v,!1))}function y(c){if(c.key==="Escape")t(v,!1),c.preventDefault();else if(c.key==="ArrowDown"){if(e(v)){c.preventDefault();const K=e(T).length+(e(m).trim()&&!e(Y)?1:0)-1;t(R,Math.min(e(R)+1,K),!0)}}else c.key==="ArrowUp"?e(v)&&(c.preventDefault(),t(R,Math.max(e(R)-1,0),!0)):c.key==="Enter"&&e(v)&&(c.preventDefault(),e(R)<e(T).length?he(e(T)[e(R)]):e(m).trim()&&s.onCreateNew&&w())}Rt(()=>{function c(K){e(Q)&&!e(Q).contains(K.target)&&t(v,!1)}return e(v)&&document.addEventListener("click",c),()=>{document.removeEventListener("click",c)}});function S(){if(!e(k))return;const c=e(k).getBoundingClientRect();t(H,`position:fixed;left:${c.left}px;top:${c.bottom+4}px;width:${c.width}px;z-index:60;`)}Rt(()=>{if(!e(v))return;S();const c=()=>S();return window.addEventListener("resize",c),window.addEventListener("scroll",c,!0),()=>{window.removeEventListener("resize",c),window.removeEventListener("scroll",c,!0)}}),Rt(()=>{!e(v)&&s.textValue!==e(m)&&t(m,s.textValue||"",!0)});var re=bn(),N=r(re);jt(N),N.__input=me,N.__keydown=y,Ha(N,c=>t(k,c),()=>e(k));var Ee=n(N,2);{var Ie=c=>{W(c,{icon:"lucide:loader-2","data-icon":"lucide:loader-2",class:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 animate-spin"})},Oe=c=>{W(c,{icon:"lucide:search",class:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"})};h(Ee,c=>{C()?c(Ie):c(Oe,!1)})}var je=n(Ee,2);{var P=c=>{var K=gn();K.__mousedown=oe=>oe.preventDefault();var p=r(K);at(p,17,()=>e(T),xt,(oe,G,Le)=>{var I=vn();I.__mousedown=()=>he(e(G)),I.__keydown=pe=>pe.key==="Enter"&&he(e(G));var d=r(I),l=r(d),f=r(l),D=r(f,!0);a(f);var O=n(f,2),V=r(O,!0);a(O),a(l);var J=n(l,2);{var ke=pe=>{var se=un(),Ce=r(se,!0);a(se),z(()=>q(Ce,e(G).annotation_type)),o(pe,se)};h(J,pe=>{e(G).annotation_type&&pe(ke)})}a(d),a(I),z(()=>{Dt(I,1,`w-full text-left px-3 py-2 text-sm hover:bg-blue-50 focus:bg-blue-50 focus:outline-none ${Le===e(R)?"bg-blue-50":""}`),q(D,e(G).label),q(V,e(G).id)}),o(oe,I)});var ee=n(p,2);{var ve=oe=>{var G=fn();G.__mousedown=w,G.__keydown=D=>D.key==="Enter"&&w();var Le=r(G),I=r(Le);W(I,{icon:"lucide:plus-circle",class:"w-4 h-4"});var d=n(I,2),l=n(r(d)),f=r(l);a(l),a(d),a(Le),a(G),z(()=>q(f,`"${e(m)??""}"`)),o(oe,G)};h(ee,oe=>{e(m).trim()&&!e(Y)&&s.onCreateNew&&oe(ve)})}a(K),z(()=>yr(K,e(H))),o(c,K)};h(je,c=>{e(De)&&c(P)})}a(re),Ha(re,c=>t(Q,c),()=>e(Q)),z(()=>{Ve(N,"placeholder",A()),N.disabled=g()||C()}),lt("focus",N,X),lt("blur",N,ye),na(N,()=>e(m),c=>t(m,c)),o(He,re),Bt()}Ut(["input","keydown","mousedown"]);var pn=u('<span class="text-xs bg-gray-200 text-gray-700 px-2 py-0.5 rounded-full svelte-14nc609"> </span>'),_n=u('<div class="space-y-3 svelte-14nc609"><div class="flex items-start gap-2 p-3 bg-gray-50 rounded-md svelte-14nc609"><div class="flex-1 space-y-2 svelte-14nc609"><div class="h-10 bg-gray-200 rounded animate-pulse svelte-14nc609"></div> <div class="h-6 bg-gray-200 rounded w-3/4 animate-pulse svelte-14nc609"></div></div> <div class="w-8 h-8 bg-gray-200 rounded-md animate-pulse svelte-14nc609"></div></div></div>'),yn=u('<input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm svelte-14nc609"/>'),hn=u('<div class="flex items-start gap-2 p-3 bg-gray-50 rounded-md svelte-14nc609"><div class="flex-1 space-y-2 svelte-14nc609"><!> <input type="text" placeholder="Optional description..." class="w-full px-3 py-2 border border-gray-200 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-xs text-gray-600 svelte-14nc609"/></div> <button class="p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-md transition-colors mt-1 svelte-14nc609" aria-label="Remove entry" title="Remove entry"><!></button></div>'),xn=u('<div class="text-center py-6 text-gray-400 text-sm svelte-14nc609">No entries yet. Click "Add Entry" to add one.</div>'),wn=u('<div class="p-4 space-y-3 rounded-b-lg svelte-14nc609"><!> <button type="button" class="w-full py-2 px-4 border-2 border-dashed border-gray-300 rounded-md text-sm font-medium text-gray-600 hover:border-blue-400 hover:text-blue-600 hover:bg-blue-50 transition-colors flex items-center justify-center gap-2 svelte-14nc609"><!> <span class="svelte-14nc609">Add Entry</span></button></div>'),En=u('<div class="border border-gray-200 rounded-lg overflow-visible svelte-14nc609"><button class="w-full flex items-center justify-between px-4 py-3 bg-gray-50 hover:bg-gray-100 transition-colors rounded-t-lg svelte-14nc609"><div class="flex items-center gap-3 svelte-14nc609"><div><!></div> <div class="text-left svelte-14nc609"><div class="flex items-center gap-2 svelte-14nc609"><span class="font-medium text-gray-900 svelte-14nc609"> </span> <!></div> <p class="text-xs text-gray-500 svelte-14nc609"> </p></div></div> <div class="flex items-center gap-2 svelte-14nc609"><div class="group relative svelte-14nc609"><!> <div class="absolute right-0 bottom-full mb-2 w-72 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-opacity z-50 whitespace-pre-line text-left svelte-14nc609"><div class="font-semibold mb-1 svelte-14nc609">Common Examples:</div> <div class="absolute right-4 top-full w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900 svelte-14nc609"></div></div></div> <!></div></button> <!></div>'),kn=u('<li class="text-sm text-amber-700 svelte-14nc609"> </li>'),Cn=u(`<div class="bg-amber-50 border border-amber-200 rounded-lg p-4 space-y-2 svelte-14nc609"><div class="flex items-center gap-2 text-amber-800 font-medium svelte-14nc609"><!> <span class="svelte-14nc609">Entity Generation Requirements</span></div> <ul class="space-y-1 pl-7 svelte-14nc609"></ul> <p class="text-xs text-amber-600 mt-2 svelte-14nc609">You can still save the event, but you won't be able to generate entities until these requirements are met.</p></div>`),Dn=u('<div class="flex items-center gap-3 text-red-700 bg-red-50 border border-red-200 rounded-lg px-4 py-3 svelte-14nc609"><!> <span class="text-sm svelte-14nc609"> </span></div>'),Sn=u('<!> <span class="svelte-14nc609">Saving...</span>',1),Pn=u('<!> <span class="svelte-14nc609">Save Annotations</span>',1),In=u('<div class="fixed top-4 right-4 z-[70] bg-green-100 border border-green-300 rounded-lg px-6 py-4 shadow-xl flex items-center gap-3 animate-slide-in svelte-14nc609" role="alert" aria-live="polite"><!> <span class="text-sm font-medium text-green-800 svelte-14nc609">Annotations saved successfully!</span></div>'),Mn=u('<div class="fixed inset-0 bg-black bg-opacity-50 z-[60] flex items-center justify-center svelte-14nc609" role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="delete-entry-modal-title"><div class="bg-white rounded-lg shadow-xl p-8 max-w-lg w-full mx-4 svelte-14nc609" role="document" tabindex="-1"><h2 id="delete-entry-modal-title" class="text-xl font-semibold text-gray-900 mb-3 svelte-14nc609">Delete Entry?</h2> <p class="text-sm text-gray-600 mb-6 svelte-14nc609"><!></p> <div class="flex justify-end gap-3 svelte-14nc609"><button class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 svelte-14nc609">Cancel</button> <button class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 svelte-14nc609">Delete</button></div></div></div> <!>',1),An=u('<div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center backdrop-blur-sm svelte-14nc609" role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="seven-ws-modal-title"><div class="bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto svelte-14nc609" role="document" tabindex="-1"><div class="flex items-center justify-between p-6 border-b border-gray-200 svelte-14nc609"><div class="flex items-center gap-3 svelte-14nc609"><div class="svelte-14nc609"><h2 id="seven-ws-modal-title" class="text-xl font-semibold text-gray-900 svelte-14nc609">Annotations - Business Event</h2> <p class="text-sm text-gray-500 mt-1 svelte-14nc609"> </p></div></div> <div class="flex items-center gap-3 svelte-14nc609"><div> </div> <button class="p-2 rounded-md hover:bg-gray-100 text-gray-500 svelte-14nc609" aria-label="Close"><!></button></div></div> <div class="p-6 space-y-4 svelte-14nc609"><!> <!> <!> <div class="flex justify-between items-center pt-4 border-t border-gray-200 svelte-14nc609"><p class="text-xs text-gray-500 svelte-14nc609">Press Ctrl+Enter to save</p> <div class="flex gap-3 svelte-14nc609"><button class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed svelte-14nc609">Cancel</button> <button class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 svelte-14nc609"><!></button></div></div></div></div></div> <!>',1);function Qa(He,s){Ft(s,!0);const L=[{type:"who",label:"Who",icon:"lucide:user",placeholder:"e.g., customer, employee, supplier",description:"People and organizations involved",tooltip:`1. Customer
2. Employee (Salesperson, Technician)
3. Supplier`},{type:"what",label:"What",icon:"lucide:box",placeholder:"e.g., product, service, order",description:"The things or objects being acted upon",tooltip:`1. Product (SKU)
2. Service (Consulting, Warranty)
3. Digital Asset (Web page, App feature)`},{type:"when",label:"When",icon:"lucide:calendar",placeholder:"e.g., order date, delivery time",description:"Defining points in time or timestamps",tooltip:`1. Order Date
2. Delivery Due Date
3. Treatment Time (Clock Dimension)`},{type:"where",label:"Where",icon:"lucide:map-pin",placeholder:"e.g., store location, region",description:"Specific locations or virtual addresses",tooltip:`1. Retail Store
2. Website URL
3. Delivery Address`},{type:"how",label:"How",icon:"lucide:settings",placeholder:"e.g., online, in-store, phone",description:"The method, manner, or status",tooltip:`1. Order Channel (Online, In-store, Phone)
2. Payment Method (Credit card, PO)
3. Call Status (Connected, Busy)`},{type:"why",label:"Why",icon:"lucide:help-circle",placeholder:"e.g., campaign, season, promotion",description:"Reasons, causal factors, or context",tooltip:`1. Promotion (Discount code, Campaign)
2. Weather conditions
3. Problem/Return Reason`},{type:"how_many",label:"How Many",icon:"lucide:bar-chart-3",placeholder:"e.g., quantity, amount, revenue",description:"Quantitative measures (becoming the fact table)",tooltip:`1. Quantity Sold
2. Revenue Amount
3. Number of Items`}];let g=_(ht(s.event.annotations||{who:[],what:[],when:[],where:[],how:[],how_many:[],why:[]})),A=_(!1),C=_(null),v=_(!1),m=_(null),R=_(ht([])),Q=_(!1),k=_(!1),H=_(null),T=_(!1),Y=_(null),De=_(!1),X=ht({who:!1,what:!1,when:!1,where:!1,how:!1,how_many:!1,why:!1}),ye=ht({}),me=Z(()=>L.filter(d=>e(g)[d.type].length>0).length),he=Z(()=>{if(!e(R)||e(R).length===0)return[];const d=[];for(const l of L.filter(f=>f.type!=="how_many"))for(const f of e(g)[l.type])if(f.dimension_id){const D=e(R).find(O=>O.id===f.dimension_id);D&&D.annotation_type&&D.annotation_type!==l.type&&d.push({entryId:f.id,dimensionId:f.dimension_id,dimensionLabel:D.label})}return d}),w=Z(()=>{const d=[],l=L.filter(V=>V.type!=="how_many").reduce((V,J)=>V+e(g)[J.type].length,0),f=e(g).how_many.length;l===0&&d.push("At least one dimension entry (Who, What, When, Where, How, or Why) is required for entity generation"),f===0&&d.push("At least one 'How Many' entry is required for entity generation (becomes fact table)");const D=L.filter(V=>V.type!=="how_many").flatMap(V=>e(g)[V.type].map(J=>J.dimension_id)).filter(V=>V!==void 0),O=new Set(D);if(D.length!==O.size){const V=D.filter(ke=>D.filter(se=>se===ke).length>1),J=Array.from(new Set(V));d.push(`Duplicate dimension reference(s) detected: ${J.join(", ")}. Each dimension should only be used once per event.`)}if(e(he).length>0){const V=e(he).map(J=>`"${J.dimensionLabel}" (used in ${J.dimensionId})`).join(", ");d.push(`Dimension type mismatch detected: ${V}. Please review dimension assignments.`)}return d}),y=Z(()=>e(w).length===0&&!e(v));Rt(()=>{t(g,s.event.annotations||{who:[],what:[],when:[],where:[],how:[],how_many:[],why:[]},!0),t(v,!1),t(m,null),t(C,null)}),Ja(async()=>{let d=0;const l=2,f=O=>O.toLowerCase().replace(/[^a-z0-9]+/g," ").trim();async function D(){try{t(Q,!0),t(R,await Dr(),!0),t(k,!0);const O=await ua(),V=new Map;e(R).forEach(se=>{V.set(se.id,se)});const J=se=>f(se.label||se.id),ke=se=>{const Ce=f(se);for(const le of e(R))if(J(le)===Ce)return le.id;return null},pe={who:new Set,what:new Set,when:new Set,where:new Set,how:new Set,how_many:new Set,why:new Set};for(const se of O){const Ce=se.annotations;if(Ce)for(const le of Object.keys(pe))for(const _e of Ce[le]||[]){if(_e.dimension_id&&V.has(_e.dimension_id)){pe[le].add(_e.dimension_id);continue}if(_e.text){const E=ke(_e.text);E&&pe[le].add(E)}}}t(H,pe,!0),t(v,!1),t(m,null)}catch(O){d++,console.error(`Failed to load dimensions (attempt ${d}):`,O),d<l?setTimeout(D,1e3*d):(t(v,!0),t(m,O instanceof Error?"Failed to load dimensions after multiple attempts. Please refresh the page.":"Failed to load dimensions. Please refresh the page.",!0),t(C,e(m),!0),t(R,[],!0))}finally{(d>=l||!e(v))&&(t(Q,!1),t(k,!1))}}await D()});function S(d){d.target===d.currentTarget&&s.onCancel()}function re(d){d.key==="Escape"?s.onCancel():d.key==="Enter"&&(d.ctrlKey||d.metaKey)&&ve()}function N(d){X[d]=!X[d]}function Ee(d){const l={id:`new_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:"",description:"",dimension_id:void 0};t(g,{...e(g),[d]:[...e(g)[d],l]},!0),ye[l.id]={text:"",description:""},X[d]=!1}function Ie(d,l){const f=e(g)[d].find(D=>D.id===l);f&&f.dimension_id?(t(Y,{annotationType:d,entryId:l},!0),t(T,!0)):Oe(d,l)}function Oe(d,l){t(g,{...e(g),[d]:e(g)[d].filter(f=>f.id!==l)},!0),delete ye[l]}function je(){e(Y)&&Oe(e(Y).annotationType,e(Y).entryId),t(T,!1),t(Y,null)}function P(){t(T,!1),t(Y,null)}function c(d,l,f,D=!0){ye[l]={...ye[l],text:f},t(g,{...e(g),[d]:e(g)[d].map(O=>O.id===l?{...O,text:f,dimension_id:D?void 0:O.dimension_id}:O)},!0)}function K(d,l,f){ye[l]={...ye[l],description:f},t(g,{...e(g),[d]:e(g)[d].map(D=>D.id===l?{...D,description:f}:D)},!0)}function p(d,l,f){ye[l]={...ye[l],dimension_id:f},t(g,{...e(g),[d]:e(g)[d].map(D=>D.id===l?{...D,dimension_id:f||void 0}:D)},!0)}function ee(d,l,f){c(d,l,f,!0)}async function ve(){t(C,null),t(m,null),t(v,!1),t(A,!0);try{for(const l of L)for(const f of e(g)[l.type]){if(!f.text.trim())throw new Error(`All entries must have text. Please check the ${l.label} section.`);if(f.text.trim().length>200)throw new Error(`Entry text in ${l.label} exceeds 200 characters. Please shorten it.`)}const d={...s.event,annotations:e(g),updated_at:new Date().toISOString()};s.onSave(d),t(De,!0),setTimeout(()=>{t(De,!1)},3e3)}catch(d){const l=d instanceof Error?d:new Error("Unknown error occurred");t(C,l.message,!0),t(m,l.message,!0),t(v,!0),l.message.includes("network")||l.message.includes("fetch")||l.name==="TypeError"?t(C,"Network error occurred while saving. Please check your connection and try again."):l.message.includes("timeout")?t(C,"Request timed out. Please try again."):l.message.includes("validation")||l.message.includes("validate")?t(C,l.message,!0):t(C,l.message||"Failed to save 7 Ws. Please try again.",!0)}finally{t(A,!1)}}function oe(){t(C,null),t(A,!1),s.onCancel()}var G=rt(),Le=be(G);{var I=d=>{var l=An(),f=be(l);f.__click=S,f.__keydown=re;var D=r(f),O=r(D),V=r(O),J=r(V),ke=n(r(J),2),pe=r(ke,!0);a(ke),a(J),a(V);var se=n(V,2),Ce=r(se),le=r(Ce);a(Ce);var _e=n(Ce,2);_e.__click=oe;var E=r(_e);W(E,{icon:"lucide:x",class:"w-5 h-5"}),a(_e),a(se),a(O);var M=n(O,2),F=r(M);at(F,17,()=>L,xt,(Me,U)=>{var Te=En(),Ze=r(Te);Ze.__click=()=>N(e(U).type);var ce=r(Ze),ge=r(ce),ze=r(ge);W(ze,{get icon(){return e(U).icon},class:"w-5 h-5"}),a(ge);var Ye=n(ge,2),Be=r(Ye),Se=r(Be),Je=r(Se,!0);a(Se);var nt=n(Se,2);{var $e=it=>{var mt=pn(),Zt=r(mt,!0);a(mt),z(()=>q(Zt,e(g)[e(U).type].length)),o(it,mt)};h(nt,it=>{e(g)[e(U).type].length>0&&it($e)})}a(Be);var Ae=n(Be,2),et=r(Ae,!0);a(Ae),a(Ye),a(ce);var dt=n(ce,2),tt=r(dt),bt=r(tt);W(bt,{icon:"lucide:info",class:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"});var Tt=n(bt,2),ct=n(r(Tt));Ue(),a(Tt),a(tt);var Pt=n(tt,2);{let it=Z(()=>X[e(U).type]?"lucide:chevron-down":"lucide:chevron-up");W(Pt,{get icon(){return e(it)},class:"w-5 h-5 text-gray-500 transition-transform"})}a(dt),a(Ze);var Qt=n(Ze,2);{var Jt=it=>{var mt=wn(),Zt=r(mt);{var va=b=>{var x=_n();o(b,x)},fa=b=>{var x=rt(),ae=be(x);{var We=ue=>{var Pe=rt(),st=be(Pe);at(st,17,()=>e(g)[e(U).type],xt,(pt,ut)=>{var Wt=hn(),$t=r(Wt),ea=r($t);{var sa=wt=>{var Et=yn();jt(Et),Et.__input=Nt=>c(e(U).type,e(ut).id,Nt.currentTarget.value),Ve(Et,"maxlength",200),z(()=>{_a(Et,e(ut).text),Ve(Et,"placeholder",e(U).placeholder),Et.disabled=e(A)}),o(wt,Et)},ha=wt=>{{let Et=Z(()=>e(H)?e(H)[e(U).type]:null),Nt=Z(()=>e(Q)||e(k));mn(wt,{get textValue(){return e(ut).text},onTextChange:Kt=>ee(e(U).type,e(ut).id,Kt),onSelectDimension:Kt=>{c(e(U).type,e(ut).id,Kt.label,!1),p(e(U).type,e(ut).id,Kt.id)},get dimensions(){return e(R)},get filterBy(){return e(U).type},get allowedIds(){return e(Et)},get placeholder(){return e(U).placeholder},get disabled(){return e(A)},get loading(){return e(Nt)}})}};h(ea,wt=>{e(U).type==="how_many"?wt(sa):wt(ha,!1)})}var It=n(ea,2);jt(It),It.__input=wt=>K(e(U).type,e(ut).id,wt.currentTarget.value),Ve(It,"maxlength",500),a($t);var zt=n($t,2);zt.__click=()=>Ie(e(U).type,e(ut).id);var ia=r(zt);W(ia,{icon:"lucide:trash-2",class:"w-4 h-4"}),a(zt),a(Wt),z(()=>{_a(It,e(ut).description||""),It.disabled=e(A),zt.disabled=e(A)}),o(pt,Wt)}),o(ue,Pe)},B=ue=>{var Pe=xn();o(ue,Pe)};h(ae,ue=>{e(g)[e(U).type].length>0?ue(We):ue(B,!1)},!0)}o(b,x)};h(Zt,b=>{e(Q)&&e(g)[e(U).type].length===0?b(va):b(fa,!1)})}var Gt=n(Zt,2);Gt.__click=()=>Ee(e(U).type);var i=r(Gt);W(i,{icon:"lucide:plus",class:"w-4 h-4"}),Ue(2),a(Gt),a(mt),z(()=>{Ve(mt,"id",`section-${e(U).type}`),Gt.disabled=e(A)}),o(it,mt)};h(Qt,it=>{X[e(U).type]||it(Jt)})}a(Te),z(()=>{Ve(Ze,"aria-expanded",!X[e(U).type]),Ve(Ze,"aria-controls",`section-${e(U).type}`),Dt(ge,1,`p-2 rounded-md ${e(U).type==="how_many"?"bg-blue-100 text-blue-900":"bg-green-100 text-green-900"}`,"svelte-14nc609"),q(Je,e(U).label),q(et,e(U).description),q(ct,` ${e(U).tooltip??""} `)}),o(Me,Te)});var $=n(F,2);{var ie=Me=>{var U=Cn(),Te=r(U),Ze=r(Te);W(Ze,{icon:"lucide:alert-triangle",class:"w-5 h-5"}),Ue(2),a(Te);var ce=n(Te,2);at(ce,21,()=>e(w),xt,(ge,ze,Ye,Be)=>{var Se=kn(),Je=r(Se);a(Se),z(()=>q(Je,`â€¢ ${e(ze)??""}`)),o(ge,Se)}),a(ce),Ue(2),a(U),o(Me,U)};h($,Me=>{e(w).length>0&&Me(ie)})}var fe=n($,2);{var Re=Me=>{var U=Dn(),Te=r(U);W(Te,{icon:"lucide:alert-circle",class:"w-5 h-5 flex-shrink-0"});var Ze=n(Te,2),ce=r(Ze,!0);a(Ze),a(U),z(()=>q(ce,e(C))),o(Me,U)};h(fe,Me=>{e(C)&&Me(Re)})}var Qe=n(fe,2),St=n(r(Qe),2),de=r(St);de.__click=oe;var j=n(de,2);j.__click=ve;var te=r(j);{var ne=Me=>{var U=Sn(),Te=be(U);W(Te,{icon:"lucide:loader-2",class:"w-4 h-4 animate-spin"}),Ue(2),o(Me,U)},Fe=Me=>{var U=Pn(),Te=be(U);W(Te,{icon:"lucide:save",class:"w-4 h-4"}),Ue(2),o(Me,U)};h(te,Me=>{e(A)?Me(ne):Me(Fe,!1)})}a(j),a(St),a(Qe),a(M),a(D),a(f);var Ge=n(f,2);{var kt=Me=>{var U=Mn(),Te=be(U);Te.__click=Ae=>{Ae.target===Ae.currentTarget&&P()};var Ze=r(Te),ce=n(r(Ze),2),ge=r(ce);{var ze=Ae=>{const et=Z(()=>e(g)[e(Y).annotationType].find(tt=>tt.id===e(Y).entryId));var dt=za();z(()=>q(dt,`This entry has a dimension reference (${e(et)?.dimension_id??""}). Deleting it will remove the reference from the dimension entity. This action cannot be undone.`)),o(Ae,dt)},Ye=Ae=>{var et=za("This entry cannot be undone. Are you sure you want to delete it?");o(Ae,et)};h(ge,Ae=>{e(Y)&&e(Y).annotationType?Ae(ze):Ae(Ye,!1)})}a(ce);var Be=n(ce,2),Se=r(Be);Se.__click=P;var Je=n(Se,2);Je.__click=je,a(Be),a(Ze),a(Te);var nt=n(Te,2);{var $e=Ae=>{var et=In(),dt=r(et);W(dt,{icon:"lucide:check-circle",class:"w-5 h-5 text-green-600"}),Ue(2),a(et),o(Ae,et)};h(nt,Ae=>{e(De)&&Ae($e)})}o(Me,U)};h(Ge,Me=>{e(T)&&Me(kt)})}z(()=>{q(pe,s.event.text),Dt(Ce,1,`px-3 py-1 rounded-full text-sm font-medium ${e(y)?"bg-green-100 text-green-800":"bg-amber-100 text-amber-800"}`,"svelte-14nc609"),q(le,`${e(me)??""}/7 completed`),_e.disabled=e(A),de.disabled=e(A),j.disabled=e(A)}),o(d,l)};h(Le,d=>{d(I)})}o(He,G),Bt()}Ut(["click","keydown","input"]);var jn=u('<div class="flex items-center justify-center py-12"><div class="text-center"><div class="w-8 h-8 animate-spin border-4 border-primary-600 border-t-transparent rounded-full mx-auto mb-2"></div> <p class="text-sm text-gray-600">Generating preview...</p></div></div>'),Fn=u('<div class="bg-red-50 border border-red-200 rounded p-4 mb-4"><div class="flex items-center gap-2"><!> <p class="text-sm text-red-800"> </p></div></div> <div class="flex justify-end gap-2"><button class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">Close</button></div>',1),Bn=u('<div class="bg-green-50 border border-green-200 rounded p-4 mb-4"><div class="flex items-center gap-2"><!> <p class="text-sm text-green-800">Entities created successfully!</p></div></div>'),Wn=u("<li> </li>"),On=u('<div class="bg-red-50 border border-red-200 rounded p-4"><div class="flex items-start gap-2"><!> <div class="flex-1"><p class="text-sm font-medium text-red-800 mb-1">Validation Errors:</p> <ul class="text-sm text-red-700 list-disc list-inside"></ul></div></div></div>'),Ln=u('<div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4"><div class="flex items-start gap-2"><!> <p class="text-sm text-blue-800"><strong>Domain Tag:</strong> All entities will inherit the "<span class="font-mono font-semibold"> </span> </p></div></div>'),Rn=u('<span class="px-2 py-0.5 bg-blue-50 text-blue-700 text-xs rounded border border-blue-200 font-mono" title="Inherited tag from event domain"> </span>'),Tn=u('<div class="flex flex-wrap gap-1"></div>'),zn=u('<span class="text-xs text-gray-400">â€”</span>'),Nn=u('<tr class="hover:bg-gray-50"><td class="px-4 py-3"><span> </span></td><td class="px-4 py-3"><input type="text" class="w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Entity name"/></td><td class="px-4 py-3"><input type="text" class="w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Display label"/></td><td class="px-4 py-3"><!></td></tr>'),Kn=u('<span class="text-gray-500 ml-2"> </span>'),Un=u('<p class="text-sm text-gray-600"><span class="font-mono"> </span> <span class="mx-2">â†’</span> <span class="font-mono"> </span> <!></p>'),Hn=u('<div class="bg-gray-50 border border-gray-200 rounded-lg p-4"><h3 class="text-sm font-medium text-gray-700 mb-2">Relationships:</h3> <div class="space-y-1"></div></div>'),qn=u('<div class="w-4 h-4 animate-spin border-2 border-white border-t-transparent rounded-full"></div> <span>Creating...</span>',1),Vn=u("<!> <span>Create All</span>",1),Yn=u('<div class="space-y-4"><!> <!> <div class="border border-gray-200 rounded-lg overflow-hidden"><table class="w-full"><thead class="bg-gray-50 border-b border-gray-200"><tr><th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase">Entity Type</th><th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase">Name</th><th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase">Label</th><th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase">Tags</th></tr></thead><tbody class="bg-white divide-y divide-gray-200"></tbody></table></div> <!> <div class="flex justify-end gap-2 pt-4 border-t border-gray-200"><button class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">Cancel</button> <button class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2"><!></button></div></div>'),Xn=u('<div class="text-center py-8 text-gray-500"><p>No entities to generate. Please add annotations to the event first.</p></div> <div class="flex justify-end gap-2 pt-4"><button class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">Close</button></div>',1),Qn=u('<div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center" role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="generate-entities-dialog-title"><div class="bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto" role="document" tabindex="-1"><div class="flex items-center justify-between mb-4"><h2 id="generate-entities-dialog-title" class="text-xl font-semibold text-gray-900"> </h2> <button class="p-1 text-gray-400 hover:text-gray-600 rounded transition-colors" title="Close"><!></button></div> <!></div></div>');function Jn(He,s){Ft(s,!0);const L=()=>pa(Ka,"$nodes",C),g=()=>pa(Sa,"$edges",C),A=()=>pa(Ia,"$modelingStyle",C),[C,v]=Za(),m=Z(()=>s.event?"event":s.process?"process":null);let R=_(!1),Q=_(null),k=_(null),H=_(ht([])),T=_(ht([])),Y=_(!1),De=_(!1);const X=new Wr;Rt(()=>{s.open&&e(m)?ye():s.open||Na(()=>{t(k,null),t(H,[],!0),t(T,[],!0),t(Q,null),t(De,!1)})});async function ye(){if(e(m))try{if(t(R,!0),t(Q,null),e(m)==="event"&&s.event)t(k,await Sr(s.event.id),!0);else if(e(m)==="process"&&s.process)t(k,await Pr(s.process.id),!0);else return;t(H,e(k).entities.map(P=>({id:P.id,label:P.label,entity_type:P.entity_type,tags:P.tags||[]})),!0)}catch(P){t(Q,P instanceof Error?P.message:"Failed to generate preview",!0),console.error("Error generating preview:",e(Q))}finally{t(R,!1)}}function me(P,c){e(H)[P]={...e(H)[P],id:c},w()}function he(P,c){e(H)[P]={...e(H)[P],label:c},w()}function w(){t(T,[],!0);const P=e(H).filter(p=>p.entity_type==="dimension"),c=e(H).filter(p=>p.entity_type==="fact");P.length===0&&e(T).push("At least one dimension is required"),c.length===0&&e(T).push("At least one fact is required");for(let p=0;p<e(H).length;p++)(!e(H)[p].id||!e(H)[p].id.trim())&&e(T).push(`Entity ${p+1} name cannot be empty`);const K=new Map;for(let p=0;p<e(H).length;p++){const ee=e(H)[p].id.trim();ee&&K.set(ee,(K.get(ee)||0)+1)}for(const[p,ee]of K.entries())ee>1&&e(T).push(`Duplicate entity name: "${p}"`)}async function y(){if(!(!e(k)||!e(m))&&(w(),!(e(T).length>0)))try{t(Y,!0),t(Q,null);const P=new Set;if(e(m)==="process"&&s.process){const d=(await ua()).filter(l=>l.process_id===s.process.id);for(const l of d)if(l.derived_entities)for(const f of l.derived_entities){const D=typeof f=="string"?f:f.entity_id;D&&P.add(D)}}let c=L(),K=g();e(m)==="process"&&P.size>0&&(c=L().filter(I=>I.type!=="entity"?!0:!P.has(I.id)),K=g().filter(I=>!P.has(I.source)&&!P.has(I.target)));const p=[],ee=[],ve=new Set(c.filter(I=>I.type==="entity").map(I=>I.id)),oe=Math.max(...c.map(I=>I.zIndex||(I.type==="group"?1:10)),10);for(let I=0;I<e(H).length;I++){const d=e(H)[I],l=e(k).entities[I],f=d.id.trim();if(ve.has(f)){d.entity_type==="fact"&&l.drafted_fields&&(c=c.map(J=>J.id===f?{...J,data:{...J.data,drafted_fields:l.drafted_fields}}:J)),ee.push(f);continue}const D=Fr(f,[...c.map(J=>J.id),...p]);let O;A()==="dimensional_model"&&d.entity_type?O=X.calculateSmartPosition(d.entity_type,c):O={x:100+Math.random()*200,y:100+Math.random()*200};const V={id:D,type:"entity",position:O,data:{label:d.label.trim()||d.id.trim(),description:l.description||"",entity_type:d.entity_type,annotation_type:l.annotation_type||void 0,tags:l.tags||[],drafted_fields:l.drafted_fields||void 0,width:280,panelHeight:200,collapsed:!1},zIndex:oe+I+1};c=[...c,V],p.push(D),ee.push(D)}if(ra(Ka,c),e(k).relationships&&e(k).relationships.length>0){const I=new Map;for(let f=0;f<e(k).entities.length;f++){const D=e(k).entities[f].id,O=ee[f]||p[f];O&&I.set(D,O)}const d=new Set([...ve,...p]);let l=K;for(const f of e(k).relationships){const D=I.get(f.source)||f.source,O=I.get(f.target)||f.target;if(d.has(D)&&d.has(O)){const V={source:D,target:O,label:f.label||"",type:f.type||"one_to_many"};l=Br(l,V)}}ra(Sa,l)}else ra(Sa,K);if(e(m)==="event"&&s.event){const d=Array.from(new Set([...ee,...p].filter(Boolean))).map(l=>({entity_id:l,created_at:new Date().toISOString()}));await ya(s.event.id,{derived_entities:d})}else if(e(m)==="process"&&s.process){const d=(await ua()).filter(l=>l.process_id===s.process.id);for(const l of d)await ya(l.id,{derived_entities:[]})}const G=S(L(),g()),Le=G.entities.find(I=>I.entity_type==="fact");console.log("Saving data model - fact entity:",Le),console.log("Fact has drafted_fields:",Le?.drafted_fields),await Ir(G),t(De,!0),setTimeout(()=>{s.onConfirm()},1500)}catch(P){t(Q,P instanceof Error?P.message:"Failed to create entities",!0),console.error("Error creating entities:",e(Q))}finally{t(Y,!1)}}function S(P,c){const K=Or(xr);return{version:.1,source_colors:Object.keys(K).length>0?K:void 0,entities:P.filter(p=>p.type==="entity").map(p=>{const ee=qa(p.data?.tags),ve=qa(p.data?._schemaTags),oe=!!p.data?.dbt_model,G=oe?ve.length>0?ve:void 0:ee.length>0?ee:void 0,Le=p.data?.entity_type||"unclassified",I=p.data?.source_system,d={id:p.id,label:(p.data.label||"").trim()||"Entity",description:p.data.description,dbt_model:p.data.dbt_model,additional_models:p.data?.additional_models,drafted_fields:p.data?.drafted_fields,position:p.position,width:p.data?.width,panel_height:p.data?.panelHeight,collapsed:p.data?.collapsed??!1,tags:G,entity_type:Le};return!oe&&I&&I.length>0&&(d.source_system=I),d}),relationships:c.flatMap(p=>{const ee=p.data?.models||[];return ee.length>0?ee.map(ve=>({source:p.source,target:p.target,label:p.data?.label||"",type:p.data?.type||"one_to_many",source_field:ve.source_field,target_field:ve.target_field,source_model_name:ve.source_model_name,source_model_version:ve.source_model_version,target_model_name:ve.target_model_name,target_model_version:ve.target_model_version,label_dx:p.data?.label_dx,label_dy:p.data?.label_dy})):[{source:p.source,target:p.target,label:p.data?.label||"",type:p.data?.type||"one_to_many",source_field:p.data?.source_field,target_field:p.data?.target_field,label_dx:p.data?.label_dx,label_dy:p.data?.label_dy}]})}}function re(P){if(!e(k)||e(H).length===0)return P;const c=e(k).entities.findIndex(p=>p.id===P);return c===-1?P:e(H)[c]?.id?.trim()||P}function N(P){P.key==="Escape"&&s.onCancel()}function Ee(P){P.target===P.currentTarget&&s.onCancel()}Rt(()=>{s.open&&e(H).length>0&&Na(()=>{w()})});var Ie=rt(),Oe=be(Ie);{var je=P=>{var c=Qn();c.__click=Ee,c.__keydown=N;var K=r(c);K.__click=l=>l.stopPropagation();var p=r(K),ee=r(p),ve=r(ee,!0);a(ee);var oe=n(ee,2);oe.__click=function(...l){s.onCancel?.apply(this,l)};var G=r(oe);W(G,{icon:"lucide:x",class:"w-5 h-5"}),a(oe),a(p);var Le=n(p,2);{var I=l=>{var f=jn();o(l,f)},d=l=>{var f=rt(),D=be(f);{var O=J=>{var ke=Fn(),pe=be(ke),se=r(pe),Ce=r(se);W(Ce,{icon:"lucide:alert-circle",class:"w-5 h-5 text-red-600"});var le=n(Ce,2),_e=r(le,!0);a(le),a(se),a(pe);var E=n(pe,2),M=r(E);M.__click=function(...F){s.onCancel?.apply(this,F)},a(E),z(()=>q(_e,e(Q))),o(J,ke)},V=J=>{var ke=rt(),pe=be(ke);{var se=le=>{var _e=Bn(),E=r(_e),M=r(E);W(M,{icon:"lucide:check-circle",class:"w-5 h-5 text-green-600"}),Ue(2),a(E),a(_e),o(le,_e)},Ce=le=>{var _e=rt(),E=be(_e);{var M=$=>{var ie=Yn(),fe=r(ie);{var Re=ce=>{var ge=On(),ze=r(ge),Ye=r(ze);W(Ye,{icon:"lucide:alert-triangle",class:"w-5 h-5 text-red-600 mt-0.5"});var Be=n(Ye,2),Se=n(r(Be),2);at(Se,21,()=>e(T),xt,(Je,nt)=>{var $e=Wn(),Ae=r($e,!0);a($e),z(()=>q(Ae,e(nt))),o(Je,$e)}),a(Se),a(Be),a(ze),a(ge),o(ce,ge)};h(fe,ce=>{e(T).length>0&&ce(Re)})}var Qe=n(fe,2);{var St=ce=>{var ge=Ln(),ze=r(ge),Ye=r(ze);W(Ye,{icon:"lucide:info",class:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"});var Be=n(Ye,2),Se=n(r(Be),2),Je=r(Se,!0);a(Se);var nt=n(Se);a(Be),a(ze),a(ge),z(()=>{q(Je,e(m)==="event"?s.event?.domain:s.process?.domain),q(nt,`" tag from this ${e(m)==="event"?"event":"process"}.`)}),o(ce,ge)};h(Qe,ce=>{(e(m)==="event"&&s.event?.domain||e(m)==="process"&&s.process?.domain)&&ce(St)})}var de=n(Qe,2),j=r(de),te=n(r(j));at(te,21,()=>e(H),xt,(ce,ge,ze)=>{var Ye=Nn(),Be=r(Ye),Se=r(Be),Je=r(Se,!0);a(Se),a(Be);var nt=n(Be),$e=r(nt);jt($e),$e.__input=ct=>me(ze,ct.target.value),a(nt);var Ae=n(nt),et=r(Ae);jt(et),et.__input=ct=>he(ze,ct.target.value),a(Ae);var dt=n(Ae),tt=r(dt);{var bt=ct=>{var Pt=Tn();at(Pt,21,()=>e(k).entities[ze].tags,xt,(Qt,Jt)=>{var it=Rn(),mt=r(it,!0);a(it),z(()=>q(mt,e(Jt))),o(Qt,it)}),a(Pt),o(ct,Pt)},Tt=ct=>{var Pt=zn();o(ct,Pt)};h(tt,ct=>{e(k).entities[ze]?.tags&&e(k).entities[ze].tags.length>0?ct(bt):ct(Tt,!1)})}a(dt),a(Ye),z(()=>{Dt(Se,1,`px-2 py-1 text-xs font-medium rounded ${e(ge).entity_type==="dimension"?"bg-blue-100 text-blue-800":e(ge).entity_type==="fact"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`),q(Je,e(ge).entity_type==="dimension"?"Dimension":e(ge).entity_type==="fact"?"Fact":"Unclassified"),_a($e,e(ge).id),_a(et,e(ge).label)}),o(ce,Ye)}),a(te),a(j),a(de);var ne=n(de,2);{var Fe=ce=>{var ge=Hn(),ze=n(r(ge),2);at(ze,21,()=>e(k).relationships,xt,(Ye,Be)=>{var Se=Un(),Je=r(Se),nt=r(Je,!0);a(Je);var $e=n(Je,4),Ae=r($e,!0);a($e);var et=n($e,2);{var dt=tt=>{var bt=Kn(),Tt=r(bt);a(bt),z(()=>q(Tt,`(${e(Be).label??""})`)),o(tt,bt)};h(et,tt=>{e(Be).label&&tt(dt)})}a(Se),z((tt,bt)=>{q(nt,tt),q(Ae,bt)},[()=>re(e(Be).source),()=>re(e(Be).target)]),o(Ye,Se)}),a(ze),a(ge),o(ce,ge)};h(ne,ce=>{e(k).relationships&&e(k).relationships.length>0&&ce(Fe)})}var Ge=n(ne,2),kt=r(Ge);kt.__click=function(...ce){s.onCancel?.apply(this,ce)};var Me=n(kt,2);Me.__click=y;var U=r(Me);{var Te=ce=>{var ge=qn();Ue(2),o(ce,ge)},Ze=ce=>{var ge=Vn(),ze=be(ge);W(ze,{icon:"lucide:sparkles",class:"w-4 h-4"}),Ue(2),o(ce,ge)};h(U,ce=>{e(Y)?ce(Te):ce(Ze,!1)})}a(Me),a(Ge),a(ie),z(()=>{kt.disabled=e(Y),Me.disabled=e(Y)||e(T).length>0}),o($,ie)},F=$=>{var ie=Xn(),fe=n(be(ie),2),Re=r(fe);Re.__click=function(...Qe){s.onCancel?.apply(this,Qe)},a(fe),o($,ie)};h(E,$=>{e(k)&&e(H).length>0?$(M):$(F,!1)},!0)}o(le,_e)};h(pe,le=>{e(De)?le(se):le(Ce,!1)},!0)}o(J,ke)};h(D,J=>{e(Q)?J(O):J(V,!1)},!0)}o(l,f)};h(Le,l=>{e(R)?l(I):l(d,!1)})}a(K),a(c),z(()=>q(ve,e(m)==="process"?"Generate Entities from Process":"Generate Entities from Event")),o(P,c)};h(Oe,P=>{s.open&&P(je)})}o(He,Ie),Bt(),v()}Ut(["click","keydown","input"]);var Zn=u('<span class="text-xs text-red-600">Process name is required</span>'),Gn=u('<span class="text-xs text-red-600"></span>'),$n=u("<option></option>"),es=u('<span class="text-xs text-red-600 mt-1 block">Process domain is required</span>'),ts=u('<div class="flex items-center gap-3 text-red-700 bg-red-50 border border-red-200 rounded-lg px-4 py-3"><!> <span class="text-sm"> </span></div>'),as=u("<!> <span>Creating...</span>",1),rs=u("<!> <span>Create Process</span>",1),ns=u(`<div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center backdrop-blur-sm" role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="process-modal-title"><div class="bg-white rounded-lg shadow-xl p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto" role="document" tabindex="-1"><div class="flex items-center justify-between mb-6"><h2 id="process-modal-title" class="text-xl font-semibold text-gray-900">Group into Process</h2> <button class="p-2 rounded-md hover:bg-gray-100 text-gray-500" aria-label="Close"><!></button></div> <div class="space-y-4"><div class="bg-blue-50 border border-blue-200 rounded-lg px-4 py-3"><div class="flex items-start gap-2"><!> <div class="text-sm text-blue-800"><p class="font-medium mb-1"> </p> <p class="text-blue-700">Create a process to consolidate these events with unified annotations.</p></div></div></div> <div><label for="process-name" class="block text-sm font-medium text-gray-700 mb-2">Process Name</label> <input id="process-name" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed" placeholder="e.g., Customer Order Fulfillment"/> <div class="flex items-center justify-between mt-1"><span class="text-xs text-gray-500"> </span> <!></div></div> <div><div class="flex items-center gap-2 mb-2"><label for="process-type" class="block text-sm font-medium text-gray-700">Process Type</label> <div class="group relative"><!> <div class="absolute left-0 bottom-full mb-2 w-64 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-opacity z-10"><div class="space-y-2"><div><strong class="text-blue-300">Discrete:</strong> One-time
                                        events grouped together (e.g., "order fulfillment")</div> <div><strong class="text-yellow-300">Evolving:</strong> Events
                                        that change over time (e.g., "sales opportunity funnel")</div> <div><strong class="text-purple-300">Recurring:</strong> Events
                                        that repeat (e.g., "monthly account statement")</div></div> <div class="absolute left-4 top-full w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"></div></div></div></div> <select id="process-type" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed"><option>Discrete</option><option>Evolving</option><option>Recurring</option></select></div> <div><label for="process-domain" class="block text-sm font-medium text-gray-700 mb-2">Process Domain</label> <input id="process-domain" type="text" list="domain-suggestions" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed" placeholder="e.g., Sales"/> <datalist id="domain-suggestions"></datalist> <!></div> <!> <div class="flex justify-end gap-3 pt-4 border-t border-gray-200"><button class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed">Cancel</button> <button class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"><!></button></div></div></div></div>`);function ss(He,s){Ft(s,!0);let L=At(s,"domains",19,()=>[]),g=_(""),A=_("discrete"),C=_(""),v=_(!1),m=_(null);const R=200;let Q=Z(()=>e(g).length),k=Z(()=>R-e(Q)),H=Z(()=>!(e(g).trim().length===0||e(g).length>R||!e(A)||e(C).trim().length===0||e(v)||s.eventIds.length<2));Rt(()=>{s.open&&(t(g,""),t(A,"discrete"),t(C,""),t(m,null),t(v,!1))});function T(w){w.key==="Escape"?s.onCancel():w.key==="Enter"&&(w.ctrlKey||w.metaKey)&&De()}function Y(w){w.target===w.currentTarget&&s.onCancel()}async function De(){if(e(g).length>R){t(m,`Process name cannot exceed ${R} characters`);return}if(e(H)){t(m,null),t(v,!0);try{const w={name:e(g).trim(),type:e(A),domain:e(C).trim(),event_ids:s.eventIds};await Mr(w),s.onSave()}catch(w){const y=w instanceof Error?w.message:"Failed to create process";y.includes("400")||y.includes("validation")?t(m,"Invalid process data. Please check your input and try again."):y.includes("404")||y.includes("not found")?t(m,"One or more events not found. Please refresh and try again."):y.includes("already attached")?t(m,"One or more events are already in another process."):y.includes("500")||y.includes("server")?t(m,"Server error. Please try again later."):t(m,y,!0)}finally{t(v,!1)}}}function X(){t(m,null),t(v,!1),s.onCancel()}var ye=rt(),me=be(ye);{var he=w=>{var y=ns();y.__click=Y,y.__keydown=T;var S=r(y),re=r(S),N=n(r(re),2);N.__click=X;var Ee=r(N);W(Ee,{icon:"lucide:x",class:"w-5 h-5"}),a(N),a(re);var Ie=n(re,2),Oe=r(Ie),je=r(Oe),P=r(je);W(P,{icon:"lucide:info",class:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"});var c=n(P,2),K=r(c),p=r(K);a(K),Ue(2),a(c),a(je),a(Oe);var ee=n(Oe,2),ve=n(r(ee),2);jt(ve),Ve(ve,"maxlength",R);var oe=n(ve,2),G=r(oe),Le=r(G);a(G);var I=n(G,2);{var d=j=>{var te=Zn();o(j,te)},l=j=>{var te=rt(),ne=be(te);{var Fe=Ge=>{var kt=Gn();kt.textContent="Process name cannot exceed 200 characters",o(Ge,kt)};h(ne,Ge=>{e(g).length>R&&Ge(Fe)},!0)}o(j,te)};h(I,j=>{e(g).trim().length===0?j(d):j(l,!1)})}a(oe),a(ee);var f=n(ee,2),D=r(f),O=n(r(D),2),V=r(O);W(V,{icon:"lucide:help-circle",class:"w-4 h-4 text-gray-400 hover:text-gray-600 cursor-help"}),Ue(2),a(O),a(D);var J=n(D,2),ke=r(J);ke.value=ke.__value="discrete";var pe=n(ke);pe.value=pe.__value="evolving";var se=n(pe);se.value=se.__value="recurring",a(J),a(f);var Ce=n(f,2),le=n(r(Ce),2);jt(le);var _e=n(le,2);at(_e,21,L,xt,(j,te)=>{var ne=$n(),Fe={};z(()=>{Fe!==(Fe=e(te))&&(ne.value=(ne.__value=e(te))??"")}),o(j,ne)}),a(_e);var E=n(_e,2);{var M=j=>{var te=es();o(j,te)};h(E,j=>{e(C).trim().length===0&&j(M)})}a(Ce);var F=n(Ce,2);{var $=j=>{var te=ts(),ne=r(te);W(ne,{icon:"lucide:alert-triangle",class:"w-5 h-5 flex-shrink-0"});var Fe=n(ne,2),Ge=r(Fe,!0);a(Fe),a(te),z(()=>q(Ge,e(m))),o(j,te)};h(F,j=>{e(m)&&j($)})}var ie=n(F,2),fe=r(ie);fe.__click=X;var Re=n(fe,2);Re.__click=De;var Qe=r(Re);{var St=j=>{var te=as(),ne=be(te);W(ne,{icon:"lucide:loader-2",class:"w-4 h-4 animate-spin"}),Ue(2),o(j,te)},de=j=>{var te=rs(),ne=be(te);W(ne,{icon:"lucide:layers",class:"w-4 h-4"}),Ue(2),o(j,te)};h(Qe,j=>{e(v)?j(St):j(de,!1)})}a(Re),a(ie),a(Ie),a(S),a(y),z(()=>{N.disabled=e(v),q(p,`Grouping ${s.eventIds.length??""} event${s.eventIds.length!==1?"s":""}`),ve.disabled=e(v),q(Le,`${e(k)??""} characters remaining`),J.disabled=e(v),le.disabled=e(v),fe.disabled=e(v),Re.disabled=!e(H)}),na(ve,()=>e(g),j=>t(g,j)),Xt(J,()=>e(A),j=>t(A,j)),na(le,()=>e(C),j=>t(C,j)),o(w,y)};h(me,w=>{s.open&&w(he)})}o(He,ye),Bt()}Ut(["click","keydown"]);var is=u('<div class="flex items-center justify-center h-full"><div class="text-center"><div class="w-8 h-8 animate-spin border-4 border-primary-600 border-t-transparent rounded-full mx-auto mb-2"></div> <p class="text-sm text-gray-600">Loading business events...</p></div></div>'),os=u('<div class="flex items-center justify-center h-full"><div class="bg-white/90 backdrop-blur-sm p-8 rounded-xl border border-red-200 shadow-xl text-center max-w-md mx-4"><div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"><!></div> <h3 class="text-xl font-bold text-slate-800 mb-2">Error Loading Business Events</h3> <p class="text-slate-600 mb-4"> </p></div></div>'),ls=u("<option> </option>"),ds=u("<option> </option>"),cs=u('<span class="text-sm text-gray-600"> </span> <button class="text-sm text-primary-600 hover:text-primary-700 font-medium"> </button> <button class="text-sm text-gray-600 hover:text-gray-700">Clear</button>',1),us=u('<button class="text-sm text-primary-600 hover:text-primary-700 font-medium">Select All</button>'),vs=u('<button class="flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors font-medium text-sm"><!> Group into Process</button>'),fs=u('<div class="flex items-center gap-3"><!> <!></div>'),gs=u('<div class="mb-4 rounded-lg border border-dashed border-primary-200 bg-primary-50 px-4 py-3 text-sm text-primary-800"><p class="font-semibold text-primary-800">No processes yet</p> <p class="text-xs text-primary-700">Select multiple events and click "Group into Process" to create the first process.</p></div>'),bs=u('<div class="mb-4 rounded-lg border border-dashed border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-700"><p class="font-semibold text-gray-800">No domains assigned</p> <p class="text-xs text-gray-600">Edit an event and add a business domain so events appear under meaningful headings.</p></div>'),ms=u("<!> <!>",1),ps=u(`<div class="flex items-center justify-center min-h-[400px]"><div class="bg-white/90 backdrop-blur-sm p-8 rounded-xl border border-amber-200 shadow-xl text-center max-w-md mx-4"><div class="w-16 h-16 bg-amber-50 rounded-full flex items-center justify-center mx-auto mb-4"><!></div> <h3 class="text-xl font-bold text-slate-800 mb-2">No Business Events</h3> <p class="text-slate-600 mb-4">Get started by creating your first business event. Business events help you document
                            business processes before designing your dimensional data model.</p> <div class="bg-amber-50 border border-amber-200 rounded p-3 text-xs text-amber-800 text-left mt-4"><strong class="block mb-1">Example event:</strong> <p class="text-amber-900">"customer buys product" - a discrete event that can be annotated with
                                Who, What, When, Where, How, How Many, and Why to generate dimensional entities.</p></div> <button class="mt-4 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors font-medium">Create Your First Event</button></div></div>`),_s=u('<div class="mb-3 rounded-md border border-red-200 bg-red-50 px-4 py-2 text-sm text-red-700"> </div>'),ys=u('<div class="absolute -top-1 left-0 right-0 h-0.5 bg-primary-500 z-10"><div class="absolute -left-1 -top-1 w-2 h-2 bg-primary-500 rounded-full"></div> <div class="absolute -right-1 -top-1 w-2 h-2 bg-primary-500 rounded-full"></div></div>'),hs=u('<div class="absolute -bottom-1 left-0 right-0 h-0.5 bg-primary-500 z-10"><div class="absolute -left-1 -top-1 w-2 h-2 bg-primary-500 rounded-full"></div> <div class="absolute -right-1 -top-1 w-2 h-2 bg-primary-500 rounded-full"></div></div>'),xs=u('<div class="relative"><!> <!> <!></div>'),ws=u('<div class="space-y-2 px-5 py-3"></div>'),Es=u('<div><div class="flex items-center gap-3 px-3 py-2"><button class="p-1 text-gray-500 hover:text-gray-800 rounded focus:outline-none focus:ring-2 focus:ring-primary-500"><!></button> <!></div> <!></div>'),ks=u("<div></div>"),Cs=u('<div class="space-y-3 px-4 py-3"><!> <!></div>'),Ds=u('<div class="rounded-lg border border-gray-200 shadow-sm bg-white overflow-hidden"><div class="flex items-center justify-between px-4 py-3 bg-gray-50 border-b border-gray-100"><div class="flex items-center gap-2"><button class="flex items-center gap-2 text-sm font-semibold text-gray-700 focus:outline-none"><!> <span> </span></button></div> <span class="text-xs text-gray-500"> </span></div> <!></div>'),Ss=u('<!> <div class="space-y-4"></div>',1),Ps=u('<div class="p-6"><div class="bg-white rounded-lg border border-gray-200 shadow-sm p-4 mb-4"><div class="flex items-center justify-between"><div><h2 class="text-xl font-bold text-gray-800">Business Events</h2> <p class="text-sm text-gray-600 mt-1">Document business events during the conception phase of dimensional data modeling. <br/> Identify granular events by asking "What happens?" (e.g. "Customer buys Product") and annotate them with analytical context answering "Who, What, When, Where, How, Why, and How Many". <br/> Optionally group related events into a holistic process to consolidate multiple events into the same fact table.</p></div> <button class="flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors font-medium"><!> Add Event</button></div></div> <div class="bg-white rounded-lg border border-gray-200 shadow-sm p-4 mb-4"><div class="flex items-center justify-between flex-wrap gap-4"><div class="flex items-center gap-4 flex-wrap"><div class="flex items-center gap-2"><!> <span class="text-sm font-medium text-gray-700">Filter by type:</span></div> <select class="px-3 py-1.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"><option>All</option><option>Discrete</option><option>Evolving</option><option>Recurring</option></select> <div class="flex items-center gap-2"><span class="text-sm font-medium text-gray-700">Filter by domain:</span></div> <select class="px-3 py-1.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"><option>All Domains</option><!><option>Unassigned</option></select> <div class="flex items-center gap-2"><span class="text-sm font-medium text-gray-700">Filter by process:</span></div> <select class="px-3 py-1.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"><option>All Processes</option><!><option>Ungrouped</option></select></div> <!></div></div> <!> <!></div>'),Is=u('<div class="h-full w-full overflow-auto bg-gray-50"><!> <!> <!> <!> <!> <!> <!> <!></div>');function Ms(He,s){Ft(s,!0);let L=_(ht([])),g=_(ht([])),A=_(ht([])),C=_(!0),v=_(null),m=_("all"),R=_(null),Q=_(null),k=_(ht(new Set)),H=_(!1);const T="unassigned";let Y=_(ht({})),De=_(ht({})),X=_(null),ye=_(!1),me=_(null),he=_(null),w=_(!1),y=_(null),S=_(null),re=_(null),N=_(null),Ee=_(null),Ie=_(null);function Oe(i){return i.trim().charAt(0).toUpperCase()+i.trim().slice(1).toLowerCase()}let je=_(!1),P=_(!1),c=_(null),K=_(!1),p=_(!1),ee=_(null),ve=_(null),oe=_(null),G=Z(()=>{let i=e(L);e(m)!=="all"&&(i=i.filter(ae=>ae.type===e(m))),e(R)!==null&&(e(R)==="unassigned"?i=i.filter(ae=>!ae.domain):i=i.filter(ae=>ae.domain===e(R))),e(Q)!==null&&(e(Q)==="ungrouped"?i=i.filter(ae=>!ae.process_id):i=i.filter(ae=>ae.process_id===e(Q)));const b=new Set(i.map(ae=>ae.id)),x=Array.from(e(k)).filter(ae=>b.has(ae));return x.length!==e(k).size&&t(k,new Set(x),!0),i});function Le(i){return i===T?"Unassigned":Oe(i)}const I=Z(()=>e(g).filter(i=>!i.resolved_at)),d=Z(()=>()=>e(I).length>0),l=Z(()=>{const i=new Map(e(I).map(B=>[B.id,B])),b=new Map(e(G).map(B=>[B.id,B])),x=new Map;function ae(B){const ue=x.get(B);if(ue)return ue;const Pe={domainKey:B,domainLabel:Le(B),processes:[],ungroupedEvents:[],totalEvents:0};return x.set(B,Pe),Pe}return e(I).forEach(B=>{const ue=B.domain??T,Pe=B.event_ids.map(pt=>b.get(pt)).filter(pt=>!!pt);if(Pe.length===0)return;ae(ue).processes.push({process:B,events:Pe})}),e(G).forEach(B=>{const ue=B.domain??T;if(B.process_id&&i.has(B.process_id))return;ae(ue).ungroupedEvents.push(B)}),Array.from(x.values()).map(B=>({...B,totalEvents:B.ungroupedEvents.length+B.processes.reduce((ue,Pe)=>ue+Pe.events.length,0)})).filter(B=>B.totalEvents>0).sort((B,ue)=>B.domainLabel.localeCompare(ue.domainLabel))});function f(i){t(Y,{...e(Y),[i]:!D(i)},!0)}function D(i){return e(Y)[i]!==!1}function O(i){t(De,{...e(De),[i]:!V(i)},!0)}function V(i){return e(De)[i]!==!1}function J(){return{who:[],what:[],when:[],where:[],how:[],how_many:[],why:[]}}function ke(i){return{id:i.id,text:i.name,type:i.type,domain:i.domain??void 0,created_at:i.created_at,updated_at:i.updated_at,annotations:i.annotations_superset??J(),derived_entities:[]}}function pe(i){t(me,i,!0),t(he,ke(i),!0),t(ye,!0)}async function se(i){if(e(me))try{t(X,null),await aa(e(me).id,{annotations_superset:i.annotations}),t(ye,!1),t(me,null),t(he,null),await ne()}catch(b){const x=b instanceof Error?b.message:"Failed to save process annotations";t(X,x,!0)}}function Ce(){t(ye,!1),t(me,null),t(he,null)}function le(i){t(y,i,!0),t(w,!0)}function _e(){t(w,!1),t(y,null)}function E(){t(w,!1),t(y,null),ne()}function M(i,b){const x=[];if(b&&b.length>0){const We=b.map(encodeURIComponent).join(",");x.push(`entities=${We}`)}x.push(`processId=${encodeURIComponent(i.id)}`),x.push(`processName=${encodeURIComponent(i.name)}`);const ae=`/canvas?${x.join("&")}`;typeof window<"u"&&window.open(ae,"_blank")}async function F(i){try{t(X,null),await Pa(i),await ne()}catch(b){const x=b instanceof Error?b.message:"Failed to resolve process";t(X,x,!0)}}function $(i,b,x){const ae=i.indexOf(b),We=i.indexOf(x);if(ae===-1||We===-1||ae===We)return i;const B=[...i],[ue]=B.splice(ae,1);return B.splice(We,0,ue),B}function ie(i,b,x){t(S,{eventId:i.id,processId:b},!0),t(re,null),t(N,null),t(Ee,null),t(Ie,null),x.dataTransfer&&(x.dataTransfer.effectAllowed="move",x.dataTransfer.setData("text/plain",i.id))}function fe(i,b,x,ae){if(!e(S)||e(S).eventId===i.id||e(S).processId!==b)return;x.preventDefault(),t(re,i.id,!0),t(N,b,!0),t(Ee,null);const We=ae.process.event_ids.indexOf(e(S).eventId),B=ae.process.event_ids.indexOf(i.id);t(Ie,We<B?"after":"before",!0),x.dataTransfer&&(x.dataTransfer.dropEffect="move")}async function Re(i,b,x){if(!e(S)||e(S).processId!==b.process.id)return;x.preventDefault();const ae=e(S).eventId,We=i.id;if(t(S,null),t(re,null),t(N,null),t(Ee,null),t(Ie,null),ae===We)return;const B=b.process.event_ids,ue=$(B,ae,We);if(ue.join("|")!==B.join("|"))try{t(X,null),await aa(b.process.id,{event_ids:ue}),await ne()}catch(Pe){const st=Pe instanceof Error?Pe.message:"Failed to reorder process events";t(X,st,!0)}}function Qe(){t(S,null),t(re,null),t(N,null),t(Ee,null),t(Ie,null)}function St(i,b){e(S)&&e(S).processId!==i&&(b.preventDefault(),t(N,i,!0),t(Ee,null),b.dataTransfer&&(b.dataTransfer.dropEffect="move"))}async function de(i,b){if(!e(S))return;b.preventDefault();const{eventId:x,processId:ae}=e(S),We=i.process.id;if(t(S,null),t(re,null),t(N,null),t(Ee,null),ae!==We)try{if(t(X,null),ae){const Pe=e(g).find(st=>st.id===ae);if(Pe){const st=Pe.event_ids.filter(pt=>pt!==x);st.length>0?await aa(ae,{event_ids:st}):await Pa(ae)}}const ue=e(g).find(Pe=>Pe.id===We)?.event_ids??[];ue.includes(x)||await aa(We,{event_ids:[...ue,x]}),await ne()}catch(B){const ue=B instanceof Error?B.message:"Failed to move event into process";t(X,ue,!0)}}function j(i,b){e(S)&&e(S).processId&&(b.preventDefault(),t(Ee,i,!0),t(N,null),b.dataTransfer&&(b.dataTransfer.dropEffect="move"))}async function te(i,b){if(!e(S)||!e(S).processId)return;b.preventDefault();const{eventId:x,processId:ae}=e(S);t(S,null),t(re,null),t(N,null),t(Ee,null);try{t(X,null);const We=e(g).find(B=>B.id===ae);if(We){const B=We.event_ids.filter(ue=>ue!==x);B.length>0?await aa(ae,{event_ids:B}):await Pa(ae)}await ne()}catch(We){const B=We instanceof Error?We.message:"Failed to move event out of process";t(X,B,!0)}}Ja(async()=>{try{t(C,!0),t(v,null);try{t(L,await ua(),!0)}catch(i){const b=i instanceof Error?i.message:String(i),x=i?.status;x===403||b.includes("403")||b.includes("feature_disabled")||b.includes("disabled")?t(v,"Business events feature is disabled. Enable it in trellis.yml by setting business_events.enabled: true"):x===400||b.includes("400")||b.includes("configuration")?t(v,"Configuration error. Please check your trellis.yml file."):x===404||b.includes("404")||b.includes("not found")?t(v,"Business events file not found. Create your first event to get started."):x===500||b.includes("500")||b.includes("parse")||b.includes("YAML")?t(v,"Invalid business events file format. Please check the file or contact support."):t(v,"Failed to load business events. Please try again later."),console.error("Error loading business events:",i),t(L,[],!0)}try{t(A,await Ma(),!0)}catch(i){console.warn("Failed to load domain suggestions:",i),t(A,[],!0)}try{t(g,await Ua(),!0)}catch(i){console.warn("Failed to load processes:",i),t(g,[],!0)}}catch(i){const b=i instanceof Error?i.message:"Failed to load business events";t(v,b.includes("403")||b.includes("disabled")?"Business events feature is disabled. Enable it in trellis.yml by setting business_events.enabled: true":"Failed to load business events. Please try again later.",!0),console.error("Error loading business events:",i),t(L,[],!0),t(A,[],!0)}finally{t(C,!1)}});async function ne(){try{t(v,null),t(X,null);try{t(L,await ua(),!0)}catch(i){const b=i instanceof Error?i.message:String(i),x=i?.status;x===403||b.includes("403")||b.includes("feature_disabled")||b.includes("disabled")?t(v,"Business events feature is disabled. Enable it in trellis.yml by setting business_events.enabled: true"):x===400||b.includes("400")||b.includes("configuration")?t(v,"Configuration error. Please check your trellis.yml file."):x===404||b.includes("404")||b.includes("not found")?t(v,"Business events file not found. Create your first event to get started."):x===500||b.includes("500")||b.includes("parse")||b.includes("YAML")?t(v,"Invalid business events file format. Please check the file or contact support."):t(v,"Failed to reload events. Please try again."),console.error("Error reloading events:",i),t(L,[],!0)}try{t(A,await Ma(),!0)}catch(i){console.warn("Failed to reload domain suggestions:",i),t(A,[],!0)}try{t(g,await Ua(),!0)}catch(i){console.warn("Failed to reload processes:",i),t(g,[],!0)}}catch(i){console.error("Error reloading events:",i);const b=i instanceof Error?i.message:"Failed to reload events";t(v,b.includes("403")||b.includes("disabled")?"Business events feature is disabled. Enable it in trellis.yml by setting business_events.enabled: true":"Failed to reload events. Please try again.",!0),t(L,[],!0),t(A,[],!0)}}function Fe(){t(je,!0)}function Ge(){t(je,!1),ne()}function kt(i){t(c,i,!0),t(P,!0)}function Me(){t(P,!1),t(c,null),ne()}function U(){t(P,!1),t(c,null)}function Te(i){t(ee,i,!0),t(K,!0)}async function Ze(i){try{t(v,null),await ya(i.id,{annotations:i.annotations}),t(K,!1),t(ee,null),ne()}catch(b){const x=b instanceof Error?b.message:"Failed to save annotations";x.includes("annotation_type")||x.includes("Invalid annotation_type")?t(v,"Invalid annotation category. Please check your entries."):x.includes("Duplicate entry IDs")||x.includes("duplicate")?t(v,"Duplicate entries detected. Please check for duplicate entries."):x.includes("400")||x.includes("validation")?t(v,"Invalid annotation data. Please check your entries."):t(v,x,!0),console.error("Error saving annotations:",b)}}function ce(){t(K,!1),t(ee,null)}function ge(i){t(ve,i,!0),t(oe,null),t(p,!0)}function ze(i){t(oe,i,!0),t(ve,null),t(p,!0)}function Ye(){t(p,!1),t(ve,null),t(oe,null),ne()}function Be(i,b){if(b)t(k,new Set([...e(k),i]),!0);else{const x=new Set(e(k));x.delete(i),t(k,x,!0)}}function Se(){e(k).size===e(G).length?t(k,new Set,!0):t(k,new Set(e(G).map(i=>i.id)),!0)}const Je=Z(()=>e(k).size),nt=Z(()=>e(k).size>=2);function $e(){e(nt)&&t(H,!0)}function Ae(){t(H,!1),t(k,new Set,!0),ne()}function et(){t(H,!1)}function dt(i){const b=i.flatMap(x=>x.derived_entities??[]).map(x=>typeof x=="string"?x:x.entity_id).filter(x=>!!x);return Array.from(new Set(b))}var tt=Is(),bt=r(tt);{var Tt=i=>{var b=is();o(i,b)},ct=i=>{var b=rt(),x=be(b);{var ae=B=>{var ue=os(),Pe=r(ue),st=r(Pe),pt=r(st);W(pt,{icon:"lucide:alert-circle",class:"w-8 h-8 text-red-500"}),a(st);var ut=n(st,4),Wt=r(ut,!0);a(ut),a(Pe),a(ue),z(()=>q(Wt,e(v))),o(B,ue)},We=B=>{var ue=Ps(),Pe=r(ue),st=r(Pe),pt=n(r(st),2);pt.__click=Fe;var ut=r(pt);W(ut,{icon:"lucide:plus",class:"w-4 h-4"}),Ue(),a(pt),a(st),a(Pe);var Wt=n(Pe,2),$t=r(Wt),ea=r($t),sa=r(ea),ha=r(sa);W(ha,{icon:"lucide:filter",class:"w-4 h-4 text-gray-500"}),Ue(2),a(sa);var It=n(sa,2),zt=r(It);zt.value=zt.__value="all";var ia=n(zt);ia.value=ia.__value="discrete";var wt=n(ia);wt.value=wt.__value="evolving";var Et=n(wt);Et.value=Et.__value="recurring",a(It);var Nt=n(It,4),Kt=r(Nt);Kt.value=(Kt.__value=null)??"";var Aa=n(Kt);at(Aa,17,()=>e(A),xt,(Ne,qe)=>{var Ke=ls(),_t=r(Ke,!0);a(Ke);var vt={};z(ot=>{q(_t,ot),vt!==(vt=e(qe))&&(Ke.value=(Ke.__value=e(qe))??"")},[()=>Oe(e(qe))]),o(Ne,Ke)});var ja=n(Aa);ja.value=ja.__value="unassigned",a(Nt);var xa=n(Nt,4),wa=r(xa);wa.value=(wa.__value=null)??"";var Fa=n(wa);at(Fa,17,()=>e(I),xt,(Ne,qe)=>{var Ke=ds(),_t=r(Ke,!0);a(Ke);var vt={};z(()=>{q(_t,e(qe).name),vt!==(vt=e(qe).id)&&(Ke.value=(Ke.__value=e(qe).id)??"")}),o(Ne,Ke)});var Ba=n(Fa);Ba.value=Ba.__value="ungrouped",a(xa),a(ea);var Ga=n(ea,2);{var $a=Ne=>{var qe=fs(),Ke=r(qe);{var _t=Xe=>{var ft=cs(),Ot=be(ft),Ht=r(Ot);a(Ot);var qt=n(Ot,2);qt.__click=Se;var ga=r(qt,!0);a(qt);var Ea=n(qt,2);Ea.__click=()=>t(k,new Set,!0),z(()=>{q(Ht,`${e(Je)??""} selected`),q(ga,e(Je)===e(G).length?"Deselect All":"Select All")}),o(Xe,ft)},vt=Xe=>{var ft=us();ft.__click=Se,o(Xe,ft)};h(Ke,Xe=>{e(Je)>0?Xe(_t):Xe(vt,!1)})}var ot=n(Ke,2);{var xe=Xe=>{var ft=vs();ft.__click=$e;var Ot=r(ft);W(Ot,{icon:"lucide:layers",class:"w-4 h-4"}),Ue(),a(ft),o(Xe,ft)};h(ot,Xe=>{e(nt)&&Xe(xe)})}a(qe),o(Ne,qe)};h(Ga,Ne=>{e(G).length>0&&Ne($a)})}a($t),a(Wt);var Wa=n(Wt,2);{var er=Ne=>{var qe=ms(),Ke=be(qe);{var _t=xe=>{var Xe=gs();o(xe,Xe)};h(Ke,xe=>{e(d)||xe(_t)})}var vt=n(Ke,2);{var ot=xe=>{var Xe=bs();o(xe,Xe)};h(vt,xe=>{e(A).length===0&&xe(ot)})}o(Ne,qe)};h(Wa,Ne=>{e(L).length>0&&Ne(er)})}var tr=n(Wa,2);{var ar=Ne=>{var qe=ps(),Ke=r(qe),_t=r(Ke),vt=r(_t);W(vt,{icon:"lucide:calendar-check",class:"w-8 h-8 text-amber-600"}),a(_t);var ot=n(_t,8);ot.__click=Fe,a(Ke),a(qe),o(Ne,qe)},rr=Ne=>{var qe=Ss(),Ke=be(qe);{var _t=ot=>{var xe=_s(),Xe=r(xe,!0);a(xe),z(()=>q(Xe,e(X))),o(ot,xe)};h(Ke,ot=>{e(X)&&ot(_t)})}var vt=n(Ke,2);at(vt,21,()=>e(l),ot=>ot.domainKey,(ot,xe)=>{var Xe=Ds(),ft=r(Xe),Ot=r(ft),Ht=r(Ot);Ht.__click=()=>f(e(xe).domainKey);var qt=r(Ht);{let Vt=Z(()=>D(e(xe).domainKey));Ya(qt,{get expanded(){return e(Vt)}})}var ga=n(qt,2),Ea=r(ga,!0);a(ga),a(Ht),a(Ot);var Oa=n(Ot,2),nr=r(Oa);a(Oa),a(ft);var sr=n(ft,2);{var ir=Vt=>{var ba=Cs(),La=r(ba);at(La,17,()=>e(xe).processes,Yt=>Yt.process.id,(Yt,we)=>{const oa=Z(()=>dt(e(we).events));var gt=Es();let ta;var la=r(gt),Mt=r(la);Mt.__click=()=>O(e(we).process.id);var ka=r(Mt);{let yt=Z(()=>V(e(we).process.id));Ya(ka,{get expanded(){return e(yt)}})}a(Mt);var dr=n(Mt,2);{let yt=Z(()=>e(oa).length>0?()=>M(e(we).process,e(oa)):void 0);tn(dr,{get process(){return e(we).process},get eventCount(){return e(we).events.length},onEdit:()=>le(e(we).process),onAnnotate:()=>pe(e(we).process),get onOpenCanvas(){return e(yt)},onResolve:F,onGenerateEntities:()=>ze(e(we).process)})}a(la);var cr=n(la,2);{var ur=yt=>{var ma=ws();at(ma,21,()=>e(we).events,Ca=>Ca.id,(Ca,da)=>{var Da=xs(),Ra=r(Da);{var vr=Lt=>{var Ct=ys();o(Lt,Ct)};h(Ra,Lt=>{e(re)===e(da).id&&e(Ie)==="before"&&Lt(vr)})}var Ta=n(Ra,2);{let Lt=Z(()=>e(k).has(e(da).id));Xa(Ta,{get event(){return e(da)},get process(){return e(we).process},get selected(){return e(Lt)},draggable:!0,onSelect:Ct=>Be(e(da).id,Ct),onEditEvent:kt,onEditSevenWs:Te,onGenerateEntities:ge,onDelete:ne,onResolveProcess:F,onDragStart:(Ct,ca)=>ie(Ct,e(we).process.id,ca),onDragOver:(Ct,ca)=>fe(Ct,e(we).process.id,ca,e(we)),onDrop:(Ct,ca)=>Re(Ct,e(we),ca),onDragEnd:Qe})}var fr=n(Ta,2);{var gr=Lt=>{var Ct=hs();o(Lt,Ct)};h(fr,Lt=>{e(re)===e(da).id&&e(Ie)==="after"&&Lt(gr)})}a(Da),o(Ca,Da)}),a(ma),z(()=>Ve(ma,"id",`process-${e(we).process.id}`)),o(yt,ma)};h(cr,yt=>{V(e(we).process.id)&&yt(ur)})}a(gt),z(yt=>{ta=Dt(gt,1,"space-y-2 rounded-lg border border-gray-200 bg-gray-50 shadow-sm",null,ta,{"border-primary-300":e(N)===e(we).process.id,"ring-2":e(N)===e(we).process.id,"ring-primary-200":e(N)===e(we).process.id}),Ve(Mt,"aria-expanded",yt),Ve(Mt,"aria-controls",`process-${e(we).process.id}`)},[()=>V(e(we).process.id)]),lt("dragover",gt,yt=>St(e(we).process.id,yt)),lt("drop",gt,yt=>de(e(we),yt)),o(Yt,gt)});var or=n(La,2);{var lr=Yt=>{var we=ks();let oa;at(we,21,()=>e(xe).ungroupedEvents,gt=>gt.id,(gt,ta)=>{{let la=Z(()=>e(k).has(e(ta).id));Xa(gt,{get event(){return e(ta)},get selected(){return e(la)},draggable:!0,onSelect:Mt=>Be(e(ta).id,Mt),onEditEvent:kt,onEditSevenWs:Te,onGenerateEntities:ge,onDelete:ne,onDragStart:(Mt,ka)=>ie(Mt,null,ka),onDragEnd:Qe})}}),a(we),z(()=>oa=Dt(we,1,"space-y-2 pt-2",null,oa,{"border-primary-300":e(Ee)===e(xe).domainKey,"ring-2":e(Ee)===e(xe).domainKey,"ring-primary-200":e(Ee)===e(xe).domainKey})),lt("dragover",we,gt=>j(e(xe).domainKey,gt)),lt("drop",we,gt=>te(e(xe).domainKey,gt)),o(Yt,we)};h(or,Yt=>{e(xe).ungroupedEvents.length>0&&Yt(lr)})}a(ba),z(()=>Ve(ba,"id",`domain-${e(xe).domainKey}`)),o(Vt,ba)};h(sr,Vt=>{D(e(xe).domainKey)&&Vt(ir)})}a(Xe),z(Vt=>{Ve(Ht,"aria-expanded",Vt),Ve(Ht,"aria-controls",`domain-${e(xe).domainKey}`),q(Ea,e(xe).domainLabel),q(nr,`${e(xe).totalEvents??""} event${e(xe).totalEvents!==1?"s":""}`)},[()=>D(e(xe).domainKey)]),o(ot,Xe)}),a(vt),o(Ne,qe)};h(tr,Ne=>{e(l).length===0?Ne(ar):Ne(rr,!1)})}a(ue),Xt(It,()=>e(m),Ne=>t(m,Ne)),Xt(Nt,()=>e(R),Ne=>t(R,Ne)),Xt(xa,()=>e(Q),Ne=>t(Q,Ne)),o(B,ue)};h(x,B=>{e(v)?B(ae):B(We,!1)},!0)}o(i,b)};h(bt,i=>{e(C)?i(Tt):i(ct,!1)})}var Pt=n(bt,2);Va(Pt,{get open(){return e(je)},onSave:Ge,onCancel:()=>{t(je,!1)}});var Qt=n(Pt,2);{let i=Z(()=>e(c)??void 0);Va(Qt,{get open(){return e(P)},get event(){return e(i)},onSave:Me,onCancel:U})}var Jt=n(Qt,2);{var it=i=>{Qa(i,{get event(){return e(ee)},onSave:Ze,onCancel:ce})};h(Jt,i=>{e(K)&&e(ee)&&i(it)})}var mt=n(Jt,2);{var Zt=i=>{Qa(i,{get event(){return e(he)},onSave:se,onCancel:Ce})};h(mt,i=>{e(ye)&&e(he)&&i(Zt)})}var va=n(mt,2);{let i=Z(()=>e(y)??void 0);cn(va,{get open(){return e(w)},get process(){return e(i)},onSave:E,onCancel:_e,get domains(){return e(A)}})}var fa=n(va,2);Jn(fa,{get open(){return e(p)},get event(){return e(ve)},get process(){return e(oe)},onConfirm:Ye,onCancel:Ye});var Gt=n(fa,2);{let i=Z(()=>Array.from(e(k)));ss(Gt,{get open(){return e(H)},get eventIds(){return e(i)},onSave:Ae,onCancel:et,get domains(){return e(A)}})}a(tt),o(He,tt),Bt()}Ut(["click"]);var As=u('<meta name="description" content="Business Events modeling for dimensional data models (BEAM* methodology)"/>'),js=u('<div class="flex items-center justify-center h-full"><div class="flex flex-col items-center gap-3"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div> <p class="text-sm text-gray-600">Loading business events...</p></div></div>'),Fs=u('<div class="flex items-center justify-center h-full"><div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg max-w-md"><p class="font-medium">Failed to load business events</p> <p class="text-sm mt-1"> </p></div></div>'),Bs=u('<div class="flex items-center justify-center h-full text-gray-500"><p>Business Events view is not available.</p></div>');function Ys(He,s){Ft(s,!0);const L=()=>pa(Ia,"$modelingStyle",g),[g,A]=Za();let C=_(!0),v=_(!1),m=_(null);(async()=>{try{const T=await Ar();ra(wr,T);const Y=await jr();t(v,Y?.business_events_enabled??!1,!0),Y?.modeling_style&&ra(Ia,Y.modeling_style),e(v)&&L()==="dimensional_model"?ra(Er,"business_events"):window.location.href="/canvas"}catch(T){console.error("Failed to load business events:",T),t(m,T instanceof Error?T.message:"Failed to load business events configuration",!0),window.location.href="/canvas"}finally{t(C,!1)}})();var R=rt();hr("makmt2",T=>{var Y=As();mr(()=>{pr.title="trellis - Business Events"}),o(T,Y)});var Q=be(R);{var k=T=>{var Y=js();o(T,Y)},H=T=>{var Y=rt(),De=be(Y);{var X=me=>{var he=Fs(),w=r(he),y=n(r(w),2),S=r(y,!0);a(y),a(w),a(he),z(()=>q(S,e(m))),o(me,he)},ye=me=>{var he=rt(),w=be(he);{var y=re=>{Ms(re,{})},S=re=>{var N=Bs();o(re,N)};h(w,re=>{e(v)&&L()==="dimensional_model"?re(y):re(S,!1)},!0)}o(me,he)};h(De,me=>{e(m)?me(X):me(ye,!1)},!0)}o(T,Y)};h(Q,T=>{e(C)?T(k):T(H,!1)})}o(He,R),Bt(),A()}export{Ys as component};
