import{d as et,f,a as o,c as C}from"../chunks/CjZGm4I-.js";import{y as Fe,z as M,A as H,G as tt,F as p,C as e,H as a,I as r,J as Se,w as F,L as v,x as B,K as ke,M as xe,f as at,$ as rt}from"../chunks/QnYduk6G.js";import{i as k,c as Be,b as st}from"../chunks/DjhwXl_d.js";import{s as Ce,h as it}from"../chunks/9BfctgED.js";import{c as ot,v as nt}from"../chunks/CX-jWEeK.js";import{c as lt,I as J,e as y,i as w,a as ct,b as dt}from"../chunks/CfnWWzkx.js";import{s as z}from"../chunks/B9JYo02m.js";var vt=f('<div class="flex items-center justify-center h-full"><div class="text-center"><div class="w-8 h-8 animate-spin border-4 border-primary-600 border-t-transparent rounded-full mx-auto mb-2"></div> <p class="text-sm text-gray-600">Loading Bus Matrix...</p></div></div>'),ut=f('<div class="flex items-center justify-center h-full"><div class="bg-white/90 backdrop-blur-sm p-8 rounded-xl border border-red-200 shadow-xl text-center max-w-md mx-4"><div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-8 h-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg></div> <h3 class="text-xl font-bold text-slate-800 mb-2">Error Loading Bus Matrix</h3> <p class="text-slate-600 mb-4"> </p></div></div>'),ft=f("<option> </option>"),pt=f('<span class="inline-flex items-center gap-1 px-2 py-1 bg-primary-100 text-primary-700 rounded text-xs"> <button class="hover:text-primary-900"><!></button></span>'),xt=f("<option> </option>"),gt=f('<span class="inline-flex items-center gap-1 px-2 py-1 bg-primary-100 text-primary-700 rounded text-xs"> <button class="hover:text-primary-900"><!></button></span>'),_t=f("<option> </option>"),mt=f('<span class="inline-flex items-center gap-1 px-2 py-1 bg-primary-100 text-primary-700 rounded text-xs"> <button class="hover:text-primary-900"><!></button></span>'),ht=f('<button class="text-xs text-gray-600 hover:text-gray-800 underline">Clear all filters</button>'),bt=f('<th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider bg-gray-50 min-w-[150px]"><div class="flex items-center gap-2"><!> <span class="truncate"> </span></div></th>'),yt=f('<tr><td class="px-4 py-8 text-center text-sm text-gray-500">No dimensions match the current filters.</td></tr>'),wt=f('<tr><td colspan="2" class="px-4 py-8 text-center text-sm text-gray-500">No facts match the current filters.</td></tr>'),Mt=f('<span class="text-green-600 font-semibold">✓</span>'),kt=f('<span class="text-gray-300">—</span>'),Bt=f('<td class="px-4 py-3 text-sm text-center"><!></td>'),Ct=f('<tr class="hover:bg-gray-50 transition-colors"><td class="px-4 py-3 text-sm font-medium text-gray-900 bg-white sticky left-0 z-10 border-r border-gray-200 w-[200px] min-w-[200px]"><div class="flex items-center gap-2"><!> <span class="truncate"> </span></div></td><!></tr>'),Ft=f('<div class="p-6"><div class="bg-white rounded-lg border border-gray-200 shadow-sm p-4 mb-4"><div><h2 class="text-xl font-bold text-gray-800">Bus Matrix</h2> <p class="text-sm text-gray-600 mt-1">View which business processes (facts) use the same dimensions.<br/>This can help you with prioritization, but also with integrating and aligning definitions across departments, allowing you to use a `Conformed Dimension` across use cases.</p></div></div> <div class="bg-white rounded-lg border border-gray-200 shadow-sm p-4 mb-4"><div class="flex flex-wrap items-center gap-4"><div class="flex items-center gap-2"><!> <span class="text-sm font-medium text-gray-700">Filters:</span></div> <div class="flex items-center gap-2"><label for="dimension-filter" class="text-xs text-gray-600">Dimensions:</label> <select id="dimension-filter" class="text-xs border border-gray-300 rounded px-2 py-1 bg-white focus:outline-none focus:ring-2 focus:ring-primary-500"><option>Select dimension...</option><!></select> <!></div> <div class="flex items-center gap-2"><label for="fact-filter" class="text-xs text-gray-600">Facts:</label> <select id="fact-filter" class="text-xs border border-gray-300 rounded px-2 py-1 bg-white focus:outline-none focus:ring-2 focus:ring-primary-500"><option>Select fact...</option><!></select> <!></div> <div class="flex items-center gap-2"><label for="tag-filter" class="text-xs text-gray-600">Tags:</label> <select id="tag-filter" class="text-xs border border-gray-300 rounded px-2 py-1 bg-white focus:outline-none focus:ring-2 focus:ring-primary-500"><option>Select tag...</option><!></select> <!></div> <!></div></div> <div class="bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden"><div class="overflow-x-auto overflow-y-auto max-h-[calc(100vh-14rem)]"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50 sticky top-0 z-10"><tr><th class="px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider bg-gray-50 sticky left-0 z-20 border-r border-gray-200 w-[200px] min-w-[200px]"><div class="flex items-center gap-2"><!> <span>Dimensions</span></div></th><!></tr></thead><tbody class="bg-white divide-y divide-gray-200"><!></tbody></table></div></div></div>'),St=f('<div class="h-full w-full overflow-auto bg-gray-50"><!></div>');function zt(ee,te){Fe(te,!0);let D=M(H([])),j=M(H([])),E=M(H([])),T=M(!0),L=M(null),$=M(H(new Map)),m=M(H([])),h=M(H([])),c=M(H([])),S=xe(()=>e(D).filter(n=>{if(e(m).length>0&&!e(m).includes(n.id))return!1;if(e(c).length>0){const _=n.tags||[];if(!e(c).some(A=>_.includes(A)))return!1}return!0})),K=xe(()=>e(j).filter(n=>{if(e(h).length>0&&!e(h).includes(n.id))return!1;if(e(c).length>0){const _=n.tags||[];if(!e(c).some(A=>_.includes(A)))return!1}return!0})),ae=xe(()=>Array.from(new Set([...e(D).flatMap(n=>n.tags||[]),...e(j).flatMap(n=>n.tags||[])])).sort());tt(async()=>{try{p(T,!0),p(L,null),console.log("Bus Matrix: Starting API fetch...");const n=await lt();console.log("Bus Matrix: API response received - dimensions:",n.dimensions?.length,"facts:",n.facts?.length,"connections:",n.connections?.length),p(D,n.dimensions||[],!0),p(j,n.facts||[],!0),p(E,n.connections||[],!0),console.log("Bus Matrix: Data assigned - dimensions:",e(D).length,"facts:",e(j).length,"connections:",e(E).length),p($,new Map,!0),e(E).forEach(_=>{const I=`${_.dimension_id}-${_.fact_id}`;e($).set(I,!0)}),console.log("Bus Matrix: Connection lookup map created with",e($).size,"entries"),console.log("Bus Matrix: Sample connection keys:",Array.from(e($).keys()).slice(0,5))}catch(n){p(L,n instanceof Error?n.message:"Failed to load Bus Matrix data",!0),console.error("Bus Matrix: Error loading data:",e(L))}finally{p(T,!1)}});function Q(n,_){const I=`${n}-${_}`,A=e($).has(I);return console.log("Bus Matrix: Checking connection - dimension:",n,"fact:",_,"result:",A),A}var R=St(),ze=a(R);{var je=n=>{var _=vt();o(n,_)},Le=n=>{var _=C(),I=F(_);{var A=V=>{var N=ut(),q=a(N),U=v(a(q),4),W=a(U,!0);r(U),r(q),r(N),B(()=>z(W,e(L))),o(V,N)},Ae=V=>{var N=Ft(),q=v(a(N),2),U=a(q),W=a(U),De=a(W);J(De,{icon:"lucide:filter",class:"w-4 h-4 text-gray-500"}),ke(2),r(W);var re=v(W,2),X=v(a(re),2);X.__change=i=>{const t=i.target.value;t&&(e(m).includes(t)||p(m,[...e(m),t],!0),i.target.value="")};var se=a(X);se.value=se.__value="";var Ee=v(se);y(Ee,17,()=>e(D),w,(i,t)=>{var d=C(),g=F(d);{var u=l=>{var s=ft(),b=a(s,!0);r(s);var x={};B(()=>{z(b,e(t).label),x!==(x=e(t).id)&&(s.value=(s.__value=e(t).id)??"")}),o(l,s)};k(g,l=>{e(m).includes(e(t).id)||l(u)})}o(i,d)}),r(X);var Te=v(X,2);y(Te,17,()=>e(m),w,(i,t)=>{var d=C(),g=F(d);y(g,17,()=>e(D).filter(u=>u.id===e(t)),w,(u,l)=>{var s=pt(),b=a(s),x=v(b);x.__click=()=>{p(m,e(m).filter(G=>G!==e(t)),!0)};var P=a(x);J(P,{icon:"lucide:x",class:"w-3 h-3"}),r(x),r(s),B(()=>z(b,`${e(l).label??""} `)),o(u,s)}),o(i,d)}),r(re);var ie=v(re,2),Y=v(a(ie),2);Y.__change=i=>{const t=i.target.value;t&&(e(h).includes(t)||p(h,[...e(h),t],!0),i.target.value="")};var oe=a(Y);oe.value=oe.__value="";var $e=v(oe);y($e,17,()=>e(j),w,(i,t)=>{var d=C(),g=F(d);{var u=l=>{var s=xt(),b=a(s,!0);r(s);var x={};B(()=>{z(b,e(t).label),x!==(x=e(t).id)&&(s.value=(s.__value=e(t).id)??"")}),o(l,s)};k(g,l=>{e(h).includes(e(t).id)||l(u)})}o(i,d)}),r(Y);var Ie=v(Y,2);y(Ie,17,()=>e(h),w,(i,t)=>{var d=C(),g=F(d);y(g,17,()=>e(j).filter(u=>u.id===e(t)),w,(u,l)=>{var s=gt(),b=a(s),x=v(b);x.__click=()=>{p(h,e(h).filter(G=>G!==e(t)),!0)};var P=a(x);J(P,{icon:"lucide:x",class:"w-3 h-3"}),r(x),r(s),B(()=>z(b,`${e(l).label??""} `)),o(u,s)}),o(i,d)}),r(ie);var ne=v(ie,2),Z=v(a(ne),2);Z.__change=i=>{const t=i.target.value;t&&(e(c).includes(t)||p(c,[...e(c),t],!0),i.target.value="")};var le=a(Z);le.value=le.__value="";var Ne=v(le);y(Ne,17,()=>e(ae),w,(i,t)=>{var d=C(),g=F(d);{var u=l=>{var s=_t(),b=a(s,!0);r(s);var x={};B(()=>{z(b,e(t)),x!==(x=e(t))&&(s.value=(s.__value=e(t))??"")}),o(l,s)};k(g,l=>{e(c).includes(e(t))||l(u)})}o(i,d)}),r(Z);var Pe=v(Z,2);y(Pe,17,()=>e(c),w,(i,t)=>{var d=mt(),g=a(d),u=v(g);u.__click=()=>{p(c,e(c).filter(s=>s!==e(t)),!0)};var l=a(u);J(l,{icon:"lucide:x",class:"w-3 h-3"}),r(u),r(d),B(()=>z(g,`${e(t)??""} `)),o(i,d)}),r(ne);var Ge=v(ne,2);{var He=i=>{var t=ht();t.__click=()=>{p(m,[],!0),p(h,[],!0),p(c,[],!0)},o(i,t)};k(Ge,i=>{(e(m).length>0||e(h).length>0||e(c).length>0)&&i(He)})}r(U),r(q);var ge=v(q,2),_e=a(ge),me=a(_e),ce=a(me),he=a(ce),de=a(he),be=a(de),Je=a(be);J(Je,{icon:"lucide:list",class:"w-4 h-4 text-green-600"}),ke(2),r(be),r(de);var Ke=v(de);y(Ke,17,()=>e(K),w,(i,t)=>{var d=bt(),g=a(d),u=a(g);J(u,{icon:"lucide:bar-chart-3",class:"w-4 h-4 text-blue-600"});var l=v(u,2),s=a(l,!0);r(l),r(g),r(d),B(()=>z(s,e(t).label)),o(i,d)}),r(he),r(ce);var ye=v(ce),Ve=a(ye);{var qe=i=>{var t=yt(),d=a(t);r(t),B(()=>Ce(d,"colspan",e(K).length+1)),o(i,t)},Oe=i=>{var t=C(),d=F(t);{var g=l=>{var s=wt();o(l,s)},u=l=>{var s=C(),b=F(s);y(b,17,()=>e(S),w,(x,P)=>{var G=Ct(),ve=a(G),ue=a(ve),we=a(ue);J(we,{icon:"lucide:list",class:"w-4 h-4 text-green-600 flex-shrink-0"});var Me=v(we,2),Qe=a(Me,!0);r(Me),r(ue),r(ve);var Re=v(ve);y(Re,17,()=>e(K),w,(Ue,We)=>{var fe=Bt(),Xe=a(fe);{var Ye=O=>{var pe=Mt();o(O,pe)},Ze=O=>{var pe=kt();o(O,pe)};k(Xe,O=>{Q(e(P).id,e(We).id)?O(Ye):O(Ze,!1)})}r(fe),o(Ue,fe)}),r(G),B(()=>{Ce(ue,"title",e(P).label),z(Qe,e(P).label)}),o(x,G)}),o(l,s)};k(d,l=>{e(K).length===0?l(g):l(u,!1)},!0)}o(i,t)};k(Ve,i=>{e(S).length===0?i(qe):i(Oe,!1)})}r(ye),r(me),r(_e),r(ge),r(N),o(V,N)};k(I,V=>{e(L)?V(A):V(Ae,!1)},!0)}o(n,_)};k(ze,n=>{e(T)?n(je):n(Le,!1)})}r(R),o(ee,R),Se()}et(["change","click"]);var jt=f('<meta name="description" content="Bus matrix view - understand data flow across your data models"/>'),Lt=f('<div class="flex items-center justify-center h-full text-gray-500"><p>Bus matrix view is not available.</p></div>');function Pt(ee,te){Fe(te,!0);const[D,j]=st();let E=M(!0),T=M(!1);(async()=>{try{const c=await ct();Be(ot,c);const S=await dt();p(T,S?.bus_matrix_enabled??!1,!0),e(T)?Be(nt,"bus_matrix"):window.location.href="/canvas"}catch(c){console.error("Failed to load bus matrix:",c),window.location.href="/canvas"}finally{p(E,!1)}})();var L=C();it("p3k2jg",c=>{var S=jt();at(()=>{rt.title="trellis - Bus Matrix"}),o(c,S)});var $=F(L);{var m=c=>{zt(c,{})},h=c=>{var S=C(),K=F(S);{var ae=Q=>{var R=Lt();o(Q,R)};k(K,Q=>{e(E)||Q(ae)},!0)}o(c,S)};k($,c=>{!e(E)&&e(T)?c(m):c(h,!1)})}o(ee,L),Se(),j()}export{Pt as component};
