id: modules-and-locals
title: "Use locals and modules correctly"
stack: terraform
difficulty: Master
xp: 500

goal: "Design a modular Terraform configuration using locals and reusable modules"

skills:
  - terraform-modules
  - terraform-locals
  - reusable-infrastructure
  - infrastructure-composition

hint: "Define locals for shared values and pass them into reusable modules."

validator: "validator.py"

mentor:
  why: "This lab develops mastery in Terraform design by composing infrastructure using locals and reusable modules, enabling scalable, maintainable, and professional-grade IaC codebases."
  intent: stretch

  guidance:
    before: |
      Think about how locals help centralize shared configuration
      and how modules enforce reuse and separation of concerns.

      Optional manual commands (not required for validation):
      These commands operate only on local files.
      Results are for personal verification only.

      - terraform fmt -check
      - terraform validate
    after: |
      Refactor the design to support multiple modules or shared locals
      across environments while maintaining clean boundaries.

  tags:
    - terraform
    - modules
    - locals
    - infrastructure-design

solution:
  overview: >
    At master level, Terraform design is about composition, boundaries,
    and reuse. This lab evaluates whether an engineer can correctly
    structure shared configuration using locals and pass it cleanly
    through modules without leaking implementation details.

  professional_reasoning:
    - Locals centralize shared configuration such as tags
    - Modules enforce reuse and reduce duplication
    - Data should flow downward: locals → module → resource
    - Clean interfaces improve long-term maintainability

  real_world_context:
    - Large Terraform codebases rely heavily on modules
    - Shared tagging and metadata are almost always centralized
    - Mature teams review module boundaries as carefully as resources

execution:
  runtime: docker
  requires_execution: false
  required_tools:
    - terraform
