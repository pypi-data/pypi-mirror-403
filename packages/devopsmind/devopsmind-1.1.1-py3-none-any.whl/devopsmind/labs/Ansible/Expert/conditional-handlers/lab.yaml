id: conditional-handlers
title: "Use conditionals and handlers correctly"
stack: ansible
difficulty: Expert
xp: 300

goal: "Demonstrate expert-level control flow using conditionals and handlers in Ansible"

skills:
  - ansible-conditionals
  - handlers
  - playbook-control-flow
  - operational-safety

hint: "Focus on when a change should trigger a side effect."

validator: "validator.py"

mentor:
  why: >
    This lab focuses on precise control flow in Ansible, ensuring tasks
    run only when needed and handlers trigger predictably. This discipline
    is essential for safe automation at scale.
  intent: stretch
  guidance:
    before: |
      Think about how Ansible determines whether a task reports change
      and how handlers depend on that signal.

      Optional manual testing (not required for validation):
      - ansible-playbook playbook.yml
      - ansible-playbook playbook.yml --check
    after: >
      Reflect on how poor handler discipline can cause unnecessary
      restarts and operational risk.
  tags:
    - ansible
    - conditionals
    - handlers
    - control-flow
    - reliability

solution:
  overview: >
    This solution evaluates mastery of change-driven control flow in
    configuration management. The focus is on ensuring that side effects
    occur only when real state changes happen, and that operational impact
    is minimized through predictable, deterministic behavior.

  professional_reasoning:
    - Trigger handlers only from tasks that report genuine state change
    - Use conditional logic to prevent unnecessary task execution
    - Isolate side effects so their impact is explicit and predictable
    - Design control flow to minimize operational blast radius

  real_world_context:
    - Do not mandate specific handler names
    - Avoid prescribing exact task ordering
    - Do not require real service restarts for validation
    - Maintain clear separation between state change and side effects
    - Avoid unconditional handlers
    - Ensure deterministic behavior across repeated runs

execution:
  runtime: docker
  requires_execution: false
  required_tools:
    - ansible-playbook
