id: role-structure-vars
title: "Design an Ansible role using variables"
stack: ansible
difficulty: Master
xp: 500

goal: "Design a reusable Ansible role that separates configuration from logic using variables"

skills:
  - ansible-roles
  - variable-management
  - reusable-automation
  - configuration-design
  - long-term-maintainability

hint: "Focus on how roles expose configuration while keeping tasks generic."

validator: "validator.py"

mentor:
  why: >
    This lab teaches how to design scalable and reusable Ansible roles
    by separating configuration from logic. This separation is essential
    for long-term maintainability in large automation codebases.
  intent: mastery
  guidance:
    before: |
      Think about how roles are consumed by other teams and environments,
      and what should remain configurable versus fixed.

      Optional manual testing (not required for validation):
      - ansible-playbook site.yml
    after: >
      Reflect on how variable defaults influence reuse, override behavior,
      and long-term maintenance.
  tags:
    - ansible
    - roles
    - variables
    - reusable-design
    - architecture

solution:
  overview: >
    This solution evaluates mastery of reusable Ansible role design.
    The emphasis is on separating configuration from execution so that
    roles can be safely reused across environments without modification,
    while remaining clear, maintainable, and override-friendly.

  professional_reasoning:
    - Follow the standard Ansible role directory structure
    - Define configuration values in defaults rather than hardcoding them in tasks
    - Reference variables symbolically instead of embedding literal values
    - Design roles to be reusable across environments without internal changes

  real_world_context:
    - Avoid prescribing exact variable names beyond their intended meaning
    - Do not include a runnable playbook as part of the role itself
    - Do not optimize the role for a single environment
    - Maintain clear separation between configuration and execution logic
    - Choose defaults that are sensible but easily overridable
    - Keep tasks generic and environment-agnostic

execution:
  runtime: docker
  requires_execution: false
  required_tools:
    - ansible-playbook
