id: multi-env-design
title: "Design multi-environment Terraform configuration"
stack: terraform
difficulty: Expert
xp: 300

goal: "Design a Terraform configuration that supports multiple environments without code duplication"

skills:
  - terraform-modularity
  - environment-configuration
  - infrastructure-design

hint: "Use variables, locals, and conditional expressions to avoid duplication."

validator: "validator.py"

mentor:
  why: "This lab focuses on designing scalable Terraform configurations that support multiple environments cleanly, a critical requirement for managing real-world infrastructure at scale."
  intent: stretch

  guidance:
    before: |
      Think about how Terraform configurations can support multiple
      environments without copying resource blocks.

      Focus on using variables, locals, and conditionals to centralize
      environment-specific behavior.

      Optional manual file verification commands (not required for validation):
      These commands operate only on local files.

      - terraform fmt -check
      - terraform validate
    after: |
      Refactor the design to use modules or workspaces to further improve
      reuse, isolation, and long-term maintainability.

  tags:
    - terraform
    - multi-environment
    - modularity
    - infrastructure-design

solution:
  overview: >
    At expert levels, Terraform design is about abstraction and reuse.
    This lab evaluates whether an engineer can model environment
    differences using variables and locals instead of duplicating
    infrastructure code.

  professional_reasoning:
    - Environment differences should be expressed as data, not structure
    - Locals centralize conditional logic and reduce repetition
    - Resource blocks should remain environment-agnostic
    - Clean separation improves maintainability and reviewability

  real_world_context:
    - Production Terraform code often supports dev, staging, and prod
    - Duplication increases drift and operational risk
    - Mature teams enforce DRY principles in IaC reviews

execution:
  runtime: docker
  requires_execution: false
  required_tools:
    - terraform
