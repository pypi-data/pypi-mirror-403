[build-system]
requires = ["setuptools>=77", "wheel", "setuptools_scm>=8"]
build-backend = "setuptools.build_meta"

[project]
name = "xbbg"
description = "Intuitive Bloomberg data API"
readme = { file = "README.md", content-type = "text/markdown" }
requires-python = ">=3.10,<3.15"
license = "Apache-2.0"
license-files = ["LICENSE"]
authors = [
  { name = "Alpha x1", email = "alpha.xone@outlook.com" },
]
classifiers = [
  "Development Status :: 5 - Production/Stable",
  "Intended Audience :: Financial and Insurance Industry",
  "Intended Audience :: Developers",
  "Topic :: Office/Business :: Financial",
  "Topic :: Office/Business :: Financial :: Investment",
  "Topic :: Software Development :: Libraries :: Python Modules",
  "Topic :: Scientific/Engineering :: Information Analysis",
  "Operating System :: OS Independent",
  "Programming Language :: Python :: 3",
  "Programming Language :: Python :: 3.10",
  "Programming Language :: Python :: 3.11",
  "Programming Language :: Python :: 3.12",
  "Programming Language :: Python :: 3.13",
  "Programming Language :: Python :: 3.14",
]
dynamic = ["version"]
dependencies = [
  "narwhals>=2.14.0",
  "numpy>=2.2.6",
  "pandas>=2.0",
  "pandas-market-calendars>=5.1.3",
  "pyarrow>=22.0.0",
  "ruamel.yaml>=0.18.16",
]

[project.optional-dependencies]
# Kept for compatibility if consumers expect extras, but dev/test tooling
# is managed via uv dependency groups below.
test = ["pytest", "pytest-cov", "coverage", "codecov"]
dev = ["ruff", "ipykernel", "build", "twine", "pre-commit"]
docs = ["sphinx>=5.3.0", "sphinx-rtd-theme>=2.0.0", "sphinx-llms-txt>=0.7.0"]

[project.urls]
Homepage = "https://github.com/alpha-xone/xbbg"
Documentation = "https://xbbg.readthedocs.io/"
Source = "https://github.com/alpha-xone/xbbg"
Issues = "https://github.com/alpha-xone/xbbg/issues"
Logo = "https://raw.githubusercontent.com/alpha-xone/xbbg/main/docs/xbbg.png"

[tool.setuptools_scm]
# Accept semantic versioning tags: v0.7.10, v0.7.12a1, v0.7.12b1, v0.7.12rc1
# Also supports legacy xbbg== prefix for backward compatibility
tag_regex = '^(?:v|xbbg==)?(?P<version>\d+\.\d+\.\d+(?:(?:a|b|rc|alpha|beta)\d+)?)$'
fallback_version = "0+unknown"

[tool.setuptools.packages.find]
include = ["xbbg*"]
exclude = ["xbbg.tests*"]

[tool.setuptools.package-data]
xbbg = ["markets/*.yml"]


[[tool.uv.index]]
name = "bloomberg"
url = "https://blpapi.bloomberg.com/repository/releases/python/simple/"
explicit = true

[tool.uv.sources]
blpapi = { index = "bloomberg" }

[tool.ruff]
target-version = "py310"
line-length = 120
exclude = [
  "examples/**",
  "docs/_build",
  "docs/conf.py",
  "Examples.ipynb",
  "dist",
  "venv",
  ".venv",
]

[tool.ruff.lint]
select = [
  "E",   # pycodestyle errors
  "W",   # pycodestyle warnings
  "F",   # pyflakes
  "I",   # isort
  "D",   # pydocstyle
  "UP",  # pyupgrade
  "B",   # flake8-bugbear
  "C4",  # flake8-comprehensions
  "SIM", # flake8-simplify
  "RET", # flake8-return
  "ISC", # implicit string concatenation
]
ignore = [
  "E701", # multiple statements on one line (colon)
  "E501", # line too long
  "D104", # Missing docstring in public package
  "D107", # Missing docstring in __init__
  "UP031", # Use format specifiers instead of percent format (intentionally using % for performance in logging)
  "S110", # try/except/pass detected (intentional in logging code to avoid recursion, and in fallback logic)
]

[tool.ruff.lint.per-file-ignores]
"xbbg/__init__.py" = ["F401"]
"xbbg/**/__init__.py" = ["F401"]
"xbbg/tests/**" = ["D"]
"xbbg/core/blpapi_logging.py" = ["S110"]  # Intentional try/except/pass to avoid recursive logging

[tool.ruff.lint.isort]
known-first-party = ["xbbg"]
combine-as-imports = true
force-sort-within-sections = true

[tool.ruff.lint.mccabe]
max-complexity = 12

[tool.ruff.lint.pydocstyle]
convention = "google"






[tool.pytest.ini_options]
addopts = "-ra"
filterwarnings = [
  "error::DeprecationWarning",
  "error::PendingDeprecationWarning",
  # FutureWarning filter handled in conftest.py to allow XbbgFutureWarning
]
markers = [
  "live_endpoint: marks tests as live Bloomberg endpoint tests (requires --run-xbbg-live to run)",
]
# Show logging output during test execution
log_cli = true
log_cli_level = "WARNING"
log_cli_format = "%(levelname)-8s %(name)s:%(filename)s:%(lineno)d %(message)s"
log_cli_date_format = "%H:%M:%S"

[dependency-groups]
dev = [
    "blpapi",
    "coverage>=7.11.0",
    "pytest-cov>=7.0.0",
    "ruff>=0.14.3",
]
