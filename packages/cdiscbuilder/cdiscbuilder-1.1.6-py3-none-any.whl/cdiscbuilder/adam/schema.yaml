version: "1.0"
definitions:
  column_general:
    type: dict
    properties:
      source: {type: str}
      literal: {type: [str, int, float, bool]}
      type: {type: str, enum: [str, int, float, bool]}
      max_missing_pct: {type: [int, float]}
      value_mapping: {type: dict}
      case_sensitive: {type: bool}
      prefix: {type: str}
      substring_start: {type: int}
      substring_length: {type: int}
      mapping_default: {type: [str, int, float, bool]}
      mapping_default_source: {type: str}
      fallback: {type: str}
      group: {type: list}
      sort_by: {type: list}
      dependency: {type: str}
      dependency_false_value: {type: [str, int, float, bool]}
      regex_extract: {type: str}

  column_findings:
    type: dict
    required: [name]
    properties:
      name: {type: str}
      label: {type: str}
      type: {type: str}
      literal: {type: [str, int, float, bool]}
      source: {type: str}
      function: {type: str}
      formoid: {type: [str, list]}
      itemoid: {type: [str, list]}
      value_mapping: {type: dict}
      case_sensitive: {type: bool}
      prefix: {type: str}
      substring_start: {type: int}
      substring_length: {type: int}
      mapping_default: {type: [str, int, float, bool]}
      mapping_default_source: {type: str}
      group: {type: list}
      sort_by: {type: list}

schemas:
  general_domain:
    type: list
    item_schema:
      type: dict
      required: [formoid, columns]
      properties:
        type: {type: str, enum: ["general", "finding"]}
        item_group_regex: {type: str}
        item_oid_regex: {type: str}
        formoid: {type: [str, list]}
        keys: {type: list}
        columns:
          type: dict
          values_schema: {ref: column_general}

  findings_domain:
    type: dict
    required: [type, columns]
    properties:
      type: {const: FINDINGS}
      definitions: {type: dict} # YAML Anchors container
      columns:
        type: list
        item_schema: {ref: column_findings}
