# Default values for mcp-context-server
# This is a YAML-formatted file.

# Image configuration
image:
  repository: ghcr.io/alex-feel/mcp-context-server
  # Defaults to Chart.appVersion if not set
  tag: ""
  pullPolicy: IfNotPresent

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

replicaCount: 1

# Service configuration
service:
  type: ClusterIP
  port: 8000

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: mcp-context-server.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: mcp-context-server-tls
  #    hosts:
  #      - mcp-context-server.local

# Resource limits
resources:
  requests:
    cpu: "100m"
    memory: "256Mi"
  limits:
    cpu: "500m"
    memory: "512Mi"

# Health probes
probes:
  liveness:
    enabled: true
    path: /health
    initialDelaySeconds: 30
    periodSeconds: 30
    failureThreshold: 3
  readiness:
    enabled: true
    path: /health
    initialDelaySeconds: 10
    periodSeconds: 10
    failureThreshold: 3
  startup:
    enabled: true
    path: /health
    initialDelaySeconds: 5
    periodSeconds: 10
    failureThreshold: 30

# Environment configuration
env:
  MCP_TRANSPORT: "http"
  FASTMCP_HOST: "0.0.0.0"
  FASTMCP_PORT: "8000"
  LOG_LEVEL: "INFO"

# Storage backend configuration
storage:
  backend: sqlite
  sqlite:
    enabled: true
    path: /data/context_storage.db
    persistence:
      enabled: true
      size: 1Gi
      storageClassName: ""
      accessModes:
        - ReadWriteOnce
  postgresql:
    enabled: false
    host: ""
    port: "5432"
    user: "postgres"
    password: ""
    database: "mcp_context"
    sslMode: "prefer"
    # Use existing secret for password
    existingSecret: ""
    existingSecretKey: "postgresql-password"

# Search features
search:
  fts:
    enabled: true
    language: "english"
  semantic:
    enabled: false
    # Embedding provider: ollama (default), openai, azure, huggingface, voyage
    provider: "ollama"
    model: "qwen3-embedding:0.6b"
    dim: 1024
    # Timeout and retry settings
    timeout: 30
    retryMaxAttempts: 3
    retryBaseDelay: 1.0
  hybrid:
    enabled: false
    rrfK: 60
    rrfOverfetch: 2  # Multiplier for over-fetching before RRF fusion
  # Text chunking for improved semantic search on long documents
  chunking:
    enabled: true
    size: 1000       # Target chunk size in characters
    overlap: 100     # Overlap between chunks in characters
    aggregation: max # How to aggregate chunk scores (only 'max' supported)
    dedupOverfetch: 5 # Multiplier for over-fetching before deduplication
  # Cross-encoder reranking for improved search precision
  reranking:
    enabled: true
    provider: flashrank
    model: ms-marco-MiniLM-L-12-v2
    maxLength: 512   # Maximum input length in tokens
    overfetch: 4     # Multiplier for over-fetching before reranking
    cacheDir: ""     # Custom cache directory for model files (empty = system default)
  # Default sort order for search results
  defaultSortBy: relevance  # Only 'relevance' supported in current version

# Ollama sidecar configuration (only used when search.semantic.provider=ollama)
ollama:
  enabled: false
  # Truncation control: false (default) returns error when context exceeded, true enables silent truncation
  truncate: false
  # Context window size in tokens (range: 512-131072)
  numCtx: 4096
  image:
    repository: ollama/ollama
    tag: "latest"
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: "500m"
      memory: "2Gi"
    limits:
      cpu: "2000m"
      memory: "4Gi"
  persistence:
    enabled: true
    size: 5Gi
    storageClassName: ""

# LangSmith tracing (optional)
langsmith:
  enabled: false
  # API key stored in secret
  apiKey: ""
  endpoint: "https://api.smith.langchain.com"
  project: "mcp-context-server"
  # Use existing secret
  existingSecret: ""
  existingSecretKey: "langsmith-api-key"

# Provider-specific API keys (stored in secrets)
embeddingSecrets:
  # OpenAI
  openaiApiKey: ""
  # Azure OpenAI
  azureOpenaiApiKey: ""
  azureOpenaiEndpoint: ""
  azureOpenaiDeployment: ""
  azureOpenaiApiVersion: "2024-02-01"
  # HuggingFace
  huggingfaceApiToken: ""
  # Voyage AI
  voyageApiKey: ""
  # Use existing secret for all provider keys
  existingSecret: ""

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 10001
  runAsGroup: 10001
  fsGroup: 10001

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  capabilities:
    drop:
      - ALL

# Service account
serviceAccount:
  create: true
  name: ""
  annotations: {}

nodeSelector: {}

tolerations: []

affinity: {}

# Pod annotations
podAnnotations: {}

# Pod labels
podLabels: {}
