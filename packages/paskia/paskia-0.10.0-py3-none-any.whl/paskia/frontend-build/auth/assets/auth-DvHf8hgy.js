import{_ as De,r as d,w as Ge,c as W,o as _e,n as ye,a as ke,b as _,d as f,e as a,f as D,g as Ae,h as it,F as de,i as ut,j as Pe,t as P,k as K,v as ct,l as Je,m as dt,s as ft,p as vt,q as ht,u as pt,x as ae,y as G,z as b,A as Fe,B as fe,C as Me,D as be,E as Ee,G as gt,H as Qe,N as mt,O as we,I as yt,J as wt,K as bt}from"./_plugin-vue_export-helper-D2l53SUz.js";import{u as xe,B as _t,U as Xe,_ as kt,a as It,N as xt,M as St,R as Ct,L as $t,b as Lt,A as Wt,c as At}from"./AccessDenied-DAdzg_MJ.js";import{i as je,a as ee,g as Oe,b as qe,c as Ye,s as Ze}from"./pow-2N9bxgAo.js";import{g as Ie}from"./helpers-DzjFIx78.js";const Be={};async function Pt(U="login"){if(Be[U])return Be[U];const o=await fetch("/auth/api/forward");if(o.status===401||o.status===403){const L=await o.json();if(L.auth?.iframe){let k=L.auth.iframe;return U!==L.auth.mode&&(k=k.replace(/mode=[^&]*/,`mode=${U}`)),Be[U]=k,k}}throw new Error("Unable to fetch auth iframe URL")}const Mt={class:"pairing-entry"},Et={key:0,class:"input-row"},Bt={class:"slot-word"},Dt={class:"typed-prefix"},Nt={class:"hint-suffix"},Ut={key:0,class:"cursor-overlay",style:{"--cursor-pos":0,"--word-len":0}},Tt=["placeholder"],Vt={key:0,class:"processing-status"},Ht={class:"processing-icon"},Rt={key:1,class:"device-info"},Kt={class:"device-permit-text"},zt={class:"device-meta"},Ft={key:0,class:"error-message",style:{"margin-top":"0.5rem"}},jt={class:"button-row",style:{"margin-top":"0.75rem",display:"flex",gap:"0.5rem"}},Ot=["disabled"],qt=["disabled"],Yt={__name:"RemoteAuthPermit",props:{title:{type:String,default:"Help Another Device Sign In"},description:{type:String,default:"Enter the code shown on the device that needs to sign in."},placeholder:{type:String,default:"Enter three words"},action:{type:String,default:"login"}},emits:["completed","error","cancelled","back","register","deviceInfoVisible"],setup(U,{expose:o,emit:L}){const k=L,I=d(!1),S=d(null),T=d(null);let c=null,V=null;try{V=xe()}catch{}const E=d(null),z=d(null),u=d(""),p=d(!1),m=d(""),v=d(null),h=d("");Ge(v,e=>{k("deviceInfoVisible",!!e)});const y=d(!1),A=d(!1),C=d(0),J=d(0),Q=d(0),re=d(!1),ve=d(!1);let te=0,se=!1,Y=null,ne=null,F=null,j=null,N=null,Z=null;function oe(e,s="info",t=3e3){V&&V.showMessage(e,s,t)}async function le(){try{const e=await dt();T.value=e}catch(e){console.warn("Unable to load settings",e)}}function ie(e,s){if(!e||s<0)return{word:"",start:0,end:0};let t=s,i=s;for(;t>0&&/[a-zA-Z]/.test(e[t-1]);)t--;for(;i<e.length&&/[a-zA-Z]/.test(e[i]);)i++;return{word:e.slice(t,i),start:t,end:i}}function X(e){return e.trim().split(/[.\s]+/).filter(s=>s.length>0)}function B(e){const s=X(e),t=[];for(const i of s){let l=i.toLowerCase();for(;l.length>0&&t.length<3;){let $=null;for(let w=Math.min(l.length,6);w>=3;w--){const x=l.slice(0,w);if(ee(x)){$=x;break}}if($)t.push($),l=l.slice($.length);else{t.push(l);break}}if(t.length>=3)break}return t}function he(e){const s=/[.\s]$/.test(e),t=B(e);return s?t.length:Math.max(0,t.length-1)}function pe(e){if(!e)return{valid:!0,segments:[]};const s=[],t=/[.\s]$/.test(e);let i,l=/([a-zA-Z]+)|([.\s]+)/g;for(;(i=l.exec(e))!==null;)i[1]?s.push({text:i[1],isWord:!0,start:i.index}):i[2]&&s.push({text:i[2],isWord:!1,start:i.index});const $=s.filter(x=>x.isWord);let w=!0;return $.forEach((x,H)=>{const M=H===$.length-1,q=x.text.toLowerCase();M&&!t?x.invalid=!je(q):x.invalid=!ee(q),x.invalid&&(w=!1)}),{valid:w,segments:s}}W(()=>{const{segments:e}=pe(u.value);return e.map(s=>({text:s.text,invalid:s.invalid||!1}))});function Se(e){return pe(e).valid}function Ce(e){return B(e).length>0&&B(e).every(s=>ee(s))}function ge(e){if(/[.\s]$/.test(e))return"";const t=e.match(/[a-zA-Z]+$/);return t?t[0].toLowerCase():""}function $e(e,s){if(!e||s===0)return{wordIndex:0,charIndex:0};const t=e.slice(0,s),i=/[.\s]$/.test(t),l=B(t);if(l.length===0)return{wordIndex:0,charIndex:0};if(i)return{wordIndex:Math.min(l.length,2),charIndex:0};const $=l[l.length-1],w=l.length-1;B(e);const x=$.length;return w<2&&!ve.value&&ee($)?{wordIndex:w+1,charIndex:0}:{wordIndex:Math.min(w,2),charIndex:x}}function ue(e,s){if(!e||s===0)return{wordIndex:0,charIndex:0};const t=e.slice(0,s),i=/[.\s]$/.test(t),l=B(t);if(l.length===0)return{wordIndex:0,charIndex:0};if(i)return{wordIndex:Math.min(l.length,2),charIndex:0};const $=l[l.length-1],w=l.length-1;return{wordIndex:Math.min(w,2),charIndex:$.length}}const r=W(()=>{const e=B(u.value),s=[],t=ge(u.value),i=h.value,l=/[.\s]$/.test(u.value),$=J.value!==Q.value,w=ue(u.value,Math.min(J.value,Q.value)),x=ue(u.value,Math.max(J.value,Q.value)),H=$?ue(u.value,C.value):$e(u.value,C.value);for(let M=0;M<3;M++){const q=H.wordIndex===M;let O=-1,R=-1;if($&&(M>w.wordIndex&&M<x.wordIndex?(O=0,R=e[M]?.length??0):M===w.wordIndex&&M===x.wordIndex?(O=w.charIndex,R=x.charIndex):M===w.wordIndex?(O=w.charIndex,R=e[M]?.length??0):M===x.wordIndex&&(O=0,R=x.charIndex)),M<e.length){const me=e[M].toLowerCase(),Ke=M===e.length-1,ze=Ke&&!l?!je(me):!ee(me);if(Ke&&!l&&i&&t){const lt=i.length;s.push({text:"",typedPrefix:t,hintSuffix:i.slice(t.length),invalid:ze,hasCursor:q,cursorCharIndex:q?H.charIndex:-1,wordLen:lt,selectionStartChar:O,selectionEndChar:R})}else s.push({text:me,invalid:ze,hasCursor:q,cursorCharIndex:q?H.charIndex:-1,wordLen:me.length,selectionStartChar:O,selectionEndChar:R})}else s.push({text:"",invalid:!1,hasCursor:q,cursorCharIndex:0,wordLen:0,selectionStartChar:O,selectionEndChar:R})}return s}),n=W(()=>J.value!==Q.value),g=W(()=>{const e=B(u.value);return e.length===3&&e.every(s=>ee(s))});function Ne(e){return B(e).join(".")}function tt(){if(!Y||F)return;const e=Ye(Y);F=Ze(e,ne).then(s=>{j=s,F=null})}async function Ue(){if(j){const s=j;return j=null,s}if(F){await F;const s=j;return j=null,s}if(!Y)throw new Error("No PoW challenge available");const e=Ye(Y);return await Ze(e,ne)}function Te(e){e?.challenge&&(Y=e.challenge,ne=e.work,j=null,F=null,tt())}async function Le(){if(!(c||se)){se=!0;try{const e=T.value?.auth_host,s="/auth/ws/remote-auth/permit",t=e&&location.host!==e?`//${e}${s}`:s;c=await vt(t);const i=await c.receive_json();if(i.status&&i.detail)throw new Error(i.detail);if(!i.pow?.challenge)throw new Error("Server did not send PoW challenge");Te(i.pow)}catch(e){throw console.error("WebSocket connection error:",e),c=null,e}finally{se=!1}}}function st(e){if(e.key==="Tab"||e.key===" "||e.key==="Escape"){at(e);return}setTimeout(Ve,0)}function Ve(){const e=E.value,s=e?.selectionStart??u.value.length,t=e?.selectionEnd??s,l=(e?.selectionDirection??"none")==="backward"?s:t;ve.value=l<te,te=l,C.value=l,Q.value=t,J.value=s}function nt(){C.value=E.value?.selectionStart??u.value.length;const{word:e,end:s}=ie(u.value,C.value);if(he(u.value)>=3||!e||e.length<1||C.value!==s){h.value="";return}const i=Oe(e.toLowerCase());i&&i!==e.toLowerCase()?h.value=i:h.value=""}function He(){if(!h.value)return!1;const{word:e,start:s,end:t}=ie(u.value,C.value);if(!e)return!1;const i=u.value.slice(0,s),w=B(i).length===2?"":" ",x=u.value.slice(t);u.value=i+h.value+w+x.trimStart();const H=s+h.value.length+w.length;return ye(()=>{E.value?.setSelectionRange(H,H),C.value=H}),h.value="",!0}function ce(){C.value=E.value?.selectionStart??u.value.length;const e=C.value,t=u.value.slice(0,e).match(/([a-zA-Z]+) $/);if(t){const l=t[1].toLowerCase(),$=Oe(l);if($&&$!==l&&!ee(l)){const w=e-t[0].length,x=u.value.slice(0,w),H=u.value.slice(e),O=B(x).length===2?"":" ";u.value=x+$+O+H;const R=w+$.length+O.length;ye(()=>{E.value?.setSelectionRange(R,R),C.value=R})}}nt(),N&&(clearTimeout(N),N=null),v.value=null,S.value=null,A.value=!1,y.value=!Se(u.value);const i=B(u.value);if(i.length>=1&&!c&&!se&&Le(),i.length===3){if(!Ce(u.value))return;N=setTimeout(()=>{ot()},150)}}async function ot(){if(!(p.value||I.value||!g.value||Ne(u.value)===Z&&v.value)){p.value=!0,m.value="pow",S.value=null,A.value=!1;try{if(await Le(),!c)throw new Error("Failed to connect");const s=await Ue(),t=qe(s),i=Ne(u.value);if(!g.value)return;m.value="server",c.send_json({code:i,pow:t});const l=await c.receive_json();if(Te(l.pow),typeof l.status=="number"&&l.status>=400){oe(l.detail||"Request failed","error"),A.value=!0,v.value=null,Z=null;return}l.status==="found"&&l.host?(v.value={host:l.host,user_agent_pretty:l.user_agent_pretty,client_ip:l.client_ip,action:l.action||"login"},Z=i,ye(()=>{z.value?.focus()})):(oe("Unexpected response from server","error"),A.value=!0,v.value=null,Z=null)}catch(s){console.error("Lookup error:",s),oe(s.message||"Lookup failed","error"),A.value=!0,v.value=null,Z=null,c&&(c.close(),c=null)}finally{p.value=!1,m.value=""}}}function at(e){if(e.key==="Escape"){u.value="",ce(),e.preventDefault();return}if(e.key==="Tab"){if(h.value&&He()){e.preventDefault(),ce();return}u.value.trim()&&e.preventDefault();return}e.key===" "&&h.value&&He()&&(e.preventDefault(),ce())}async function rt(){if(!(!v.value||I.value)){I.value=!0,S.value=null;try{if(c||await Le(),!c)throw new Error("Failed to connect");const e=await Ue(),s=qe(e);c.send_json({authenticate:!0,pow:s});const t=await c.receive_json();if(typeof t.status=="number"&&t.status>=400)throw new Error(t.detail||"Authentication failed");if(!t.optionsJSON)throw new Error(t.detail||"Failed to get authentication options");const i=await ft(t);c.send_json(i);const l=await c.receive_json();if(typeof l.status=="number"&&l.status>=400)throw new Error(l.detail||"Authentication failed");if(l.status==="success")oe("Device authenticated successfully!","success",3e3),k("completed"),We();else throw new Error(l.detail||"Authentication failed")}catch(e){console.error("Pairing error:",e);const s=e.name==="NotAllowedError"?"Passkey authentication was cancelled":e.message||"Authentication failed";S.value=s,k("error",s)}finally{I.value=!1,c&&(c.close(),c=null)}}}async function Re(){if(c){try{c.send_json({deny:!0}),await new Promise(e=>setTimeout(e,100))}catch(e){console.error("Error sending deny message:",e)}c.close(),c=null}We()}function We(){u.value="",S.value=null,A.value=!1,v.value=null,p.value=!1,m.value="",h.value="",y.value=!1,Z=null,c&&(c.close(),c=null),Y=null,ne=null,F=null,j=null}return _e(async()=>{await le(),ye(()=>{C.value=E.value?.selectionStart??0})}),ke(()=>{N&&(clearTimeout(N),N=null),c&&(c.close(),c=null)}),o({reset:We,deny:Re,code:u,handleInput:ce,loading:I,error:S}),(e,s)=>(f(),_("div",Mt,[a("form",{onSubmit:Je(rt,["prevent"]),class:"pairing-form"},[v.value?v.value?(f(),_("div",Rt,[a("p",Kt,[K("Permit "+P(v.value.action==="register"?"registration":"login")+" to ",1),a("strong",null,P(v.value.host),1)]),a("p",zt,P(v.value.user_agent_pretty),1),S.value?(f(),_("p",Ft,P(S.value),1)):D("",!0),a("div",jt,[a("button",{type:"button",class:"btn-secondary",disabled:I.value,onClick:Re,style:{flex:"1"}}," Deny ",8,Ot),a("button",{ref_key:"submitBtnRef",ref:z,type:"submit",disabled:I.value,class:"btn-primary",style:{flex:"1"}},P(I.value?"Authenticatingâ€¦":"Authorize"),9,qt)])])):D("",!0):(f(),_("div",Et,[a("div",{class:Ae(["input-wrapper",{"has-error":A.value,"is-complete":v.value&&!A.value,focused:re.value,"has-selection":n.value}])},[a("div",{class:Ae(["slot-machine",{"has-error":A.value,"is-complete":v.value&&!A.value}]),"aria-hidden":"true"},[(f(!0),_(de,null,ut(r.value,(t,i)=>(f(),_("div",{key:i,class:Ae(["slot-reel",{"invalid-word":t.invalid,empty:!t.text&&!t.typedPrefix}])},[a("div",Bt,[t.selectionStartChar>=0&&t.selectionEndChar>t.selectionStartChar?(f(),_("span",{key:0,class:"selection-overlay",style:Pe({"--sel-start":t.selectionStartChar,"--sel-end":t.selectionEndChar,"--word-len":t.wordLen})},null,4)):D("",!0),t.typedPrefix?(f(),_(de,{key:1},[a("span",Dt,P(t.typedPrefix),1),a("span",Nt,P(t.hintSuffix),1),t.hasCursor?(f(),_("span",{key:0,class:"cursor-overlay",style:Pe({"--cursor-pos":t.cursorCharIndex,"--word-len":t.wordLen})},null,4)):D("",!0)],64)):t.text?(f(),_(de,{key:2},[K(P(t.text)+" ",1),t.hasCursor?(f(),_("span",{key:0,class:"cursor-overlay",style:Pe({"--cursor-pos":t.cursorCharIndex,"--word-len":t.wordLen})},null,4)):D("",!0)],64)):(f(),_(de,{key:3},[t.hasCursor?(f(),_("span",Ut)):D("",!0)],64))])],2))),128))],2),it(a("input",{ref_key:"inputRef",ref:E,"onUpdate:modelValue":s[0]||(s[0]=t=>u.value=t),type:"text",placeholder:U.placeholder,autocomplete:"off",autocapitalize:"none",autocorrect:"off",spellcheck:"false",class:"pairing-input hidden-input",onInput:ce,onKeydown:st,onMouseup:Ve,onFocus:s[1]||(s[1]=t=>re.value=!0),onBlur:s[2]||(s[2]=t=>re.value=!1)},null,40,Tt),[[ct,u.value]])],2),m.value?(f(),_("div",Vt,[a("span",Ht,P(m.value==="pow"?"ðŸ”":"ðŸ“¡"),1),s[3]||(s[3]=a("span",{class:"processing-spinner-small"},null,-1))])):D("",!0)]))],32)]))}},Zt=De(Yt,[["__scopeId","data-v-77a073d9"]]),Gt={class:"view-root","data-view":"profile"},Jt={class:"view-header"},Qt={class:"remote-auth-inline"},Xt={key:0,class:"remote-auth-label"},es={class:"section-block"},ts={class:"section-body"},ss={class:"section-block"},ns=["disabled"],os=["disabled"],as=["disabled"],rs={key:0,class:"logout-note"},ls={key:1,class:"logout-note"},is={__name:"ProfileView",setup(U){const o=xe(),L=d(null),k=d(!1),I=d(!1),S=d(""),T=d(!1),c=d(null),V=d(null),E=d(!1),z=d(null),u=d(null),p=d(null),m=d(null),v=d(null),h=d(null),y=d(null),A=d(null),C=W(()=>k.value||I.value);Ge(k,r=>{r&&(S.value=o.userInfo?.ctx.user.display_name??"")}),_e(()=>{L.value=setInterval(()=>{o.userInfo&&(o.userInfo={...o.userInfo})},6e4)}),ke(()=>{L.value&&clearInterval(L.value)});const J=async()=>{try{await gt.register(null,null,()=>{o.showMessage("Adding new passkey...","info")}),await o.loadUserInfo(),o.showMessage("New passkey added successfully!","success",3e3)}catch(r){console.error("Failed to add new passkey:",r),o.showMessage(r.message,"error")}},Q=()=>{o.showMessage("The other device is now signed in!","success",4e3),setTimeout(()=>z.value?.reset(),3e3)},re=r=>{r.includes("cancelled")||o.showMessage(r,"error",4e3)},ve=()=>{o.showMessage("ðŸ“‹ Link copied! Send it to your other device."),I.value=!1},te=r=>{Me(r,{primarySelector:".btn-primary",itemSelector:"button"})},se=r=>{if(C.value)return;const n=fe(r);n&&n==="down"&&(r.preventDefault(),Me(A.value,{primarySelector:".mini-btn",itemSelector:".mini-btn, .pairing-input"}))},Y=r=>{if(C.value)return;const n=fe(r);if(!n)return;r.preventDefault(),n==="left"||n==="right"?be(A.value,r.target,n,{itemSelector:".mini-btn, .pairing-input"}):n==="up"?h.value?.focusCurrent?.():n==="down"&&u.value?.$el?.focus()},ne=r=>{C.value||(r==="down"||r==="right"?te(p.value):(r==="up"||r==="left")&&Me(A.value,{primarySelector:".mini-btn",itemSelector:".mini-btn, .pairing-input"}))},F=r=>{if(C.value)return;const n=fe(r);n&&(r.preventDefault(),n==="left"||n==="right"?be(p.value,r.target,n,{itemSelector:"button"}):n==="up"?Ee(u.value?.$el,0,{itemSelector:".credential-item"}):n==="down"&&Ee(m.value?.$el,0,{itemSelector:".session-group"}))},j=r=>{C.value||(r==="up"?te(p.value):r==="down"&&te(v.value))},N=r=>{if(C.value)return;const n=fe(r);n&&(r.preventDefault(),n==="left"||n==="right"?be(v.value,r.target,n,{itemSelector:"button"}):n==="up"&&Ee(m.value?.$el,-1,{itemSelector:".session-group"}))},Z=async r=>{const n=r?.credential;if(n)try{await o.deleteCredential(n),o.showMessage("Passkey deleted! You should also remove it from your password manager or device.","success",3e3)}catch(g){o.showMessage(`Failed to delete passkey: ${g.message}`,"error")}},oe=W(()=>o.settings?.rp_name||"this service"),le=W(()=>o.userInfo?.sessions||[]),ie=W(()=>le.value.find(n=>n.is_current)?.host||"this host"),X=d({}),B=async r=>{const n=r?.id;if(n){X.value={...X.value,[n]:!0};try{await o.terminateSession(n)}catch(g){o.showMessage(g.message||"Failed to terminate session","error",5e3)}finally{const g={...X.value};delete g[n],X.value=g}}},he=async()=>{await o.logoutEverywhere()},pe=async()=>{await o.logout()},Se=()=>{S.value=o.userInfo?.ctx.user.display_name??"",k.value=!0},Ce=W(()=>{const r=o.userInfo?.ctx.permissions;return r.includes("auth:admin")||r.includes("auth:org:admin")}),ge=W(()=>le.value.length>1),$e=W(()=>{const r=[{label:"Auth",href:ht()}];return Ce.value&&r.push({label:"Admin",href:pt()}),r}),ue=async()=>{const r=S.value.trim();if(!r){o.showMessage("Name cannot be empty","error");return}try{T.value=!0,await Qe("/auth/api/user/display-name",{method:"PATCH",body:{display_name:r}}),k.value=!1,await o.loadUserInfo(),o.showMessage("Name updated successfully!","success",3e3)}catch(n){o.showMessage(n.message||"Failed to update name","error")}finally{T.value=!1}};return(r,n)=>(f(),_("section",Gt,[a("header",Jt,[n[10]||(n[10]=a("h1",null,"User Profile",-1)),ae(_t,{ref_key:"breadcrumbs",ref:h,entries:$e.value,onKeydown:se},null,8,["entries"]),n[11]||(n[11]=a("p",{class:"view-lede"},"Account dashboard for managing credentials and authenticating with other devices.",-1))]),a("section",{class:"section-block",ref_key:"userInfoSection",ref:A},[b(o).userInfo?.ctx?(f(),G(Xe,{key:0,ref_key:"userBasicInfo",ref:y,name:b(o).userInfo.ctx.user.display_name,visits:b(o).userInfo.visits,"created-at":b(o).userInfo.created_at,"last-seen":b(o).userInfo.last_seen,loading:b(o).isLoading,"update-endpoint":"/auth/api/user/display-name",onSaved:n[1]||(n[1]=g=>b(o).loadUserInfo()),onEditName:Se,onKeydown:Y},{default:Fe(()=>[a("div",Qt,[E.value?D("",!0):(f(),_("label",Xt,"Code words:")),ae(Zt,{ref_key:"pairingEntry",ref:z,title:"",description:"",onCompleted:Q,onError:re,onDeviceInfoVisible:n[0]||(n[0]=g=>E.value=g)},null,512)]),n[12]||(n[12]=a("p",{class:"remote-auth-description"},"Provided by another device requesting remote auth.",-1))]),_:1},8,["name","visits","created-at","last-seen","loading"])):D("",!0)],512),a("section",es,[n[13]||(n[13]=a("div",{class:"section-header"},[a("h2",null,"Your Passkeys"),a("p",{class:"section-description"},[K("Ideally have at least two passkeys in case you lose one. More than one user can be registered on the same device, giving you a choice at login. "),a("a",{href:"https://bitwarden.com/pricing/",target:"_blank",rel:"noopener noreferrer"},"Bitwarden"),K(" can sync one passkey to all your devices. Other secure options include "),a("b",null,"local passkeys"),K(", as well as hardware keys such as "),a("a",{href:"https://www.yubico.com",target:"_blank",rel:"noopener noreferrer"},"YubiKey"),K(". Cloud sync via Google, Microsoft or iCloud is discouraged.")])],-1)),a("div",ts,[ae(kt,{ref_key:"credentialList",ref:u,credentials:b(o).userInfo?.credentials||[],"aaguid-info":b(o).userInfo?.aaguid_info||{},loading:b(o).isLoading,"hovered-credential-uuid":c.value,"hovered-session-credential-uuid":V.value?.credential,"navigation-disabled":C.value,"allow-delete":"",onDelete:Z,onCredentialHover:n[2]||(n[2]=g=>c.value=g),onNavigateOut:ne},null,8,["credentials","aaguid-info","loading","hovered-credential-uuid","hovered-session-credential-uuid","navigation-disabled"]),a("div",{class:"button-row",ref_key:"credentialButtons",ref:p},[a("button",{onClick:J,class:"btn-primary",onKeydown:F},"Register New",32),a("button",{onClick:n[3]||(n[3]=g=>I.value=!0),class:"btn-secondary",onKeydown:F},"Another Device",32)],512)])]),ae(It,{ref_key:"sessionList",ref:m,sessions:le.value,"terminating-sessions":X.value,"hovered-credential-uuid":c.value,"navigation-disabled":C.value,onTerminate:B,onSessionHover:n[4]||(n[4]=g=>V.value=g),onNavigateOut:j,"section-description":"You are currently signed in to the following sessions. If you don't recognize something, consider deleting not only the session but the associated passkey you suspect is compromised, as only this terminates all linked sessions and prevents logging in again."},null,8,["sessions","terminating-sessions","hovered-credential-uuid","navigation-disabled"]),k.value?(f(),G(St,{key:0,onClose:n[7]||(n[7]=g=>k.value=!1)},{default:Fe(()=>[n[14]||(n[14]=a("h3",null,"Edit Display Name",-1)),a("form",{onSubmit:Je(ue,["prevent"]),class:"modal-form"},[ae(xt,{label:"Display Name",modelValue:S.value,"onUpdate:modelValue":n[5]||(n[5]=g=>S.value=g),busy:T.value,onCancel:n[6]||(n[6]=g=>k.value=!1)},null,8,["modelValue","busy"])],32)]),_:1})):D("",!0),a("section",ss,[a("div",{class:"button-row",ref_key:"logoutButtons",ref:v},[a("button",{type:"button",class:"btn-secondary",onClick:n[8]||(n[8]=(...g)=>b(Ie)&&b(Ie)(...g)),onKeydown:N}," Back ",32),ge.value?(f(),_(de,{key:1},[a("button",{onClick:pe,class:"btn-danger",disabled:b(o).isLoading,onKeydown:N},"Logout",40,os),a("button",{onClick:he,class:"btn-danger",disabled:b(o).isLoading,onKeydown:N},"All",40,as)],64)):(f(),_("button",{key:0,onClick:he,class:"btn-danger",disabled:b(o).isLoading,onKeydown:N},"Logout",40,ns))],512),ge.value?(f(),_("p",ls,[n[16]||(n[16]=a("strong",null,"Logout",-1)),K(" this session on "+P(ie.value)+", or ",1),n[17]||(n[17]=a("strong",null,"All",-1)),K(" sessions across all sites and devices for "+P(oe.value)+". You'll need to log in again with your passkey afterwards.",1)])):(f(),_("p",rs,[n[15]||(n[15]=a("strong",null,"Logout",-1)),K(" from "+P(ie.value)+".",1)]))]),I.value?(f(),G(Ct,{key:1,endpoint:"/auth/api/user/create-link",onClose:n[9]||(n[9]=g=>I.value=!1),onCopied:ve})):D("",!0)]))}},us=De(is,[["__scopeId","data-v-70360523"]]),cs={class:"view-root host-view","data-view":"host-profile"},ds={class:"view-header"},fs={class:"view-lede"},vs={class:"section-body"},hs={key:1,class:"empty-state"},ps={class:"section-block"},gs={class:"section-body host-actions"},ms=["disabled"],ys=["disabled"],ws={class:"note"},bs={__name:"HostProfileView",props:{initializing:{type:Boolean,default:!1}},setup(U){const o=xe(),L=window.location.host,k=d(null),I=d(null),S=W(()=>o.userInfo?.ctx||null),T=W(()=>S.value?.org.display_name??""),c=W(()=>S.value?.role.display_name??""),V=W(()=>{const h=o.settings?.rp_name;return h?`${h} account`:"Account overview"}),E=W(()=>`You're signed in to ${L}.`),z=W(()=>o.settings?.auth_host||""),u=W(()=>{const h=z.value;if(!h)return"";let y=o.settings?.ui_base_path??"/auth/";return y.startsWith("/")||(y=`/${y}`),y.endsWith("/")||(y=`${y}/`),`${window.location.protocol||"https:"}//${h}${y}`}),p=()=>{u.value&&(window.location.href=u.value)},m=async()=>{await o.logout()},v=h=>{const y=fe(h);y&&(h.preventDefault(),(y==="left"||y==="right")&&be(I.value,h.target,y,{itemSelector:"button"}))};return(h,y)=>(f(),_("section",cs,[a("header",ds,[a("h1",null,P(V.value),1),a("p",fs,P(E.value),1)]),a("section",{class:"section-block",ref_key:"userInfoSection",ref:k},[a("div",vs,[S.value?(f(),G(Xe,{key:0,name:S.value.user.display_name,visits:b(o).userInfo?.visits||0,"created-at":b(o).userInfo?.created_at,"last-seen":b(o).userInfo?.last_seen,"org-display-name":T.value,"role-name":c.value,"can-edit":!1},null,8,["name","visits","created-at","last-seen","org-display-name","role-name"])):(f(),_("p",hs,P(U.initializing?"Loading your accountâ€¦":"No active session found."),1))])],512),a("section",ps,[a("div",gs,[a("div",{class:"button-row",ref_key:"buttonRow",ref:I,onKeydown:v},[a("button",{type:"button",class:"btn-secondary",onClick:y[0]||(y[0]=(...A)=>b(Ie)&&b(Ie)(...A))}," Back "),a("button",{type:"button",class:"btn-danger",disabled:b(o).isLoading,onClick:m},P(b(o).isLoading?"Signing outâ€¦":"Logout"),9,ms),u.value?(f(),_("button",{key:0,type:"button",class:"btn-primary",disabled:b(o).isLoading,onClick:p}," Full Profile ",8,ys)):D("",!0)],544),a("p",ws,[y[1]||(y[1]=a("strong",null,"Logout",-1)),K(" from "+P(b(L))+", or access your ",1),y[2]||(y[2]=a("strong",null,"Full Profile",-1)),K(" at "+P(z.value)+" (you may need to sign in again).",1)])])])]))}},_s=De(bs,[["__scopeId","data-v-237999a2"]]),ks={class:"app-shell"},Is={class:"app-main"},xs={__name:"App",setup(U){const o=xe(),L=d("loading"),k=d("Loading...");function I(p){if(!p)return null;const m=p.trim().toLowerCase();return m?m.replace(/:80$/,"").replace(/:443$/,""):null}const S=W(()=>{const p=o.settings?.auth_host;if(!p)return!1;const m=I(window.location.host),v=I(p);return m!==v});W(()=>o.userInfo?.ctx.user.uuid);function T(){o.userInfo=null,L.value="terminal"}const c=()=>o.userInfo?.ctx.user.uuid,V=new mt(c,T);_e(()=>V.start()),ke(()=>V.stop());async function E(){try{return o.userInfo=await Qe("/auth/api/user-info",{method:"POST"}),L.value="profile",!0}catch{return o.userInfo=null,!1}}async function z(){const p=await Pt("login");yt(p),k.value="Authentication required..."}function u(p){const m=p.data;if(m?.type)switch(m.type){case"auth-success":we(),L.value="loading",k.value="Loading user profile...",E();break;case"auth-error":m.cancelled?console.log("Authentication cancelled by user"):o.showMessage(m.message||"Authentication failed","error",5e3);break;case"auth-cancelled":console.log("Authentication cancelled");break;case"auth-back":we(),T();break;case"auth-close-request":we();break}}return _e(async()=>{window.addEventListener("message",u),await o.loadSettings();const p=o.settings?.rp_name;if(p){const v=o.settings?.auth_host,h=v&&I(window.location.host)!==I(v);document.title=h?`${p} Â· Account summary`:p}await E()||z()}),ke(()=>{window.removeEventListener("message",u),we()}),(p,m)=>(f(),_("div",ks,[ae(Lt),a("main",Is,[L.value==="profile"&&S.value?(f(),G(_s,{key:0})):L.value==="profile"?(f(),G(us,{key:1})):L.value==="loading"?(f(),G($t,{key:2,message:k.value},null,8,["message"])):L.value==="terminal"?(f(),G(Wt,{key:3})):D("",!0)])]))}},et=wt(xs);et.use(At());et.mount("#app");bt();
