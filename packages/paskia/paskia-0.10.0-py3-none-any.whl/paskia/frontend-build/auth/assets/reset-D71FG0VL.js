import{_ as M,Q as N,r as i,c as m,a6 as b,o as $,b as c,d as u,f as z,e as t,t as p,g as F,h as K,v as V,L as D,m as E,H as x,a7 as I,a8 as G,G as H,J as L,K as U}from"./_plugin-vue_export-helper-D2l53SUz.js";const j={class:"app-shell"},J={key:0,class:"global-status",style:{display:"block"}},O={class:"view-root"},Q={class:"surface surface--tight",style:{"max-width":"560px",margin:"0 auto",width:"100%"}},Y={class:"view-header",style:{"text-align":"center"}},q={class:"view-lede"},W={key:0,class:"section-block"},X={key:1,class:"section-block"},Z={key:2,class:"section-block"},ee={class:"section-body"},se={class:"name-edit"},te=["disabled"],ae=["disabled"],ne={__name:"ResetApp",setup(ie){const o=N({show:!1,message:"",type:"info"}),d=i(!0),n=i(!1),l=i(""),T=i(null),g=i(null),h=i(""),y=i("");let v=null;const P=m(()=>g.value?.token_type||"your enrollment"),R=m(()=>d.value?"Preparing your secure enrollmentâ€¦":f.value?`Finish up ${P.value}. You may edit the name below if needed, and it will be saved to your passkey.`:"This authentication link is no longer valid.");m(()=>b());const f=m(()=>!!(l.value&&g.value));function r(e,s="info",a=3e3){o.show=!0,o.message=e,o.type=s,v&&clearTimeout(v),a>0&&(v=setTimeout(()=>{o.show=!1},a))}async function S(){try{const e=await E();T.value=e,e?.rp_name&&(document.title=`${e.rp_name} Â· Passkey Setup`)}catch(e){console.warn("Unable to load settings",e)}}async function B(){if(l.value)try{g.value=await x("/auth/api/token-info",{method:"GET",headers:{Authorization:`Bearer ${l.value}`}}),h.value=g.value.display_name}catch(e){console.error("Failed to load token info",e);const s=e instanceof I?e.data?.detail||"The authentication link is invalid or expired.":G(e);y.value=s}}async function _(){if(!f.value||n.value)return;n.value=!0,r("Starting passkey registrationâ€¦","info");let e;try{const s=h.value.trim()||null;e=await H.register(l.value,s)}catch(s){n.value=!1;const a=s?.message||"Passkey registration cancelled",w=a==="Passkey registration cancelled";r(w?a:`Registration failed: ${a}`,w?"info":"error",4e3);return}try{await C(e)}catch(s){n.value=!1;const a=s?.message||"Failed to establish session";r(a,"error",4e3);return}r("Passkey registered successfully!","success",800),setTimeout(()=>{n.value=!1,k()},800)}async function C(e){if(!e?.session_token)throw new Error("Registration response missing session_token");return await x("/auth/api/set-session",{method:"POST",headers:{Authorization:`Bearer ${e.session_token}`}})}function k(){const e=b.value||"/auth/";window.location.pathname!==e&&history.replaceState(null,"",e),window.location.reload()}function A(){const e=window.location.pathname.split("/").filter(Boolean);if(!e.length)return"";const s=e[e.length-1],a=e.slice(0,-1);return a.length>1||a.length===1&&a[0]!=="auth"||!s.includes(".")?"":s}return $(async()=>{if(l.value=A(),await S(),!l.value){const e="Reset link is missing or malformed.";y.value=e,r(e,"error",0),d.value=!1;return}await B(),d.value=!1}),(e,s)=>(u(),c("div",j,[o.show?(u(),c("div",J,[t("div",{class:F(["status",o.type])},p(o.message),3)])):z("",!0),t("main",O,[t("div",Q,[t("header",Y,[s[1]||(s[1]=t("h1",null,"ðŸ”‘ Registration",-1)),t("p",q,p(R.value),1)]),d.value?(u(),c("section",W,[...s[2]||(s[2]=[t("div",{class:"section-body center"},[t("p",null,"Loading reset detailsâ€¦")],-1)])])):f.value?(u(),c("section",Z,[t("div",ee,[t("label",se,[s[3]||(s[3]=t("span",null,"ðŸ‘¤ Name",-1)),K(t("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=a=>h.value=a),disabled:n.value,maxlength:"64",onKeyup:D(_,["enter"])},null,40,te),[[V,h.value]])]),t("button",{class:"btn-primary",disabled:n.value,onClick:_},p(n.value?"Registeringâ€¦":"Register Passkey"),9,ae)])])):(u(),c("section",X,[t("div",{class:"section-body center"},[t("div",{class:"button-row center",style:{"justify-content":"center"}},[t("button",{class:"btn-secondary",onClick:k},"Return to sign-in")])])]))])])]))}},oe=M(ne,[["__scopeId","data-v-4830d223"]]);L(oe).mount("#app");U();
