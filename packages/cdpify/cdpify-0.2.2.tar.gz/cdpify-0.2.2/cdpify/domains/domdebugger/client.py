# This file is auto-generated by the CDP protocol generator.
# Do not edit this file manually as your changes will be overwritten.
# Generated from Chrome DevTools Protocol specifications.

from __future__ import annotations

from typing import TYPE_CHECKING, Any

if TYPE_CHECKING:
    from cdpify.client import CDPClient

from cdpify.shared.decorators import deprecated

from .commands import (
    DOMDebuggerCommand,
    GetEventListenersParams,
    GetEventListenersResult,
    RemoveDOMBreakpointParams,
    RemoveEventListenerBreakpointParams,
    RemoveInstrumentationBreakpointParams,
    RemoveXHRBreakpointParams,
    SetBreakOnCSPViolationParams,
    SetDOMBreakpointParams,
    SetEventListenerBreakpointParams,
    SetInstrumentationBreakpointParams,
    SetXHRBreakpointParams,
)

from .types import (
    CSPViolationType,
    DOMBreakpointType,
)

if TYPE_CHECKING:
    from cdpify.domains import dom, runtime


class DOMDebuggerClient:
    def __init__(self, client: CDPClient) -> None:
        self._client = client

    async def get_event_listeners(
        self,
        *,
        object_id: runtime.RemoteObjectId,
        depth: int | None = None,
        pierce: bool | None = None,
        session_id: str | None = None,
    ) -> GetEventListenersResult:
        """
        Returns event listeners of the given object.
        """
        params = GetEventListenersParams(
            object_id=object_id, depth=depth, pierce=pierce
        )

        result = await self._client.send_raw(
            method=DOMDebuggerCommand.GET_EVENT_LISTENERS,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetEventListenersResult.from_cdp(result)

    async def remove_dom_breakpoint(
        self,
        *,
        node_id: dom.NodeId,
        type: DOMBreakpointType,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Removes DOM breakpoint that was set using `setDOMBreakpoint`.
        """
        params = RemoveDOMBreakpointParams(node_id=node_id, type=type)

        result = await self._client.send_raw(
            method=DOMDebuggerCommand.REMOVE_DOM_BREAKPOINT,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def remove_event_listener_breakpoint(
        self,
        *,
        event_name: str,
        target_name: str | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Removes breakpoint on particular DOM event.
        """
        params = RemoveEventListenerBreakpointParams(
            event_name=event_name, target_name=target_name
        )

        result = await self._client.send_raw(
            method=DOMDebuggerCommand.REMOVE_EVENT_LISTENER_BREAKPOINT,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    @deprecated()
    async def remove_instrumentation_breakpoint(
        self,
        *,
        event_name: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Removes breakpoint on particular native event.
        """
        params = RemoveInstrumentationBreakpointParams(event_name=event_name)

        result = await self._client.send_raw(
            method=DOMDebuggerCommand.REMOVE_INSTRUMENTATION_BREAKPOINT,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def remove_xhr_breakpoint(
        self,
        *,
        url: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Removes breakpoint from XMLHttpRequest.
        """
        params = RemoveXHRBreakpointParams(url=url)

        result = await self._client.send_raw(
            method=DOMDebuggerCommand.REMOVE_XHR_BREAKPOINT,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def set_break_on_csp_violation(
        self,
        *,
        violation_types: list[CSPViolationType],
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Sets breakpoint on particular CSP violations.
        """
        params = SetBreakOnCSPViolationParams(violation_types=violation_types)

        result = await self._client.send_raw(
            method=DOMDebuggerCommand.SET_BREAK_ON_CSP_VIOLATION,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def set_dom_breakpoint(
        self,
        *,
        node_id: dom.NodeId,
        type: DOMBreakpointType,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Sets breakpoint on particular operation with DOM.
        """
        params = SetDOMBreakpointParams(node_id=node_id, type=type)

        result = await self._client.send_raw(
            method=DOMDebuggerCommand.SET_DOM_BREAKPOINT,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def set_event_listener_breakpoint(
        self,
        *,
        event_name: str,
        target_name: str | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Sets breakpoint on particular DOM event.
        """
        params = SetEventListenerBreakpointParams(
            event_name=event_name, target_name=target_name
        )

        result = await self._client.send_raw(
            method=DOMDebuggerCommand.SET_EVENT_LISTENER_BREAKPOINT,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    @deprecated()
    async def set_instrumentation_breakpoint(
        self,
        *,
        event_name: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Sets breakpoint on particular native event.
        """
        params = SetInstrumentationBreakpointParams(event_name=event_name)

        result = await self._client.send_raw(
            method=DOMDebuggerCommand.SET_INSTRUMENTATION_BREAKPOINT,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def set_xhr_breakpoint(
        self,
        *,
        url: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Sets breakpoint on XMLHttpRequest.
        """
        params = SetXHRBreakpointParams(url=url)

        result = await self._client.send_raw(
            method=DOMDebuggerCommand.SET_XHR_BREAKPOINT,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result
