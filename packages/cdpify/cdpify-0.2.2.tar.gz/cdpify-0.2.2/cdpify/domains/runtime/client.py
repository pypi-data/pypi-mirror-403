# This file is auto-generated by the CDP protocol generator.
# Do not edit this file manually as your changes will be overwritten.
# Generated from Chrome DevTools Protocol specifications.

from __future__ import annotations

from typing import TYPE_CHECKING, Any

if TYPE_CHECKING:
    from cdpify.client import CDPClient

from .commands import (
    RuntimeCommand,
    AddBindingParams,
    AwaitPromiseParams,
    AwaitPromiseResult,
    CallFunctionOnParams,
    CallFunctionOnResult,
    CompileScriptParams,
    CompileScriptResult,
    EvaluateParams,
    EvaluateResult,
    GetExceptionDetailsParams,
    GetExceptionDetailsResult,
    GetHeapUsageResult,
    GetIsolateIdResult,
    GetPropertiesParams,
    GetPropertiesResult,
    GlobalLexicalScopeNamesParams,
    GlobalLexicalScopeNamesResult,
    QueryObjectsParams,
    QueryObjectsResult,
    ReleaseObjectGroupParams,
    ReleaseObjectParams,
    RemoveBindingParams,
    RunScriptParams,
    RunScriptResult,
    SetAsyncCallStackDepthParams,
    SetCustomObjectFormatterEnabledParams,
    SetMaxCallStackSizeToCaptureParams,
)

from .types import (
    CallArgument,
    ExecutionContextId,
    RemoteObjectId,
    ScriptId,
    SerializationOptions,
    TimeDelta,
)


class RuntimeClient:
    def __init__(self, client: CDPClient) -> None:
        self._client = client

    async def await_promise(
        self,
        *,
        promise_object_id: RemoteObjectId,
        return_by_value: bool | None = None,
        generate_preview: bool | None = None,
        session_id: str | None = None,
    ) -> AwaitPromiseResult:
        """
        Add handler to promise with given promise object id.
        """
        params = AwaitPromiseParams(
            promise_object_id=promise_object_id,
            return_by_value=return_by_value,
            generate_preview=generate_preview,
        )

        result = await self._client.send_raw(
            method=RuntimeCommand.AWAIT_PROMISE,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return AwaitPromiseResult.from_cdp(result)

    async def call_function_on(
        self,
        *,
        function_declaration: str,
        object_id: RemoteObjectId | None = None,
        arguments: list[CallArgument] | None = None,
        silent: bool | None = None,
        return_by_value: bool | None = None,
        generate_preview: bool | None = None,
        user_gesture: bool | None = None,
        await_promise: bool | None = None,
        execution_context_id: ExecutionContextId | None = None,
        object_group: str | None = None,
        throw_on_side_effect: bool | None = None,
        unique_context_id: str | None = None,
        serialization_options: SerializationOptions | None = None,
        session_id: str | None = None,
    ) -> CallFunctionOnResult:
        """
        Calls function with given declaration on the given object. Object group of the
        result is inherited from the target object.
        """
        params = CallFunctionOnParams(
            function_declaration=function_declaration,
            object_id=object_id,
            arguments=arguments,
            silent=silent,
            return_by_value=return_by_value,
            generate_preview=generate_preview,
            user_gesture=user_gesture,
            await_promise=await_promise,
            execution_context_id=execution_context_id,
            object_group=object_group,
            throw_on_side_effect=throw_on_side_effect,
            unique_context_id=unique_context_id,
            serialization_options=serialization_options,
        )

        result = await self._client.send_raw(
            method=RuntimeCommand.CALL_FUNCTION_ON,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return CallFunctionOnResult.from_cdp(result)

    async def compile_script(
        self,
        *,
        expression: str,
        source_url: str,
        persist_script: bool,
        execution_context_id: ExecutionContextId | None = None,
        session_id: str | None = None,
    ) -> CompileScriptResult:
        """
        Compiles expression.
        """
        params = CompileScriptParams(
            expression=expression,
            source_url=source_url,
            persist_script=persist_script,
            execution_context_id=execution_context_id,
        )

        result = await self._client.send_raw(
            method=RuntimeCommand.COMPILE_SCRIPT,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return CompileScriptResult.from_cdp(result)

    async def disable(
        self,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Disables reporting of execution contexts creation.
        """
        result = await self._client.send_raw(
            method=RuntimeCommand.DISABLE,
            params=None,
            session_id=session_id,
        )
        return result

    async def discard_console_entries(
        self,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Discards collected exceptions and console API calls.
        """
        result = await self._client.send_raw(
            method=RuntimeCommand.DISCARD_CONSOLE_ENTRIES,
            params=None,
            session_id=session_id,
        )
        return result

    async def enable(
        self,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Enables reporting of execution contexts creation by means of
        `executionContextCreated` event. When the reporting gets enabled the event will
        be sent immediately for each existing execution context.
        """
        result = await self._client.send_raw(
            method=RuntimeCommand.ENABLE,
            params=None,
            session_id=session_id,
        )
        return result

    async def evaluate(
        self,
        *,
        expression: str,
        object_group: str | None = None,
        include_command_line_api: bool | None = None,
        silent: bool | None = None,
        context_id: ExecutionContextId | None = None,
        return_by_value: bool | None = None,
        generate_preview: bool | None = None,
        user_gesture: bool | None = None,
        await_promise: bool | None = None,
        throw_on_side_effect: bool | None = None,
        timeout: TimeDelta | None = None,
        disable_breaks: bool | None = None,
        repl_mode: bool | None = None,
        allow_unsafe_eval_blocked_by_csp: bool | None = None,
        unique_context_id: str | None = None,
        serialization_options: SerializationOptions | None = None,
        session_id: str | None = None,
    ) -> EvaluateResult:
        """
        Evaluates expression on global object.
        """
        params = EvaluateParams(
            expression=expression,
            object_group=object_group,
            include_command_line_api=include_command_line_api,
            silent=silent,
            context_id=context_id,
            return_by_value=return_by_value,
            generate_preview=generate_preview,
            user_gesture=user_gesture,
            await_promise=await_promise,
            throw_on_side_effect=throw_on_side_effect,
            timeout=timeout,
            disable_breaks=disable_breaks,
            repl_mode=repl_mode,
            allow_unsafe_eval_blocked_by_csp=allow_unsafe_eval_blocked_by_csp,
            unique_context_id=unique_context_id,
            serialization_options=serialization_options,
        )

        result = await self._client.send_raw(
            method=RuntimeCommand.EVALUATE,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return EvaluateResult.from_cdp(result)

    async def get_isolate_id(
        self,
        session_id: str | None = None,
    ) -> GetIsolateIdResult:
        """
        Returns the isolate id.
        """
        result = await self._client.send_raw(
            method=RuntimeCommand.GET_ISOLATE_ID,
            params=None,
            session_id=session_id,
        )
        return GetIsolateIdResult.from_cdp(result)

    async def get_heap_usage(
        self,
        session_id: str | None = None,
    ) -> GetHeapUsageResult:
        """
        Returns the JavaScript heap usage. It is the total usage of the corresponding
        isolate not scoped to a particular Runtime.
        """
        result = await self._client.send_raw(
            method=RuntimeCommand.GET_HEAP_USAGE,
            params=None,
            session_id=session_id,
        )
        return GetHeapUsageResult.from_cdp(result)

    async def get_properties(
        self,
        *,
        object_id: RemoteObjectId,
        own_properties: bool | None = None,
        accessor_properties_only: bool | None = None,
        generate_preview: bool | None = None,
        non_indexed_properties_only: bool | None = None,
        session_id: str | None = None,
    ) -> GetPropertiesResult:
        """
        Returns properties of a given object. Object group of the result is inherited
        from the target object.
        """
        params = GetPropertiesParams(
            object_id=object_id,
            own_properties=own_properties,
            accessor_properties_only=accessor_properties_only,
            generate_preview=generate_preview,
            non_indexed_properties_only=non_indexed_properties_only,
        )

        result = await self._client.send_raw(
            method=RuntimeCommand.GET_PROPERTIES,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetPropertiesResult.from_cdp(result)

    async def global_lexical_scope_names(
        self,
        *,
        execution_context_id: ExecutionContextId | None = None,
        session_id: str | None = None,
    ) -> GlobalLexicalScopeNamesResult:
        """
        Returns all let, const and class variables from global scope.
        """
        params = GlobalLexicalScopeNamesParams(
            execution_context_id=execution_context_id
        )

        result = await self._client.send_raw(
            method=RuntimeCommand.GLOBAL_LEXICAL_SCOPE_NAMES,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GlobalLexicalScopeNamesResult.from_cdp(result)

    async def query_objects(
        self,
        *,
        prototype_object_id: RemoteObjectId,
        object_group: str | None = None,
        session_id: str | None = None,
    ) -> QueryObjectsResult:
        params = QueryObjectsParams(
            prototype_object_id=prototype_object_id, object_group=object_group
        )

        result = await self._client.send_raw(
            method=RuntimeCommand.QUERY_OBJECTS,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return QueryObjectsResult.from_cdp(result)

    async def release_object(
        self,
        *,
        object_id: RemoteObjectId,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Releases remote object with given id.
        """
        params = ReleaseObjectParams(object_id=object_id)

        result = await self._client.send_raw(
            method=RuntimeCommand.RELEASE_OBJECT,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def release_object_group(
        self,
        *,
        object_group: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Releases all remote objects that belong to a given group.
        """
        params = ReleaseObjectGroupParams(object_group=object_group)

        result = await self._client.send_raw(
            method=RuntimeCommand.RELEASE_OBJECT_GROUP,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def run_if_waiting_for_debugger(
        self,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Tells inspected instance to run if it was waiting for debugger to attach.
        """
        result = await self._client.send_raw(
            method=RuntimeCommand.RUN_IF_WAITING_FOR_DEBUGGER,
            params=None,
            session_id=session_id,
        )
        return result

    async def run_script(
        self,
        *,
        script_id: ScriptId,
        execution_context_id: ExecutionContextId | None = None,
        object_group: str | None = None,
        silent: bool | None = None,
        include_command_line_api: bool | None = None,
        return_by_value: bool | None = None,
        generate_preview: bool | None = None,
        await_promise: bool | None = None,
        session_id: str | None = None,
    ) -> RunScriptResult:
        """
        Runs script with given id in a given context.
        """
        params = RunScriptParams(
            script_id=script_id,
            execution_context_id=execution_context_id,
            object_group=object_group,
            silent=silent,
            include_command_line_api=include_command_line_api,
            return_by_value=return_by_value,
            generate_preview=generate_preview,
            await_promise=await_promise,
        )

        result = await self._client.send_raw(
            method=RuntimeCommand.RUN_SCRIPT,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return RunScriptResult.from_cdp(result)

    async def set_async_call_stack_depth(
        self,
        *,
        max_depth: int,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Enables or disables async call stacks tracking.
        """
        params = SetAsyncCallStackDepthParams(max_depth=max_depth)

        result = await self._client.send_raw(
            method=RuntimeCommand.SET_ASYNC_CALL_STACK_DEPTH,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def set_custom_object_formatter_enabled(
        self,
        *,
        enabled: bool,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        params = SetCustomObjectFormatterEnabledParams(enabled=enabled)

        result = await self._client.send_raw(
            method=RuntimeCommand.SET_CUSTOM_OBJECT_FORMATTER_ENABLED,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def set_max_call_stack_size_to_capture(
        self,
        *,
        size: int,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        params = SetMaxCallStackSizeToCaptureParams(size=size)

        result = await self._client.send_raw(
            method=RuntimeCommand.SET_MAX_CALL_STACK_SIZE_TO_CAPTURE,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def terminate_execution(
        self,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Terminate current or next JavaScript execution. Will cancel the termination
        when the outer-most script execution ends.
        """
        result = await self._client.send_raw(
            method=RuntimeCommand.TERMINATE_EXECUTION,
            params=None,
            session_id=session_id,
        )
        return result

    async def add_binding(
        self,
        *,
        name: str,
        execution_context_id: ExecutionContextId | None = None,
        execution_context_name: str | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        If executionContextId is empty, adds binding with the given name on the global
        objects of all inspected contexts, including those created later, bindings
        survive reloads. Binding function takes exactly one argument, this argument
        should be string, in case of any other input, function throws an exception. Each
        binding function call produces Runtime.bindingCalled notification.
        """
        params = AddBindingParams(
            name=name,
            execution_context_id=execution_context_id,
            execution_context_name=execution_context_name,
        )

        result = await self._client.send_raw(
            method=RuntimeCommand.ADD_BINDING,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def remove_binding(
        self,
        *,
        name: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        This method does not remove binding function from global object but
        unsubscribes current runtime agent from Runtime.bindingCalled notifications.
        """
        params = RemoveBindingParams(name=name)

        result = await self._client.send_raw(
            method=RuntimeCommand.REMOVE_BINDING,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def get_exception_details(
        self,
        *,
        error_object_id: RemoteObjectId,
        session_id: str | None = None,
    ) -> GetExceptionDetailsResult:
        """
        This method tries to lookup and populate exception details for a JavaScript
        Error object. Note that the stackTrace portion of the resulting exceptionDetails
        will only be populated if the Runtime domain was enabled at the time when the
        Error was thrown.
        """
        params = GetExceptionDetailsParams(error_object_id=error_object_id)

        result = await self._client.send_raw(
            method=RuntimeCommand.GET_EXCEPTION_DETAILS,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetExceptionDetailsResult.from_cdp(result)
