# This file is auto-generated by the CDP protocol generator.
# Do not edit this file manually as your changes will be overwritten.
# Generated from Chrome DevTools Protocol specifications.

from __future__ import annotations

from typing import TYPE_CHECKING, Any

if TYPE_CHECKING:
    from cdpify.client import CDPClient

from .commands import (
    HeapProfilerCommand,
    AddInspectedHeapObjectParams,
    GetHeapObjectIdParams,
    GetHeapObjectIdResult,
    GetObjectByHeapObjectIdParams,
    GetObjectByHeapObjectIdResult,
    GetSamplingProfileResult,
    StartSamplingParams,
    StartTrackingHeapObjectsParams,
    StopSamplingResult,
    StopTrackingHeapObjectsParams,
    TakeHeapSnapshotParams,
)

from .types import (
    HeapSnapshotObjectId,
)

if TYPE_CHECKING:
    from cdpify.domains import runtime


class HeapProfilerClient:
    def __init__(self, client: CDPClient) -> None:
        self._client = client

    async def add_inspected_heap_object(
        self,
        *,
        heap_object_id: HeapSnapshotObjectId,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Enables console to refer to the node with given id via $x (see Command Line API
        for more details $x functions).
        """
        params = AddInspectedHeapObjectParams(heap_object_id=heap_object_id)

        result = await self._client.send_raw(
            method=HeapProfilerCommand.ADD_INSPECTED_HEAP_OBJECT,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def collect_garbage(
        self,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        result = await self._client.send_raw(
            method=HeapProfilerCommand.COLLECT_GARBAGE,
            params=None,
            session_id=session_id,
        )
        return result

    async def disable(
        self,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        result = await self._client.send_raw(
            method=HeapProfilerCommand.DISABLE,
            params=None,
            session_id=session_id,
        )
        return result

    async def enable(
        self,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        result = await self._client.send_raw(
            method=HeapProfilerCommand.ENABLE,
            params=None,
            session_id=session_id,
        )
        return result

    async def get_heap_object_id(
        self,
        *,
        object_id: runtime.RemoteObjectId,
        session_id: str | None = None,
    ) -> GetHeapObjectIdResult:
        params = GetHeapObjectIdParams(object_id=object_id)

        result = await self._client.send_raw(
            method=HeapProfilerCommand.GET_HEAP_OBJECT_ID,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetHeapObjectIdResult.from_cdp(result)

    async def get_object_by_heap_object_id(
        self,
        *,
        object_id: HeapSnapshotObjectId,
        object_group: str | None = None,
        session_id: str | None = None,
    ) -> GetObjectByHeapObjectIdResult:
        params = GetObjectByHeapObjectIdParams(
            object_id=object_id, object_group=object_group
        )

        result = await self._client.send_raw(
            method=HeapProfilerCommand.GET_OBJECT_BY_HEAP_OBJECT_ID,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetObjectByHeapObjectIdResult.from_cdp(result)

    async def get_sampling_profile(
        self,
        session_id: str | None = None,
    ) -> GetSamplingProfileResult:
        result = await self._client.send_raw(
            method=HeapProfilerCommand.GET_SAMPLING_PROFILE,
            params=None,
            session_id=session_id,
        )
        return GetSamplingProfileResult.from_cdp(result)

    async def start_sampling(
        self,
        *,
        sampling_interval: float | None = None,
        stack_depth: float | None = None,
        include_objects_collected_by_major_gc: bool | None = None,
        include_objects_collected_by_minor_gc: bool | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        params = StartSamplingParams(
            sampling_interval=sampling_interval,
            stack_depth=stack_depth,
            include_objects_collected_by_major_gc=include_objects_collected_by_major_gc,
            include_objects_collected_by_minor_gc=include_objects_collected_by_minor_gc,
        )

        result = await self._client.send_raw(
            method=HeapProfilerCommand.START_SAMPLING,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def start_tracking_heap_objects(
        self,
        *,
        track_allocations: bool | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        params = StartTrackingHeapObjectsParams(track_allocations=track_allocations)

        result = await self._client.send_raw(
            method=HeapProfilerCommand.START_TRACKING_HEAP_OBJECTS,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def stop_sampling(
        self,
        session_id: str | None = None,
    ) -> StopSamplingResult:
        result = await self._client.send_raw(
            method=HeapProfilerCommand.STOP_SAMPLING,
            params=None,
            session_id=session_id,
        )
        return StopSamplingResult.from_cdp(result)

    async def stop_tracking_heap_objects(
        self,
        *,
        report_progress: bool | None = None,
        treat_global_objects_as_roots: bool | None = None,
        capture_numeric_value: bool | None = None,
        expose_internals: bool | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        params = StopTrackingHeapObjectsParams(
            report_progress=report_progress,
            treat_global_objects_as_roots=treat_global_objects_as_roots,
            capture_numeric_value=capture_numeric_value,
            expose_internals=expose_internals,
        )

        result = await self._client.send_raw(
            method=HeapProfilerCommand.STOP_TRACKING_HEAP_OBJECTS,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def take_heap_snapshot(
        self,
        *,
        report_progress: bool | None = None,
        treat_global_objects_as_roots: bool | None = None,
        capture_numeric_value: bool | None = None,
        expose_internals: bool | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        params = TakeHeapSnapshotParams(
            report_progress=report_progress,
            treat_global_objects_as_roots=treat_global_objects_as_roots,
            capture_numeric_value=capture_numeric_value,
            expose_internals=expose_internals,
        )

        result = await self._client.send_raw(
            method=HeapProfilerCommand.TAKE_HEAP_SNAPSHOT,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result
