# This file is auto-generated by the CDP protocol generator.
# Do not edit this file manually as your changes will be overwritten.
# Generated from Chrome DevTools Protocol specifications.

from __future__ import annotations

from typing import TYPE_CHECKING, Any, Literal

if TYPE_CHECKING:
    from cdpify.client import CDPClient

from cdpify.shared.decorators import deprecated

from .commands import (
    BrowserCommand,
    AddPrivacySandboxCoordinatorKeyConfigParams,
    AddPrivacySandboxEnrollmentOverrideParams,
    CancelDownloadParams,
    ExecuteBrowserCommandParams,
    GetBrowserCommandLineResult,
    GetHistogramParams,
    GetHistogramResult,
    GetHistogramsParams,
    GetHistogramsResult,
    GetVersionResult,
    GetWindowBoundsParams,
    GetWindowBoundsResult,
    GetWindowForTargetParams,
    GetWindowForTargetResult,
    GrantPermissionsParams,
    ResetPermissionsParams,
    SetContentsSizeParams,
    SetDockTileParams,
    SetDownloadBehaviorParams,
    SetPermissionParams,
    SetWindowBoundsParams,
)

from .types import (
    Bounds,
    BrowserCommandId,
    BrowserContextID,
    PermissionDescriptor,
    PermissionSetting,
    PermissionType,
    PrivacySandboxAPI,
    WindowID,
)

if TYPE_CHECKING:
    from cdpify.domains import target


class BrowserClient:
    def __init__(self, client: CDPClient) -> None:
        self._client = client

    async def set_permission(
        self,
        *,
        permission: PermissionDescriptor,
        setting: PermissionSetting,
        origin: str | None = None,
        embedded_origin: str | None = None,
        browser_context_id: BrowserContextID | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Set permission settings for given embedding and embedded origins.
        """
        params = SetPermissionParams(
            permission=permission,
            setting=setting,
            origin=origin,
            embedded_origin=embedded_origin,
            browser_context_id=browser_context_id,
        )

        result = await self._client.send_raw(
            method=BrowserCommand.SET_PERMISSION,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    @deprecated()
    async def grant_permissions(
        self,
        *,
        permissions: list[PermissionType],
        origin: str | None = None,
        browser_context_id: BrowserContextID | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Grant specific permissions to the given origin and reject all others.
        Deprecated. Use setPermission instead.
        """
        params = GrantPermissionsParams(
            permissions=permissions,
            origin=origin,
            browser_context_id=browser_context_id,
        )

        result = await self._client.send_raw(
            method=BrowserCommand.GRANT_PERMISSIONS,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def reset_permissions(
        self,
        *,
        browser_context_id: BrowserContextID | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Reset all permission management for all origins.
        """
        params = ResetPermissionsParams(browser_context_id=browser_context_id)

        result = await self._client.send_raw(
            method=BrowserCommand.RESET_PERMISSIONS,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def set_download_behavior(
        self,
        *,
        behavior: Literal["deny", "allow", "allowAndName", "default"],
        browser_context_id: BrowserContextID | None = None,
        download_path: str | None = None,
        events_enabled: bool | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Set the behavior when downloading a file.
        """
        params = SetDownloadBehaviorParams(
            behavior=behavior,
            browser_context_id=browser_context_id,
            download_path=download_path,
            events_enabled=events_enabled,
        )

        result = await self._client.send_raw(
            method=BrowserCommand.SET_DOWNLOAD_BEHAVIOR,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def cancel_download(
        self,
        *,
        guid: str,
        browser_context_id: BrowserContextID | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Cancel a download if in progress
        """
        params = CancelDownloadParams(guid=guid, browser_context_id=browser_context_id)

        result = await self._client.send_raw(
            method=BrowserCommand.CANCEL_DOWNLOAD,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def close(
        self,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Close browser gracefully.
        """
        result = await self._client.send_raw(
            method=BrowserCommand.CLOSE,
            params=None,
            session_id=session_id,
        )
        return result

    async def crash(
        self,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Crashes browser on the main thread.
        """
        result = await self._client.send_raw(
            method=BrowserCommand.CRASH,
            params=None,
            session_id=session_id,
        )
        return result

    async def crash_gpu_process(
        self,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Crashes GPU process.
        """
        result = await self._client.send_raw(
            method=BrowserCommand.CRASH_GPU_PROCESS,
            params=None,
            session_id=session_id,
        )
        return result

    async def get_version(
        self,
        session_id: str | None = None,
    ) -> GetVersionResult:
        """
        Returns version information.
        """
        result = await self._client.send_raw(
            method=BrowserCommand.GET_VERSION,
            params=None,
            session_id=session_id,
        )
        return GetVersionResult.from_cdp(result)

    async def get_browser_command_line(
        self,
        session_id: str | None = None,
    ) -> GetBrowserCommandLineResult:
        """
        Returns the command line switches for the browser process if, and only if
        --enable-automation is on the commandline.
        """
        result = await self._client.send_raw(
            method=BrowserCommand.GET_BROWSER_COMMAND_LINE,
            params=None,
            session_id=session_id,
        )
        return GetBrowserCommandLineResult.from_cdp(result)

    async def get_histograms(
        self,
        *,
        query: str | None = None,
        delta: bool | None = None,
        session_id: str | None = None,
    ) -> GetHistogramsResult:
        """
        Get Chrome histograms.
        """
        params = GetHistogramsParams(query=query, delta=delta)

        result = await self._client.send_raw(
            method=BrowserCommand.GET_HISTOGRAMS,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetHistogramsResult.from_cdp(result)

    async def get_histogram(
        self,
        *,
        name: str,
        delta: bool | None = None,
        session_id: str | None = None,
    ) -> GetHistogramResult:
        """
        Get a Chrome histogram by name.
        """
        params = GetHistogramParams(name=name, delta=delta)

        result = await self._client.send_raw(
            method=BrowserCommand.GET_HISTOGRAM,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetHistogramResult.from_cdp(result)

    async def get_window_bounds(
        self,
        *,
        window_id: WindowID,
        session_id: str | None = None,
    ) -> GetWindowBoundsResult:
        """
        Get position and size of the browser window.
        """
        params = GetWindowBoundsParams(window_id=window_id)

        result = await self._client.send_raw(
            method=BrowserCommand.GET_WINDOW_BOUNDS,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetWindowBoundsResult.from_cdp(result)

    async def get_window_for_target(
        self,
        *,
        target_id: target.TargetID | None = None,
        session_id: str | None = None,
    ) -> GetWindowForTargetResult:
        """
        Get the browser window that contains the devtools target.
        """
        params = GetWindowForTargetParams(target_id=target_id)

        result = await self._client.send_raw(
            method=BrowserCommand.GET_WINDOW_FOR_TARGET,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetWindowForTargetResult.from_cdp(result)

    async def set_window_bounds(
        self,
        *,
        window_id: WindowID,
        bounds: Bounds,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Set position and/or size of the browser window.
        """
        params = SetWindowBoundsParams(window_id=window_id, bounds=bounds)

        result = await self._client.send_raw(
            method=BrowserCommand.SET_WINDOW_BOUNDS,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def set_contents_size(
        self,
        *,
        window_id: WindowID,
        width: int | None = None,
        height: int | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Set size of the browser contents resizing browser window as necessary.
        """
        params = SetContentsSizeParams(window_id=window_id, width=width, height=height)

        result = await self._client.send_raw(
            method=BrowserCommand.SET_CONTENTS_SIZE,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def set_dock_tile(
        self,
        *,
        badge_label: str | None = None,
        image: str | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Set dock tile details, platform-specific.
        """
        params = SetDockTileParams(badge_label=badge_label, image=image)

        result = await self._client.send_raw(
            method=BrowserCommand.SET_DOCK_TILE,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def execute_browser_command(
        self,
        *,
        command_id: BrowserCommandId,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Invoke custom browser commands used by telemetry.
        """
        params = ExecuteBrowserCommandParams(command_id=command_id)

        result = await self._client.send_raw(
            method=BrowserCommand.EXECUTE_BROWSER_COMMAND,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def add_privacy_sandbox_enrollment_override(
        self,
        *,
        url: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Allows a site to use privacy sandbox features that require enrollment without
        the site actually being enrolled. Only supported on page targets.
        """
        params = AddPrivacySandboxEnrollmentOverrideParams(url=url)

        result = await self._client.send_raw(
            method=BrowserCommand.ADD_PRIVACY_SANDBOX_ENROLLMENT_OVERRIDE,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def add_privacy_sandbox_coordinator_key_config(
        self,
        *,
        api: PrivacySandboxAPI,
        coordinator_origin: str,
        key_config: str,
        browser_context_id: BrowserContextID | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Configures encryption keys used with a given privacy sandbox API to talk to a
        trusted coordinator. Since this is intended for test automation only,
        coordinatorOrigin must be a .test domain. No existing coordinator configuration
        for the origin may exist.
        """
        params = AddPrivacySandboxCoordinatorKeyConfigParams(
            api=api,
            coordinator_origin=coordinator_origin,
            key_config=key_config,
            browser_context_id=browser_context_id,
        )

        result = await self._client.send_raw(
            method=BrowserCommand.ADD_PRIVACY_SANDBOX_COORDINATOR_KEY_CONFIG,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result
