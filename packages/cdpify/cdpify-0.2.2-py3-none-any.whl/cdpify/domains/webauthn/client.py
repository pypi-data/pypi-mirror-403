# This file is auto-generated by the CDP protocol generator.
# Do not edit this file manually as your changes will be overwritten.
# Generated from Chrome DevTools Protocol specifications.

from __future__ import annotations

from typing import TYPE_CHECKING, Any

if TYPE_CHECKING:
    from cdpify.client import CDPClient

from .commands import (
    WebAuthnCommand,
    AddCredentialParams,
    AddVirtualAuthenticatorParams,
    AddVirtualAuthenticatorResult,
    ClearCredentialsParams,
    EnableParams,
    GetCredentialParams,
    GetCredentialResult,
    GetCredentialsParams,
    GetCredentialsResult,
    RemoveCredentialParams,
    RemoveVirtualAuthenticatorParams,
    SetAutomaticPresenceSimulationParams,
    SetCredentialPropertiesParams,
    SetResponseOverrideBitsParams,
    SetUserVerifiedParams,
)

from .types import (
    AuthenticatorId,
    Credential,
    VirtualAuthenticatorOptions,
)


class WebAuthnClient:
    def __init__(self, client: CDPClient) -> None:
        self._client = client

    async def enable(
        self,
        *,
        enable_ui: bool | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Enable the WebAuthn domain and start intercepting credential storage and
        retrieval with a virtual authenticator.
        """
        params = EnableParams(enable_ui=enable_ui)

        result = await self._client.send_raw(
            method=WebAuthnCommand.ENABLE,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def disable(
        self,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Disable the WebAuthn domain.
        """
        result = await self._client.send_raw(
            method=WebAuthnCommand.DISABLE,
            params=None,
            session_id=session_id,
        )
        return result

    async def add_virtual_authenticator(
        self,
        *,
        options: VirtualAuthenticatorOptions,
        session_id: str | None = None,
    ) -> AddVirtualAuthenticatorResult:
        """
        Creates and adds a virtual authenticator.
        """
        params = AddVirtualAuthenticatorParams(options=options)

        result = await self._client.send_raw(
            method=WebAuthnCommand.ADD_VIRTUAL_AUTHENTICATOR,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return AddVirtualAuthenticatorResult.from_cdp(result)

    async def set_response_override_bits(
        self,
        *,
        authenticator_id: AuthenticatorId,
        is_bogus_signature: bool | None = None,
        is_bad_uv: bool | None = None,
        is_bad_up: bool | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Resets parameters isBogusSignature, isBadUV, isBadUP to false if they are not
        present.
        """
        params = SetResponseOverrideBitsParams(
            authenticator_id=authenticator_id,
            is_bogus_signature=is_bogus_signature,
            is_bad_uv=is_bad_uv,
            is_bad_up=is_bad_up,
        )

        result = await self._client.send_raw(
            method=WebAuthnCommand.SET_RESPONSE_OVERRIDE_BITS,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def remove_virtual_authenticator(
        self,
        *,
        authenticator_id: AuthenticatorId,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Removes the given authenticator.
        """
        params = RemoveVirtualAuthenticatorParams(authenticator_id=authenticator_id)

        result = await self._client.send_raw(
            method=WebAuthnCommand.REMOVE_VIRTUAL_AUTHENTICATOR,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def add_credential(
        self,
        *,
        authenticator_id: AuthenticatorId,
        credential: Credential,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Adds the credential to the specified authenticator.
        """
        params = AddCredentialParams(
            authenticator_id=authenticator_id, credential=credential
        )

        result = await self._client.send_raw(
            method=WebAuthnCommand.ADD_CREDENTIAL,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def get_credential(
        self,
        *,
        authenticator_id: AuthenticatorId,
        credential_id: str,
        session_id: str | None = None,
    ) -> GetCredentialResult:
        """
        Returns a single credential stored in the given virtual authenticator that
        matches the credential ID.
        """
        params = GetCredentialParams(
            authenticator_id=authenticator_id, credential_id=credential_id
        )

        result = await self._client.send_raw(
            method=WebAuthnCommand.GET_CREDENTIAL,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetCredentialResult.from_cdp(result)

    async def get_credentials(
        self,
        *,
        authenticator_id: AuthenticatorId,
        session_id: str | None = None,
    ) -> GetCredentialsResult:
        """
        Returns all the credentials stored in the given virtual authenticator.
        """
        params = GetCredentialsParams(authenticator_id=authenticator_id)

        result = await self._client.send_raw(
            method=WebAuthnCommand.GET_CREDENTIALS,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetCredentialsResult.from_cdp(result)

    async def remove_credential(
        self,
        *,
        authenticator_id: AuthenticatorId,
        credential_id: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Removes a credential from the authenticator.
        """
        params = RemoveCredentialParams(
            authenticator_id=authenticator_id, credential_id=credential_id
        )

        result = await self._client.send_raw(
            method=WebAuthnCommand.REMOVE_CREDENTIAL,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def clear_credentials(
        self,
        *,
        authenticator_id: AuthenticatorId,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Clears all the credentials from the specified device.
        """
        params = ClearCredentialsParams(authenticator_id=authenticator_id)

        result = await self._client.send_raw(
            method=WebAuthnCommand.CLEAR_CREDENTIALS,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def set_user_verified(
        self,
        *,
        authenticator_id: AuthenticatorId,
        is_user_verified: bool,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Sets whether User Verification succeeds or fails for an authenticator. The
        default is true.
        """
        params = SetUserVerifiedParams(
            authenticator_id=authenticator_id, is_user_verified=is_user_verified
        )

        result = await self._client.send_raw(
            method=WebAuthnCommand.SET_USER_VERIFIED,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def set_automatic_presence_simulation(
        self,
        *,
        authenticator_id: AuthenticatorId,
        enabled: bool,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Sets whether tests of user presence will succeed immediately (if true) or fail
        to resolve (if false) for an authenticator. The default is true.
        """
        params = SetAutomaticPresenceSimulationParams(
            authenticator_id=authenticator_id, enabled=enabled
        )

        result = await self._client.send_raw(
            method=WebAuthnCommand.SET_AUTOMATIC_PRESENCE_SIMULATION,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def set_credential_properties(
        self,
        *,
        authenticator_id: AuthenticatorId,
        credential_id: str,
        backup_eligibility: bool | None = None,
        backup_state: bool | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Allows setting credential properties.
        https://w3c.github.io/webauthn/#sctn-automation-set-credential-properties
        """
        params = SetCredentialPropertiesParams(
            authenticator_id=authenticator_id,
            credential_id=credential_id,
            backup_eligibility=backup_eligibility,
            backup_state=backup_state,
        )

        result = await self._client.send_raw(
            method=WebAuthnCommand.SET_CREDENTIAL_PROPERTIES,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result
