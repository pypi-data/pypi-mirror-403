# This file is auto-generated by the CDP protocol generator.
# Do not edit this file manually as your changes will be overwritten.
# Generated from Chrome DevTools Protocol specifications.

from __future__ import annotations

from typing import TYPE_CHECKING, Any

if TYPE_CHECKING:
    from cdpify.client import CDPClient

from cdpify.shared.decorators import deprecated

from .commands import (
    StorageCommand,
    ClearCookiesParams,
    ClearDataForOriginParams,
    ClearDataForStorageKeyParams,
    ClearSharedStorageEntriesParams,
    ClearTrustTokensParams,
    ClearTrustTokensResult,
    DeleteSharedStorageEntryParams,
    DeleteStorageBucketParams,
    GetAffectedUrlsForThirdPartyCookieMetadataParams,
    GetAffectedUrlsForThirdPartyCookieMetadataResult,
    GetCookiesParams,
    GetCookiesResult,
    GetInterestGroupDetailsParams,
    GetInterestGroupDetailsResult,
    GetRelatedWebsiteSetsResult,
    GetSharedStorageEntriesParams,
    GetSharedStorageEntriesResult,
    GetSharedStorageMetadataParams,
    GetSharedStorageMetadataResult,
    GetStorageKeyForFrameParams,
    GetStorageKeyForFrameResult,
    GetStorageKeyParams,
    GetStorageKeyResult,
    GetTrustTokensResult,
    GetUsageAndQuotaParams,
    GetUsageAndQuotaResult,
    OverrideQuotaForOriginParams,
    ResetSharedStorageBudgetParams,
    RunBounceTrackingMitigationsResult,
    SendPendingAttributionReportsResult,
    SetAttributionReportingLocalTestingModeParams,
    SetAttributionReportingTrackingParams,
    SetCookiesParams,
    SetInterestGroupAuctionTrackingParams,
    SetInterestGroupTrackingParams,
    SetProtectedAudienceKAnonymityParams,
    SetSharedStorageEntryParams,
    SetSharedStorageTrackingParams,
    SetStorageBucketTrackingParams,
    TrackCacheStorageForOriginParams,
    TrackCacheStorageForStorageKeyParams,
    TrackIndexedDBForOriginParams,
    TrackIndexedDBForStorageKeyParams,
    UntrackCacheStorageForOriginParams,
    UntrackCacheStorageForStorageKeyParams,
    UntrackIndexedDBForOriginParams,
    UntrackIndexedDBForStorageKeyParams,
)

from .types import (
    StorageBucket,
)

if TYPE_CHECKING:
    from cdpify.domains import browser, network, page


class StorageClient:
    def __init__(self, client: CDPClient) -> None:
        self._client = client

    @deprecated()
    async def get_storage_key_for_frame(
        self,
        *,
        frame_id: page.FrameId,
        session_id: str | None = None,
    ) -> GetStorageKeyForFrameResult:
        """
        Returns a storage key given a frame id. Deprecated. Please use
        Storage.getStorageKey instead.
        """
        params = GetStorageKeyForFrameParams(frame_id=frame_id)

        result = await self._client.send_raw(
            method=StorageCommand.GET_STORAGE_KEY_FOR_FRAME,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetStorageKeyForFrameResult.from_cdp(result)

    async def get_storage_key(
        self,
        *,
        frame_id: page.FrameId | None = None,
        session_id: str | None = None,
    ) -> GetStorageKeyResult:
        """
        Returns storage key for the given frame. If no frame ID is provided, the
        storage key of the target executing this command is returned.
        """
        params = GetStorageKeyParams(frame_id=frame_id)

        result = await self._client.send_raw(
            method=StorageCommand.GET_STORAGE_KEY,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetStorageKeyResult.from_cdp(result)

    async def clear_data_for_origin(
        self,
        *,
        origin: str,
        storage_types: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Clears storage for origin.
        """
        params = ClearDataForOriginParams(origin=origin, storage_types=storage_types)

        result = await self._client.send_raw(
            method=StorageCommand.CLEAR_DATA_FOR_ORIGIN,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def clear_data_for_storage_key(
        self,
        *,
        storage_key: str,
        storage_types: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Clears storage for storage key.
        """
        params = ClearDataForStorageKeyParams(
            storage_key=storage_key, storage_types=storage_types
        )

        result = await self._client.send_raw(
            method=StorageCommand.CLEAR_DATA_FOR_STORAGE_KEY,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def get_cookies(
        self,
        *,
        browser_context_id: browser.BrowserContextID | None = None,
        session_id: str | None = None,
    ) -> GetCookiesResult:
        """
        Returns all browser cookies.
        """
        params = GetCookiesParams(browser_context_id=browser_context_id)

        result = await self._client.send_raw(
            method=StorageCommand.GET_COOKIES,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetCookiesResult.from_cdp(result)

    async def set_cookies(
        self,
        *,
        cookies: list[network.CookieParam],
        browser_context_id: browser.BrowserContextID | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Sets given cookies.
        """
        params = SetCookiesParams(
            cookies=cookies, browser_context_id=browser_context_id
        )

        result = await self._client.send_raw(
            method=StorageCommand.SET_COOKIES,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def clear_cookies(
        self,
        *,
        browser_context_id: browser.BrowserContextID | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Clears cookies.
        """
        params = ClearCookiesParams(browser_context_id=browser_context_id)

        result = await self._client.send_raw(
            method=StorageCommand.CLEAR_COOKIES,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def get_usage_and_quota(
        self,
        *,
        origin: str,
        session_id: str | None = None,
    ) -> GetUsageAndQuotaResult:
        """
        Returns usage and quota in bytes.
        """
        params = GetUsageAndQuotaParams(origin=origin)

        result = await self._client.send_raw(
            method=StorageCommand.GET_USAGE_AND_QUOTA,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetUsageAndQuotaResult.from_cdp(result)

    async def override_quota_for_origin(
        self,
        *,
        origin: str,
        quota_size: float | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Override quota for the specified origin
        """
        params = OverrideQuotaForOriginParams(origin=origin, quota_size=quota_size)

        result = await self._client.send_raw(
            method=StorageCommand.OVERRIDE_QUOTA_FOR_ORIGIN,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def track_cache_storage_for_origin(
        self,
        *,
        origin: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Registers origin to be notified when an update occurs to its cache storage
        list.
        """
        params = TrackCacheStorageForOriginParams(origin=origin)

        result = await self._client.send_raw(
            method=StorageCommand.TRACK_CACHE_STORAGE_FOR_ORIGIN,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def track_cache_storage_for_storage_key(
        self,
        *,
        storage_key: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Registers storage key to be notified when an update occurs to its cache storage
        list.
        """
        params = TrackCacheStorageForStorageKeyParams(storage_key=storage_key)

        result = await self._client.send_raw(
            method=StorageCommand.TRACK_CACHE_STORAGE_FOR_STORAGE_KEY,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def track_indexed_db_for_origin(
        self,
        *,
        origin: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Registers origin to be notified when an update occurs to its IndexedDB.
        """
        params = TrackIndexedDBForOriginParams(origin=origin)

        result = await self._client.send_raw(
            method=StorageCommand.TRACK_INDEXED_DB_FOR_ORIGIN,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def track_indexed_db_for_storage_key(
        self,
        *,
        storage_key: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Registers storage key to be notified when an update occurs to its IndexedDB.
        """
        params = TrackIndexedDBForStorageKeyParams(storage_key=storage_key)

        result = await self._client.send_raw(
            method=StorageCommand.TRACK_INDEXED_DB_FOR_STORAGE_KEY,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def untrack_cache_storage_for_origin(
        self,
        *,
        origin: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Unregisters origin from receiving notifications for cache storage.
        """
        params = UntrackCacheStorageForOriginParams(origin=origin)

        result = await self._client.send_raw(
            method=StorageCommand.UNTRACK_CACHE_STORAGE_FOR_ORIGIN,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def untrack_cache_storage_for_storage_key(
        self,
        *,
        storage_key: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Unregisters storage key from receiving notifications for cache storage.
        """
        params = UntrackCacheStorageForStorageKeyParams(storage_key=storage_key)

        result = await self._client.send_raw(
            method=StorageCommand.UNTRACK_CACHE_STORAGE_FOR_STORAGE_KEY,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def untrack_indexed_db_for_origin(
        self,
        *,
        origin: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Unregisters origin from receiving notifications for IndexedDB.
        """
        params = UntrackIndexedDBForOriginParams(origin=origin)

        result = await self._client.send_raw(
            method=StorageCommand.UNTRACK_INDEXED_DB_FOR_ORIGIN,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def untrack_indexed_db_for_storage_key(
        self,
        *,
        storage_key: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Unregisters storage key from receiving notifications for IndexedDB.
        """
        params = UntrackIndexedDBForStorageKeyParams(storage_key=storage_key)

        result = await self._client.send_raw(
            method=StorageCommand.UNTRACK_INDEXED_DB_FOR_STORAGE_KEY,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def get_trust_tokens(
        self,
        session_id: str | None = None,
    ) -> GetTrustTokensResult:
        """
        Returns the number of stored Trust Tokens per issuer for the current browsing
        context.
        """
        result = await self._client.send_raw(
            method=StorageCommand.GET_TRUST_TOKENS,
            params=None,
            session_id=session_id,
        )
        return GetTrustTokensResult.from_cdp(result)

    async def clear_trust_tokens(
        self,
        *,
        issuer_origin: str,
        session_id: str | None = None,
    ) -> ClearTrustTokensResult:
        """
        Removes all Trust Tokens issued by the provided issuerOrigin. Leaves other
        stored data, including the issuer's Redemption Records, intact.
        """
        params = ClearTrustTokensParams(issuer_origin=issuer_origin)

        result = await self._client.send_raw(
            method=StorageCommand.CLEAR_TRUST_TOKENS,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return ClearTrustTokensResult.from_cdp(result)

    async def get_interest_group_details(
        self,
        *,
        owner_origin: str,
        name: str,
        session_id: str | None = None,
    ) -> GetInterestGroupDetailsResult:
        """
        Gets details for a named interest group.
        """
        params = GetInterestGroupDetailsParams(owner_origin=owner_origin, name=name)

        result = await self._client.send_raw(
            method=StorageCommand.GET_INTEREST_GROUP_DETAILS,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetInterestGroupDetailsResult.from_cdp(result)

    async def set_interest_group_tracking(
        self,
        *,
        enable: bool,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Enables/Disables issuing of interestGroupAccessed events.
        """
        params = SetInterestGroupTrackingParams(enable=enable)

        result = await self._client.send_raw(
            method=StorageCommand.SET_INTEREST_GROUP_TRACKING,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def set_interest_group_auction_tracking(
        self,
        *,
        enable: bool,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Enables/Disables issuing of interestGroupAuctionEventOccurred and
        interestGroupAuctionNetworkRequestCreated.
        """
        params = SetInterestGroupAuctionTrackingParams(enable=enable)

        result = await self._client.send_raw(
            method=StorageCommand.SET_INTEREST_GROUP_AUCTION_TRACKING,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def get_shared_storage_metadata(
        self,
        *,
        owner_origin: str,
        session_id: str | None = None,
    ) -> GetSharedStorageMetadataResult:
        """
        Gets metadata for an origin's shared storage.
        """
        params = GetSharedStorageMetadataParams(owner_origin=owner_origin)

        result = await self._client.send_raw(
            method=StorageCommand.GET_SHARED_STORAGE_METADATA,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetSharedStorageMetadataResult.from_cdp(result)

    async def get_shared_storage_entries(
        self,
        *,
        owner_origin: str,
        session_id: str | None = None,
    ) -> GetSharedStorageEntriesResult:
        """
        Gets the entries in an given origin's shared storage.
        """
        params = GetSharedStorageEntriesParams(owner_origin=owner_origin)

        result = await self._client.send_raw(
            method=StorageCommand.GET_SHARED_STORAGE_ENTRIES,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetSharedStorageEntriesResult.from_cdp(result)

    async def set_shared_storage_entry(
        self,
        *,
        owner_origin: str,
        key: str,
        value: str,
        ignore_if_present: bool | None = None,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Sets entry with `key` and `value` for a given origin's shared storage.
        """
        params = SetSharedStorageEntryParams(
            owner_origin=owner_origin,
            key=key,
            value=value,
            ignore_if_present=ignore_if_present,
        )

        result = await self._client.send_raw(
            method=StorageCommand.SET_SHARED_STORAGE_ENTRY,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def delete_shared_storage_entry(
        self,
        *,
        owner_origin: str,
        key: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Deletes entry for `key` (if it exists) for a given origin's shared storage.
        """
        params = DeleteSharedStorageEntryParams(owner_origin=owner_origin, key=key)

        result = await self._client.send_raw(
            method=StorageCommand.DELETE_SHARED_STORAGE_ENTRY,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def clear_shared_storage_entries(
        self,
        *,
        owner_origin: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Clears all entries for a given origin's shared storage.
        """
        params = ClearSharedStorageEntriesParams(owner_origin=owner_origin)

        result = await self._client.send_raw(
            method=StorageCommand.CLEAR_SHARED_STORAGE_ENTRIES,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def reset_shared_storage_budget(
        self,
        *,
        owner_origin: str,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Resets the budget for `ownerOrigin` by clearing all budget withdrawals.
        """
        params = ResetSharedStorageBudgetParams(owner_origin=owner_origin)

        result = await self._client.send_raw(
            method=StorageCommand.RESET_SHARED_STORAGE_BUDGET,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def set_shared_storage_tracking(
        self,
        *,
        enable: bool,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Enables/disables issuing of sharedStorageAccessed events.
        """
        params = SetSharedStorageTrackingParams(enable=enable)

        result = await self._client.send_raw(
            method=StorageCommand.SET_SHARED_STORAGE_TRACKING,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def set_storage_bucket_tracking(
        self,
        *,
        storage_key: str,
        enable: bool,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Set tracking for a storage key's buckets.
        """
        params = SetStorageBucketTrackingParams(storage_key=storage_key, enable=enable)

        result = await self._client.send_raw(
            method=StorageCommand.SET_STORAGE_BUCKET_TRACKING,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def delete_storage_bucket(
        self,
        *,
        bucket: StorageBucket,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Deletes the Storage Bucket with the given storage key and bucket name.
        """
        params = DeleteStorageBucketParams(bucket=bucket)

        result = await self._client.send_raw(
            method=StorageCommand.DELETE_STORAGE_BUCKET,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def run_bounce_tracking_mitigations(
        self,
        session_id: str | None = None,
    ) -> RunBounceTrackingMitigationsResult:
        """
        Deletes state for sites identified as potential bounce trackers, immediately.
        """
        result = await self._client.send_raw(
            method=StorageCommand.RUN_BOUNCE_TRACKING_MITIGATIONS,
            params=None,
            session_id=session_id,
        )
        return RunBounceTrackingMitigationsResult.from_cdp(result)

    async def set_attribution_reporting_local_testing_mode(
        self,
        *,
        enabled: bool,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        https://wicg.github.io/attribution-reporting-api/
        """
        params = SetAttributionReportingLocalTestingModeParams(enabled=enabled)

        result = await self._client.send_raw(
            method=StorageCommand.SET_ATTRIBUTION_REPORTING_LOCAL_TESTING_MODE,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def set_attribution_reporting_tracking(
        self,
        *,
        enable: bool,
        session_id: str | None = None,
    ) -> dict[str, Any]:
        """
        Enables/disables issuing of Attribution Reporting events.
        """
        params = SetAttributionReportingTrackingParams(enable=enable)

        result = await self._client.send_raw(
            method=StorageCommand.SET_ATTRIBUTION_REPORTING_TRACKING,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result

    async def send_pending_attribution_reports(
        self,
        session_id: str | None = None,
    ) -> SendPendingAttributionReportsResult:
        """
        Sends all pending Attribution Reports immediately, regardless of their
        scheduled report time.
        """
        result = await self._client.send_raw(
            method=StorageCommand.SEND_PENDING_ATTRIBUTION_REPORTS,
            params=None,
            session_id=session_id,
        )
        return SendPendingAttributionReportsResult.from_cdp(result)

    async def get_related_website_sets(
        self,
        session_id: str | None = None,
    ) -> GetRelatedWebsiteSetsResult:
        """
        Returns the effective Related Website Sets in use by this profile for the
        browser session. The effective Related Website Sets will not change during a
        browser session.
        """
        result = await self._client.send_raw(
            method=StorageCommand.GET_RELATED_WEBSITE_SETS,
            params=None,
            session_id=session_id,
        )
        return GetRelatedWebsiteSetsResult.from_cdp(result)

    async def get_affected_urls_for_third_party_cookie_metadata(
        self,
        *,
        first_party_url: str,
        third_party_urls: list[str],
        session_id: str | None = None,
    ) -> GetAffectedUrlsForThirdPartyCookieMetadataResult:
        """
        Returns the list of URLs from a page and its embedded resources that match
        existing grace period URL pattern rules.
        https://developers.google.com/privacy-sandbox/cookies/temporary-exceptions/grace-period
        """
        params = GetAffectedUrlsForThirdPartyCookieMetadataParams(
            first_party_url=first_party_url, third_party_urls=third_party_urls
        )

        result = await self._client.send_raw(
            method=StorageCommand.GET_AFFECTED_URLS_FOR_THIRD_PARTY_COOKIE_METADATA,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return GetAffectedUrlsForThirdPartyCookieMetadataResult.from_cdp(result)

    async def set_protected_audience_k_anonymity(
        self,
        *,
        owner: str,
        name: str,
        hashes: list[str],
        session_id: str | None = None,
    ) -> dict[str, Any]:
        params = SetProtectedAudienceKAnonymityParams(
            owner=owner, name=name, hashes=hashes
        )

        result = await self._client.send_raw(
            method=StorageCommand.SET_PROTECTED_AUDIENCE_K_ANONYMITY,
            params=params.to_cdp_params(),
            session_id=session_id,
        )
        return result
