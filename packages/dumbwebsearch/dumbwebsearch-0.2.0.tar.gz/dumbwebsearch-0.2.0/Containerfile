FROM docker.io/python:3-slim AS wsgiref

COPY pyproject.toml /src/
COPY dumbwebsearch/ /src/dumbwebsearch/
COPY README.md /src/
COPY container/run.sh /run.sh

RUN python3 -m pip install --user --no-warn-script-location /src

EXPOSE 8000
VOLUME /text
VOLUME /database

ENV INDEX_DIR=/text
ENV INDEX_DATABASE=/database/dumbwebsearch.db
ENV INDEX_AT_START=1
ENV HTTP_SERVER_BIND=0.0.0.0
ENV HTTP_SERVER_PORT=8000
ENV HTTP_BASE_URL=/

CMD ["/run.sh"]
