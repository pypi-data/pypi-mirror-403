import{d as E,c as n,f as _,a as l,F as g,e,v as q,t as d,J as me,l as N,g as D,q as O,s as C,D as V,Z as B,L as J,_ as ge,h as b,w as te,r as R,o as se,x as L,u as F,b as S,C as be,y as ye,a0 as he,a1 as ve,O as ke,j as _e,$ as $e}from"./chunks/filter-CiYqP1_r.js";import{C as xe}from"./chunks/CollapsibleCard-DoX0kPCZ.js";import{_ as le}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";import{c as we,p as Se}from"./chunks/bootbox-D3SJ_Fwv.js";import{_ as I}from"./chunks/Diagnostic.vue_vue_type_script_setup_true_lang-CBzsmnqW.js";const Ce={class:"text-secondary mb-3"},Oe={class:"progress",role:"progressbar"},Ae={key:1,class:"d-flex justify-content-center mt-5"},z=E({__name:"ProgressIndicator",props:{release:{},details:{}},setup(a){const p=a,o=N(()=>Math.round((p.details?.__progress?.progress??0)*100));return(r,c)=>a.release?.state=="running"?(l(),n(g,{key:0},[e("p",null,[q(r.$slots,"default")]),a.details&&"__progress"in a.details&&a.details?.__progress?(l(),n(g,{key:0},[e("p",Ce,d(a.details.__progress.message??"Working on")+" "+d(a.details.__progress.current_item)+" ("+d(a.details.__progress?.position?.[0])+"/"+d(a.details.__progress?.position?.[1])+") ",1),e("div",Oe,[e("div",{class:"progress-bar progress-bar-striped progress-bar-animated",style:me({width:`${o.value}%`})},d(o.value)+"% ",5)])],64)):(l(),n("div",Ae,[...c[0]||(c[0]=[e("div",{class:"spinner-border text-primary",role:"status",style:{width:"5rem",height:"5rem"}},[e("span",{class:"visually-hidden"},"Waiting...")],-1)])]))],64)):_("",!0)}}),Te={class:"files"},Ne={class:"badge text-bg-secondary"},je={key:0,class:"badge text-bg-secondary ms-1"},Ie=["onClick"],Re=["onClick"],De={class:"release-file-settings"},Pe={class:"form-check form-switch mb-3"},Ee=["onUpdate:modelValue"],Ue={class:"input-group input-group-sm mb-3"},Ve=["onUpdate:modelValue"],Le={class:"input-group input-group-sm mb-3"},We=["onUpdate:modelValue"],Fe={class:"input-group input-group-sm mb-3"},Me=["value","onChange"],Je={class:"input-group input-group-sm mb-3"},Be=["onUpdate:modelValue"],Ge=["onUpdate:modelValue"],He=["onClick"],qe=["onClick"],ze={class:"input-group input-group-sm mb-3"},Ke=["value"],Xe=["onClick"],Ze=["onClick"],Qe={class:"header"},Ye=["onClick"],et={class:"input-group input-group-sm mb-1"},tt=["onUpdate:modelValue"],st={class:"input-group input-group-sm mb-3"},lt=["value","onChange"],nt=["onClick"],at={class:"d-flex gap-2"},ot=E({__name:"ReleaseScriptViewer",props:{releaseScript:{}},setup(a){const p=a;function o(f,s){p.releaseScript.files[f].target.ontology_annotations=Object.fromEntries(s.split(`
`).map(i=>i.split(": ")))}function r(f,s){p.releaseScript.steps[f].args=Object.fromEntries(s.split(`
`).map(i=>i.split(": ")).map(([i,t])=>t==="true"?[i,!0]:t==="false"?[i,!1]:isNaN(Number(t))?[i,t]:[i,Number(t)]))}function c(f){bootbox.prompt({title:`Add dependency for ${f}`,inputType:"select",inputOptions:Object.entries(p.releaseScript.files).filter(([s,i])=>s!=f).map(([s,i])=>({text:i.target.file,value:s})),callback(s){s&&p.releaseScript.files[f].needs.push(s)}})}function y(f,s){p.releaseScript.files[f].needs=p.releaseScript.files[f].needs.filter(i=>i!=s)}function w(){bootbox.prompt({title:"What is the name of the file?",inputType:"text",callback(f){f&&(f=f.trim().replace(/[ ,./\-!?=]/,"_"),p.releaseScript.files[f]={target:{file:"",iri:"",ontology_annotations:{}},sources:[],needs:[]})}})}function v(f,s){f.preventDefault(),bootbox.prompt({title:"What is the name of the file?",inputType:"text",value:s,callback(i){i&&(i=i.trim().replace(/[ ,./\-!?=]/,"_"),p.releaseScript.files[i]=p.releaseScript.files[s],delete p.releaseScript.files[s])}})}function k(f,s){f.preventDefault(),p.releaseScript.steps.splice(s,0,{args:{},name:"NEW_STEP"})}function A(f,s){f.preventDefault();const i=p.releaseScript.steps[s];bootbox.confirm({title:`Delete step '${i.name}'`,message:`Do you want to remove the release step '${i.name}'?`,buttons:{confirm:{label:`Delete ${i.name}`,className:"btn-danger"},cancel:{label:"Keep it",className:"btn-success"}},callback(t){t&&p.releaseScript.steps.splice(s,1)}})}function U(f,s){f.preventDefault(),bootbox.confirm({title:`Delete '${s}'`,message:`Do you want to delete the file '${s}'? It will remove the file ${p.releaseScript.files[s].target.file} from the release.`,buttons:{confirm:{label:`Delete ${s}`,className:"btn-danger"},cancel:{label:"Keep it",className:"btn-success"}},callback(i){i&&delete p.releaseScript.files[s]}})}return(f,s)=>(l(),n(g,null,[e("div",Te,[s[22]||(s[22]=e("h3",null,"Files",-1)),(l(!0),n(g,null,D(a.releaseScript.files,(i,t)=>(l(),O(xe,null,{title:C(()=>[b(d(t)+" - "+d(i.target.file)+" ",1),e("span",Ne,d(i.sources.length)+" sources",1),i.needs.length>0?(l(),n("span",je,d(i.needs.length)+" dependencies",1)):_("",!0)]),buttons:C(()=>[e("button",{class:"btn btn-primary btn-sm btn-circle",onClick:u=>v(u,t)},[...s[1]||(s[1]=[e("i",{class:"fa fa-edit"},null,-1)])],8,Ie),e("button",{class:"btn btn-danger btn-sm btn-circle",onClick:u=>U(u,t)},[...s[2]||(s[2]=[e("i",{class:"fa fa-trash"},null,-1)])],8,Re)]),body:C(()=>[e("div",De,[s[15]||(s[15]=e("h6",null,"Target settings",-1)),s[16]||(s[16]=e("p",{class:"text-body-secondary"},"Define the location of the target file in the repository and define the IRI of the resulting ontology.",-1)),e("div",Pe,[V(e("input",{"onUpdate:modelValue":u=>i.target.publish=u,class:"form-check-input",role:"switch",type:"checkbox"},null,8,Ee),[[B,i.target.publish]]),s[3]||(s[3]=e("span",{class:"form-check-label"},"Publish the file to GitHub",-1))]),e("div",Ue,[s[4]||(s[4]=e("span",{class:"input-group-text"},"Path",-1)),V(e("input",{"onUpdate:modelValue":u=>i.target.file=u,class:"form-control",type:"text"},null,8,Ve),[[J,i.target.file]])]),e("div",Le,[s[5]||(s[5]=e("span",{class:"input-group-text"},"IRI",-1)),V(e("input",{"onUpdate:modelValue":u=>i.target.iri=u,class:"form-control",type:"text"},null,8,We),[[J,i.target.iri]])]),e("div",Fe,[s[6]||(s[6]=e("span",{class:"input-group-text"},"Annotations",-1)),e("textarea",{value:Object.entries(i.target.ontology_annotations).map(([u,j])=>`${u}: ${j}`).join(`
`),class:"form-control",onChange:u=>o(t,u.target?.value)},"            ",40,Me)]),s[17]||(s[17]=e("h6",null,"Source settings",-1)),s[18]||(s[18]=e("p",{class:"text-body-secondary"}," Add files that contain terms, individuals, and relations which should be included in the OWL ontology. Alternatively, add previously built owl files which should be merged to built the target ontology. ",-1)),(l(!0),n(g,null,D(i.sources,u=>(l(),n("div",Je,[s[9]||(s[9]=e("span",{class:"input-group-text"},"Source",-1)),V(e("input",{"onUpdate:modelValue":j=>u.file=j,class:"form-control",type:"text"},null,8,Be),[[J,u.file]]),s[10]||(s[10]=e("span",{class:"input-group-text"},"Type",-1)),V(e("select",{"onUpdate:modelValue":j=>u.type=j,class:"form-select",style:{flex:"unset",width:"auto"}},[...s[7]||(s[7]=[e("option",{value:"classes"},"Classes",-1),e("option",{value:"relations"},"Relations",-1),e("option",{value:"individuals"},"Individuals",-1),e("option",{value:"owl"},"OWL",-1)])],8,Ge),[[ge,u.type]]),e("button",{class:"btn btn-danger",onClick:j=>i.sources=i.sources.filter(M=>M!=u)},[...s[8]||(s[8]=[e("i",{class:"fa fa-trash"},null,-1)])],8,He)]))),256)),e("button",{class:"mb-3 btn btn-sm btn-primary add-dependency",onClick:u=>i.sources.push({file:"",type:"classes"})},[...s[11]||(s[11]=[e("i",{class:"fa fa-add"},null,-1),b(" Add source ",-1)])],8,qe),s[19]||(s[19]=e("h6",null,"Dependency settings",-1)),s[20]||(s[20]=e("p",{class:"text-body-secondary"}," Specify which other files have to be loaded when building this file. ",-1)),(l(!0),n(g,null,D(i.needs,u=>(l(),n("div",ze,[s[13]||(s[13]=e("span",{class:"input-group-text"},"Dependency",-1)),e("input",{value:a.releaseScript.files[u]?.target.file??u,class:"form-control",disabled:"",type:"text"},null,8,Ke),e("button",{class:"btn btn-danger",onClick:j=>y(t,u)},[...s[12]||(s[12]=[e("i",{class:"fa fa-trash"},null,-1)])],8,Xe)]))),256)),e("button",{class:"mb-3 btn btn-sm btn-primary add-dependency",onClick:u=>c(t)},[...s[14]||(s[14]=[e("i",{class:"fa fa-add"},null,-1),b(" Add dependency ",-1)])],8,Ze)])]),_:2},1024))),256)),e("div",{class:"d-flex gap-2"},[e("button",{class:"mb-3 btn btn-sm btn-primary add-file",onClick:w},[...s[21]||(s[21]=[e("i",{class:"fa fa-add"},null,-1),b(" Add file ",-1)])])])]),s[29]||(s[29]=e("h3",null,"Steps",-1)),e("button",{class:"btn btn-outline-primary add-step mb-3",onClick:s[0]||(s[0]=i=>k(i,0))},[...s[23]||(s[23]=[e("i",{class:"fa fa-plus-square"},null,-1),b(" Add step here ",-1)])]),(l(!0),n(g,null,D(a.releaseScript.steps,(i,t)=>(l(),n(g,null,[e("div",Qe,[e("h6",null,d(i.name),1),s[25]||(s[25]=e("span",null,null,-1)),e("button",{class:"btn btn-danger btn-sm btn-circle",style:{"margin-bottom":".5rem"},onClick:u=>A(u,t)},[...s[24]||(s[24]=[e("i",{class:"fa fa-trash"},null,-1)])],8,Ye)]),e("div",et,[s[26]||(s[26]=e("span",{class:"input-group-text"},"Release step",-1)),V(e("input",{"onUpdate:modelValue":u=>i.name=u,class:"form-control",type:"text"},null,8,tt),[[J,i.name]])]),e("div",st,[s[27]||(s[27]=e("span",{class:"input-group-text"},"Arguments",-1)),e("textarea",{value:Object.entries(i.args).map(([u,j])=>`${u}: ${j}`).join(`
`),class:"form-control",onChange:u=>r(t,u.target?.value)},"            ",40,lt)]),e("button",{class:"btn btn-outline-primary add-step mb-3",onClick:u=>k(u,t+1)},[...s[28]||(s[28]=[e("i",{class:"fa fa-plus-square"},null,-1),b(" Add step here ",-1)])],8,nt)],64))),256)),e("div",at,[q(f.$slots,"buttons",{},void 0,!0)])],64))}}),it=le(ot,[["__scopeId","data-v-7cac764c"]]),rt={class:"preparation"},ut={key:0,class:"placeholder",style:{width:"400px"}},dt={class:"btn-group w-100"},ct=["disabled"],pt=["disabled"],ft={class:"dropdown-menu"},mt={class:"list-group mt-2"},gt={class:"list-group-item"},bt=["href"],yt={class:"ms-2 me-auto"},ht={class:"fw-bold"},vt={key:0,class:"fa fa-save"},kt={key:1,class:"fa fa-spin fa-spinner"},_t={key:2,class:"fa fa-check"},$t={key:3,class:"fa fa-xmark"},xt=E({__name:"Setup",props:{repo:{}},emits:["settingsConfirmed"],setup(a){const p=R(),o=R(null),r=URLS.prefix,c=R("idle"),y=a,w=R(null),v=N(()=>w.value===null),k=N(()=>w.value?.find(i=>i.state==="completed")??null),A=N(()=>w.value?.[0]??null);te(y,(i,t)=>i.repo!==t.repo&&U());async function U(){if(y.repo){o.value=null,o.value=await(await fetch(`${r}/api/release/${y.repo}/release_script`)).json();const i=await(await fetch(`${r}/api/release/${y.repo}`)).json();i.sort((t,u)=>new Date(t.start).getTime()-new Date(u.start).getTime()),w.value=i}}let f=null;async function s(i){i.preventDefault(),f!==null&&clearTimeout(f),c.value="saving";try{(await fetch(`${r}/api/release/${y.repo}/release_script`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o.value)})).ok?c.value="success":c.value="error"}catch{c.value="error"}f=setTimeout(()=>{c.value="idle",f=null},5e3)}return se(()=>U()),(i,t)=>(l(),n("div",rt,[t[5]||(t[5]=e("h3",null,"Release setup",-1)),e("p",null,[b(" Currently, there is no release running for "+d(a.repo)+". ",1),v.value?(l(),n("span",ut)):k.value?(l(),n(g,{key:1},[b(d(k.value.started_by)+" started the last successful release on "+d(i.$filters.formatDate(k.value.start)),1)],64)):A.value?(l(),n(g,{key:2},[b(d(A.value.started_by)+" started the last release on "+d(i.$filters.formatDate(A.value.start))+". But it did not complete. ",1)],64)):(l(),n(g,{key:3},[b(" There have been no releases in the near past. ")],64))]),e("div",dt,[e("button",{disabled:!o.value,class:"btn btn-success",onClick:t[0]||(t[0]=u=>i.$emit("settingsConfirmed",o.value))},[...t[2]||(t[2]=[e("i",{class:"fa fa-play"},null,-1),b(" Start a release ",-1)])],8,ct),e("button",{disabled:!o.value,class:"btn btn-success dropdown-toggle dropdown-toggle-split flex-grow-0","data-bs-toggle":"dropdown",type:"button"},null,8,pt),e("ul",ft,[e("li",null,[e("a",{class:"dropdown-item",href:"#",onClick:t[1]||(t[1]=u=>p.value=!p.value)},[e("i",{class:L([[p.value?"fa-check-square":"fa-square"],"fa-regular"])},null,2),t[3]||(t[3]=b(" Show advanced configuration ",-1))])])])]),e("ul",mt,[(l(!0),n(g,null,D(w.value,u=>(l(),n("li",gt,[e("a",{class:"d-flex justify-content-between align-items-start",style:{"text-decoration":"none",color:"inherit"},href:`${u.id}`},[e("div",yt,[e("div",ht,d(i.$filters.formatDate(u.start)),1),b(" "+d(u.started_by),1)]),e("span",{class:L(["badge rounded-pill",{"text-bg-primary":["running","waiting-for-user"].indexOf(u.state)>=0,"text-bg-success":u.state==="success","text-bg-error":u.state==="errored","text-bg-secondary":u.state==="canceled"}])},d(u.state),3)],8,bt)]))),256))]),o.value&&p.value?(l(),O(it,{key:0,"release-script":o.value,class:"mt-2"},{buttons:C(()=>[e("button",{class:L([{"btn-primary":c.value==="idle"||c.value==="saving","btn-success":c.value==="success","btn-danger":c.value==="error"},"mb-3 btn btn-sm btn-primary"]),onClick:s},[c.value==="idle"?(l(),n("i",vt)):_("",!0),c.value==="saving"?(l(),n("i",kt)):_("",!0),c.value==="success"?(l(),n("i",_t)):_("",!0),c.value==="error"?(l(),n("i",$t)):_("",!0),t[4]||(t[4]=b(" Save release script ",-1))],2)]),_:1},8,["release-script"])):_("",!0)]))}}),wt=["href"],T=E({__name:"ErrorLink",props:{short_repository_name:{},error:{},term:{}},setup(a){const p=a,o=N(()=>p.term?p.term:p.error),r=URLS.prefix;return(c,y)=>o.value.hasOwnProperty("origin")&&o.value.origin?(l(),n("a",{key:0,target:"_blank",href:`${F(r)}/edit/${a.short_repository_name}/${o.value.origin[0]}?row=${o.value.origin[1]}`},[q(c.$slots,"default",{},()=>[e("i",null,[y[3]||(y[3]=b(" at ",-1)),e("b",null,d(o.value.origin[0]),1),a.error&&"row"in a.error?(l(),n(g,{key:0},[y[0]||(y[0]=b(" row ",-1)),e("b",null,d(a.error.row),1)],64)):_("",!0),a.error&&"column"in a.error?(l(),n(g,{key:1},[y[1]||(y[1]=b(" column ",-1)),e("b",null,d(a.error.column),1)],64)):_("",!0),!a.error&&o.value.origin[1]>=0?(l(),n(g,{key:2},[y[2]||(y[2]=b(" row ",-1)),e("b",null,d(o.value.origin[1]),1)],64)):_("",!0)])])],8,wt)):_("",!0)}}),K=URLS.prefix;async function St(a,p,o){try{const c=await(await fetch(`${K}/api/external/guess-parent`,{method:"post",body:JSON.stringify({term:{id:a.id??void 0,label:a.label??void 0},parent:{id:o?.id??void 0,label:o?.label??void 0}}),headers:{"Content-Type":"application/json"}})).json();if(c)return c.map(y=>({...y,kind:"external"}))}catch{}return null}async function Ct(a,p,o){const r=o.term;if(await we({title:"Found an external parent",message:`An external parent <code>${r.label}</code> (<code>${r.id}</code>) of <code>${a.term.label}</code> (<code>${a.term.id}</code>) was found. Import the term?`,buttons:{confirm:{label:`Import ${r.id}`,className:"btn-success"},cancel:{label:"Cancel",className:"btn-warning"}}}))try{if((await fetch(`${K}/api/external/${p}/import`,{method:"post",body:JSON.stringify({terms:[{id:r.id,label:r.label}],ontologyId:o.ontology_id}),headers:{"Content-Type":"application/json"}})).ok)return"fixed"}catch{return"impossible"}return"loaded"}async function Ot(a,p,o){const r=await Se({title:"Found possible external parents",message:`Found ${a.length} possible external terms for <code>${p.parent.label}</code>. Select the correct parent term of <code>${p.term.label}</code> (<code>${p.term.id}</code>) if it is in the list.`,inputType:"select",inputOptions:a.map((c,y)=>({value:y.toString(),text:`${c.term.label} (${c.term.id})`})),buttons:{confirm:{label:"Import the selected term",className:"btn-success"},cancel:{label:"Cancel",className:"btn-warning"}}});if(r!==null){const c=a[+r],y=c.term;try{return(await fetch(`${K}/api/external/${o}/import`,{method:"post",body:JSON.stringify({terms:[{id:y.id,label:y.label}],ontologyId:c.ontology_id}),headers:{"Content-Type":"application/json"}})).ok?"fixed":"impossible"}catch{return"impossible"}}return"loaded"}async function At(a,p){const o=await St(a.term,p,a.parent);return o!==null&&o.length>0?o.length===1?await Ct(a,p,o[0]):await Ot(o,a,p):"impossible"}const Tt={key:0,class:"alert alert-success"},Nt={key:1},jt={class:"text-danger bg-danger-subtle rounded ps-1 pe-1"},It={class:"text-warning bg-warning-subtle rounded ps-1 pe-1"},Rt=["onClick"],Dt={key:0,class:"fa fa-spin fa-spinner"},Pt={key:1,class:"fa fa-check"},Et={key:2,class:"fa fa-close"},Ut={style:{"text-transform":"capitalize"}},Vt={key:0},Lt={key:1},Wt={key:2},Ft={key:3},Mt={class:"alert alert-warning val val-warning val-warning-type-{{ warning.type }} val-warning-source-{{ source }}",role:"alert"},Jt=["onClick"],Bt={key:0,class:"fa fa-spin fa-spinner"},Gt={key:1,class:"fa fa-check"},Ht={key:2,class:"fa fa-close"},qt=["onClick"],zt={key:0,class:"fa fa-spin fa-spinner"},Kt={key:1,class:"fa fa-check"},Xt={key:2,class:"fa fa-close"},Zt=E({__name:"Validation",props:{data:{},release:{},selectedSubStep:{}},emits:["release-control"],setup(a){const p=URLS.prefix,o=a,r=R({});function c(f){const s=JSON.stringify(f);return r.value[s]??null}const y=N(()=>o.data?Object.values(o.data).flatMap(f=>f.errors):null),w=N(()=>o.data?Object.values(o.data).flatMap(f=>f.warnings):null),v=N(()=>o.release.release_script.short_repository_name);async function k(f,s,i){const t=o.release.release_script.short_repository_name;try{return(await fetch(`${p}/api/edit/${t}/${f}`,{method:"PATCH",body:JSON.stringify({id:s,term:{id:i.id,parent:i.sub_class_of[0]?.label,label:i.label}}),headers:{"Content-Type":"application/json"}})).ok?"fixed":"impossible"}catch{return"impossible"}}async function A(f,s,i,t){const u=JSON.stringify(f);u in r.value&&r.value[u]!=="loaded"||(r.value[u]=await k(f?.term?.origin?.[0]??i?.origin?.[0],s,i))}async function U(f){let s=JSON.stringify(f);if(s in r.value&&r.value[s]!=="loaded")return;const i=o.release.release_script.short_repository_name;if(r.value[s]="loading",f.type==="unknown-parent")r.value[s]=await At(f,i);else if(f.type==="missing-import")try{(await fetch(`${p}/api/external/${i}/import`,{method:"post",body:JSON.stringify({terms:[{id:f.term.id,label:f.term.label}],ontologyId:f.term.id.split(":")[0]}),headers:{"Content-Type":"application/json"}})).ok&&(r.value[s]="fixed")}catch(t){r.value[s]="impossible",console.error(t)}else r.value[s]="impossible";r.value[s]=="loading"&&(r.value[s]="loaded")}return(f,s)=>(l(),n(g,null,[s[18]||(s[18]=e("h3",null,"Validation",-1)),!a.data||Object.keys(a.data).length===1&&"__progress"in a.data?(l(),O(F(z),{key:0,release:a.release,details:a.data||{}},{default:C(()=>[...s[0]||(s[0]=[b(" All excel files are now being validated. The results will be presented here soon. ",-1)])]),_:1},8,["release","details"])):(l(),n(g,{key:1},[y.value?.length==0&&w.value?.length==0?(l(),n("div",Tt,[...s[1]||(s[1]=[e("h5",null,"Everything ok",-1),b(" Good work! All files are valid. The release process will continue. ",-1)])])):(l(),n("p",Nt,[e("span",jt,d(y.value?.length??0)+" "+d(f.$filters.pluralise("error",y.value)),1),s[2]||(s[2]=b(" and ",-1)),e("span",It,d(w.value?.length??0)+" "+d(f.$filters.pluralise("warning",w.value)),1),s[3]||(s[3]=b(" were found during the validation. Please fix the errors and save the spreadsheets. Errors are problems which prevent the release from continuing. Warnings hint at possible problems, but the release might continue without solving them. When you fixed all errors, restart the release. If you just want to rerun the validation, restart the release as well. ",-1))])),(l(!0),n(g,null,D(a.data?Object.keys(a.data):[],i=>(l(),n(g,null,[a.selectedSubStep===null||a.selectedSubStep===i?(l(),n(g,{key:0},[(l(!0),n(g,null,D(a.data?.[i].errors,t=>(l(),n("div",{class:L([[`val-error-type-${t.type}`,`val-error-source-${i}`],"alert alert-danger val val-error"]),role:"alert"},[t.type==="unknown-parent"?(l(),n(g,{key:0},[S(I,{diagnostic:t},{default:C(()=>[S(T,{error:t,short_repository_name:v.value,term:t.term??t.relation},null,8,["error","short_repository_name","term"])]),_:2},1032,["diagnostic"]),a.release.release_script.short_repository_name.toLowerCase()!=="addicto"?(l(),n("button",{key:0,class:L([{"btn-success":c(t)==="fixed","btn-danger":c(t)==="impossible"},"btn btn-primary"]),onClick:u=>U(t)},[c(t)==="loading"?(l(),n("i",Dt)):_("",!0),c(t)==="fixed"?(l(),n("i",Pt)):_("",!0),c(t)==="impossible"?(l(),n("i",Et)):_("",!0),s[4]||(s[4]=b(" Try auto fix ",-1))],10,Rt)):_("",!0)],64)):t.type==="missing-parent"?(l(),O(I,{key:1,diagnostic:t},{default:C(()=>[S(T,{error:t,short_repository_name:v.value,term:t.term??t.relation},null,8,["error","short_repository_name","term"])]),_:2},1032,["diagnostic"])):t.type==="no-parent"?(l(),O(I,{key:2,diagnostic:t},{default:C(()=>[S(T,{error:t,short_repository_name:v.value,term:t.term??t.relation},null,8,["error","short_repository_name","term"])]),_:2},1032,["diagnostic"])):t.type==="ignored-parent"?(l(),O(I,{key:3,diagnostic:t},{default:C(()=>[S(T,{error:t,short_repository_name:v.value,term:t.term??t.relation},null,8,["error","short_repository_name","term"])]),_:2},1032,["diagnostic"])):t.type==="missing-label"?(l(),O(I,{key:4,diagnostic:t},{default:C(()=>[S(T,{error:t,short_repository_name:v.value,term:t.term??t.relation},null,8,["error","short_repository_name","term"])]),_:2},1032,["diagnostic"])):t.type==="missing-id"?(l(),O(I,{key:5,diagnostic:t},{default:C(()=>[S(T,{error:t,short_repository_name:v.value,term:t.term??t.relation},null,8,["error","short_repository_name","term"])]),_:2},1032,["diagnostic"])):t.type==="unknown-disjoint"?(l(),O(I,{key:6,diagnostic:t},{default:C(()=>[S(T,{error:t,short_repository_name:v.value,term:t.term??t.relation},null,8,["error","short_repository_name","term"])]),_:2},1032,["diagnostic"])):t.type==="unknown-relation-value"?(l(),O(I,{key:7,diagnostic:t},{default:C(()=>[S(T,{error:t,short_repository_name:v.value,term:t.term??t.relation},null,8,["error","short_repository_name","term"])]),_:2},1032,["diagnostic"])):t.type==="ignored-relation-value"?(l(),O(I,{key:8,diagnostic:t},{default:C(()=>[S(T,{error:t,short_repository_name:v.value,term:t.term??t.relation},null,8,["error","short_repository_name","term"])]),_:2},1032,["diagnostic"])):t.type==="unknown-range"?(l(),O(I,{key:9,diagnostic:t},{default:C(()=>[S(T,{error:t,short_repository_name:v.value,term:t.relation},null,8,["error","short_repository_name","term"])]),_:2},1032,["diagnostic"])):t.type==="unknown-domain"?(l(),O(I,{key:10,diagnostic:t},{default:C(()=>[S(T,{error:t,short_repository_name:v.value,term:t.relation},null,8,["error","short_repository_name","term"])]),_:2},1032,["diagnostic"])):t.type==="unknown-relation"?(l(),O(I,{key:11,diagnostic:t},{default:C(()=>[S(T,{error:t,short_repository_name:v.value,term:t.relation},null,8,["error","short_repository_name","term"])]),_:2},1032,["diagnostic"])):t.type==="duplicate"?(l(),n(g,{key:12},[s[11]||(s[11]=e("h5",null,"Conflicting entries (duplicates)",-1)),e("p",null,[b(" There are multiple terms for the "+d(t.duplicate_field)+" ",1),e("code",null,d(t.duplicate_value),1),s[5]||(s[5]=b(": ",-1))]),e("ul",null,[(l(!0),n(g,null,D(t.mismatches,u=>(l(),n("li",null,[e("p",null,[e("span",Ut,d(u.field),1),s[6]||(s[6]=b(" is ",-1)),["definition","curation status"].indexOf(u.field)>=0?(l(),n("code",Vt,d(u.a.relations.find(j=>j[0]?.label?.endsWith(u.field))?.[1]),1)):(l(),n("code",Lt,d(u.a[u.field]),1)),s[7]||(s[7]=e("br",null,null,-1)),S(T,{short_repository_name:v.value,term:u.a},null,8,["short_repository_name","term"]),s[8]||(s[8]=e("br",null,null,-1)),s[9]||(s[9]=b(" and ",-1)),["definition","curation status"].indexOf(u.field)>=0?(l(),n("code",Wt,d(u.b.relations.find(j=>j[0]?.label?.endsWith(u.field))?.[1]),1)):(l(),n("code",Ft,d(u.b[u.field]),1)),s[10]||(s[10]=e("br",null,null,-1)),S(T,{short_repository_name:v.value,term:u.b},null,8,["short_repository_name","term"])])]))),256))])],64)):(l(),n(g,{key:13},[e("h5",null,d(t.type.replace("-"," ")),1),e("p",null,[b(d(t.msg),1),s[12]||(s[12]=e("br",null,null,-1)),S(T,{error:t,short_repository_name:v.value},null,8,["error","short_repository_name"])]),e("pre",null,d(JSON.stringify(t,void 0,2)),1)],64))],2))),256)),(l(!0),n(g,null,D(a.data?.[i].warnings,t=>(l(),n("div",Mt,[t.type=="incomplete-term"?(l(),O(I,{key:0,diagnostic:t},{default:C(()=>[S(T,{error:t,short_repository_name:v.value},null,8,["error","short_repository_name"])]),_:2},1032,["diagnostic"])):t.type==="unknown-column"?(l(),O(I,{key:1,diagnostic:t},null,8,["diagnostic"])):t.type==="missing-import"?(l(),n(g,{key:2},[S(I,{diagnostic:t},{default:C(()=>[S(T,{error:t,short_repository_name:v.value,term:t.term},null,8,["error","short_repository_name","term"])]),_:2},1032,["diagnostic"]),e("button",{class:L([{"btn-success":c(t)==="fixed","btn-danger":c(t)==="impossible"},"btn btn-primary"]),onClick:u=>U(t)},[c(t)==="loading"?(l(),n("i",Bt)):_("",!0),c(t)==="fixed"?(l(),n("i",Gt)):_("",!0),c(t)==="impossible"?(l(),n("i",Ht)):_("",!0),s[13]||(s[13]=b(" Import ",-1))],10,Jt)],64)):t.type==="inconsistent-import"?(l(),n(g,{key:3},[S(I,{diagnostic:t},{default:C(()=>[S(T,{error:t,short_repository_name:v.value,term:t.term},null,8,["error","short_repository_name","term"])]),_:2},1032,["diagnostic"]),e("button",{class:L([{"btn-success":c(t)==="fixed","btn-danger":c(t)==="impossible"},"btn btn-primary"]),onClick:u=>A(t,t.term.id,{...t.term.id,label:t.term.label,id:t.term.id})},[c(t)==="loading"?(l(),n("i",zt)):_("",!0),c(t)==="fixed"?(l(),n("i",Kt)):_("",!0),c(t)==="impossible"?(l(),n("i",Xt)):_("",!0),s[16]||(s[16]=b(" Change ",-1)),t.term.id!==t.imported_term.id?(l(),n(g,{key:3},[s[14]||(s[14]=b(" ID to ",-1)),e("code",null,d(t.imported_term.id),1)],64)):(l(),n(g,{key:4},[s[15]||(s[15]=b("label to ",-1)),e("code",null,d(t.imported_term.label),1)],64))],10,qt)],64)):(l(),n(g,{key:4},[e("h5",null,d(t.type.replace("-"," ")),1),e("p",null,[b(d(t.msg),1),s[17]||(s[17]=e("br",null,null,-1)),S(T,{error:t,short_repository_name:v.value},null,8,["error","short_repository_name"])]),e("pre",null,d(JSON.stringify(t,void 0,2)),1)],64))]))),256))],64)):_("",!0)],64))),256))],64))],64))}}),Qt=["href","download"],Yt={class:"list-unstyled"},es={class:"ms-4"},ts={class:"form-check"},ss=["disabled"],ls={class:"ms-4"},ns={class:"form-check"},as=["disabled"],os={key:0,class:"ms-4"},is={class:"form-check"},rs=["disabled"],us=["disabled"],ds=E({__name:"HumanVerification",props:{data:{},release:{},selectedSubStep:{}},emits:["release-control"],setup(a){const p=a,o=R(p.release.state==="completed"),r=R(p.release.state==="completed"),c=R(p.release.state==="completed"),y=N(()=>!!p.data?.files?.find(v=>v.name.endsWith(".xlsx"))),w=N(()=>[r.value,o.value,!y.value||c.value].reduce((v,k)=>v&&k,!0));return(v,k)=>(l(),n(g,null,[k[7]||(k[7]=e("h3",null,"Verify the built ontologies",-1)),k[8]||(k[8]=e("p",null,[b(" Please download the built files and ontologies and open them in Protégé (download "),e("a",{href:"https://protege.stanford.edu/software.php#desktop-protege"},"here"),b(" or use "),e("a",{href:"https://webprotege.stanford.edu/"},"Web protege"),b("). ")],-1)),e("ul",null,[(l(!0),n(g,null,D(a.data?.files,A=>(l(),n("li",null,[e("a",{href:A.link,download:A.name},d(A.name),9,Qt)]))),256))]),k[9]||(k[9]=e("p",null," Check the following things: ",-1)),e("ul",Yt,[e("li",es,[e("div",ts,[V(e("input",{"onUpdate:modelValue":k[0]||(k[0]=A=>o.value=A),disabled:a.release.state!=="waiting-for-user",class:"form-check-input checklist",type:"checkbox",value:"",id:"chk-inferred"},null,8,ss),[[B,o.value]]),k[4]||(k[4]=e("label",{class:"form-check-label",for:"chk-inferred"}," Start the reasoner. Does the inferred hierarchy look alright? ",-1))])]),e("li",ls,[e("div",ns,[V(e("input",{"onUpdate:modelValue":k[1]||(k[1]=A=>r.value=A),disabled:a.release.state!=="waiting-for-user",class:"form-check-input checklist",type:"checkbox",value:"",id:"chk-labels"},null,8,as),[[B,r.value]]),k[5]||(k[5]=e("label",{class:"form-check-label",for:"chk-labels"}," Do the labels look alright? ",-1))])]),y.value?(l(),n("li",os,[e("div",is,[V(e("input",{"onUpdate:modelValue":k[2]||(k[2]=A=>c.value=A),disabled:a.release.state!=="waiting-for-user",class:"form-check-input checklist",type:"checkbox",value:"",id:"chk-hierarchical-spreadsheets"},null,8,rs),[[B,c.value]]),k[6]||(k[6]=e("label",{class:"form-check-label",for:"chk-hierarchical-spreadsheets"}," Do the hierarchy, labels, and other fields in the hierarchical spreadsheets look alright? ",-1))])])):_("",!0)]),e("button",{class:"btn btn-success w-100",id:"btn-publish-release",disabled:!w.value||a.release.state!=="waiting-for-user",onClick:k[3]||(k[3]=A=>v.$emit("release-control","continue"))}," Everything looks alright. Publish the release! ",8,us)],64))}}),cs={class:"alert alert-danger"},ps={key:1},ne=E({__name:"TechnicalError",props:{release:{},details:{}},setup(a){return(p,o)=>(l(),n(g,null,[o[4]||(o[4]=e("div",{class:"alert alert-danger"},[e("h4",null,"An error occurred while building the file"),e("p",null," A technical error occurred. Please contact an administrator. ")],-1)),(l(!0),n(g,null,D(a.details.errors,r=>(l(),n("div",cs,["code"in r?(l(),n(g,{key:0},[o[0]||(o[0]=e("h6",null,"Command",-1)),e("pre",null,d(r.command),1),o[1]||(o[1]=e("h6",null,"Return code",-1)),e("p",null,d(r.code),1),o[2]||(o[2]=e("h6",null,"Standard out",-1)),e("pre",null,d(r.out),1),o[3]||(o[3]=e("h6",null,"Standard error",-1)),e("pre",null,d(r.err),1)],64)):(l(),n("pre",ps,d(JSON.stringify(r,void 0,2)),1))]))),256))],64))}}),fs=E({__name:"GithubPublish",props:{data:{},release:{},selectedSubStep:{}},emits:["release-control"],setup(a){return(p,o)=>(l(),n(g,null,[o[3]||(o[3]=e("h3",null,"Publishing the release",-1)),a.release.state=="waiting-for-user"&&a.data&&(a.data.errors?.length??0)>0?(l(),O(ne,{key:0,release:a.release,details:a.data},null,8,["release","details"])):a.release.state==="completed"?(l(),n(g,{key:1},[o[0]||(o[0]=e("p",null," The ontologies are now published to github and the release is completed. ",-1)),o[1]||(o[1]=e("div",{class:"text-center w-100 text-success",style:{"font-size":"100px"}},[e("i",{class:"fa fa-check-double"})],-1))],64)):(l(),O(F(z),{key:2,details:a.data,release:a.release},{default:C(()=>[...o[2]||(o[2]=[b(" The ontologies are being published to github. ",-1)])]),_:1},8,["details","release"]))],64))}}),ms={key:2},gs=E({__name:"Generic",props:{data:{},release:{},step:{}},emits:["release-control"],setup(a){const p={PREPARATION:{title:"Preparation",running_text:"Excel files are downloaded to the server and prepared.",finished_text:"Excel files were downloaded to the server."},IMPORT_EXTERNAL:{title:"Building external dependencies",running_text:"External ontologies are now downloaded and converted. This might take a few minutes.",finished_text:"External ontologies were successfully downloaded and converted."},BUILD:{title:"Building OWL files",running_text:"OWL files are now build.",finished_text:"OWL files were successfully built."},MERGE:{title:"Merging files",running_text:"Multiple OWL files are being combined into one.",finished_text:"Multiple OWL files were combined into one."}},o=a;function r(v){return v.replace("_"," ").replace(/\w\S*/g,k=>k.charAt(0).toUpperCase()+k.substring(1).toLowerCase())}const c=N(()=>p[o.step.name]?.title??r(o.step.name??"<MISSING>")),y=N(()=>p[o.step.name]?.running_text??""),w=N(()=>p[o.step.name]?.finished_text??"");return(v,k)=>(l(),n(g,null,[e("h3",null,d(c.value),1),a.release.state=="waiting-for-user"&&a.data&&(a.data.errors?.length??0)>0?(l(),O(ne,{key:0,release:a.release,details:a.data},null,8,["release","details"])):(l(),O(F(z),{key:1,details:a.data,release:a.release},{default:C(()=>[b(d(y.value),1)]),_:1},8,["details","release"])),a.release.state==="completed"?(l(),n("p",ms,d(w.value),1)):_("",!0)],64))}}),bs={class:"release"},ys={class:"d-flex gap-2 align-items-center"},hs={id:"lbl-release-title"},vs={key:0,id:"release-info",class:"align-self-end mb-2 text-muted"},ks={key:0,class:"alert alert-danger"},_s={key:1,style:{display:"grid","grid-template-columns":"240px 1fr","grid-gap":"50px"},class:"text-start w-100",id:"release-core"},$s={class:"sidebar border",style:{"grid-column":"1"}},xs={class:"list-unstyled ps-2"},ws={class:"mb-1"},Ss={class:"d-flex align-items-center"},Cs=["onClick"],Os={key:0},As={key:0,class:"list-unstyled ms-4"},Ts={style:{display:"flex","align-items":"center"}},Ns={key:0,class:"fa fa-circle-exclamation text-danger"},js={key:1,class:"fa fa-triangle-exclamation text-warning"},Is={key:2,class:"fa fa-check-circle text-success"},Rs=["onClick"],Ds={key:0},Ps={class:"main",style:{"grid-column":"2"}},Es={key:0,class:"alert alert-danger"},Us={key:1,class:"alert alert-danger"},Vs={key:0,class:"loading"},Ls=E({__name:"Release",setup(a){const p=SERVER_DATA.repo,o=URLS.prefix,r=R(null),c=R(!1),y=R(null),w=R(null),v=R(null),k={VALIDATION:Zt,HUMAN_VERIFICATION:ds,GITHUB_PUBLISH:fs},A=ke({}),U=N(()=>({...k,...A.value}));async function f(){try{const h=await fetch(`${o}/api/plugins/`);if(!h.ok)return;const m=await h.json(),$={};for(const x of m)if(!(!x.has_static||!x.js_module||x.components.length===0))for(const P of x.components){const W=x.id,Y=x.js_module,fe=P.component_name;$[P.step_name]=he(ve(async()=>{const ee=await import(`${o}/api/plugins/${W}/static/${Y}`);return ee[fe]||ee.default}))}A.value=$}catch(h){console.error("Failed to load plugins:",h)}}const s=N(()=>r.value?.release_script.steps[w.value??r.value.step]??null),i=N(()=>U.value[s.value?.name]??gs),t=N(()=>{const h={data:u.value,release:r.value,selectedSubStep:v.value,step:s.value},m=i.value;if(m){const $=Object.keys(m.props);return Object.fromEntries(Object.entries(h).filter(([x,P])=>$.indexOf(x)>=0))}return null}),u=N(()=>r.value?.details[(w.value??r.value.step).toString()]);function j(h){if(h instanceof Object){const $=Object.entries(h).filter(([x,P])=>!x.startsWith("_")&&["warnings","errors","infos"].indexOf(x)<0&&Array.isArray(P?.warnings)&&Array.isArray(P?.errors));return $.length>0?Object.fromEntries($):null}return null}async function M(h=!1){const m=r.value?.id??`${p}/running`;c.value=h;try{let $=await fetch(`${o}/api/release/${m}`);$.ok?r.value=await $.json():r.value=null}catch{}finally{c.value=!1}}se(async()=>{await f();const h=window.location.pathname.split("/").slice(-1)[0],m=parseInt(h);isNaN(m)?await M(!0):r.value=await H(()=>fetch(`${o}/api/release/${m}`))??null});let G=null;function X(){G===null&&(G=setInterval(M,2e3))}const oe=te(r,(h,m)=>{m===null&&h!==null&&G===null&&h.state==="running"&&(oe(),X())}),ie=N(()=>{switch(r.value?.state){case void 0:case null:return["fa-regular","fa-file","text-black-50"];case"canceled":return["fa-regular","fa-circle-xmark","text-danger"];case"waiting-for-user":return["fa-solid","fa-user-clock","text-warning"];case"errored":return["fa-solid","fa-triangle-exclamation","text-danger"];case"completed":return["fa-regular","fa-circle-check","text-success"];default:return["fa-spinner","fa-spin","text-black-50"]}});async function H(h,m=null){try{c.value=!0;const $=await h();if($.ok){const x=await $.json();return m!==null?await m(x):x}else{const x=await $.json();y.value=x.error}c.value=!1}catch($){$ instanceof Error?y.value=$.message:y.value=`An unknown error occurred: ${$}`}finally{c.value=!1}}async function Z(h){const m=await H(()=>fetch(o+"/api/release/start",{method:"post",body:JSON.stringify(h),headers:{"Content-Type":"application/json"}}));m&&(r.value=m,window.location.pathname=`${o}/admin/release/${m.id}`)}async function Q(){r.value=await H(()=>fetch(`${o}/api/release/${p}/cancel`,{method:"post"}))??null}async function re(){const h=r.value?.release_script;h&&(await Q(),await Z(h))}function ue(h){const m=r.value?.details[h.toString()];if(m?.hasOwnProperty("errors")&&Array.isArray(m.errors))return m.errors.length;if(Array.isArray(m))return m.map($=>$.errors?.length).reduce(($,x)=>x+$,0)}function de(h){const m=r.value?.details[h.toString()];if(m?.hasOwnProperty("warnings")&&Array.isArray(m.warnings))return m.warnings.length;if(m)return Object.values(m).map($=>$.warnings?.length).reduce(($,x)=>x+$,0)}function ce(h){return(r.value?.step??0)>=h?ue(h)>0?"fa fa-triangle-exclamation text-danger".split(" "):de(h)>0?"fa fa-triangle-exclamation text-warning".split(" "):r.value?.step===h&&r.value.state!=="completed"?"fa-regular fa-circle text-primary".split(" "):"fa-regular fa-check-circle text-success".split(" "):"fa-regular fa-clock text-warning".split(" ")}async function pe(h){h==="continue"?(await fetch(`${o}/api/release/${p}/continue`),X()):console.warn(`No such release control type: '${h}'`)}return(h,m)=>(l(),n(g,null,[e("div",bs,[e("div",ys,[e("h1",hs,[e("i",{id:"icon-release",class:L(["fa",ie.value])},null,2),b(" Release "+d(F(p)),1)]),r.value?(l(),n("span",vs," started by "+d(r.value.started_by)+" on "+d(h.$filters.formatDate(r.value.start)),1)):_("",!0),m[3]||(m[3]=e("span",{class:"flex-fill"},null,-1)),r.value&&["running","waiting-for-user","errored"].indexOf(r.value.state)>=0?(l(),n(g,{key:1},[e("button",{class:"btn btn-warning",id:"btn-release-restart",onClick:re},[...m[1]||(m[1]=[e("i",{class:"fa fa-rotate-left"},null,-1),b(" Restart ",-1)])]),e("button",{class:"btn btn-danger",id:"btn-release-cancel",onClick:Q},[...m[2]||(m[2]=[e("i",{class:"fa fa-cancel"},null,-1),b(" Cancel ",-1)])])],64)):_("",!0)]),!r.value&&!c.value?(l(),n(g,{key:0},[y.value!==null?(l(),n("div",ks,[m[4]||(m[4]=e("h4",null,"An error occurred",-1)),b(" "+d(y.value),1)])):_("",!0),r.value?_("",!0):(l(),O(xt,{key:1,style:{"max-width":"1080px",margin:"0 auto"},repo:F(p),onSettingsConfirmed:m[0]||(m[0]=$=>Z($))},null,8,["repo"]))],64)):_("",!0),r.value!==null?(l(),n("div",_s,[e("div",$s,[e("ul",xs,[(l(!0),n(g,null,D(r.value.release_script.steps,($,x)=>(l(),n("li",ws,[e("div",Ss,[e("i",{class:L(ce(x))},null,2),e("a",{class:"btn border-0",onClick:P=>{w.value=x,v.value=null}},[(w.value!==null?w.value==x:r.value.step==x)?(l(),n("strong",Os,d(h.$filters.formatText($.name)),1)):(l(),n(g,{key:1},[b(d(h.$filters.formatText($.name)),1)],64))],8,Cs)]),j?(l(),n("ul",As,[(l(!0),n(g,null,D(j(r.value.details[x]),(P,W)=>(l(),n("li",Ts,[(P.errors?.length??0)>0?(l(),n("i",Ns)):(P.warnings?.length??0)>0?(l(),n("i",js)):(l(),n("i",Is)),e("a",{class:"btn border-0 text-truncate",onClick:Y=>v.value=v.value===W?null:W},[v.value===W?(l(),n("strong",Ds,d(W),1)):(l(),n(g,{key:1},[b(d(W),1)],64))],8,Rs)]))),256))])):_("",!0)]))),256))])]),e("div",Ps,[y.value!==null?(l(),n("div",Es,[m[5]||(m[5]=e("h4",null,"An error occurred",-1)),b(" "+d(y.value),1)])):_("",!0),u.value?.error?(l(),n("div",Us,[e("h4",null,"An error occurred: "+d(u.value.error.short),1),e("pre",null,d(u.value.error.long),1)])):_("",!0),(l(),O(ye(i.value),be(t.value,{onReleaseControl:pe}),null,16))])])):_("",!0)]),c.value?(l(),n("div",Vs,[...m[6]||(m[6]=[e("div",{class:"inner text-light"},[e("div",{class:"spinner-border",style:{width:"5rem",height:"5rem"},role:"status"}),e("h5",null,"Loading...")],-1)])])):_("",!0)],64))}}),Ws=le(Ls,[["__scopeId","data-v-41cdb91b"]]),ae=_e(Ws);ae.config.globalProperties.$filters=$e;ae.mount("#vue-app-release");
