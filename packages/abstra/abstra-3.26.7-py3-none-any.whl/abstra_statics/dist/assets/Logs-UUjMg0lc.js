import{a as ge,j as fe,c as ae,k as U,f as h,m as Re,e as ce,n as M,p as Le,r as E,s as Pe,O as Me,af as Ce,J as ze,a0 as je,a1 as $e,b as W,bm as _e,u as e,F as de,w as s,h as n,b4 as pe,g as ue,t as Y,T as Ne,ag as Oe,q as We,ak as Ue,i as f,ba as xe,b5 as q,b3 as Fe,b6 as le,R as Be,$ as Ze,bh as He,bi as Ve,bj as ke,K as Xe,c4 as qe,bq as Ge,c0 as se,bp as ne,aK as Ye}from"./jwt-decode.esm-Dw_OlTCW.js";import{R as De,u as Ke,L as Je,E as Qe}from"./ExecutionContext-CAwA0rAz.js";import{c as ve,d as G,e as et,f as tt}from"./router-DzczyMew.js";import{a as at,b as nt}from"./build-DHVrj-yw.js";import"./tables-CkY-LQhC.js";import{_ as he}from"./AbstraButton.vue_vue_type_script_setup_true_lang-60wd7w0p.js";import{G as Ie}from"./PhBroom.vue-CDU1y1Fu.js";import{I as ot}from"./PhCopy.vue-CYMhBES8.js";import{G as lt}from"./PhDotsThreeVertical.vue-zeuZOamM.js";import{I as st}from"./PhStop.vue-CxrT_vyV.js";import{S as Ae}from"./index-BNW_czQY.js";import{T as it,A as me}from"./index-FhuFwKwr.js";import{L as Te}from"./LoadingOutlined-Du0iiSbv.js";import{R as Se}from"./dayjs-DQa5ivan.js";import"./string-BuQ9zSDy.js";import"./polling-C2YNfl7D.js";import"./ant-design-Cvwf7JMR.js";import"./PhRobot.vue-Cw9THnjN.js";import"./ts.worker-5sEEipil.js";import"./record-BTRCUCPd.js";(function(){try{var k=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},d=new Error().stack;d&&(k._sentryDebugIds=k._sentryDebugIds||{},k._sentryDebugIds[d]="fca96fa5-710b-4f07-83c9-3aae74f924fa",k._sentryDebugIdIdentifier="sentry-dbid-fca96fa5-710b-4f07-83c9-3aae74f924fa")}catch{}})();const rt=["width","height","fill","transform"],ut={key:0},dt=M("path",{d:"M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"},null,-1),ct=[dt],ft={key:1},pt=M("path",{d:"M218.34,119.6,183.6,154.34a46.58,46.58,0,0,1-44.31,12.26c-.31.34-.62.67-.95,1L103.6,202.34A46.63,46.63,0,1,1,37.66,136.4L72.4,101.66A46.6,46.6,0,0,1,116.71,89.4c.31-.34.62-.67,1-1L152.4,53.66a46.63,46.63,0,0,1,65.94,65.94Z",opacity:"0.2"},null,-1),gt=M("path",{d:"M240,88.23a54.43,54.43,0,0,1-16,37L189.25,160a54.27,54.27,0,0,1-38.63,16h-.05A54.63,54.63,0,0,1,96,119.84a8,8,0,0,1,16,.45A38.62,38.62,0,0,0,150.58,160h0a38.39,38.39,0,0,0,27.31-11.31l34.75-34.75a38.63,38.63,0,0,0-54.63-54.63l-11,11A8,8,0,0,1,135.7,59l11-11A54.65,54.65,0,0,1,224,48,54.86,54.86,0,0,1,240,88.23ZM109,185.66l-11,11A38.41,38.41,0,0,1,70.6,208h0a38.63,38.63,0,0,1-27.29-65.94L78,107.31A38.63,38.63,0,0,1,144,135.71a8,8,0,0,0,7.78,8.22H152a8,8,0,0,0,8-7.78A54.86,54.86,0,0,0,144,96a54.65,54.65,0,0,0-77.27,0L32,130.75A54.62,54.62,0,0,0,70.56,224h0a54.28,54.28,0,0,0,38.64-16l11-11A8,8,0,0,0,109,185.66Z"},null,-1),vt=[pt,gt],ht={key:2},mt=M("path",{d:"M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM115.7,192.49a43.31,43.31,0,0,1-55-66.43l25.37-25.37a43.35,43.35,0,0,1,61.25,0,42.9,42.9,0,0,1,9.95,15.43,8,8,0,1,1-15,5.6A27.33,27.33,0,0,0,97.37,112L72,137.37a27.32,27.32,0,0,0,34.68,41.91,8,8,0,1,1,9,13.21Zm79.61-62.55-25.37,25.37A43,43,0,0,1,139.32,168h0a43.35,43.35,0,0,1-40.53-28.12,8,8,0,1,1,15-5.6A27.35,27.35,0,0,0,139.28,152h0a27.14,27.14,0,0,0,19.32-8L184,118.63a27.32,27.32,0,0,0-34.68-41.91,8,8,0,1,1-9-13.21,43.32,43.32,0,0,1,55,66.43Z"},null,-1),_t=[mt],yt={key:3},wt=M("path",{d:"M238,88.18a52.42,52.42,0,0,1-15.4,35.66l-34.75,34.75A52.28,52.28,0,0,1,150.62,174h-.05A52.63,52.63,0,0,1,98,119.9a6,6,0,0,1,6-5.84h.17a6,6,0,0,1,5.83,6.16A40.62,40.62,0,0,0,150.58,162h0a40.4,40.4,0,0,0,28.73-11.9l34.75-34.74A40.63,40.63,0,0,0,156.63,57.9l-11,11a6,6,0,0,1-8.49-8.49l11-11a52.62,52.62,0,0,1,74.43,0A52.83,52.83,0,0,1,238,88.18Zm-127.62,98.9-11,11A40.36,40.36,0,0,1,70.6,210h0a40.63,40.63,0,0,1-28.7-69.36L76.62,105.9A40.63,40.63,0,0,1,146,135.77a6,6,0,0,0,5.83,6.16H152a6,6,0,0,0,6-5.84A52.63,52.63,0,0,0,68.14,97.42L33.38,132.16A52.63,52.63,0,0,0,70.56,222h0a52.26,52.26,0,0,0,37.22-15.42l11-11a6,6,0,1,0-8.49-8.48Z"},null,-1),bt=[wt],xt={key:4},kt=M("path",{d:"M240,88.23a54.43,54.43,0,0,1-16,37L189.25,160a54.27,54.27,0,0,1-38.63,16h-.05A54.63,54.63,0,0,1,96,119.84a8,8,0,0,1,16,.45A38.62,38.62,0,0,0,150.58,160h0a38.39,38.39,0,0,0,27.31-11.31l34.75-34.75a38.63,38.63,0,0,0-54.63-54.63l-11,11A8,8,0,0,1,135.7,59l11-11A54.65,54.65,0,0,1,224,48,54.86,54.86,0,0,1,240,88.23ZM109,185.66l-11,11A38.41,38.41,0,0,1,70.6,208h0a38.63,38.63,0,0,1-27.29-65.94L78,107.31A38.63,38.63,0,0,1,144,135.71a8,8,0,0,0,16,.45A54.86,54.86,0,0,0,144,96a54.65,54.65,0,0,0-77.27,0L32,130.75A54.62,54.62,0,0,0,70.56,224h0a54.28,54.28,0,0,0,38.64-16l11-11A8,8,0,0,0,109,185.66Z"},null,-1),It=[kt],At={key:5},Tt=M("path",{d:"M236,88.12a50.44,50.44,0,0,1-14.81,34.31l-34.75,34.74A50.33,50.33,0,0,1,150.62,172h-.05A50.63,50.63,0,0,1,100,120a4,4,0,0,1,4-3.89h.11a4,4,0,0,1,3.89,4.11A42.64,42.64,0,0,0,150.58,164h0a42.32,42.32,0,0,0,30.14-12.49l34.75-34.74a42.63,42.63,0,1,0-60.29-60.28l-11,11a4,4,0,0,1-5.66-5.65l11-11A50.64,50.64,0,0,1,236,88.12ZM111.78,188.49l-11,11A42.33,42.33,0,0,1,70.6,212h0a42.63,42.63,0,0,1-30.11-72.77l34.75-34.74A42.63,42.63,0,0,1,148,135.82a4,4,0,0,0,8,.23A50.64,50.64,0,0,0,69.55,98.83L34.8,133.57A50.63,50.63,0,0,0,70.56,220h0a50.33,50.33,0,0,0,35.81-14.83l11-11a4,4,0,1,0-5.65-5.66Z"},null,-1),St=[Tt],Et={name:"PhLink"},Mt=ge({...Et,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(k){const d=k,I=fe("weight","regular"),C=fe("size","1em"),T=fe("color","currentColor"),z=fe("mirrored",!1),_=ae(()=>d.weight??I),D=ae(()=>d.size??C),y=ae(()=>d.color??T),b=ae(()=>d.mirrored!==void 0?d.mirrored?"scale(-1, 1)":void 0:z?"scale(-1, 1)":void 0);return(K,w)=>(h(),U("svg",Le({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:D.value,height:D.value,fill:y.value,transform:b.value},K.$attrs),[Re(K.$slots,"default"),_.value==="bold"?(h(),U("g",ut,ct)):_.value==="duotone"?(h(),U("g",ft,vt)):_.value==="fill"?(h(),U("g",ht,_t)):_.value==="light"?(h(),U("g",yt,bt)):_.value==="regular"?(h(),U("g",xt,It)):_.value==="thin"?(h(),U("g",At,St)):ce("",!0)],16,rt))}}),Ct={0:"pending",1:"running",2:"finished",3:"failed"};function Ee(k){return new Worker("/assets/timeline.worker-CTtnDIl5.js",{type:"module",name:k?.name})}function Dt(){const k=E(!0),d=E(!1),I=E(null),C=E([]),T=E([]),z=Pe([]),_=new Map,D=E(Date.now()),y=E(Date.now()),b=E(Date.now()-6e4),K=E(null);let w=null,J=null;const R=new De,L=200,F=ae(()=>{const l=(y.value-b.value)/6e4;return l<10?1:l<60?5:l<720?30:l<1440?60:l<1440*7?360:1440}),Q=ae(()=>{const m=F.value*6e4,A=Math.floor(b.value/m)*m,j=Math.ceil(y.value/m)*m,S=[];for(let $=A;$<=j;$+=m)S.push(new Date($));return S});function P(l){return _.get(l)}function o(l,m){w||(w=new Ee,B()),w.postMessage({type:"initCanvas",payload:{canvas:l,pixelRatio:m}},[l])}function B(){w&&(w.onmessage=l=>{const{buffers:m}=l.data;m&&(z.value=m)})}function Z(l,m,A=!1){if(!w)return;const j=l.map(S=>{const $=S.context,u=$?.sentTasks?[...$.sentTasks]:[];return{id:S.id,stageId:S.stageId,createdAt:S.createdAt.getTime(),updatedAt:S.updatedAt.getTime(),sentTasks:u,triggerTaskId:$?.taskId||void 0,status:S.status,shortId:S.shortId,context:S.context}});w.postMessage({type:"data",payload:{executions:j,tasks:m,reset:A}})}function oe(){w&&w.postMessage({type:"stagesList",payload:JSON.parse(JSON.stringify(T.value))})}function ee(l){w&&w.postMessage({type:"view",payload:l})}function V(){w&&w.postMessage({type:"view",payload:{now:D.value,viewStart:b.value,viewEnd:y.value,spacerWidth:L,rootId:K.value}})}async function i(l,m){const A=new Set,j=[m];let S=0;const $=1e3;d.value=!0;const u=new Set;try{for(;j.length>0&&S<$;){const r=j.shift();if(A.has(r))continue;A.add(r),S++;let g=_.get(r);if(g||(g=await R.get(l,r),_.set(g.id,g)),!u.has(g.stageId)){u.add(g.stageId);const c=C.value.filter(H=>u.has(H.id));c.length!==T.value.length&&(T.value=c,oe())}const p=await R.getExecutionTasks(l,r),x={};if(p.sentTasks.forEach(c=>{x[c.id]={start:new Date(c.created.at).getTime(),end:c.completed?new Date(c.completed.at).getTime():void 0}}),p.triggerTask){const c=p.triggerTask;x[c.id]={start:new Date(c.created.at).getTime(),end:c.completed?new Date(c.completed.at).getTime():void 0}}if(Z([g],x,!1),r===m){const c=g.createdAt.getTime(),H=g.updatedAt.getTime(),v=Math.max(1e3,H-c);b.value=c-v,y.value=H+v,k.value=!1}p.triggerTask&&p.triggerTask.created.byExecutionId&&(A.has(p.triggerTask.created.byExecutionId)||j.push(p.triggerTask.created.byExecutionId)),p.sentTasks.forEach(c=>{c.completed&&c.completed.byExecutionId&&(A.has(c.completed.byExecutionId)||j.push(c.completed.byExecutionId))})}}catch(r){console.error("Error loading thread",r),I.value="Failed to load execution thread."}finally{d.value=!1,k.value=!1}}async function t(l,m){if(k.value=!0,I.value=null,T.value=[],C.value=[],z.value=[],D.value=Date.now(),_.clear(),!m){I.value="No execution ID provided.",k.value=!1;return}K.value=m,w||(w=new Ee,B()),J||(J=setInterval(()=>{D.value=Date.now()},6e4));try{const A=await R.get(l,m);if(_.set(A.id,A),A.buildId){const j=await at.get(A.buildId);j&&(C.value=j.runtimesSorted)}Z([],{},!0),await i(l,m)}catch(A){I.value="Failed to load data.",console.error(A),k.value=!1}}function a(){w&&(w.terminate(),w=null),J&&(clearInterval(J),J=null)}return Me([T,D,b,y],()=>{V()}),{initialLoading:k,loadingGraph:d,error:I,stages:T,stageBuffers:z,viewStart:b,viewEnd:y,now:D,timelineInterval:F,moments:Q,init:t,cleanup:a,postDataToWorker:Z,initCanvas:o,updateView:ee,getExecution:P}}const Rt={style:{height:"100%","min-height":"400px",position:"relative",overflow:"hidden"}},Lt={key:2,style:{position:"absolute",top:"10px",right:"220px","z-index":"10","pointer-events":"none"}},O=200,ie=32,re=40,Pt=ge({__name:"TimelineComponent",props:{projectId:{},execution:{}},setup(k){const d=k,I=Ce(),{initialLoading:C,loadingGraph:T,error:z,stages:_,stageBuffers:D,viewStart:y,viewEnd:b,init:K,cleanup:w,initCanvas:J,updateView:R}=Dt(),L=E(null),F=E(null),Q=E(0),P=E(null),o=E(!1),B=E(0),Z=E(0),oe=ae(()=>{const u=F.value;if(!u)return 0;const r=u.height/window.devicePixelRatio-ie;return Math.max(0,_.value.length*re-r)});function ee(u){if(!L.value)return 0;const r=L.value.clientWidth-O,g=b.value-y.value,p=u-O;return y.value+p/r*g}function V(u){if(!L.value)return 0;const r=L.value.clientWidth-O,g=b.value-y.value,p=u-y.value;return O+p/g*r}function i(u){if(!F.value)return{x:0,y:0};const r=F.value.getBoundingClientRect();return{x:u.clientX-r.left,y:u.clientY-r.top}}function t(u,r){const g=r-ie;if(u>O){const p=ee(u),x=g+Q.value;if(x>=0){const c=Math.floor(x/re);if(c>=0&&c<_.value.length){const H=_.value[c],v=D.value.find(X=>X.stageId===H.id);if(v){const X=v.count;for(let N=0;N<X;N++){const ye=v.starts[N],we=v.ends[N];if(p>=ye&&p<=we){const be=c*re+(re-24)/2;if(x>=be&&x<=be+24)return{type:"execution",data:{id:v.ids[N],status:Ct[v.statuses[N]]||"unknown",start:ye,end:we}}}}}}}}return null}const a=u=>{const{x:r,y:g}=i(u),p=g-ie+Q.value,x=Math.floor(p/re);if(x>=0&&x<_.value.length&&g>ie){const v=_.value[x];P.value!==v.id&&(P.value=v.id,R({hoveredStageId:v.id}))}else P.value!==null&&(P.value=null,R({hoveredStageId:null}));if(o.value){Z.value=ee(r);const v=V(B.value)-O,X=V(Z.value)-O;R({selection:{active:!0,start:v,end:X}})}let c={visible:!1,x:0,label:""},H={visible:!1,x:0,y:0,title:"",items:[]};if(r>O){const v=ee(r),X=new Date(v);if(!isNaN(X.getTime())){const N=X.toLocaleString([],{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3});c={visible:!0,x:r-O,label:N}}}if(r>O&&g>ie){const v=t(r,g);if(v){document.body.style.cursor="pointer";const N=((v.data.end-v.data.start)/1e3).toFixed(3)+" s";H={visible:!0,x:r,y:g,title:v.type==="execution"?"Execution":"Task",items:[`Status: ${v.data.status}`,`ID: ${v.data.id}`,`Duration: ${N}`]}}else document.body.style.cursor="default"}else document.body.style.cursor="default";R({cursor:c,tooltip:H})},l=()=>{R({cursor:{visible:!1,x:0},tooltip:{visible:!1,x:0,y:0},hoveredStageId:null}),P.value=null,document.body.style.cursor="default"},m=u=>{const{x:r,y:g}=i(u);if(r<=O)return;const p=t(r,g);p&&p.type==="execution"||(o.value=!0,B.value=ee(r),Z.value=B.value)},A=u=>{const{x:r,y:g}=i(u);if(o.value){const p=Math.min(B.value,Z.value),x=Math.max(B.value,Z.value);x-p>100&&(y.value=p,b.value=x),o.value=!1,R({selection:{active:!1,start:0,end:0}})}else{const p=t(r,g);if(p&&p.type==="execution"){const x=I.resolve({name:"logs",params:{projectId:d.projectId},query:{executionId:p.data.id}});window.open(x.href,"_blank")}}},j=u=>{if(!L.value)return;const r=L.value.clientWidth-O,g=b.value-y.value;if(u.ctrlKey){const x=Math.exp(-u.deltaY*.005),c=g/x;if(c<100||c>1e3*60*60*24*365*10)return;const H=F.value.getBoundingClientRect(),v=u.clientX-H.left-O,N=y.value+v/r*g-v/r*c;y.value=N,b.value=N+c}else{const p=r/(g/6e4),x=u.deltaX/p*6e4;y.value+=x,b.value+=x,Q.value=Math.max(0,Math.min(oe.value,Q.value+u.deltaY)),R({scrollTop:Q.value})}},S=u=>{u.key==="Escape"&&o.value&&(o.value=!1,R({selection:{active:!1,start:0,end:0}}))},$=()=>{L.value&&R({viewportWidth:L.value.clientWidth,viewportHeight:L.value.clientHeight})};return ze(async()=>{if(window.addEventListener("resize",$),window.addEventListener("keydown",S),F.value){const u=F.value.transferControlToOffscreen();J(u,window.devicePixelRatio)}await je(),$(),await K(d.projectId,d.execution.id)}),$e(()=>{w(),window.removeEventListener("resize",$),window.removeEventListener("keydown",S)}),(u,r)=>(h(),U("div",Rt,[M("div",{ref_key:"canvasContainerRef",ref:L,style:{width:"100%",height:"100%",position:"relative",overflow:"hidden"}},[M("canvas",{ref_key:"canvasRef",ref:F,style:{display:"block",width:"100%",height:"100%"},onMousemove:a,onMouseleave:l,onMousedown:m,onMouseup:A,onWheel:_e(j,["prevent"])},null,544)],512),e(C)?(h(),W(e(de),{key:0,style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%","z-index":"20",background:"#fff"},justify:"center",align:"center"},{default:s(()=>[n(e(pe),{size:"large"})]),_:1})):e(z)?(h(),W(e(de),{key:1,style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%","z-index":"20",background:"#fff"},justify:"center",align:"center"},{default:s(()=>[n(e(Ne),{type:"danger"},{default:s(()=>[ue(Y(e(z)),1)]),_:1})]),_:1})):ce("",!0),e(T)&&!e(C)?(h(),U("div",Lt,[n(e(pe))])):ce("",!0)]))}});class te{constructor(d,I,C,T){this.major=d,this.minor=I,this.patch=C,this.dev=T}static from(d){if(d===null)return new te(0,0,0);const I=/^(\d+\.\d+\.\d+)(.dev(\d+))?$/,C=d.match(I);if(!C)return new te(0,0,0);const[,T,,z]=C,[_,D,y]=T.split(".").map(Number),b=z?Number(z):void 0;return isNaN(_)||isNaN(D)||isNaN(y)?new te(0,0,0):b&&isNaN(b)?new te(0,0,0):new te(_,D,y,b)}gte(d){return this.major!==d.major?this.major>=d.major:this.minor!==d.minor?this.minor>=d.minor:this.patch>=d.patch}get version(){const d=this.dev?`.dev${this.dev}`:"";return`${this.major}.${this.minor}.${this.patch}${d}`}}const zt={class:"execution-header"},jt={class:"execution-header-left"},$t={key:0,class:"status-spinner"},Nt={class:"execution-info"},Ot={class:"execution-stage"},Wt={class:"execution-meta"},Ut={class:"execution-time"},Ft={key:0,style:{display:"flex",width:"100%","justify-content":"center"}},Bt=ge({__name:"Logs",props:{executionRepository:{},buildRepository:{},showAllFilters:{type:Boolean}},setup(k){const d=k,I=Oe(),C=Ce(),T=I.params.projectId,z=I.query.executionId;function _(){const{stageId:i,buildId:t,status:a,startDate:l,endDate:m,executionId:A}=I.query;return l&&m?{stageId:i,buildId:t,status:a,dateRange:[se(l),se(m)]}:{stageId:i,buildId:t,status:a,search:A}}function D(i){const t={};ee(),Object.entries(i).forEach(([a,l])=>{typeof l=="string"&&a==="search"&&l?t.executionId=l:typeof l=="string"&&l?t[a]=l:a==="dateRange"&&Array.isArray(l)&&se.isDayjs(l[0])&&se.isDayjs(l[1])&&(t.startDate=l[0].toISOString().slice(0,10),t.endDate=l[1].toISOString().slice(0,10))}),C.replace({query:t})}function y(){const{page:i,pageSize:t}=I.query;return{currentIndex:i?parseInt(i,10):1,pageSize:t?parseInt(t,10):10}}function b(){o.filters.dateRange=void 0,o.filters.buildId=void 0,o.filters.stageId=void 0,o.filters.status=void 0,o.filters.search=void 0}function K(i){i=i.slice(0,6);const t=`${window.location.origin}${window.location.pathname}?executionId=${i}`;navigator.clipboard.writeText(t),ne.success({content:f.translate("i18n_logs_copied_to_clipboard")})}function w(i){const t=o.currentPage.executionData[i];if(!t?.logs?.entries)return;const a=t.logs.entries.map(l=>l.payload.text?.trim()).filter(l=>l!=null).join(`
`);navigator.clipboard.writeText(a),a?ne.success({content:f.translate("i18n_logs_copied_to_clipboard")}):ne.info({content:f.translate("i18n_logs_empty_logs")})}function J(i,t){let a={...i};return a.sentTasks=t.sentTasks,delete a.mockExecution,t.triggerTask&&(a.triggerTask=t.triggerTask,delete a.taskId),a}function R(i){return new Intl.DateTimeFormat(navigator.language,{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date(i))}async function L(i){try{await P.stopExecution(i),ne.success({content:f.translate("i18n_logs_execution_stopped")})}catch{ne.error({content:f.translate("i18n_logs_execution_stop_error")})}}const F=te.from("3.26.3");function Q(i){const t=o.filterOptions.builds.find(l=>l.value===i);return!t||!t.abstraVersion?!1:te.from(t.abstraVersion).gte(F)}const P=Ke();P.init({executionRepository:d.executionRepository,buildRepository:d.buildRepository,projectId:T,filters:_(),pagination:y(),pool:!0,openedExecutionId:z,onFilterChange:D});const{state:o}=P,B=E(!1);Me(()=>o.filterOptions.stages,i=>{B.value=i.length>0},{immediate:!0});function Z(i){const t=o.filterOptions.stages.find(a=>a.value===i);return t?t.label:B.value?f.translate("i18n_logs_deleted_stage"):f.translate("i18n_logs_stage_loading")}function oe(i,t){P.fetchExecutionLogsPage(i,t)}We(()=>P.teardown());function ee(){const i=o.filters.dateRange,t=se();!i||!i[1]?o.filters.dateRange=[t.subtract(90,"day"),t]:i[1].diff(i[0],"day")>90&&(o.filters.dateRange=[i[1].subtract(90,"day"),i[1]],ne.warning({content:f.translate("i18n_logs_date_range_limit_warning",null,90)}))}D(o.filters);function V(i,t){return t&&"label"in t&&typeof t.label=="string"?t.label.toLowerCase().includes(i.toLowerCase()):!0}return(i,t)=>(h(),W(e(Ae),{direction:"vertical",style:{width:"100%",padding:"0px 0px 20px 0px"}},{default:s(()=>[n(e(Ue),null,{default:s(()=>[ue(Y(e(f).translate("i18n_logs_title")),1)]),_:1}),k.showAllFilters?(h(),W(e(xe),{key:0,layout:"vertical"},{default:s(()=>[n(e(ve),{gutter:10},{default:s(()=>[n(e(G),{span:12},{default:s(()=>[n(e(q),{label:e(f).translate("i18n_logs_execution_id_label")},{default:s(()=>[n(e(Fe),{value:e(o).filters.search,"onUpdate:value":t[0]||(t[0]=a=>e(o).filters.search=a),placeholder:e(f).translate("i18n_logs_search_by_execution_id_placeholder"),style:{width:"100%"},"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),n(e(G),{span:12},{default:s(()=>[n(e(q),{label:e(f).translate("i18n_logs_stage_label")},{default:s(()=>[n(e(le),{value:e(o).filters.stageId,"onUpdate:value":t[1]||(t[1]=a=>e(o).filters.stageId=a),options:e(o).filterOptions.stages,placeholder:e(f).translate("i18n_logs_all_placeholder"),"allow-clear":"","show-search":"","filter-option":V},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),n(e(ve),{gutter:10,align:"bottom"},{default:s(()=>[n(e(G),{span:8},{default:s(()=>[n(e(q),{label:e(f).translate("i18n_logs_date_label")},{default:s(()=>[n(e(Se),{value:e(o).filters.dateRange,"onUpdate:value":t[2]||(t[2]=a=>e(o).filters.dateRange=a),style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1}),n(e(G),{span:9},{default:s(()=>[n(e(q),{label:e(f).translate("i18n_logs_version_label")},{default:s(()=>[n(e(le),{value:e(o).filters.buildId,"onUpdate:value":t[3]||(t[3]=a=>e(o).filters.buildId=a),options:e(o).filterOptions.builds,"option-label":"label","option-value":"value",filter:!1,placeholder:e(f).translate("i18n_logs_all_placeholder"),"allow-clear":"","show-search":"","filter-option":V},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),n(e(G),{span:6},{default:s(()=>[n(e(q),{label:e(f).translate("i18n_logs_status_label")},{default:s(()=>[n(e(le),{value:e(o).filters.status,"onUpdate:value":t[4]||(t[4]=a=>e(o).filters.status=a),options:e(o).filterOptions.statuses,"option-label":"label","option-value":"value",filter:!1,placeholder:e(f).translate("i18n_logs_all_placeholder"),"allow-clear":"","show-search":"","filter-option":V},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),n(e(G),{span:1},{default:s(()=>[n(e(q),null,{default:s(()=>[n(he,{type:"text",size:"middle",tooltip:e(f).translate("i18n_logs_clear_filters_tooltip"),onClick:b},{default:s(()=>[n(e(Ie))]),_:1},8,["tooltip"])]),_:1})]),_:1})]),_:1})]),_:1})):(h(),W(e(xe),{key:1,layout:"vertical"},{default:s(()=>[n(e(ve),{gutter:10,align:"bottom"},{default:s(()=>[n(e(G),{span:8},{default:s(()=>[n(e(q),{label:e(f).translate("i18n_logs_date_label")},{default:s(()=>[n(e(Se),{value:e(o).filters.dateRange,"onUpdate:value":t[5]||(t[5]=a=>e(o).filters.dateRange=a),style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1}),n(e(G),{span:10},{default:s(()=>[n(e(q),{label:e(f).translate("i18n_logs_script_label")},{default:s(()=>[n(e(le),{value:e(o).filters.stageId,"onUpdate:value":t[6]||(t[6]=a=>e(o).filters.stageId=a),options:e(o).filterOptions.stages,placeholder:e(f).translate("i18n_logs_all_placeholder"),"allow-clear":"","show-search":"","filter-option":V},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),n(e(G),{span:5},{default:s(()=>[n(e(q),{label:e(f).translate("i18n_logs_status_label")},{default:s(()=>[n(e(le),{value:e(o).filters.status,"onUpdate:value":t[7]||(t[7]=a=>e(o).filters.status=a),options:e(o).filterOptions.statuses,"option-label":"label","option-value":"value",filter:!1,placeholder:e(f).translate("i18n_logs_all_placeholder"),"allow-clear":"","show-search":"","filter-option":V},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),n(e(G),{span:1},{default:s(()=>[n(e(q),null,{default:s(()=>[n(he,{type:"text",size:"middle",tooltip:e(f).translate("i18n_logs_clear_filters_tooltip"),onClick:b},{default:s(()=>[n(e(Ie))]),_:1},8,["tooltip"])]),_:1})]),_:1})]),_:1})]),_:1})),e(o).currentPage.loadingExecutions||e(o).currentPage.waitingDebounce?(h(),W(e(pe),{key:2,style:{width:"100%"}})):e(o).currentPage.executions&&e(o).currentPage.executions.length>0?(h(),W(e(Ae),{key:3,direction:"vertical",style:{width:"100%"}},{default:s(()=>[n(e(et),{"active-key":e(o).currentPage.openedExecutionIds,"onUpdate:activeKey":t[9]||(t[9]=a=>e(o).currentPage.openedExecutionIds=a),bordered:!1,style:{"background-color":"transparent"},onChange:e(P).fetchEmptyLogs},{default:s(()=>[(h(!0),U(Be,null,Ze(e(o).currentPage.executions,a=>(h(),W(e(tt),{key:a.id,class:"execution-card"},{header:s(()=>[M("div",zt,[M("div",jt,[a.status==="running"?(h(),U("div",$t,[n(e(Te),{spin:""})])):(h(),U("div",{key:1,class:Xe(["status-dot",a.status])},null,2)),M("div",Nt,[M("span",Ot,[B.value?ce("",!0):(h(),W(e(Te),{key:0,spin:"",style:{"margin-right":"6px"}})),ue(" "+Y(Z(a.stageId)),1)]),M("span",Wt,Y(e(f).translate("i18n_logs_execution_id_label"))+": "+Y(a.id.slice(0,8))+" Â· "+Y(e(f).translate("i18n_logs_version_label"))+": "+Y(a.buildId.slice(0,8)),1)])]),M("span",Ut,Y(R(a.createdAt)),1)])]),extra:s(()=>[n(e(He),{trigger:["click"],placement:"bottomRight"},{overlay:s(()=>[n(e(Ve),null,{default:s(()=>[n(e(ke),{key:"copy",onClick:l=>K(a.id)},{default:s(()=>[n(e(de),{align:"center",gap:8},{default:s(()=>[n(e(Mt),{size:16}),ue(" "+Y(e(f).translate("i18n_logs_copy_url_tooltip")),1)]),_:1})]),_:1},8,["onClick"]),a.status==="running"&&Q(a.buildId)?(h(),W(e(ke),{key:"stop",danger:"",onClick:l=>L(a.id)},{default:s(()=>[n(e(de),{align:"center",gap:8},{default:s(()=>[n(e(st),{size:16}),ue(" "+Y(e(f).translate("i18n_logs_stop_execution")),1)]),_:1})]),_:1},8,["onClick"])):ce("",!0)]),_:2},1024)]),default:s(()=>[M("div",{class:"execution-actions-trigger",onClick:t[8]||(t[8]=_e(()=>{},["stop"]))},[n(e(lt),{size:18})])]),_:2},1024)]),default:s(()=>[e(o).currentPage.executionData[a.id]?(h(),W(e(it),{key:1},{default:s(()=>[n(e(me),{key:"logs"},{tab:s(()=>[n(e(de),{align:"center",gap:4},{default:s(()=>[t[12]||(t[12]=M("span",null,"Logs",-1)),n(he,{type:"text",size:"small",class:"copy-logs-btn",tooltip:e(f).translate("i18n_logs_copy_logs_tooltip"),onClick:_e(l=>w(a.id),["stop"])},{default:s(()=>[n(e(ot),{size:14})]),_:1},8,["tooltip","onClick"])]),_:2},1024)]),default:s(()=>[n(Je,{logs:e(o).currentPage.executionData[a.id].logs,pagination:e(o).currentPage.executionData[a.id].logsPagination,onPageChange:l=>oe(a.id,l)},null,8,["logs","pagination","onPageChange"])]),_:2},1024),n(e(me),{key:"context",tab:e(f).translate("i18n_executioncontext_header")},{default:s(()=>[n(Qe,{data:J(a.context,e(o).currentPage.executionData[a.id].tasks),"show-fix-with-ai":!1},null,8,["data"])]),_:2},1032,["tab"]),n(e(me),{key:"timeline",tab:"Timeline"},{default:s(()=>[n(Pt,{"project-id":e(T),execution:a},null,8,["project-id","execution"])]),_:2},1024)]),_:2},1024)):(h(),U("div",Ft,[n(e(pe))]))]),_:2},1024))),128))]),_:1},8,["active-key","onChange"]),n(e(qe),{current:e(o).pagination.currentIndex,"onUpdate:current":t[10]||(t[10]=a=>e(o).pagination.currentIndex=a),"page-size":e(o).pagination.pageSize,"onUpdate:pageSize":t[11]||(t[11]=a=>e(o).pagination.pageSize=a),total:e(o).pagination.totalCount,"show-total":a=>e(f).translate("i18n_logs_found_runs",null,a),"show-size-changer":""},null,8,["current","page-size","total","show-total"])]),_:1})):(h(),W(e(Ge),{key:4}))]),_:1}))}}),Zt=Ye(Bt,[["__scopeId","data-v-18486685"]]),ca=ge({__name:"Logs",setup(k){const d=new De,I=new nt;return(C,T)=>(h(),W(Zt,{"execution-repository":e(d),"build-repository":e(I),"show-all-filters":""},null,8,["execution-repository","build-repository"]))}});export{ca as default};
//# sourceMappingURL=Logs-UUjMg0lc.js.map
