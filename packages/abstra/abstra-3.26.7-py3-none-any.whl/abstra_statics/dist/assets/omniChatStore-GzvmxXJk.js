import{b as k}from"./router-DzczyMew.js";import{a as X,j as B,c as F,k as x,f as b,m as te,e as se,n as A,p as oe,W as re,r as g,i as N,b as j,w as Z,u as P,g as ie,t as ae,A as ne,aK as le,h as ce,d2 as de,aJ as he,d as pe,s as W}from"./jwt-decode.esm-Dw_OlTCW.js";import{a as ue,P as ge}from"./record-BTRCUCPd.js";import{a as fe,b as me,c as ye,d as ve,e as _e,f as we,g as be,h as Se,i as Ce}from"./contracts.generated-BY4ff4DP.js";import{D as Te,a as Ae,b as xe,c as z,m as G}from"./runnerData-DZ54UJZ3.js";import{i as Fe}from"./colorHelpers-Chvd75S3.js";import{u as T}from"./uuid-uY6ajUFo.js";import{I as Ee}from"./PhCopySimple.vue-BolmM9w7.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[e]="8ab1a0d5-5c41-47e0-8ac1-10080567e51f",i._sentryDebugIdIdentifier="sentry-dbid-8ab1a0d5-5c41-47e0-8ac1-10080567e51f")}catch{}})();const ke=["width","height","fill","transform"],Ne={key:0},Ie=A("path",{d:"M176.49,95.51a12,12,0,0,1,0,17l-56,56a12,12,0,0,1-17,0l-24-24a12,12,0,1,1,17-17L112,143l47.51-47.52A12,12,0,0,1,176.49,95.51ZM236,128A108,108,0,1,1,128,20,108.12,108.12,0,0,1,236,128Zm-24,0a84,84,0,1,0-84,84A84.09,84.09,0,0,0,212,128Z"},null,-1),Re=[Ie],Be={key:1},$e=A("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"},null,-1),Oe=A("path",{d:"M173.66,98.34a8,8,0,0,1,0,11.32l-56,56a8,8,0,0,1-11.32,0l-24-24a8,8,0,0,1,11.32-11.32L112,148.69l50.34-50.35A8,8,0,0,1,173.66,98.34ZM232,128A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"},null,-1),Me=[$e,Oe],Le={key:2},je=A("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm45.66,85.66-56,56a8,8,0,0,1-11.32,0l-24-24a8,8,0,0,1,11.32-11.32L112,148.69l50.34-50.35a8,8,0,0,1,11.32,11.32Z"},null,-1),Pe=[je],De={key:3},Ue=A("path",{d:"M172.24,99.76a6,6,0,0,1,0,8.48l-56,56a6,6,0,0,1-8.48,0l-24-24a6,6,0,0,1,8.48-8.48L112,151.51l51.76-51.75A6,6,0,0,1,172.24,99.76ZM230,128A102,102,0,1,1,128,26,102.12,102.12,0,0,1,230,128Zm-12,0a90,90,0,1,0-90,90A90.1,90.1,0,0,0,218,128Z"},null,-1),qe=[Ue],Je={key:4},He=A("path",{d:"M173.66,98.34a8,8,0,0,1,0,11.32l-56,56a8,8,0,0,1-11.32,0l-24-24a8,8,0,0,1,11.32-11.32L112,148.69l50.34-50.35A8,8,0,0,1,173.66,98.34ZM232,128A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"},null,-1),Ze=[He],We={key:5},ze=A("path",{d:"M170.83,101.17a4,4,0,0,1,0,5.66l-56,56a4,4,0,0,1-5.66,0l-24-24a4,4,0,0,1,5.66-5.66L112,154.34l53.17-53.17A4,4,0,0,1,170.83,101.17ZM228,128A100,100,0,1,1,128,28,100.11,100.11,0,0,1,228,128Zm-8,0a92,92,0,1,0-92,92A92.1,92.1,0,0,0,220,128Z"},null,-1),Ge=[ze],Ve={name:"PhCheckCircle"},Ke=X({...Ve,props:{weight:{type:String},size:{type:[String,Number]},color:{type:String},mirrored:{type:Boolean}},setup(i){const e=i,t=B("weight","regular"),s=B("size","1em"),o=B("color","currentColor"),r=B("mirrored",!1),a=F(()=>e.weight??t),l=F(()=>e.size??s),h=F(()=>e.color??o),d=F(()=>e.mirrored!==void 0?e.mirrored?"scale(-1, 1)":void 0:r?"scale(-1, 1)":void 0);return(p,f)=>(b(),x("svg",oe({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",width:l.value,height:l.value,fill:h.value,transform:d.value},p.$attrs),[te(p.$slots,"default"),a.value==="bold"?(b(),x("g",Ne,Re)):a.value==="duotone"?(b(),x("g",Be,Me)):a.value==="fill"?(b(),x("g",Le,Pe)):a.value==="light"?(b(),x("g",De,qe)):a.value==="regular"?(b(),x("g",Je,Ze)):a.value==="thin"?(b(),x("g",We,Ge)):se("",!0)],16,ke))}});class Y{async list(e){const t=new URLSearchParams;e&&t.append("path",e);const o=await(await fetch(`/_editor/api/codebase/files?${t.toString()}`)).json();return fe.parse(o)}async create(e,t,s){const o=new URLSearchParams;s&&o.append("overwrite","true");const r=o.toString(),a=r?`/_editor/api/codebase/files/${e}?${r}`:`/_editor/api/codebase/files/${e}`,l=await fetch(a,{method:"POST",body:t?new Uint8Array(t).buffer:void 0});if(!l.ok){const d=await l.text();throw new Error(`Failed to create file: ${d} (status: ${l.status})`)}const h=await l.json();return me.parse(h)}async delete(e){const t=await fetch(`/_editor/api/codebase/files/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!t.ok){const o=await t.text();throw new Error(`Failed to delete file: ${o} (status: ${t.status})`)}const s=await t.json();return ye.parse(s)}async edit(e,t){const o=await(await fetch(`/_editor/api/codebase/files/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:t})})).json();return ve.parse(o)}async retrieve(e){const s=await(await fetch(`/_editor/api/codebase/files/${e}`)).arrayBuffer();return new Uint8Array(s)}async rename(e,t){const s=_e.parse({pathParts:e,newPathParts:t}),o=await fetch("/_editor/api/codebase/files",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!o.ok){const a=await o.text();throw new Error(`Failed to rename file: ${a} (status: ${o.status})`)}const r=await o.json();return we.parse(r)}async mkdir(e){const t=await fetch(`/_editor/api/codebase/dir/${e}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok){const o=await t.text();throw new Error(`Failed to create directory: ${o} (status: ${t.status})`)}const s=await t.json();return be.parse(s)}async settings(){const t=await(await fetch("/_editor/api/codebase/settings")).json();return Se.parse(t)}async typeCheck(e){const s=await(await fetch(`/_editor/api/codebase/type-check/${e}`,{method:"POST"})).json();return Ce.parse(s)}}class Xe{async get(){return await(await fetch("/_editor/api/workspace",{method:"GET",headers:{"Content-Type":"application/json"}})).json()}async update(e,t){return await(await fetch("/_editor/api/workspace",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}async create(e){throw new Error("Not implemented")}async initFile(e,t){await fetch("/_editor/api/workspace/init-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e,type:t})})}async checkFile(e){const t=await fetch(`/_editor/api/workspace/check-file?path=${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to check file");return await t.json()}async checkFiles(e){const t=await fetch("/_editor/api/workspace/check-files",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paths:e})});if(!t.ok)throw new Error("Failed to check files");return await t.json()}async readFile(e){const t=await fetch(`/_editor/api/workspace/read-file?file=${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});return t.status===404?null:await t.text()}async readTestData(){return await(await fetch("/_editor/api/workspace/read-test-data",{method:"GET",headers:{"Content-Type":"application/json"}})).text()}async writeTestData(e){if(!(await fetch("/_editor/api/workspace/write-test-data",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({test_data:e})})).ok)throw new Error("Failed to write test data");return{success:!0}}async deploy(){const e=await fetch("/_editor/api/workspace/deploy",{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok){const s=(await e.json().catch(()=>({}))).message||"Failed to deploy";throw new Error(s)}}}const S=new Xe;class I{static instance;record;constructor(e){this.record=ue.create(S,e)}static async get(){const e=await S.get();return new I(e)}static from(e){return new I(e)}get brandName(){return this.record.get("brand_name")??""}set brandName(e){this.record.set("brand_name",e)}get fontColor(){return this.record.get("font_color")??"#000000"}set fontColor(e){this.record.set("font_color",e)}get logoUrl(){return this.record.get("logo_url")??""}set logoUrl(e){this.record.set("logo_url",e)}get faviconUrl(){return this.record.get("favicon_url")??""}set faviconUrl(e){this.record.set("favicon_url",e)}get mainColor(){return this.record.get("main_color")??Te}set mainColor(e){this.record.set("main_color",e)}get fontFamily(){return this.record.get("font_family")??Ae}set fontFamily(e){this.record.set("font_family",e)}get language(){return this.record.get("language")??xe.value}set language(e){this.record.set("language",e)}get theme(){return this.record.get("theme")??z}set theme(e){this.record.set("theme",e)}async save(){return this.record.save()}hasChanges(){return this.record.hasChanges()}static async initFile(e,t){await S.initFile(e,t)}static async checkFile(e){return S.checkFile(e)}static async checkFiles(e){return S.checkFiles(e)}async readFile(e){return S.readFile(e)}static async readTestData(){return S.readTestData()}static async writeTestData(e){return S.writeTestData(e)}static async deploy(){return S.deploy()}get sidebar(){return this.record.get("sidebar")??[]}set sidebar(e){this.record.set("sidebar",e)}makeRunnerData(){return{sidebar:this.sidebar,name:this.brandName,fontColor:this.fontColor,brandName:this.brandName,fontFamily:this.fontFamily,logoUrl:this.logoUrl?G("logo",this.logoUrl,"editor"):null,mainColor:this.mainColor,theme:Fe(this.theme)?this.theme:G("background",this.theme,"editor")??z,language:this.language}}}class D{logState=re({log:[]});_listeners={};static create(){return new D}get logs(){return this.logState.log}hasAiLogs(){return this.logs.some(e=>e.type==="ai-input"||e.type==="ai-output")}log(e,t){if(e.type!=="restart"&&e.type!=="ai-tool-approval"&&e.type!=="ai-tool-call-response"&&"log"in e&&e.log.trim()===""&&!(e.type==="ai-input"&&e.attachments&&e.attachments.length>0))return;const s=t?this.logs.find(o=>o.id===t):null;return s?(s.type==="stderr"&&e.type==="stderr"&&(e.log=s.log+`
`+e.log),Object.assign(s,e)):this.logs.push({...e,id:t||T()}),this.notifyListeners(e),t}clear(){this.logState.log=[]}listen(e){const t=T();return this._listeners[t]=e,t}unlisten(e){delete this._listeners[e]}notifyListeners(e){Object.values(this._listeners).forEach(t=>t(e))}getLastExecutionLogs=e=>{let t="";for(let s=this.logs.length-1;s>=0;s--){const o=this.logs[s];if(o.type!==e&&t.length>0)break;o.type===e&&(t=`${o.log}
${t}`)}return t}}class U{_badgeState;constructor(){this._badgeState=g({type:"seen"})}get badgeState(){return this._badgeState.value}isSeen(){return this._badgeState.value.type==="seen"}isUnseen(){return this._badgeState.value.type==="unseen"}getUnseenCount(){return this._badgeState.value.type==="unseen"?this._badgeState.value.count:0}getSeverity(){return this._badgeState.value.type==="unseen"?this._badgeState.value.severity:null}setSeen(){this._badgeState.value={type:"seen"}}setUnseen(e){const t=this._badgeState.value.type==="unseen"?this._badgeState.value.count:0,s=e.type==="stderr"?"error":"info";this._badgeState.value={type:"unseen",count:t+1,severity:s}}reset(){this.setSeen()}static create(){return new U}}class Q{constructor(e,t){this.flag=e,this.acc=t,this.staging=""}staging}class Ye extends Q{constructor(){super("___JSON_MODE___",[])}reduceChar(e){try{this.staging+=e;const t=JSON.parse(this.staging);return this.acc.push(t),this.staging="",t}catch{return}}reduce(e){const t=[];for(const s of e){const o=this.reduceChar(s);o!==void 0&&t.push(o)}return t}}class Qe extends Q{constructor(){super("___TEXT_MODE___","")}reduce(e){return this.staging+=e,this.acc=this.staging,e}}class O{mode;modes=[new Qe,new Ye];staging="";chunkOnBuffer="";flagMap;flagPrefixes;constructor(){this.mode=this.modes[0],this.flagMap=new Map,this.flagPrefixes=new Set;for(const e of this.modes){this.flagMap.set(e.flag,e);for(let t=1;t<e.flag.length;t++)this.flagPrefixes.add(e.flag.slice(0,t))}}*reduce(e){for(const t of e){if(this.staging+=t,this.flagMap.has(this.staging)){this.mode=this.flagMap.get(this.staging),this.staging="";continue}if(!this.flagPrefixes.has(this.staging))for(;this.staging.length>0;){const s=this.staging[0];this.staging=this.staging.slice(1);const o=this.mode.reduce(s);if(o!==void 0&&(Array.isArray(o)?yield*o:yield o),this.flagPrefixes.has(this.staging))break}}}*reduceInChunks(e,t){let s="";for(const o of this.reduce(t))if(typeof o=="string")for(s+=o;s.length>=e;)yield s.slice(0,e),s=s.slice(e);else s.length>0&&(yield s,s=""),yield o;s.length>0&&(yield s)}}const M=300;class et{_baseUrl="/_editor/api/ai";_headers={"Content-Type":"application/json"};async*sendMessage(e,t,s,o,r,a){const l={conversationId:e,content:t,context:s,toolCallsApproval:r,browserTools:a},h=await fetch(`${this._baseUrl}/stream`,{method:"POST",headers:this._headers,body:JSON.stringify(l)});if(!h.ok)throw new Error("Failed to send message");const d=h.body?.getReader();if(!d)throw new Error("No response body");const p=new O;for(;!o();){const f=await d.read();if(f.done)break;for(const v of p.reduceInChunks(M,new TextDecoder().decode(f.value)))yield v}}async*sendBrowserToolResponses(e,t,s,o){const r={conversationId:e,content:[],context:s,browserToolResponses:t,browserTools:o},a=await fetch(`${this._baseUrl}/stream`,{method:"POST",headers:this._headers,body:JSON.stringify(r)});if(!a.ok)throw new Error("Failed to send browser tool responses");const l=a.body?.getReader();if(!l)throw new Error("No response body");const h=new O;for(;;){const d=await l.read();if(d.done)break;for(const p of h.reduceInChunks(M,new TextDecoder().decode(d.value)))yield p}}async deleteThread(e){if(!(await fetch(`${this._baseUrl}/thread/${e}`,{method:"DELETE",headers:this._headers})).ok)throw new Error("Failed to delete thread")}async abortStreaming(e){if(!(await fetch(`${this._baseUrl}/abort`,{method:"POST",headers:this._headers,body:JSON.stringify({langGraphThreadId:e})})).ok)throw new Error("Failed to abort streaming")}async getHistory(e,t){const s=await fetch(`${this._baseUrl}/history?limit=${e}&offset=${t}`,{method:"GET"});if(!s.ok)throw new Error("Failed to fetch history");return await s.json()}startConversation(){return new Promise((e,t)=>{fetch(`${this._baseUrl}/start-conversation`,{method:"POST",headers:this._headers}).then(s=>{if(!s.ok)throw new Error("Failed to start conversation");return s.json()}).then(s=>e(s)).catch(s=>t(s))})}}class tt{projectId;baseUrl;constructor(e){this.projectId=e,this.baseUrl=`projects/${e}`}startConversation(){throw new Error("Method not implemented.")}async*sendMessage(e,t,s,o,r,a){const l={conversationId:e,content:t,context:s,toolCallsApproval:r,browserTools:a},d=(await k.postRaw(`${this.baseUrl}/messages`,l)).body?.getReader();if(!d)throw new Error("No response body");const p=new O;for(;!o();){const f=await d.read();if(f.done)break;for(const v of p.reduceInChunks(M,new TextDecoder().decode(f.value)))yield v}}async*sendBrowserToolResponses(e,t,s,o){const r={conversationId:e,content:[],context:s,browserToolResponses:t,browserTools:o},l=(await k.postRaw(`${this.baseUrl}/messages`,r)).body?.getReader();if(!l)throw new Error("No response body");const h=new O;for(;;){const d=await l.read();if(d.done)break;for(const p of h.reduceInChunks(M,new TextDecoder().decode(d.value)))yield p}}async abortStreaming(e){await k.post(`${this.baseUrl}/abort`,{langGraphThreadId:e})}async getHistory(e,t){const s={limit:`${e}`,offset:`${t}`};return await k.get(`${this.baseUrl}/history`,s)}async deleteThread(e){await k.delete(`${this.baseUrl}/conversation/${e}`)}}class V{tools=new Map;register(e){this.tools.set(e.name,e)}get(e){return this.tools.get(e)}has(e){return this.tools.has(e)}getAll(){return Array.from(this.tools.values())}toDefinitions(){return this.getAll().map(({name:e,description:t,payloadSchema:s})=>({name:e,description:t,payloadSchema:s}))}async execute(e){const t=this.get(e.toolName);if(!t)throw new Error(`Browser tool not found: ${e.toolName}`);const s=await t.execute(e.args);return{toolCallId:e.toolCallId,response:s}}requiresApproval(e){return this.get(e)?.requiresApproval??!1}}function st(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const ot=["#\\s*rest\\s+of\\s+(the\\s+)?(code|file|implementation|function|method|class)","#\\s*remaining\\s+(code|implementation|logic)","#\\s*\\.\\.\\.\\s*(existing|rest|remaining)?\\s*(code|implementation)?","#\\s*continue\\s+with\\s+(existing|rest|remaining)\\s+(code|logic|implementation)","#\\s*existing\\s+(code|implementation|logic)\\s*(here|continues|remains)?","//\\s*rest\\s+of\\s+(the\\s+)?(code|file|implementation|function|method|class)","//\\s*remaining\\s+(code|implementation|logic)","//\\s*\\.\\.\\.\\s*(existing|rest|remaining)?\\s*(code|implementation)?"],rt=new RegExp(ot.join("|"),"im");class it extends Error{placeholder;newContext;constructor(e,t){super(`Detected placeholder comment in new_context: '${e}'. The new_context must contain complete replacement code, not placeholders. Use smaller, targeted old_context values to make surgical edits instead.`),this.placeholder=e,this.newContext=t}}function at(i){const e=rt.exec(i);return e?e[0]:null}function nt(i,e){const t=[];for(let r=0;r<e.length;r++){const{oldContext:a,newContext:l,maxOccurrences:h}=e[r],d=at(l);if(d)throw new it(d,l);if(h===0)continue;const p=st(a),f=new RegExp(p,"g");let v,C=0;for(;(v=f.exec(i))!==null&&!(h!==void 0&&h>0&&C>=h);)t.push({start:v.index,end:v.index+v[0].length,replacement:l,priority:r}),C++,v[0].length===0&&f.lastIndex++}t.sort((r,a)=>r.start!==a.start?r.start-a.start:r.priority-a.priority);const s=[];for(const r of t)s.some(l=>r.start<l.end&&r.end>l.start)||s.push(r);s.sort((r,a)=>a.start-r.start);let o=i;for(const r of s)o=o.slice(0,r.start)+r.replacement+o.slice(r.end);return o}async function ee(i,e){if(!e.endsWith(".py"))return{};try{const t=await i.typeCheck(e);if(!t.success){let s="";return t.stdout&&(s+=t.stdout),t.stderr&&(s&&(s+=`
`),s+=t.stderr),{warning:`Type checking failed:
${s}

Please review the changes made and double check the correct usage of Abstra SDK functions and classes.`}}}catch{}return{}}const lt={name:"replaceCodeContext",description:`Replace specific code sections using exact context matching (RECOMMENDED).
This is the most reliable method for code updates. It performs surgical edits by finding exact
context matches and replacing them atomically.

When to use:
- Single line changes, function updates, variable modifications
- Small to medium changes (<50% of file)
- When you want maximum reliability and minimal payload size

Safety Features:
- Atomic operation: all replacements applied simultaneously from original text
- No cascading effects between replacements
- Rollback capability if any operation fails
- Context matching prevents positioning errors
- Type checking with ty in strict mode`,payloadSchema:{type:"object",properties:{file:{type:"string",description:'Relative path to the file from the project root directory (e.g. "script.py")'},replacements:{type:"array",description:"List of replacement operations",items:{type:"object",properties:{old_context:{type:"string",description:"Exact string to find and replace (must match exactly)"},new_context:{type:"string",description:"String to replace it with"},max_occurrences:{type:"number",description:"Limit number of replacements. -1 or omitted: replace all, 0: skip, N > 0: replace first N only"}},required:["old_context","new_context"]}}},required:["file","replacements"]},requiresApproval:!0,execute:async i=>{const e=i.file,t=i.replacements;if(!e||typeof e!="string")return{success:!1,message:"Invalid file path: file must be a non-empty string"};if(!Array.isArray(t)||t.length===0)return{success:!1,message:"Invalid replacements: must be a non-empty array"};for(const s of t){if(typeof s.old_context!="string"||s.old_context==="")return{success:!1,message:"Invalid replacement: old_context must be a non-empty string"};if(typeof s.new_context!="string")return{success:!1,message:"Invalid replacement: new_context must be a string"}}try{const o=await(await I.get()).readFile(e);if(o===null)return{success:!1,message:`File not found: ${e}`};for(const p of t)if(!o.includes(p.old_context))return{success:!1,message:`Could not find context to replace in ${e}: "${p.old_context.substring(0,50)}..."`};const r=t.map(p=>({oldContext:p.old_context,newContext:p.new_context,maxOccurrences:p.max_occurrences})),a=nt(o,r);if(a===""&&o!=="")return{success:!1,message:`Safety check failed: replacements would result in empty file. Original file had ${o.length} characters.`};const l=new Y,h=new TextEncoder;await l.create(e,h.encode(a),!0);const{warning:d}=await ee(l,e);return d?{success:!0,message:`Code changes applied to ${e} with ${t.length} replacement(s).`,warning:d}:{success:!0,message:`Code changes applied to ${e} with ${t.length} replacement(s).`}}catch(s){return{success:!1,message:`Failed to apply changes to ${e}: ${s instanceof Error?s.message:"Unknown error"}`}}}},ct={name:"replaceFileContent",description:`Replace entire file content (use sparingly).
This method performs a complete file content replacement.

When to use:
- Complete file rewrites or major refactoring (>50% changes)
- New file creation with substantial content

When NOT to use:
- Avoid for small changes (use replaceCodeContext instead)

Note:
  - Creates file if it doesn't exist
  - Completely overwrites existing content
  - Consider using replace_code_context for targeted changes
  - Use atomic write operation for safety`,payloadSchema:{type:"object",properties:{file:{type:"string",description:'Relative path to the file from the project root directory (e.g. "script.py")'},content:{type:"string",description:"Complete new file content"}},required:["file","content"]},requiresApproval:!0,execute:async i=>{const e=i.file,t=i.content;if(!e||typeof e!="string")return{success:!1,message:"Invalid file path: file must be a non-empty string"};if(typeof t!="string")return{success:!1,message:"Invalid content: content must be a string"};if(t==="")try{const o=await(await I.get()).readFile(e);if(o!==null&&o!=="")return{success:!1,message:`Safety check failed: cannot write empty content to existing file with ${o.length} characters. Use file deletion if you intend to remove the file.`}}catch{}try{const s=new Y,o=new TextEncoder;await s.create(e,o.encode(t),!0);const{warning:r}=await ee(s,e);return r?{success:!0,message:`File content written to ${e}.`,warning:r}:{success:!0,message:`File content written to ${e}.`}}catch(s){return{success:!1,message:`Failed to write file ${e}: ${s instanceof Error?s.message:"Unknown error"}`}}}},dt=()=>[lt,ct],ht=X({__name:"CopyButton",props:{textToCopy:{}},setup(i){const e=i,t=g(!1),s=()=>{navigator.clipboard.writeText(e.textToCopy),t.value=!0,setTimeout(()=>t.value=!1,2e3)},o=F(()=>t.value?N.translate("i18n_copybutton_copied"):N.translate("i18n_copybutton_copy_to_clipboard"));return(r,a)=>(b(),j(P(ne),null,{title:Z(()=>[ie(ae(o.value),1)]),default:Z(()=>[A("div",{class:"copy-button",onClick:s},[t.value?(b(),j(P(Ke),{key:1,color:"#fff",size:"22"})):(b(),j(P(Ee),{key:0,color:"#fff",size:"22"}))])]),_:1}))}}),pt=le(ht,[["__scopeId","data-v-95878e02"]]);class q{_conversationId;_input;_attachments;_recentlyAccessedThreads;constructor(){this._conversationId=g(null),this._input=g(""),this._attachments=g([]),this._recentlyAccessedThreads=g([])}get conversationId(){return this._conversationId.value}get input(){return this._input.value}get attachments(){return this._attachments.value}get recentThreads(){return this._recentlyAccessedThreads.value}hasActiveConversation(){return this._conversationId.value!==null}setupThread(){const e=`abstra-assistant-thread-${T()}`;return this._conversationId.value=e,this._recentlyAccessedThreads.value.unshift({id:e,messages:[],createdAt:new Date().toISOString()}),e}setInput(e,t){this._input.value=e?.trimEnd()||"",this._attachments.value=t||[]}clearInput(){this._input.value="",this._attachments.value=[]}switchThread(e){this._conversationId.value=e;const t=this._recentlyAccessedThreads.value.findIndex(o=>o.id===e);if(t===-1)throw new Error(`Thread ${e} not found in recent threads`);const[s]=this._recentlyAccessedThreads.value.splice(t,1);this._recentlyAccessedThreads.value.unshift(s)}addThreadToRecents(e){const t=this._recentlyAccessedThreads.value.findIndex(s=>s.id===e.id);t!==-1&&this._recentlyAccessedThreads.value.splice(t,1),this._recentlyAccessedThreads.value.unshift(e),this._conversationId.value=e.id}removeThread(e){const t=this._recentlyAccessedThreads.value.findIndex(s=>s.id===e);t!==-1&&(this._recentlyAccessedThreads.value.splice(t,1),this._conversationId.value===e&&(this._recentlyAccessedThreads.value.length>0?this._conversationId.value=this._recentlyAccessedThreads.value[0].id:this._conversationId.value=null))}addMessageToCurrentThread(e){this._recentlyAccessedThreads.value=this._recentlyAccessedThreads.value.map(t=>(t.id===this._conversationId.value&&t.messages.unshift({role:"assistant",content:e,createdAt:new Date().toISOString()}),t))}getThreadById(e){return this._recentlyAccessedThreads.value.find(t=>t.id===e)||null}getCurrentThread(){return this._conversationId.value?this.getThreadById(this._conversationId.value):null}reset(){this._conversationId.value=null,this._input.value="",this._attachments.value=[],this._recentlyAccessedThreads.value=[]}static create(){return new q}}class J{_repository;_history;_isLoading;_pagination;constructor(e){this._repository=e,this._history=g([]),this._isLoading=g(!1),this._pagination=g({limit:10,offset:0,done:!1})}get history(){return this._history.value}get isLoading(){return this._isLoading.value}get hasMore(){return!this._pagination.value.done}async fetchHistory(){this._isLoading.value=!0;try{const e=await this._repository.getHistory(this._pagination.value.limit,this._pagination.value.offset);e.length<this._pagination.value.limit&&(this._pagination.value.done=!0),this._history.value=e}finally{this._isLoading.value=!1}}async loadMore(){this._isLoading.value=!0;try{this._pagination.value.offset+=this._pagination.value.limit;const e=await this._repository.getHistory(this._pagination.value.limit,this._pagination.value.offset);e.length<this._pagination.value.limit&&(this._pagination.value.done=!0),this._history.value=[...this._history.value,...e]}finally{this._isLoading.value=!1}}removeFromHistory(e){const t=this._history.value.findIndex(s=>s.id===e);t!==-1&&this._history.value.splice(t,1)}reset(){this._history.value=[],this._pagination.value={limit:10,offset:0,done:!1}}static create(e){return new J(e)}}class H{extractTextContent(e){return typeof e=="string"?e:Array.isArray(e)?e.filter(t=>t.type==="text"&&t.text).map(t=>t.text).join(`
`):""}extractAttachments(e){if(typeof e=="string"||!Array.isArray(e))return[];let t=0;return e.filter(s=>s.type==="image_url"&&s.image_url?.url).map(s=>{t++;const r=s.image_url.url.match(/^data:([^;]+);base64,(.+)$/);if(r){const[,a,l]=r,h=Math.ceil(l.length*3/4);let d=a.split("/")[1]||"jpg";return(!d||!a.startsWith("image/"))&&(d="jpg"),{fileName:`image_${t}.${d}`,fileContent:l,fileSize:h,mimeType:a}}return{fileName:`image_${t}.jpg`,fileContent:"",fileSize:0,mimeType:"image/jpeg"}})}buildMessageContent(e,t){const s=[];e.trim()&&s.push({type:"text",text:e.trim()});const o=t.map(r=>({type:"file",fileName:r.fileName,fileContent:r.fileContent}));return s.push(...o),s}static create(){return new H}}function $(i,e){const t=e.file,s=t?t.split("/").pop():void 0;switch(i){case"replaceCodeContext":return s?`Edit ${s} by context replacement`:"Edit by context replacement";case"replaceFileContent":return s?`Edit ${s} by replacing its full content`:"Replace file content";default:return`Browser Tool: ${i}`}}class K{_repository;_smartChatState;_logService;_hasError=g(null);_executingFormFile=g(null);_manualFormStop=g(!1);_browserToolRegistry=new V;_pendingBrowserToolResponses=new Map;_pendingBrowserToolApprovals=new Map;_badgeService;_messageService;_conversationService;_historyService;loadingAbort=g(!1);codeForApproval=g(null);_stopFormCallback;notifyOnToolCall=g(!0);notifyOnAiDone=g(!0);hasBeenAskedAboutNotifications=g(!1);showNotificationConsent=g(!1);_lastCompletionSummary=null;constructor(e,t,s){this._repository=e,this._logService=t,this._stopFormCallback=s,this._smartChatState=g("idle"),this._badgeService=U.create(),this._messageService=H.create(),this._conversationService=q.create(),this._historyService=J.create(e)}registerBrowserTools(e){for(const t of e)this._browserToolRegistry.register(t)}clearBrowserTools(){this._browserToolRegistry=new V}getBrowserToolDefinitions(){return this._browserToolRegistry.toDefinitions()}_setCodeForApprovalFromArgs(e,t){if(e==="replaceCodeContext"){const s=t.file,o=t.replacements;this.codeForApproval.value={file:s,replacements:o.map(r=>({oldContext:r.old_context,newContext:r.new_context}))}}else if(e==="replaceFileContent"){const s=t.file,o=t.content;this.codeForApproval.value={file:s,code:o}}}async approveBrowserToolCall(e){const t=this._pendingBrowserToolApprovals.get(e);if(!t){console.warn(`No pending browser tool call found for ${e}`);return}this._pendingBrowserToolApprovals.delete(e);try{const s=await this._browserToolRegistry.execute({toolCallId:t.toolCallId,toolName:t.toolName,args:t.args});this._logService.log({type:"ai-tool-call-response",toolCallId:e,response:typeof s.response=="string"?s.response:JSON.stringify(s.response)}),this._pendingBrowserToolResponses.set(e,s.response)}catch(s){const o=s instanceof Error?s.message:"Browser tool execution failed";this._logService.log({type:"ai-tool-call-response",toolCallId:e,response:`Error: ${o}`}),this._pendingBrowserToolResponses.set(e,{error:o})}}rejectBrowserToolCall(e){if(!this._pendingBrowserToolApprovals.get(e)){console.warn(`No pending browser tool call found for ${e}`);return}this._pendingBrowserToolApprovals.delete(e),this._logService.log({type:"ai-tool-call-response",toolCallId:e,response:"Browser tool execution was rejected by the user."}),this._pendingBrowserToolResponses.set(e,{error:"User rejected the browser tool execution"})}hasPendingBrowserToolApprovals(){return this._pendingBrowserToolApprovals.size>0}previewBrowserToolCall(e){const t=this._pendingBrowserToolApprovals.get(e);t&&(t.toolName==="replaceCodeContext"||t.toolName==="replaceFileContent")&&this._setCodeForApprovalFromArgs(t.toolName,t.args)}init(){this.setupThread(),this.renderCopyButtons(),this.loadNotificationPreferences()}loadNotificationPreferences(){const e=localStorage.getItem("abstra_ai_notifications");if(e)try{const{tool:t,done:s,hasBeenAsked:o}=JSON.parse(e);this.notifyOnToolCall.value=t??!0,this.notifyOnAiDone.value=s??!0,this.hasBeenAskedAboutNotifications.value=o??!1}catch(t){console.error("Failed to load notification preferences",t),localStorage.removeItem("abstra_ai_notifications")}this.updateConsentPromptVisibility()}updateConsentPromptVisibility(){if(typeof Notification>"u"){this.showNotificationConsent.value=!1;return}const e=Notification.permission;if(e==="denied"){this.showNotificationConsent.value=!1,this.hasBeenAskedAboutNotifications.value=!0;return}if(e==="granted"){this.showNotificationConsent.value=!1;return}this.showNotificationConsent.value=!this.hasBeenAskedAboutNotifications.value}async acceptNotifications(){const e=await Notification.requestPermission();this.notifyOnToolCall.value=e==="granted",this.notifyOnAiDone.value=e==="granted",this.hasBeenAskedAboutNotifications.value=!0,this.showNotificationConsent.value=!1,this.saveNotificationPreferences()}declineNotifications(){this.notifyOnToolCall.value=!1,this.notifyOnAiDone.value=!1,this.hasBeenAskedAboutNotifications.value=!0,this.showNotificationConsent.value=!1,this.saveNotificationPreferences()}saveNotificationPreferences(){localStorage.setItem("abstra_ai_notifications",JSON.stringify({tool:this.notifyOnToolCall.value,done:this.notifyOnAiDone.value,hasBeenAsked:this.hasBeenAskedAboutNotifications.value}))}setupThread=async()=>{this._conversationService.setupThread()};fetchHistory=async()=>{await this._historyService.fetchHistory()};loadMoreHistory=async()=>{await this._historyService.loadMore()};setError=e=>{this._hasError.value=e};setExecutingFormFile=e=>{this._executingFormFile.value=e};get isManualFormStop(){return this._manualFormStop.value}get hasCodeForApproval(){return!!this.codeForApproval.value}clearManualFormStop=()=>{this._manualFormStop.value=!1};stopForm=()=>{if(this._stopFormCallback){this._manualFormStop.value=!0,this._stopFormCallback(),this._executingFormFile.value=null;for(const e of this._logService.logs)e.type==="ai-tool-approval"&&e.isFormRunning&&(e.isFormRunning=!1,e.executingFormFile=null)}};get hasError(){return this._hasError.value?.payload||null}_fillChat=e=>{this._logService.clear();for(const t of e)if(t.toolTitle)this._logService.log({type:"ai-tool-approval",toolCallId:t.toolCallId,description:t.toolTitle,args:{},disabled:!1,needsApproval:!1,loading:!1}),this._logService.log({type:"ai-tool-call-response",toolCallId:t.toolCallId,response:this._messageService.extractTextContent(t.content)});else{const s=this._messageService.extractAttachments(t.content);s.length>0&&t.role==="user"?this._logService.log({type:"ai-input",log:this._messageService.extractTextContent(t.content),attachments:s}):this._logService.log({type:t.role==="user"?"ai-input":"ai-output",log:this._messageService.extractTextContent(t.content)})}this.renderCopyButtons()};moveThreadFromHistoryToRecents=e=>{const t=this._historyService.history.find(s=>s.id===e);if(!t)throw new Error(`Thread ${e} not found`);this._conversationService.addThreadToRecents(t),this._fillChat(t.messages)};deleteThread=e=>{this._repository.deleteThread(e),this._conversationService.removeThread(e),this._historyService.removeFromHistory(e);const t=this._conversationService.getCurrentThread();t?this._fillChat(t.messages):this._logService.clear()};setCurrentThreadFromRecents=e=>{this._conversationService.switchThread(e);const t=this._conversationService.getCurrentThread();if(!t)throw new Error(`Thread ${e} not found`);this._fillChat(t.messages)};removeFromRecentlyAccessedThreads=e=>{this._conversationService.removeThread(e),this._logService.clear();const t=this._conversationService.getCurrentThread();t&&this._fillChat(t.messages)};renderCopyButtons=()=>{document.querySelectorAll("pre").forEach(t=>{t.style.position="relative";const s=ce(pt,{textToCopy:t.textContent});de(s,t)})};clearLogService=()=>{this._logService.clear()};send=async(e,t,s=0)=>{this._conversationService.hasActiveConversation()||await this.setupThread(),s===0&&this._logService.log({type:"ai-input",log:this._conversationService.input,attachments:this._conversationService.attachments}),this._smartChatState.value="processing";try{typeof Notification<"u"&&this.notifyOnToolCall.value&&Notification.permission!=="granted"&&Notification.requestPermission();const o=T(),r=this._conversationService.conversationId;if(!r)throw new Error("Conversation ID is not set");const a=this._messageService.buildMessageContent(this._conversationService.input,this._conversationService.attachments),l={currentEditorUrl:window.location.href,panesInfo:e||{}},h=this.getBrowserToolDefinitions();let d="",p=o,f="";if(!(this._pendingBrowserToolResponses.size>0)){const C=this._repository.sendMessage(r,a,l,this.isIdle.bind(this),t,h.length>0?h:void 0);for await(const E of C){if(this.isIdle())break;this._smartChatState.value==="processing"&&(this._smartChatState.value="answering");const n=E;if(typeof n=="string"){if(n.includes("abstra__trigger__retry"))throw new Error("AI service requested a retry");d+=n,f+=n,this._logService.log({type:"ai-output",log:f},p)}else if(n instanceof Object){if(n.type==="ai-tool-approval"){typeof Notification<"u"&&this.notifyOnToolCall.value&&Notification.permission==="granted"&&new Notification("Abstra AI",{body:N.translate("i18n_omnichatheader_permission_requested",null,n.title),silent:!1});const c=n.args?.file,m=!!(n.args?.replacements||n.args?.content)&&this._executingFormFile.value===c;this._logService.log({type:"ai-tool-approval",toolCallId:n.toolCallId,description:n.title,args:n.args,disabled:!1,needsApproval:!0,loading:!1,isFormRunning:m,executingFormFile:m?this._executingFormFile.value:void 0})}else if(n.type==="ai-tool-call")typeof Notification<"u"&&this.notifyOnToolCall.value&&Notification.permission==="granted"&&new Notification("Abstra AI",{body:N.translate("i18n_omnichatheader_using_tool",null,n.title),silent:!1}),this._logService.log({type:"ai-tool-approval",toolCallId:n.toolCallId,description:n.title,args:n.args,disabled:!1,needsApproval:!1,loading:!1}),p=T(),f="";else if(n.type==="ai-tool-call-response")this._logService.log({type:"ai-tool-call-response",toolCallId:n.toolCallId,response:n.response});else if(n.type==="ai-completion-summary")this._lastCompletionSummary=n.summary;else if(n.type==="ai-browser-tool-call"){const c=n.toolName,u=n.toolCallId,m=n.args||{},_=this._browserToolRegistry.get(c);if(this._browserToolRegistry.requiresApproval(c)&&_){const w=this._pendingBrowserToolApprovals.size===0;this._pendingBrowserToolApprovals.set(u,{toolCallId:u,toolName:c,args:m,tool:_}),w&&this._setCodeForApprovalFromArgs(c,m);const y=c==="replaceCodeContext"||c==="replaceFileContent";this._logService.log({type:"ai-tool-approval",toolCallId:u,description:n.title||$(c,m),args:m,disabled:!1,needsApproval:!0,loading:!1,isBrowserTool:!0,hasPreview:y})}else{this._logService.log({type:"ai-tool-approval",toolCallId:u,description:n.title||$(c,m),args:m,disabled:!1,needsApproval:!1,loading:!0});try{const w=await this._browserToolRegistry.execute({toolCallId:u,toolName:c,args:m});this._logService.log({type:"ai-tool-call-response",toolCallId:u,response:typeof w.response=="string"?w.response:JSON.stringify(w.response)}),this._pendingBrowserToolResponses.set(u,w.response)}catch(w){const y=w instanceof Error?w.message:"Browser tool execution failed";this._logService.log({type:"ai-tool-call-response",toolCallId:u,response:`Error: ${y}`}),this._pendingBrowserToolResponses.set(u,{error:y})}}p=T(),f=""}}}}for(;this._pendingBrowserToolResponses.size>0;){const C=Array.from(this._pendingBrowserToolResponses.entries()).map(([n,c])=>({toolCallId:n,response:c}));this._pendingBrowserToolResponses.clear();const E=this._repository.sendBrowserToolResponses(r,C,l,h.length>0?h:void 0);for await(const n of E){if(this.isIdle())break;const c=n;if(typeof c=="string")d+=c,f+=c,this._logService.log({type:"ai-output",log:f},p);else if(c instanceof Object){if(c.type==="ai-tool-call-response")this._logService.log({type:"ai-tool-call-response",toolCallId:c.toolCallId,response:c.response});else if(c.type==="ai-tool-call")this._logService.log({type:"ai-tool-approval",toolCallId:c.toolCallId,description:c.title,args:c.args,disabled:!1,needsApproval:!1,loading:!1}),p=T(),f="";else if(c.type==="ai-completion-summary")this._lastCompletionSummary=c.summary;else if(c.type==="ai-browser-tool-call"){const u=c.toolName,m=c.toolCallId,_=c.args||{},L=this._browserToolRegistry.get(u);if(this._browserToolRegistry.requiresApproval(u)&&L){const y=this._pendingBrowserToolApprovals.size===0;this._pendingBrowserToolApprovals.set(m,{toolCallId:m,toolName:u,args:_,tool:L}),y&&this._setCodeForApprovalFromArgs(u,_);const R=u==="replaceCodeContext"||u==="replaceFileContent";this._logService.log({type:"ai-tool-approval",toolCallId:m,description:c.title||$(u,_),args:_,disabled:!1,needsApproval:!0,loading:!1,isBrowserTool:!0,hasPreview:R})}else{this._logService.log({type:"ai-tool-approval",toolCallId:m,description:c.title||$(u,_),args:_,disabled:!1,needsApproval:!1,loading:!0});try{const y=await this._browserToolRegistry.execute({toolCallId:m,toolName:u,args:_});this._logService.log({type:"ai-tool-call-response",toolCallId:m,response:typeof y.response=="string"?y.response:JSON.stringify(y.response)}),this._pendingBrowserToolResponses.set(m,y.response)}catch(y){const R=y instanceof Error?y.message:"Browser tool execution failed";this._logService.log({type:"ai-tool-call-response",toolCallId:m,response:`Error: ${R}`}),this._pendingBrowserToolResponses.set(m,{error:R})}}p=T(),f=""}}}}this._conversationService.addMessageToCurrentThread(d),this._conversationService.clearInput(),this._smartChatState.value="idle",this.renderCopyButtons(),typeof Notification<"u"&&this.notifyOnAiDone.value&&Notification.permission==="granted"&&(new Notification("Abstra AI",{body:this._lastCompletionSummary||N.translate("i18n_omnichatheader_ai_finished"),silent:!1}),this._lastCompletionSummary=null)}catch(o){console.error(o),he(o),s>3?(this._logService.log({type:"ai-output",log:"Sorry, there was an issue processing your request. Please try again later."}),this._conversationService.clearInput(),this._smartChatState.value="idle",this.renderCopyButtons()):(this._logService.log({type:"ai-output",log:"We had some trouble, but we are already retrying your request..."}),await this.abort(),this._conversationService.setInput("There was an unexpected error, please try again. You must continue from where you stopped as if nothing happened."),this.send(e,t,s+1))}};get logService(){return this._logService}shouldRenderLoadMoreHistory(){return this._historyService.hasMore}get pastThreads(){return this._historyService.history.map(e=>{if(e.messages.length===0)return{threadId:e.id,title:"New thread"};{const t=this._messageService.extractTextContent(e.messages[0].content);return{threadId:e.id,title:t}}})}get recentlyAccessedThreads(){return this._conversationService.recentThreads.map(e=>{if(e.messages.length===0)return{threadId:e.id,title:"New thread"};{const t=this._messageService.extractTextContent(e.messages[0].content);return{threadId:e.id,title:t.slice(0,20)+"..."}}})}abort=async()=>{const e=this._conversationService.conversationId;if(!e)throw new Error("Conversation ID is not set");this.loadingAbort.value=!0,await this._repository.abortStreaming(e),this._smartChatState.value="idle",this.loadingAbort.value=!1};isLoadingHistory=()=>this._historyService.isLoading;isProcessing=()=>this._smartChatState.value==="processing";isAnswering=()=>this._smartChatState.value==="answering";isIdle=()=>this._smartChatState.value==="idle";setSeen=()=>{this._badgeService.setSeen()};setUnseen=e=>{this._badgeService.setUnseen(e)};setInput=(e,t)=>{this._conversationService.setInput(e,t)};regenerateLast=async()=>{for(let e=this._logService.logs.length-1;e>=0;e--){const t=this._logService.logs[e];if(t.type==="ai-input"){this.setInput(t.log);break}}await this.send()};isWaitingForToolApproval=()=>{const e=this._logService.logs[this._logService.logs.length-1];return e?.type==="ai-tool-approval"&&e.needsApproval};disableLastToolApprovalMessage=()=>{if(!this.isWaitingForToolApproval())return;const e=this._logService.logs[this._logService.logs.length-1];e.type==="ai-tool-approval"&&(e.disabled=!0)};get badgeState(){return this._badgeService.badgeState}get input(){return this._conversationService.input}fixJson=async(e,t)=>{this._logService.clear(),this._logService.log({type:"ai-input",log:`here is my json code:
      ${e}
      And I got this error:`}),this._logService.log({type:"stderr",log:t}),this.setSeen(),this.setInput("Can you fix this JSON?"),await this.send()};askAboutError=async(e,t)=>{this._logService.clear(),this.setInput(["Fix the following error based on my logs:",...e.entries.map(s=>s.payload.text),`My current code is: ${t||"No code provided"}`].join(`
`)),await this.send()};fixIssueWithAI=async(e,t)=>{this._logService.clear(),this.setInput(["Fix the following issue in my code:",e.label,t.label].join(`
`)),await this.send()}}const bt=new ge,St=pe("omniChat",()=>{const i=g(!0),e=g(!1),t=D.create(),s=W(),o=W(),r=(n,c,u)=>{if(!o.value){if(n==="console"){if(!c)throw new Error("Project ID is required for console chat");s.value=new tt(c),o.value=new K(s.value,t,u)}else s.value=new et,o.value=new K(s.value,t,u);o.value.registerBrowserTools(dt())}},a=()=>{e.value=!0},l=()=>{e.value=!1},h=()=>{i.value=!0,a()},d=()=>{i.value=!1,l()},p=()=>{i.value?d():h()},f=n=>{o.value?.setError(n)},v=()=>{o.value?.setError(null)},C=()=>o.value?.isIdle()??!0,E=F(()=>o.value?.hasError??null);return{isOpen:i,isInputFocused:e,focusInput:a,blurInput:l,open:h,close:d,toggle:p,controller:F(()=>o.value),repository:s,init:r,setError:f,clearError:v,isIdle:C,hasError:E}});export{U as B,Y as C,Ke as H,D as L,I as W,nt as c,bt as o,St as u};
//# sourceMappingURL=omniChatStore-GzvmxXJk.js.map
