"use strict";(self.webpackChunkjupyterlab_v4_codio_ext=self.webpackChunkjupyterlab_v4_codio_ext||[]).push([[776],{776:(e,o,t)=>{t.r(o),t.d(o,{default:()=>y});var r=t(598),n=t(912);const c=(()=>{let e,o;const t=new Promise(((t,r)=>{e=t,o=r}));return{resolve:e,reject:o,promise:t}})(),l=function(){c.resolve(),console.log("codio client loaded")};var i=t(602);class d{constructor({notebookPanel:e,config:o}){this.cellErrorEvent=new a({notebookPanel:e,config:o})}}class a{constructor({notebookPanel:e}){this._cellErrored=new i.Signal(this),this._notebookPanel=e,e.disposed.connect(this.onDisposed,this),(async()=>{try{await e.revealed,r.NotebookActions.executed.connect(this.onExecuted,this)}catch(e){console.log(e)}})()}onDisposed(){i.Signal.disconnectAll(this)}onExecuted(e,o){if(!o.success||o.error){const e=[{id:o.cell.model.id,index:this._notebookPanel.content.widgets.findIndex((e=>e===o.cell))}];this._cellErrored.emit({eventName:"cell_errored",cells:e,notebookPanel:this._notebookPanel,kernelError:o.error})}}get cellErrored(){return this._cellErrored}}const s=e=>{const o=e.context.path,t=[],r=e.content;for(let e=0;e<r.widgets.length;e++){const o=r.widgets[e];let n=null;"code"===o.model.type&&(n=o.model.executionCount),t.push({type:r.widgets[e].model.type,content:r.widgets[e].model.sharedModel.source,id:r.widgets[e].model.id,executionCount:n})}return{path:o,cells:t}},u=async(e,o,t,r)=>{try{await o.started;const n=await t.load(e);await(async e=>{const o=e.get("codioClientUrl").composite;await(async e=>{((e,o,t)=>{console.log("loadCodio from url",e);const r=document.createElement("script");r.src=e,r.onload=o,r.onerror=(...e)=>{console.log("jupyterlab-codio-ext loading script error",e),c.reject(e)},t.appendChild(r)})(e,l,document.body),await c.promise})(o)})(n),r.widgetAdded.connect(((e,o)=>{(async(e,o)=>{var t;window.codio?(null===(t=window.codio)||void 0===t||t.setLoaded(),await window.codio.loaded(),window.codio.subscribe("getContext",(async()=>s(e))),window.codio.subscribe("hideNbgraderMenu",(async()=>(async()=>{try{if(await c.promise,window.document){const e=window.document.getElementById("jp-menu-panel"),o=e&&e.querySelector(".lm-MenuBar-content");(o?o.childNodes:[]).forEach((e=>{if("function"==typeof e.querySelector){const o=e.querySelector(".lm-MenuBar-itemLabel");"Nbgrader"===(o?o.innerText:null)&&(e.style.display="none")}}));const t=window.document.getElementById("jp-main-content-panel"),r=t&&t.querySelector("[data-id='nbgrader-create_assignemnt']");r&&(r.style.display="none")}}catch(e){console.error("hideNbgraderMenu error",e)}})())),window.codio.subscribe("callSave",(async()=>(async e=>{var o;try{await c.promise,await(null===(o=e.currentWidget)||void 0===o?void 0:o.context.save())}catch(e){console.error("jupyter doSave error",e)}})(o))),window.codio.subscribe("hasChanges",(async()=>(async e=>e.context.model.dirty)(e)))):console.log("no codio loaded")})(o,e),new d({notebookPanel:o,config:{notebook_cell_error_event:!0}}).cellErrorEvent.cellErrored.connect(((e,o)=>{const t=o.cells[0].index;if(t<0)return;const r=o.notebookPanel.content,n=o.notebookPanel.context.path,l=r.widgets[t].model.sharedModel.source,i=r.widgets[t].model.id,d=s(o.notebookPanel);let a="Undefined error";if(o.kernelError){if(!o.kernelError.errorName)return;a=`${o.kernelError.errorName}: ${o.kernelError.errorValue}`}(async e=>{try{await c.promise,await async function(e,o){var t,r;try{console.log("jupyterlab codio sendErrorEvent",e,o),await(null===(t=window.codio)||void 0===t?void 0:t.loaded()),null===(r=window.codio)||void 0===r||r.event("error",{message:e,context:o})}catch(e){console.log("sendErrorEvent",e)}}(e.message,e.context)}catch(e){console.error("onSendErrorToCodio error",e)}})({message:a,context:{error:o.kernelError,pagePath:n,pageContext:d,cellContent:l,cellId:i}})}))}))}catch(e){console.log("jupyter lab codio ext error",e)}},w="jupyterlab-v4-codio-ext:plugin",y={id:w,description:"A JupyterLab v4 extension to interact with codio.",autoStart:!0,requires:[n.ISettingRegistry,r.INotebookTracker],activate:(e,o,t)=>{(async()=>{try{await u(w,e,o,t)}catch(e){console.error("jupyter lab codio ext error",e)}})()}}}}]);