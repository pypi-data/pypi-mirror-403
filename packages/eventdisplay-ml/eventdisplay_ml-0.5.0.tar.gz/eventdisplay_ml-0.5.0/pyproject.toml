[build-system]
build-backend = "setuptools.build_meta"
requires = [
  "setuptools>=64",
  "setuptools-scm[toml]>=8",
]

[project]
name = "eventdisplay-ml"
description = "A machine learning toolkit for Eventdisplay"
readme = "README.md"
license = "BSD-3-Clause"
license-files = [ "LICENSE" ]
authors = [
  { name = "Gernot Maier", email = "gernot.maier@desy.de" },
]
requires-python = ">=3.12"
classifiers = [
  "Intended Audience :: Science/Research",
  "Operating System :: OS Independent",
  "Programming Language :: Python :: 3 :: Only",
  "Programming Language :: Python :: 3.12",
  "Programming Language :: Python :: 3.13",
  "Programming Language :: Python :: 3.14",
  "Topic :: Scientific/Engineering :: Astronomy",
]
dynamic = [
  "version",
]
dependencies = [
  "awkward",
  "awkward-pandas",
  "joblib",
  "matplotlib",
  "numpy",
  "pandas",
  "scikit-learn",
  "scipy",
  "tabulate",
  "uproot",
  "xgboost",
]
optional-dependencies."dev" = [
  "pre-commit",
  "pylint",
  "ruff",
  "shellcheck",
  "towncrier",
]
optional-dependencies."tests" = [
  "pytest",
  "pytest-cov",
  "pytest-mock",
  "pytest-profiling",
  "pytest-random-order",
  "pytest-repeat",
  "pytest-retry",
  "pytest-xdist",
]
urls."bug tracker" = "https://github.com/Eventdisplay/Eventdisplay-ML/issues"
urls."documentation" = "https://github.com/Eventdisplay/Eventdisplay-ML"
urls."repository" = "https://github.com/Eventdisplay/Eventdisplay-ML"
scripts.eventdisplay-ml-apply-xgb-classify = "eventdisplay_ml.scripts.apply_xgb_classify:main"
scripts.eventdisplay-ml-apply-xgb-stereo = "eventdisplay_ml.scripts.apply_xgb_stereo:main"
scripts.eventdisplay-ml-plot-classification-performance-metrics = "eventdisplay_ml.scripts.plot_classification_performance_metrics:main"
scripts.eventdisplay-ml-plot-classification-gamma-efficiency = "eventdisplay_ml.scripts.plot_classification_gamma_efficiency:main"
scripts.eventdisplay-ml-train-xgb-classify = "eventdisplay_ml.scripts.train_xgb_classify:main"
scripts.eventdisplay-ml-train-xgb-stereo = "eventdisplay_ml.scripts.train_xgb_stereo:main"

[tool.setuptools]
package-dir = { "" = "src" }

[tool.setuptools.packages.find]
where = [ "src" ]
exclude = [ "eventdisplay_ml._dev_version.*" ]

[tool.setuptools_scm]
write_to = "src/eventdisplay_ml/_version.py"

[tool.ruff]
line-length = 100
indent-width = 4
exclude = [
  "__init__.py",
  "pyproject.toml",
]

format.indent-style = "space"
format.quote-style = "double"
format.line-ending = "auto"
# no documentation linting for test files
format.skip-magic-trailing-comma = false
lint.extend-select = [
  "A",   # built-in shadowing
  "C4",  # comprehension
  "COM", # flake8-commas
  "D",   # pydocstyle
  "ERA", # commented-out code
  "F",   # pyflakes
  "G",   # logging
  "I",   # isort
  "ICN", # import name conventions
  "ISC", # implicit string concat rules
  "N",   # pep8 naming
  "NPY", # numpy
  "PT",  # pytest
  "PTH", # use pathlib
  "RET", # return statements
  "RUF", # ruff
  "UP",  # pyupgrade
]
lint.ignore = [
  "COM812", # incompatible with ruff format
  "D208",   # over-indentation (incompatible with sphinx)
  "D214",   # section-not-over-indented
  "D215",   # section-underline-not-over-indented
  "G004",   # Logging statement uses f-string
  "ISC001", # incompatible with ruff format
  "PTH123", # open("foo") should be replaced by Path("foo").open()
  "RUF012", #  Mutable class attributes should be annotated
]

lint.pydocstyle.convention = "numpy"

[tool.ruff.lint.per-file-ignores]
"tests/**.py" = ["D103"]

[tool.codespell]
ignore-words-list = "chec,arrang,livetime"

[tool.pytest.ini_options]
minversion = "6.0"
norecursedirs = [
  "build",
  "docs/_build",
]
addopts = [
  "-v",
  "--cov=eventdisplay_ml",
  "--cov-report=html",
  "--cov-report=term",
  "--cov-report=term-missing",
]

testpaths = "tests/unit_tests/"
filterwarnings = [
  # treat warnings as errors
  "error",
  # Ignore the warning about fontTools.misc.py23
  "ignore:The py23 module has been deprecated:DeprecationWarning",
]

[tool.coverage.report]
exclude_also = [
  "if __name__ == \"__main__\":",
]

[tool.coverage.run]
omit = [ "src/eventdisplay_ml/_version.py", "*__init__*", "src/eventdisplay_ml/applications/**" ]
relative_files = true

[tool.towncrier]
package = "eventdisplay_ml"
directory = "docs/changes"
filename = "CHANGELOG.md"
underlines = [ "", "", "" ]
title_format = "## [{version}](https://github.com/Eventdisplay/Eventdisplay-ML/releases/tag/{version}) - {project_date}"
issue_format = "[#{issue}](https://github.com/Eventdisplay/Eventdisplay-ML/pull/{issue})"
start_string = "<!-- towncrier release notes start -->\n"

[tool.towncrier.fragment.feature]
name = "New Features"
showcontent = true

[tool.towncrier.fragment.bugfix]
name = "Bugfixes"
showcontent = true

[tool.towncrier.fragment.api]
name = "API Changes"
showcontent = true

[tool.towncrier.fragment.maintenance]
name = "Maintenance"
showcontent = true

[tool.towncrier.fragment.doc]
name = "Documentation"
showcontent = true
