version: 1
slos:
  - name: sse_availability
    service: soul_engine_sse
    description: "SSE stream availability (Healthy status)"
    target: 0.995
    window: 30d
    pillar: "孝"
    sli:
      # afo_sse_connection_status{status="healthy"}: 1 if healthy, 0 otherwise
      promql: "avg_over_time(afo_sse_connection_status{status='healthy'}[30d])"

  - name: api_success_rate
    service: soul_engine_api
    description: "HTTP 2xx/3xx success rate"
    target: 0.999
    window: 30d
    pillar: "眞"
    sli:
      promql: |
        sum(rate(afo_http_requests_total{status_code=~"2..|3.."}[30d])) / 
        sum(rate(afo_http_requests_total[30d]))

  - name: api_p95_latency
    service: soul_engine_api
    description: "p95 Latency under 2 seconds"
    target: 0.95
    window: 30d
    pillar: "孝"
    sli:
      promql: |
        histogram_quantile(0.95, 
          sum(rate(afo_http_request_duration_seconds_bucket[30d])) by (le)
        ) < 2
