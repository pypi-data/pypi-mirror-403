# HyoDo Architecture

> "세종대왕의 정신: 장영실의 정밀한 설계"

## 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                     사용자 (Commander)                           │
└─────────────────────────┬───────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────┐
│                   Claude Code CLI                                │
│                 (Plugin: HyoDo v3.0.0)                          │
└─────────────────────────┬───────────────────────────────────────┘
                          │
          ┌───────────────┼───────────────┐
          │               │               │
          ▼               ▼               ▼
┌─────────────┐   ┌─────────────┐   ┌─────────────┐
│  Commands   │   │   Agents    │   │    Hooks    │
│   (13개)    │   │   (3개)     │   │   (5개)     │
└──────┬──────┘   └──────┬──────┘   └──────┬──────┘
       │                 │                 │
       └─────────────────┼─────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Chancellor V3                                 │
│              (CostAwareRouter + KeyTriggerRouter)               │
└─────────────────────────┬───────────────────────────────────────┘
                          │
    ┌─────────────────────┼─────────────────────┐
    │                     │                     │
    ▼                     ▼                     ▼
┌─────────┐         ┌─────────┐         ┌─────────┐
│ 장영실  │         │ 이순신  │         │신사임당 │
│ 眞 Sword│         │善 Shield│         │美 Bridge│
│   ⚔️    │         │   🛡️    │         │   🌉    │
└────┬────┘         └────┬────┘         └────┬────┘
     │                   │                   │
     └───────────────────┼───────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                    오호대장군 (五虎大將軍)                        │
│                    Ollama 기반 FREE 티어                         │
└─────────────────────────────────────────────────────────────────┘
     │         │         │         │         │
     ▼         ▼         ▼         ▼         ▼
┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐
│ 관우  │ │ 장비  │ │ 조운  │ │ 마초  │ │ 황충  │
│코드   │ │버그   │ │테스트 │ │코드   │ │ UI   │
│리뷰   │ │추적   │ │생성   │ │생성   │ │분석   │
└───────┘ └───────┘ └───────┘ └───────┘ └───────┘
```

---

## 계층 구조

### 1. 명령 계층 (Command Layer)

```
commands/
├── trinity.md          # Trinity Score 계산
├── strategist.md       # 3 전략가 분석
├── ultrawork.md        # 병렬 실행
├── chancellor-v3.md    # V3 라우팅
├── organs.md           # 11장기 헬스체크
├── cost-estimate.md    # 비용 예측
├── routing.md          # 트리거 분석
├── multiplatform.md    # 멀티플랫폼
├── check.md            # 4-Gate CI
├── preflight.md        # Pre-commit
├── evidence.md         # 증거 기록
├── rollback.md         # 롤백
└── ssot.md             # SSOT
```

### 2. 에이전트 계층 (Agent Layer)

```
agents/
├── trinity-guardian.md   # Trinity Score 모니터링
├── quality-gate.md       # 4-Gate CI 자동화
└── ollama-debugger.md    # 오호대장군 디버깅
```

### 3. 훅 계층 (Hook Layer)

```
hooks/
├── pre_tool/
│   ├── cost_check.md     # 비용 티어 체크
│   └── safety_gate.md    # 이순신 안전 게이트
├── post_tool/
│   ├── evidence_log.md   # 증거 기록
│   └── metrics_emit.md   # 메트릭 수집
└── on_error/
    └── ollama_debug.md   # 자동 디버깅
```

---

## 데이터 흐름

```
┌──────────────┐
│ User Input   │
└──────┬───────┘
       │
       ▼
┌──────────────┐    ┌──────────────┐
│ cost_check   │───▶│ safety_gate  │
│   (훅)       │    │    (훅)      │
└──────┬───────┘    └──────┬───────┘
       │                   │
       ▼                   ▼
┌──────────────────────────────────┐
│         KeyTriggerRouter          │
│    (眞善美 키워드 분석)            │
└──────────────┬───────────────────┘
               │
       ┌───────┼───────┐
       ▼       ▼       ▼
    ┌─────┐ ┌─────┐ ┌─────┐
    │ 眞  │ │ 善  │ │ 美  │
    └──┬──┘ └──┬──┘ └──┬──┘
       │       │       │
       └───────┼───────┘
               │
               ▼
┌──────────────────────────────────┐
│         CostAwareRouter           │
│    (FREE → CHEAP → EXPENSIVE)    │
└──────────────┬───────────────────┘
               │
               ▼
┌──────────────────────────────────┐
│         오호대장군 (실행)          │
└──────────────┬───────────────────┘
               │
       ┌───────┴───────┐
       ▼               ▼
┌──────────────┐ ┌──────────────┐
│ evidence_log │ │ metrics_emit │
│    (훅)      │ │    (훅)      │
└──────────────┘ └──────────────┘
```

---

## 비용 최적화 아키텍처

```
┌────────────────────────────────────────────┐
│              Cost Tier Routing              │
├────────────────────────────────────────────┤
│                                            │
│  ┌────────────────────────────────────┐   │
│  │          FREE ($0.00/1k)            │   │
│  │  ┌────────────────────────────┐    │   │
│  │  │        Ollama 로컬          │    │   │
│  │  │  qwen3, deepseek-r1, etc   │    │   │
│  │  └────────────────────────────┘    │   │
│  │  트리거: debug, test, lint, fix    │   │
│  └────────────────────────────────────┘   │
│                    │                       │
│                    ▼ (복잡도 > 3)          │
│  ┌────────────────────────────────────┐   │
│  │        CHEAP ($0.00025/1k)         │   │
│  │  ┌────────────────────────────┐    │   │
│  │  │      Claude Haiku 4.5      │    │   │
│  │  └────────────────────────────┘    │   │
│  │  트리거: implement, refactor       │   │
│  └────────────────────────────────────┘   │
│                    │                       │
│                    ▼ (복잡도 > 7)          │
│  ┌────────────────────────────────────┐   │
│  │       EXPENSIVE ($0.015/1k)        │   │
│  │  ┌────────────────────────────┐    │   │
│  │  │      Claude Opus 4.5       │    │   │
│  │  └────────────────────────────┘    │   │
│  │  트리거: architect, design         │   │
│  └────────────────────────────────────┘   │
│                                            │
└────────────────────────────────────────────┘

예상 절감률: 50-70%
```

---

## Trinity Score 계산

```
Trinity Score = (眞 × 0.35) + (善 × 0.35) + (美 × 0.20) + (孝 × 0.08) + (永 × 0.02)

┌─────────────────────────────────────────┐
│            Trinity Score 게이트          │
├─────────────────────────────────────────┤
│                                         │
│  Score >= 90 AND Risk <= 10             │
│  ───────────────────────────            │
│  ✅ AUTO_RUN (자동 실행)                 │
│                                         │
│  Score 70-89 OR Risk 11-30              │
│  ───────────────────────────            │
│  ⚠️ ASK_COMMANDER (승인 요청)            │
│                                         │
│  Score < 70 OR Risk > 30                │
│  ───────────────────────────            │
│  ❌ BLOCK (차단)                         │
│                                         │
└─────────────────────────────────────────┘
```

---

## 파일 구조

```
HyoDo/
├── .claude-plugin/
│   └── plugin.json           # 플러그인 메타데이터
├── commands/                 # 13 슬래시 커맨드
├── agents/                   # 3 자율 에이전트
├── hooks/                    # 5 훅
├── skills/                   # 4 스킬 모듈
├── docs/
│   └── ARCHITECTURE.md       # 이 문서
├── README.md
├── QUICK_START.md
├── CONTRIBUTING.md
├── CHANGELOG.md
├── SECURITY.md
├── ROADMAP.md
├── MIGRATION.md
├── LICENSE
├── VERSION
├── .env.example
├── .pre-commit-config.yaml
└── .gitignore
```

---

## 관련 문서

- [README.md](../README.md) - 전체 개요
- [QUICK_START.md](../QUICK_START.md) - 빠른 시작
- [CONTRIBUTING.md](../CONTRIBUTING.md) - 기여 가이드

---

*"장영실의 정밀함: 측우기처럼 정확한 아키텍처"*
