# rulelift - ä¿¡ç”¨é£é™©è§„åˆ™æœ‰æ•ˆæ€§åˆ†æå·¥å…·

## é¡¹ç›®æ¦‚è¿°

rulelift æ˜¯ä¸€ä¸ªç”¨äºä¿¡ç”¨é£é™©ç®¡ç†ä¸­ç­–ç•¥è§„åˆ™è‡ªåŠ¨æŒ–æ˜ã€æœ‰æ•ˆæ€§åˆ†æåŠç›‘æ§çš„ Python å·¥å…·åŒ…ã€‚

- **å®æ—¶è¯„ä¼°ç›‘æ§ä¸Šçº¿è§„åˆ™çš„æ•ˆåº¦**ï¼šè§£å†³è§„åˆ™æ‹¦æˆªæ ·æœ¬æ— æ ‡ç­¾çš„é—®é¢˜ï¼Œå€ŸåŠ©å®¢æˆ·è¯„çº§åˆ†å¸ƒå·®å¼‚ï¼Œå®æ—¶è¯„ä¼°é€¾æœŸç‡ã€å¬å›ç‡ã€ç²¾ç¡®ç‡ã€lift å€¼ã€ç›¸å…³æ€§ã€è§„åˆ™é—´çš„å¢ç›Šã€ç¨³å®šæ€§ç­‰æ ¸å¿ƒæŒ‡æ ‡
- **è‡ªåŠ¨åŒ–æŒ–æ˜é«˜ä»·å€¼çš„è§„åˆ™**ï¼šè‡ªåŠ¨ä»æ•°æ®ä¸­æŒ–æ˜æœ‰æ•ˆçš„é£æ§è§„åˆ™ï¼Œæ”¯æŒå•ç‰¹å¾ã€å¤šç‰¹å¾äº¤å‰ã€å†³ç­–æ ‘ã€éšæœºæ£®æ—ã€GBDTã€å­¤ç«‹æ£®æ—ç­‰å¤šç§è§„åˆ™æŒ–æ˜æ–¹æ³•
- **å¯è§†åŒ–å±•ç¤º**ï¼šç›´è§‚å‘ˆç°å˜é‡åˆ†å¸ƒã€å˜é‡æ•ˆåº¦ã€è§„åˆ™æ•ˆæœã€ç‰¹å¾é‡è¦æ€§ã€å†³ç­–æ ‘ç»“æ„å’Œè§„åˆ™å…³ç³»
- **æˆæœ¬æ•ˆç›Šé«˜**ï¼šæ— éœ€åˆ†æµæµ‹è¯•ï¼ŒåŸºäºè§„åˆ™å‘½ä¸­ç”¨æˆ·è®°å½•å³å¯è¯„ä¼°è§„åˆ™æ•ˆæœï¼Œé™ä½æµ‹è¯•æˆæœ¬

å®ƒå¸®åŠ©é£æ§å›¢é˜Ÿè¯„ä¼°ä¼˜åŒ–è§„åˆ™çš„å®é™…æ•ˆæœï¼Œè¯†åˆ«å†—ä½™è§„åˆ™ï¼Œè‡ªåŠ¨æŒ–æ˜æœ‰æ•ˆè§„åˆ™ï¼Œä¾¿äºç­–ç•¥Dç±»ã€Aç±»çš„å…¨é¢ä¼˜åŒ–ï¼Œæé«˜é£é™©æ§åˆ¶èƒ½åŠ›ï¼Œé™ä½é£æ§æˆæœ¬ã€‚

## ğŸ“Š é¡¹ç›®ç»Ÿè®¡


### PyPI Downloads
[![PyPI downloads](https://img.shields.io/pypi/dm/rulelift.svg)](https://pypistats.org/packages/rulelift)
[![PyPI version](https://img.shields.io/pypi/v/rulelift.svg)](https://pypi.org/project/rulelift/)



### Star History
[![Star History Chart](https://api.star-history.com/svg?repos=aialgorithm/rulelift&type=Date)](https://star-history.com/#aialgorithm/rulelift&Date)

## ğŸ“š ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [å®Œæ•´çš„å®‰è£…ä½¿ç”¨æ–¹æ³•](#å®Œæ•´çš„å®‰è£…ä½¿ç”¨æ–¹æ³•)
  - [ä½¿ç”¨ pip å®‰è£…](#ä½¿ç”¨-pip-å®‰è£…)
  - [ä»æºç å®‰è£…](#ä»æºç å®‰è£…)
  - [ç¦»çº¿ä½¿ç”¨æ–¹å¼ï¼ˆè€ƒè™‘ç”Ÿäº§ç¯å¢ƒæ˜¯æ— ç½‘ï¼‰](#ç¦»çº¿ä½¿ç”¨æ–¹å¼è€ƒè™‘ç”Ÿäº§ç¯å¢ƒæ˜¯æ— ç½‘)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
  - [1. åŸºæœ¬å¯¼å…¥](#1-åŸºæœ¬å¯¼å…¥)
  - [2. åŠ è½½ç¤ºä¾‹æ•°æ®](#2-åŠ è½½ç¤ºä¾‹æ•°æ®)
  - [3. è§„åˆ™æŒ–æ˜åŸºç¡€æ¡ˆä¾‹](#3-è§„åˆ™æŒ–æ˜åŸºç¡€æ¡ˆä¾‹)
    - [3.1 å•ç‰¹å¾è§„åˆ™æŒ–æ˜](#31-å•ç‰¹å¾è§„åˆ™æŒ–æ˜)
    - [3.2 å¤šç‰¹å¾äº¤å‰è§„åˆ™æŒ–æ˜](#32-å¤šç‰¹å¾äº¤å‰è§„åˆ™æŒ–æ˜)
    - [3.3 æ ‘æ¨¡å‹è§„åˆ™æŒ–æ˜](#33-æ ‘æ¨¡å‹è§„åˆ™æŒ–æ˜)
    - [3.4 å¤šç‰¹å¾äº¤å‰è§„åˆ™æŒ–æ˜ï¼ˆåŒ…å«æŸå¤±ç‡æŒ‡æ ‡ï¼‰](#34-å¤šç‰¹å¾äº¤å‰è§„åˆ™æŒ–æ˜åŒ…å«æŸå¤±ç‡æŒ‡æ ‡)
  - [4. è§„åˆ™è¯„ä¼°åŸºç¡€æ¡ˆä¾‹](#4-è§„åˆ™è¯„ä¼°åŸºç¡€æ¡ˆä¾‹)
    - [4.1 è§„åˆ™æ•ˆåº¦è¯„ä¼°](#41-è§„åˆ™æ•ˆåº¦è¯„ä¼°)
    - [4.2 è§„åˆ™ç›¸å…³æ€§åˆ†æ](#42-è§„åˆ™ç›¸å…³æ€§åˆ†æ)
    - [4.3 ç­–ç•¥å¢ç›Šè®¡ç®—](#43-ç­–ç•¥å¢ç›Šè®¡ç®—)
  - [5. å˜é‡åˆ†æåŸºç¡€æ¡ˆä¾‹](#5-å˜é‡åˆ†æåŸºç¡€æ¡ˆä¾‹)
- [æ ¸å¿ƒåŠŸèƒ½è¯¦è§£](#æ ¸å¿ƒåŠŸèƒ½è¯¦è§£)
  - [1. æ ‘è§„åˆ™æå–ï¼ˆTreeRuleExtractorï¼‰](#1-æ ‘è§„åˆ™æå–treeruleextractor)
  - [2. å•ç‰¹å¾è§„åˆ™æŒ–æ˜ï¼ˆSingleFeatureRuleMinerï¼‰](#2-å•ç‰¹å¾è§„åˆ™æŒ–æ˜singlefeatureminerï¼‰
  - [3. å¤šç‰¹å¾äº¤å‰è§„åˆ™æŒ–æ˜ï¼ˆMultiFeatureRuleMinerï¼‰](#3-å¤šç‰¹å¾äº¤å‰è§„åˆ™æŒ–æ˜multifeaturerulerminer)
  - [4. å˜é‡åˆ†æï¼ˆVariableAnalyzerï¼‰](#4-å˜é‡åˆ†ævariableanalyzer)
  - [5. è§„åˆ™æ•ˆåº¦åˆ†æç›‘æ§æ¨¡å—ï¼ˆanalyze_rulesï¼‰](#5-è§„åˆ™æ•ˆåº¦åˆ†æç›‘æ§æ¨¡å—analyze_rules)
  - [6. ç­–ç•¥ç›¸å…³æ€§ã€å¢ç›Šè®¡ç®—ï¼ˆcalculate_strategy_gainï¼‰](#6-ç­–ç•¥ç›¸å…³æ€§å¢ç›Šè®¡ç®—calculate_strategy_gain)
- [æ ¸å¿ƒæŒ‡æ ‡è¯´æ˜](#æ ¸å¿ƒæŒ‡æ ‡è¯´æ˜)
  - [è§„åˆ™è¯„ä¼°æŒ‡æ ‡](#è§„åˆ™è¯„ä¼°æŒ‡æ ‡)
  - [å˜é‡åˆ†ææŒ‡æ ‡](#å˜é‡åˆ†ææŒ‡æ ‡)
  - [å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰](#å¸¸è§é—®é¢˜faq)
  - [ç‰ˆæœ¬ä¿¡æ¯](#ç‰ˆæœ¬ä¿¡æ¯)
  - [æ›´æ–°æ—¥å¿—](#æ›´æ–°æ—¥å¿—)
  - [è®¸å¯è¯](#è®¸å¯è¯)
  - [é¡¹ç›®åœ°å€](#é¡¹ç›®åœ°å€)
  - [è”ç³»æ–¹å¼](#è”ç³»æ–¹å¼)
  - [è´¡çŒ®æŒ‡å—](#è´¡çŒ®æŒ‡å—)
## ğŸ“¦ é¡¹ç›®ä¾èµ–åŒ…

### æ ¸å¿ƒä¾èµ–
é¡¹ç›®ä¾èµ–é¡¹ç²¾ç®€ï¼Œå…¼å®¹æ€§è‰¯å¥½ï¼Œä»…éœ€è¦å¸¸è§çš„ä¾èµ–åŒ…
| ä¾èµ–åŒ… | ç‰ˆæœ¬è¦æ±‚ | ç”¨é€” |
|--------|----------|------|
| pandas | >=1.0.0,<2.4.0 | æ•°æ®å¤„ç†å’Œåˆ†æ |
| numpy | >=1.18.0,<2.5.0 | æ•°å€¼è®¡ç®— |
| scikit-learn | >=0.24.0,<1.9.0 | æœºå™¨å­¦ä¹ ç®—æ³• |
| matplotlib | >=3.3.0,<3.11.0 | åŸºç¡€å¯è§†åŒ– |
| seaborn | >=0.11.0,<0.14.0 | ç»Ÿè®¡å¯è§†åŒ– |
| openpyxl | >=3.0.0 | Excelæ–‡ä»¶è¯»å†™ |
## ğŸ¯ é¡¹ç›®åŠŸèƒ½æ¦‚è§ˆ

rulelift æä¾›äº†å®Œæ•´çš„è§„åˆ™æŒ–æ˜å’Œè¯„ä¼°è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼š

| åŠŸèƒ½æ¨¡å— | ä¸»è¦åŠŸèƒ½ | é€‚ç”¨åœºæ™¯ |
|---------|---------|---------|
| **è§„åˆ™æŒ–æ˜** | å•ç‰¹å¾è§„åˆ™æŒ–æ˜ã€å¤šç‰¹å¾äº¤å‰è§„åˆ™æŒ–æ˜ã€æ ‘æ¨¡å‹è§„åˆ™æŒ–æ˜ | ä»æ•°æ®ä¸­è‡ªåŠ¨æŒ–æ˜æœ‰æ•ˆçš„é£æ§è§„åˆ™ |
| **è§„åˆ™è¯„ä¼°** | è§„åˆ™æ•ˆåº¦è¯„ä¼°ã€è§„åˆ™ç›¸å…³æ€§åˆ†æã€ç­–ç•¥å¢ç›Šè®¡ç®— | è¯„ä¼°ä¸Šçº¿è§„åˆ™çš„å®é™…æ•ˆæœï¼Œè¯†åˆ«å†—ä½™è§„åˆ™ |
| **å˜é‡åˆ†æ** | å˜é‡æ•ˆåº¦åˆ†æã€åˆ†ç®±åˆ†æã€PSIè®¡ç®— | è¯†åˆ«é‡è¦å˜é‡ï¼Œä¼˜åŒ–ç‰¹å¾å·¥ç¨‹ |
| **å¯è§†åŒ–** | è§„åˆ™æ•ˆæœå¯è§†åŒ–ã€ç‰¹å¾é‡è¦æ€§å›¾ã€å†³ç­–æ ‘ç»“æ„å›¾ | ç›´è§‚å‘ˆç°åˆ†æç»“æœï¼Œä¾¿äºå†³ç­– |
| **æŸå¤±ç‡åˆ†æ** | æŸå¤±ç‡è®¡ç®—ã€æŸå¤±æå‡åº¦åˆ†æ | è¯„ä¼°è§„åˆ™çš„å®é™…æŸå¤±é£é™© |

### åŠŸèƒ½ç‰¹ç‚¹

âœ… **å…¨é¢çš„è§„åˆ™æŒ–æ˜**ï¼šæ”¯æŒ5ç§æ ‘æ¨¡å‹ç®—æ³•ï¼ˆDTã€RFã€CHI2ã€GBDTã€ISFï¼‰
âœ… **çµæ´»çš„è¯„ä¼°æ–¹å¼**ï¼šæ”¯æŒç”¨æˆ·è¯„çº§è¯„ä¼°å’Œç›®æ ‡æ ‡ç­¾è¯„ä¼°
âœ… **ä¸°å¯Œçš„æŒ‡æ ‡ä½“ç³»**ï¼šåŒ…å«badrateã€liftã€precisionã€recallã€F1ã€loss_rateã€loss_liftç­‰30+æŒ‡æ ‡
âœ… **ä¸šåŠ¡è§£é‡Šæ€§å¼º**ï¼šæ”¯æŒç‰¹å¾è¶‹åŠ¿é…ç½®ï¼Œé¿å…ä¸ç¬¦åˆä¸šåŠ¡é€»è¾‘çš„è§„åˆ™
âœ… **æŸå¤±ç‡æ”¯æŒ**ï¼šæ”¯æŒæŸå¤±ç‡å’ŒæŸå¤±æå‡åº¦è®¡ç®—ï¼Œå…¨é¢è¯„ä¼°é£é™©
âœ… **å¯è§†åŒ–å®Œå–„**ï¼šæä¾›çƒ­åŠ›å›¾ã€ç‰¹å¾é‡è¦æ€§å›¾ã€å†³ç­–æ ‘ç»“æ„å›¾ç­‰å¤šç§å¯è§†åŒ–
âœ… **æ˜“äºä½¿ç”¨**ï¼šæä¾›ç®€æ´çš„APIå’Œè¯¦ç»†çš„ç¤ºä¾‹ä»£ç 

---

## å®Œæ•´çš„å®‰è£…ä½¿ç”¨æ–¹æ³•

### ä½¿ç”¨ pip å®‰è£…ï¼ˆæ¨èï¼‰

```bash
pip install rulelift
```

### ä»æºç å®‰è£…

```bash
git clone https://github.com/aialgorithm/rulelift.git
cd rulelift
pip install -e .
```

## ç¦»çº¿ä½¿ç”¨æ–¹å¼ï¼ˆè€ƒè™‘ç”Ÿäº§ç¯å¢ƒæ˜¯æ— ç½‘ï¼‰

### æ–¹å¼ä¸€ï¼šç¦»çº¿å®‰è£…ruleliftåŠç›¸å…³ä¾èµ–

1. **åœ¨æœ‰ç½‘ç»œçš„ç¯å¢ƒä¸­ä¸‹è½½ä¾èµ–åŒ…**ï¼š

```bash
# ä¸‹è½½ruleliftåŠå…¶æ‰€æœ‰ä¾èµ–
pip download rulelift -d ./packages/
```

2. **å°†ä¸‹è½½çš„packagesæ–‡ä»¶å¤¹ä¼ è¾“åˆ°ç¦»çº¿ç¯å¢ƒ**

3. **åœ¨ç¦»çº¿ç¯å¢ƒä¸­å®‰è£…**ï¼š

```bash
# è¿›å…¥packagesæ–‡ä»¶å¤¹
cd ./packages/

# å®‰è£…æ‰€æœ‰ä¾èµ–åŒ…
pip install *.whl --no-index --find-links=.
```

### æ–¹å¼äºŒï¼šé€šè¿‡æºç ç›´æ¥è°ƒç”¨

1. **ä¸‹è½½æºç **ï¼š

   * ä»GitHubä¸‹è½½æºç åŒ…ï¼š<https://github.com/aialgorithm/rulelift>

2. **å°†æºç åŒ…ä¼ è¾“åˆ°ç¦»çº¿ç¯å¢ƒå¹¶è§£å‹**
éœ€è¦æ‰‹åŠ¨å®‰è£…pandasã€numpyã€scikit-learnã€matplotlibã€seaborn
3. **åœ¨Pythonä»£ç ä¸­æ·»åŠ æºç è·¯å¾„å¹¶å¯¼å…¥**ï¼š

```python
import sys
import os

# æ·»åŠ æºç è·¯å¾„åˆ°ç³»ç»Ÿè·¯å¾„
sys.path.append('/path/to/rulelift-master')

# ç›´æ¥å¯¼å…¥æ¨¡å—
from rulelift import load_example_data, analyze_rules, TreeRuleExtractor
```

## å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬å¯¼å…¥

```python
from rulelift import (
    load_example_data, preprocess_data,
    SingleFeatureRuleMiner, MultiFeatureRuleMiner, TreeRuleExtractor,
    VariableAnalyzer, analyze_rules, calculate_strategy_gain
)
```

### 2. åŠ è½½ç¤ºä¾‹æ•°æ®

```python
# åŠ è½½ç¤ºä¾‹æ•°æ®
df = load_example_data('feas_target.csv')
```

### 3. è§„åˆ™æŒ–æ˜åŸºç¡€æ¡ˆä¾‹


#### æ ‘æ¨¡å‹è§„åˆ™æŒ–æ˜

```python
from rulelift import TreeRuleExtractor

# åˆå§‹åŒ–æ ‘è§„åˆ™æå–å™¨
tree_miner = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'],
    algorithm='rf',  # ä½¿ç”¨éšæœºæ£®æ—ç®—æ³•
    max_depth=5,
    n_estimators=10,
    test_size=0.3,
    random_state=42
)

# è®­ç»ƒæ¨¡å‹
train_acc, test_acc = tree_miner.train()
print(f"è®­ç»ƒé›†å‡†ç¡®ç‡: {train_acc:.4f}")
print(f"æµ‹è¯•é›†å‡†ç¡®ç‡: {test_acc:.4f}")

# æå–è§„åˆ™
rules = tree_miner.extract_rules()
print(f"æå–çš„è§„åˆ™æ•°é‡: {len(rules)}")

# è·å–è§„åˆ™DataFrame
rules_df = tree_miner.get_rules_as_dataframe(sort_by_lift=True)
print(rules_df.head())
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
è®­ç»ƒé›†å‡†ç¡®ç‡: 0.8500
æµ‹è¯•é›†å‡†ç¡®ç‡: 0.8200
æå–çš„è§„åˆ™æ•°é‡: 31
         rule_id                                        rule  predicted_class  class_probability  sample_count
0             0  ALI_FQZSCORE <= 535.0000                1            0.6500           120
1             1  BAIDU_FQZSCORE <= 420.0000                1            0.5800            95
2             2  ALI_FQZSCORE <= 535.0000 AND BAIDU_FQZSCORE <= 420.0000  1            0.7200           80
```

### 4. è§„åˆ™è¯„ä¼°åŸºç¡€æ¡ˆä¾‹

#### è§„åˆ™æ•ˆåº¦è¯„ä¼°

```python
from rulelift import analyze_rules

# åŠ è½½è§„åˆ™å‘½ä¸­æ•°æ®
hit_rule_df = load_example_data('hit_rule_info.csv')

# é€šè¿‡ç”¨æˆ·è¯„çº§è¯„ä¼°è§„åˆ™æ•ˆåº¦
result_by_rating = analyze_rules(
    hit_rule_df, 
    rule_col='RULE',
    user_id_col='USER_ID',
    user_level_badrate_col='USER_LEVEL_BADRATE',
    hit_date_col='HIT_DATE',
    include_stability=True
)
print(result_by_rating[['RULE', 'actual_lift', 'actual_badrate', 'hit_rate_cv']].head())
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
         RULE  actual_lift  actual_badrate  hit_rate_cv
0  rule1     2.3456789      0.3456789     0.123456
1  rule2     2.123456      0.234567      0.145678
2  rule3     1.987654      0.123456      0.156789
```

### 5. å˜é‡åˆ†æåŸºç¡€æ¡ˆä¾‹

```python
from rulelift import VariableAnalyzer

# åˆå§‹åŒ–å˜é‡åˆ†æå™¨
var_analyzer = VariableAnalyzer(
    df, 
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'], 
    target_col='ISBAD'
)

# åˆ†ææ‰€æœ‰å˜é‡çš„æ•ˆåº¦æŒ‡æ ‡
var_metrics = var_analyzer.analyze_all_variables()
print("æ‰€æœ‰å˜é‡æ•ˆåº¦æŒ‡æ ‡:")
print(var_metrics)

# åˆ†æå•ä¸ªå˜é‡çš„åˆ†ç®±æƒ…å†µ
feature = 'ALI_FQZSCORE'
bin_analysis = var_analyzer.analyze_single_variable(feature, n_bins=10)
print(f"\n{feature} åˆ†ç®±åˆ†æ:")
print(bin_analysis)
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
æ‰€æœ‰å˜é‡æ•ˆåº¦æŒ‡æ ‡:
        variable        iv        ks        auc  missing_rate  single_value_rate  min_value  max_value  median_value  mean_diff  corr_with_target  psi
0  ALI_FQZSCORE  0.456789  0.452345  0.723456      0.012345      0.0456789      0.987654      0.723456      0.012345      0.456789      0.012345
1  BAIDU_FQZSCORE  0.3456789  0.3456789  0.678901      0.023456      0.056789      0.976543      0.678901      0.023456      0.3456789      0.023456

ALI_FQZSCORE åˆ†ç®±åˆ†æ:
        bin_range  count  bad_count  good_count  badrate  sample_ratio  cumulative_badrate
0  (514.999, 705.0]    120         78         42   0.6500        0.2400          0.6500
1  (705.0, 745.0]       95         55         40   0.5789        0.1900          0.6150
2  (745.0, 780.0]       80         45         35   0.5625        0.1600          0.5950
```

---

## æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. æ ‘è§„åˆ™æå–ï¼ˆTreeRuleExtractorï¼‰

TreeRuleExtractor æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„æ ‘æ¨¡å‹è§„åˆ™æå–ç±»ï¼Œæ”¯æŒå¤šç§ç®—æ³•ï¼ˆDTã€RFã€CHI2ã€GBDTã€ISFï¼‰ã€‚æ”¯æŒä¸šåŠ¡è§£é‡Šæ€§é…ç½®ã€æ”¯æŒæ ‘å¤æ‚åº¦åŠè§„åˆ™ç²¾åº¦é…ç½®ã€æ”¯æŒè¯„ä¼°è§„åˆ™å…¨é¢æ–¹é¢æŒ‡æ ‡badrateã€æŸå¤±ç‡æŒ‡æ ‡ç­‰ç­‰ã€‚

#### 1.1 æ”¯æŒçš„ç®—æ³•

| ç®—æ³• | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `dt` | å†³ç­–æ ‘ï¼ˆDecision Treeï¼‰ | å¿«é€Ÿç”Ÿæˆè§„åˆ™ï¼Œé€‚åˆåˆæ­¥æ¢ç´¢ |
| `rf` | éšæœºæ£®æ—ï¼ˆRandom Forestï¼‰ | è§„åˆ™ç¨³å®šæ€§å¥½ï¼Œå¤šæ ·æ€§é«˜ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ |
| `chi2` | å¡æ–¹éšæœºæ£®æ—ï¼ˆChi-square Random Forestï¼‰ | åŸºäºå¡æ–¹åˆ†ç®±é¢„å¤„ç†ï¼Œé€‚åˆéœ€è¦ç»Ÿè®¡æœ€ä¼˜åˆ†ç®±çš„åœºæ™¯ |
| `gbdt` | æ¢¯åº¦æå‡æ ‘ï¼ˆGradient Boosting Decision Treeï¼‰ | è§„åˆ™ç²¾åº¦é«˜ï¼Œé€‚åˆå¤æ‚åœºæ™¯ |
| `isf` | å­¤ç«‹æ£®æ—ï¼ˆIsolation Forestï¼‰ | é€‚åˆæŒ–æ˜å¼‚å¸¸æ ·æœ¬çš„è§„åˆ™ |

**å®è·µä¸Šå¯ä»¥ ä¼˜å…ˆä½¿ç”¨éšæœºæ£®æ—ã€GBDTç­‰é›†æˆå­¦ä¹ æ–¹æ³•ï¼Œé€šè¿‡è°ƒæ•´è¶…å‚æ•° n_estimatorsæ›´å¤§ max_featuresæ›´å°ä½¿å¾—æœ‰æ›´å¤šåŠæ›´å¤šæ ·è§„åˆ™ï¼Œmax_depthæ›´å°ã€min_samples_splitè¾ƒå¤§ï¼Œä½¿å¾—è§„åˆ™æ›´ç®€å•æ›´æœ‰è§£é‡Šæ€§åŠç»Ÿè®¡å¯ä¿¡åº¦ã€‚ä¼ å…¥ä¸šåŠ¡å­—æ®µï¼ˆfeature_trendsï¼‰æŒ–æ˜ç¬¦åˆä¸šåŠ¡è§£é‡Šæ€§è§„åˆ™ã€‚åŸºäºä»¥ä¸Šè®¾ç½®å¯ä»¥æŒ–æ˜å‡ºç¬¦åˆä¸šåŠ¡é€»è¾‘çš„å¤§é‡å¯é è§„åˆ™ä»¥ä¾›é€‰æ‹©**
#### 1.2 åˆå§‹åŒ–å‚æ•°è¯¦è§£

```python
from rulelift import TreeRuleExtractor

tree_miner = TreeRuleExtractor(
    df, 
    target_col='ISBAD',           # ç›®æ ‡å­—æ®µåï¼Œé»˜è®¤ä¸º'ISBAD'
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'],  # æ’é™¤çš„å­—æ®µååˆ—è¡¨
    algorithm='rf',                # ç®—æ³•ç±»å‹ï¼š'dt'ã€'rf'ã€'chi2'ã€'gbdt'ã€'isf'ï¼Œé»˜è®¤ä¸º'dt'
                                  # æ³¨æ„ï¼š'xgb'å·²åºŸå¼ƒï¼Œè¯·ä½¿ç”¨'gbdt'ï¼ˆå‘åå…¼å®¹ï¼‰
    
    # æ ‘å¤æ‚åº¦é…ç½®ï¼ˆæ§åˆ¶è§„åˆ™å¤æ‚åº¦ï¼‰
    max_depth=5,                  # å†³ç­–æ ‘æœ€å¤§æ·±åº¦ï¼Œæ§åˆ¶æ ‘çš„å¤æ‚åº¦ï¼Œå€¼è¶Šå°è§„åˆ™è¶Šç®€å•ï¼Œé»˜è®¤ä¸º5
    min_samples_split=10,         # åˆ†è£‚èŠ‚ç‚¹æ‰€éœ€çš„æœ€å°æ ·æœ¬æ•°ï¼Œæ§åˆ¶è§„åˆ™ç²¾åº¦ï¼Œå€¼è¶Šå¤§è§„åˆ™è¶Šç®€å•ï¼Œé»˜è®¤ä¸º10
    min_samples_leaf=5,           # å¶å­èŠ‚ç‚¹çš„æœ€å°æ ·æœ¬æ•°ï¼Œæ§åˆ¶è§„åˆ™ç²¾åº¦ï¼Œå€¼è¶Šå¤§è§„åˆ™è¶Šç®€å•ï¼Œé»˜è®¤ä¸º5
    n_estimators=10,              # éšæœºæ£®æ—/GBDT/å­¤ç«‹æ£®æ—ä¸­æ ‘çš„æ•°é‡ï¼Œå€¼è¶Šå¤§è§„åˆ™æ•°é‡è¶Šå¤šï¼Œé»˜è®¤ä¸º10
    max_features='sqrt',           # æ¯æ£µæ ‘åˆ†è£‚æ—¶è€ƒè™‘çš„æœ€å¤§ç‰¹å¾æ•°ï¼š'sqrt'æˆ–'log2'ï¼Œå½±å“è§„åˆ™å¤šæ ·æ€§ï¼Œé»˜è®¤ä¸º'sqrt'
    
    # å¡æ–¹å†³ç­–æ ‘åˆ†ç®±é…ç½®ï¼ˆä»…é€‚ç”¨äºchi2ç®—æ³•ï¼‰
    min_bins=5,                   # å¡æ–¹å†³ç­–æ ‘åˆ†ç®±çš„æœ€å°åˆ†ç®±æ•°ï¼Œé»˜è®¤ä¸º5
    chi_square_threshold=0.05,    # å¡æ–¹æ£€éªŒé˜ˆå€¼ï¼Œç”¨äºç¡®å®šåˆ†ç®±æ•°é‡ï¼Œå€¼è¶Šå°åˆ†ç®±è¶Šå¤šï¼Œé»˜è®¤ä¸º0.05
    
    # GBDTæ­£åˆ™åŒ–å‚æ•°ï¼ˆä»…é€‚ç”¨äºgbdtç®—æ³•ï¼‰
    learning_rate=0.1,           # å­¦ä¹ ç‡ï¼Œæ§åˆ¶æ¯æ£µæ ‘çš„è´¡çŒ®ï¼Œé»˜è®¤ä¸º0.1
    subsample=1.0,               # å­é‡‡æ ·æ¯”ä¾‹ï¼Œç”¨äºé˜²æ­¢è¿‡æ‹Ÿåˆï¼Œé»˜è®¤ä¸º1.0
    
    # æ•°æ®åˆ’åˆ†é…ç½®
    test_size=0.3,                # æµ‹è¯•é›†æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º0.3
    random_state=42,              # éšæœºç§å­ï¼Œä¿è¯ç»“æœå¯å¤ç°ï¼Œé»˜è®¤ä¸º42
    
    # æŸå¤±ç‡æŒ‡æ ‡é…ç½®
    amount_col='AMOUNT',          # é‡‘é¢å­—æ®µåï¼Œç”¨äºè®¡ç®—æŸå¤±ç‡æŒ‡æ ‡ï¼Œé»˜è®¤ä¸ºNone
    ovd_bal_col='OVD_BAL',        # é€¾æœŸé‡‘é¢å­—æ®µåï¼Œç”¨äºè®¡ç®—æŸå¤±ç‡æŒ‡æ ‡ï¼Œé»˜è®¤ä¸ºNone
    
    # ä¸šåŠ¡è§£é‡Šæ€§é…ç½®
    feature_trends={              # ç‰¹å¾ä¸ç›®æ ‡æ ‡ç­¾çš„æ­£è´Ÿç›¸å…³æ€§å­—å…¸ï¼Œç”¨äºé¿å…ä¸ç¬¦åˆä¸šåŠ¡è§£é‡Šæ€§çš„è§„åˆ™
        'ALI_FQZSCORE': -1,      # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
        'BAIDU_FQZSCORE': -1,    # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
        'NUMBER OF LOAN APPLICATIONS TO PBOC': 1  # æ­£ç›¸å…³ï¼šç”³è¯·æ¬¡æ•°è¶Šå¤šï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
    }
)

# è®­ç»ƒæ¨¡å‹
train_acc, test_acc = tree_miner.train()
print(f"è®­ç»ƒé›†å‡†ç¡®ç‡: {train_acc:.4f}")
print(f"æµ‹è¯•é›†å‡†ç¡®ç‡: {test_acc:.4f}")

# æå–è§„åˆ™
rules = tree_miner.extract_rules()
print(f"æå–çš„è§„åˆ™æ•°é‡: {len(rules)}")

# è·å–è§„åˆ™DataFrame
rules_df = tree_miner.get_rules_as_dataframe(deduplicate=True, sort_by_lift=True)
print(rules_df.head())
```

**å‚æ•°è¯¦ç»†è¯´æ˜**ï¼š

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ | å¯¹è§„åˆ™å¤æ‚åº¦çš„å½±å“ |
|------|------|----------|------|---------------------|
| `max_depth` | int | `5` | å†³ç­–æ ‘æœ€å¤§æ·±åº¦ | å€¼è¶Šå°è§„åˆ™è¶Šç®€å•ï¼Œå»ºè®®3-8 |
| `min_samples_split` | int | `10` | åˆ†è£‚èŠ‚ç‚¹æ‰€éœ€çš„æœ€å°æ ·æœ¬æ•° | å€¼è¶Šå¤§è§„åˆ™è¶Šç®€å•ï¼Œå»ºè®®5-20 |
| `min_samples_leaf` | int | `5` | å¶å­èŠ‚ç‚¹çš„æœ€å°æ ·æœ¬æ•° | å€¼è¶Šå¤§è§„åˆ™è¶Šç®€å•ï¼Œå»ºè®®5-15 |
| `n_estimators` | int | `10` | éšæœºæ£®æ—/GBDTä¸­æ ‘çš„æ•°é‡ | å€¼è¶Šå¤§è§„åˆ™æ•°é‡è¶Šå¤šï¼Œå»ºè®®50-500 |
| `max_features` | str | `'sqrt'` | æ¯æ£µæ ‘åˆ†è£‚æ—¶è€ƒè™‘çš„æœ€å¤§ç‰¹å¾æ•° | å½±å“è§„åˆ™å¤šæ ·æ€§ï¼Œ'sqrt'æˆ–'log2' |
| `min_bins` | int | `5` | å¡æ–¹å†³ç­–æ ‘åˆ†ç®±çš„æœ€å°åˆ†ç®±æ•° | ä»…é€‚ç”¨äºchi2ç®—æ³•ï¼Œå»ºè®®5-10 |
| `chi_square_threshold` | float | `0.05` | å¡æ–¹æ£€éªŒé˜ˆå€¼ | ä»…é€‚ç”¨äºchi2ç®—æ³•ï¼Œå€¼è¶Šå°åˆ†ç®±è¶Šå¤šï¼Œå»ºè®®0.01-0.05 |
| `min_bin_ratio` | float | `0.05` | å¡æ–¹åˆ†ç®±çš„æœ€å°æ ·æœ¬å æ¯” | ä»…é€‚ç”¨äºchi2ç®—æ³•ï¼Œæ§åˆ¶åˆ†ç®±çš„æœ€å°æ ·æœ¬æ•°ï¼Œå»ºè®®0.03-0.1 |

**å‚æ•°ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
# ä½¿ç”¨å¡æ–¹åˆ†ç®±ç®—æ³•
chi2_miner = TreeRuleExtractor(
    df, 
    target_col='ISBAD',
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'],
    algorithm='chi2',
    min_bin_ratio=0.05  # å¡æ–¹åˆ†ç®±çš„æœ€å°æ ·æœ¬å æ¯”
)
```

**æ§åˆ¶è§„åˆ™å¤æ‚åº¦çš„å‚æ•°è°ƒä¼˜å»ºè®®**ï¼š

1. **ç”Ÿæˆç®€å•è§„åˆ™**ï¼š
   - å¢åŠ  `max_depth`ï¼ˆå»ºè®®3-5ï¼‰
   - å¢åŠ  `min_samples_split`ï¼ˆå»ºè®®15-20ï¼‰
   - å¢åŠ  `min_samples_leaf`ï¼ˆå»ºè®®10-15ï¼‰

2. **ç”Ÿæˆå¤æ‚è§„åˆ™**ï¼š
   - å‡å° `max_depth`ï¼ˆå»ºè®®6-10ï¼‰
   - å‡å° `min_samples_split`ï¼ˆå»ºè®®5-10ï¼‰
   - å‡å° `min_samples_leaf`ï¼ˆå»ºè®®3-8ï¼‰

3. **æé«˜è§„åˆ™å¤šæ ·æ€§**ï¼š
   - å¢åŠ  `n_estimators`ï¼ˆå»ºè®®100-500ï¼‰
   - ä½¿ç”¨ `max_features='log2'` æˆ–æ‰‹åŠ¨è®¾ç½®è¾ƒå¤§å€¼

4. **å¹³è¡¡è§„åˆ™å¤æ‚åº¦å’Œæ³›åŒ–èƒ½åŠ›**ï¼š
   - `max_depth`ï¼š5-8
   - `min_samples_leaf`ï¼š5-10
   - `min_samples_split`ï¼š10-20

#### 1.3 ç‰¹å¾è¶‹åŠ¿åˆ¤æ–­ï¼ˆfeature_trendsï¼‰

è§„åˆ™æŒ–æ˜ä¸­åŠ å…¥ä¸šåŠ¡é€»è¾‘åˆ¤æ–­ï¼Œ`feature_trends` å‚æ•°ç”¨äºé…ç½®ç‰¹å¾ä¸ç›®æ ‡æ ‡ç­¾çš„æ­£è´Ÿç›¸å…³æ€§ï¼Œé¿å…ä¸ç¬¦åˆä¸šåŠ¡è§£é‡Šæ€§çš„è§„åˆ™ã€‚

**å‚æ•°è¯´æ˜**ï¼š
- `feature_trends`: Dict[str, int]ï¼Œé”®ä¸ºç‰¹å¾åï¼Œå€¼ä¸º 1ï¼ˆæ­£ç›¸å…³ï¼‰æˆ– -1ï¼ˆè´Ÿç›¸å…³ï¼‰ï¼Œä»…æŒ–æ˜ç¬¦åˆç‰¹å¾ä¸šåŠ¡é€»è¾‘çš„è§„åˆ™
  - **æ­£ç›¸å…³ï¼ˆå€¼ä¸º1ï¼‰**ï¼šè¡¨ç¤ºç‰¹å¾æ•°å€¼è¶Šå¤§ï¼Œç›®æ ‡æ ‡ç­¾ï¼ˆè¿çº¦æ¦‚ç‡ï¼‰è¶Šé«˜ï¼Œå¦‚å¤šå¤´ç”³è¯·æ¬¡æ•°
  - **è´Ÿç›¸å…³ï¼ˆå€¼ä¸º-1ï¼‰**ï¼šç‰¹å¾æ•°å€¼è¶Šå°ï¼Œç›®æ ‡æ ‡ç­¾ï¼ˆè¿çº¦æ¦‚ç‡ï¼‰è¶Šé«˜ï¼Œå¦‚ä¿¡ç”¨è¯„åˆ†

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```python
# ä½¿ç”¨ç‰¹å¾è¶‹åŠ¿è¿‡æ»¤
tree_miner = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME'],
    algorithm='rf',
    feature_trends={
        'ALI_FQZSCORE': -1,      # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
        'BAIDU_FQZSCORE': -1,    # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
        'NUMBER OF LOAN APPLICATIONS TO PBOC': 1  # æ­£ç›¸å…³ï¼šç”³è¯·æ¬¡æ•°è¶Šå¤šï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
    }
)

# æå–è§„åˆ™ï¼ˆä¼šè‡ªåŠ¨è¿‡æ»¤ä¸ç¬¦åˆä¸šåŠ¡è§£é‡Šæ€§çš„è§„åˆ™ï¼‰
rules = tree_miner.extract_rules()
```

**æ•ˆæœç¤ºä¾‹**ï¼š

ä¸ä½¿ç”¨ `feature_trends`ï¼š
```
Rule 1: BAIDU_FQZSCORE > 327.0000  # è¯¥æ‹¦æˆªè§„åˆ™ï¼Œå¯èƒ½ä¸ç¬¦åˆä¸šåŠ¡è§£é‡Šæ€§
Rule 2: NUMBER OF LOAN APPLICATIONS TO PBOC <= 5.0000  # è¯¥æ‹¦æˆªè§„åˆ™ï¼Œå¯èƒ½ä¸ç¬¦åˆä¸šåŠ¡è§£é‡Šæ€§
```

ä½¿ç”¨ `feature_trends`ï¼š
```
Rule 1: BAIDU_FQZSCORE <= 535.0000  # è´Ÿç›¸å…³ 
Rule 2: NUMBER OF LOAN APPLICATIONS TO PBOC > 2.0000  # æ­£ç›¸å…³ 
```

#### 1.5 è®­ç»ƒæ¨¡å‹

```python
# è®­ç»ƒæ¨¡å‹
train_acc, test_acc = tree_miner.train()
print(f"è®­ç»ƒé›†å‡†ç¡®ç‡: {train_acc:.4f}")
print(f"æµ‹è¯•é›†å‡†ç¡®ç‡: {test_acc:.4f}")
```

**è¿”å›å€¼è¯´æ˜**ï¼š
- å¯¹äº DTã€RFã€CHI2ã€GBDT ç®—æ³•ï¼šè¿”å› `(train_acc, test_acc)`ï¼Œåˆ†åˆ«ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„å‡†ç¡®ç‡
- å¯¹äº ISF ç®—æ³•ï¼šè¿”å› `(mean_score, std_score)`ï¼Œåˆ†åˆ«ä¸ºå¹³å‡å¼‚å¸¸åˆ†æ•°å’Œæ ‡å‡†å·®

#### 1.6 æå–è§„åˆ™

```python
# æå–è§„åˆ™
rules = tree_miner.extract_rules()
print(f"æå–çš„è§„åˆ™æ•°é‡: {len(rules)}")

# è·å–è§„åˆ™DataFrame
rules_df = tree_miner.get_rules_as_dataframe(deduplicate=True, sort_by_lift=True)
print(rules_df.head())
```

**å‚æ•°è¯´æ˜**ï¼š
- `deduplicate`: boolï¼Œæ˜¯å¦å»é‡ï¼Œé»˜è®¤ä¸ºFalse
- `sort_by_lift`: boolï¼Œæ˜¯å¦æŒ‰liftå€’åºæ’åºï¼Œé»˜è®¤ä¸ºFalse

#### 1.7 è§„åˆ™è¯„ä¼°

TreeRuleExtractor æä¾›äº†å…¨é¢çš„è§„åˆ™è¯„ä¼°åŠŸèƒ½ï¼Œæ”¯æŒè®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„æ•ˆåº¦è¯„ä¼°ï¼ŒåŒ…æ‹¬æŸå¤±ç‡è®¡ç®—ç­‰é«˜çº§æŒ‡æ ‡ã€‚

### 1.7.1 æŸå¤±ç‡è®¡ç®—ï¼ˆLoss Rateï¼‰

æŸå¤±ç‡æ˜¯è¯„ä¼°è§„åˆ™å®é™…é£é™©æŸå¤±çš„é‡è¦æŒ‡æ ‡ï¼Œéœ€è¦æä¾›é‡‘é¢å­—æ®µå’Œé€¾æœŸé‡‘é¢å­—æ®µã€‚

**è®¡ç®—é€»è¾‘**ï¼š
- **æŸå¤±ç‡ï¼ˆloss_rateï¼‰**ï¼šç‰¹å®šè§„åˆ™æˆ–ç‰¹å¾ç»„åˆä¸‹ï¼Œé€¾æœŸé‡‘é¢æ€»å’Œé™¤ä»¥æ€»é‡‘é¢æ€»å’Œ
  ```
  loss_rate = Î£(é€¾æœŸé‡‘é¢) / Î£(æ€»é‡‘é¢)
  ```
- **æŸå¤±æå‡åº¦ï¼ˆloss_liftï¼‰**ï¼šç‰¹å®šè§„åˆ™æˆ–ç‰¹å¾ç»„åˆçš„æŸå¤±ç‡é™¤ä»¥æ•´ä½“æ ·æœ¬çš„æŸå¤±ç‡
  ```
  loss_lift = è§„åˆ™æŸå¤±ç‡ / æ•´ä½“æŸå¤±ç‡
  ```

**ä¸šåŠ¡ä»·å€¼**ï¼š
- å¸®åŠ©é£æ§å›¢é˜Ÿè¯„ä¼°è§„åˆ™çš„å®é™…æŸå¤±é£é™©
- ç»“åˆbadrateå’ŒliftæŒ‡æ ‡ï¼Œæä¾›æ›´å…¨é¢çš„è§„åˆ™è¯„ä¼°
- ä¼˜å…ˆé€‰æ‹©é«˜loss_liftçš„è§„åˆ™ï¼Œé™ä½å®é™…æŸå¤±

**ä½¿ç”¨æ–¹å¼**ï¼š
```python
# åˆå§‹åŒ–æ—¶æŒ‡å®šé‡‘é¢å’Œé€¾æœŸé‡‘é¢å­—æ®µ
tree_miner = TreeRuleExtractor(
    df, 
    target_col='ISBAD',
    exclude_cols=['ID', 'CREATE_TIME'],
    amount_col='AMOUNT',      # æ€»é‡‘é¢å­—æ®µå
    ovd_bal_col='OVD_BAL'      # é€¾æœŸé‡‘é¢å­—æ®µå
)

# è®­ç»ƒå¹¶æå–è§„åˆ™
tree_miner.train()
rules = tree_miner.extract_rules()

# è¯„ä¼°è§„åˆ™ï¼ˆåŒ…å«æŸå¤±ç‡æŒ‡æ ‡ï¼‰
eval_results = tree_miner.evaluate_rules()

# æŸ¥çœ‹æŸå¤±ç‡æŒ‡æ ‡
print(eval_results[['rule', 'train_loss_rate', 'train_loss_lift', 'test_loss_rate', 'test_loss_lift']].head())
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
         rule  train_loss_rate  train_loss_lift  test_loss_rate  test_loss_lift
0  rule_1         0.3456789       2.3456789      0.234567       1.987654
1  rule_2         0.234567       1.987654      0.123456       1.876543
2  rule_3         0.123456       1.765432      0.098765       1.765432
```

**æŸå¤±ç‡æŒ‡æ ‡è§£è¯»**ï¼š
- **loss_rate > 0.3**ï¼šé«˜é£é™©è§„åˆ™ï¼Œå®é™…æŸå¤±è¾ƒé«˜
- **loss_rate 0.1-0.3**ï¼šä¸­ç­‰é£é™©è§„åˆ™
- **loss_rate < 0.1**ï¼šä½é£é™©è§„åˆ™ï¼Œå®é™…æŸå¤±è¾ƒä½
- **loss_lift > 2.0**ï¼šé«˜æ•ˆè§„åˆ™ï¼ŒæŸå¤±åŒºåˆ†èƒ½åŠ›å¼º
- **loss_lift 1.5-2.0**ï¼šè‰¯å¥½è§„åˆ™
- **loss_lift < 1.5**ï¼šå¼±è§„åˆ™ï¼Œå»ºè®®ä¼˜åŒ–

### 1.7.2 è§„åˆ™è¯„ä¼°æŒ‡æ ‡è¯¦è§£

```python
# è¯„ä¼°è§„åˆ™ï¼ˆåŒ…å«æŸå¤±ç‡æŒ‡æ ‡ï¼‰
eval_results = tree_miner.evaluate_rules()
print(f"è¯„ä¼°çš„è§„åˆ™æ•°é‡: {len(eval_results)}")
print("è§„åˆ™è¯„ä¼°ç»“æœï¼ˆå‰5æ¡ï¼‰:")
print(eval_results[['rule', 'train_loss_rate', 'train_loss_lift', 'test_loss_rate', 'test_loss_lift', 'train_lift', 'test_lift', 'test_badrate_reduction']].head())
```

**è¾“å‡ºç¤ºä¾‹**ï¼š

```
è¯„ä¼°çš„è§„åˆ™æ•°é‡: 31
è§„åˆ™è¯„ä¼°ç»“æœï¼ˆå‰5æ¡ï¼‰:
         rule  train_loss_rate  train_loss_lift  test_loss_rate  test_loss_lift  train_lift  test_lift  test_badrate_reduction
0  rule_1         0.3456789       2.3456789      0.234567       1.987654  2.123456      1.987654      0.4567
1  rule_2         0.234567       1.987654      0.123456       1.876543  1.654321      1.876543      0.3456
2  rule_3         0.123456       1.765432      0.098765       1.765432  1.543210      1.543210      0.2345
3  rule_4         0.098765       1.654321      0.076543       1.543210  1.432109      1.432109      0.1876
4  rule_5         0.076543       1.543210      0.065432       1.432109  1.321098      1.321098      0.1456
```

**æ ¸å¿ƒè¯„ä¼°æŒ‡æ ‡è¯´æ˜**ï¼š

| æŒ‡æ ‡ | è¯´æ˜ | è®¡ç®—å…¬å¼ | ä¸šåŠ¡æ„ä¹‰ |
|------|------|----------|----------|
| `train_hit_count` | è®­ç»ƒé›†å‘½ä¸­è¯¥è§„åˆ™çš„æ ·æœ¬æ•° | - | è§„åˆ™åœ¨è®­ç»ƒé›†çš„è¦†ç›–èŒƒå›´ |
| `train_bad_count` | è®­ç»ƒé›†å‘½ä¸­è¯¥è§„åˆ™çš„åæ ·æœ¬æ•° | - | è§„åˆ™åœ¨è®­ç»ƒé›†æ‹¦æˆªçš„åæ ·æœ¬æ•°é‡ |
| `train_badrate` | è®­ç»ƒé›†å‘½ä¸­è¯¥è§„åˆ™çš„åæ ·æœ¬ç‡ | train_bad_count / train_hit_count | è§„åˆ™åœ¨è®­ç»ƒé›†çš„é£é™©åŒºåˆ†èƒ½åŠ› |
| `train_precision` | è®­ç»ƒé›†ç²¾ç¡®ç‡ | train_bad_count / train_hit_count | è§„åˆ™åœ¨è®­ç»ƒé›†çš„é¢„æµ‹å‡†ç¡®æ€§ |
| `train_recall` | è®­ç»ƒé›†å¬å›ç‡ | train_bad_count / total_bad_train | è§„åˆ™åœ¨è®­ç»ƒé›†å¯¹åæ ·æœ¬çš„è¦†ç›–èƒ½åŠ› |
| `train_f1` | è®­ç»ƒé›†F1åˆ†æ•° | 2 * (precision * recall) / (precision + recall) | è®­ç»ƒé›†ç²¾ç¡®ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡ |
| `train_lift` | è®­ç»ƒé›†liftå€¼ | train_badrate / baseline_badrate_train | è§„åˆ™åœ¨è®­ç»ƒé›†çš„é£é™©æ”¾å¤§èƒ½åŠ› |
| `train_loss_rate` | è®­ç»ƒé›†æŸå¤±ç‡ | total_ovd_bal_bad_selected / total_amount_selected | è§„åˆ™åœ¨è®­ç»ƒé›†çš„å®é™…æŸå¤±ç¨‹åº¦ |
| `train_loss_lift` | è®­ç»ƒé›†æŸå¤±liftå€¼ | train_loss_rate / overall_loss_rate_train | è§„åˆ™åœ¨è®­ç»ƒé›†çš„æŸå¤±æ”¾å¤§èƒ½åŠ› |
| `train_hit_rate` | è®­ç»ƒé›†å‘½ä¸­ç‡ | train_hit_count / total_train_samples | è§„åˆ™åœ¨è®­ç»ƒé›†çš„è¦†ç›–ç‡ |
| `train_baseline_badrate` | è®­ç»ƒé›†åŸºå‡†badrate | total_bad_train / total_train_samples | è®­ç»ƒé›†æ•´ä½“é£é™©æ°´å¹³ |
| `train_badrate_after_interception` | è®­ç»ƒé›†æ‹¦æˆªåbadrate | (total_bad_train - train_bad_count) / (total_train_samples - train_hit_count) | è§„åˆ™æ‹¦æˆªåå‰©ä½™æ ·æœ¬çš„é£é™©æ°´å¹³ |
| `train_badrate_reduction` | è®­ç»ƒé›†badrateé™ä½å¹…åº¦ | (baseline_badrate_train - badrate_after_interception_train) / baseline_badrate_train / train_hit_rate | **ç­–ç•¥æ•ˆç‡æŒ‡æ ‡**ï¼šæ¯1%å‘½ä¸­ç‡å¸¦æ¥çš„badrateé™ä½å¹…åº¦ |
| `test_hit_count` | æµ‹è¯•é›†å‘½ä¸­è¯¥è§„åˆ™çš„æ ·æœ¬æ•° | - | è§„åˆ™åœ¨æµ‹è¯•é›†çš„è¦†ç›–èŒƒå›´ |
| `test_bad_count` | æµ‹è¯•é›†å‘½ä¸­è¯¥è§„åˆ™çš„åæ ·æœ¬æ•° | - | è§„åˆ™åœ¨æµ‹è¯•é›†æ‹¦æˆªçš„åæ ·æœ¬æ•°é‡ |
| `test_badrate` | æµ‹è¯•é›†å‘½ä¸­è¯¥è§„åˆ™çš„åæ ·æœ¬ç‡ | test_bad_count / test_hit_count | è§„åˆ™åœ¨æµ‹è¯•é›†çš„é£é™©åŒºåˆ†èƒ½åŠ› |
| `test_precision` | æµ‹è¯•é›†ç²¾ç¡®ç‡ | test_bad_count / test_hit_count | è§„åˆ™åœ¨æµ‹è¯•é›†çš„é¢„æµ‹å‡†ç¡®æ€§ |
| `test_recall` | æµ‹è¯•é›†å¬å›ç‡ | test_bad_count / total_bad_test | è§„åˆ™åœ¨æµ‹è¯•é›†å¯¹åæ ·æœ¬çš„è¦†ç›–èƒ½åŠ› |
| `test_f1` | æµ‹è¯•é›†F1åˆ†æ•° | 2 * (precision * recall) / (precision + recall) | æµ‹è¯•é›†ç²¾ç¡®ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡ |
| `test_lift` | æµ‹è¯•é›†liftå€¼ | test_badrate / baseline_badrate_test | è§„åˆ™åœ¨æµ‹è¯•é›†çš„é£é™©æ”¾å¤§èƒ½åŠ› |
| `test_loss_rate` | æµ‹è¯•é›†æŸå¤±ç‡ | total_ovd_bal_bad_selected / total_amount_selected | è§„åˆ™åœ¨æµ‹è¯•é›†çš„å®é™…æŸå¤±ç¨‹åº¦ |
| `test_loss_lift` | æµ‹è¯•é›†æŸå¤±liftå€¼ | test_loss_rate / overall_loss_rate_test | è§„åˆ™åœ¨æµ‹è¯•é›†çš„æŸå¤±æ”¾å¤§èƒ½åŠ› |
| `test_hit_rate` | æµ‹è¯•é›†å‘½ä¸­ç‡ | test_hit_count / total_test_samples | è§„åˆ™åœ¨æµ‹è¯•é›†çš„è¦†ç›–ç‡ |
| `test_baseline_badrate` | æµ‹è¯•é›†åŸºå‡†badrate | total_bad_test / total_test_samples | æµ‹è¯•é›†æ•´ä½“é£é™©æ°´å¹³ |
| `test_badrate_after_interception` | æµ‹è¯•é›†æ‹¦æˆªåbadrate | (total_bad_test - test_bad_count) / (total_test_samples - test_hit_count) | è§„åˆ™æ‹¦æˆªåå‰©ä½™æ ·æœ¬çš„é£é™©æ°´å¹³ |
| `test_badrate_reduction` | æµ‹è¯•é›†badrateé™ä½å¹…åº¦ | (baseline_badrate_test - badrate_after_interception_test) / baseline_badrate_test / test_hit_rate | **ç­–ç•¥æ•ˆç‡æ ¸å¿ƒæŒ‡æ ‡**ï¼šæ¯1%å‘½ä¸­ç‡å¸¦æ¥çš„badrateé™ä½å¹…åº¦ï¼Œå€¼è¶Šå¤§ç­–ç•¥æ•ˆç‡è¶Šé«˜ |
| `badrate_diff` | è®­ç»ƒé›†å’Œæµ‹è¯•é›†liftçš„å·®å¼‚ | train_lift - test_lift | è§„åˆ™çš„æ³›åŒ–èƒ½åŠ›ï¼Œå€¼è¶Šå°æ³›åŒ–èƒ½åŠ›è¶Šå¼º |
| `true_positive` | çœŸé˜³æ€§ï¼ˆTPï¼‰ | test_bad_count | è¢«æ­£ç¡®æ‹¦æˆªçš„åæ ·æœ¬æ•° |
| `false_positive` | å‡é˜³æ€§ï¼ˆFPï¼‰ | test_good_count | è¢«é”™è¯¯æ‹¦æˆªçš„å¥½æ ·æœ¬æ•° |
| `true_negative` | çœŸé˜´æ€§ï¼ˆTNï¼‰ | æœªå‘½ä¸­ä¸”ä¸ºå¥½æ ·æœ¬çš„æ•°é‡ | æœªè¢«æ‹¦æˆªçš„å¥½æ ·æœ¬æ•° |
| `false_negative` | å‡é˜´æ€§ï¼ˆFNï¼‰ | æœªå‘½ä¸­ä¸”ä¸ºåæ ·æœ¬çš„æ•°é‡ | æœªè¢«æ‹¦æˆªçš„åæ ·æœ¬æ•° |

### 1.7.3 ç­–ç•¥æ•ˆç‡æŒ‡æ ‡ï¼ˆtest_badrate_reductionï¼‰

**test_badrate_reduction** æ˜¯è¡¡é‡ç­–ç•¥æ•ˆç‡çš„æ ¸å¿ƒæŒ‡æ ‡ï¼Œè¡¨ç¤º**æ¯1%å‘½ä¸­ç‡å¸¦æ¥çš„badrateé™ä½å¹…åº¦**ã€‚

**è®¡ç®—é€»è¾‘**ï¼š
```
test_badrate_reduction = [(åŸºå‡†badrate - æ‹¦æˆªåbadrate) / åŸºå‡†badrate] / å‘½ä¸­ç‡
```

**ä¸šåŠ¡è§£è¯»**ï¼š
- **é«˜å€¼ï¼ˆ> 0.5ï¼‰**ï¼šé«˜æ•ˆç­–ç•¥ï¼Œå°‘é‡æ‹¦æˆªå³å¯æ˜¾è‘—é™ä½æ•´ä½“badrate
- **ä¸­å€¼ï¼ˆ0.2-0.5ï¼‰**ï¼šä¸­ç­‰æ•ˆç‡ç­–ç•¥
- **ä½å€¼ï¼ˆ< 0.2ï¼‰**ï¼šä½æ•ˆç­–ç•¥ï¼Œéœ€è¦å¤§é‡æ‹¦æˆªæ‰èƒ½é™ä½badrate

**åº”ç”¨åœºæ™¯**ï¼š
- æ¯”è¾ƒä¸åŒè§„åˆ™çš„æ•ˆç‡ï¼Œä¼˜å…ˆé€‰æ‹©é«˜badrate_reductionçš„è§„åˆ™
- ä¼˜åŒ–ç­–ç•¥ç»„åˆï¼Œå¹³è¡¡å‘½ä¸­ç‡å’Œbadrateé™ä½æ•ˆæœ
- è¯„ä¼°ç­–ç•¥è°ƒæ•´çš„æ•ˆæœï¼Œåˆ¤æ–­æ–°è§„åˆ™æ˜¯å¦æå‡äº†ç­–ç•¥æ•ˆç‡

### 1.7.4 è¯„ä¼°æŒ‡æ ‡ç»„åˆå»ºè®®

| ä¸šåŠ¡ç›®æ ‡ | æ¨èå…³æ³¨æŒ‡æ ‡ | æœ€ä½³èŒƒå›´ |
|----------|--------------|----------|
| é™ä½æ•´ä½“é£é™© | `test_lift` + `test_badrate_reduction` | lift > 2.0, badrate_reduction > 0.3 |
| é™ä½å®é™…æŸå¤± | `test_loss_lift` + `test_loss_rate` | loss_lift > 2.0, loss_rate < 0.1 |
| æé«˜è§„åˆ™æ³›åŒ–èƒ½åŠ› | `badrate_diff` + `test_lift` | badrate_diff < 0.5, test_lift > 1.5 |
| å¹³è¡¡ç²¾ç¡®ç‡å’Œå¬å›ç‡ | `test_f1` + `test_precision` | f1 > 0.5, precision > 0.6 |

**è¯„ä¼°è§„åˆ™ï¼ˆåŒ…å«æŸå¤±ç‡æŒ‡æ ‡ï¼‰**ï¼š

```python
# ç­›é€‰é«˜æ•ˆç­–ç•¥è§„åˆ™
high_efficiency_rules = eval_results[(
    eval_results['test_lift'] > 2.0 & 
    eval_results['test_badrate_reduction'] > 0.3 & 
    eval_results['test_loss_lift'] > 1.5
)]
print(f"é«˜æ•ˆç­–ç•¥è§„åˆ™æ•°é‡: {len(high_efficiency_rules)}")
```

#### 1.8 ä¸åŒç®—æ³•ä½¿ç”¨ç¤ºä¾‹

##### 1.8.1 å†³ç­–æ ‘ï¼ˆDTï¼‰

```python
# åˆå§‹åŒ–å†³ç­–æ ‘è§„åˆ™æå–å™¨
tree_miner_dt = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'],
    algorithm='dt',
    max_depth=3, 
    min_samples_split=20,
    min_samples_leaf=10,
    random_state=42
)

# è®­ç»ƒæ¨¡å‹
train_acc, test_acc = tree_miner_dt.train()
print(f"è®­ç»ƒé›†å‡†ç¡®ç‡: {train_acc:.4f}")
print(f"æµ‹è¯•é›†å‡†ç¡®ç‡: {test_acc:.4f}")

# æå–è§„åˆ™
dt_rules = tree_miner_dt.extract_rules()
print(f"æå–çš„è§„åˆ™æ•°é‡: {len(dt_rules)}")

# è¯„ä¼°è§„åˆ™
eval_results = tree_miner_dt.evaluate_rules()
print(eval_results[['rule', 'test_hit_count', 'test_badrate', 'test_lift']].head())
```

##### 1.8.2 éšæœºæ£®æ—ï¼ˆRFï¼‰

éšæœºæ£®æ—é€‚åˆæŒ–æ˜ç¨³å®šã€å¤šæ ·çš„è§„åˆ™ï¼Œé€šè¿‡æ§åˆ¶å‚æ•°å¯ä»¥ç”Ÿæˆå¤§é‡é«˜è´¨é‡è§„åˆ™ã€‚

**éšæœºæ£®æ—æé«˜è§„åˆ™å¤šæ ·æ€§çš„æ–¹æ³•**ï¼š
- **å¢åŠ æ ‘çš„æ•°é‡**ï¼šå¢åŠ n_estimatorså¯ä»¥ç”Ÿæˆæ›´å¤šè§„åˆ™
- **è°ƒæ•´max_features**ï¼šä½¿ç”¨max_features='log2'æˆ–æ‰‹åŠ¨è®¾ç½®è¾ƒå¤§å€¼ï¼Œæé«˜è§„åˆ™å¤šæ ·æ€§
- **å‡å°min_samples_leaf**ï¼šå‡å°å¶å­èŠ‚ç‚¹æ ·æœ¬æ•°é™åˆ¶ï¼Œç”Ÿæˆæ›´å¤šè§„åˆ™
- **å¢åŠ max_depth**ï¼šé€‚å½“å¢åŠ æ·±åº¦ï¼Œç”Ÿæˆæ›´å¤æ‚çš„è§„åˆ™

**å‚æ•°è°ƒä¼˜å»ºè®®**ï¼š
- **n_estimators**ï¼šå¢åŠ æ ‘çš„æ•°é‡å¯ä»¥ç”Ÿæˆæ›´å¤šè§„åˆ™ï¼Œå»ºè®®è®¾ç½®ä¸º100-500
- **max_depth**ï¼šæ§åˆ¶å•æ£µæ ‘çš„å¤æ‚åº¦ï¼Œå»ºè®®è®¾ç½®ä¸º5-10
- **max_features**ï¼šå¢åŠ è€ƒè™‘çš„ç‰¹å¾æ•°å¯ä»¥æé«˜è§„åˆ™å¤šæ ·æ€§ï¼Œå»ºè®®è®¾ç½®ä¸º'sqrt'æˆ–'log2'
- **min_samples_leaf**ï¼šå‡å°å¶å­èŠ‚ç‚¹æ ·æœ¬æ•°é™åˆ¶ï¼Œå»ºè®®è®¾ç½®ä¸º5-20

**ä¼˜åŒ–åéšæœºæ£®æ—ä½¿ç”¨ç¤ºä¾‹**ï¼š

```python
# åˆå§‹åŒ–éšæœºæ£®æ—è§„åˆ™æå–å™¨ï¼Œä¼˜åŒ–å‚æ•°ä»¥æŒ–æ˜æ›´å¤šè§„åˆ™
tree_miner_rf = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'],
    algorithm='rf',
    max_depth=8, 
    min_samples_split=10,  # å‡å°åˆ†è£‚æ ·æœ¬æ•°é™åˆ¶
    min_samples_leaf=5,    # å‡å°å¶å­èŠ‚ç‚¹æ ·æœ¬æ•°é™åˆ¶
    n_estimators=200,      # å¢åŠ æ ‘çš„æ•°é‡ï¼Œç”Ÿæˆæ›´å¤šè§„åˆ™
    max_features='log2',   # è€ƒè™‘æ›´å¤šç‰¹å¾ï¼Œæé«˜è§„åˆ™å¤šæ ·æ€§
    random_state=42
)

# è®­ç»ƒæ¨¡å‹
train_acc, test_acc = tree_miner_rf.train()
print(f"è®­ç»ƒé›†å‡†ç¡®ç‡: {train_acc:.4f}")
print(f"æµ‹è¯•é›†å‡†ç¡®ç‡: {test_acc:.4f}")

# æå–è§„åˆ™
rf_rules = tree_miner_rf.extract_rules()
print(f"æå–çš„è§„åˆ™æ•°é‡: {len(rf_rules)}")

# è¯„ä¼°è§„åˆ™
eval_results = tree_miner_rf.evaluate_rules()

# æŒ‰test_badrate_reductionæ’åºï¼Œç­›é€‰é«˜æ•ˆè§„åˆ™
eval_results_sorted = eval_results.sort_values(by='test_badrate_reduction', ascending=False)
print("Top 10 é«˜æ•ˆè§„åˆ™:")
print(eval_results_sorted[['rule', 'test_lift', 'test_badrate_reduction', 'test_loss_lift']].head(10))
```

**éšæœºæ£®æ—è§„åˆ™æŒ–æ˜æœ€ä½³å®è·µ**ï¼š
1. **ç”Ÿæˆå¤§é‡è§„åˆ™**ï¼šè®¾ç½®è¾ƒå¤§çš„n_estimatorså’Œè¾ƒå°çš„min_samples_leaf
2. **æ§åˆ¶è§„åˆ™å¤æ‚åº¦**ï¼šé€šè¿‡max_depthå¹³è¡¡è§„åˆ™å¤æ‚åº¦å’Œæ³›åŒ–èƒ½åŠ›
3. **æé«˜è§„åˆ™å¤šæ ·æ€§**ï¼šä½¿ç”¨max_features='log2'æˆ–æ‰‹åŠ¨è®¾ç½®è¾ƒå¤§å€¼
4. **ç­›é€‰é«˜æ•ˆè§„åˆ™**ï¼šæŒ‰test_badrate_reductionæˆ–test_liftæ’åºï¼Œé€‰æ‹©å‰Næ¡è§„åˆ™
5. **å»é‡å¤„ç†**ï¼šä½¿ç”¨get_rules_as_dataframe(deduplicate=True)å»é™¤é‡å¤è§„åˆ™

##### 1.8.3 å¡æ–¹éšæœºæ£®æ—ï¼ˆCHI2ï¼‰

å¡æ–¹éšæœºæ£®æ—é‡‡ç”¨**å¡æ–¹åˆ†ç®±é¢„å¤„ç† + éšæœºæ£®æ—**çš„æ–¹å¼å®ç°ï¼Œä¸éœ€è¦å¤æ‚çš„è‡ªå®šä¹‰å†³ç­–æ ‘åˆ†è£‚é€»è¾‘ã€‚

**å®ç°åŸç†**ï¼š
1. **å¡æ–¹åˆ†ç®±é¢„å¤„ç†**ï¼šå¯¹æ¯ä¸ªæ•°å€¼å‹ç‰¹å¾è¿›è¡Œå¡æ–¹åˆ†ç®±ï¼ŒåŸºäºç»Ÿè®¡æ£€éªŒåˆå¹¶ç›¸ä¼¼åˆ†ç®±
2. **ç‰¹å¾å€¼æ›¿æ¢**ï¼šå°†åŸå§‹ç‰¹å¾å€¼æ›¿æ¢ä¸ºå¡æ–¹åˆ†ç®±çš„ä¸Šé™
3. **éšæœºæ£®æ—è®­ç»ƒ**ï¼šåŸºäºå¡æ–¹åˆ†ç®±åçš„ç‰¹å¾å€¼è¿›è¡Œéšæœºæ£®æ—è®­ç»ƒ
4. **è§„åˆ™æå–**ï¼šä»éšæœºæ£®æ—ä¸­æå–å†³ç­–è·¯å¾„ä½œä¸ºè§„åˆ™

**å¡æ–¹åˆ†ç®±å‚æ•°è¯´æ˜**ï¼š
- **min_bins**ï¼šæœ€å°åˆ†ç®±æ•°ï¼Œé»˜è®¤ä¸º5
- **chi_square_threshold**ï¼šå¡æ–¹æ£€éªŒé˜ˆå€¼ï¼Œç”¨äºç¡®å®šåˆ†ç®±æ•°é‡ï¼Œå€¼è¶Šå°åˆ†ç®±è¶Šå¤š
- **min_bin_ratio**ï¼šå¡æ–¹åˆ†ç®±çš„æœ€å°æ ·æœ¬å æ¯”ï¼Œé»˜è®¤ä¸º0.05ï¼Œæ§åˆ¶åˆ†ç®±çš„æœ€å°æ ·æœ¬æ•°

**å¡æ–¹éšæœºæ£®æ—ä½¿ç”¨ç¤ºä¾‹**ï¼š

```python
# åˆå§‹åŒ–å¡æ–¹éšæœºæ£®æ—è§„åˆ™æå–å™¨ï¼Œè‡ªå®šä¹‰åˆ†ç®±å‚æ•°
tree_miner_chi2 = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'],
    algorithm='chi2',
    max_depth=5, 
    min_samples_split=20,
    min_samples_leaf=10,
    n_estimators=100,             # éšæœºæ£®æ—çš„æ ‘æ•°é‡
    max_features='sqrt',
    min_bins=8,                  # è‡ªå®šä¹‰æœ€å°åˆ†ç®±æ•°
    chi_square_threshold=0.01,    # é™ä½å¡æ–¹é˜ˆå€¼ï¼Œç”Ÿæˆæ›´å¤šåˆ†ç®±
    min_bin_ratio=0.05,           # å¡æ–¹åˆ†ç®±çš„æœ€å°æ ·æœ¬å æ¯”
    random_state=42
)

# è®­ç»ƒæ¨¡å‹ï¼ˆä¼šè‡ªåŠ¨è¿›è¡Œå¡æ–¹åˆ†ç®±é¢„å¤„ç†ï¼‰
train_acc, test_acc = tree_miner_chi2.train()
print(f"è®­ç»ƒé›†å‡†ç¡®ç‡: {train_acc:.4f}")
print(f"æµ‹è¯•é›†å‡†ç¡®ç‡: {test_acc:.4f}")

# æå–è§„åˆ™
chi2_rules = tree_miner_chi2.extract_rules()
print(f"æå–çš„è§„åˆ™æ•°é‡: {len(chi2_rules)}")

# è¯„ä¼°è§„åˆ™
eval_results = tree_miner_chi2.evaluate_rules()
print(eval_results[['rule', 'test_hit_count', 'test_badrate', 'test_lift']].head())
```

**å¡æ–¹åˆ†ç®±å‚æ•°è°ƒä¼˜å»ºè®®**ï¼š
- **min_bins**ï¼šå¢åŠ æœ€å°åˆ†ç®±æ•°å¯ä»¥ç”Ÿæˆæ›´ç»†ç²’åº¦çš„è§„åˆ™ï¼Œå»ºè®®è®¾ç½®ä¸º5-10
- **chi_square_threshold**ï¼šé™ä½å¡æ–¹é˜ˆå€¼å¯ä»¥å¢åŠ åˆ†ç®±æ•°é‡ï¼Œå»ºè®®è®¾ç½®ä¸º0.01-0.05
- **min_bin_ratio**ï¼šæ§åˆ¶åˆ†ç®±çš„æœ€å°æ ·æœ¬æ•°ï¼Œå»ºè®®è®¾ç½®ä¸º0.03-0.1
- **max_depth**ï¼šæ§åˆ¶æ ‘çš„æ·±åº¦ï¼Œå»ºè®®è®¾ç½®ä¸º5-8
- **min_samples_leaf**ï¼šæ§åˆ¶å¶å­èŠ‚ç‚¹çš„æœ€å°æ ·æœ¬æ•°ï¼Œå»ºè®®è®¾ç½®ä¸º10-20
- **n_estimators**ï¼šå¢åŠ æ ‘çš„æ•°é‡å¯ä»¥æé«˜è§„åˆ™å¤šæ ·æ€§ï¼Œå»ºè®®è®¾ç½®ä¸º50-200

**å¡æ–¹éšæœºæ£®æ—æœ€ä½³å®è·µ**ï¼š
1. **ç”Ÿæˆæ›´å¤šåˆ†ç®±**ï¼šé™ä½chi_square_thresholdï¼Œå¢åŠ min_bins
2. **æ§åˆ¶è§„åˆ™å¤æ‚åº¦**ï¼šé€šè¿‡max_depthå¹³è¡¡è§„åˆ™å¤æ‚åº¦å’Œæ³›åŒ–èƒ½åŠ›
3. **æé«˜è§„åˆ™å¤šæ ·æ€§**ï¼šå¢åŠ n_estimatorsï¼Œä½¿ç”¨max_features='sqrt'æˆ–'log2'
4. **ç­›é€‰é«˜æ•ˆè§„åˆ™**ï¼šæŒ‰test_badrate_reductionæˆ–test_liftæ’åºï¼Œé€‰æ‹©å‰Næ¡è§„åˆ™
5. **å»é‡å¤„ç†**ï¼šä½¿ç”¨get_rules_as_dataframe(deduplicate=True)å»é™¤é‡å¤è§„åˆ™
3. **ç¡®ä¿æ ·æœ¬å……è¶³**ï¼šæ¯ä¸ªåˆ†ç®±çš„æ ·æœ¬æ•°å»ºè®®â‰¥50
4. **éªŒè¯åˆ†ç®±æ•ˆæœ**ï¼šæ£€æŸ¥badrateæ˜¯å¦å‘ˆç°å•è°ƒæ€§æˆ–æ˜æ˜¾çš„é£é™©è¶‹åŠ¿

##### 1.8.4 æ¢¯åº¦æå‡æ ‘ï¼ˆGBDTï¼‰

GBDTé€‚åˆæŒ–æ˜é«˜ç²¾åº¦è§„åˆ™ï¼Œé€šè¿‡è¿­ä»£æå‡å¯ä»¥ç”Ÿæˆè´¨é‡æ›´é«˜çš„è§„åˆ™ã€‚

**GBDTå‚æ•°è°ƒä¼˜å»ºè®®**ï¼š
- **n_estimators**ï¼šå¢åŠ æ ‘çš„æ•°é‡å¯ä»¥ç”Ÿæˆæ›´å¤šè§„åˆ™ï¼Œå»ºè®®è®¾ç½®ä¸º100-300
- **max_depth**ï¼šæ§åˆ¶å•æ£µæ ‘çš„å¤æ‚åº¦ï¼Œå»ºè®®è®¾ç½®ä¸º3-8
- **learning_rate**ï¼šå‡å°å­¦ä¹ ç‡å¯ä»¥æé«˜è§„åˆ™è´¨é‡ï¼Œå»ºè®®è®¾ç½®ä¸º0.01-0.1
- **min_samples_leaf**ï¼šæ§åˆ¶å¶å­èŠ‚ç‚¹æ ·æœ¬æ•°ï¼Œå»ºè®®è®¾ç½®ä¸º5-15

**ä¼˜åŒ–åGBDTä½¿ç”¨ç¤ºä¾‹**ï¼š

```python
# åˆå§‹åŒ–æ¢¯åº¦æå‡æ ‘è§„åˆ™æå–å™¨ï¼Œä¼˜åŒ–å‚æ•°ä»¥æŒ–æ˜é«˜è´¨é‡è§„åˆ™
tree_miner_gbdt = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'],
    algorithm='gbdt',
    max_depth=5,                # é€‚å½“å¢åŠ æ·±åº¦ï¼Œç”Ÿæˆæ›´å¤æ‚è§„åˆ™
    min_samples_split=5,         # å‡å°åˆ†è£‚æ ·æœ¬æ•°é™åˆ¶
    min_samples_leaf=8,          # æ§åˆ¶å¶å­èŠ‚ç‚¹æ ·æœ¬æ•°
    n_estimators=200,           # å¢åŠ æ ‘çš„æ•°é‡ï¼Œç”Ÿæˆæ›´å¤šè§„åˆ™
    learning_rate=0.05,          # å‡å°å­¦ä¹ ç‡ï¼Œæé«˜è§„åˆ™è´¨é‡
    max_features='sqrt',         # å¢åŠ ç‰¹å¾å¤šæ ·æ€§
    feature_trends={
        'ALI_FQZSCORE': -1,      # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
        'BAIDU_FQZSCORE': -1,    # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
        'NUMBER OF LOAN APPLICATIONS TO PBOC': 1  # æ­£ç›¸å…³ï¼šç”³è¯·æ¬¡æ•°è¶Šå¤šï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
    },
    random_state=42
)

# è®­ç»ƒæ¨¡å‹
train_acc, test_acc = tree_miner_gbdt.train()
print(f"è®­ç»ƒé›†å‡†ç¡®ç‡: {train_acc:.4f}")
print(f"æµ‹è¯•é›†å‡†ç¡®ç‡: {test_acc:.4f}")

# æå–è§„åˆ™
gbdt_rules = tree_miner_gbdt.extract_rules()
print(f"æå–çš„è§„åˆ™æ•°é‡: {len(gbdt_rules)}")

# è¯„ä¼°è§„åˆ™
eval_results = tree_miner_gbdt.evaluate_rules()

# æŒ‰test_liftå’Œtest_badrate_reductionç»¼åˆæ’åº
eval_results['score'] = eval_results['test_lift'] * 0.6 + eval_results['test_badrate_reduction'] * 0.4
eval_results_sorted = eval_results.sort_values(by='score', ascending=False)
print("Top 10 é«˜è´¨é‡è§„åˆ™:")
print(eval_results_sorted[['rule', 'test_lift', 'test_badrate_reduction', 'test_loss_lift', 'score']].head(10))
```

**GBDTè§„åˆ™æŒ–æ˜æœ€ä½³å®è·µ**ï¼š
1. **å¹³è¡¡ç²¾åº¦å’Œæ•°é‡**ï¼šé€šè¿‡n_estimatorså’Œlearning_rateå¹³è¡¡è§„åˆ™æ•°é‡å’Œè´¨é‡
2. **æ§åˆ¶è¿‡æ‹Ÿåˆ**ï¼šä½¿ç”¨åˆé€‚çš„max_depthå’Œmin_samples_leaf
3. **ç»“åˆç‰¹å¾è¶‹åŠ¿**ï¼šä½¿ç”¨feature_trendsç¡®ä¿è§„åˆ™ç¬¦åˆä¸šåŠ¡é€»è¾‘
4. **ç»¼åˆè¯„ä¼°**ï¼šç»“åˆtest_liftå’Œtest_badrate_reductionè¯„ä¼°è§„åˆ™
5. **æ¢¯åº¦æå‡ä¼˜åŠ¿**ï¼šåˆ©ç”¨GBDTçš„è¿­ä»£æå‡ç‰¹æ€§ï¼Œç”Ÿæˆé«˜è´¨é‡è§„åˆ™

**GBDT vs éšæœºæ£®æ—ï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ**
- **éœ€è¦é«˜è´¨é‡è§„åˆ™**ï¼šé€‰æ‹©GBDTï¼Œç”Ÿæˆçš„è§„åˆ™ç²¾åº¦æ›´é«˜
- **éœ€è¦å¤šæ ·åŒ–è§„åˆ™**ï¼šé€‰æ‹©éšæœºæ£®æ—ï¼Œç”Ÿæˆçš„è§„åˆ™æ›´å…·å¤šæ ·æ€§
- **æ•°æ®é‡è¾ƒå¤§**ï¼šGBDTå’Œéšæœºæ£®æ—éƒ½é€‚ç”¨ï¼Œä½†éšæœºæ£®æ—è®­ç»ƒé€Ÿåº¦æ›´å¿«
- **ç‰¹å¾é‡è¦æ€§æ¸…æ™°**ï¼šGBDTèƒ½æä¾›æ›´å‡†ç¡®çš„ç‰¹å¾é‡è¦æ€§

### 1.8.5 ä»å®é™…ä½¿ç”¨è§’åº¦å»ºè®®å¦‚ä½•ä½¿ç”¨RFå’ŒGBDTæŒ–æ˜æ›´å¤šå¤šæ ·æ€§é«˜æ•ˆåº¦è§„åˆ™

#### 1.8.5.1 éšæœºæ£®æ—ï¼ˆRFï¼‰ä½¿ç”¨å»ºè®®

**é€‚ç”¨åœºæ™¯**ï¼š
- éœ€è¦æŒ–æ˜å¤§é‡å¤šæ ·åŒ–è§„åˆ™
- è§„åˆ™ç¨³å®šæ€§è¦æ±‚è¾ƒé«˜
- ç‰¹å¾æ•°é‡è¾ƒå¤šï¼Œéœ€è¦æé«˜ç‰¹å¾å¤šæ ·æ€§
- è®­ç»ƒé€Ÿåº¦è¦æ±‚è¾ƒå¿«

**å‚æ•°é…ç½®å»ºè®®**ï¼š

```python
# é…ç½®1ï¼šç”Ÿæˆå¤§é‡å¤šæ ·åŒ–è§„åˆ™ï¼ˆæ¨èï¼‰
tree_miner_rf = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'],
    algorithm='rf',
    max_depth=8,                # é€‚å½“å¢åŠ æ·±åº¦
    min_samples_split=10,        # å‡å°åˆ†è£‚æ ·æœ¬æ•°é™åˆ¶
    min_samples_leaf=5,          # å‡å°å¶å­èŠ‚ç‚¹æ ·æœ¬æ•°é™åˆ¶
    n_estimators=300,           # å¢åŠ æ ‘çš„æ•°é‡
    max_features='log2',        # æé«˜ç‰¹å¾å¤šæ ·æ€§
    random_state=42
)

# é…ç½®2ï¼šç”Ÿæˆé«˜è´¨é‡ç¨³å®šè§„åˆ™
tree_miner_rf_stable = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'],
    algorithm='rf',
    max_depth=5,                # æ§åˆ¶æ·±åº¦
    min_samples_split=20,        # å¢åŠ åˆ†è£‚æ ·æœ¬æ•°é™åˆ¶
    min_samples_leaf=10,         # å¢åŠ å¶å­èŠ‚ç‚¹æ ·æœ¬æ•°é™åˆ¶
    n_estimators=100,           # é€‚ä¸­çš„æ ‘çš„æ•°é‡
    max_features='sqrt',        # å¹³è¡¡ç‰¹å¾å¤šæ ·æ€§
    random_state=42
)
```

**å®é™…ä½¿ç”¨å»ºè®®**ï¼š
1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šä½¿ç”¨é…ç½®1ç”Ÿæˆå¤§é‡å¤šæ ·åŒ–è§„åˆ™
2. **ç¬¬äºŒé˜¶æ®µ**ï¼šç­›é€‰é«˜liftå’Œé«˜badrate_reductionçš„è§„åˆ™
3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šä½¿ç”¨é…ç½®2å¯¹ç­›é€‰åçš„è§„åˆ™è¿›è¡ŒéªŒè¯
4. **ç¬¬å››é˜¶æ®µ**ï¼šç»“åˆä¸šåŠ¡çŸ¥è¯†ï¼Œé€‰æ‹©æœ€ä¼˜è§„åˆ™ç»„åˆ

#### 1.8.5.2 æ¢¯åº¦æå‡æ ‘ï¼ˆGBDTï¼‰ä½¿ç”¨å»ºè®®

**é€‚ç”¨åœºæ™¯**ï¼š
- éœ€è¦æŒ–æ˜é«˜ç²¾åº¦è§„åˆ™
- è§„åˆ™è´¨é‡è¦æ±‚è¾ƒé«˜
- ç‰¹å¾é‡è¦æ€§éœ€è¦å‡†ç¡®è¯„ä¼°
- æ•°æ®é‡é€‚ä¸­ï¼Œå¯ä»¥æ¥å—è¾ƒé•¿çš„è®­ç»ƒæ—¶é—´

**å‚æ•°é…ç½®å»ºè®®**ï¼š

```python
# é…ç½®1ï¼šç”Ÿæˆé«˜è´¨é‡è§„åˆ™ï¼ˆæ¨èï¼‰
tree_miner_gbdt = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'],
    algorithm='gbdt',
    max_depth=5,                # æ§åˆ¶æ·±åº¦
    min_samples_split=10,        # é€‚ä¸­çš„åˆ†è£‚æ ·æœ¬æ•°é™åˆ¶
    min_samples_leaf=8,          # æ§åˆ¶å¶å­èŠ‚ç‚¹æ ·æœ¬æ•°
    n_estimators=200,           # å¢åŠ æ ‘çš„æ•°é‡
    learning_rate=0.05,         # å‡å°å­¦ä¹ ç‡ï¼Œæé«˜è§„åˆ™è´¨é‡
    max_features='sqrt',         # å¹³è¡¡ç‰¹å¾å¤šæ ·æ€§
    feature_trends={
        'ALI_FQZSCORE': -1,
        'BAIDU_FQZSCORE': -1,
        'NUMBER OF LOAN APPLICATIONS TO PBOC': 1
    },
    random_state=42
)

# é…ç½®2ï¼šç”Ÿæˆå¿«é€Ÿè§„åˆ™
tree_miner_gbdt_fast = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'],
    algorithm='gbdt',
    max_depth=3,                # å‡å°æ·±åº¦
    min_samples_split=20,        # å¢åŠ åˆ†è£‚æ ·æœ¬æ•°é™åˆ¶
    min_samples_leaf=10,         # å¢åŠ å¶å­èŠ‚ç‚¹æ ·æœ¬æ•°é™åˆ¶
    n_estimators=100,           # å‡å°‘æ ‘çš„æ•°é‡
    learning_rate=0.1,          # å¢å¤§å­¦ä¹ ç‡ï¼ŒåŠ å¿«è®­ç»ƒé€Ÿåº¦
    max_features='sqrt',         # å¹³è¡¡ç‰¹å¾å¤šæ ·æ€§
    random_state=42
)
```

**å®é™…ä½¿ç”¨å»ºè®®**ï¼š
1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šä½¿ç”¨é…ç½®1ç”Ÿæˆé«˜è´¨é‡è§„åˆ™
2. **ç¬¬äºŒé˜¶æ®µ**ï¼šç­›é€‰é«˜liftå’Œé«˜badrate_reductionçš„è§„åˆ™
3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šä½¿ç”¨é…ç½®2å¿«é€ŸéªŒè¯è§„åˆ™æ•ˆæœ
4. **ç¬¬å››é˜¶æ®µ**ï¼šç»“åˆä¸šåŠ¡çŸ¥è¯†ï¼Œé€‰æ‹©æœ€ä¼˜è§„åˆ™ç»„åˆ

#### 1.8.5.3 RFå’ŒGBDTç»„åˆä½¿ç”¨ç­–ç•¥

**ç»„åˆä½¿ç”¨ä¼˜åŠ¿**ï¼š
- RFç”Ÿæˆå¤šæ ·åŒ–è§„åˆ™ï¼ŒGBDTç”Ÿæˆé«˜è´¨é‡è§„åˆ™
- ä¸¤è€…äº’è¡¥ï¼Œæé«˜è§„åˆ™è¦†ç›–èŒƒå›´
- ç»“åˆä¸¤è€…ä¼˜åŠ¿ï¼Œæå‡æ•´ä½“ç­–ç•¥æ•ˆæœ

**ç»„åˆä½¿ç”¨ç¤ºä¾‹**ï¼š

```python
# ä½¿ç”¨éšæœºæ£®æ—ç”Ÿæˆå¤šæ ·åŒ–è§„åˆ™
tree_miner_rf = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'],
    algorithm='rf',
    max_depth=8,
    min_samples_split=10,
    min_samples_leaf=5,
    n_estimators=300,
    max_features='log2',
    random_state=42
)

tree_miner_rf.train()
rf_rules = tree_miner_rf.extract_rules()
rf_eval = tree_miner_rf.evaluate_rules()

# ä½¿ç”¨GBDTç”Ÿæˆé«˜è´¨é‡è§„åˆ™
tree_miner_gbdt = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'],
    algorithm='gbdt',
    max_depth=5,
    min_samples_split=10,
    min_samples_leaf=8,
    n_estimators=200,
    learning_rate=0.05,
    max_features='sqrt',
    random_state=42
)

tree_miner_gbdt.train()
gbdt_rules = tree_miner_gbdt.extract_rules()
gbdt_eval = tree_miner_gbdt.evaluate_rules()

# åˆå¹¶è¯„ä¼°ç»“æœ
all_eval = pd.concat([rf_eval, gbdt_eval], ignore_index=True)

# ç­›é€‰é«˜æ•ˆè§„åˆ™
high_efficiency_rules = all_eval[(
    all_eval['test_lift'] > 2.0 & 
    all_eval['test_badrate_reduction'] > 0.3 & 
    all_eval['test_loss_lift'] > 1.5
)]

# å»é‡
high_efficiency_rules = high_efficiency_rules.drop_duplicates(subset=['rule'])

print(f"RFè§„åˆ™æ•°é‡: {len(rf_rules)}")
print(f"GBDTè§„åˆ™æ•°é‡: {len(gbdt_rules)}")
print(f"é«˜æ•ˆè§„åˆ™æ•°é‡: {len(high_efficiency_rules)}")
print("Top 10 é«˜æ•ˆè§„åˆ™:")
print(high_efficiency_rules[['rule', 'test_lift', 'test_badrate_reduction', 'test_loss_lift']].head(10))
```

**ç»„åˆä½¿ç”¨æœ€ä½³å®è·µ**ï¼š
1. **å¹¶è¡Œè®­ç»ƒ**ï¼šåŒæ—¶è®­ç»ƒRFå’ŒGBDTï¼Œæé«˜æ•ˆç‡
2. **è§„åˆ™åˆå¹¶**ï¼šåˆå¹¶ä¸¤ä¸ªç®—æ³•çš„è§„åˆ™ï¼Œå¢åŠ å¤šæ ·æ€§
3. **ç»¼åˆè¯„ä¼°**ï¼šç»“åˆå¤šä¸ªæŒ‡æ ‡ç­›é€‰é«˜æ•ˆè§„åˆ™
4. **å»é‡å¤„ç†**ï¼šå»é™¤é‡å¤è§„åˆ™ï¼Œé¿å…å†—ä½™
5. **ä¸šåŠ¡éªŒè¯**ï¼šç»“åˆä¸šåŠ¡çŸ¥è¯†ï¼Œé€‰æ‹©æœ€ä¼˜è§„åˆ™ç»„åˆ

##### 1.8.5 å­¤ç«‹æ£®æ—ï¼ˆISFï¼‰

```python
# åˆå§‹åŒ–å­¤ç«‹æ£®æ—è§„åˆ™æå–å™¨ï¼Œä½¿ç”¨ç‰¹å¾è¶‹åŠ¿åˆ¤æ–­
tree_miner_isf = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'],
    algorithm='isf',
    n_estimators=50,
    random_state=42,
    feature_trends={
        'ALI_FQZSCORE': -1,      # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
        'BAIDU_FQZSCORE': -1,    # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
        'NUMBER OF LOAN APPLICATIONS TO PBOC': 1  # æ­£ç›¸å…³ï¼šç”³è¯·æ¬¡æ•°è¶Šå¤šï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
    }
)

# è®­ç»ƒæ¨¡å‹
mean_score, std_score = tree_miner_isf.train()
print(f"å¹³å‡å¼‚å¸¸åˆ†æ•°: {mean_score:.4f}")
print(f"æ ‡å‡†å·®: {std_score:.4f}")

# æå–è§„åˆ™
isf_rules = tree_miner_isf.extract_rules()
print(f"æå–çš„å¼‚å¸¸è§„åˆ™æ•°é‡: {len(isf_rules)}")

# æ‰“å°è§„åˆ™
tree_miner_isf.print_rules(top_n=5)
```

#### 1.9 å¯è§†åŒ–åŠŸèƒ½

##### 1.9.1 ç‰¹å¾é‡è¦æ€§å›¾

```python
# ç»˜åˆ¶ç‰¹å¾é‡è¦æ€§å›¾
tree_miner.plot_feature_importance(save_path='images/tree_feature_importance.png')
```

##### 1.9.2 å†³ç­–æ ‘ç»“æ„å›¾

```python
# ç»˜åˆ¶å†³ç­–æ ‘ç»“æ„ï¼ˆä»…é€‚ç”¨äºdtã€chi2ç®—æ³•ï¼‰
tree_miner.plot_decision_tree(save_path='images/tree_decision_structure.pdf')
```

##### 1.9.3 è§„åˆ™è¯„ä¼°å›¾

```python
# ç»˜åˆ¶è§„åˆ™è¯„ä¼°å›¾
tree_miner.plot_rule_evaluation(save_path='images/tree_rule_evaluation.png')
```

#### 1.10 æ‰“å°è§„åˆ™

```python
# æ‰“å°Top 5è§„åˆ™
tree_miner.print_rules(top_n=5)
```

---

### 2. å•ç‰¹å¾è§„åˆ™æŒ–æ˜ï¼ˆSingleFeatureRuleMinerï¼‰

ç”¨äºå¯¹æ•°æ®å„ç‰¹å¾çš„ä¸åŒé˜ˆå€¼è¿›è¡Œæ•ˆåº¦åˆ†å¸ƒåˆ†æã€‚

#### 2.1 åˆå§‹åŒ–å‚æ•°è¯¦è§£

```python
from rulelift import SingleFeatureRuleMiner

# åˆå§‹åŒ–å•ç‰¹å¾è§„åˆ™æŒ–æ˜å™¨ï¼ˆä¸ä½¿ç”¨æŸå¤±ç‡æŒ‡æ ‡ï¼‰
sf_miner = SingleFeatureRuleMiner(
    df, 
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'],
    target_col='ISBAD'
)

# åˆå§‹åŒ–å•ç‰¹å¾è§„åˆ™æŒ–æ˜å™¨ï¼ˆä½¿ç”¨æŸå¤±ç‡æŒ‡æ ‡ï¼‰
sf_miner_with_loss = SingleFeatureRuleMiner(
    df, 
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'],
    target_col='ISBAD',
    amount_col='AMOUNT',      # é‡‘é¢å­—æ®µå
    ovd_bal_col='OVD_BAL'      # é€¾æœŸé‡‘é¢å­—æ®µå
)

# åˆå§‹åŒ–å•ç‰¹å¾è§„åˆ™æŒ–æ˜å™¨ï¼ˆä½¿ç”¨å¡æ–¹åˆ†ç®±ï¼‰
sf_miner_chi2 = SingleFeatureRuleMiner(
    df, 
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'],
    target_col='ISBAD',
    algorithm='chi2',        # ä½¿ç”¨å¡æ–¹åˆ†ç®±ç®—æ³•
    binning_threshold=50,   # å”¯ä¸€å€¼æ•°é‡é˜ˆå€¼
    min_bin_ratio=0.05     # æœ€å°åˆ†ç®±æ¯”ä¾‹
)
```

#### 2.2 å‚æ•°è¯¦ç»†è¯´æ˜

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|------|
| `df` | DataFrame | å¿…å¡« | è¾“å…¥çš„æ•°æ®é›† |
| `exclude_cols` | List[str] | `None` | æ’é™¤çš„å­—æ®µååˆ—è¡¨ |
| `target_col` | str | `'ISBAD'` | ç›®æ ‡å­—æ®µå |
| `amount_col` | str | `None` | é‡‘é¢å­—æ®µåï¼Œç”¨äºè®¡ç®—æŸå¤±ç‡æŒ‡æ ‡ |
| `ovd_bal_col` | str | `None` | é€¾æœŸé‡‘é¢å­—æ®µåï¼Œç”¨äºè®¡ç®—æŸå¤±ç‡æŒ‡æ ‡ |
| `algorithm` | str | `'quantile'` | åˆ†ç®±ç®—æ³•ï¼š'quantile'ï¼ˆç­‰é¢‘åˆ†ç®±ï¼Œé»˜è®¤ï¼‰ã€'chi2'ï¼ˆå¡æ–¹åˆ†ç®±ï¼‰ |
| `binning_threshold` | int | `50` | å”¯ä¸€å€¼æ•°é‡é˜ˆå€¼ï¼Œè¶…è¿‡æ‰åˆ†ç®± |
| `min_bin_ratio` | float | `0.05` | æœ€å°åˆ†ç®±æ¯”ä¾‹ï¼Œç”¨äºå¡æ–¹åˆ†ç®± |
| `algorithm` | str | `'quantile'` | åˆ†ç®±ç®—æ³•ï¼š'quantile'ï¼ˆç­‰é¢‘ï¼Œé»˜è®¤ï¼‰ã€'chi2'ï¼ˆå¡æ–¹ï¼‰ |
| `binning_threshold` | int | `50` | å”¯ä¸€å€¼æ•°é‡é˜ˆå€¼ï¼Œè¶…è¿‡æ‰åˆ†ç®± |
| `min_bin_ratio` | float | `0.05` | æœ€å°åˆ†ç®±æ¯”ä¾‹ï¼Œç”¨äºå¡æ–¹åˆ†ç®± |

#### 2.3 åˆ†æå•ä¸ªç‰¹å¾

```python
# åˆ†æå•ä¸ªç‰¹å¾
feature = 'ALI_FQZSCORE'
metrics_df = sf_miner.calculate_single_feature_metrics(feature, num_bins=20)
print(f"\n=== {feature} åˆ†ç®±åˆ†æ ===")
print(metrics_df.head())

# è·å–Topè§„åˆ™
top_rules = sf_miner.get_top_rules(feature=feature, top_n=5, metric='lift', min_samples=10)
print(f"\n=== Top 5è§„åˆ™ ===")
print(top_rules[['rule_description', 'lift', 'badrate', 'selected_samples']])
```

#### 2.4 å‚æ•°è¯¦ç»†è¯´æ˜

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|------|
| `feature` | str | å¿…å¡« | ç‰¹å¾å |
| `num_bins` | int | `20` | åˆ†ç®±æ•°é‡ |
| `top_n` | int | `10` | è¿”å›çš„è§„åˆ™æ•°é‡ |
| `metric` | str | `'lift'` | æ’åºæŒ‡æ ‡ï¼š'lift'ã€'badrate'ã€'loss_rate'ã€'loss_lift'ç­‰ |
| `min_samples` | int | `10` | æœ€å°æ ·æœ¬æ•°è¿‡æ»¤ |
| `min_lift` | float | `1.1` | æœ€å°liftå€¼è¿‡æ»¤ |

#### 2.5 è¾“å‡ºç¤ºä¾‹

```
=== Top 5è§„åˆ™ ===
                           rule_description      lift  badrate  selected_samples
0  ALI_FQZSCORE <= 665.0000  2.174292  0.666667              51
1  ALI_FQZSCORE <= 688.5000  2.087320  0.640000              75
2  ALI_FQZSCORE <= 705.0000  1.993101  0.611111             108
3  ALI_FQZSCORE <= 725.0000  1.928934  0.580000             150
4  ALI_FQZSCORE <= 745.0000  1.867925  0.555556             180
```

#### 2.6 å¯è§†åŒ–

```python
# ç»˜åˆ¶ç‰¹å¾æŒ‡æ ‡åˆ†å¸ƒå›¾
plt = sf_miner.plot_feature_metrics(feature, metric='lift')
plt.savefig(f'{feature}_lift_distribution.png', dpi=300, bbox_inches='tight')
plt.close()
```

---

### 3. å¤šç‰¹å¾äº¤å‰è§„åˆ™æŒ–æ˜ï¼ˆMultiFeatureRuleMinerï¼‰

ç”¨äºç”ŸæˆåŒç‰¹å¾äº¤å‰åˆ†æç»“æœï¼Œæ”¯æŒè‡ªå®šä¹‰åˆ†ç®±é˜ˆå€¼ã€è‡ªåŠ¨åˆ†ç®±ã€å¡æ–¹åˆ†ç®±ç­‰å¤šç§åˆ†ç®±ç­–ç•¥ã€‚æ”¯æŒæŸå¤±ç‡æŒ‡æ ‡è®¡ç®—ã€‚

#### 3.1 åˆå§‹åŒ–å‚æ•°è¯¦è§£

```python
from rulelift import MultiFeatureRuleMiner

# åˆå§‹åŒ–å¤šç‰¹å¾è§„åˆ™æŒ–æ˜å™¨ï¼ˆä¸ä½¿ç”¨æŸå¤±ç‡æŒ‡æ ‡ï¼‰
multi_miner = MultiFeatureRuleMiner(df, target_col='ISBAD')

# åˆå§‹åŒ–å¤šç‰¹å¾è§„åˆ™æŒ–æ˜å™¨ï¼ˆä½¿ç”¨æŸå¤±ç‡æŒ‡æ ‡ï¼‰
multi_miner_with_loss = MultiFeatureRuleMiner(
    df, 
    target_col='ISBAD',
    amount_col='AMOUNT',      # é‡‘é¢å­—æ®µå
    ovd_bal_col='OVD_BAL'      # é€¾æœŸé‡‘é¢å­—æ®µå
)
```

#### 3.2 å‚æ•°è¯¦ç»†è¯´æ˜

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|------|
| `df` | DataFrame | å¿…å¡« | è¾“å…¥çš„æ•°æ®é›† |
| `target_col` | str | `'ISBAD'` | ç›®æ ‡å­—æ®µå |
| `amount_col` | str | `None` | é‡‘é¢å­—æ®µåï¼Œç”¨äºè®¡ç®—æŸå¤±ç‡æŒ‡æ ‡ |
| `ovd_bal_col` | str | `None` | é€¾æœŸé‡‘é¢å­—æ®µåï¼Œç”¨äºè®¡ç®—æŸå¤±ç‡æŒ‡æ ‡ |

#### 3.3 ç”Ÿæˆäº¤å‰çŸ©é˜µ

```python
feature1 = 'ALI_FQZSCORE'
feature2 = 'BAIDU_FQZSCORE'

# ç”Ÿæˆäº¤å‰çŸ©é˜µ
cross_matrix = multi_miner.generate_cross_matrix(
    feature1, feature2,
    max_unique_threshold=5,
    custom_bins1=None,
    custom_bins2=None,
    binning_method='quantile'
)

# æŸ¥çœ‹äº¤å‰çŸ©é˜µ
print(cross_matrix.head())
```

#### 3.3.1 äº¤å‰çŸ©é˜µè‡ªå®šä¹‰åˆ†ç®±è¯¦è§£

äº¤å‰çŸ©é˜µæ”¯æŒè‡ªå®šä¹‰åˆ†ç®±å‚æ•°ï¼Œå…è®¸ç”¨æˆ·æ ¹æ®ä¸šåŠ¡çŸ¥è¯†è°ƒæ•´åˆ†ç®±æ–¹å¼ï¼Œç”Ÿæˆæ›´ç¬¦åˆä¸šåŠ¡éœ€æ±‚çš„è§„åˆ™ã€‚

**è‡ªå®šä¹‰åˆ†ç®±ä½¿ç”¨ç¤ºä¾‹**ï¼š

```python
# ç”Ÿæˆäº¤å‰çŸ©é˜µï¼Œä½¿ç”¨è‡ªå®šä¹‰åˆ†ç®±é˜ˆå€¼
feature1 = 'ALI_FQZSCORE'
feature2 = 'BAIDU_FQZSCORE'

# è‡ªå®šä¹‰åˆ†ç®±é˜ˆå€¼
custom_bins1 = [0, 600, 700, 750, 800, 850, 900, 1000]
custom_bins2 = [0, 500, 600, 700, 800, 900, 1000]

# ä½¿ç”¨è‡ªå®šä¹‰åˆ†ç®±ç”Ÿæˆäº¤å‰çŸ©é˜µ
cross_matrix_custom = multi_miner.generate_cross_matrix(
    feature1, feature2,
    max_unique_threshold=10,
    custom_bins1=custom_bins1,  # è‡ªå®šä¹‰ç¬¬ä¸€ä¸ªç‰¹å¾çš„åˆ†ç®±é˜ˆå€¼
    custom_bins2=custom_bins2,  # è‡ªå®šä¹‰ç¬¬äºŒä¸ªç‰¹å¾çš„åˆ†ç®±é˜ˆå€¼
    binning_method='chi2'        # å¡æ–¹åˆ†ç®±æ–¹æ³•
)

print("è‡ªå®šä¹‰åˆ†ç®±äº¤å‰çŸ©é˜µ:")
print(cross_matrix_custom.head())
```

**äº¤å‰çŸ©é˜µåˆ†ç®±å‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|------|
| `custom_bins1` | List[float] | `None` | ç¬¬ä¸€ä¸ªç‰¹å¾çš„è‡ªå®šä¹‰åˆ†ç®±é˜ˆå€¼åˆ—è¡¨ |
| `custom_bins2` | List[float] | `None` | ç¬¬äºŒä¸ªç‰¹å¾çš„è‡ªå®šä¹‰åˆ†ç®±é˜ˆå€¼åˆ—è¡¨ |
| `binning_method` | str | `'quantile'` | åˆ†ç®±æ–¹æ³•ï¼š'quantile'ï¼ˆç­‰é¢‘ï¼‰ã€'equal_width'ï¼ˆç­‰å®½ï¼‰ã€'chi2'ï¼ˆå¡æ–¹ï¼‰ |
| `max_unique_threshold` | int | `5` | æœ€å¤§å…è®¸çš„å”¯ä¸€å€¼æ•°é‡é˜ˆå€¼ï¼Œè¶…è¿‡åˆ™è¿›è¡Œåˆ†ç®± |

**ä¸åŒåˆ†ç®±æ–¹æ³•å¯¹æ¯”**ï¼š

| åˆ†ç®±æ–¹æ³• | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|----------|------|------|----------|
| **quantile** | æ¯ä¸ªåˆ†ç®±æ ·æœ¬æ•°é‡å‡è¡¡ | æ•°å€¼èŒƒå›´å¯èƒ½å·®å¼‚å¤§ | è¿ç»­å‹å˜é‡ï¼Œæ ·æœ¬åˆ†å¸ƒä¸å‡åŒ€ |
| **equal_width** | æ•°å€¼èŒƒå›´å‡åŒ€ï¼Œæ˜“äºç†è§£ | æ ·æœ¬æ•°é‡å¯èƒ½å·®å¼‚å¤§ | è¿ç»­å‹å˜é‡ï¼Œæ ·æœ¬åˆ†å¸ƒå‡åŒ€ |
| **chi2** | åŸºäºç»Ÿè®¡æ£€éªŒï¼Œåˆ†ç®±æœ€ä¼˜ | è®¡ç®—å¤æ‚ï¼Œè€—æ—¶è¾ƒé•¿ | é£æ§åœºæ™¯ï¼Œè¿½æ±‚æœ€ä¼˜åˆ†ç®±æ•ˆæœ |

**äº¤å‰çŸ©é˜µè‡ªå®šä¹‰åˆ†ç®±æœ€ä½³å®è·µ**ï¼š

1. **ç»“åˆä¸šåŠ¡çŸ¥è¯†**ï¼šæ ¹æ®ä¸šåŠ¡ç»éªŒè®¾ç½®åˆç†çš„åˆ†ç®±é˜ˆå€¼
2. **è€ƒè™‘å˜é‡åˆ†å¸ƒ**ï¼šè¿ç»­å‹å˜é‡ä¼˜å…ˆä½¿ç”¨å¡æ–¹åˆ†ç®±
3. **æ§åˆ¶åˆ†ç®±æ•°é‡**ï¼šæ¯ä¸ªç‰¹å¾çš„åˆ†ç®±æ•°é‡å»ºè®®åœ¨5-10ä¹‹é—´
4. **å¹³è¡¡æ ·æœ¬æ•°**ï¼šç¡®ä¿æ¯ä¸ªäº¤å‰ç»„åˆçš„æ ·æœ¬æ•°è¶³å¤Ÿï¼ˆå»ºè®®â‰¥50ï¼‰
5. **éªŒè¯åˆ†ç®±æ•ˆæœ**ï¼šæ£€æŸ¥badrateæ˜¯å¦å‘ˆç°å•è°ƒæ€§æˆ–æ˜æ˜¾çš„é£é™©è¶‹åŠ¿

#### 3.3.2 äº¤å‰çŸ©é˜µExcelå¯¼å‡ºè‡ªå®šä¹‰åˆ†ç®±

```python
# ç”Ÿæˆäº¤å‰çŸ©é˜µExcelï¼Œä½¿ç”¨è‡ªå®šä¹‰åˆ†ç®±
cross_matrices = multi_miner.generate_cross_matrices_excel(
    features_list=['ALI_FQZSCORE', 'BAIDU_FQZSCORE'],
    output_path='cross_analysis_custom_bins.xlsx',
    metrics=['badrate', 'count', 'sample_ratio', 'lift', 'loss_rate', 'loss_lift'],
    binning_method='chi2',
    custom_bins1=[0, 600, 700, 750, 800, 850, 900, 1000],
    custom_bins2=[0, 500, 600, 700, 800, 900, 1000]
)
print(f"è‡ªå®šä¹‰åˆ†ç®±äº¤å‰çŸ©é˜µExcelå·²ä¿å­˜åˆ°: cross_analysis_custom_bins.xlsx")
```

#### 3.4 å‚æ•°è¯¦ç»†è¯´æ˜

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|------|
| `feature1` | str | å¿…å¡« | ç¬¬ä¸€ä¸ªç‰¹å¾å |
| `feature2` | str | å¿…å¡« | ç¬¬äºŒä¸ªç‰¹å¾å |
| `max_unique_threshold` | int | `5` | æœ€å¤§å…è®¸çš„å”¯ä¸€å€¼æ•°é‡é˜ˆå€¼ï¼Œè¶…è¿‡åˆ™è¿›è¡Œåˆ†ç®± |
| `custom_bins1` | List[float] | `None` | ç¬¬ä¸€ä¸ªç‰¹å¾çš„è‡ªå®šä¹‰åˆ†ç®±é˜ˆå€¼ |
| `custom_bins2` | List[float] | `None` | ç¬¬äºŒä¸ªç‰¹å¾çš„è‡ªå®šä¹‰åˆ†ç®±é˜ˆå€¼ |
| `binning_method` | str | `'quantile'` | åˆ†ç®±æ–¹æ³•ï¼š'quantile'ï¼ˆç­‰é¢‘ï¼‰æˆ–'chi2'ï¼ˆå¡æ–¹ï¼‰ |

#### 3.5 æ”¯æŒçš„æŒ‡æ ‡è¯´æ˜

å¤šç‰¹å¾äº¤å‰åˆ†ææ”¯æŒå¤šç§æŒ‡æ ‡ï¼Œå¸®åŠ©ç­–ç•¥äººå‘˜å…¨é¢è¯„ä¼°ç‰¹å¾ç»„åˆçš„é£é™©æ°´å¹³å’Œä¸šåŠ¡ä»·å€¼ï¼š

| æŒ‡æ ‡ | å®šä¹‰ | ä¸šåŠ¡æ„ä¹‰ |
|------|------|----------|
| `badrate` | åæ ·æœ¬æ¯”ä¾‹ = åæ ·æœ¬æ•° / æ€»æ ·æœ¬æ•° | ç›´æ¥åæ˜ è¯¥ç‰¹å¾ç»„åˆä¸‹çš„é£é™©æ°´å¹³ |
| `count` | æ ·æœ¬æ•°é‡ | åæ˜ è¯¥ç‰¹å¾ç»„åˆçš„è¦†ç›–èŒƒå›´ |
| `bad_count` | åæ ·æœ¬æ•°é‡ | è¯¥ç‰¹å¾ç»„åˆä¸‹çš„åå®¢æˆ·æ•°é‡ |
| `sample_ratio` | æ ·æœ¬å æ¯” = è¯¥ç»„åˆæ ·æœ¬æ•° / æ€»æ ·æœ¬æ•° | åæ˜ è¯¥ç‰¹å¾ç»„åˆçš„ä¸šåŠ¡é‡è¦æ€§ |
| `lift` | æå‡åº¦ = è¯¥ç»„åˆbadrate / æ€»æ ·æœ¬badrate | åæ˜ è¯¥ç‰¹å¾ç»„åˆçš„é£é™©åŒºåˆ†èƒ½åŠ›ï¼Œå€¼è¶Šå¤§æ•ˆæœè¶Šå¥½ |
| `loss_rate` | æŸå¤±ç‡ = æŸå¤±é‡‘é¢ / æ€»é‡‘é¢ | åæ˜ è¯¥ç‰¹å¾ç»„åˆçš„å®é™…æŸå¤±ç¨‹åº¦ï¼ˆéœ€è¦æä¾›amount_colå’Œovd_bal_colï¼‰ |
| `loss_lift` | æŸå¤±æå‡åº¦ = è¯¥ç»„åˆloss_rate / æ€»æ ·æœ¬loss_rate | åæ˜ è¯¥ç‰¹å¾ç»„åˆçš„æŸå¤±åŒºåˆ†èƒ½åŠ›ï¼ˆéœ€è¦æä¾›amount_colå’Œovd_bal_colï¼‰ |

#### 3.6 ç”Ÿæˆäº¤å‰çŸ©é˜µExcelæ–‡ä»¶

```python
# ç”Ÿæˆäº¤å‰çŸ©é˜µExcelæ–‡ä»¶ï¼ˆæ–¹ä¾¿ç­–ç•¥äººå‘˜æ ¹æ®äº¤å‰çŸ©é˜µåˆ¶è®¢è§„åˆ™ï¼‰
cross_matrices = multi_miner.generate_cross_matrices_excel(
    features_list=['ALI_FQZSCORE', 'BAIDU_FQZSCORE'], 
    output_path='cross_analysis.xlsx'
)
print(f"äº¤å‰çŸ©é˜µExcelæ–‡ä»¶å·²ä¿å­˜åˆ°: cross_analysis.xlsx")

# æŸ¥çœ‹ç”Ÿæˆçš„Excelæ–‡ä»¶
# æ–‡ä»¶åŒ…å«å¤šä¸ªsheetï¼Œæ¯ä¸ªsheetå¯¹åº”ä¸€ä¸ªç‰¹å¾ç»„åˆ
# æ¯ä¸ªsheetåŒ…å«ï¼šbadrateã€countã€sample_ratioã€liftç­‰æŒ‡æ ‡
```

#### 3.7 å¤šç‰¹å¾ä¸¤ä¸¤äº¤å‰åˆ†æ

æ”¯æŒä¼ å…¥å¤šä¸ªç‰¹å¾ï¼Œè‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰ä¸¤ä¸¤ç‰¹å¾ç»„åˆçš„äº¤å‰çŸ©é˜µï¼Œæ–¹ä¾¿ç­–ç•¥äººå‘˜å…¨é¢åˆ†æç‰¹å¾é—´çš„äº¤äº’å…³ç³»ã€‚

```python
# å¤šç‰¹å¾ä¸¤ä¸¤äº¤å‰åˆ†æç¤ºä¾‹
features_list = ['ALI_FQZSCORE', 'BAIDU_FQZSCORE', 'NUMBER OF LOAN APPLICATIONS TO PBOC']
cross_matrices_multi = multi_miner.generate_cross_matrices_excel(
    features_list=features_list,
    output_path='cross_analysis_multi_features.xlsx',
    metrics=['badrate', 'count', 'sample_ratio', 'lift', 'loss_rate', 'loss_lift'],  # æ”¯æŒå¤šç§æŒ‡æ ‡åˆ†æ
    binning_method='quantile'  # æ”¯æŒç­‰é¢‘åˆ†ç®±
)
print(f"å¤šç‰¹å¾äº¤å‰çŸ©é˜µExcelæ–‡ä»¶å·²ä¿å­˜åˆ°: cross_analysis_multi_features.xlsx")
```

#### 3.8 å‚æ•°è¯¦ç»†è¯´æ˜

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|------|
| `features_list` | List[str] | å¿…å¡« | ç‰¹å¾æ¸…å•åˆ—è¡¨ï¼Œç”¨äºå¤šç‰¹å¾ä¸¤ä¸¤ç»„åˆç”ŸæˆçŸ©é˜µ |
| `feature1` | str | `None` | ç¬¬ä¸€ä¸ªç‰¹å¾åï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬ï¼Œå½“features_listä¸ºNoneæ—¶ä½¿ç”¨ï¼‰ |
| `feature2` | str | `None` | ç¬¬äºŒä¸ªç‰¹å¾åï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬ï¼Œå½“features_listä¸ºNoneæ—¶ä½¿ç”¨ï¼‰ |
| `max_unique_threshold` | int | `5` | æœ€å¤§å…è®¸çš„å”¯ä¸€å€¼æ•°é‡é˜ˆå€¼ï¼Œè¶…è¿‡åˆ™è¿›è¡Œåˆ†ç®± |
| `custom_bins1` | List[float] | `None` | ç¬¬ä¸€ä¸ªç‰¹å¾çš„è‡ªå®šä¹‰åˆ†ç®±é˜ˆå€¼ï¼ˆä»…å½“features_listé•¿åº¦ä¸º2æ—¶æœ‰æ•ˆï¼‰ |
| `custom_bins2` | List[float] | `None` | ç¬¬äºŒä¸ªç‰¹å¾çš„è‡ªå®šä¹‰åˆ†ç®±é˜ˆå€¼ï¼ˆä»…å½“features_listé•¿åº¦ä¸º2æ—¶æœ‰æ•ˆï¼‰ |
| `binning_method` | str | `'quantile'` | åˆ†ç®±æ–¹æ³•ï¼š'quantile'ï¼ˆç­‰é¢‘ï¼‰æˆ–'chi2'ï¼ˆå¡æ–¹ï¼‰ |
| `output_path` | str | `'cross_analysis.xlsx'` | Excelè¾“å‡ºè·¯å¾„ |
| `metrics` | List[str] | `['badrate', 'count', 'sample_ratio']` | è¦å¯¼å‡ºçš„æŒ‡æ ‡åˆ—è¡¨ï¼Œå¯é€‰ï¼š'badrate', 'count', 'bad_count', 'sample_ratio', 'lift', 'loss_rate', 'loss_lift' |

#### 3.9 äº¤å‰çŸ©é˜µExcelæ–‡ä»¶ç¤ºä¾‹

ç”Ÿæˆçš„Excelæ–‡ä»¶åŒ…å«å¤šä¸ªsheetï¼Œæ¯ä¸ªsheetå¯¹åº”ä¸€ä¸ªç‰¹å¾ç»„åˆï¼Œä¾‹å¦‚ï¼š
- `ALI_FQZSCORE_x_BAIDU_FQZSCORE`ï¼šä¸¤ä¸ªç‰¹å¾çš„äº¤å‰çŸ©é˜µ
- `ALI_FQZSCORE_x_NUMBER OF LOAN APPLICATIONS TO PBOC`ï¼šå¦ä¸€ä¸ªç‰¹å¾ç»„åˆ
- æ¯ä¸ªsheetåŒ…å«ä»¥ä¸‹æŒ‡æ ‡ï¼šbadrateã€countã€sample_ratioã€liftç­‰
- ç­–ç•¥äººå‘˜å¯ä»¥æ ¹æ®äº¤å‰çŸ©é˜µä¸­çš„é«˜liftåŒºåŸŸåˆ¶è®¢è§„åˆ™

**Excelæ–‡ä»¶å†…å®¹ç¤ºä¾‹**ï¼š

| ALI_FQZSCORE | BAIDU_FQZSCORE | badrate | count | sample_ratio | lift |
|--------------|----------------|---------|-------|--------------|------|
| (500, 600]   | (300, 400]     | 0.6667  | 15    | 0.03         | 2.5  |
| (500, 600]   | (400, 500]     | 0.4000  | 25    | 0.05         | 1.5  |
| (600, 700]   | (300, 400]     | 0.5000  | 20    | 0.04         | 1.9  |
| (600, 700]   | (400, 500]     | 0.2000  | 30    | 0.06         | 0.8  |
| (700, 800]   | (300, 400]     | 0.3000  | 18    | 0.036        | 1.15 |
| (700, 800]   | (400, 500]     | 0.1500  | 40    | 0.08         | 0.58 |

**åŒ…å«æŸå¤±ç‡æŒ‡æ ‡çš„Excelç¤ºä¾‹**ï¼ˆéœ€è¦åœ¨åˆå§‹åŒ–æ—¶æä¾›amount_colå’Œovd_bal_colï¼‰ï¼š

| ALI_FQZSCORE | BAIDU_FQZSCORE | badrate | count | loss_rate | loss_lift |
|--------------|----------------|---------|-------|-----------|-----------|
| (500, 600]   | (300, 400]     | 0.6667  | 15    | 0.4567    | 2.89      |
| (500, 600]   | (400, 500]     | 0.4000  | 25    | 0.3210    | 2.01      |
| (600, 700]   | (300, 400]     | 0.5000  | 20    | 0.2890    | 1.81      |
| (600, 700]   | (400, 500]     | 0.2000  | 30    | 0.1567    | 0.98      |

#### 3.10 è·å–Topè§„åˆ™

```python
# è·å–Topè§„åˆ™
top_rules = multi_miner.get_cross_rules(
    feature1, feature2,
    top_n=10,
    metric='lift',
    min_samples=10,
    min_lift=1.1,
    max_unique_threshold=5,
    custom_bins1=None,
    custom_bins2=None,
    binning_method='quantile'
)

print(top_rules[['feature1_value', 'feature2_value', 'count', 'badrate', 'lift', 'rule_description']])
```

#### 3.11 å¯è§†åŒ–

```python
# ç»˜åˆ¶äº¤å‰çƒ­åŠ›å›¾
plt = multi_miner.plot_cross_heatmap(feature1, feature2, metric='lift')
plt.savefig('images/cross_feature_heatmap.png', dpi=300, bbox_inches='tight')
plt.close()
```

---

### 4. å˜é‡åˆ†æï¼ˆVariableAnalyzerï¼‰

æ”¯æŒå¯¹ç‰¹å¾å˜é‡è¿›è¡Œå…¨é¢çš„æ•ˆåº¦åˆ†æå’Œåˆ†ç®±åˆ†æï¼Œå¸®åŠ©é£æ§å›¢é˜Ÿè¯†åˆ«é‡è¦å˜é‡ï¼Œä¼˜åŒ–ç‰¹å¾å·¥ç¨‹ã€‚

#### 4.1 åˆå§‹åŒ–å‚æ•°è¯¦è§£

```python
from rulelift import VariableAnalyzer

# åˆå§‹åŒ–å˜é‡åˆ†æå™¨ï¼ˆä¸ä½¿ç”¨æŸå¤±ç‡æŒ‡æ ‡ï¼‰
var_analyzer = VariableAnalyzer(
    df, 
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'], 
    target_col='ISBAD'
)

# åˆå§‹åŒ–å˜é‡åˆ†æå™¨ï¼ˆä½¿ç”¨æŸå¤±ç‡æŒ‡æ ‡ï¼‰
var_analyzer_with_loss = VariableAnalyzer(
    df, 
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'], 
    target_col='ISBAD',
    amount_col='AMOUNT',      # é‡‘é¢å­—æ®µå
    ovd_bal_col='OVD_BAL'      # é€¾æœŸé‡‘é¢å­—æ®µå
)
```

#### 4.2 å‚æ•°è¯¦ç»†è¯´æ˜

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|------|
| `df` | DataFrame | å¿…å¡« | è¾“å…¥çš„æ•°æ®é›† |
| `exclude_cols` | List[str] | `None` | æ’é™¤çš„å­—æ®µååˆ—è¡¨ |
| `target_col` | str | `'ISBAD'` | ç›®æ ‡å­—æ®µå |
| `amount_col` | str | `None` | é‡‘é¢å­—æ®µåï¼Œç”¨äºè®¡ç®—æŸå¤±ç‡æŒ‡æ ‡ |
| `ovd_bal_col` | str | `None` | é€¾æœŸé‡‘é¢å­—æ®µåï¼Œç”¨äºè®¡ç®—æŸå¤±ç‡æŒ‡æ ‡ |

#### 4.3 åˆ†ææ‰€æœ‰å˜é‡çš„æ•ˆåº¦æŒ‡æ ‡

```python
# åˆ†ææ‰€æœ‰å˜é‡çš„æ•ˆåº¦æŒ‡æ ‡
var_metrics = var_analyzer.analyze_all_variables()
print("\n=== æ‰€æœ‰å˜é‡æ•ˆåº¦æŒ‡æ ‡ ===")
print(var_metrics)
```

#### 4.4 å˜é‡åˆ†ç®±åˆ†å¸ƒåˆ†æ

å˜é‡åˆ†ææ”¯æŒå¤šç§åˆ†ç®±æ–¹å¼ï¼ŒåŒ…æ‹¬è‡ªåŠ¨åˆ†ç®±å’Œè‡ªå®šä¹‰åˆ†ç®±ï¼Œå¸®åŠ©é£æ§å›¢é˜Ÿæ·±å…¥ç†è§£å˜é‡åˆ†å¸ƒå’Œé£é™©ç‰¹å¾ã€‚

### 4.4.1 è‡ªå®šä¹‰åˆ†ç®±åŠŸèƒ½

**ä½¿ç”¨æ–¹å¼**ï¼š
```python
# åˆ†æå•ä¸ªå˜é‡çš„åˆ†ç®±æƒ…å†µï¼Œä½¿ç”¨è‡ªå®šä¹‰åˆ†ç®±é˜ˆå€¼
feature = 'ALI_FQZSCORE'

# è‡ªå®šä¹‰åˆ†ç®±é˜ˆå€¼
custom_bins = [0, 600, 700, 750, 800, 850, 900, 1000]

# ä½¿ç”¨è‡ªå®šä¹‰åˆ†ç®±
bin_analysis = var_analyzer.analyze_single_variable(
    feature, 
    n_bins=7,  # åˆ†ç®±æ•°é‡åº”æ¯”è‡ªå®šä¹‰é˜ˆå€¼æ•°é‡å°‘1
    custom_bins=custom_bins,  # ä¼ å…¥è‡ªå®šä¹‰åˆ†ç®±é˜ˆå€¼
    binning_method='chi2'  # ä½¿ç”¨å¡æ–¹åˆ†ç®±æ–¹æ³•
)

print(f"\n=== {feature} è‡ªå®šä¹‰åˆ†ç®±åˆ†æ ===")
print(bin_analysis)
```

**å‚æ•°è¯¦ç»†è¯´æ˜**ï¼š

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|------|
| `feature` | str | å¿…å¡« | ç‰¹å¾å |
| `n_bins` | int | `10` | åˆ†ç®±æ•°é‡ |
| `custom_bins` | list | `None` | è‡ªå®šä¹‰åˆ†ç®±é˜ˆå€¼åˆ—è¡¨ï¼Œå¦‚[0, 50, 100, 150] |
| `binning_method` | str | `'quantile'` | åˆ†ç®±æ–¹æ³•ï¼š'quantile'ï¼ˆç­‰é¢‘ï¼‰ã€'equal_width'ï¼ˆç­‰å®½ï¼‰ã€'chi2'ï¼ˆå¡æ–¹ï¼‰ |
| `psi_dt` | str | `None` | PSIè®¡ç®—åˆ†å‰²æ—¥æœŸ |
| `date_col` | str | `None` | æ—¥æœŸå­—æ®µå |

### 4.4.2 æ”¯æŒçš„åˆ†ç®±æ–¹æ³•

| åˆ†ç®±æ–¹æ³• | å®šä¹‰ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|----------|------|------|------|----------|
| **quantile** | ç­‰é¢‘åˆ†ç®±ï¼Œæ¯ä¸ªåˆ†ç®±æ ·æœ¬æ•°é‡å¤§è‡´ç›¸ç­‰ | æ ·æœ¬åˆ†å¸ƒå‡è¡¡ï¼Œé¿å…æç«¯åˆ†ç®± | æ•°å€¼èŒƒå›´å¯èƒ½å·®å¼‚è¾ƒå¤§ | è¿ç»­å‹å˜é‡ï¼Œæ ·æœ¬åˆ†å¸ƒä¸å‡åŒ€ |
| **equal_width** | ç­‰å®½åˆ†ç®±ï¼Œæ¯ä¸ªåˆ†ç®±æ•°å€¼èŒƒå›´ç›¸ç­‰ | æ•°å€¼èŒƒå›´å‡åŒ€ï¼Œæ˜“äºç†è§£ | æ ·æœ¬æ•°é‡å¯èƒ½å·®å¼‚è¾ƒå¤§ | è¿ç»­å‹å˜é‡ï¼Œæ ·æœ¬åˆ†å¸ƒå‡åŒ€ |
| **chi2** | åŸºäºå¡æ–¹æ£€éªŒçš„æœ€ä¼˜åˆ†ç®± | åŸºäºç»Ÿè®¡æ£€éªŒï¼Œåˆ†ç®±æ•ˆæœæœ€ä¼˜ | è®¡ç®—å¤æ‚ï¼Œè€—æ—¶è¾ƒé•¿ | é£æ§åœºæ™¯ï¼Œè¿½æ±‚æœ€ä¼˜åˆ†ç®±æ•ˆæœ |

### 4.4.3 è¾“å‡ºç¤ºä¾‹

```
=== æ‰€æœ‰å˜é‡æ•ˆåº¦æŒ‡æ ‡ ===
        variable        iv        ks        auc  missing_rate  single_value_rate  min_value  max_value  median_value  mean_diff  corr_with_target  psi
0  ALI_FQZSCORE  0.456789  0.452345  0.723456      0.012345      0.0456789      0.987654      0.723456      0.012345      0.456789      0.012345
1  BAIDU_FQZSCORE  0.3456789  0.3456789  0.678901      0.023456      0.056789      0.976543      0.678901      0.023456      0.3456789      0.023456

=== ALI_FQZSCORE è‡ªå®šä¹‰åˆ†ç®±åˆ†æ ===
        bin_range  count  bad_count  good_count  badrate  sample_ratio  cumulative_badrate      lift  loss_rate  loss_lift
0  (0.0, 600.0]        85         62         23   0.7294        0.1700          0.7294      3.2567  0.4567    2.8901
1  (600.0, 700.0]      120         78         42   0.6500        0.2400          0.6847      2.9130  0.3890    2.4312
2  (700.0, 750.0]       95         55         40   0.5789        0.1900          0.6461      2.5739  0.3210    2.0063
3  (750.0, 800.0]       80         45         35   0.5625        0.1600          0.6208      2.5000  0.2890    1.8063
4  (800.0, 850.0]       65         32         33   0.4923        0.1300          0.5952      2.1878  0.2456    1.5350
5  (850.0, 900.0]       45         18         27   0.4000        0.0900          0.5702      1.7778  0.1890    1.1813
6  (900.0, 1000.0]      10         2          8    0.2000        0.0200          0.5574      0.8889  0.0987    0.6169
```

### 4.4.4 å˜é‡åˆ†ç®±æœ€ä½³å®è·µ

1. **è¿ç»­å‹å˜é‡**ï¼š
   - ä¼˜å…ˆä½¿ç”¨å¡æ–¹åˆ†ç®±ï¼Œç”Ÿæˆæœ€ä¼˜åˆ†ç®±
   - ç»“åˆä¸šåŠ¡çŸ¥è¯†è°ƒæ•´åˆ†ç®±é˜ˆå€¼
   - ç¡®ä¿æ¯ä¸ªåˆ†ç®±çš„æ ·æœ¬æ•°è¶³å¤Ÿï¼ˆå»ºè®®â‰¥100ï¼‰
   - æ£€æŸ¥badrateæ˜¯å¦å‘ˆç°å•è°ƒæ€§æˆ–æ˜æ˜¾çš„é£é™©è¶‹åŠ¿

2. **ç¦»æ•£å‹å˜é‡**ï¼š
   - ç±»åˆ«æ•°â‰¤10ï¼šç›´æ¥ä½¿ç”¨åŸå§‹ç±»åˆ«
   - ç±»åˆ«æ•°>10ï¼šä½¿ç”¨ç­‰é¢‘æˆ–å¡æ–¹åˆ†ç®±åˆå¹¶ç›¸ä¼¼ç±»åˆ«
   - æ³¨æ„é«˜åŸºæ•°ç±»åˆ«å˜é‡çš„å¤„ç†
   - å…³æ³¨ç¨€æœ‰ç±»åˆ«çš„é£é™©ç‰¹å¾

3. **åˆ†ç®±ç»“æœåº”ç”¨**ï¼š
   - é€‰æ‹©badrateå•è°ƒé€’å¢/é€’å‡çš„åˆ†ç®±ç»“æœ
   - å…³æ³¨liftå€¼é«˜çš„åˆ†ç®±åŒºé—´
   - ç»“åˆloss_rateå’Œloss_liftè¯„ä¼°å®é™…é£é™©
   - éªŒè¯åˆ†ç®±ç»“æœçš„ç¨³å®šæ€§ï¼ˆPSI<0.1ï¼‰

#### 4.5 å‚æ•°è¯¦ç»†è¯´æ˜

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|------|
| `feature` | str | å¿…å¡« | ç‰¹å¾å |
| `n_bins` | int | `10` | åˆ†ç®±æ•°é‡ |
| `psi_dt` | str | `None` | PSIè®¡ç®—åˆ†å‰²æ—¥æœŸ |
| `date_col` | str | `None` | æ—¥æœŸå­—æ®µå |

#### 4.6 è¾“å‡ºç¤ºä¾‹

```
=== æ‰€æœ‰å˜é‡æ•ˆåº¦æŒ‡æ ‡ ===
        variable        iv        ks        auc  missing_rate  single_value_rate  min_value  max_value  median_value  mean_diff  corr_with_target  psi
0  ALI_FQZSCORE  0.456789  0.452345  0.723456      0.012345      0.0456789      0.987654      0.723456      0.012345      0.456789      0.012345
1  BAIDU_FQZSCORE  0.3456789  0.3456789  0.678901      0.023456      0.056789      0.976543      0.678901      0.023456      0.3456789      0.023456
```

#### 4.7 å˜é‡æ•ˆåº¦æŒ‡æ ‡è¯´æ˜

| æŒ‡æ ‡ | å®šä¹‰ | æœ€ä½³èŒƒå›´ | æ„ä¹‰ |
|------|------|----------|------|
| `iv` | ä¿¡æ¯å€¼(Information Value) | > 0.1 | å˜é‡çš„é¢„æµ‹èƒ½åŠ›ï¼Œå€¼è¶Šå¤§é¢„æµ‹èƒ½åŠ›è¶Šå¼º |
| `ks` | KSç»Ÿè®¡é‡ | > 0.2 | å˜é‡å¯¹å¥½åå®¢æˆ·çš„åŒºåˆ†èƒ½åŠ›ï¼Œå€¼è¶Šå¤§åŒºåˆ†èƒ½åŠ›è¶Šå¼º |
| `auc` | æ›²çº¿ä¸‹é¢ç§¯ | > 0.6 | å˜é‡çš„æ•´ä½“é¢„æµ‹èƒ½åŠ›ï¼Œå€¼è¶Šå¤§é¢„æµ‹èƒ½åŠ›è¶Šå¼º |
| `missing_rate` | ç¼ºå¤±ç‡ | < 0.1 | å˜é‡çš„ç¼ºå¤±å€¼æ¯”ä¾‹ï¼Œå€¼è¶Šå°æ•°æ®è´¨é‡è¶Šå¥½ |
| `single_value_rate` | å•å€¼ç‡ | < 0.05 | å˜é‡çš„å”¯ä¸€å€¼æ¯”ä¾‹ï¼Œå€¼è¶Šå°åŒºåˆ†èƒ½åŠ›è¶Šå¼º |
| `min_value` | æœ€å°å€¼ | - | å˜é‡çš„æœ€å°å€¼ |
| `max_value` | æœ€å¤§å€¼ | - | å˜é‡çš„æœ€å¤§å€¼ |
| `median_value` | ä¸­ä½æ•° | - | å˜é‡çš„ä¸­ä½æ•°ï¼Œåæ˜ ä¸­å¿ƒè¶‹åŠ¿ |
| `mean_diff` | å‡å€¼å·®å¼‚ | > 0.1 | å¥½åå®¢æˆ·å‡å€¼å·®å¼‚ï¼Œå€¼è¶Šå¤§åŒºåˆ†èƒ½åŠ›è¶Šå¼º |
| `corr_with_target` | ä¸ç›®æ ‡å˜é‡ç›¸å…³ç³»æ•° | - | å˜é‡ä¸ç›®æ ‡å˜é‡çš„ç›¸å…³æ€§ï¼Œå€¼è¶Šå¤§è¶Šé‡è¦ |
| `psi` | ç¾¤ä½“ç¨³å®šæ€§æŒ‡æ ‡(PSI) | < 0.1 | å˜é‡çš„ç¨³å®šæ€§æŒ‡æ ‡ï¼Œå€¼è¶Šå°è¶Šç¨³å®š |

#### 4.8 å¯è§†åŒ–

```python
# å¯è§†åŒ–å˜é‡åˆ†ç®±ç»“æœ
var_analyzer.plot_variable_bins(feature, n_bins=10)
plt.savefig(f'{feature}_bin_analysis.png', dpi=300, bbox_inches='tight')
plt.close()
```

---

### 5. è§„åˆ™æ•ˆåº¦åˆ†æç›‘æ§æ¨¡å—ï¼ˆanalyze_rulesï¼‰

ç”¨äºå®æ—¶è¯„ä¼°ä¸Šçº¿è§„åˆ™çš„æ•ˆåº¦ã€‚è§£å†³è§„åˆ™æ‹¦æˆªæ ·æœ¬æ— æ ‡ç­¾çš„é—®é¢˜ï¼Œå€ŸåŠ©å®¢æˆ·è¯„çº§åˆ†å¸ƒå·®å¼‚ï¼Œæ¨ç®—é€¾æœŸç‡ã€å¬å›ç‡ã€ç²¾ç¡®ç‡ã€lift å€¼ç­‰æ ¸å¿ƒæŒ‡æ ‡ã€‚

#### 5.1 åˆå§‹åŒ–å‚æ•°è¯¦è§£

```python
from rulelift import analyze_rules

# é€šè¿‡ç”¨æˆ·è¯„çº§è¯„ä¼°è§„åˆ™æ•ˆåº¦
result_by_rating = analyze_rules(
    hit_rule_df, 
    rule_col='RULE',
    user_id_col='USER_ID',
    user_level_badrate_col='USER_LEVEL_BADRATE',  # ç”¨æˆ·è¯„çº§åè´¦ç‡å­—æ®µ
    hit_date_col='HIT_DATE',  # å‘½ä¸­æ—¥æœŸï¼Œç”¨äºè®¡ç®—ç¨³å®šæ€§æŒ‡æ ‡
    include_stability=True  # æ˜¯å¦åŒ…å«ç¨³å®šæ€§æŒ‡æ ‡
)

# é€šè¿‡ç›®æ ‡æ ‡ç­¾è¯„ä¼°è§„åˆ™æ•ˆåº¦
result_by_target = analyze_rules(
    hit_rule_df, 
    rule_col='RULE',
    user_id_col='USER_ID',
    user_target_col='USER_TARGET',  # ç”¨æˆ·å®é™…é€¾æœŸæ ‡ç­¾å­—æ®µ
    hit_date_col='HIT_DATE',  # å‘½ä¸­æ—¥æœŸï¼Œç”¨äºè®¡ç®—ç¨³å®šæ€§æŒ‡æ ‡
    include_stability=True  # æ˜¯å¦åŒ…å«ç¨³å®šæ€§æŒ‡æ ‡
)

# åŒæ—¶ä½¿ç”¨ä¸¤ç§æ–¹å¼è¯„ä¼°è§„åˆ™æ•ˆåº¦
result_combined = analyze_rules(
    hit_rule_df, 
    rule_col='RULE',
    user_id_col='USER_ID',
    user_level_badrate_col='USER_LEVEL_BADRATE',
    user_target_col='USER_TARGET',
    hit_date_col='HIT_DATE',
    include_stability=True  # æ˜¯å¦åŒ…å«ç¨³å®šæ€§æŒ‡æ ‡
)
```

#### 5.2 å‚æ•°è¯¦ç»†è¯´æ˜

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|------|
| `rule_score` | DataFrame | å¿…å¡« | è§„åˆ™æ‹¦æˆªå®¢æˆ·ä¿¡æ¯ |
| `rule_col` | str | `'RULE'` | è§„åˆ™å­—æ®µå |
| `user_id_col` | str | `'USER_ID'` | ç”¨æˆ·ç¼–å·å­—æ®µå |
| `user_level_badrate_col` | str | `None` | ç”¨æˆ·è¯„çº§åè´¦ç‡å­—æ®µåï¼ˆå¯é€‰ï¼‰ |
| `user_target_col` | str | `None` | ç”¨æˆ·å®é™…é€¾æœŸå­—æ®µåï¼ˆå¯é€‰ï¼‰ |
| `hit_date_col` | str | `None` | å‘½ä¸­æ—¥æœŸå­—æ®µåï¼ˆå¯é€‰ï¼Œç”¨äºå‘½ä¸­ç‡ç›‘æ§ï¼‰ |
| `metrics` | list | `None` | æŒ‡å®šè¦è®¡ç®—çš„æŒ‡æ ‡åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰ |
| `include_stability` | bool | `True` | æ˜¯å¦åŒ…å«ç¨³å®šæ€§æŒ‡æ ‡ |

#### 5.3 è¯„ä¼°æ–¹å¼è¯´æ˜

##### 5.3.1 é€šè¿‡ç”¨æˆ·è¯„çº§è¯„ä¼°è§„åˆ™

å½“ç”¨æˆ·æ²¡æœ‰å®é™…é€¾æœŸæ ‡ç­¾æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç”¨æˆ·è¯„çº§å¯¹åº”çš„åè´¦ç‡æ¥è¯„ä¼°è§„åˆ™æ•ˆæœã€‚

**è®¡ç®—æŒ‡æ ‡**ï¼š
- `estimated_badrate_pred`: é¢„ä¼°åè´¦ç‡
- `estimated_recall_pred`: é¢„ä¼°å¬å›ç‡
- `estimated_precision_pred`: é¢„ä¼°ç²¾ç¡®ç‡
- `estimated_lift_pred`: é¢„ä¼°liftå€¼

##### 5.3.2 é€šè¿‡ç›®æ ‡æ ‡ç­¾è¯„ä¼°è§„åˆ™

å½“ç”¨æˆ·æœ‰å®é™…é€¾æœŸæ ‡ç­¾æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ç›®æ ‡æ ‡ç­¾æ¥è¯„ä¼°è§„åˆ™æ•ˆæœã€‚

**è®¡ç®—æŒ‡æ ‡**ï¼š
- `actual_badrate`: å®é™…åè´¦ç‡
- `actual_recall`: å®é™…å¬å›ç‡
- `actual_precision`: å®é™…ç²¾ç¡®ç‡
- `actual_lift`: å®é™…liftå€¼
- `f1`: F1åˆ†æ•°

##### 5.3.3 å‘½ä¸­ç‡ç›¸å…³æŒ‡æ ‡

å½“æä¾›äº† `hit_date_col` æ—¶ï¼Œè¿˜ä¼šè®¡ç®—ä»¥ä¸‹æŒ‡æ ‡ï¼š

| æŒ‡æ ‡ | å®šä¹‰ | ä¸šåŠ¡æ„ä¹‰ |
|------|------|----------|
| `base_hit_rate` | å†å²å¹³å‡å‘½ä¸­ç‡ | åæ˜ è§„åˆ™çš„å†å²å‘½ä¸­æƒ…å†µ |
| `current_hit_rate` | å½“å¤©å‘½ä¸­ç‡ | åæ˜ è§„åˆ™çš„å½“å‰å‘½ä¸­æƒ…å†µ |
| `hit_rate_cv` | å‘½ä¸­ç‡å˜å¼‚ç³»æ•° = æ ‡å‡†å·®/å‡å€¼ | åæ˜ è§„åˆ™å‘½ä¸­ç‡çš„ç¨³å®šæ€§ï¼Œå€¼è¶Šå°è¶Šç¨³å®š |
| `hit_rate_change_rate` | å‘½ä¸­ç‡å˜åŒ–ç‡ = (å½“å‰å‘½ä¸­ç‡ - å†å²å¹³å‡å‘½ä¸­ç‡) / å†å²å¹³å‡å‘½ä¸­ç‡ | åæ˜ è§„åˆ™å‘½ä¸­ç‡çš„å˜åŒ–è¶‹åŠ¿ |

##### 5.3.4 ç¨³å®šæ€§æŒ‡æ ‡

å½“æä¾›äº† `hit_date_col` ä¸” `include_stability=True` æ—¶ï¼Œè¿˜ä¼šè®¡ç®—ä»¥ä¸‹ç¨³å®šæ€§æŒ‡æ ‡ï¼š

| æŒ‡æ ‡ | å®šä¹‰ | ä¸šåŠ¡æ„ä¹‰ |
|------|------|----------|
| `hit_rate_std` | å‘½ä¸­ç‡æ ‡å‡†å·® | åæ˜ è§„åˆ™å‘½ä¸­ç‡çš„æ³¢åŠ¨ç¨‹åº¦ |
| `hit_rate_cv` | å‘½ä¸­ç‡å˜å¼‚ç³»æ•° | åæ˜ è§„åˆ™å‘½ä¸­ç‡çš„ç¨³å®šæ€§ï¼Œå€¼è¶Šå°è¶Šç¨³å®š |
| `max_monthly_change` | æœ€å¤§æœˆåº¦å˜åŒ–ç‡ | åæ˜ è§„åˆ™å‘½ä¸­ç‡çš„æœ€å¤§æ³¢åŠ¨ |
| `min_monthly_change` | æœ€å°æœˆåº¦å˜åŒ–ç‡ | åæ˜ è§„åˆ™å‘½ä¸­ç‡çš„æœ€å°æ³¢åŠ¨ |
| `avg_monthly_change` | å¹³å‡æœˆåº¦å˜åŒ–ç‡ | åæ˜ è§„åˆ™å‘½ä¸­ç‡çš„å¹³å‡å˜åŒ–è¶‹åŠ¿ |
| `months_analyzed` | åˆ†æçš„æœˆä»½æ•°é‡ | åæ˜ åˆ†æçš„æ—¶é—´è·¨åº¦ |

#### 5.4 è§„åˆ™ç›¸å…³æ€§åˆ†æ

```python
from rulelift import analyze_rule_correlation

# è§„åˆ™ç›¸å…³æ€§åˆ†æ
correlation_matrix, max_correlation = analyze_rule_correlation(
    hit_rule_df, 
    rule_col='RULE', 
    user_id_col='USER_ID'
)
print(f"   è§„åˆ™ç›¸å…³æ€§çŸ©é˜µ:")
print(correlation_matrix)
print(f"   æ¯æ¡è§„åˆ™çš„æœ€å¤§ç›¸å…³æ€§:")
for rule, corr in max_correlation.items():
    print(f"   {rule}: {corr['max_correlation_value']:.4f}")
```

**è¾“å‡ºç¤ºä¾‹**ï¼š

```
è§„åˆ™ç›¸å…³æ€§çŸ©é˜µ:
          rule1     rule2     rule3
rule1  1.000000  0.234567  0.345678
rule2  0.234567  1.000000  0.456789
rule3  0.345678  0.456789  1.000000

æ¯æ¡è§„åˆ™çš„æœ€å¤§ç›¸å…³æ€§:
rule1: 0.3457
rule2: 0.4568
rule3: 0.4568
```

#### 5.5 è¾“å‡ºç¤ºä¾‹

```
=== è§„åˆ™æ•ˆåº¦åˆ†æç»“æœ ===
         RULE  actual_lift  actual_badrate  actual_recall        f1
0  rule1     2.3456789      0.3456789      0.456789  0.3456789
1  rule2     2.123456      0.234567       0.3456789  0.234567
2  rule3     1.987654      0.123456       0.234567  0.123456
```

---

### 6. ç­–ç•¥ç›¸å…³æ€§ã€å¢ç›Šè®¡ç®—ï¼ˆcalculate_strategy_gainï¼‰

è¯„ä¼°ç­–ç•¥ç»„åˆæ•ˆæœï¼Œè®¡ç®—ä¸¤ä¸¤è§„åˆ™é—´çš„å¢ç›Šã€‚

#### 6.1 åˆå§‹åŒ–å‚æ•°è¯¦è§£

```python
from rulelift import calculate_strategy_gain

# å®šä¹‰ä¸¤ä¸ªç­–ç•¥ç»„
strategy1 = ['rule1', 'rule2']
strategy2 = ['rule1', 'rule2', 'rule3']

# è®¡ç®—ç­–ç•¥å¢ç›Šï¼ˆstrategy1 åˆ° strategy2 çš„é¢å¤–ä»·å€¼ï¼‰
gain = calculate_strategy_gain(
    hit_rule_df, 
    strategy1, 
    strategy2, 
    user_target_col='USER_TARGET'
)
print(f"\nç­–ç•¥å¢ç›Š: {gain:.4f}")
```

#### 6.2 å‚æ•°è¯¦ç»†è¯´æ˜

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|------|
| `rule_score` | DataFrame | å¿…å¡« | è§„åˆ™æ‹¦æˆªå®¢æˆ·ä¿¡æ¯ |
| `strategy_a_rules` | list | å¿…å¡« | ç­–ç•¥Açš„è§„åˆ™åˆ—è¡¨ |
| `strategy_b_rules` | list | å¿…å¡« | ç­–ç•¥Bçš„è§„åˆ™åˆ—è¡¨ |
| `user_target_col` | str | `None` | ç”¨æˆ·å®é™…é€¾æœŸå­—æ®µåï¼ˆå¯é€‰ï¼‰ |
| `user_level_badrate_col` | str | `None` | ç”¨æˆ·è¯„çº§åè´¦ç‡å­—æ®µåï¼ˆå¯é€‰ï¼‰ |

#### 6.3 å¢ç›ŠæŒ‡æ ‡è¯´æ˜

| æŒ‡æ ‡ | å®šä¹‰ | ä¸šåŠ¡æ„ä¹‰ |
|------|------|----------|
| `gain_users` | ç­–ç•¥Aåœ¨ç­–ç•¥Bä¹‹åæ–°å¢çš„æ‹¦æˆªç”¨æˆ·æ•° | åæ˜ ç­–ç•¥Açš„é¢å¤–è¦†ç›–èƒ½åŠ› |
| `gain_bads` | æ–°å¢æ‹¦æˆªç”¨æˆ·ä¸­çš„åå®¢æˆ·æ•° | åæ˜ ç­–ç•¥Açš„é¢å¤–æ‹¦æˆªèƒ½åŠ› |
| `gain_badrate` | æ–°å¢æ‹¦æˆªç”¨æˆ·çš„åè´¦ç‡ | åæ˜ æ–°å¢æ‹¦æˆªç”¨æˆ·çš„è´¨é‡ |
| `gain_lift` | æ–°å¢æ‹¦æˆªç”¨æˆ·åè´¦ç‡ç›¸å¯¹äºç­–ç•¥Båè´¦ç‡çš„å¢ç›Šï¼ˆå€æ•°ï¼‰ | åæ˜ ç­–ç•¥Açš„é¢å¤–ä»·å€¼ |
| `gain_coverage` | æ–°å¢æ‹¦æˆªç”¨æˆ·å æ€»æ ·æœ¬çš„æ¯”ä¾‹ | åæ˜ ç­–ç•¥Açš„é¢å¤–è¦†ç›–èŒƒå›´ |
| `gain_recall` | æ–°å¢æ‹¦æˆªç”¨æˆ·ä¸­çš„åå®¢æˆ·å æ€»åå®¢æˆ·çš„æ¯”ä¾‹ | åæ˜ ç­–ç•¥Açš„é¢å¤–å¬å›èƒ½åŠ› |
| `b_hit_users` | ç­–ç•¥Bæ‹¦æˆªçš„ç”¨æˆ·æ•° | åæ˜ ç­–ç•¥Bçš„è¦†ç›–èŒƒå›´ |
| `b_badrate` | ç­–ç•¥Bæ‹¦æˆªç”¨æˆ·çš„åè´¦ç‡ | åæ˜ ç­–ç•¥Bçš„æ‹¦æˆªè´¨é‡ |

#### 6.4 è¾“å‡ºç¤ºä¾‹

```
ç­–ç•¥å¢ç›Š: 1.2345
```

---

## å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

### Q1: å¦‚ä½•é€‰æ‹©åˆé€‚çš„è§„åˆ™æŒ–æ˜ç®—æ³•ï¼Ÿ

**A**: æ ¹æ®ä¸åŒçš„ä¸šåŠ¡åœºæ™¯é€‰æ‹©ç®—æ³•ï¼š
- **DTï¼ˆå†³ç­–æ ‘ï¼‰**ï¼šé€‚åˆå¿«é€Ÿæ¢ç´¢å’Œåˆæ­¥åˆ†æï¼Œè§„åˆ™ç®€å•æ˜“æ‡‚
- **RFï¼ˆéšæœºæ£®æ—ï¼‰**ï¼šé€‚åˆç”Ÿäº§ç¯å¢ƒï¼Œè§„åˆ™ç¨³å®šæ€§å¥½ï¼Œå¤šæ ·æ€§é«˜
- **CHI2ï¼ˆå¡æ–¹éšæœºæ£®æ—ï¼‰**ï¼šé€‚åˆéœ€è¦ç»Ÿè®¡æœ€ä¼˜åˆ†ç®±çš„åœºæ™¯ï¼ŒåŸºäºå¡æ–¹æ£€éªŒçš„åˆ†ç®±é¢„å¤„ç†
- **GBDTï¼ˆæ¢¯åº¦æå‡æ ‘ï¼‰**ï¼šé€‚åˆå¤æ‚åœºæ™¯ï¼Œè§„åˆ™ç²¾åº¦é«˜
- **ISFï¼ˆå­¤ç«‹æ£®æ—ï¼‰**ï¼šé€‚åˆæŒ–æ˜å¼‚å¸¸æ ·æœ¬çš„è§„åˆ™

**B**: æ ¹æ®æ•°æ®é‡å’Œç‰¹å¾æ•°é‡é€‰æ‹©ï¼š
- **éœ€è¦é«˜è´¨é‡è§„åˆ™**ï¼šé€‰æ‹© GBDTï¼Œç”Ÿæˆçš„è§„åˆ™ç²¾åº¦æ›´é«˜
- **éœ€è¦å¤šæ ·åŒ–è§„åˆ™**ï¼šé€‰æ‹©éšæœºæ£®æ—ï¼Œç”Ÿæˆçš„è§„åˆ™æ›´å…·å¤šæ ·æ€§
- **æ•°æ®é‡è¾ƒå¤§**ï¼šGBDT å’Œéšæœºæ£®æ—éƒ½é€‚ç”¨ï¼Œä½†éšæœºæ£®æ—è®­ç»ƒé€Ÿåº¦æ›´å¿«
- **ç‰¹å¾é‡è¦æ€§æ¸…æ™°**ï¼šGBDT èƒ½æä¾›æ›´å‡†ç¡®çš„ç‰¹å¾é‡è¦æ€§

### Q2: å¦‚ä½•é…ç½®ç‰¹å¾è¶‹åŠ¿ï¼ˆfeature_trendsï¼‰ï¼Ÿ

**A**: ç‰¹å¾è¶‹åŠ¿ç”¨äºé¿å…ä¸ç¬¦åˆä¸šåŠ¡è§£é‡Šæ€§çš„è§„åˆ™ã€‚

**B**: é…ç½®æ–¹å¼ï¼š
```python
feature_trends={
    'ALI_FQZSCORE': -1,      # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
    'BAIDU_FQZSCORE': -1,    # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
    'NUMBER OF LOAN APPLICATIONS TO PBOC': 1  # æ­£ç›¸å…³ï¼šç”³è¯·æ¬¡æ•°è¶Šå¤šï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
}
```

**C**: ä¸šåŠ¡å«ä¹‰ï¼š
- **æ­£ç›¸å…³ï¼ˆå€¼ä¸º1ï¼‰**ï¼šè¡¨ç¤ºç‰¹å¾æ•°å€¼è¶Šå¤§ï¼Œç›®æ ‡æ ‡ç­¾ï¼ˆè¿çº¦æ¦‚ç‡ï¼‰è¶Šé«˜ï¼Œåªä¿ç•™å¤§äºé˜ˆå€¼çš„è§„åˆ™
- **è´Ÿç›¸å…³ï¼ˆå€¼ä¸º-1ï¼‰**ï¼šè¡¨ç¤ºç‰¹å¾æ•°å€¼è¶Šå°ï¼Œç›®æ ‡æ ‡ç­¾ï¼ˆè¿çº¦æ¦‚ç‡ï¼‰è¶Šé«˜ï¼Œåªä¿ç•™å°äºç­‰äºé˜ˆå€¼çš„è§„åˆ™

### Q3: å¦‚ä½•è°ƒæ•´å‚æ•°ä»¥è·å¾—æ›´å¥½çš„è§„åˆ™ï¼Ÿ

**A**: æ ¹æ®ç›®æ ‡è°ƒæ•´å‚æ•°ï¼š

**ç”Ÿæˆç®€å•è§„åˆ™**ï¼š
- å¢åŠ  `max_depth`ï¼ˆå»ºè®®3-5ï¼‰
- å¢åŠ  `min_samples_split`ï¼ˆå»ºè®®15-20ï¼‰
- å¢åŠ  `min_samples_leaf`ï¼ˆå»ºè®®10-15ï¼‰

**ç”Ÿæˆå¤æ‚è§„åˆ™**ï¼š
- å‡å° `max_depth`ï¼ˆå»ºè®®6-10ï¼‰
- å‡å° `min_samples_split`ï¼ˆå»ºè®®5-10ï¼‰
- å‡å° `min_samples_leaf`ï¼ˆå»ºè®®3-8ï¼‰

**æé«˜è§„åˆ™å¤šæ ·æ€§**ï¼š
- å¢åŠ  `n_estimators`ï¼ˆå»ºè®®100-500ï¼‰
- ä½¿ç”¨ `max_features='log2'` æˆ–æ‰‹åŠ¨è®¾ç½®è¾ƒå¤§å€¼

**å¹³è¡¡è§„åˆ™å¤æ‚åº¦å’Œæ³›åŒ–èƒ½åŠ›**ï¼š
- `max_depth`ï¼š5-8
- `min_samples_leaf`ï¼š5-10

### Q4: å¦‚ä½•è¯„ä¼°è§„åˆ™æ•ˆæœï¼Ÿ

**A**: ä½¿ç”¨ä»¥ä¸‹æŒ‡æ ‡è¯„ä¼°è§„åˆ™ï¼š
- **test_lift**ï¼šè§„åˆ™çš„é£é™©åŒºåˆ†èƒ½åŠ›ï¼Œå€¼è¶Šå¤§æ•ˆæœè¶Šå¥½ï¼ˆå»ºè®® > 2.0ï¼‰
- **test_badrate_reduction**ï¼šç­–ç•¥æ•ˆç‡æŒ‡æ ‡ï¼Œæ¯1%å‘½ä¸­ç‡å¸¦æ¥çš„badrateé™ä½å¹…åº¦ï¼ˆå»ºè®® > 0.3ï¼‰
- **test_loss_lift**ï¼šæŸå¤±åŒºåˆ†èƒ½åŠ›ï¼ˆå»ºè®® > 1.5ï¼‰
- **test_precision**ï¼šç²¾ç¡®ç‡ï¼ˆå»ºè®® > 0.6ï¼‰
- **test_recall**ï¼šå¬å›ç‡ï¼ˆå»ºè®® > 0.4ï¼‰
- **test_f1**ï¼šF1åˆ†æ•°ï¼ˆå»ºè®® > 0.5ï¼‰

### Q5: å¦‚ä½•å¤„ç†ç¼ºå¤±å€¼ï¼Ÿ

**A**: rulelift åº“ä¼šè‡ªåŠ¨å¤„ç†ç¼ºå¤±å€¼ï¼š
- **æ•°å€¼å‹ç‰¹å¾**ï¼šå¡«å……ä¸º 0
- **ç±»åˆ«å‹ç‰¹å¾**ï¼šå¡«å……ä¸º 'missing' å­—ç¬¦ä¸²
- **è§„åˆ™æŒ–æ˜**ï¼šåœ¨è®¡ç®—æŒ‡æ ‡æ—¶è‡ªåŠ¨å¿½ç•¥ç¼ºå¤±å€¼

### Q6: å¦‚ä½•ä½¿ç”¨æŸå¤±ç‡æŒ‡æ ‡ï¼Ÿ

**A**: éœ€è¦åœ¨åˆå§‹åŒ–æ—¶æä¾›é‡‘é¢å­—æ®µå’Œé€¾æœŸé‡‘é¢å­—æ®µï¼š

```python
# åˆå§‹åŒ–æ—¶æä¾›é‡‘é¢å­—æ®µ
tree_miner_with_loss = TreeRuleExtractor(
    df,
    target_col='ISBAD',
    exclude_cols=['ID', 'CREATE_TIME', 'OVD_BAL', 'AMOUNT'],
    algorithm='gbdt',
    amount_col='AMOUNT',      # é‡‘é¢å­—æ®µå
    ovd_bal_col='OVD_BAL'      # é€¾æœŸé‡‘é¢å­—æ®µå
)
```

**B**: æŸå¤±ç‡æŒ‡æ ‡è¯´æ˜ï¼š
- **loss_rate**ï¼šç‰¹å®šè§„åˆ™æˆ–ç‰¹å¾ç»„åˆä¸‹ï¼Œé€¾æœŸé‡‘é¢æ€»å’Œé™¤ä»¥æ€»é‡‘é¢æ€»å’Œ
- **loss_lift**ï¼šè¯¥ç»„åˆloss_rate / æ€»æ ·æœ¬loss_rateï¼Œåæ˜ æŸå¤±åŒºåˆ†èƒ½åŠ›

### Q7: å¡æ–¹éšæœºæ£®æ—å¦‚ä½•å·¥ä½œï¼Ÿ

**A**: å¡æ–¹éšæœºæ£®æ—é‡‡ç”¨"å¡æ–¹åˆ†ç®±é¢„å¤„ç† + éšæœºæ£®æ—"çš„æ–¹å¼å®ç°ï¼š

**B**: å®ç°æ­¥éª¤ï¼š
1. **å¡æ–¹åˆ†ç®±é¢„å¤„ç†**ï¼šå¯¹æ¯ä¸ªæ•°å€¼å‹ç‰¹å¾è¿›è¡Œå¡æ–¹åˆ†ç®±ï¼ŒåŸºäºç»Ÿè®¡æ£€éªŒåˆå¹¶ç›¸ä¼¼åˆ†ç®±
2. **ç‰¹å¾å€¼æ›¿æ¢**ï¼šå°†åŸå§‹ç‰¹å¾å€¼æ›¿æ¢ä¸ºå¡æ–¹åˆ†ç®±çš„ä¸Šé™
3. **éšæœºæ£®æ—è®­ç»ƒ**ï¼šåŸºäºå¡æ–¹åˆ†ç®±åçš„ç‰¹å¾å€¼è¿›è¡Œéšæœºæ£®æ—è®­ç»ƒ
4. **è§„åˆ™æå–**ï¼šä»éšæœºæ£®æ—ä¸­æå–å†³ç­–è·¯å¾„ä½œä¸ºè§„åˆ™

**C**: ä¼˜åŠ¿ï¼š
- âœ… å®ç°ç®€å•ï¼Œä¸éœ€è¦å¤æ‚çš„è‡ªå®šä¹‰å†³ç­–æ ‘åˆ†è£‚é€»è¾‘
- âœ… åŸºäºç»Ÿè®¡æ£€éªŒçš„æœ€ä¼˜åˆ†ç®±
- âœ… å¯ä»¥å®Œå…¨å¤ç”¨éšæœºæ£®æ—çš„è®­ç»ƒå’Œè§„åˆ™æå–é€»è¾‘
- âœ… æé«˜è§„åˆ™æŒ–æ˜çš„å‡†ç¡®æ€§å’Œå¯è§£é‡Šæ€§

---

## æ ¸å¿ƒæŒ‡æ ‡è¯´æ˜

### è§„åˆ™è¯„ä¼°æŒ‡æ ‡

| æŒ‡æ ‡ | å®šä¹‰ | æœ€ä½³èŒƒå›´ | æ„ä¹‰ |
|------|------|----------|------|
| `actual_lift` | è§„åˆ™å‘½ä¸­æ ·æœ¬é€¾æœŸç‡ / æ€»æ ·æœ¬é€¾æœŸç‡ | > 1.0 | è§„åˆ™çš„é£é™©åŒºåˆ†èƒ½åŠ›ï¼Œå€¼è¶Šå¤§æ•ˆæœè¶Šå¥½ |
| `f1` | 2*(ç²¾ç¡®ç‡*å¬å›ç‡)/(ç²¾ç¡®ç‡+å¬å›ç‡) | 0-1 | ç»¼åˆè¯„ä¼°è§„åˆ™çš„ç²¾ç¡®ç‡å’Œå¬å›ç‡ |
| `actual_badrate` | è§„åˆ™å‘½ä¸­æ ·æœ¬ä¸­çš„é€¾æœŸæ¯”ä¾‹ | ä¾ä¸šåŠ¡åœºæ™¯è€Œå®š | è§„åˆ™ç›´æ¥æ‹¦æˆªçš„åå®¢æˆ·æ¯”ä¾‹ |
| `actual_recall` | è§„åˆ™å‘½ä¸­çš„åå®¢æˆ· / æ€»åå®¢æˆ· | 0-1 | è§„åˆ™å¯¹åå®¢æˆ·çš„è¦†ç›–èƒ½åŠ› |
| `hit_rate_cv` | å‘½ä¸­ç‡å˜å¼‚ç³»æ•° = æ ‡å‡†å·®/å‡å€¼ | < 0.2 | è§„åˆ™å‘½ä¸­ç‡çš„ç¨³å®šæ€§ï¼Œå€¼è¶Šå°è¶Šç¨³å®š |
| `max_correlation_value` | ä¸å…¶ä»–è§„åˆ™çš„æœ€å¤§ç›¸å…³ç³»æ•° | < 0.5 | è§„åˆ™çš„ç‹¬ç«‹æ€§ï¼Œå€¼è¶Šå°ç‹¬ç«‹æ€§è¶Šå¥½ |

### å˜é‡åˆ†ææŒ‡æ ‡

| æŒ‡æ ‡ | å®šä¹‰ | æœ€ä½³èŒƒå›´ | æ„ä¹‰ |
|------|------|----------|------|
| `iv` | ä¿¡æ¯å€¼(Information Value) | > 0.1 | å˜é‡çš„é¢„æµ‹èƒ½åŠ›ï¼Œå€¼è¶Šå¤§é¢„æµ‹èƒ½åŠ›è¶Šå¼º |
| `ks` | KSç»Ÿè®¡é‡ | > 0.2 | å˜é‡å¯¹å¥½åå®¢æˆ·çš„åŒºåˆ†èƒ½åŠ›ï¼Œå€¼è¶Šå¤§åŒºåˆ†èƒ½åŠ›è¶Šå¼º |
| `auc` | æ›²çº¿ä¸‹é¢ç§¯ | > 0.6 | å˜é‡çš„æ•´ä½“é¢„æµ‹èƒ½åŠ›ï¼Œå€¼è¶Šå¤§é¢„æµ‹èƒ½åŠ›è¶Šå¼º |
| `badrate` | åˆ†ç®±ä¸­çš„åå®¢æˆ·æ¯”ä¾‹ | ä¾ä¸šåŠ¡åœºæ™¯è€Œå®š | åˆ†ç®±çš„é£é™©æ°´å¹³ |
| `cum_badrate` | ç´¯ç§¯åå®¢æˆ·æ¯”ä¾‹ | ä¾ä¸šåŠ¡åœºæ™¯è€Œå®š | ç´¯ç§¯åˆ†ç®±çš„é£é™©æ°´å¹³ |

---

## ç‰ˆæœ¬ä¿¡æ¯

### å½“å‰ç‰ˆæœ¬ï¼š1.3.0

### ç‰ˆæœ¬å†å²

#### v1.3.0 (2026-01-27)
**æ–°å¢åŠŸèƒ½**ï¼š
- âœ… SingleFeatureRuleMiner æ”¯æŒå¡æ–¹åˆ†ç®±ç®—æ³•ï¼ˆalgorithm='chi2'ï¼‰
- âœ… SingleFeatureRuleMiner æ”¯æŒæ™ºèƒ½åˆ†ç®±ç­–ç•¥ï¼ˆalgorithmã€binning_thresholdã€min_bin_ratio å‚æ•°ï¼‰
- âœ… SingleFeatureRuleMiner å®ç°æœ€ä¼˜é˜ˆå€¼é€‰æ‹©ç®—æ³•ï¼ˆåŸºäºå¡æ–¹åˆ†æ•°æˆ–ä¿¡æ¯å¢ç›Šï¼‰
- âœ… TreeRuleExtractor å®ç°çœŸæ­£çš„å¡æ–¹éšæœºæ£®æ—ç®—æ³•ï¼ˆå¡æ–¹åˆ†ç®±é¢„å¤„ç† + éšæœºæ£®æ—ï¼‰
- âœ… TreeRuleExtractor æ·»åŠ  GBDT æ­£åˆ™åŒ–å‚æ•°ï¼ˆlearning_rateã€subsampleï¼‰
- âœ… TreeRuleExtractor æ·»åŠ  min_bin_ratio å‚æ•°æ§åˆ¶å¡æ–¹åˆ†ç®±æœ€å°æ ·æœ¬å æ¯”
- âœ… MultiFeatureRuleMiner å¢å¼ºå¡æ–¹åˆ†ç®±å®ç°

**ä¼˜åŒ–æ”¹è¿›**ï¼š
- âœ… ç®—æ³•é‡å‘½åï¼š'xgb' â†’ 'gbdt'ï¼ˆä¿æŒå‘åå…¼å®¹æ€§ï¼‰
- âœ… æ ‡è®° XGBoostRuleMiner ä¸º deprecated
- âœ… ä¿®å¤ metrics/basic.py è¯­æ³•é”™è¯¯
- âœ… ç»Ÿä¸€ç®—æ³•å‘½åå’Œæœ¯è¯­

**æ–‡æ¡£æ›´æ–°**ï¼š
- âœ… æ›´æ–° README.mdï¼Œæ·»åŠ æ–°å‚æ•°è¯´æ˜
- âœ… æ›´æ–° example.pyï¼Œä¿®å¤å‚æ•°é”™è¯¯
- âœ… æ·»åŠ å¿«é€Ÿå¼€å§‹æŒ‡å—
- âœ… æ·»åŠ å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰éƒ¨åˆ†

#### v1.2.4 (2025-12-01)
**æ–°å¢åŠŸèƒ½**ï¼š
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ

---

## æ›´æ–°æ—¥å¿—

### 2026-01-27
- ğŸ‰ å®ç° SingleFeatureRuleMiner å¡æ–¹åˆ†ç®±åŠŸèƒ½
- ğŸ‰ å®ç° TreeRuleExtractor å¡æ–¹éšæœºæ£®æ—ç®—æ³•
- ğŸ‰ æ·»åŠ å¿«é€Ÿå¼€å§‹æŒ‡å—å’Œ FAQ
- ğŸ‰ ä¿®å¤æ‰€æœ‰æ–‡æ¡£é”™è¯¯å’Œå‚æ•°é”™è¯¯

### 2025-12-01
- ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ

---

## â“ å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

### Q1: å¦‚ä½•é€‰æ‹©åˆé€‚çš„è§„åˆ™æŒ–æ˜ç®—æ³•ï¼Ÿ

**A**: æ ¹æ®ä¸åŒçš„ä¸šåŠ¡åœºæ™¯é€‰æ‹©ç®—æ³•ï¼š
- **DTï¼ˆå†³ç­–æ ‘ï¼‰**ï¼šé€‚åˆå¿«é€Ÿæ¢ç´¢å’Œåˆæ­¥åˆ†æï¼Œè§„åˆ™ç®€å•æ˜“æ‡‚
- **RFï¼ˆéšæœºæ£®æ—ï¼‰**ï¼šé€‚åˆç”Ÿäº§ç¯å¢ƒï¼Œè§„åˆ™ç¨³å®šæ€§å¥½ï¼Œå¤šæ ·æ€§é«˜
- **CHI2ï¼ˆå¡æ–¹å†³ç­–æ ‘ï¼‰**ï¼šé€‚åˆåˆ†ç±»ç‰¹å¾è¾ƒå¤šçš„åœºæ™¯
- **GBDTï¼ˆæ¢¯åº¦æå‡æ ‘ï¼‰**ï¼šé€‚åˆå¤æ‚åœºæ™¯ï¼Œè§„åˆ™ç²¾åº¦é«˜
- **ISFï¼ˆå­¤ç«‹æ£®æ—ï¼‰**ï¼šé€‚åˆæŒ–æ˜å¼‚å¸¸æ ·æœ¬çš„è§„åˆ™

### Q2: å¦‚ä½•é…ç½®ç‰¹å¾è¶‹åŠ¿ï¼ˆfeature_trendsï¼‰ï¼Ÿ

**A**: ç‰¹å¾è¶‹åŠ¿ç”¨äºé¿å…ä¸ç¬¦åˆä¸šåŠ¡è§£é‡Šæ€§çš„è§„åˆ™ï¼š
```python
feature_trends={
    'ALI_FQZSCORE': -1,      # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
    'BAIDU_FQZSCORE': -1,    # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
    'NUMBER OF LOAN APPLICATIONS TO PBOC': 1  # æ­£ç›¸å…³ï¼šç”³è¯·æ¬¡æ•°è¶Šå¤šï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
}
```

### Q3: å¦‚ä½•è®¡ç®—æŸå¤±ç‡æŒ‡æ ‡ï¼Ÿ

**A**: éœ€è¦åœ¨åˆå§‹åŒ–æ—¶æä¾›é‡‘é¢å­—æ®µå’Œé€¾æœŸé‡‘é¢å­—æ®µï¼š
```python
# å¯¹äºè§„åˆ™æŒ–æ˜å™¨
tree_miner = TreeRuleExtractor(
    df, 
    target_col='ISBAD',
    amount_col='AMOUNT',      # é‡‘é¢å­—æ®µå
    ovd_bal_col='OVD_BAL'      # é€¾æœŸé‡‘é¢å­—æ®µå
)

# å¯¹äºå¤šç‰¹å¾äº¤å‰è§„åˆ™æŒ–æ˜å™¨
multi_miner = MultiFeatureRuleMiner(
    df, 
    target_col='ISBAD',
    amount_col='AMOUNT',      # é‡‘é¢å­—æ®µå
    ovd_bal_col='OVD_BAL'      # é€¾æœŸé‡‘é¢å­—æ®µå
)
```

### Q4: å¦‚ä½•è¯„ä¼°è§„åˆ™çš„å®é™…æ•ˆæœï¼Ÿ

**A**: ä½¿ç”¨ `analyze_rules` å‡½æ•°è¯„ä¼°è§„åˆ™æ•ˆåº¦ï¼š
```python
# é€šè¿‡ç”¨æˆ·è¯„çº§è¯„ä¼°
result_by_rating = analyze_rules(
    hit_rule_df, 
    rule_col='RULE',
    user_id_col='USER_ID',
    user_level_badrate_col='USER_LEVEL_BADRATE',
    hit_date_col='HIT_DATE',
    include_stability=True
)

# é€šè¿‡ç›®æ ‡æ ‡ç­¾è¯„ä¼°
result_by_target = analyze_rules(
    hit_rule_df, 
    rule_col='RULE',
    user_id_col='USER_ID',
    user_target_col='USER_TARGET',
    hit_date_col='HIT_DATE',
    include_stability=True
)
```

### Q5: å¦‚ä½•è¯†åˆ«å†—ä½™è§„åˆ™ï¼Ÿ

**A**: ä½¿ç”¨è§„åˆ™ç›¸å…³æ€§åˆ†æè¯†åˆ«å†—ä½™è§„åˆ™ï¼š
```python
# è§„åˆ™ç›¸å…³æ€§åˆ†æ
correlation_matrix, max_correlation = analyze_rule_correlation(
    hit_rule_df, 
    rule_col='RULE', 
    user_id_col='USER_ID'
)

# æŸ¥çœ‹æ¯æ¡è§„åˆ™çš„æœ€å¤§ç›¸å…³æ€§
for rule, corr in max_correlation.items():
    print(f"{rule}: {corr['max_correlation_value']:.4f}")
```

å¦‚æœä¸¤æ¡è§„åˆ™çš„ç›¸å…³æ€§è¿‡é«˜ï¼ˆ> 0.8ï¼‰ï¼Œåˆ™è¯´æ˜å®ƒä»¬å­˜åœ¨å†—ä½™ï¼Œå¯ä»¥è€ƒè™‘åˆ é™¤å…¶ä¸­ä¸€æ¡ã€‚

### Q6: å¦‚ä½•ä¼˜åŒ–è§„åˆ™ç»„åˆï¼Ÿ

**A**: ä½¿ç”¨ç­–ç•¥å¢ç›Šè®¡ç®—è¯„ä¼°ä¸åŒè§„åˆ™ç»„åˆçš„æ•ˆæœï¼š
```python
# å®šä¹‰ä¸¤ä¸ªç­–ç•¥ç»„
strategy1 = ['rule1', 'rule2']
strategy2 = ['rule1', 'rule2', 'rule3']

# è®¡ç®—ç­–ç•¥å¢ç›Š
gain = calculate_strategy_gain(
    hit_rule_df, 
    strategy1, 
    strategy2, 
    user_target_col='USER_TARGET'
)
print(f"ç­–ç•¥å¢ç›Š: {gain:.4f}")
```

å¦‚æœå¢ç›Šå€¼è¾ƒé«˜ï¼Œè¯´æ˜æ·»åŠ æ–°è§„åˆ™èƒ½å¸¦æ¥æ˜¾è‘—ä»·å€¼ã€‚

### Q7: å¦‚ä½•åœ¨ç¦»çº¿ç¯å¢ƒä¸­ä½¿ç”¨ï¼Ÿ

**A**: å‚è€ƒæ–‡æ¡£ä¸­çš„"ç¦»çº¿ä½¿ç”¨æ–¹å¼"éƒ¨åˆ†ï¼Œä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š
1. **ç¦»çº¿å®‰è£…ruleliftåŠç›¸å…³ä¾èµ–**ï¼šåœ¨æœ‰ç½‘ç»œçš„ç¯å¢ƒä¸­ä¸‹è½½ä¾èµ–åŒ…ï¼Œç„¶åä¼ è¾“åˆ°ç¦»çº¿ç¯å¢ƒå®‰è£…
2. **é€šè¿‡æºç ç›´æ¥è°ƒç”¨**ï¼šä¸‹è½½æºç åŒ…ï¼Œæ‰‹åŠ¨å®‰è£…ä¾èµ–ï¼Œç„¶ååœ¨Pythonä»£ç ä¸­æ·»åŠ æºç è·¯å¾„å¹¶å¯¼å…¥

### Q8: å¦‚ä½•å¤„ç†ç¼ºå¤±å€¼ï¼Ÿ

**A**: rulelift ä¼šè‡ªåŠ¨å¤„ç†ç¼ºå¤±å€¼ï¼š
- å¯¹äºæ•°å€¼å‹ç‰¹å¾ï¼šç¼ºå¤±å€¼ä¼šè¢«å¡«å……ä¸º0
- å¯¹äºç±»åˆ«å‹ç‰¹å¾ï¼šç¼ºå¤±å€¼ä¼šè¢«å¡«å……ä¸º'missing'
- ç”¨æˆ·ä¹Ÿå¯ä»¥åœ¨ä¼ å…¥æ•°æ®å‰è‡ªè¡Œå¤„ç†ç¼ºå¤±å€¼

### Q9: å¦‚ä½•è°ƒæ•´æ ‘æ¨¡å‹çš„å¤æ‚åº¦ï¼Ÿ

**A**: é€šè¿‡ä»¥ä¸‹å‚æ•°æ§åˆ¶æ ‘æ¨¡å‹çš„å¤æ‚åº¦ï¼š
- `max_depth`ï¼šå†³ç­–æ ‘æœ€å¤§æ·±åº¦ï¼Œå€¼è¶Šå¤§è§„åˆ™è¶Šå¤æ‚
- `min_samples_split`ï¼šåˆ†è£‚èŠ‚ç‚¹æ‰€éœ€çš„æœ€å°æ ·æœ¬æ•°ï¼Œå€¼è¶Šå¤§è§„åˆ™è¶Šä¿å®ˆ
- `min_samples_leaf`ï¼šå¶å­èŠ‚ç‚¹çš„æœ€å°æ ·æœ¬æ•°ï¼Œå€¼è¶Šå¤§å¶å­èŠ‚ç‚¹åŒ…å«çš„æ ·æœ¬è¶Šå¤š
- `n_estimators`ï¼šæ ‘çš„æ•°é‡ï¼Œå€¼è¶Šå¤§æ¨¡å‹è¶Šç¨³å®šä½†è®­ç»ƒæ—¶é—´è¶Šé•¿

### Q10: å¦‚ä½•å¯¼å‡ºè§„åˆ™åˆ†æç»“æœï¼Ÿ

**A**: æ”¯æŒå¤šç§å¯¼å‡ºæ–¹å¼ï¼š
```python
# å¯¼å‡ºä¸ºCSV
rules_df.to_csv('rules.csv', index=False, encoding='utf-8-sig')

# å¯¼å‡ºä¸ºExcel
rules_df.to_excel('rules.xlsx', index=False)

# ç”Ÿæˆäº¤å‰çŸ©é˜µExcelæ–‡ä»¶
cross_matrices = multi_miner.generate_cross_matrices_excel(
    features_list=['ALI_FQZSCORE', 'BAIDU_FQZSCORE'], 
    output_path='cross_analysis.xlsx'
)
```

### Q11: å¦‚ä½•å¯è§†åŒ–åˆ†æç»“æœï¼Ÿ

**A**: rulelift æä¾›äº†ä¸°å¯Œçš„å¯è§†åŒ–åŠŸèƒ½ï¼š
```python
# ç‰¹å¾é‡è¦æ€§å›¾
tree_miner.plot_feature_importance(save_path='feature_importance.png')

# å†³ç­–æ ‘ç»“æ„å›¾
tree_miner.plot_decision_tree(save_path='decision_tree.pdf')

# è§„åˆ™è¯„ä¼°å›¾
tree_miner.plot_rule_evaluation(save_path='rule_evaluation.png')

# äº¤å‰ç‰¹å¾çƒ­åŠ›å›¾
multi_miner.plot_cross_heatmap(feature1, feature2, metric='lift')
```

---

## è®¸å¯è¯

MIT License

---

## é¡¹ç›®åœ°å€

- GitHub: https://github.com/aialgorithm/rulelift
- PyPI: https://pypi.org/project/rulelift/

---

## è”ç³»æ–¹å¼

å¾®ä¿¡&github: aialgorithm
é‚®ç®±: 15880982687@qq.com

---

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼å¦‚æœæ‚¨æœ‰ä»»ä½•å»ºè®®æˆ–é—®é¢˜ï¼Œè¯·é€šè¿‡ GitHub Issues åé¦ˆã€‚
 https://github.com/aialgorithm/rulelift/issues
---

**å¼€å§‹ä½¿ç”¨ rulelift ä¼˜åŒ–æ‚¨çš„é£æ§è§„åˆ™ç³»ç»Ÿå§ï¼** ğŸš€
