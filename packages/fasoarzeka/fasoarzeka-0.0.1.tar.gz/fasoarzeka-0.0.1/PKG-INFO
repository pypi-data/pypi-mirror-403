Metadata-Version: 2.4
Name: fasoarzeka
Version: 0.0.1
Summary: API non officielle de paiement mobile pour le service FASO ARZEKA au Burkina Faso
Home-page: https://github.com/parice02/fasoarzeka
Author: Mohamed Zeba
Author-email: Mohamed ZEBA <m.zeba@mzeba.dev>
License-Expression: MIT
Project-URL: Homepage, https://github.com/mzeba/fasoarzeka
Project-URL: Issues, https://github.com/mzeba/fasoarzeka/issues
Project-URL: Repository, https://github.com/mzeba/fasoarzeka.git
Keywords: fasoarzeka ,burkina payment api,mobile money,payment api,burkina faso
Classifier: Development Status :: 4 - Beta
Classifier: Programming Language :: Python :: 3
Classifier: Operating System :: OS Independent
Requires: request
Requires: urllib3
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: requests>=2.31.0
Requires-Dist: urllib3<1.27
Dynamic: author
Dynamic: home-page
Dynamic: license-file
Dynamic: requires

# FASO ARZEKA Mobile Money Payment API (Burkina Faso)

[![Python 3.9+](https://img.shields.io/badge/python-3.9+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

API client Python non officiel pour les paiements mobiles FASO ARZEKA au Burkina Faso v3.0.1.
Client robuste, production-ready avec gestion automatique des erreurs, retry automatique, et rÃ©authentification automatique.

## âœ¨ FonctionnalitÃ©s principales

- âœ… **Authentification sÃ©curisÃ©e** avec gestion automatique des tokens
- âœ… **RÃ©authentification automatique** quand le token expire
- âœ… **Gestion complÃ¨te des erreurs** avec exceptions personnalisÃ©es
- âœ… **Retry automatique** avec backoff exponentiel
- âœ… **Logging intÃ©grÃ©** pour traÃ§abilitÃ© complÃ¨te
- âœ… **Session persistante** pour meilleures performances
- âœ… **Type hints complets** pour meilleure auto-complÃ©tion
- âœ… **Context manager** pour gestion automatique des ressources
- âœ… **Validation des tokens** avec informations d'expiration
- âœ… **Tests unitaires complets** avec couverture >90%

## ğŸ“‹ PrÃ©requis

1. **Compte API Arzeka Money**
   - Username
   - Password
   - Hash Secret
   - Merchant ID

2. **Certificats SSL** (si fournis par l'opÃ©rateur)

3. **Python 3.9 ou supÃ©rieur**

## ğŸ“¦ DÃ©pendances

```txt
requests>=2.31.0
setuptools
urllib3
```

Le client nÃ©cessite Python 3.9 ou supÃ©rieur.

## ğŸš€ Installation

```bash
# Avec pip
pip install git+https://github.com/parice02/fasoarzeka.git

# Avec poetry
poetry add git+https://github.com/parice02/fasoarzeka.git

# Installation en mode dÃ©veloppement
git clone https://github.com/parice02/fasoarzeka.git
cd fasoarzeka
pip install -e .
```

## ğŸ¯ Guide de dÃ©marrage rapide

### Option 1 : Utilisation avec fonctions de convenance (RecommandÃ©)

```python
from arzeka import authenticate, initiate_payment, check_payment

# 1. Authentifiez-vous une fois
auth = authenticate("your_username", "your_password")
print(f"Token expires in: {auth['expires_in']} seconds")

# 2. Initiez un paiement
payment_data = {
    "amount": 1000,  # Montant en FCFA (minimum 100)
    "merchant_id": "MERCHANT_123",
    "additional_info": {
        "first_name": "Jean",
        "last_name": "Dupont",
        "mobile": "22670123456"  # NumÃ©ro avec indicatif
    },
    "mapped_order_id": "eT20220923.203221.24732",
    "hash_secret": "your_hash_secret",
    "link_for_update_status": "https://example.com/webhook",
    "link_back_to_calling_website": "https://example.com/return"
}

response = initiate_payment(payment_data)
print(f"URL to redirect user for payment: {response['url']}")

# 3. VÃ©rifiez le statut du paiement
payment_response = check_payment(payment_data['mapped_order_id'])
print(f"Payment status: {payment_response['status']}")
```

### Option 2 : Utilisation avec instance de classe

```python
from arzeka import ArzekaPayment

# Utilisez le context manager pour gestion automatique
with ArzekaPayment() as client:
    # 1. Authentification
    auth = client.authenticate("your_username", "your_password")

    # 2. VÃ©rifiez la validitÃ© du token
    if client.is_token_valid():
        print("Token is valid")

    # 3. Initiez un paiement
    response = client.initiate_payment(
        amount=1000,
        merchant_id="MERCHANT_123",
        additional_info={
            "first_name": "Jean",
            "last_name": "Dupont",
            "mobile": "70123456"
        },
        mapped_order_id="eT20220923.203221.24732",
        hash_secret="your_hash_secret",
        link_for_update_status="https://example.com/webhook",
        link_back_to_calling_website="https://example.com/return"
    )

    # 4. VÃ©rifiez le statut
    status = client.check_payment("eT20220923.203221.24732")

# Le client est automatiquement fermÃ©
```

## ğŸ“š Exemples dÃ©taillÃ©s

### Authentification et gestion des tokens

```python
from arzeka import ArzekaPayment

client = ArzekaPayment()

# Authentification
auth = client.authenticate("username", "password")
print(f"Access Token: {auth['access_token']}")
print(f"Token Type: {auth['token_type']}")
print(f"Expires In: {auth['expires_in']} seconds")

# VÃ©rifier la validitÃ© du token
if client.is_token_valid():
    print("Token is still valid")
else:
    print("Token has expired")

# Obtenir des informations dÃ©taillÃ©es sur le token
info = client.get_token_expiry_info()
print(f"Expires in {info['expires_in_minutes']:.1f} minutes")
print(f"Is expired: {info['is_expired']}")

client.close()
```

### RÃ©authentification automatique

```python
from arzeka import ArzekaPayment

client = ArzekaPayment()
client.authenticate("username", "password")

# Faites plusieurs requÃªtes sur une longue pÃ©riode
# La rÃ©authentification est AUTOMATIQUE si le token expire

for i in range(10):
    # Pas besoin de vÃ©rifier la validitÃ© du token !
    # Le client se rÃ©authentifie automatiquement si nÃ©cessaire
    response = client.initiate_payment(
        amount=1000,
        merchant_id="MERCHANT_123",
        additional_info={...},
        hash_secret="secret",
        link_for_update_status="https://...",
        link_back_to_calling_website="https://..."
    )
    print(f"Payment {i+1}: {response['mappedOrderId']}")

client.close()
```

### Initialisation de paiement avec reÃ§u

```python
from arzeka import initiate_payment, authenticate

# Authentifiez-vous d'abord
authenticate("username", "password")

# Paiement avec gÃ©nÃ©ration de reÃ§u
payment_data = {
    "amount": 5000,
    "merchant_id": "MERCHANT_123",
    "additional_info": {
        "first_name": "Marie",
        "last_name": "KaborÃ©",
        "mobile": "70987654",
        "generateReceipt": True,  # Activer la gÃ©nÃ©ration de reÃ§u
        "paymentDescription": "Facture NÂ°12345",
        "accountingOffice": "Bureau Principal",
        "accountantName": "Jean TraorÃ©",
        "address": "Ouagadougou, Burkina Faso"
    },
    "hash_secret": "your_secret",
    "link_for_update_status": "https://example.com/webhook",
    "link_back_to_calling_website": "https://example.com/return",
    "mapped_order_id": "ORDER-2025-001"  # ID personnalisÃ©
}

response = initiate_payment(payment_data)
print(f"Payment URL: {response.get('payment_url')}")
print(f"Order ID: {response.get('mappedOrderId')}")
```

### VÃ©rification de paiement

```python
from arzeka import check_payment, authenticate

authenticate("username", "password")

# VÃ©rification simple
status = check_payment("ORDER-2025-001")
print(f"Status: {status}")

# VÃ©rification avec transaction ID
status = check_payment(
    mapped_order_id="ORDER-2025-001",
    transaction_id="TXN-12345"
)
print(f"Transaction Status: {status}")
```

### Utilisation des fonctions utilitaires

```python
from arzeka import get_reference, format_msisdn, validate_phone_number

# GÃ©nÃ©rer un ID de rÃ©fÃ©rence unique
ref = get_reference()
print(f"Reference: {ref}")  # Ex: REF-20251023-123456

# Formater un numÃ©ro de tÃ©lÃ©phone
msisdn = format_msisdn("70 12 34 56")
print(f"Formatted: {msisdn}")  # 22670123456

# Valider un numÃ©ro burkinabÃ¨
is_valid = validate_phone_number("70123456")
print(f"Valid: {is_valid}")  # True
```

## ğŸ”’ Gestion des erreurs

Le client fournit des exceptions spÃ©cifiques pour diffÃ©rents types d'erreurs :

```python
from arzeka import ArzekaPayment

from exceptions import (
    ArzekaPaymentError,
    ArzekaConnectionError,
    ArzekaValidationError,
    ArzekaAPIError,
    ArzekaAuthenticationError
)

client = ArzekaPayment()

try:
    # Tentative d'authentification
    client.authenticate("username", "password")

    # Tentative de paiement
    response = client.initiate_payment(
        amount=1000,
        merchant_id="MERCHANT_123",
        additional_info={...},
        hash_secret="secret",
        link_for_update_status="https://...",
        link_back_to_calling_website="https://..."
    )

except ArzekaAuthenticationError as e:
    print(f"Authentication failed: {e}")

except ArzekaValidationError as e:
    print(f"Invalid data: {e}")

except ArzekaConnectionError as e:
    print(f"Connection error: {e}")

except ArzekaAPIError as e:
    print(f"API error: {e}")
    print(f"Status code: {e.status_code}")
    print(f"Response: {e.response_data}")

except ArzekaPaymentError as e:
    print(f"General error: {e}")

finally:
    client.close()
```

## âš™ï¸ Configuration

### Variables d'environnement (recommandÃ©)

```bash
# .env
ARZEKA_USERNAME=your_username
ARZEKA_PASSWORD=your_password
ARZEKA_MERCHANT_ID=MERCHANT_123
ARZEKA_HASH_SECRET=your_hash_secret
ARZEKA_BASE_URL=https://pwg-test.fasoarzeka.com/AvepayPaymentGatewayUI/avepay-payment/
```

```python
import os
from arzeka import ArzekaPayment

client = ArzekaPayment(
    base_url=os.getenv('ARZEKA_BASE_URL'),
    timeout=30
)

client.authenticate(
    os.getenv('ARZEKA_USERNAME'),
    os.getenv('ARZEKA_PASSWORD')
)
```

### Configuration du logging

```python
import logging
from arzeka import ArzekaPayment

# Configurer le niveau de log
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)

client = ArzekaPayment()
# Les logs dÃ©taillÃ©s seront affichÃ©s
```

## ğŸ§ª Tests

Le projet inclut des tests unitaires complets :

```bash
# ExÃ©cuter tous les tests
python -m pytest test/

# ExÃ©cuter avec couverture
python -m pytest test/ --cov=arzeka --cov-report=html

# ExÃ©cuter un test spÃ©cifique
python -m pytest test/test.py::TestArzekaPayment::test_authenticate

# Mode verbose
python -m pytest test/ -v
```

## ğŸ“– Documentation complÃ¨te

### Documentation style ReadTheDocs

**ğŸ“š Documentation HTML complÃ¨te disponible dans `docs_sphinx/`**

Pour gÃ©nÃ©rer et consulter la documentation :

```bash
cd docs_sphinx
pip install -r requirements.txt
./build.sh
# Puis ouvrez _build/html/index.html dans votre navigateur
```

La documentation comprend :
- Guide d'installation dÃ©taillÃ©
- Guide de dÃ©marrage rapide
- Guide d'authentification complet
- RÃ©fÃ©rence API complÃ¨te avec autodoc
- Exemples de code annotÃ©s
- Guide de gestion d'erreurs
- FonctionnalitÃ©s avancÃ©es
- Guide de contribution

### Guides Markdown

- **[Guide de dÃ©marrage rapide](docs/QUICKSTART.md)** - Commencer en 5 minutes
- **[Guide d'authentification](docs/AUTHENTICATION.md)** - Tout sur l'authentification
- **[Validation des tokens](docs/TOKEN_VALIDATION.md)** - Gestion des tokens
- **[RÃ©authentification automatique](docs/AUTO_REAUTH.md)** - FonctionnalitÃ© avancÃ©e

### Exemples de code

- **[Exemples pratiques](examples/)** - Code exÃ©cutable
  - `authentication_example.py` - Exemples d'authentification
  - `token_validation_example.py` - Validation de tokens
  - `shared_client_example.py` - Instance partagÃ©e
  - `auto_reauth_example.py` - RÃ©authentification automatique

## ğŸ—ï¸ Architecture

```
arzeka-payment/
â”œâ”€â”€ arzeka.py              # Module principal
â”œâ”€â”€ utils.py               # Fonctions utilitaires
â”œâ”€â”€ __init__.py            # Exports publics
â”œâ”€â”€ requirements.txt       # DÃ©pendances
â”œâ”€â”€ setup.py              # Configuration d'installation
â”œâ”€â”€ pyproject.toml        # Configuration Poetry
â”œâ”€â”€ docs/                 # Documentation
â”‚   â”œâ”€â”€ QUICKSTART.md
â”‚   â”œâ”€â”€ AUTHENTICATION.md
â”‚   â””â”€â”€ TOKEN_VALIDATION.md
â”œâ”€â”€ examples/             # Exemples de code
â”‚   â”œâ”€â”€ authentication_example.py
â”‚   â”œâ”€â”€ token_validation_example.py
â”‚   â”œâ”€â”€ shared_client_example.py
â”‚   â””â”€â”€ auto_reauth_example.py
â””â”€â”€ test/                 # Tests unitaires
    â””â”€â”€ test.py
```

## ğŸ”§ Classes et Exceptions

### Classes principales

- **`ArzekaPayment`** - Client principal pour interactions API
- **`BasePayment`** - Classe de base avec gestion session et requÃªtes

### Exceptions personnalisÃ©es

- **`ArzekaPaymentError`** - Exception de base
- **`ArzekaConnectionError`** - Erreurs de connexion rÃ©seau
- **`ArzekaValidationError`** - Erreurs de validation de donnÃ©es
- **`ArzekaAPIError`** - Erreurs retournÃ©es par l'API
- **`ArzekaAuthenticationError`** - Erreurs d'authentification

## ğŸš€ FonctionnalitÃ©s avancÃ©es

### 1. Retry automatique avec backoff exponentiel

```python
# Le client rÃ©essaie automatiquement en cas d'erreur rÃ©seau
# - Maximum 3 tentatives
# - Backoff exponentiel (1s, 2s, 4s)
# - Status codes: 429, 500, 502, 503, 504
client = ArzekaPayment()
# Les retries sont automatiques !
```

### 2. Session persistante avec connection pooling

```python
# Les connexions HTTP sont rÃ©utilisÃ©es pour meilleures performances
client = ArzekaPayment()
# La session est automatiquement gÃ©rÃ©e
```

### 3. Context manager

```python
# Gestion automatique des ressources
with ArzekaPayment() as client:
    client.authenticate("user", "pass")
    response = client.initiate_payment(...)
# Fermeture automatique de la session
```

### 4. Instance partagÃ©e pour fonctions de convenance

```python
from arzeka import authenticate, initiate_payment, get_shared_client, close_shared_client

# Les fonctions partagent une mÃªme instance
authenticate("user", "pass")
initiate_payment(payment_data)

# AccÃ©der Ã  l'instance partagÃ©e
client = get_shared_client()
print(client.is_token_valid())

# Nettoyer l'instance partagÃ©e
close_shared_client()
```

## ğŸ’¡ Bonnes pratiques

### 1. Utiliser les variables d'environnement

```python
import os
from arzeka import authenticate

username = os.getenv('ARZEKA_USERNAME')
password = os.getenv('ARZEKA_PASSWORD')
authenticate(username, password)
```

### 2. Utiliser le context manager

```python
with ArzekaPayment() as client:
    client.authenticate("user", "pass")
    # ... opÃ©rations ...
# Nettoyage automatique
```

### 3. GÃ©rer les exceptions spÃ©cifiques

```python
try:
    response = client.initiate_payment(...)
except ArzekaValidationError:
    # DonnÃ©es invalides
except ArzekaAuthenticationError:
    # ProblÃ¨me d'authentification
except ArzekaConnectionError:
    # ProblÃ¨me rÃ©seau
```

### 4. VÃ©rifier les tokens avant longues opÃ©rations

```python
if client.is_token_valid(margin_seconds=300):  # 5 minutes
    # Token valide pour au moins 5 minutes
    long_operation()
```

### 5. Utiliser le logging pour debug

```python
import logging
logging.basicConfig(level=logging.DEBUG)
# Logs dÃ©taillÃ©s des requÃªtes
```

## ğŸ” API Reference

### ArzekaPayment

```python
class ArzekaPayment(base_url: str = BASE_URL, timeout: int = 30)
```

#### MÃ©thodes

- **`authenticate(username, password)`** - Authentification et obtention du token
- **`initiate_payment(...)`** - Initialiser un paiement
- **`check_payment(mapped_order_id, transaction_id)`** - VÃ©rifier statut paiement
- **`is_token_valid(margin_seconds=60)`** - VÃ©rifier validitÃ© du token
- **`get_token_expiry_info()`** - Obtenir infos dÃ©taillÃ©es sur expiration
- **`close()`** - Fermer la session

### Fonctions utilitaires

- **`get_reference()`** - GÃ©nÃ©rer ID de rÃ©fÃ©rence unique
- **`format_msisdn(phone)`** - Formater numÃ©ro de tÃ©lÃ©phone
- **`validate_phone_number(phone)`** - Valider numÃ©ro burkinabÃ¨

### Fonctions de convenance

- **`authenticate(username, password, base_url, timeout)`** - Authentification
- **`initiate_payment(payment_data, base_url, timeout)`** - Initialiser paiement
- **`check_payment(mapped_order_id, transaction_id, base_url, timeout)`** - VÃ©rifier paiement
- **`get_shared_client()`** - Obtenir instance partagÃ©e
- **`close_shared_client()`** - Fermer instance partagÃ©e

## ğŸ“Š Statut du projet

- âœ… Authentification sÃ©curisÃ©e
- âœ… Initialisation de paiements
- âœ… VÃ©rification de statut
- âœ… Gestion complÃ¨te des erreurs
- âœ… Retry automatique
- âœ… RÃ©authentification automatique
- âœ… Tests unitaires (>90% couverture)
- âœ… Documentation complÃ¨te
- âœ… Type hints complets
- âœ… Logging intÃ©grÃ©
- â³ Publication sur PyPI (Ã  venir)

## ğŸ¤ Contribution

Les contributions sont les bienvenues ! Voici comment contribuer :

1. **Fork** le projet
2. **CrÃ©ez** une branche pour votre fonctionnalitÃ© (`git checkout -b feature/AmazingFeature`)
3. **Committez** vos changements (`git commit -m 'Add some AmazingFeature'`)
4. **Pushez** vers la branche (`git push origin feature/AmazingFeature`)
5. **Ouvrez** une Pull Request

### Guidelines de contribution

- Suivre le style de code existant
- Ajouter des tests pour nouvelles fonctionnalitÃ©s
- Mettre Ã  jour la documentation
- S'assurer que tous les tests passent

## ğŸ“ Changelog

Voir [CHANGELOG.md](CHANGELOG.md) pour l'historique dÃ©taillÃ© des modifications.

## ï¿½ğŸ“„ Licence

Ce projet est sous licence MIT. Voir le fichier [LICENSE](LICENSE) pour plus de dÃ©tails.

## ğŸ‘¥ Auteur

**Mohamed Zeba** - [m.zeba@mzeba.dev](mailto:m.zeba@mzeba.dev)

## ğŸ™ Remerciements

- L'Ã©quipe Arzeka pour l'API
- La communautÃ© Python du Burkina Faso
- Tous les contributeurs

## ğŸ“ Support

- **Issues** : [GitHub Issues](https://github.com/parice02/fasoarzeka/issues)
- **Email** : m.zeba@mzeba.dev
- **Documentation** : [GitHub Wiki](https://github.com/parice02/fasoarzeka/wiki)

## âš ï¸ Avertissement

Ceci est un client **non officiel** pour l'API Arzeka. Utilisez-le Ã  vos propres risques.
Assurez-vous de respecter les conditions d'utilisation de l'API Arzeka.

## ğŸŒŸ Soutenez le projet

Si ce projet vous aide, n'oubliez pas de lui donner une â­ sur GitHub !

---

**Note importante** : Ce client utilise l'environnement de test par dÃ©faut.
Pour la production, assurez-vous de configurer l'URL de production :

```python
from arzeka import ArzekaPayment

client = ArzekaPayment(base_url="https://pwg.fasoarzeka.com/...")
```
