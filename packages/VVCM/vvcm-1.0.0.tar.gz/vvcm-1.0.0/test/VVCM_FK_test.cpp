// #include <gtest/gtest.h>
#include <iostream>
#include <chrono>
#include <Eigen/Dense>
#include "VVCM_FK.hpp"

using namespace VVCM;

int main()
{
    int N = 20;
    float zr = 1000.0;
    MatrixXf Rn(20, 2);
    Rn << 576.276881720430, 162.627551020408,
        636.088709677419, 181.760204081633,
        677.083333333333, 225.127551020408,
        715.389784946237, 288.903061224490,
        744.287634408602, 361.607142857143,
        765.120967741936, 447.066326530613,
        767.137096774194, 544.005102040817,
        748.991935483871, 646.045918367347,
        710.013440860215, 709.821428571429,
        658.938172043011, 745.535714285715,
        604.502688172043, 765.943877551021,
        546.034946236559, 767.219387755102,
        495.631720430108, 726.403061224490,
        461.357526881720, 640.943877551021,
        459.341397849462, 549.107142857143,
        465.389784946237, 461.096938775510,
        481.518817204301, 366.709183673470,
        503.024193548387, 296.556122448980,
        520.497311827957, 235.331632653062,
        542.674731182796, 188.137755102041;
    MatrixXf Vn(20, 2);
    Vn << 512.432795698925, 55.4846938775513,
        621.975806451613, 59.3112244897961,
        725.470430107527, 86.0969387755105,
        814.852150537634, 153.698979591837,
        878.024193548387, 250.637755102041,
        923.723118279570, 392.219387755102,
        933.803763440860, 532.525510204082,
        908.266129032258, 669.005102040817,
        853.158602150538, 796.556122448980,
        769.153225806452, 887.117346938776,
        667.674731182796, 948.341836734694,
        558.131720430108, 964.923469387755,
        445.228494623656, 943.239795918368,
        353.830645161290, 883.290816326531,
        273.185483870968, 781.250000000000,
        203.293010752688, 619.260204081633,
        185.819892473118, 464.923469387755,
        206.653225806452, 325.892857142857,
        269.153225806452, 197.066326530613,
        384.072580645161, 106.505102040817;
    // int N = 6;
    // float zr = 823.0;
    // MatrixXf Rn(6, 2);
    // MatrixXf Vn(6, 2);
    // Rn << -27.419184, -176.293854,
    //     398.141083, -35.190411,
    //     517.018127, 338.271301,
    //     285.155762, 609.95575,
    //     -175.608231, 569.463562,
    //     -301.437988, 194.695297;
    // Vn << -131.665741, -376.508026,
    //     480.675873, -388.066681,
    //     877.700256, 217.088806,
    //     562.778748, 826.754089,
    //     -107.442101, 918.166626,
    //     -453.516937, 284.887146;

    std::cout << "----------------------" << std::endl;

    VVCM_FK a(N, zr, Vn);

    auto beforeTime = std::chrono::steady_clock::now();
    a.update_stable_solutions(Rn);
    auto afterTime = std::chrono::steady_clock::now();
    float duration_second = std::chrono::duration<float>(afterTime - beforeTime).count();
    std::cout << duration_second << "s" << std::endl;

    std::cout << "M: " << a.M << std::endl;

    std::cout << "Po: " << std::endl;
    for (const auto &po : a.Po)
    {
        std::cout << po.transpose() << std::endl;
    }

    std::cout << "Vo: " << std::endl;
    for (const auto &vo : a.Vo)
    {
        std::cout << vo.transpose() << std::endl;
    }

    std::cout << "----------------------" << std::endl;

    return 0;
}
