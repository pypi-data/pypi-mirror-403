version: "3.7"

services:
  zookeeper:
    image: confluentinc/cp-zookeeper:latest
    hostname: zookeeper
    container_name: zookeeper
    restart: unless-stopped
    user: root
    ports:
      - "2287:2287"
    volumes:
      - ./zoo_data:/var/lib/zookeeper/data
      - ./zoo_logs:/var/lib/zookeeper/log
    env_file:
      - zoo.env
    logging:
        driver: "json-file"
        options:
          max-size: "50m"
          max-file: "5"

  kafka:
    image: confluentinc/cp-kafka:latest
    hostname: kafka
    container_name: kafka
    restart: unless-stopped
    user: root
    ports:
      - "9196:9196"
    volumes:
      - ./kafka_data:/var/lib/kafka/data
      - ./server.properties:/etc/kafka/server.properties
#      - ./jolokia-jvm-1.3.7-agent.jar:/usr/local/src/jolokia-jvm-1.3.7-agent.jar
    depends_on:
      - zookeeper
    env_file:
      - kafka.env
    logging:
        driver: "json-file"
        options:
          max-size: "50m"
          max-file: "5"

  influxdb:
    image: influxdb:1.8.10
    container_name: influxdb
    hostname: influxdb
    user: root    
    ports:
      - "8088:8088"
      - "8086:8086"
    command: -config /etc/influxdb/influxdb.conf
    restart: unless-stopped
    volumes:
      - ./influx_data:/var/lib/influxdb
      - ./influxdb.conf:/etc/influxdb/influxdb.conf:ro
      - /etc/influxdb/admin.creds:/etc/influxdb/admin.creds:ro
    env_file:
      - influx.env
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "5"

  grafana:
    container_name: grafana
    hostname: grafana
    image: grafana/grafana:9.4.7
    restart: unless-stopped
    user: root    
    ports:
      - "80:80"
    volumes:
      - ./grafana_data:/var/lib/grafana
    env_file:
      - grafana.env
    logging:
        driver: "json-file"
        options:
          max-size: "50m"
          max-file: "5"


  sgnl-services:
    container_name: sgnl-services
    hostname: sgnl-services
    image: containers.ligo.org/greg/sgnl-microservices:0.0.2
    restart: unless-stopped
    user: root    
    ports:
      - "5000:5000"
    volumes:
      - ./microservices.py:/services/microservices.py  
    logging:
        driver: "json-file"
        options:
          max-size: "50m"
          max-file: "5"
