{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "description": "the config for the task",
  "type": "object",
  "required": ["task_id", "command"],
  "properties": {
    "task_id": { "$ref": "#/$defs/string", "description": "the unique id for the task" },
    "command": { "$ref": "#/$defs/string", "description": "the command to be executed" },
    "retries": { "$ref": "#/$defs/integer", "description": "the number of retries when task failed" },
    "retry_delay": { "$ref": "#/$defs/integer", "description": "the delay in seconds between retries" },

    "loop": { "$ref": "#/$defs/object" },
    "meta": { "$ref": "#/$defs/object" },
    "dag": { "$ref": "#/$defs/object", "description": "the sub dag config"},

    "except": { "$ref": "#/$defs/object" },

    "input": { "$ref": "#/$defs/array" },
    "before_invoked": { "$ref": "#/$defs/array" },
    "after_invoked": { "$ref": "#/$defs/array" },
    "before_each_invoked": { "$ref": "#/$defs/array" },
    "after_each_invoked": { "$ref": "#/$defs/array" }
  },
  "oneOf": [
    { "required": ["dag"] },
    {
      "not": { "required": ["dag"] },
      "required": ["meta"]          
    }
  ],

  "additionalProperties": false,
  "$defs": {
    "array":{
      "type": ["array","null"],
      "minItems": 1,
      "items":{ "type":"object"}
    },
    "string":{
      "type": "string",
      "minLength": 1
    },
    "integer":{
      "type": "integer",
      "minimum": 0
    },
    "object":{
      "type": ["object","null"],
      "minProperties": 1
    }
  }
}