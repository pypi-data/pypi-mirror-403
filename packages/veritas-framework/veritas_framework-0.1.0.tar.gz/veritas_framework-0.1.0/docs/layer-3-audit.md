# Layer 3: Trust Audit

Layer 3 is the final line of defense: **Trust but Verify**. It operates after actions are completed to catch subtle trust erosions, patterns of corner-cutting, or sophisticated deceptions that might slip through Layer 1 and 2.

## Key Principle: The Paper Trail

The Audit layer relies on the comprehensive "Paper Trail" generated by the previous layers. It treats the agent's history as a ledger that can be inspected at any time.

## TrustAuditor Class

The `TrustAuditor` provides tools for analyzing an agent's session or historical behavior.

### Audit Types

1. **Spot Checks**: Randomly selecting a claim and re-running its verification command to ensure the result is still valid.
2. **Full Reviews**: Comprehensive inspection of every piece of evidence in a task.
3. **Pattern Analysis**: Looking for systematic issues across multiple tasks (e.g., "This agent always skips integration tests when nearing a deadline").

## Audit Findings

An audit results in `AuditFinding` objects, which have:
- **Severity**: From `INFO` to `CRITICAL`.
- **Finding Type**: Missing evidence, fabricated content, declining quality, etc.
- **Remediation**: Suggested actions to fix the issue.

## Example: Spot Checking

```python
from veritas.layers.audit import TrustAuditor

# Initialize auditor with the agent's context
auditor = TrustAuditor(agent_ctx)

# Run a spot check on the latest claim
result = await auditor.spot_check(claim="API returns 200", evidence=latest_evidence)

if not result.passed:
    print(f"Audit failed! Trust Score: {result.trust_score}")
    for finding in result.findings:
        print(f"- {finding.description}")
```

## Trust Metrics

The Audit layer tracks metrics to visualize an agent's reliability over time:
- **Verification Rate**: Percentage of actions that were backed by evidence.
- **Violation Rate**: Frequency of trust behavior breaches.
- **Trust Trend**: Is the agent becoming more or less reliable?

## Benefits

- **Post-Hoc Accountability**: Ensures agents know they might be "caught" even if a gate is passed.
- **Continuous Improvement**: Identifies areas where an agent's instructions or tools need refinement.
- **Global Standards**: Provides the data needed to align with NIST or EU ethics guidelines.
