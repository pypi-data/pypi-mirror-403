"""Security Finding event class."""

from __future__ import annotations

from typing import TYPE_CHECKING, Any, Literal

from pydantic import Field

from ocsf._base import OCSFBaseModel

if TYPE_CHECKING:
    from ocsf.v1_0_0.enums.activity_id import ActivityId
    from ocsf.v1_0_0.enums.confidence_id import ConfidenceId
    from ocsf.v1_0_0.enums.impact_id import ImpactId
    from ocsf.v1_0_0.enums.risk_level_id import RiskLevelId
    from ocsf.v1_0_0.enums.severity_id import SeverityId
    from ocsf.v1_0_0.enums.state_id import StateId
    from ocsf.v1_0_0.enums.status_id import StatusId
    from ocsf.v1_0_0.objects.analytic import Analytic
    from ocsf.v1_0_0.objects.attack import Attack
    from ocsf.v1_0_0.objects.cis_control import CisControl
    from ocsf.v1_0_0.objects.compliance import Compliance
    from ocsf.v1_0_0.objects.enrichment import Enrichment
    from ocsf.v1_0_0.objects.finding import Finding
    from ocsf.v1_0_0.objects.kill_chain import KillChain
    from ocsf.v1_0_0.objects.malware import Malware
    from ocsf.v1_0_0.objects.metadata import Metadata
    from ocsf.v1_0_0.objects.object import Object
    from ocsf.v1_0_0.objects.observable import Observable
    from ocsf.v1_0_0.objects.process import Process
    from ocsf.v1_0_0.objects.resource_details import ResourceDetails
    from ocsf.v1_0_0.objects.vulnerability import Vulnerability


class SecurityFinding(OCSFBaseModel):
    """Security Finding events describe findings, detections, anomalies, alerts and/or actions performed by security products

    OCSF Class UID: 1
    Category: findings

    See: https://schema.ocsf.io/1.0.0/classes/security_finding
    """

    # Class identifiers
    class_uid: Literal[1] = Field(
        default=1, description="The unique identifier of the event class."
    )
    category_uid: Literal[0] = Field(default=0, description="The category unique identifier.")
    finding: Finding = Field(
        ...,
        description="Finding object provides details related to a finding generated by security tool",
    )
    metadata: Metadata = Field(..., description="The metadata associated with the event.")
    severity_id: SeverityId = Field(
        ...,
        description="<p>The normalized identifier of the event severity.</p>The normalized severity is a measurement the effort and expense required to manage and resolve an event or incident. Smaller numerical values represent lower impact events, and larger numerical values represent higher impact events.",
    )
    state_id: StateId = Field(
        ..., description="The normalized state identifier of a security finding."
    )
    activity_id: ActivityId | None = Field(
        default=None,
        description="The normalized identifier of the activity that triggered the event.",
    )
    analytic: Analytic | None = Field(
        default=None,
        description="The analytic technique used to create the finding or detection [Recommended]",
    )
    attacks: list[Attack] | None = Field(
        default=None,
        description="The attack object describes the technique and associated tactics as defined by <a target='_blank' href='https://attack.mitre.org/wiki/ATT&CK_Matrix'>ATT&CK Matrix<sup>TM</sup></a>.",
    )
    cis_csc: list[CisControl] | None = Field(
        default=None,
        description="The CIS Critical Security Controls is a list of top 20 actions and practices an organization’s security team can take on such that cyber attacks or malware, are minimized and prevented.",
    )
    compliance: Compliance | None = Field(
        default=None,
        description="The compliance object provides context to compliance findings (e.g., a check against a specific regulatory or best practice framework such as CIS or NIST) and contains compliance related details.",
    )
    confidence: str | None = Field(
        default=None,
        description="The confidence, normalized to the caption of the confidence_id value. In the case of 'Other', it is defined by the event source.",
    )
    confidence_id: ConfidenceId | None = Field(
        default=None,
        description="The normalized confidence refers to the accuracy of the rule that created the finding. A rule with a low confidence means that the finding scope is wide and may create finding reports that may not be malicious in nature. [Recommended]",
    )
    confidence_score: int | None = Field(
        default=None, description="The confidence score as reported by the event source."
    )
    data_sources: list[str] | None = Field(
        default=None, description="The data sources for the finding."
    )
    enrichments: list[Enrichment] | None = Field(
        default=None,
        description='The additional information from an external data source, which is associated with the event. For example add location information for the IP address in the DNS answers:</p><code>[{"name": "answers.ip", "value": "92.24.47.250", "type": "location", "data": {"city": "Socotra", "continent": "Asia", "coordinates": [-25.4153, 17.0743], "country": "YE", "desc": "Yemen"}}]</code>',
    )
    evidence: dict[str, Any] | None = Field(
        default=None, description="The data the finding exposes to the analyst."
    )
    impact: str | None = Field(
        default=None,
        description="The impact , normalized to the caption of the impact_id value. In the case of 'Other', it is defined by the event source.",
    )
    impact_id: ImpactId | None = Field(
        default=None, description="The normalized impact of the finding. [Recommended]"
    )
    impact_score: int | None = Field(
        default=None, description="The impact of the finding, valid range 0-100."
    )
    include: str | None = Field(default=None, description="")
    kill_chain: list[KillChain] | None = Field(
        default=None,
        description="The <a target='_blank' href='https://www.lockheedmartin.com/en-us/capabilities/cyber/cyber-kill-chain.html'>Cyber Kill Chain®</a>.",
    )
    malware: list[Malware] | None = Field(
        default=None, description="The list of malware identified by a finding."
    )
    message: str | None = Field(
        default=None,
        description="The description of the event, as defined by the event source. [Recommended]",
    )
    nist: list[str] | None = Field(
        default=None,
        description="The NIST Cybersecurity Framework recommendations for managing the cybersecurity risk.",
    )
    observables: list[Observable] | None = Field(
        default=None, description="The observables associated with the event."
    )
    process: Process | None = Field(default=None, description="The process object.")
    raw_data: str | None = Field(
        default=None, description="The event data as received from the event source."
    )
    resources: list[ResourceDetails] | None = Field(
        default=None,
        description="Describes details about resources that were affected by the activity/event. [Recommended]",
    )
    risk_level: str | None = Field(
        default=None,
        description="The risk level, normalized to the caption of the risk_level_id value. In the case of 'Other', it is defined by the event source.",
    )
    risk_level_id: RiskLevelId | None = Field(
        default=None, description="The normalized risk level id."
    )
    risk_score: int | None = Field(
        default=None, description="The risk score as reported by the event source."
    )
    severity: str | None = Field(
        default=None,
        description="The event severity, normalized to the caption of the severity_id value. In the case of 'Other', it is defined by the event source.",
    )
    state: str | None = Field(
        default=None, description="The normalized state of a security finding."
    )
    status: str | None = Field(
        default=None,
        description="The event status, normalized to the caption of the status_id value. In the case of 'Other', it is defined by the event source.",
    )
    status_code: str | None = Field(
        default=None,
        description="The event status code, as reported by the event source.<br /><br />For example, in a Windows Failed Authentication event, this would be the value of 'Failure Code', e.g. 0x18.",
    )
    status_detail: str | None = Field(
        default=None,
        description="The status details contains additional information about the event outcome.",
    )
    status_id: StatusId | None = Field(
        default=None, description="The normalized identifier of the event status. [Recommended]"
    )
    unmapped: Object | None = Field(
        default=None,
        description="The attributes that are not mapped to the event schema. The names and values of those attributes are specific to the event source.",
    )
    vulnerabilities: list[Vulnerability] | None = Field(
        default=None,
        description="This object describes vulnerabilities reported in a security finding.",
    )
