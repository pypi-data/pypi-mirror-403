stages:
  - test

default:
  image: python:3.13-alpine

variables:
  UV_VERSION: 0.9.10


.setup-py-env: &setup-py-env
  - apk add make
  - which pipx >/dev/null || pip install pipx && export PATH="$(pipx environment --value PIPX_BIN_DIR):$PATH"
  - which uv >/dev/null || pipx install "uv==$UV_VERSION"

lint:
  stage: test
  before_script:
    - *setup-py-env
    - uv sync --only-dev
  script:
    - make lint

test:
  stage: test
  before_script:
    - *setup-py-env
    - uv sync --all-groups
  script:
    - make test coverage
  coverage: '/^TOTAL.+ ([0-9]{1,3}%)$/'
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage.xml
