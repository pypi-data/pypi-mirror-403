Metadata-Version: 2.4
Name: cnpj-processor
Version: 4.2.0
Summary: Sistema de Processamento de Dados CNPJ da Receita Federal do Brasil
Author-email: Wesley Modanez Freitas <wesley.modanez@gmail.com>
License-Expression: MIT
Project-URL: Homepage, https://github.com/wmodanez/cnpj
Project-URL: Documentation, https://github.com/wmodanez/cnpj/blob/develop/README.md
Project-URL: Repository, https://github.com/wmodanez/cnpj
Project-URL: Issues, https://github.com/wmodanez/cnpj/issues
Keywords: cnpj,receita-federal,dados-abertos,brasil,empresas,estabelecimentos,data-processing,duckdb,parquet
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Intended Audience :: Financial and Insurance Industry
Classifier: Intended Audience :: Science/Research
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Office/Business :: Financial
Classifier: Topic :: Scientific/Engineering :: Information Analysis
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Requires-Python: >=3.9
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: beautifulsoup4>=4.12.0
Requires-Dist: duckdb>=0.10.0
Requires-Dist: python-dotenv>=1.0.0
Requires-Dist: aiohttp[speedups]>=3.9.5
Requires-Dist: aiofiles>=23.2.0
Requires-Dist: rich>=13.9.0
Requires-Dist: pyarrow>=19.0.0
Requires-Dist: matplotlib>=3.8.0
Requires-Dist: polars>=0.20.0
Requires-Dist: seaborn>=0.13.0
Requires-Dist: requests>=2.31.0
Requires-Dist: psutil>=5.9.8
Requires-Dist: pydantic>=2.0.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0.0; extra == "dev"
Requires-Dist: black>=23.0.0; extra == "dev"
Requires-Dist: flake8>=6.0.0; extra == "dev"
Requires-Dist: mypy>=1.0.0; extra == "dev"
Requires-Dist: build>=0.10.0; extra == "dev"
Requires-Dist: twine>=4.0.0; extra == "dev"
Dynamic: license-file

# CNPJ Processor üè¢

[![PyPI version](https://badge.fury.io/py/cnpj-processor.svg)](https://badge.fury.io/py/cnpj-processor)
[![Python 3.9+](https://img.shields.io/badge/python-3.9+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

> Sistema profissional de processamento de dados p√∫blicos CNPJ da Receita Federal do Brasil

Automatize o download, processamento e an√°lise dos dados p√∫blicos de CNPJ com performance excepcional e API simplificada.

## üöÄ Instala√ß√£o

```bash
pip install cnpj-processor
```

## ‚òÅÔ∏è Suporte ao Nextcloud da Receita Federal

**üÜï Integrado**: O cnpj-processor agora suporta nativamente a infraestrutura **Nextcloud** da Receita Federal!

### üéØ Como Funciona

O sistema detecta automaticamente URLs Nextcloud e aplica autentica√ß√£o apropriada:

```python
from cnpj_processor import CNPJProcessor

# Funciona automaticamente com Nextcloud
processor = CNPJProcessor()
success, folder = processor.run()

# O sistema detecta e autentica automaticamente em:
# https://arquivos.receitafederal.gov.br/index.php/s/gn672Ad4CF8N6TK?dir=/Dados/Cadastros/CNPJ
```

### üì¶ Dados Dispon√≠veis

O Nextcloud da Receita Federal disponibiliza:

- **33 pastas hist√≥ricas** desde 2023-05
- **Pasta mais recente**: 2026-01 (37 arquivos, 6.79 GB)
- **Dados completos**: Empresas, Estabelecimentos, S√≥cios, Simples Nacional
- **Atualiza√ß√£o mensal**: Novos dados publicados mensalmente

## ‚ö° In√≠cio R√°pido

### Via Linha de Comando (CLI)

```bash
# Pipeline completo (download + processamento + banco de dados)
cnpj-processor

# Download apenas
cnpj-processor --step download --types empresas estabelecimentos

# Processar painel consolidado por UF
cnpj-processor --step painel --painel-uf GO --painel-situacao 2
```

### Via API Python

```python
from cnpj_processor import CNPJProcessor

# Criar processador
processor = CNPJProcessor()

# Pipeline completo
success, folder = processor.run()

# Painel de empresas ativas em S√£o Paulo
success, folder = processor.run(
    step='painel',
    painel_uf='GO',
    painel_situacao=2  # Ativas
)
```

## üéØ Principais Funcionalidades

### üì• Download Inteligente

- Download ass√≠ncrono de alta performance
- Retomada autom√°tica em caso de falha
- Verifica√ß√£o de integridade de arquivos
- Cache inteligente para evitar downloads duplicados

### ‚öôÔ∏è Processamento Otimizado

- Pipeline paralelo: download e processamento simult√¢neos
- At√© **70% mais r√°pido** que processamento sequencial
- **Padroniza√ß√£o autom√°tica de colunas**: CSVs renomeados conforme padr√£o esperado
- Suporte a m√∫ltiplos tipos: empresas, estabelecimentos, s√≥cios, simples
- Exporta√ß√£o para Parquet com compress√£o eficiente

### üíæ Gest√£o Inteligente de Espa√ßo

- **Limpeza autom√°tica**: Remove ZIPs e arquivos tempor√°rios por padr√£o
- **Banco opcional**: DuckDB criado apenas quando solicitado
- **M√∫ltiplas estrat√©gias**: De 15 GB (apenas banco) at√© 93 GB (tudo)
- **Controle total**: Flags para customizar reten√ß√£o de artefatos

### üé® Painel Consolidado

- Combina√ß√£o inteligente de dados de m√∫ltiplas fontes
- Filtros avan√ßados: UF, situa√ß√£o cadastral, Simples Nacional
- Ideal para an√°lises e dashboards
- Formato otimizado para BI tools

### üíæ Banco de Dados

- Gera√ß√£o autom√°tica de banco DuckDB
- Queries SQL de alta performance
- Integra√ß√£o perfeita com ferramentas de an√°lise

## üìö API Simplificada

A API do `cnpj-processor` foi projetada para ser **simples, poderosa e intuitiva**.

### M√©todos Principais

#### `run()` - M√©todo Universal

Execute qualquer opera√ß√£o com um √∫nico m√©todo:

```python
processor = CNPJProcessor()

# Pipeline completo
processor.run()

# Download espec√≠fico
processor.run(step='download', tipos=['empresas'], remote_folder='2026-01')

# Processamento com economia de espa√ßo
processor.run(
    step='all',
    delete_zips_after_extract=True,
    cleanup_all_after_db=True
)

# Painel customizado
processor.run(
    step='painel',
    painel_uf='GO',
    painel_situacao=2,
    output_subfolder='painel_go_ativas'
)
```

**Par√¢metros do `run()`:**

| Par√¢metro | Tipo | Descri√ß√£o |
| --------- | ---- | --------- |
| `step` | str | Etapa: 'download', 'extract', 'csv', 'process', 'database', 'painel', 'all' |
| `type` | list | Tipos a processar: ['empresas', 'estabelecimentos', 'simples', 'socios'] |
| `remote_folder` | str | Pasta remota (formato AAAA-MM) |
| `output_subfolder` | str | Subpasta de sa√≠da |
| `source_zip_folder` | str | Pasta de origem dos ZIPs (para extract/process) |
| `force_download` | bool | For√ßar re-download |
| `keep_artifacts` | bool | Manter ZIPs e arquivos tempor√°rios (padr√£o: False) |
| `create_database` | bool | Criar banco DuckDB (padr√£o: False) |
| `cleanup_after_db` | bool | Remover parquets ap√≥s criar banco |
| `keep_parquet_after_db` | bool | Manter parquets ap√≥s criar banco |
| `processar_painel` | bool | Processar painel consolidado |
| `painel_uf` | str | Filtrar painel por UF |
| `painel_situacao` | int | Filtrar por situa√ß√£o (1=Nula, 2=Ativa, 3=Suspensa, 4=Inapta, 8=Baixada) |
| `criar_empresa_privada` | bool | Criar subset de empresas privadas |
| `criar_subset_uf` | str | Criar subset por UF |
| `quiet` | bool | Modo silencioso |
| `log_level` | str | N√≠vel de log ('DEBUG', 'INFO', 'WARNING', 'ERROR') |

#### `get_latest_folder()` - Consultar Pasta Mais Recente

```python
processor = CNPJProcessor()
latest = processor.get_latest_folder()
print(f"Pasta mais recente: {latest}")  # '2026-01'
```

#### `get_available_folders()` - Listar Pastas Dispon√≠veis

```python
processor = CNPJProcessor()
folders = processor.get_available_folders()
print(f"Dispon√≠veis: {folders}")  # ['2026-01', '2025-12', ...]
```

## üí° Exemplos Pr√°ticos

### Exemplo 1: Pipeline Completo

```python
from cnpj_processor import CNPJProcessor

processor = CNPJProcessor()
success, folder = processor.run()

if success:
    print(f"‚úÖ Dados processados em: {folder}")
```

### Exemplo 2: Download Seletivo

```python
# Baixar apenas empresas e estabelecimentos
processor = CNPJProcessor()
success, folder = processor.run(
    step='download',
    tipos=['empresas', 'estabelecimentos'],
    remote_folder='2026-01'
)
```

### Exemplo 3: Processamento com Economia de Espa√ßo

```python
# Padr√£o: Remove ZIPs e tempor√°rios automaticamente, mant√©m apenas parquets
processor = CNPJProcessor()
success, folder = processor.run()  # ~20 GB

# M√°xima economia: Criar banco e remover parquets
success, folder = processor.run(
    create_database=True,    # Cria banco DuckDB
    cleanup_after_db=True    # Remove parquets
)  # ~15 GB
```

### Exemplo 4: Painel Anal√≠tico Customizado

```python
# Painel apenas de empresas ativas de Goi√°s
processor = CNPJProcessor()
success, folder = processor.run(
    step='painel',
    painel_uf='GO',
    painel_situacao=2,  # Ativas
    output_subfolder='painel_go_ativas'
)
```

### Exemplo 5: Processar M√∫ltiplos Per√≠odos

```python
processor = CNPJProcessor()
pastas = ['2025-12', '2026-01']

for pasta in pastas:
    print(f"Processando {pasta}...")
    success, folder = processor.run(
        step='all',
        remote_folder=pasta,
        output_subfolder=f'dados_{pasta.replace("-", "_")}'
    )
    print(f"{'‚úÖ' if success else '‚ùå'} {pasta}")
```

### Exemplo 6: Descompacta√ß√£o de ZIPs

```python
# Apenas descompactar arquivos ZIP (sem processar)
processor = CNPJProcessor()
success, folder = processor.run(
    step='extract',
    source_zip_folder='dados-abertos-zip/2026-01'
)

# Gerar CSVs normalizados (sem converter para parquet)
success, folder = processor.run(
    step='csv',
    tipos=['socios'],
    output_csv_folder='csvs_normalizados'
)

# √ötil quando voc√™:
# - Quer verificar conte√∫do dos ZIPs manualmente (extract)
# - Precisa de CSVs com nomes de colunas padronizados (csv)
# - Prefere fazer o processamento depois
# - Usa ferramentas externas para an√°lise dos CSVs

# NOTA: Durante o processamento normal (step='process' ou 'all'),
# os nomes das colunas dos CSVs s√£o automaticamente padronizados
# para corresponder ao esquema esperado do Parquet, sem necessidade
# de configura√ß√£o adicional!
```

### Exemplo 7: Subset Especializado

```python
# Apenas empresas privadas
processor = CNPJProcessor()
success, folder = processor.run(
    step='all',
    tipos=['empresas'],
    criar_empresa_privada=True,
    output_subfolder='empresas_privadas'
)

# Apenas estabelecimentos de uma UF
success, folder = processor.run(
    step='all',
    tipos=['estabelecimentos'],
    criar_subset_uf='GO',
    output_subfolder='estabelecimentos_sp'
)
```

### Exemplo 8: Estrat√©gias de Espa√ßo em Disco

```python
processor = CNPJProcessor()

# Estrat√©gia 1: An√°lise de dados (padr√£o)
success, folder = processor.run()
# Espa√ßo: ~20 GB (apenas parquets)

# Estrat√©gia 2: Com banco de dados
success, folder = processor.run(create_database=True)
# Espa√ßo: ~35 GB (parquets + banco)

# Estrat√©gia 3: M√°xima economia
success, folder = processor.run(
    create_database=True,
    cleanup_after_db=True
)
# Espa√ßo: ~15 GB (apenas banco)

# Estrat√©gia 4: Manter tudo (desenvolvimento)
success, folder = processor.run(
    keep_artifacts=True,
    create_database=True,
    keep_parquet_after_db=True
)
# Espa√ßo: ~93 GB (ZIPs + tempor√°rios + parquets + banco)
```

## üîß Uso via CLI

O `cnpj-processor` tamb√©m oferece interface completa de linha de comando:

```bash
# Pipeline completo
cnpj-processor

# Download de pasta espec√≠fica
cnpj-processor --step download --remote-folder 2026-01

# Apenas descompactar ZIPs (sem processar)
cnpj-processor --step extract --source-zip-folder dados-abertos-zip/2026-01

# Gerar CSVs normalizados
cnpj-processor --step csv --types socios --output-csv-folder csvs_normalizados

# Processar dados j√° descompactados
cnpj-processor --step process --source-zip-folder dados-abertos-zip/2026-01 --output-subfolder processados

# Processar apenas estabelecimentos
cnpj-processor --types estabelecimentos

# Painel filtrado
cnpj-processor --step painel --painel-uf GO --painel-situacao 2

# Criar banco de dados (opcional)
cnpj-processor --create-database

# M√°xima economia de espa√ßo
cnpj-processor --create-database --cleanup-after-db

# Ver pasta mais recente dispon√≠vel
cnpj-processor --show-latest-folder

# Ver vers√£o
cnpj-processor --version

# Ajuda completa
cnpj-processor --help
```

### Atalhos de CLI

Interface otimizada com atalhos intuitivos:

```bash
# Equivalentes (forma completa vs. atalho)
cnpj-processor --types empresas --step download --remote-folder 2026-01
cnpj-processor -t empresas -s download -r 2026-01

# Descompactar e processar com atalhos
cnpj-processor --step extract --source-zip-folder dados-abertos-zip/2026-01
cnpj-processor -s extract -z dados-abertos-zip/2026-01

# Gerar CSVs normalizados com atalhos
cnpj-processor --step csv --types socios
cnpj-processor -s csv -t socios

# Criar banco com economia de espa√ßo
cnpj-processor --create-database --cleanup-after-db --quiet
cnpj-processor -D -c -q

# Manter todos os artefatos
cnpj-processor --keep-artifacts --create-database --keep-parquet-after-db
cnpj-processor -k -D -K

# Painel filtrado
cnpj-processor --step painel --painel-uf GO --painel-situacao 2
cnpj-processor -s painel --painel-uf GO --painel-situacao 2
```

## üìä Estrutura de Dados

### Arquivos Gerados

```folder
parquet/
‚îú‚îÄ‚îÄ 2026-01/                    # Pasta por per√≠odo
‚îÇ   ‚îú‚îÄ‚îÄ empresa/               # Dados de empresas
‚îÇ   ‚îú‚îÄ‚îÄ estabelecimento/       # Dados de estabelecimentos
‚îÇ   ‚îú‚îÄ‚îÄ simples/              # Dados do Simples Nacional
‚îÇ   ‚îú‚îÄ‚îÄ socio/                # Dados de s√≥cios
‚îÇ   ‚îú‚îÄ‚îÄ painel_dados.parquet  # Painel consolidado
‚îÇ   ‚îî‚îÄ‚îÄ cnpj.duckdb          # Banco de dados
```

### Formato Painel

O painel consolidado combina dados de tr√™s fontes:

- **Estabelecimento**: CNPJ, raz√£o social, endere√ßo, situa√ß√£o
- **Empresa**: Nome fantasia, capital social, porte
- **Simples**: Op√ß√£o pelo Simples Nacional, data de inclus√£o

Campos principais:

- `cnpj_basico`: CNPJ raiz (8 d√≠gitos)
- `cnpj_completo`: CNPJ completo (14 d√≠gitos)
- `razao_social`: Nome empresarial
- `nome_fantasia`: Nome fantasia
- `uf`: Unidade Federativa
- `municipio`: Munic√≠pio
- `situacao_cadastral`: Situa√ß√£o (Ativa, Baixada, etc.)
- `opcao_simples`: Se optante pelo Simples
- `capital_social`: Capital social da empresa
- `porte`: Porte da empresa

## üéØ Casos de Uso

### 1. An√°lise de Mercado

```python
# Obter painel de empresas ativas por estado
processor = CNPJProcessor()
success, folder = processor.run(
    step='painel',
    painel_uf='GO',
    painel_situacao=2
)
```

### 2. Compliance e Due Diligence

```python
# Download completo para an√°lise interna
processor = CNPJProcessor()
success, folder = processor.run(
    step='all',
    tipos=['empresas', 'estabelecimentos', 'socios']
)
```

### 3. Data Science / ML

```python
# Preparar dados para modelos
processor = CNPJProcessor()
success, folder = processor.run(
    step='all',
    cleanup_after_db=True  # Mant√©m apenas banco final
)
```

### 4. Dashboards BI

```python
# Gerar painel para PowerBI/Tableau
processor = CNPJProcessor()
success, folder = processor.run(
    step='painel',
    processar_painel=True
)
```

## üîç Requisitos do Sistema

- **Python**: 3.9 ou superior
- **Sistema Operacional**: Windows, Linux, macOS
- **Espa√ßo em Disco**: M√≠nimo 50GB recomendado
- **Mem√≥ria RAM**: M√≠nimo 4GB, recomendado 8GB+
- **Conex√£o Internet**: Necess√°ria para download

## üõ°Ô∏è Tratamento de Erros

```python
from cnpj_processor import CNPJProcessor

processor = CNPJProcessor()

try:
    success, folder = processor.run(
        step='all',
        tipos=['empresas']
    )
    
    if success:
        print(f"‚úÖ Sucesso! Dados em: {folder}")
    else:
        print("‚ö†Ô∏è Conclu√≠do com avisos. Verifique os logs.")
        
except KeyboardInterrupt:
    print("\nüõë Processamento interrompido pelo usu√°rio")
except Exception as e:
    print(f"‚ùå Erro: {e}")
```

## üìà Performance

### Benchmarks

- **Pipeline Otimizado**: 70% mais r√°pido que processamento sequencial
- **Download Ass√≠ncrono**: M√∫ltiplos arquivos simult√¢neos
- **Processamento Paralelo**: Utiliza√ß√£o eficiente de m√∫ltiplos cores
- **Compress√£o Inteligente**: Arquivos Parquet com zstd

### Tempos T√≠picos

| Opera√ß√£o | Tempo Estimado |
| -------- | -------------- |
| Download completo | 5-15 minutos |
| Processamento (todos os tipos) | 10-30 minutos |
| Gera√ß√£o de banco | 2-5 minutos |
| Painel consolidado | 5-10 minutos |

> Tempos variam conforme hardware e conex√£o de rede

## ü§ù Contribuindo

Contribui√ß√µes s√£o bem-vindas! Por favor:

1. Fork o reposit√≥rio
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

## üìù Licen√ßa

Este projeto est√° licenciado sob a Licen√ßa MIT - veja o arquivo [LICENSE](LICENSE) para detalhes.

## üîó Links √öteis

- **PyPI**: <https://pypi.org/project/cnpj-processor/>
- **Documenta√ß√£o Completa**: Ver pasta `docs/` no reposit√≥rio
- **Issues**: Reporte bugs e sugira melhorias
- **Dados CNPJ**: [Receita Federal - Dados P√∫blicos](https://dados.gov.br/dados/conjuntos-dados/cadastro-nacional-da-pessoa-juridica---cnpj)

## üôè Agradecimentos

- Receita Federal do Brasil pela disponibiliza√ß√£o dos dados p√∫blicos
- Comunidade Python pelo ecossistema de ferramentas excepcionais
- Todos os contribuidores do projeto
