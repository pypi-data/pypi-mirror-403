{"version":3,"file":"lib_index_js.efb6d5b5f72a6e1d9dba.js","mappings":"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","sources":["webpack://ggblab/./src/index.ts","webpack://ggblab/./src/widget.tsx"],"sourcesContent":["import {\n  ILayoutRestorer,\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin\n} from '@jupyterlab/application';\nimport { MainAreaWidget, WidgetTracker } from '@jupyterlab/apputils';\n// ILauncher removed: launcher integration is not used in this build\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\n//import { DockLayout } from '@lumino/widgets';\n\nimport { reactIcon } from '@jupyterlab/ui-components';\nimport { GeoGebraWidget } from './widget';\n\n// Import package.json to reflect the package version in the UI log.\nimport pkg from '../package.json';\n\nnamespace CommandIDs {\n  export const create = 'ggblab:create';\n}\n\n// const PANEL_CLASS = 'jp-ggblabPanel';\n\n/**\n * Initialization data for the ggblab extension.\n */\nconst plugin: JupyterFrontEndPlugin<void> = {\n  id: 'ggblab:plugin',\n  description: 'A JupyterLab extension.',\n  autoStart: true,\n  optional: [ISettingRegistry, ILayoutRestorer],\n  activate: (\n    app: JupyterFrontEnd,\n    settingRegistry: ISettingRegistry | null,\n    restorer: ILayoutRestorer | null\n  ) => {\n    console.log(`JupyterLab extension ggblab-${pkg.version} is activated!`);\n\n    if (settingRegistry) {\n      settingRegistry\n        .load(plugin.id)\n        .then(settings => {\n          console.log('ggblab settings loaded:', settings.composite);\n        })\n        .catch(reason => {\n          console.error('Failed to load settings for ggblab.', reason);\n        });\n    }\n\n    const { commands } = app;\n\n    // Tracker for created GeoGebra widgets so they can be restored after reload\n    const tracker = new WidgetTracker<MainAreaWidget<GeoGebraWidget>>({\n      namespace: 'ggblab-tracker'\n    });\n\n    const command = CommandIDs.create;\n    commands.addCommand(command, {\n      caption: 'Create a new React Widget',\n      label: 'React Widget',\n      icon: args => (args['isPalette'] ? undefined : reactIcon),\n      execute: async (args: any) => {\n        console.log('socketPath:', args['socketPath']);\n        const content = new GeoGebraWidget({\n          kernelId: args['kernelId'] || '',\n          commTarget: args['commTarget'] || '',\n          insertMode: args['insertMode'] || 'split-right',\n          socketPath: args['socketPath'] || '',\n          wsPort: args['wsPort'] || 8888\n        });\n        const widget = new MainAreaWidget<GeoGebraWidget>({ content });\n        // make widget id unique so restorer can identify it later\n        const idPart = (args['kernelId'] || '').substring(0, 8);\n        widget.id = `ggblab-${idPart}`;\n        widget.title.label = `GeoGebra (${idPart})`;\n        widget.title.icon = reactIcon;\n\n        // register with tracker so state will be saved for restoration\n        try {\n          await tracker.add(widget);\n        } catch (e) {\n          console.warn('Failed to add widget to tracker:', e);\n        }\n\n        app.shell.add(widget, 'main', {\n          mode: args['insertMode'] || 'split-right'\n        });\n      }\n    });\n\n    // palette.addItem({\n    //   command,\n    //   category: \"Tutorial\",\n    // });\n\n    if (restorer) {\n      // Note: we may in future support restoring the applet's internal\n      // state from an autosave (e.g. localStorage or a persistent store).\n      // That would involve fetching a saved XML/Base64 snapshot and\n      // passing it through `args` or a dedicated `initialXml` prop so the\n      // recreated widget can rehydrate the GeoGebra applet.\n      restorer.restore(tracker, {\n        command,\n        // use widget.id as the saved name so it is unique per widget\n        name: widget => widget.id,\n        // reconstruct args (kernelId) from the saved widget id so the\n        // command can recreate the widget with the same kernel association\n        args: widget => {\n          // Prefer to read the original creation props from the widget content\n          const content: any = (widget && (widget as any).content) || {};\n          const p = content.props || {};\n          // Fallback to reconstructing kernelId from the widget id if not present\n          const id = widget.id || '';\n          const kernelId =\n            p.kernelId ||\n            (id.startsWith('ggblab-') ? id.slice('ggblab-'.length) : '');\n          return {\n            kernelId,\n            commTarget: p.commTarget || '',\n            socketPath: p.socketPath || '',\n            wsPort: p.wsPort || 8888,\n            insertMode: p.insertMode || 'split-right'\n          } as any;\n        }\n      });\n    }\n\n    // Launcher integration removed: no launcher item will be added.\n  }\n};\n\nexport default plugin;\n","/* eslint-disable */\nimport { ReactWidget } from '@jupyterlab/ui-components';\nimport React, { useEffect, useRef /*, useState */ } from 'react';\n//import MetaTags from 'react-meta-tags';\n\nimport { ServerConnection, KernelAPI, KernelConnection, KernelManager } from '@jupyterlab/services';\nimport { PageConfig } from '@jupyterlab/coreutils';\nimport { DockLayout, Widget } from '@lumino/widgets';\nimport { Message } from '@lumino/messaging';\n\n// Global typings are provided in src/declarations.d.ts; avoid duplicate declarations here.\n\n/**\n * React component for a GeoGebra.\n *\n * @returns The React component\n */\nconst GGAComponent = (props: GGAWidgetProps): JSX.Element => {\n // const [kernels, setKernels] = React.useState<any[]>([]);\n    const widgetRef = useRef<HTMLDivElement>(null);\n // const [size, setSize] = useState<{width: number; height: number}>({width: 800, height: 600});\n\n// // Listen to resize events to update size state\n// // but not working as expected in Lumino\n//   useEffect(() => {\n//     window.addEventListener('resize', () => {\n//     if (widgetRef.current) {\n//         setSize({\n//             width: widgetRef.current.offsetWidth,\n//             height: widgetRef.current.offsetHeight,\n//         });\n//         console.log(\"Resized to:\", size.width, size.height);\n//     }\n//     });\n//   }, []);\n\n    console.log(\"Component props: \", props.kernelId, props.commTarget, props.socketPath, props.wsPort);\n    // window.dispatchEvent(new Event('resize'));\n\n    const elementId = \"ggb-element-\" + (props?.kernelId || '').substring(0, 8);\n    console.log(\"Element ID:\", elementId);\n\n    let applet: any = null;\n\n    function isArrayOfArrays(value: any): boolean {\n        return Array.isArray(value) && value.every(subArray => Array.isArray(subArray));\n    }\n\n    /**\n     * Calls a remote procedure on kernel2 to send a message via remote socket between kernel2 to kernel.\n     * Executes Python code on kernel2 that sends the message through either a unix socket or websocket.\n     * \n     * Note on WebSocket Connection Handling:\n     * Previous attempts to maintain persistent websocket connections using ping/pong (keep-alive)\n     * were unsuccessful. Websocket connections established via kernel2.requestExecute() execute\n     * within isolated contexts that are torn down immediately after the code execution completes.\n     * Even with ping/pong mechanisms, connections would be disconnected once the kernel's\n     * requestExecute() context ended. Therefore, the implementation creates new socket connections\n     * for each message send operation, which is more reliable than attempting to maintain\n     * persistent but fragile connections.\n     * \n     * @param kernel2 - The kernel to execute the remote procedure on\n     * @param message - The message to send (as a JSON string)\n     * @param socketPath - Optional unix socket path (if provided, uses unix socket; otherwise uses websocket)\n     * @param wsUrl - WebSocket URL (used if socketPath is not provided)\n     */\n    async function callRemoteSocketSend(\n        kernel2: any,\n        message: string,\n        socketPath: string | null,\n        wsUrl: string\n    ): Promise<void> {\n        if (socketPath) {\n            await kernel2.requestExecute({ code: `\nwith unix_connect(\"${socketPath}\") as ws:\n    ws.send(r\"\"\"${message}\"\"\")\n`\n            }).done;\n        } else {\n            await kernel2.requestExecute({ code: `\nwith connect(\"${wsUrl}\") as ws:\n    ws.send(r\"\"\"${message}\"\"\")\n`\n            }).done;\n        }\n    }\n\n    useEffect(() => {\n        // Track resources created during effect so we can clean them up precisely\n        let kernel2: any = null;\n        let kernelManager: any = null;\n        let kernelConn: any = null;\n        let comm: any = null;\n        let observer: MutationObserver | null = null;\n        let resizeHandler: (() => void) | null = null;\n        let closeHandler: (() => void) | null = null;\n        let metaViewport: HTMLMetaElement | null = null;\n        let scriptTag: HTMLScriptElement | null = null;\n\n        (async () => {\n            return await KernelAPI.listRunning();\n        })().then(async (kernels) => {\n         // setKernels(kernels);\n            console.log(\"Running kernels:\", kernels);\n\n            const baseUrl = PageConfig.getBaseUrl();\n            const token   = PageConfig.getToken();\n            console.log(`Base URL: ${baseUrl}`);\n            console.log(`Token: ${token}`);\n            const settings = ServerConnection.makeSettings({\n                baseUrl: baseUrl, //'http://localhost:8889/',\n                token: token,     //'7e89be30eb93ee7c149a839d4c7577e08c2c25b3c7f14647',\n                appendToken: true,\n            });\n\n            kernelManager = new KernelManager({ serverSettings: settings });\n            kernel2 = await kernelManager.startNew({ name: 'python3' });\n            console.log(\"Started new kernel:\", kernel2, props.kernelId);\n            await kernel2.requestExecute({ code: `from websockets.sync.client import unix_connect, connect` }).done;\n\n            const wsUrl = `ws://localhost:${props.wsPort}/`;\n            const socketPath = props.socketPath || null;\n\n            kernelConn = new KernelConnection({\n                model: { name: 'python3', id: props.kernelId || kernels[0]['id']},\n                serverSettings: settings,\n            });\n            console.log(\"Connected to kernel:\", kernelConn);\n\n            async function ggbOnLoad(api: any) {\n                console.log(\"GeoGebra applet loaded:\", api);\n                (async function () {\n                    var msg = {\n                        \"type\": \"start\",\n                        \"payload\": {}\n                    }\n                    await callRemoteSocketSend(kernel2, JSON.stringify(msg), socketPath, wsUrl);\n                })();\n\n                resizeHandler = function() {\n                    const wrapperDiv = document.getElementById(elementId);\n                    const parentDiv = wrapperDiv?.parentElement\n                    const width  = parseInt(parentDiv?.style.width || \"800\");\n                    const height = parseInt(parentDiv?.style.height || \"600\");\n                    api.recalculateEnvironments()\n                    api.setSize(width, height);\n                }\n                window.addEventListener('resize', resizeHandler);\n                resizeHandler();\n\n                // // Observe size changes of the widget's DOM element\n                // // but not working as expected in Lumino\n                // const widgetElemnt = window.document.querySelector('div.lm-DockPanel-widget');\n                // const widgetElemnt = window.document.querySelector('div.lm-SplitPanel-child');\n                // const widgetElemnt = window.document.querySelector('div[class*=\"Panel\"]');\n                // if (widgetElemnt) {\n                // if (widgetRef.current) {\n                //     const resizeObserver = new ResizeObserver(() => {\n                //         console.log(\"Panel resized.\");\n                //         resize();\n                //     });\n                //     resizeObserver.observe(widgetRef.current); //widgetElemnt);\n                // }\n\n                comm = kernelConn.createComm(props.commTarget || 'test');\n                comm.open('HELO from GGB').done;\n             // comm.send('HELO2').done\n\n             // kernel.registerCommTarget('test', (comm, commMsg) => {\n             // console.log(\"Comm opened from kernel with message:\", commMsg['content']['data']);\n                        \n                closeHandler = () => {\n                    // Attempt to close comm and shutdown helper kernel\n                    try { comm?.close?.(); } catch (e) { console.error(e); }\n                    kernel2?.shutdown().catch((err: any) => console.error(err));\n                    console.log(\"Kernel and comm closed.\");\n                    if (resizeHandler) window.removeEventListener('resize', resizeHandler);\n                };\n                window.addEventListener('close', closeHandler);\n\n                comm.onMsg = async (msg: any) => {\n                    console.log(\"Message received from server:\", msg['content']['data']);\n\n                    const command = JSON.parse(msg.content.data as any);\n                    console.log(\"Parsed command:\", command.type, command.payload);\n                    \n                    var rmsg: any = null;\n                    if (command.type === \"command\") {\n                        var label = api.evalCommandGetLabels(command.payload);\n                        \n                        rmsg = JSON.stringify({\n                            \"type\": \"created\",\n                            \"id\": command.id,                  \n                            \"payload\": label\n                        }); // .replace(/'/g, \"\\\\'\");\n                    } else if (command.type === \"function\") {\n                        var apiName = command.payload.name;\n                        console.log(apiName);\n                        var value: any[] = [];\n\n                        {\n                            var args = command.payload.args;\n                            value = [];\n                            (Array.isArray(apiName) ? apiName : [apiName]).forEach((f: string) => {\n                                console.log(f, args);\n                                if (isArrayOfArrays(args)) {\n                                    var value2: any[] = [];\n                                    args.forEach((arg2: any[]) => {\n                                        if (args) {\n                                            value2.push(api[f](...arg2) || null);\n                                        } else {\n                                            value2.push(api[f]() || null);\n                                        }\n                                    });\n                                    value.push(value2);\n                                } else {\n                                    if (args) {\n                                        value.push(api[f](...args) || null);\n                                    } else {\n                                        value.push(api[f]() || null);\n                                    }\n                                }\n                            });\n                            value = (Array.isArray(apiName) ? value : value[0]);\n                            console.log(\"Function value:\", value);\n                        }\n                        rmsg = JSON.stringify({\n                            \"type\": \"value\",\n                            \"id\": command.id,\n                            \"payload\": {\n                                //\"label\": command.payload,\n                                \"value\": value\n                            }\n                        }); // .replace(/'/g, \"\\\\'\");\n                    }\n                    comm.send(rmsg);\n                    await callRemoteSocketSend(kernel2, rmsg, socketPath, wsUrl);\n                }\n\n                var addListener = async function(data: any) {\n                 // console.log(\"Add listener triggered for:\", data);\n                    var msg = {\n                        \"type\": \"add\",\n                        \"payload\": data, \n                    }\n                    // console.log(\"Add detected:\", JSON.stringify(msg));\n                    await callRemoteSocketSend(kernel2, JSON.stringify(msg), socketPath, wsUrl);\n                }\n                api.registerAddListener(addListener);\n\n                var removeListener = async function(data: any) {\n                 // console.log(\"Add listener triggered for:\", data);\n                    var msg = {\n                        \"type\": \"remove\",\n                        \"payload\": data,\n                    }\n                    // console.log(\"Remove detected:\", JSON.stringify(msg));\n                    await callRemoteSocketSend(kernel2, JSON.stringify(msg), socketPath, wsUrl);\n                }\n                api.registerRemoveListener(removeListener);\n\n                var renameListener = async function(data: any) {\n                 // console.log(\"Add listener triggered for:\", data);\n                    var msg = {\n                        \"type\": \"rename\",\n                        \"payload\": data,\n                    }\n                    // console.log(\"Rename detected:\", JSON.stringify(msg));\n                    await callRemoteSocketSend(kernel2, JSON.stringify(msg), socketPath, wsUrl);\n                }\n                api.registerRenameListener(renameListener);\n\n                var clearListener = async function(data: any) {\n                // console.log(\"Add listener triggered for:\", data);\n                    var msg = {\n                        \"type\": \"clear\",\n                        \"payload\": data\n                    }\n                    // console.log(\"Rename detected:\", JSON.stringify(msg));\n                    await callRemoteSocketSend(kernel2, JSON.stringify(msg), socketPath, wsUrl);\n                }\n                api.registerClearListener(clearListener);\n\n                // // nothing triggered?\n                // var clientListener = async function(data: any) {\n                // // console.log(\"Add listener triggered for:\", data);\n                //     var msg = {\n                //         \"type\": \"client\",\n                //         \"payload\": data\n                //     }\n                //     console.log(\"Client detected:\", JSON.stringify(msg));\n                //     await callRemoteSocketSend(kernel2, JSON.stringify(msg), socketPath, wsUrl);\n                // }\n                // api.registerClearListener(clientListener);\n\n                observer = new MutationObserver((mutations) => {\n                    mutations.forEach((mutation) => {\n                        mutation.addedNodes.forEach((node) => {\n                            try {\n                                (node as HTMLElement).querySelectorAll('div.dialogMainPanel > div.dialogTitle').forEach((n) => {\n                                 // console.log(n.textContent); detect titles like 'Error'\n                                    ((node as HTMLElement).querySelector('div.dialogContent') as HTMLElement)\n                                        .querySelectorAll(`[class$='Label']`).forEach(async (n2) => {\n                                            // console.log(n2.textContent);\n                                            const msg = JSON.stringify({\n                                                \"type\": n.textContent,\n                                                \"payload\": n2.textContent\n                                            });\n                                            // comm.send(msg);\n                                            await callRemoteSocketSend(kernel2, msg, socketPath, wsUrl);\n                                        })\n                                })\n                            } catch (e) {\n                             // console.log(e, node);\n                            }\n                        });\n                    });\n                });\n                observer.observe(document.body, { childList: true, subtree: true });  \n            }    \n\n            // Avoid duplicate meta/script inserts: reuse if already present\n            const existingMeta = document.getElementById('ggblab-viewport-meta') as HTMLMetaElement | null;\n            if (existingMeta) {\n                metaViewport = existingMeta;\n            } else {\n                metaViewport = document.createElement('meta');\n                metaViewport.id = 'ggblab-viewport-meta';\n                metaViewport.name = \"viewport\";\n                metaViewport.content = \"width=device-width, initial-scale=1\";\n                document.head.appendChild(metaViewport);\n            }\n\n            const existingScript = document.getElementById('ggblab-deployggb-script') as HTMLScriptElement | null;\n            const createApplet = () => {\n                const params = {\n                    id: \"ggbApplet\" + (props?.kernelId || '').substring(0, 8), // applet ID\n                    appName: \"suite\", // specify GeoGebra Classic smart applet\n                    width: 800, // applet width\n                    height: 600, // applet height\n                    showToolBar: true, // show the toolbar\n                    showAlgebraInput: false, // show algebra input field\n                    showMenuBar: true, // show the menu bar\n                    autoHeight: true,\n                    scaleContainerClass: \"lm-Panel\", // \"lm-DockPanel-widget\",\n                    // autoWidth: false,\n                    // scale: 2,\n                    allowUpscale: false,\n                    appletOnLoad: ggbOnLoad\n                }\n                applet = new (window as any).GGBApplet(params, true);\n                applet.inject(elementId);\n            };\n\n            if (existingScript) {\n                scriptTag = existingScript;\n                // If script already loaded and GGBApplet is available, instantiate immediately\n                if ((window as any).GGBApplet) {\n                    createApplet();\n                } else {\n                    // Otherwise ensure we call createApplet once it loads\n                    scriptTag.addEventListener('load', createApplet, { once: true });\n                }\n            } else {\n                scriptTag = document.createElement('script');\n                scriptTag.id = 'ggblab-deployggb-script';\n                scriptTag.src = 'https://cdn.geogebra.org/apps/deployggb.js';\n                scriptTag.async = true;\n                scriptTag.onload = createApplet;\n                document.body.appendChild(scriptTag);\n            }\n        });\n\n        return () => {\n            // Remove resize listener\n            if (resizeHandler) {\n                window.removeEventListener('resize', resizeHandler);\n                resizeHandler = null;\n            }\n            // Remove close listener\n            if (closeHandler) {\n                window.removeEventListener('close', closeHandler);\n                closeHandler = null;\n            }\n            // Disconnect mutation observer\n            if (observer) {\n                try { observer.disconnect(); } catch (e) { console.error(e); }\n                observer = null;\n            }\n            // Remove injected meta tag\n            if (metaViewport && metaViewport.parentNode) {\n                metaViewport.parentNode.removeChild(metaViewport);\n                metaViewport = null;\n            }\n            // Remove injected script tag\n            if (scriptTag && scriptTag.parentNode) {\n                scriptTag.parentNode.removeChild(scriptTag);\n                scriptTag = null;\n            }\n            // Clean up GeoGebra applet\n            if (applet) {\n                try {\n                    console.log(\"Cleaning up GeoGebra applet.\");\n                    (window as any).ggbApplet.remove();\n                } catch (e) {\n                    console.error(e);\n                }\n                applet = null;\n                try { delete (window as any).GGBApplet; } catch {}\n            }\n\n            // Close comm and shutdown helper kernel asynchronously\n            (async () => {\n                try {\n                    if (comm) {\n                        try { comm.close?.(); } catch (e) { console.error(e); }\n                        comm = null;\n                    }\n                    if (kernel2) {\n                        await kernel2.shutdown();\n                        kernel2 = null;\n                    }\n                    if (kernelManager) {\n                        try { await kernelManager.shutdown?.(); } catch (e) { /* ignore */ }\n                        kernelManager = null;\n                    }\n                } catch (e) {\n                    console.error('Error during cleanup:', e);\n                }\n            })();\n        };\n    }, []);\n\n    return (\n        <div id={elementId} ref={widgetRef} style={{width: \"100%\", height: \"100%\"}}></div>\n    );\n};\n\ninterface GGAWidgetProps {\n    kernelId?: string;\n    commTarget?: string;\n    insertMode?: DockLayout.InsertMode;\n    wsPort?: number;\n    socketPath?: string;\n}\n\n/**\n * A GeoGebra Lumino Widget that wraps a GeoGebraComponent.\n */\nexport class GeoGebraWidget extends ReactWidget {\n\n    private props: GGAWidgetProps | undefined;\n\n    /**\n     * Constructs a new GeoGebraWidget.\n     */\n    constructor(props?: GGAWidgetProps) {\n        super();\n        this.addClass('jp-ggblabWidget');\n        this.props = props;\n    }\n\n    render(): JSX.Element {\n        return <GGAComponent kernelId={this.props?.kernelId} commTarget={this.props?.commTarget} wsPort={this.props?.wsPort} socketPath={this.props?.socketPath} />;\n    }\n\n    // only onResize is responsible for size changes in Lumino,\n    // but onAfterAttach and onAfterShow and onFitRequest may also be relevant in some cases.\n    protected onResize(msg: Widget.ResizeMessage): void {\n        // console.log(\"GeoGebraWidget resized:\", msg.width, msg.height);\n        window.dispatchEvent(new Event('resize'));\n        super.onResize(msg);\n    }\n\n    // Only perform cleanup when the widget is explicitly closed by the user.\n    // Use onCloseRequest to trigger cleanup so that transient disposals\n    // during layout/restore operations do not tear down the internal state.\n    protected onCloseRequest(msg: Message): void {\n        console.log('GeoGebraWidget onCloseRequest â€” performing cleanup.');\n        window.dispatchEvent(new Event('close'));\n        super.onCloseRequest(msg);\n    }\n\n    // dispose should not trigger cleanup again; allow normal disposal to proceed\n    // without duplicating shutdown logic.\n    dispose(): void {\n        console.log('GeoGebraWidget disposed.');\n        super.dispose();\n    }\n}\n\n// // Example of attaching the GeoGebraWidget to a DockPanel\n// // but commented out to avoid automatic execution.\n// const dock = new DockPanel();\n// ReactWidget.attach(dock, document.body);\n// // window.addEventListener('resize', () => { dock.update(); });\n// dock.layoutModified.connect(() => { \n//     console.log(\"Dock layout modified.\");\n//     dock.update(); \n// });"],"names":[],"ignoreList":[],"sourceRoot":""}