{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://pycharter.io/schemas/etl/pipeline.json",
  "title": "ETL Pipeline Configuration",
  "description": "Complete ETL pipeline configuration (single-file format)",
  "type": "object",
  "required": ["extract", "load"],
  "properties": {
    "name": {
      "type": "string",
      "description": "Pipeline name"
    },
    "version": {
      "type": "string",
      "description": "Pipeline version"
    },
    "description": {
      "type": "string",
      "description": "Pipeline description"
    },
    "extract": {
      "$ref": "extract.json",
      "description": "Extract configuration"
    },
    "transform": {
      "description": "Transform configuration - can be a list (ordered) or object (legacy)",
      "oneOf": [
        {
          "type": "array",
          "description": "List of transform operations (executed in order)",
          "items": {
            "type": "object",
            "minProperties": 1,
            "maxProperties": 1,
            "properties": {
              "rename": {
                "type": "object",
                "additionalProperties": { "type": "string" }
              },
              "convert": {
                "type": "object",
                "additionalProperties": { "type": "string" }
              },
              "defaults": {
                "type": "object"
              },
              "add": {
                "type": "object"
              },
              "select": {
                "type": "array",
                "items": { "type": "string" }
              },
              "drop": {
                "type": "array",
                "items": { "type": "string" }
              },
              "filter": {
                "type": "object"
              },
              "custom_function": {
                "type": "object",
                "required": ["module", "function"],
                "properties": {
                  "module": { "type": "string" },
                  "function": { "type": "string" },
                  "kwargs": { "type": "object" }
                }
              }
            }
          }
        },
        {
          "type": "object",
          "description": "Legacy object format",
          "properties": {
            "rename": { "type": "object" },
            "convert": { "type": "object" },
            "defaults": { "type": "object" },
            "add": { "type": "object" },
            "select": { "type": "array" },
            "drop": { "type": "array" },
            "filter": { "type": "object" },
            "custom_function": { "type": "object" }
          }
        }
      ]
    },
    "load": {
      "$ref": "load.json",
      "description": "Load configuration"
    }
  }
}
