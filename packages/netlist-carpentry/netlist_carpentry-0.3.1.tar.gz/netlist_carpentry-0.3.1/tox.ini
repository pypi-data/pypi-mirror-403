[tox]
envlist = py312, coverage-report, junit-report, lint, # type-check
basepython = python3.12
skip_missing_interpreters = false

[testenv]
passenv = *
runner = uv-venv-lock-runner
commands = pytest --cov netlist_carpentry --cov-append --cov-report= --junitxml=reports/junit-{envname}.xml --junit-prefix={envname}

[testenv:coverage-report]
runner = uv-venv-runner
depends =
    py312
skip_install = true
ignore_errors = true
deps = coverage[toml]
commands =
    coverage report
    coverage xml
    coverage html --title="Code Coverage for netlist_carpentry"
    coverage erase

[testenv:junit-report]
runner = uv-venv-runner
depends =
    py312
    # type-check
skip_install = true
deps = junitparser
commands =
    junitparser merge --glob reports/junit-*.xml reports/junit.xml

# [testenv:type-check]
# ignore_errors = true
# commands =
#     mypy -p netlist_carpentry --junit-xml reports/junit-type-check.xml

[testenv:lint]
ignore_errors = true
commands =
    ruff check src/netlist_carpentry
    ruff check tests
