[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "compression-safeguards"
version = "1.0.0b1"
dependencies = [
    "numpy~=2.4",
    "numpy-quaddtype~=1.0",
    "semver~=3.0",
    "sly~=0.5.0",
    "typing-extensions~=4.12",
]
requires-python = ">=3.11"
authors = [{ name = "Juniper Tyree", email = "juniper.tyree@helsinki.fi" }]
maintainers = [{ name = "Juniper Tyree", email = "juniper.tyree@helsinki.fi" }]
description = "Fearless lossy compression using safeguards"
readme = "README.md"
license = "MPL-2.0"
keywords = ["safeguards", "compression", "lossy-compression", "safe", "fearless"]
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Science/Research",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: Mozilla Public License 2.0 (MPL 2.0)",
    "Natural Language :: English",
    "Operating System :: OS Independent",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3.13",
    "Programming Language :: Python :: 3.14",
    "Topic :: Scientific/Engineering",
    "Topic :: Scientific/Engineering :: Atmospheric Science",
    "Topic :: System :: Archiving :: Compression",
    "Typing :: Typed",
]


[dependency-groups]
bench = [
    "earthkit-data~=0.14.0",
    "earthkit-plots~=0.3.1",
    "matplotlib~=3.10.0",
    "mpl-ascii~=0.10.0",
    "netcdf4~=1.7.2",
    "numcodecs-wasm~=0.2.2",
    "numcodecs-wasm-sz3~=0.8.1",
    "numcodecs-wasm-zfp~=0.6.0",
    "numcodecs-wasm-zstd~=0.4.0",
    "tqdm~=4.0",
    "xarray~=2025.4",
]
dev = ["ruff~=0.14"]
docs = [
    "mkdocs~=1.6",
    "mkdocstrings[python]~=1.0",
    "mkdocstrings-python-generator==1.0.0rc1",
    "mkdocs-exclude~=1.0",
    "mkdocs-jupyter~=0.25",
    "mkdocs-open-in-new-tab~=1.0",
    "Pygments~=2.19",
    "ruff~=0.14",
]
doctest = ["griffe2md~=1.1", "pytest~=9.0", "pytest-codeblocks~=0.17.0"]
examples = [
    "cdsapi~=0.7.6",
    "earthkit-data~=0.14.0",
    "earthkit-plots~=0.3.1",
    "humanize~=4.14.0",
    "jupyterlab~=4.3",
    "matplotlib~=3.10.0",
    "netcdf4~=1.7.2",
    "numcodecs-wasm~=0.2.2",
    "numcodecs-wasm-qpet-sperr~=0.2.0",
    "numcodecs-wasm-sperr~=0.2.0",
    "numcodecs-wasm-sz3~=0.8.1",
    "numcodecs-wasm-zfp~=0.6.0",
    "numcodecs-zero~=0.1.2",
    "scikit-image~=0.25.0",
    "xarray~=2025.1",
]
fuzz = [
    "atheris~=3.0",
    "setuptools~=80.0",
    "timeoutcontext~=2.0",
]
test = [
    "dask~=2025.4",
    "google_crc32c~=1.8",
    "numcodecs-combinators~=0.2.13",
    "pytest~=9.0",
    "pytest-asyncio~=1.3",
    "xarray~=2025.4",
    "zarr~=3.0",
    "zarr-any-numcodecs~=0.1.2",
]
typecheck = ["mypy~=1.19"]

[tool.setuptools.packages.find]
where = ["src"]

[tool.setuptools.package-data]
"compression_safeguards" = ["py.typed"]

[tool.ruff.lint]
select = ["E4", "E7", "E9", "F", "I", "NPY", "T20", "SLOT", "TC", "PLC", "UP", "FURB"]
ignore = ["PLC0105"]

[tool.ruff.lint.per-file-ignores]
"bench/*" = ["T20"]
"examples/*" = ["T20", "PLC"]

[tool.pytest.ini_options]
addopts = ["--import-mode=importlib", "--strict-markers"]
xfail_strict = true
markers = [
    "slow: marks tests as slow [10-30s] (deselect with '-m \"not slow\"')",
    "veryslow: marks tests as very slow [>30s] (deselect with '-m \"not veryslow\"')",
]

[[tool.mypy.overrides]]
module = ["numpy_quaddtype.*", "sly.*"]
follow_untyped_imports = true

[tool.hatch.build.targets.sdist]
include = ["/src", "/CITATION.cff", "/LICENSE", "/pyproject.toml", "/README.md"]

[tool.uv.workspace]
members = ["packages/numcodecs-safeguards", "packages/xarray-safeguards"]

# FIXME: https://github.com/astral-sh/uv/issues/15125
[tool.uv]
constraint-dependencies = [
    "numcodecs ~= 0.16.5; python_version == '3.14'",
]
