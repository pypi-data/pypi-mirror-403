# Code autogenerated by Fhircraft {{ metadata.version }} on {{ metadata.timestamp }}.

# Fhircraft modules
from fhircraft.fhir.resources.base import FHIRBaseModel, FHIRSliceModel, FhirBaseModelKind
import fhircraft.fhir.resources.validators as fhir_validators
# Pydantic modules
from pydantic import Field, field_validator, model_validator, BaseModel
from pydantic.fields import FieldInfo

# Standard modules
from typing import Optional, Literal, Union, ClassVar, List
from enum import Enum
NoneType = type(None)

# Dynamic modules 
{% for module, objects in imports.items() -%} 
from {{ module }} import {{ objects|join(', ') }}
{% endfor -%}

{% for model, model_data in data.items() %} 
class {{ model.__name__ }}({% for base in model.__bases__ %}{{ base.__name__ }}{% if not loop.last %}, {% endif %}{% endfor %}):
    {% if model.__doc__ %}
    """
    {{ model.__doc__ }}
    """
    {% endif %}
    {% if model.__bases__ | selectattr("__name__", "equalto", "FHIRSliceModel") | list | length > 0 %}
    min_cardinality: ClassVar[int] = {{model.min_cardinality}}
    max_cardinality: ClassVar[int] = {{model.max_cardinality}}
    {% endif %}

    {% if model._fhir_release %}
    _fhir_release = "{{ model._fhir_release }}"
    {% endif %}
    {% if model._type %}
    _type = "{{ model._type }}"
    {% endif %}
    {% if model._kind %}
    {% if model._kind.__class__.__name__ == "FhirBaseModelKind" %}
    _kind = FhirBaseModelKind.{{ model._kind.name }}
    {% else %}
    _kind = "{{ model._kind }}"
    {% endif %}
    {% endif %}
    {% if model._abstract %}
    _abstract = {{ model._abstract }}
    {% endif %}
    {% if model._canonical_url %}
    _canonical_url = "{{ model._canonical_url }}"
    {% endif %}

    {% if not model_data.fields %}
    pass
    {% endif %}
    {% for field, info in model_data.fields.items() %}
    {{ field }}: {{ info.annotation}} = Field(
        {% if info.title %}
        title="{{ info.title }}",
        {% endif %}
        description={% if info.description %}{{ info.description|tojson }}{% else %}None{% endif %},
        {% if info.default != '...' %}
        default={{ info.default }},
        {% endif %}
        {% if info.default_factory != '...' %}
        default_factory={{ info.default_factory }},
        {% endif %}
        {% if info.alias %}
        alias="{{ info.alias }}",
        {% endif %}
    )
    {% endfor %}
    
    {% for name, property in model_data.properties.items() %}
    @property 
    def {{ name }}(self):
        return {{ property.func.__name__ }}(self, 
            {% for arg in property.args %}
            {{ arg }},
            {% endfor %}
            {% for arg, value in property.keywords.items() %}
            {{ arg }}={{ value }},
            {% endfor %}
        )
        
    {% endfor %}
    {% for name, validator in model_data.validators.items() %}
    {% if validator.mode == "field" %}
    @field_validator(*{{ validator.info.fields }}, mode="{{ validator.info.mode }}", check_fields={{ validator.info.check_fields }})
    @classmethod
    def {{ name }}(cls, value):    
        return {{ validator.func.__name__ }}(cls, value, 
            {% for arg in validator.args %}
            {{ arg }},
            {% endfor %}
            {% for arg, value in validator.keywords.items() %}
            {{ arg }}={{ value }},
            {% endfor %}
        )
        
    {% endif %}
    {% if validator.mode == "model" %}
    @model_validator(mode="{{ validator.info.mode }}")
    def {{ name }}(self):
        return {{ validator.func.__name__ }}( 
            self,
            {% for arg in validator.args %}
            {{ arg }},
            {% endfor %}
            {% for arg, value in validator.keywords.items() %}
            {{ arg }}={{ value }},
            {% endfor %}
        )
        
    {% endif %}
    {% endfor %}
{% endfor %}

{% for model, model_data in data.items() %}
{% if not model.__pydantic_complete__ %}
{{ model.__name__ }}.model_rebuild()
{% endif %}
{% endfor %}
