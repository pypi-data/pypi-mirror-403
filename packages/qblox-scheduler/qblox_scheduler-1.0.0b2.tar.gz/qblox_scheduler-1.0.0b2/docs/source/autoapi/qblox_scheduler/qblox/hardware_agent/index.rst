hardware_agent
==============

.. py:module:: qblox_scheduler.qblox.hardware_agent 

.. autoapi-nested-parse::

   The HardwareAgent object is the goto object when running experiments on qblox hardware.
   It provides an interface to easily set up the hardware, run experiments, and receive results.



Module Contents
---------------

Classes
~~~~~~~

.. autoapisummary::

   qblox_scheduler.qblox.hardware_agent.HardwareAgent



Functions
~~~~~~~~~

.. autoapisummary::

   qblox_scheduler.qblox.hardware_agent._get_pydantic_value_or_set_default
   qblox_scheduler.qblox.hardware_agent._load_quantum_device_from_file



Attributes
~~~~~~~~~~

.. autoapisummary::

   qblox_scheduler.qblox.hardware_agent.T


.. py:data:: T

.. py:function:: _get_pydantic_value_or_set_default(obj: dict | pydantic.BaseModel, attribute: str, default: T = None) -> T

.. py:function:: _load_quantum_device_from_file(file: str | pathlib.Path) -> qblox_scheduler.device_under_test.quantum_device.QuantumDevice

.. py:class:: HardwareAgent(hardware_configuration: qblox_scheduler.backends.qblox_backend.QbloxHardwareCompilationConfig | dict | str | pathlib.Path, quantum_device_configuration: dict | str | pathlib.Path | qblox_scheduler.device_under_test.quantum_device.QuantumDevice | None = None, *, debug: qblox_instruments.types.DebugLevel = DebugLevel.MINIMAL_CHECK, output_dir: pathlib.Path | str | None = None)

   Hardware definition of qblox backend.
   Contains definitions for the cluster, the hardware configuration,
   and related classes to manage the instruments.

   :param hardware_configuration: The hardware configuration.
                                  Either
                                  - a QbloxHardwareCompilationConfig instance
                                  - a dictionary as pydantic model of the QbloxHardwareCompilationConfig
                                  - a json file that stores the above dictionary

                                  The cluster fields in "hardware_description" will have its `modules` field autogenerated,
                                  based on its `ip` field when they are not defined.
                                  This `ip` field is mandatory.
   :param quantum_device_configuration: The quantum device configuration.
                                        Either
                                        - a json dictionary of the QuantumDevice
                                        - a path to the file that stores the json dictionary
   :param debug: Debug level of the cluster. By default, it is set to `DebugLevel.MINIMAL_CHECK`.
                 Available debug levels are:
                 - `DebugLevel.MINIMAL_CHECK`: Check compatibility between the hardware firmware version and qblox-instruments version, and check for errors when starting and stopping sequencers.
                 - `DebugLevel.ERROR_CHECK`: Check for errors after every low-level cluster command.
                 - `DebugLevel.NO_CHECK`: Do not check for errors.
                 - `DebugLevel.VERSION_AND_ERROR_CHECK`: Combination of `DebugLEVEL.MINIMAL_CHECK` and `DebugLevel.ERROR_CHECK`.
   :param default_output_dir: Default output directory where the data will be stored.


   .. py:attribute:: _ElementType


   .. py:attribute:: _num_instances_initiated
      :value: 0



   .. py:attribute:: _hardware_configuration


   .. py:attribute:: _clusters
      :type:  dict[str, qblox_scheduler.instrument_coordinator.components.qblox.ClusterComponent]


   .. py:attribute:: _noncluster_instruments
      :type:  dict[str, qcodes.instrument.instrument.Instrument]


   .. py:attribute:: _instrument_coordinator


   .. py:attribute:: _measurement_control


   .. py:attribute:: _debug


   .. py:attribute:: _latest_compiled_schedule
      :type:  qblox_scheduler.schedules.schedule.CompiledSchedule | None
      :value: None



   .. py:property:: hardware_configuration
      :type: qblox_scheduler.backends.qblox_backend.QbloxHardwareCompilationConfig


      The (validated) hardware configuration of this hardware.
      Only available after the connections with the clusters
      have been established using `connect_clusters` if initially given as a file/dictionary.
      Note that this is **not** in json/dictionary format.


   .. py:method:: add_device_elements(device_elements: collections.abc.Sequence[qblox_scheduler.device_under_test.device_element.DeviceElement]) -> None

      Add multiple device elements to the quantum device.

      :param device_elements: list of device elements to be added



   .. py:method:: add_edges(edges: list[qblox_scheduler.device_under_test.edge.Edge]) -> None

      Add multiple edges to the quantum device.

      :param edges: list of edges to be added



   .. py:method:: connect_clusters() -> None

      Connect the defined clusters to the hardware given their identifiers.

      Will also supplement the modules to the given hardware description and/or verify them.



   .. py:property:: quantum_device
      :type: qblox_scheduler.device_under_test.quantum_device.QuantumDevice


      The quantum device active in this hardware.

      The quantum device contains the device elements
      and how the connectivity between them is defined.


   .. py:property:: instrument_coordinator
      :type: qblox_scheduler.instrument_coordinator.instrument_coordinator.InstrumentCoordinator


      The instrument coordinator active in this hardware.

      The instrument coordinator is responsible for executing
      the (compiled) schedule on the instruments in this backend.


   .. py:property:: measurement_control
      :type: quantify_core.measurement.control.MeasurementControl


      The instrument coordinator active in this hardware.

      The instrument coordinator is responsible for executing
      the (compiled) schedule on the instruments in this backend.


   .. py:method:: get_clusters() -> dict[str, qblox_instruments.Cluster]

      Get all the instantiated clusters.

      :returns: A dictionary mapping cluster names to Cluster objects.




   .. py:property:: latest_compiled_schedule
      :type: qblox_scheduler.schedules.schedule.CompiledSchedule | None


      Get the latest compiled schedule, if one exists.


   .. py:method:: run(schedule: qblox_scheduler.schedule.Schedule | qblox_scheduler.schedules.schedule.TimeableSchedule | qblox_scheduler.schedules.schedule.CompiledSchedule, *, timeout: int = 10, save_to_experiment: bool = True, save_snapshot: bool = True) -> xarray.Dataset

      Run a schedule on the hardware.

      :param schedule: The schedule to run.
      :param timeout: The timeout for retrieving the results, in seconds
      :param save_to_experiment: Whether to save the dataset to an experiment directory. The dataset and (optionally)
                                 snapshot will be saved in <datadir>/<tuid>/dataset.hdf5 and
                                 <datadir>/<tuid>/snapshot.json, where datadir is specified by
                                 :func:`~qblox_scheduler.analysis.data_handling.OutputDirectoryManager.set_datadir` and
                                 :func:`~qblox_scheduler.analysis.data_handling.OutputDirectoryManager.get_datadir`
      :param save_snapshot: Whether to save a snapshot of the experiment

      :returns: Acquisition result dataset if any acquisitions are used in the schedule.
                Empty dataset otherwise.

      :raises TimeoutError: When hardware doesn't return results in the given timeout.



   .. py:method:: compile(schedule: qblox_scheduler.schedule.Schedule | qblox_scheduler.schedules.schedule.TimeableSchedule) -> qblox_scheduler.schedules.schedule.CompiledSchedule

      Compile the schedule to the hardware.
      Compilation is already done in the `run` method,
      so run this method only if the compiled schedule requires to be investigated.

      :param schedule: The TimeableSchedule to compile for this hardware

      :returns: The compiled schedule




   .. py:method:: set_output_data_dir(datadir: pathlib.Path | str | None = None) -> None
      :staticmethod:


      Sets the output data directory.

      :param datadir: Path of the data directory. If set to ``None``, resets the datadir to the
                      default datadir (``<top_level>/data``).



   .. py:method:: _verify_hardware_configuration() -> None

      Verifies if the given hardware configuration can be run on the cluster.

      :raises TypeError: When the hardware_configuration has not been correctly initialized yet.
      :raises ValueError: When the hardware configuration does not match the modules installed on the cluster.



   .. py:method:: _create_cluster(cluster_name: str, cluster_description: dict | qblox_scheduler.backends.types.qblox.ClusterDescription) -> qblox_instruments.Cluster


   .. py:method:: _create_dummy_cluster(cluster_name: str, cluster_description: dict | qblox_scheduler.backends.types.qblox.ClusterDescription) -> qblox_instruments.Cluster


