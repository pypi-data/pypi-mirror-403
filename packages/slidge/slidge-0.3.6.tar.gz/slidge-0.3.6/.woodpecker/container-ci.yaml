# Build a container with a virtualenv that can be used for tests and to build docs.

when:
  event: [ push ]
  branch: main
  path:
    - Dockerfile
    - pyproject.toml
    - uv.lock
    - .woodpecker/container-ci.yaml

matrix:
  PYTHON_VERSION:
    - "3.11"
    - "3.12"
    - "3.13"
    - "3.14"

labels:
  platform: linux/amd64

steps:
  build-and-push:
    image: woodpeckerci/plugin-docker-buildx:6.0.2
    settings:
      repo: codeberg.org/slidge/slidge
      registry: codeberg.org
      build_args:
        PYTHONVER: "${PYTHON_VERSION}"
      tag: ci-${PYTHON_VERSION}
      target: ci
      username: slidge
      password:
        from_secret: CODEBERG_TOKEN
      cache_from: codeberg.org/slidge/slidge:buildcache
