"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["8735"],{98677:function(t,i,e){e.a(t,async function(t,i){try{e(89463),e(3362),e(62953);var s=e(40445),a=e(96196),o=e(77845),r=e(1087),n=(e(27661),e(3587),e(35891)),l=e(57116),d=e(38119),h=t([d]);d=(h.then?(await h)():h)[0];let c,p,u,g=t=>t;const _="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z";class f extends d.D{get _config(){return this.config}render(){return(0,a.qy)(c||(c=g` ${0} ${0} <ha-fab slot="fab" class="${0}" .label="${0}" .disabled="${0}" extended @click="${0}"> <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> </ha-fab> `),this.config.description?(0,a.qy)(p||(p=g`<ha-markdown class="description" breaks .content="${0}"></ha-markdown>`),this.config.description):a.s6,this.renderCard(),this.dirty?"dirty":"",this.hass.localize("ui.common.save"),this.saving,this._saveScript,_)}_saveScript(){(0,r.r)(this,"save-script")}async _getBlueprints(){this._blueprints=await(0,n.Xg)(this.hass,"script")}static get styles(){return[d.D.styles,l.T_,(0,a.AH)(u||(u=g`:host{position:relative;height:100%;min-height:calc(100vh - 85px);min-height:calc(100dvh - 85px)}ha-fab{position:fixed}`))]}constructor(...t){super(...t),this.saving=!1,this.dirty=!1}}(0,s.Cg)([(0,o.MZ)({attribute:!1})],f.prototype,"config",void 0),(0,s.Cg)([(0,o.MZ)({type:Boolean})],f.prototype,"saving",void 0),(0,s.Cg)([(0,o.MZ)({type:Boolean})],f.prototype,"dirty",void 0),f=(0,s.Cg)([(0,o.EM)("blueprint-script-editor")],f),i()}catch(c){i(c)}})},90370:function(t,i,e){e.a(t,async function(t,s){try{e.r(i);e(18111),e(81148),e(22489),e(3362),e(62953);var a=e(40445),o=e(16527),r=e(77845),n=e(22786),l=e(69093),d=e(9899),h=e(38911),c=e(324),p=e(21475),u=e(42180),g=t([p,u]);[p,u]=g.then?(await g)():g;const _=(t,i)=>t.length===i.length&&t.every((t,e)=>t===i[e]);class f extends c.a{firstUpdated(t){super.firstUpdated(t),this.hass.loadBackendTranslation("device_automation")}updatePageEl(t,i){if(t.hass=this.hass,t.narrow=this.narrow,t.isWide=this.isWide,t.route=this.routeTail,t.showAdvanced=this.showAdvanced,t.entityRegistry=this._entityReg,t.cloudStatus=this.cloudStatus,this.hass&&(t.scripts&&i?i.has("hass")&&this._debouncedUpdateScripts(t):t.scripts=this._getScripts(this.hass.states)),(!i||i.has("route"))&&"show"===this._currentPage){t.creatingNew=void 0;const i=this.routeTail.path.slice(1);return void(t.entityId="new"===i?null:i)}if((!i||i.has("route"))&&"dashboard"!==this._currentPage){t.creatingNew=void 0;const i=this.routeTail.path.slice(1);t.scriptId="new"===i?null:i}}constructor(...t){super(...t),this.narrow=!1,this.isWide=!1,this.showAdvanced=!1,this.scripts=[],this.routerOptions={defaultPage:"dashboard",routes:{dashboard:{tag:"ha-script-picker",cache:!0},edit:{tag:"ha-script-editor"},show:{tag:"ha-script-editor"},trace:{tag:"ha-script-trace",load:()=>Promise.all([e.e("19409"),e.e("75268"),e.e("52422")]).then(e.bind(e,74706))}}},this._debouncedUpdateScripts=(0,d.s)(t=>{const i=this._getScripts(this.hass.states);_(i,t.scripts)||(t.scripts=i)},10),this._getScripts=(0,n.A)(t=>Object.values(t).filter(t=>"script"===(0,l.t)(t)&&!t.attributes.restored))}}(0,a.Cg)([(0,r.MZ)({attribute:!1})],f.prototype,"hass",void 0),(0,a.Cg)([(0,r.MZ)({type:Boolean})],f.prototype,"narrow",void 0),(0,a.Cg)([(0,r.MZ)({attribute:"is-wide",type:Boolean})],f.prototype,"isWide",void 0),(0,a.Cg)([(0,r.MZ)({attribute:!1})],f.prototype,"showAdvanced",void 0),(0,a.Cg)([(0,r.MZ)({attribute:!1})],f.prototype,"cloudStatus",void 0),(0,a.Cg)([(0,r.MZ)({attribute:!1})],f.prototype,"scripts",void 0),(0,a.Cg)([(0,r.wk)(),(0,o.Fg)({context:h.ih,subscribe:!0})],f.prototype,"_entityReg",void 0),f=(0,a.Cg)([(0,r.EM)("ha-config-script")],f),s()}catch(_){s(_)}})},21475:function(t,i,e){e.a(t,async function(t,i){try{e(89463),e(16280),e(18111),e(20116),e(61701),e(13579),e(3362),e(62953);var s=e(40445),a=(e(94422),e(16527)),o=e(96196),r=e(77845),n=e(94333),l=e(17079),d=e(32172),h=e(1087),c=e(91926),p=e(80880),u=e(7553),g=e(12587),_=e(18350),f=e(29823),y=(e(70947),e(27661),e(26300),e(67094),e(10763)),v=e(35891),b=e(12596),m=e(38911),C=e(22675),w=e(59241),$=e(84025),A=e(65063),k=e(42269),H=(e(81310),e(79172)),x=e(39359),M=e(54706),V=e(14503),S=e(41570),z=e(81619),L=e(37325),q=e(64265),R=e(60109),I=e(55270),E=e(98677),O=e(84042),Z=t([_,f,y,E,O]);[_,f,y,E,O]=Z.then?(await Z)():Z;let P,j,F,W,U,B,T,D,K,Y,N,G,X,Q,J,tt,it,et,st,at,ot,rt,nt=t=>t;const lt="M6,2A4,4 0 0,1 10,6V8H14V6A4,4 0 0,1 18,2A4,4 0 0,1 22,6A4,4 0 0,1 18,10H16V14H18A4,4 0 0,1 22,18A4,4 0 0,1 18,22A4,4 0 0,1 14,18V16H10V18A4,4 0 0,1 6,22A4,4 0 0,1 2,18A4,4 0 0,1 6,14H8V10H6A4,4 0 0,1 2,6A4,4 0 0,1 6,2M16,18A2,2 0 0,0 18,20A2,2 0 0,0 20,18A2,2 0 0,0 18,16H16V18M14,10H10V14H14V10M6,16A2,2 0 0,0 4,18A2,2 0 0,0 6,20A2,2 0 0,0 8,18V16H6M8,6A2,2 0 0,0 6,4A2,2 0 0,0 4,6A2,2 0 0,0 6,8H8V6M18,8A2,2 0 0,0 20,6A2,2 0 0,0 18,4A2,2 0 0,0 16,6V8H18Z",dt="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z",ht="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z",ct="M12,14A2,2 0 0,1 14,16A2,2 0 0,1 12,18A2,2 0 0,1 10,16A2,2 0 0,1 12,14M23.46,8.86L21.87,15.75L15,14.16L18.8,11.78C17.39,9.5 14.87,8 12,8C8.05,8 4.77,10.86 4.12,14.63L2.15,14.28C2.96,9.58 7.06,6 12,6C15.58,6 18.73,7.89 20.5,10.72L23.46,8.86Z",pt="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z",ut="M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z",gt="M6 2C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H10V20.1L20 10.1V8L14 2H6M13 3.5L18.5 9H13V3.5M20.1 13C20 13 19.8 13.1 19.7 13.2L18.7 14.2L20.8 16.3L21.8 15.3C22 15.1 22 14.7 21.8 14.5L20.5 13.2C20.4 13.1 20.3 13 20.1 13M18.1 14.8L12 20.9V23H14.1L20.2 16.9L18.1 14.8Z",_t="M17,7H22V17H17V19A1,1 0 0,0 18,20H20V22H17.5C16.95,22 16,21.55 16,21C16,21.55 15.05,22 14.5,22H12V20H14A1,1 0 0,0 15,19V5A1,1 0 0,0 14,4H12V2H14.5C15.05,2 16,2.45 16,3C16,2.45 16.95,2 17.5,2H20V4H18A1,1 0 0,0 17,5V7M2,7H13V9H4V15H13V17H2V7M20,15V9H17V15H20Z",ft="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z",yt="M8,5.14V19.14L19,12.14L8,5.14Z",vt="M3 6V8H14V6H3M3 10V12H14V10H3M20 10.1C19.9 10.1 19.7 10.2 19.6 10.3L18.6 11.3L20.7 13.4L21.7 12.4C21.9 12.2 21.9 11.8 21.7 11.6L20.4 10.3C20.3 10.2 20.2 10.1 20 10.1M18.1 11.9L12 17.9V20H14.1L20.2 13.9L18.1 11.9M3 14V16H10V14H3Z",bt="M16,8H14V11H11V13H14V16H16V13H19V11H16M2,12C2,9.21 3.64,6.8 6,5.68V3.5C2.5,4.76 0,8.09 0,12C0,15.91 2.5,19.24 6,20.5V18.32C3.64,17.2 2,14.79 2,12M15,3C10.04,3 6,7.04 6,12C6,16.96 10.04,21 15,21C19.96,21 24,16.96 24,12C24,7.04 19.96,3 15,3M15,19C11.14,19 8,15.86 8,12C8,8.14 11.14,5 15,5C18.86,5 22,8.14 22,12C22,15.86 18.86,19 15,19Z",mt="M18.4,10.6C16.55,9 14.15,8 11.5,8C6.85,8 2.92,11.03 1.54,15.22L3.9,16C4.95,12.81 7.95,10.5 11.5,10.5C13.45,10.5 15.23,11.22 16.62,12.38L13,16H22V7L18.4,10.6Z",Ct="M18,17H10.5L12.5,15H18M6,17V14.5L13.88,6.65C14.07,6.45 14.39,6.45 14.59,6.65L16.35,8.41C16.55,8.61 16.55,8.92 16.35,9.12L8.47,17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z",wt="M20 4H18V3H20.5C20.78 3 21 3.22 21 3.5V5.5C21 5.78 20.78 6 20.5 6H20V7H19V5H20V4M19 9H20V8H19V9M17 3H16V7H17V3M23 15V18C23 18.55 22.55 19 22 19H21V20C21 21.11 20.11 22 19 22H5C3.9 22 3 21.11 3 20V19H2C1.45 19 1 18.55 1 18V15C1 14.45 1.45 14 2 14H3C3 10.13 6.13 7 10 7H11V5.73C10.4 5.39 10 4.74 10 4C10 2.9 10.9 2 12 2S14 2.9 14 4C14 4.74 13.6 5.39 13 5.73V7H14C14.34 7 14.67 7.03 15 7.08V10H19.74C20.53 11.13 21 12.5 21 14H22C22.55 14 23 14.45 23 15M10 15.5C10 14.12 8.88 13 7.5 13S5 14.12 5 15.5 6.12 18 7.5 18 10 16.88 10 15.5M19 15.5C19 14.12 17.88 13 16.5 13S14 14.12 14 15.5 15.12 18 16.5 18 19 16.88 19 15.5M17 8H16V9H17V8Z",$t="M5.5,7A1.5,1.5 0 0,1 4,5.5A1.5,1.5 0 0,1 5.5,4A1.5,1.5 0 0,1 7,5.5A1.5,1.5 0 0,1 5.5,7M21.41,11.58L12.41,2.58C12.05,2.22 11.55,2 11,2H4C2.89,2 2,2.89 2,4V11C2,11.55 2.22,12.05 2.59,12.41L11.58,21.41C11.95,21.77 12.45,22 13,22C13.55,22 14.05,21.77 14.41,21.41L21.41,14.41C21.78,14.05 22,13.55 22,13C22,12.44 21.77,11.94 21.41,11.58Z",At="M15,12C15,10.7 14.16,9.6 13,9.18V6.82C14.16,6.4 15,5.3 15,4A3,3 0 0,0 12,1A3,3 0 0,0 9,4C9,5.3 9.84,6.4 11,6.82V9.19C9.84,9.6 9,10.7 9,12C9,13.3 9.84,14.4 11,14.82V17.18C9.84,17.6 9,18.7 9,20A3,3 0 0,0 12,23A3,3 0 0,0 15,20C15,18.7 14.16,17.6 13,17.18V14.82C14.16,14.4 15,13.3 15,12M12,3A1,1 0 0,1 13,4A1,1 0 0,1 12,5A1,1 0 0,1 11,4A1,1 0 0,1 12,3M12,21A1,1 0 0,1 11,20A1,1 0 0,1 12,19A1,1 0 0,1 13,20A1,1 0 0,1 12,21Z",kt="M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z";class Ht extends((0,M.E)((0,x._)((0,H.b)(o.WF)))){willUpdate(t){if(super.willUpdate(t),this._entityRegCreated&&this._newScriptId&&t.has("entityRegistry")){const t=this.entityRegistry.find(t=>"script"===t.platform&&t.unique_id===this._newScriptId);t&&(this._entityRegCreated(t),this._entityRegCreated=void 0)}}render(){var t;if(!this._config)return o.s6;const i=this._entityId?this.hass.states[this._entityId]:void 0,e="use_blueprint"in this._config,s=S.c?(0,o.qy)(P||(P=nt`<ha-svg-icon .path="${0}"></ha-svg-icon>`),lt):this.hass.localize("ui.panel.config.automation.editor.ctrl");return(0,o.qy)(j||(j=nt` <hass-subpage .hass="${0}" .narrow="${0}" .route="${0}" .backCallback="${0}" .header="${0}"> ${0} ${0} <ha-dropdown slot="toolbar-icon" @wa-select="${0}"> <ha-icon-button slot="trigger" .label="${0}" .path="${0}"></ha-icon-button> ${0} <ha-dropdown-item .disabled="${0}" value="info"> ${0} <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> </ha-dropdown-item> <ha-dropdown-item .disabled="${0}" value="settings"> ${0} <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> </ha-dropdown-item> <ha-dropdown-item .disabled="${0}" value="category"> ${0} <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> </ha-dropdown-item> <ha-dropdown-item .disabled="${0}" value="run"> ${0} <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> </ha-dropdown-item> ${0} ${0} <ha-dropdown-item value="rename" .disabled="${0}"> ${0} <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> </ha-dropdown-item> ${0} <ha-dropdown-item .disabled="${0}" value="duplicate"> ${0} <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> </ha-dropdown-item> ${0} <ha-dropdown-item value="toggle_yaml_mode"> ${0} <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> </ha-dropdown-item> <wa-divider></wa-divider> <ha-dropdown-item .disabled="${0}" value="delete" .variant="${0}"> ${0} <ha-svg-icon class="${0}" slot="icon" .path="${0}"> </ha-svg-icon> </ha-dropdown-item> </ha-dropdown> <div class="${0}"> ${0} </div> </hass-subpage> `),this.hass,this.narrow,this.route,this._backTapped,this._config.alias||this.hass.localize("ui.panel.config.script.editor.default_name"),"gui"!==this._mode||this.narrow?o.s6:(0,o.qy)(F||(F=nt`<ha-icon-button slot="toolbar-icon" .label="${0}" .path="${0}" @click="${0}" .disabled="${0}" id="button-undo"> </ha-icon-button> <ha-tooltip placement="bottom" for="button-undo"> ${0} <span class="shortcut"> (<span>${0}</span> <span>+</span> <span>Z</span>) </span> </ha-tooltip> <ha-icon-button slot="toolbar-icon" .label="${0}" .path="${0}" @click="${0}" .disabled="${0}" id="button-redo"> </ha-icon-button> <ha-tooltip placement="bottom" for="button-redo"> ${0} <span class="shortcut">( ${0}) </span> </ha-tooltip>`),this.hass.localize("ui.common.undo"),kt,this._undo,!this._undoRedoController.canUndo,this.hass.localize("ui.common.undo"),s,this.hass.localize("ui.common.redo"),mt,this._redo,!this._undoRedoController.canRedo,this.hass.localize("ui.common.redo"),S.c?(0,o.qy)(W||(W=nt`<span>${0}</span> <span>+</span> <span>Shift</span> <span>+</span> <span>Z</span>`),s):(0,o.qy)(U||(U=nt`<span>${0}</span> <span>+</span> <span>Y</span>`),s)),this.scriptId&&!this.narrow?(0,o.qy)(B||(B=nt` <ha-button appearance="plain" @click="${0}" slot="toolbar-icon"> ${0} </ha-button> `),this._showTrace,this.hass.localize("ui.panel.config.script.editor.show_trace")):"",this._handleDropdownSelect,this.hass.localize("ui.common.menu"),ut,"gui"===this._mode&&this.narrow?(0,o.qy)(T||(T=nt`<ha-dropdown-item value="undo" .disabled="${0}"> ${0} <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> </ha-dropdown-item> <ha-dropdown-item value="redo" .disabled="${0}"> ${0} <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> </ha-dropdown-item>`),!this._undoRedoController.canUndo,this.hass.localize("ui.common.undo"),kt,!this._undoRedoController.canRedo,this.hass.localize("ui.common.redo"),mt):o.s6,!this.scriptId,this.hass.localize("ui.panel.config.script.editor.show_info"),ft,!i,this.hass.localize("ui.panel.config.automation.picker.show_settings"),dt,!i,this.hass.localize("ui.panel.config.scene.picker."+(null!==(t=this._registryEntry)&&void 0!==t&&null!==(t=t.categories)&&void 0!==t&&t.script?"edit_category":"assign_category")),$t,!this.scriptId,this.hass.localize("ui.panel.config.script.picker.run_script"),yt,this.scriptId&&this.narrow?(0,o.qy)(D||(D=nt`<ha-dropdown-item value="trace"> ${0} <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> </ha-dropdown-item>`),this.hass.localize("ui.panel.config.automation.editor.show_trace"),At):o.s6,e||"fields"in this._config?o.s6:(0,o.qy)(K||(K=nt` <ha-dropdown-item .disabled="${0}" value="add_fields"> ${0} <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> </ha-dropdown-item> `),this._readOnly||"yaml"===this._mode,this.hass.localize("ui.panel.config.script.editor.field.add_fields"),_t),!this.scriptId||this._readOnly||"yaml"===this._mode,this.hass.localize("ui.panel.config.script.editor.rename"),Ct,e?o.s6:(0,o.qy)(Y||(Y=nt` <ha-dropdown-item value="change_mode" .disabled="${0}"> ${0} <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> </ha-dropdown-item> `),this._readOnly||"yaml"===this._mode,this.hass.localize("ui.panel.config.script.editor.change_mode"),ct),!!this._blueprintConfig||!this._readOnly&&!this.scriptId,this.hass.localize(this._readOnly?"ui.panel.config.script.editor.migrate":"ui.panel.config.script.editor.duplicate"),bt,e?(0,o.qy)(N||(N=nt` <ha-dropdown-item value="take_control" .disabled="${0}"> ${0} <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> </ha-dropdown-item> `),this._readOnly,this.hass.localize("ui.panel.config.script.editor.take_control"),gt):o.s6,this.hass.localize("ui.panel.config.automation.editor.edit_"+("gui"===this._mode?"yaml":"ui")),vt,this._readOnly||!this.scriptId,this.scriptId?"danger":"default",this.hass.localize("ui.panel.config.script.picker.delete"),(0,n.H)({warning:Boolean(this.scriptId)}),pt,"yaml"===this._mode?"yaml-mode":"","gui"===this._mode?(0,o.qy)(G||(G=nt` <div> ${0} </div> `),e?(0,o.qy)(X||(X=nt` <blueprint-script-editor .hass="${0}" .narrow="${0}" .isWide="${0}" .config="${0}" .disabled="${0}" .saving="${0}" .dirty="${0}" @value-changed="${0}" @save-script="${0}"></blueprint-script-editor> `),this.hass,this.narrow,this.isWide,this._config,this._readOnly,this._saving,this._dirty,this._valueChanged,this._handleSaveScript):(0,o.qy)(Q||(Q=nt` <manual-script-editor .hass="${0}" .narrow="${0}" .isWide="${0}" .config="${0}" .disabled="${0}" .dirty="${0}" .saving="${0}" @value-changed="${0}" @editor-save="${0}" @save-script="${0}"> <div class="alert-wrapper" slot="alerts"> ${0} ${0} </div> </manual-script-editor> `),this.hass,this.narrow,this.isWide,this._config,this._readOnly,this._dirty,this._saving,this._valueChanged,this._handleSaveScript,this._handleSaveScript,this._errors||(null==i?void 0:i.state)===C.Hh?(0,o.qy)(J||(J=nt`<ha-alert alert-type="error" .title="${0}"> ${0} ${0} </ha-alert>`),(null==i?void 0:i.state)===C.Hh?this.hass.localize("ui.panel.config.script.editor.unavailable"):void 0,this._errors||this._validationErrors,(null==i?void 0:i.state)===C.Hh?(0,o.qy)(tt||(tt=nt`<ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon>`),wt):o.s6):o.s6,this._blueprintConfig?(0,o.qy)(it||(it=nt`<ha-alert alert-type="info"> ${0} <div slot="action" style="display:flex"> <ha-button appearance="plain" @click="${0}">${0}</ha-button> <ha-button appearance="plain" @click="${0}">${0}</ha-button> </div> </ha-alert>`),this.hass.localize("ui.panel.config.script.editor.confirm_take_control"),this._takeControlSave,this.hass.localize("ui.common.yes"),this._revertBlueprint,this.hass.localize("ui.common.no")):this._readOnly?(0,o.qy)(et||(et=nt`<ha-alert alert-type="warning" dismissable>${0} <ha-button appearance="plain" slot="action" @click="${0}"> ${0} </ha-button> </ha-alert>`),this.hass.localize("ui.panel.config.script.editor.read_only"),this._duplicate,this.hass.localize("ui.panel.config.script.editor.migrate")):o.s6)):"yaml"===this._mode?(0,o.qy)(st||(st=nt`<ha-yaml-editor .hass="${0}" .defaultValue="${0}" .readOnly="${0}" disable-fullscreen @value-changed="${0}" @editor-save="${0}" .showErrors="${0}"></ha-yaml-editor> <ha-fab slot="fab" class="${0}" .label="${0}" .disabled="${0}" extended @click="${0}"> <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> </ha-fab>`),this.hass,this._preprocessYaml(),this._readOnly,this._yamlChanged,this._handleSaveScript,!1,!this._readOnly&&this._dirty?"dirty":"",this.hass.localize("ui.common.save"),this._saving,this._handleSaveScript,ht):o.s6)}updated(t){super.updated(t);const i=t.get("scriptId");if(!t.has("scriptId")||!this.scriptId||this.entityId||!this.hass||i&&i===this.scriptId||this._loadConfig(),(t.has("scriptId")||t.has("entityRegistry"))&&this.scriptId&&this.entityRegistry){const t=this.entityRegistry.find(t=>"script"===t.platform&&t.unique_id===this.scriptId);this._entityId=null==t?void 0:t.entity_id}if(t.has("scriptId")&&!this.scriptId&&this.hass){const t=(0,$.NX)();this._dirty=!!t;const i={};t&&"use_blueprint"in t||(i.sequence=[]),this._config=Object.assign(Object.assign({},i),t),this._readOnly=!1}if(t.has("entityId")&&this.entityId){(0,$.R$)(this.hass,this.entityId).then(t=>{this._config=(0,$.nB)(t.config),this._checkValidation()});const t=this.entityRegistry.find(t=>t.entity_id===this.entityId);null!=t&&t.unique_id&&(this.scriptId=t.unique_id),this._entityId=this.entityId,this._dirty=!1,this._readOnly=!0}}async _checkValidation(){if(this._validationErrors=void 0,!this._entityId||!this._config)return;const t=this.hass.states[this._entityId];if((null==t?void 0:t.state)!==C.Hh)return;const i=await(0,b.$)(this.hass,{actions:this._config.sequence});this._validationErrors=Object.entries(i).map(([t,i])=>i.valid?"":(0,o.qy)(at||(at=nt`${0}: ${0}<br>`),this.hass.localize(`ui.panel.config.automation.editor.${t}.name`),i.error))}async _loadConfig(){(0,$.Kq)(this.hass,this.scriptId).then(t=>{this._dirty=!1,this._readOnly=!1,this._config=(0,$.nB)(t);const i=this.entityRegistry.find(t=>"script"===t.platform&&t.unique_id===this.scriptId);this._entityId=null==i?void 0:i.entity_id,this._checkValidation()},t=>{const i=this.entityRegistry.find(t=>"script"===t.platform&&t.unique_id===this.scriptId);i?(0,c.o)(`/config/script/show/${i.entity_id}`,{replace:!0}):(alert(404===t.status_code?this.hass.localize("ui.panel.config.script.editor.load_error_not_editable"):this.hass.localize("ui.panel.config.script.editor.load_error_unknown",{err_no:t.status_code||t.code})),(0,c.O)("/config"))})}_valueChanged(t){this._config&&this._undoRedoController.commit(this._config),this._config=t.detail.value,this._errors=void 0,this._dirty=!0}async _runScript(){(0,$.TP)(this.hass,this._entityId)?(0,k.p)(this,{entityId:this._entityId}):(await(0,$.kR)(this.hass,this.scriptId),(0,z.P)(this,{message:this.hass.localize("ui.notification_toast.triggered",{name:this._config.alias})}))}_showSettings(){(0,k.p)(this,{entityId:this._entityId,view:"settings"})}_editCategory(){this._registryEntry?(0,I.j)(this,{scope:"script",entityReg:this._registryEntry}):(0,A.showAlertDialog)(this,{title:this.hass.localize("ui.panel.config.scene.picker.no_category_support"),text:this.hass.localize("ui.panel.config.scene.picker.no_category_entity_reg")})}_computeEntityIdFromAlias(t){const i=(0,p.Y)(t);let e=i,s=2;for(;this._idIsUsed(e);)e=`${i}_${s}`,s++;return e}_idIsUsed(t){return`script.${t}`in this.hass.states||this.entityRegistry.some(i=>i.unique_id===t)}async _showInfo(){if(!this.scriptId)return;const t=this.entityRegistry.find(t=>t.unique_id===this.scriptId);t&&(0,h.r)(this,"hass-more-info",{entityId:t.entity_id})}async _showTrace(){if(this.scriptId){await this._confirmUnsavedChanged()&&(0,c.o)(`/config/script/trace/${this.scriptId}`)}}_addFields(){var t;"fields"in this._config||(this._config&&this._undoRedoController.commit(this._config),null===(t=this._manualEditor)||void 0===t||t.addFields(),this._dirty=!0)}_preprocessYaml(){return this._config}_yamlChanged(t){t.stopPropagation(),this._dirty=!0,t.detail.isValid?(this._yamlErrors=void 0,this._config=t.detail.value,this._errors=void 0):this._yamlErrors=t.detail.errorMsg}async _confirmUnsavedChanged(){return!this._dirty||new Promise(t=>{(0,q._)(this,{config:this._config,domain:"script",updateConfig:async(i,e)=>{this._config=i,this._entityRegistryUpdate=e,this._dirty=!0,this.requestUpdate();const s=this.scriptId||String(Date.now());try{await this._saveScript(s)}catch(a){return this.requestUpdate(),void t(!1)}t(!0)},onClose:()=>t(!1),onDiscard:()=>t(!0),entityRegistryUpdate:this._entityRegistryUpdate,entityRegistryEntry:this._registryEntry,title:this.hass.localize(this.scriptId?"ui.panel.config.script.editor.leave.unsaved_confirm_title":"ui.panel.config.script.editor.leave.unsaved_new_title"),description:this.hass.localize(this.scriptId?"ui.panel.config.script.editor.leave.unsaved_confirm_text":"ui.panel.config.script.editor.leave.unsaved_new_text"),hideInputs:null!==this.scriptId})})}async _takeControl(){const t=this._config;try{const e=await(0,v.oz)(this.hass,"script",t.use_blueprint.path,t.use_blueprint.input||{}),s=Object.assign(Object.assign({},(0,$.nB)(e.substituted_config)),{},{alias:t.alias,description:t.description});var i;if(this._blueprintConfig=t,this._config=s,"yaml"===this._mode)null===(i=this.renderRoot.querySelector("ha-yaml-editor"))||void 0===i||i.setValue(this._config);this._readOnly=!0,this._errors=void 0}catch(e){this._errors=e.message}}_revertBlueprint(){var t;(this._config=this._blueprintConfig,"yaml"===this._mode)&&(null===(t=this.renderRoot.querySelector("ha-yaml-editor"))||void 0===t||t.setValue(this._config));this._blueprintConfig=void 0,this._readOnly=!1}_takeControlSave(){this._readOnly=!1,this._dirty=!0,this._blueprintConfig=void 0}async _duplicate(){var t,i;(this._readOnly?await(0,A.dk)(this,{title:this.hass.localize("ui.panel.config.script.picker.migrate_script"),text:this.hass.localize("ui.panel.config.script.picker.migrate_script_description")}):await this._confirmUnsavedChanged())&&(this._entityId=void 0,(0,$.AM)(Object.assign(Object.assign({},this._config),{},{alias:this._readOnly?null===(t=this._config)||void 0===t?void 0:t.alias:`${null===(i=this._config)||void 0===i?void 0:i.alias} (${this.hass.localize("ui.panel.config.script.picker.duplicate")})`})))}async _deleteConfirm(){var t;(0,A.dk)(this,{title:this.hass.localize("ui.panel.config.script.editor.delete_confirm_title"),text:this.hass.localize("ui.panel.config.script.editor.delete_confirm_text",{name:null===(t=this._config)||void 0===t?void 0:t.alias}),confirmText:this.hass.localize("ui.common.delete"),destructive:!0,dismissText:this.hass.localize("ui.common.cancel"),confirm:()=>this._delete()})}async _delete(){await(0,$.Ht)(this.hass,this.scriptId),(0,c.O)("/config")}async _switchUiMode(){if(this._yamlErrors){if(!(await(0,A.dk)(this,{text:(0,o.qy)(ot||(ot=nt`${0}<br><br>${0}`),this.hass.localize("ui.panel.config.automation.editor.switch_ui_yaml_error"),this._yamlErrors),confirmText:this.hass.localize("ui.common.continue"),destructive:!0,dismissText:this.hass.localize("ui.common.cancel")})))return}this._yamlErrors=void 0,this._mode="gui"}_switchYamlMode(){this._mode="yaml"}async _promptScriptAlias(){return new Promise(t=>{(0,q._)(this,{config:this._config,domain:"script",updateConfig:async(i,e)=>{this._config=i,this._entityRegistryUpdate=e,this._dirty=!0,this.requestUpdate(),t(!0)},onClose:()=>t(!1),entityRegistryUpdate:this._entityRegistryUpdate,entityRegistryEntry:this.entityRegistry.find(t=>t.unique_id===this.scriptId)})})}async _promptScriptMode(){return new Promise(t=>{(0,L.e)(this,{config:this._config,updateConfig:i=>{this._config=i,this._dirty=!0,this.requestUpdate(),t()},onClose:()=>t()})})}async _handleSaveScript(){var t;if(this._yamlErrors)return void(0,z.P)(this,{message:this._yamlErrors});if(null===(t=this._manualEditor)||void 0===t||t.resetPastedConfig(),!this.scriptId){if(!(await this._promptScriptAlias()))return;this._entityId=this._computeEntityIdFromAlias(this._config.alias)}const i=this.scriptId||this._entityId||Date.now();await this._saveScript(i),this.scriptId||(0,c.o)(`/config/script/edit/${i}`,{replace:!0})}async _saveScript(t){let i;this._saving=!0,void 0===this._entityRegistryUpdate||this.scriptId||(this._newScriptId=t.toString(),i=new Promise(t=>{this._entityRegCreated=t}));try{if(await this.hass.callApi("POST","config/script/config/"+t,this._config),void 0!==this._entityRegistryUpdate){let t=this._entityId;if(i)try{t=(await(0,u.h)(5e3,i)).entity_id}catch(a){if(t=void 0,!(a instanceof Error&&"TimeoutError"===a.name))throw a;await(0,R.j)(this,{savedPromise:i,type:"script"});try{t=(await(0,u.h)(0,i)).entity_id}catch(o){if(!(o instanceof Error&&"TimeoutError"===o.name))throw o}}t&&await(0,w.G_)(this.hass,t,{categories:{script:this._entityRegistryUpdate.category||null},labels:this._entityRegistryUpdate.labels||[],area_id:this._entityRegistryUpdate.area||null})}this._dirty=!1}catch(r){var e,s;throw this._errors=(null===(e=r.body)||void 0===e?void 0:e.message)||r.error||r.body,(0,z.P)(this,{message:(null===(s=r.body)||void 0===s?void 0:s.message)||r.error||r.body}),r}finally{this._saving=!1}}supportedShortcuts(){return{s:()=>this._handleSaveScript(),c:()=>this._copySelectedRow(),x:()=>this._cutSelectedRow(),Delete:()=>this._deleteSelectedRow(),Backspace:()=>this._deleteSelectedRow(),z:()=>this._undo(),Z:()=>this._redo(),y:()=>this._redo()}}get isDirty(){return this._dirty}async promptDiscardChanges(){return this._confirmUnsavedChanged()}_collapseAll(){var t;null===(t=this._manualEditor)||void 0===t||t.collapseAll()}_expandAll(){var t;null===(t=this._manualEditor)||void 0===t||t.expandAll()}_copySelectedRow(){var t;null===(t=this._manualEditor)||void 0===t||t.copySelectedRow()}_cutSelectedRow(){var t;null===(t=this._manualEditor)||void 0===t||t.cutSelectedRow()}_deleteSelectedRow(){var t;null===(t=this._manualEditor)||void 0===t||t.deleteSelectedRow()}_applyUndoRedo(t){var i;null===(i=this._manualEditor)||void 0===i||i.triggerCloseSidebar(),this._config=t,this._dirty=!0}_undo(){this._undoRedoController.undo()}_redo(){this._undoRedoController.redo()}_handleDropdownSelect(t){var i;const e=null===(i=t.detail)||void 0===i||null===(i=i.item)||void 0===i?void 0:i.value;if(e)switch(e){case"undo":this._undo();break;case"redo":this._redo();break;case"info":this._showInfo();break;case"settings":this._showSettings();break;case"category":this._editCategory();break;case"run":this._runScript();break;case"add_fields":this._addFields();break;case"rename":this._promptScriptAlias();break;case"change_mode":this._promptScriptMode();break;case"duplicate":this._duplicate();break;case"take_control":this._takeControl();break;case"toggle_yaml_mode":if("gui"===this._mode){this._switchYamlMode();break}this._switchUiMode();break;case"delete":this._deleteConfirm();break;case"trace":this._showTrace()}}static get styles(){return[V.RF,(0,o.AH)(rt||(rt=nt`:host{--ha-automation-editor-max-width:var(
            --ha-automation-editor-width,
            1540px
          );--hass-subpage-bottom-inset:0px}.yaml-mode{height:100%;display:flex;flex-direction:column;padding-bottom:0}blueprint-script-editor,manual-script-editor{margin:0 auto;max-width:1040px;padding:28px 20px 0;display:block}:not(.yaml-mode)>.error-wrapper{position:absolute;top:4px;z-index:3;width:100%;display:flex;flex-direction:column;align-items:center}:not(.yaml-mode)>.error-wrapper ha-alert{background-color:var(--card-background-color);box-shadow:0 2px 4px rgba(0,0,0,.2);border-radius:var(--ha-border-radius-sm)}.alert-wrapper{position:sticky;top:-24px;margin-top:-24px;margin-bottom:8px;z-index:1;width:100%;display:flex;flex-direction:column;align-items:center;gap:var(--ha-space-2);pointer-events:none}.alert-wrapper ha-alert{background-color:var(--card-background-color);box-shadow:0 2px 4px rgba(0,0,0,.2);border-radius:var(--ha-border-radius-sm);margin-bottom:0;pointer-events:auto}manual-script-editor{max-width:var(--ha-automation-editor-max-width);padding:0 12px}ha-yaml-editor{flex-grow:1;--actions-border-radius:var(--ha-border-radius-square);--code-mirror-height:100%;min-height:0;display:flex;flex-direction:column}p{margin-bottom:0}span[slot=introduction] a{color:var(--primary-color)}ha-fab{position:fixed;right:16px;bottom:calc(-80px - var(--safe-area-inset-bottom));transition:bottom .3s}ha-fab.dirty{bottom:calc(16px + var(--safe-area-inset-bottom,0px))}.header{display:flex;margin:16px 0;align-items:center}.header .name{font-size:var(--ha-font-size-xl);font-weight:var(--ha-font-weight-normal);flex:1}.header a{color:var(--secondary-text-color)}ha-tooltip ha-svg-icon{width:12px}ha-tooltip .shortcut{display:inline-flex;flex-direction:row;align-items:center;gap:2px}`))]}constructor(...t){super(...t),this.scriptId=null,this.entityId=null,this.isWide=!1,this.narrow=!1,this._dirty=!1,this._mode="gui",this._readOnly=!1,this._saving=!1,this._undoRedoController=new l.X(this,{apply:t=>this._applyUndoRedo(t),currentConfig:()=>this._config}),this._backTapped=async()=>{await this._confirmUnsavedChanged()&&(0,g.m)(()=>(0,c.O)("/config"))}}}(0,s.Cg)([(0,r.MZ)({attribute:!1})],Ht.prototype,"hass",void 0),(0,s.Cg)([(0,r.MZ)({attribute:!1})],Ht.prototype,"scriptId",void 0),(0,s.Cg)([(0,r.MZ)({attribute:!1})],Ht.prototype,"entityId",void 0),(0,s.Cg)([(0,r.MZ)({attribute:!1})],Ht.prototype,"entityRegistry",void 0),(0,s.Cg)([(0,r.MZ)({attribute:"is-wide",type:Boolean})],Ht.prototype,"isWide",void 0),(0,s.Cg)([(0,r.MZ)({type:Boolean})],Ht.prototype,"narrow",void 0),(0,s.Cg)([(0,r.MZ)({attribute:!1})],Ht.prototype,"route",void 0),(0,s.Cg)([(0,r.wk)()],Ht.prototype,"_config",void 0),(0,s.Cg)([(0,r.wk)()],Ht.prototype,"_dirty",void 0),(0,s.Cg)([(0,r.wk)()],Ht.prototype,"_errors",void 0),(0,s.Cg)([(0,r.wk)()],Ht.prototype,"_yamlErrors",void 0),(0,s.Cg)([(0,r.wk)()],Ht.prototype,"_entityId",void 0),(0,s.Cg)([(0,r.wk)()],Ht.prototype,"_mode",void 0),(0,s.Cg)([(0,r.wk)()],Ht.prototype,"_readOnly",void 0),(0,s.Cg)([(0,r.wk)(),(0,a.Fg)({context:m.ih,subscribe:!0}),(0,d.p)({transformer:function(t){return t.find(({entity_id:t})=>t===this._entityId)},watch:["_entityId"]})],Ht.prototype,"_registryEntry",void 0),(0,s.Cg)([(0,r.P)("manual-script-editor")],Ht.prototype,"_manualEditor",void 0),(0,s.Cg)([(0,r.wk)()],Ht.prototype,"_validationErrors",void 0),(0,s.Cg)([(0,r.wk)()],Ht.prototype,"_blueprintConfig",void 0),(0,s.Cg)([(0,r.wk)()],Ht.prototype,"_saving",void 0),Ht=(0,s.Cg)([(0,r.EM)("ha-script-editor")],Ht),i()}catch(P){i(P)}})},17625:function(t,i,e){e.a(t,async function(t,i){try{e(74423),e(62953);var s=e(40445),a=e(96196),o=e(77845),r=e(94333),n=e(1087),l=e(99124),d=e(57237),h=(e(14844),e(76776),e(29823)),c=(e(70947),e(84383)),p=e(14503),u=e(41570),g=e(81619),_=e(57116),f=e(50940),y=t([h,f]);[h,f]=y.then?(await y)():y;let v,b,m,C,w,$,A,k,H=t=>t;const x="M6,2A4,4 0 0,1 10,6V8H14V6A4,4 0 0,1 18,2A4,4 0 0,1 22,6A4,4 0 0,1 18,10H16V14H18A4,4 0 0,1 22,18A4,4 0 0,1 18,22A4,4 0 0,1 14,18V16H10V18A4,4 0 0,1 6,22A4,4 0 0,1 2,18A4,4 0 0,1 6,14H8V10H6A4,4 0 0,1 2,6A4,4 0 0,1 6,2M16,18A2,2 0 0,0 18,20A2,2 0 0,0 20,18A2,2 0 0,0 18,16H16V18M14,10H10V14H14V10M6,16A2,2 0 0,0 4,18A2,2 0 0,0 6,20A2,2 0 0,0 8,18V16H6M8,6A2,2 0 0,0 6,4A2,2 0 0,0 4,6A2,2 0 0,0 6,8H8V6M18,8A2,2 0 0,0 20,6A2,2 0 0,0 18,4A2,2 0 0,0 16,6V8H18Z",M="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z",V="M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z",S="M3 6V8H14V6H3M3 10V12H14V10H3M20 10.1C19.9 10.1 19.7 10.2 19.6 10.3L18.6 11.3L20.7 13.4L21.7 12.4C21.9 12.2 21.9 11.8 21.7 11.6L20.4 10.3C20.3 10.2 20.2 10.1 20 10.1M18.1 11.9L12 17.9V20H14.1L20.2 13.9L18.1 11.9M3 14V16H10V14H3Z";class z extends a.WF{render(){const t=this.field.selector&&"object"==typeof this.field.selector;return(0,a.qy)(v||(v=H` <ha-card outlined> <ha-automation-row .disabled="${0}" @click="${0}" .selected="${0}" .leftChevron="${0}" @toggle-collapsed="${0}" .collapsed="${0}" .highlight="${0}" @delete-row="${0}"> <ha-dropdown slot="icons" @click="${0}" @keydown="${0}" @wa-select="${0}" placement="bottom-end"> <ha-icon-button slot="trigger" .label="${0}" .path="${0}"></ha-icon-button> <ha-dropdown-item value="toggle_yaml_mode"> <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> <div class="overflow-label"> ${0} <span class="shortcut-placeholder ${0}"></span> </div> </ha-dropdown-item> <ha-dropdown-item value="delete" .disabled="${0}" variant="danger"> <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> <div class="overflow-label"> ${0} ${0} </div> </ha-dropdown-item> </ha-dropdown> <h3 slot="header">${0}</h3> <slot name="icons" slot="icons"></slot> </ha-automation-row> </ha-card> ${0} `),this.disabled,this._toggleSidebar,this._selected,t,this._toggleCollapse,this._collapsed,this.highlight,this._onDelete,l.C,d.d,this._handleDropdownSelect,this.hass.localize("ui.common.menu"),V,S,this.hass.localize("ui.panel.config.automation.editor.edit_"+(this._yamlMode?"ui":"yaml")),u.c?"mac":"",this.disabled,M,this.hass.localize("ui.panel.config.automation.editor.actions.delete"),this.narrow?a.s6:(0,a.qy)(b||(b=H`<span class="shortcut"> <span>${0}</span> <span>+</span> <span>${0}</span> </span>`),u.c?(0,a.qy)(m||(m=H`<ha-svg-icon .path="${0}"></ha-svg-icon>`),x):this.hass.localize("ui.panel.config.automation.editor.ctrl"),this.hass.localize("ui.panel.config.automation.editor.del")),this.key,t?(0,a.qy)(C||(C=H` <div class="${0}"> <ha-card> <ha-automation-row .selected="${0}" @click="${0}" .collapsed="${0}" @toggle-collapsed="${0}" .leftChevron="${0}" .highlight="${0}"> <h3 slot="header"> ${0} ${0} </h3> <ha-dropdown slot="icons" @click="${0}" @keydown="${0}" @wa-select="${0}" placement="bottom-end"> <ha-icon-button slot="trigger" .label="${0}" .path="${0}"></ha-icon-button> <ha-dropdown-item value="toggle_yaml_mode" selector-row> <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> <div class="overflow-label"> ${0} <span class="shortcut-placeholder ${0}"></span> </div> </ha-dropdown-item> <ha-dropdown-item value="delete" .disabled="${0}" variant="danger"> <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> <div class="overflow-label"> ${0} ${0} </div> </ha-dropdown-item> </ha-dropdown> </ha-automation-row> </ha-card> ${0} </div> `),(0,r.H)({"selector-row":!0,"parent-selected":this._selected,hidden:this._collapsed}),this._selectorRowSelected,this._toggleSelectorSidebar,this._selectorRowCollapsed,this._toggleSelectorRowCollapse,c.W.includes(Object.keys(this.field.selector)[0]),this.highlight,this.hass.localize(`ui.components.selectors.selector.types.${Object.keys(this.field.selector)[0]}`),this.hass.localize("ui.panel.config.script.editor.field.selector"),l.C,d.d,this._handleDropdownSelect,this.hass.localize("ui.common.menu"),V,S,this.hass.localize("ui.panel.config.automation.editor.edit_"+(this._yamlMode?"ui":"yaml")),u.c?"mac":"",this.disabled,M,this.hass.localize("ui.panel.config.automation.editor.actions.delete"),this.narrow?a.s6:(0,a.qy)(w||(w=H`<span class="shortcut"> <span>${0}</span> <span>+</span> <span>${0}</span> </span>`),u.c?(0,a.qy)($||($=H`<ha-svg-icon .path="${0}"></ha-svg-icon>`),x):this.hass.localize("ui.panel.config.automation.editor.ctrl"),this.hass.localize("ui.panel.config.automation.editor.del")),"object"==typeof this.field.selector&&c.W.includes(Object.keys(this.field.selector)[0])?(0,a.qy)(A||(A=H` <ha-script-field-selector-editor class="${0}" .selected="${0}" .hass="${0}" .field="${0}" .disabled="${0}" indent @value-changed="${0}" .narrow="${0}"></ha-script-field-selector-editor> `),this._selectorRowCollapsed?"hidden":"",this._selectorRowSelected,this.hass,this.field,this.disabled,this._selectorValueChanged,this.narrow):a.s6):a.s6)}_toggleCollapse(){this._collapsed=!this._collapsed}expand(){this._collapsed=!1}collapse(){this._collapsed=!0}expandSelectorRow(){this._selectorRowCollapsed=!1}collapseSelectorRow(){this._selectorRowCollapsed=!0}_toggleSelectorRowCollapse(){this._selectorRowCollapsed=!this._selectorRowCollapsed}expandAll(){var t;this.expand(),this.expandSelectorRow(),null===(t=this._selectorEditor)||void 0===t||t.expandAll()}collapseAll(){var t;this.collapse(),this.collapseSelectorRow(),null===(t=this._selectorEditor)||void 0===t||t.collapseAll()}_toggleSidebar(t){null==t||t.stopPropagation(),this._selected?(0,n.r)(this,"request-close-sidebar"):(this._selected=!0,this._collapsed=!1,this.openSidebar())}_toggleSelectorSidebar(t){null==t||t.stopPropagation(),this._selectorRowSelected?(0,n.r)(this,"request-close-sidebar"):(this._selectorRowSelected=!0,this._selectorRowCollapsed=!1,this.openSidebar(!0))}_selectorValueChanged(t){t.stopPropagation(),(0,n.r)(this,"value-changed",{value:Object.assign(Object.assign({},this.field),{},{key:this.key},t.detail.value)})}openSidebar(t=!1){t||(this._selected=!0),(0,n.r)(this,"open-sidebar",{save:t=>{(0,n.r)(this,"value-changed",{value:t})},close:i=>{t?(this._selectorRowSelected=!1,i&&this.focusSelector()):(this._selected=!1,i&&this.focus()),(0,n.r)(this,"close-sidebar")},toggleYamlMode:()=>{this._toggleYamlMode(),this.openSidebar()},delete:this._onDelete,config:{field:this.field,selector:t,key:this.key,excludeKeys:this.excludeKeys},yamlMode:this._yamlMode}),this.narrow&&window.setTimeout(()=>{this.scrollIntoView({block:"start",behavior:"smooth"})},180)}focus(){var t;null===(t=this._fieldRowElement)||void 0===t||t.focus()}focusSelector(){var t;null===(t=this._selectorRowElement)||void 0===t||t.focus()}_handleDropdownSelect(t){var i;const e=null===(i=t.detail)||void 0===i||null===(i=i.item)||void 0===i?void 0:i.value;if(e)switch(e){case"toggle_yaml_mode":this._toggleYamlMode(t.target);break;case"delete":this._onDelete()}}static get styles(){return[p.RF,_.aM,_.Lt,(0,a.AH)(k||(k=H`.disabled{opacity:.5;pointer-events:none}.hidden{display:none}h3{margin:0;font-size:inherit;font-weight:inherit}.action-icon{display:none}@media (min-width:870px){.action-icon{display:inline-block;color:var(--secondary-text-color);opacity:.9;margin-right:8px;margin-inline-end:8px;margin-inline-start:initial}}.card-content{padding:16px}.disabled-bar{background:var(--divider-color,#e0e0e0);text-align:center;border-top-right-radius:calc(var(--ha-card-border-radius,var(--ha-border-radius-lg)) - var(--ha-card-border-width,1px));border-top-left-radius:calc(var(--ha-card-border-radius,var(--ha-border-radius-lg)) - var(--ha-card-border-width,1px))}.warning ul{margin:4px 0}.selected_menu_item{color:var(--primary-color)}.selector-row{padding-top:12px;padding-bottom:16px;padding-inline-start:16px;padding-inline-end:0px}`))]}constructor(...t){super(...t),this.excludeKeys=[],this.disabled=!1,this.narrow=!1,this._yamlMode=!1,this._selected=!1,this._collapsed=!1,this._selectorRowSelected=!1,this._selectorRowCollapsed=!1,this._toggleYamlMode=t=>{this._yamlMode=!this._yamlMode,t&&this.openSidebar(t.hasAttribute("selector-row"))},this._onDelete=()=>{(0,n.r)(this,"value-changed",{value:null}),(this._selected||this._selectorRowSelected)&&(0,n.r)(this,"close-sidebar"),(0,g.P)(this,{message:this.hass.localize("ui.common.successfully_deleted"),duration:4e3,action:{text:this.hass.localize("ui.common.undo"),action:()=>{(0,n.r)(window,"undo-change")}}})}}}(0,s.Cg)([(0,o.MZ)({attribute:!1})],z.prototype,"hass",void 0),(0,s.Cg)([(0,o.MZ)()],z.prototype,"key",void 0),(0,s.Cg)([(0,o.MZ)({attribute:!1,type:Array})],z.prototype,"excludeKeys",void 0),(0,s.Cg)([(0,o.MZ)({attribute:!1})],z.prototype,"field",void 0),(0,s.Cg)([(0,o.MZ)({type:Boolean})],z.prototype,"disabled",void 0),(0,s.Cg)([(0,o.MZ)({type:Boolean})],z.prototype,"narrow",void 0),(0,s.Cg)([(0,o.MZ)({type:Boolean})],z.prototype,"highlight",void 0),(0,s.Cg)([(0,o.wk)()],z.prototype,"_yamlMode",void 0),(0,s.Cg)([(0,o.wk)()],z.prototype,"_selected",void 0),(0,s.Cg)([(0,o.wk)()],z.prototype,"_collapsed",void 0),(0,s.Cg)([(0,o.wk)()],z.prototype,"_selectorRowSelected",void 0),(0,s.Cg)([(0,o.wk)()],z.prototype,"_selectorRowCollapsed",void 0),(0,s.Cg)([(0,o.P)("ha-script-field-selector-editor")],z.prototype,"_selectorEditor",void 0),(0,s.Cg)([(0,o.P)("ha-automation-row:first-of-type")],z.prototype,"_fieldRowElement",void 0),(0,s.Cg)([(0,o.P)(".selector-row ha-automation-row")],z.prototype,"_selectorRowElement",void 0),z=(0,s.Cg)([(0,o.EM)("ha-script-field-row")],z),i()}catch(v){i(v)}})},95415:function(t,i,e){e.a(t,async function(t,i){try{e(18111),e(22489),e(7588),e(61701),e(62953);var s=e(40445),a=e(96196),o=e(77845),r=e(1087),n=e(18350),l=(e(67094),e(17625)),d=t([n,l]);[n,l]=d.then?(await d)():d;let h,c,p,u,g=t=>t;const _="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z";class f extends a.WF{render(){return(0,a.qy)(h||(h=g` ${0} <ha-button @click="${0}" .disabled="${0}"> <ha-svg-icon .path="${0}" slot="start"></ha-svg-icon> ${0} </ha-button> `),this.fields?(0,a.qy)(c||(c=g`<div class="fields"> ${0} </div> `),Object.entries(this.fields).map(([t,i])=>{var e;return(0,a.qy)(p||(p=g` <ha-script-field-row .key="${0}" .excludeKeys="${0}" .field="${0}" .disabled="${0}" @value-changed="${0}" .hass="${0}" .highlight="${0}" .narrow="${0}"> </ha-script-field-row> `),t,Object.keys(this.fields).filter(i=>i!==t),i,this.disabled,this._fieldChanged,this.hass,void 0!==(null===(e=this.highlightedFields)||void 0===e?void 0:e[t]),this.narrow)})):a.s6,this._addField,this.disabled,_,this.hass.localize("ui.panel.config.script.editor.field.add_field"))}updated(t){super.updated(t),t.has("fields")&&this._focusLastActionOnChange&&(this._focusLastActionOnChange=!1,this.focusLastField())}focusLastField(){const t=this.shadowRoot.querySelector("ha-script-field-row:last-of-type");t.updateComplete.then(()=>{t.openSidebar(),t.focus(),this.narrow&&window.setTimeout(()=>{t.scrollIntoView({block:"start",behavior:"smooth"})},180)})}_addField(){const t=this._getUniqueKey(this.hass.localize("ui.panel.config.script.editor.field.field")||"field",this.fields||{}),i=Object.assign(Object.assign({},this.fields||{}),{},{[t]:{selector:{text:null}}});this._focusLastActionOnChange=!0,(0,r.r)(this,"value-changed",{value:i})}_fieldChanged(t){t.stopPropagation();const i=t.target.key;let e={};if(null===t.detail.value)e=Object.assign({},this.fields),delete e[i];else{const s=Object.assign({},t.detail.value),a=s.key;delete s.key;i!==a?Object.entries(this.fields).forEach(([t,o])=>{t===i?e[a]=s:e[t]=o}):(e=Object.assign({},this.fields),e[i]=s)}(0,r.r)(this,"value-changed",{value:e})}_getUniqueKey(t,i){let e=t;if(t in i){let s=2;do{e=`${t}_${s}`,s++}while(e in i)}return e}expandAll(){var t;null===(t=this._fieldRowElements)||void 0===t||t.forEach(t=>{t.expandAll()})}collapseAll(){var t;null===(t=this._fieldRowElements)||void 0===t||t.forEach(t=>{t.collapseAll()})}constructor(...t){super(...t),this.disabled=!1,this.narrow=!1,this._focusLastActionOnChange=!1}}f.styles=(0,a.AH)(u||(u=g`ha-script-field-row{display:block;margin-bottom:16px;scroll-margin-top:48px}ha-svg-icon{height:20px}`)),(0,s.Cg)([(0,o.MZ)({attribute:!1})],f.prototype,"hass",void 0),(0,s.Cg)([(0,o.MZ)({type:Boolean})],f.prototype,"disabled",void 0),(0,s.Cg)([(0,o.MZ)({attribute:!1})],f.prototype,"fields",void 0),(0,s.Cg)([(0,o.MZ)({attribute:!1})],f.prototype,"highlightedFields",void 0),(0,s.Cg)([(0,o.MZ)({type:Boolean})],f.prototype,"narrow",void 0),(0,s.Cg)([(0,o.YG)("ha-script-field-row")],f.prototype,"_fieldRowElements",void 0),f=(0,s.Cg)([(0,o.EM)("ha-script-fields")],f),i()}catch(h){i(h)}})},42180:function(t,i,e){e.a(t,async function(t,i){try{e(89463),e(74423),e(44114),e(18111),e(81148),e(22489),e(20116),e(7588),e(61701),e(13579),e(3362),e(96167),e(27495),e(17642),e(58004),e(33853),e(45876),e(32475),e(15024),e(31698),e(62953),e(48408),e(14603),e(47566),e(98721);var s=e(40445),a=(e(94422),e(88696)),o=e(16527),r=e(6946),n=e(96196),l=e(77845),d=e(6415),h=e(22786),c=e(78870),p=e(36312),u=e(95747),g=e(98975),_=e(93905),f=e(1087),y=e(28978),v=e(91926),b=e(80880),m=e(87710),C=e(86171),w=e(29823),$=(e(70947),e(27661),e(645),e(41113)),A=(e(52190),e(66702)),k=(e(72644),e(138)),H=e(2617),x=(e(26300),e(75248)),M=(e(58491),e(69175),e(16443),e(82988),e(67094),e(34127)),V=e(53641),S=e(76570),z=e(38911),L=e(77001),q=e(22675),R=e(59241),I=e(14782),E=e(92557),O=e(84025),Z=e(71606),P=e(65063),j=e(42269),F=e(72553),W=e(54706),U=e(14503),B=e(36918),T=e(81619),D=e(34023),K=e(14839),Y=e(55270),N=e(90986),G=e(25635),X=e(69569),Q=e(94017),J=e(19661),tt=t([C,w,$,A,k,H,x,M,F,a,u,g,Q]);[C,w,$,A,k,H,x,M,F,a,u,g,Q]=tt.then?(await tt)():tt;let it,et,st,at,ot,rt,nt,lt,dt,ht,ct,pt,ut,gt,_t,ft,yt,vt,bt,mt,Ct,wt,$t,At,kt,Ht,xt,Mt,Vt,St,zt,Lt,qt=t=>t;const Rt="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z",It="M11,17H4A2,2 0 0,1 2,15V3A2,2 0 0,1 4,1H16V3H4V15H11V13L15,16L11,19V17M19,21V7H8V13H6V7A2,2 0 0,1 8,5H19A2,2 0 0,1 21,7V21A2,2 0 0,1 19,23H8A2,2 0 0,1 6,21V19H8V21H19Z",Et="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z",Ot="M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z",Zt="M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.67 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z",Pt="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z",jt="M7,10L12,15L17,10H7Z",Ft="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z",Wt="M8,5.14V19.14L19,12.14L8,5.14Z",Ut="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z",Bt="M17.8,20C17.4,21.2 16.3,22 15,22H5C3.3,22 2,20.7 2,19V18H5L14.2,18C14.6,19.2 15.7,20 17,20H17.8M19,2C20.7,2 22,3.3 22,5V6H20V5C20,4.4 19.6,4 19,4C18.4,4 18,4.4 18,5V18H17C16.4,18 16,17.6 16,17V16H5V5C5,3.3 6.3,2 8,2H19M8,6V8H15V6H8M8,10V12H14V10H8Z",Tt="M5.5,7A1.5,1.5 0 0,1 4,5.5A1.5,1.5 0 0,1 5.5,4A1.5,1.5 0 0,1 7,5.5A1.5,1.5 0 0,1 5.5,7M21.41,11.58L12.41,2.58C12.05,2.22 11.55,2 11,2H4C2.89,2 2,2.89 2,4V11C2,11.55 2.22,12.05 2.59,12.41L11.58,21.41C11.95,21.77 12.45,22 13,22C13.55,22 14.05,21.77 14.41,21.41L21.41,14.41C21.78,14.05 22,13.55 22,13C22,12.44 21.77,11.94 21.41,11.58Z",Dt="M20 2H4C2.9 2 2 2.9 2 4V20C2 21.11 2.9 22 4 22H20C21.11 22 22 21.11 22 20V4C22 2.9 21.11 2 20 2M4 6L6 4H10.9L4 10.9V6M4 13.7L13.7 4H18.6L4 18.6V13.7M20 18L18 20H13.1L20 13.1V18M20 10.3L10.3 20H5.4L20 5.4V10.3Z",Kt="M15,12C15,10.7 14.16,9.6 13,9.18V6.82C14.16,6.4 15,5.3 15,4A3,3 0 0,0 12,1A3,3 0 0,0 9,4C9,5.3 9.84,6.4 11,6.82V9.19C9.84,9.6 9,10.7 9,12C9,13.3 9.84,14.4 11,14.82V17.18C9.84,17.6 9,18.7 9,20A3,3 0 0,0 12,23A3,3 0 0,0 15,20C15,18.7 14.16,17.6 13,17.18V14.82C14.16,14.4 15,13.3 15,12M12,3A1,1 0 0,1 13,4A1,1 0 0,1 12,5A1,1 0 0,1 11,4A1,1 0 0,1 12,3M12,21A1,1 0 0,1 11,20A1,1 0 0,1 12,19A1,1 0 0,1 13,20A1,1 0 0,1 12,21Z";class Yt extends((0,W.E)(n.WF)){get _availableAssistants(){return(0,J.V)(this.cloudStatus,this.hass)}hassSubscribe(){return[(0,S.Ar)(this.hass.connection,"script",t=>{this._categories=t}),(0,E.o5)(this.hass.connection,t=>{this._labels=t})]}render(){var t,i,e,s,a,o,r,l;const d=this._sizeController.value&&this._sizeController.value<900||!this._sizeController.value&&"docked"===this.hass.dockedSidebar,h=d&&(!this._sizeController.value||this._sizeController.value<700),c=this._scripts(this.scripts,this._entityReg,this.hass.areas,this._categories,this._labels,this._filteredScripts);return(0,n.qy)(it||(it=qt` <hass-tabs-subpage-data-table .hass="${0}" .narrow="${0}" back-path="/config" .route="${0}" .tabs="${0}" .searchLabel="${0}" has-filters .initialGroupColumn="${0}" .initialCollapsedGroups="${0}" .initialSorting="${0}" .columnOrder="${0}" .hiddenColumns="${0}" @columns-changed="${0}" @sorting-changed="${0}" @grouping-changed="${0}" @collapsed-changed="${0}" selectable .selected="${0}" @selection-changed="${0}" .filters="${0}" .columns="${0}" .data="${0}" .empty="${0}" .activeFilters="${0}" id="entity_id" .noDataText="${0}" @clear-filter="${0}" .filter="${0}" @search-changed="${0}" has-fab clickable class="${0}" @row-click="${0}"> <ha-icon-button slot="toolbar-icon" .label="${0}" .path="${0}" @click="${0}"></ha-icon-button> <ha-filter-floor-areas .hass="${0}" .type="${0}" .value="${0}" @data-table-filter-changed="${0}" slot="filter-pane" .expanded="${0}" .narrow="${0}" @expanded-changed="${0}"></ha-filter-floor-areas> <ha-filter-devices .hass="${0}" .type="${0}" .value="${0}" @data-table-filter-changed="${0}" slot="filter-pane" .expanded="${0}" .narrow="${0}" @expanded-changed="${0}"></ha-filter-devices> <ha-filter-entities .hass="${0}" .type="${0}" .value="${0}" @data-table-filter-changed="${0}" slot="filter-pane" .expanded="${0}" .narrow="${0}" @expanded-changed="${0}"></ha-filter-entities> <ha-filter-labels .hass="${0}" .value="${0}" @data-table-filter-changed="${0}" slot="filter-pane" .expanded="${0}" .narrow="${0}" @expanded-changed="${0}"></ha-filter-labels> <ha-filter-categories .hass="${0}" scope="script" .value="${0}" @data-table-filter-changed="${0}" slot="filter-pane" .expanded="${0}" .narrow="${0}" @expanded-changed="${0}"></ha-filter-categories> <ha-filter-voice-assistants .hass="${0}" .value="${0}" @data-table-filter-changed="${0}" slot="filter-pane" .expanded="${0}" .narrow="${0}" @expanded-changed="${0}"></ha-filter-voice-assistants> <ha-filter-blueprints .hass="${0}" .type="${0}" .value="${0}" @data-table-filter-changed="${0}" slot="filter-pane" .expanded="${0}" .narrow="${0}" @expanded-changed="${0}"></ha-filter-blueprints> ${0} ${0} ${0} <ha-fab slot="fab" ?is-wide="${0}" ?narrow="${0}" .label="${0}" extended @click="${0}"> <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> </ha-fab> </hass-tabs-subpage-data-table> `),this.hass,this.narrow,this.route,G.configSections.automations,this.hass.localize("ui.panel.config.script.picker.search",{number:c.length}),null!==(t=this._activeGrouping)&&void 0!==t?t:"category",this._activeCollapsed,this._activeSorting,this._activeColumnOrder,this._activeHiddenColumns,this._handleColumnsChanged,this._handleSortingChanged,this._handleGroupingChanged,this._handleCollapseChanged,this._selected.length,this._handleSelectionChanged,Object.values(this._filters).filter(t=>Array.isArray(t.value)?t.value.length:t.value&&Object.values(t.value).some(t=>Array.isArray(t)?t.length:t)).length,this._columns(this.hass.localize,c),c,!this.scripts.length,this._activeFilters,this.hass.localize("ui.panel.config.script.picker.no_scripts"),this._clearFilter,this._filter,this._handleSearchChange,this.narrow?"narrow":"",this._handleRowClicked,this.hass.localize("ui.common.help"),Zt,this._showHelp,this.hass,"script",null===(i=this._filters["ha-filter-floor-areas"])||void 0===i?void 0:i.value,this._filterChanged,"ha-filter-floor-areas"===this._expandedFilter,this.narrow,this._filterExpanded,this.hass,"script",null===(e=this._filters["ha-filter-devices"])||void 0===e?void 0:e.value,this._filterChanged,"ha-filter-devices"===this._expandedFilter,this.narrow,this._filterExpanded,this.hass,"script",null===(s=this._filters["ha-filter-entities"])||void 0===s?void 0:s.value,this._filterChanged,"ha-filter-entities"===this._expandedFilter,this.narrow,this._filterExpanded,this.hass,null===(a=this._filters["ha-filter-labels"])||void 0===a?void 0:a.value,this._filterChanged,"ha-filter-labels"===this._expandedFilter,this.narrow,this._filterExpanded,this.hass,null===(o=this._filters["ha-filter-categories"])||void 0===o?void 0:o.value,this._filterChanged,"ha-filter-categories"===this._expandedFilter,this.narrow,this._filterExpanded,this.hass,null===(r=this._filters["ha-filter-voice-assistants"])||void 0===r?void 0:r.value,this._filterChanged,"ha-filter-voice-assistants"===this._expandedFilter,this.narrow,this._filterExpanded,this.hass,"script",null===(l=this._filters["ha-filter-blueprints"])||void 0===l?void 0:l.value,this._filterChanged,"ha-filter-blueprints"===this._expandedFilter,this.narrow,this._filterExpanded,this.narrow?n.s6:(0,n.qy)(et||(et=qt`<ha-dropdown slot="selection-bar" @wa-select="${0}"> <ha-assist-chip slot="trigger" .label="${0}"> <ha-svg-icon slot="trailing-icon" .path="${0}"></ha-svg-icon> </ha-assist-chip> ${0} </ha-dropdown> ${0} ${0}`),this._handleBulkCategory,this.hass.localize("ui.panel.config.automation.picker.bulk_actions.move_category"),jt,this._renderCategoryItems(),h?n.s6:(0,n.qy)(st||(st=qt`<ha-dropdown slot="selection-bar" @wa-select="${0}"> <ha-assist-chip slot="trigger" .label="${0}"> <ha-svg-icon slot="trailing-icon" .path="${0}"></ha-svg-icon> </ha-assist-chip> ${0} </ha-dropdown>`),this._handleBulkLabel,this.hass.localize("ui.panel.config.automation.picker.bulk_actions.add_label"),jt,this._renderLabelItems()),d?n.s6:(0,n.qy)(at||(at=qt`<ha-dropdown slot="selection-bar" @wa-select="${0}"> <ha-assist-chip slot="trigger" .label="${0}"> <ha-svg-icon slot="trailing-icon" .path="${0}"></ha-svg-icon> </ha-assist-chip> ${0} </ha-dropdown>`),this._handleBulkArea,this.hass.localize("ui.panel.config.devices.picker.bulk_actions.move_area"),jt,this._renderAreaItems())),this.narrow||d?(0,n.qy)(ot||(ot=qt` <ha-dropdown slot="selection-bar" @wa-select="${0}"> ${0} ${0} ${0} ${0} </ha-dropdown>`),this._handleBulkAction,this.narrow?(0,n.qy)(rt||(rt=qt`<ha-assist-chip .label="${0}" slot="trigger"> <ha-svg-icon slot="trailing-icon" .path="${0}"></ha-svg-icon> </ha-assist-chip>`),this.hass.localize("ui.panel.config.automation.picker.bulk_action"),jt):(0,n.qy)(nt||(nt=qt`<ha-icon-button .path="${0}" .label="${0}" slot="trigger"></ha-icon-button>`),Ot,this.hass.localize("ui.panel.config.automation.picker.bulk_action")),this.narrow?(0,n.qy)(lt||(lt=qt`<ha-dropdown-item> ${0} ${0} </ha-dropdown-item>`),this.hass.localize("ui.panel.config.automation.picker.bulk_actions.move_category"),this._renderCategoryItems("submenu")):n.s6,this.narrow||h?(0,n.qy)(dt||(dt=qt`<ha-dropdown-item> ${0} ${0} </ha-dropdown-item>`),this.hass.localize("ui.panel.config.automation.picker.bulk_actions.add_label"),this._renderLabelItems("submenu")):n.s6,this.narrow||d?(0,n.qy)(ht||(ht=qt`<ha-dropdown-item> ${0} ${0} </ha-dropdown-item>`),this.hass.localize("ui.panel.config.devices.picker.bulk_actions.move_area"),this._renderAreaItems("submenu")):n.s6):n.s6,this.scripts.length?n.s6:(0,n.qy)(ct||(ct=qt` <div class="empty" slot="empty"> <ha-svg-icon .path="${0}"></ha-svg-icon> <h1> ${0} </h1> <p> ${0} </p> <ha-button appearance="plain" href="${0}" target="_blank" rel="noreferrer" size="small"> ${0} <ha-svg-icon slot="end" .path="${0}"></ha-svg-icon> </ha-button> </div>`),Bt,this.hass.localize("ui.panel.config.script.picker.empty_header"),this.hass.localize("ui.panel.config.script.picker.empty_text"),(0,B.o)(this.hass,"/docs/script/editor/"),this.hass.localize("ui.panel.config.common.learn_more"),Ft),this.isWide,this.narrow,this.hass.localize("ui.panel.config.script.picker.add_script"),this._createNew,Ut)}_handleSearchChange(t){this._filter=t.detail.value}_filterExpanded(t){t.detail.expanded?this._expandedFilter=t.target.localName:this._expandedFilter===t.target.localName&&(this._expandedFilter=void 0)}_filterChanged(t){const i=t.target.localName;this._filters=Object.assign(Object.assign({},this._filters),{},{[i]:t.detail}),this._applyFilters()}_clearFilter(){this._filters={},this._applyFilters()}_applyFilters(){const t=Object.entries(this._filters);let i;for(const[e,s]of t){if(s.items){if(!i){i=s.items;continue}i="intersection"in i?i.intersection(s.items):new Set([...i].filter(t=>s.items.has(t)))}if("ha-filter-categories"===e&&Array.isArray(s.value)&&s.value.length){const t=new Set;if(this.scripts.filter(t=>{var i;return s.value[0]===(null===(i=this._entityReg.find(i=>i.entity_id===t.entity_id))||void 0===i?void 0:i.categories.script)}).forEach(i=>t.add(i.entity_id)),!i){i=t;continue}i="intersection"in i?i.intersection(t):new Set([...i].filter(i=>t.has(i)))}else if("ha-filter-labels"===e&&Array.isArray(s.value)&&s.value.length){const t=new Set;if(this.scripts.filter(t=>{var i;return null===(i=this._entityReg.find(i=>i.entity_id===t.entity_id))||void 0===i?void 0:i.labels.some(t=>s.value.includes(t))}).forEach(i=>t.add(i.entity_id)),!i){i=t;continue}i="intersection"in i?i.intersection(t):new Set([...i].filter(i=>t.has(i)))}else if("ha-filter-voice-assistants"===e&&Array.isArray(s.value)&&s.value.length){const t=new Set;if(this.scripts.filter(t=>(0,I.hB)(this._entityReg,t.entity_id).some(t=>s.value.includes(t))).forEach(i=>t.add(i.entity_id)),!i){i=t;continue}i="intersection"in i?i.intersection(t):new Set([...i].filter(i=>t.has(i)))}}this._filteredScripts=i?[...i]:void 0}updated(t){super.updated(t),t.has("_entityReg")&&this._applyFilters()}firstUpdated(){this._searchParms.has("blueprint")&&this._filterBlueprint(),this._searchParms.has("label")&&this._filterLabel()}_filterLabel(){const t=this._searchParms.get("label");t&&(this._filters=Object.assign(Object.assign({},this._filters),{},{"ha-filter-labels":{value:[t],items:void 0}}),this._applyFilters())}async _filterBlueprint(){const t=this._searchParms.get("blueprint");if(!t)return;const i=await(0,Z.f)(this.hass,"script_blueprint",t);this._filters=Object.assign(Object.assign({},this._filters),{},{"ha-filter-blueprints":{value:[t],items:new Set(i.automation||[])}}),this._applyFilters()}_editCategory(t){const i=this._entityReg.find(i=>i.entity_id===t.entity_id);i?(0,Y.j)(this,{scope:"script",entityReg:i}):(0,P.showAlertDialog)(this,{title:this.hass.localize("ui.panel.config.script.picker.no_category_support"),text:this.hass.localize("ui.panel.config.script.picker.no_category_entity_reg")})}_handleSelectionChanged(t){this._selected=t.detail.value}async _bulkAddCategory(t){const i=[];this._selected.forEach(e=>{i.push((0,R.G_)(this.hass,e,{categories:{script:t}}))});const e=await Promise.allSettled(i);if((0,m.$)(e)){const t=(0,m.N)(e);(0,P.showAlertDialog)(this,{title:this.hass.localize("ui.panel.config.common.multiselect.failed",{number:t.length}),text:(0,n.qy)(pt||(pt=qt`<pre>
${0}</pre>`),t.map(t=>t.reason.message||t.reason.code||t.reason).join("\r\n"))})}}async _bulkLabel(t,i){const e=[];this._selected.forEach(s=>{e.push((0,R.G_)(this.hass,s,{labels:"add"===i?this.hass.entities[s].labels.concat(t):this.hass.entities[s].labels.filter(i=>i!==t)}))});const s=await Promise.allSettled(e);if((0,m.$)(s)){const t=(0,m.N)(s);(0,P.showAlertDialog)(this,{title:this.hass.localize("ui.panel.config.common.multiselect.failed",{number:t.length}),text:(0,n.qy)(ut||(ut=qt`<pre>
${0}</pre>`),t.map(t=>t.reason.message||t.reason.code||t.reason).join("\r\n"))})}}_handleRowClicked(t){const i=this.entityRegistry.find(i=>i.entity_id===t.detail.id);i?(0,v.o)(`/config/script/edit/${i.unique_id}`):(0,v.o)(`/config/script/show/${t.detail.id}`)}_createNew(){(0,p.x)(this.hass,"blueprint")?(0,K.l)(this,{mode:"script"}):(0,v.o)("/config/script/edit/new")}_showInfo(t){(0,f.r)(this,"hass-more-info",{entityId:t.entity_id})}_openSettings(t){(0,j.p)(this,{entityId:t.entity_id,view:"settings"})}_showTrace(t){const i=this.entityRegistry.find(i=>i.entity_id===t.entity_id);i&&(0,v.o)(`/config/script/trace/${i.unique_id}`)}_showHelp(){(0,P.showAlertDialog)(this,{title:this.hass.localize("ui.panel.config.script.caption"),text:(0,n.qy)(gt||(gt=qt` ${0} <p> <a href="${0}" target="_blank" rel="noreferrer"> ${0} </a> </p> `),this.hass.localize("ui.panel.config.script.picker.introduction"),(0,B.o)(this.hass,"/docs/scripts/"),this.hass.localize("ui.panel.config.script.picker.learn_more"))})}async _duplicate(t){try{const i=this.entityRegistry.find(i=>i.entity_id===t.entity_id);if(!i)return;const e=await(0,O.Kq)(this.hass,i.unique_id);(0,O.AM)(Object.assign(Object.assign({},e),{},{alias:`${null==e?void 0:e.alias} (${this.hass.localize("ui.panel.config.script.picker.duplicate")})`}))}catch(i){if(404===i.status_code){const i=await(0,O.R$)(this.hass,t.entity_id);return void(0,O.AM)(i.config)}await(0,P.showAlertDialog)(this,{text:this.hass.localize("ui.panel.config.script.editor.load_error_unknown",{err_no:i.status_code})})}}async _deleteConfirm(t){(0,P.dk)(this,{title:this.hass.localize("ui.panel.config.script.editor.delete_confirm_title"),text:this.hass.localize("ui.panel.config.script.editor.delete_confirm_text",{name:t.name}),confirmText:this.hass.localize("ui.common.delete"),dismissText:this.hass.localize("ui.common.cancel"),confirm:()=>this._delete(t),destructive:!0})}async _delete(t){try{const i=this.entityRegistry.find(i=>i.entity_id===t.entity_id);i&&(await(0,O.Ht)(this.hass,i.unique_id),this._selected=this._selected.filter(i=>i!==t.entity_id))}catch(i){await(0,P.showAlertDialog)(this,{text:400===i.status_code?this.hass.localize("ui.panel.config.script.editor.load_error_not_deletable"):this.hass.localize("ui.panel.config.script.editor.load_error_unknown",{err_no:i.status_code})})}}async _bulkAddArea(t){const i=[];this._selected.forEach(e=>{i.push((0,R.G_)(this.hass,e,{area_id:t}))});const e=await Promise.allSettled(i);if((0,m.$)(e)){const t=(0,m.N)(e);(0,P.showAlertDialog)(this,{title:this.hass.localize("ui.panel.config.common.multiselect.failed",{number:t.length}),text:(0,n.qy)(_t||(_t=qt`<pre>
${0}</pre>`),t.map(t=>t.reason.message||t.reason.code||t.reason).join("\r\n"))})}}_handleSortingChanged(t){this._activeSorting=t.detail}_handleGroupingChanged(t){var i;this._activeGrouping=null!==(i=t.detail.value)&&void 0!==i?i:""}_handleCollapseChanged(t){this._activeCollapsed=t.detail.value}_handleColumnsChanged(t){this._activeColumnOrder=t.detail.columnOrder,this._activeHiddenColumns=t.detail.hiddenColumns}static get styles(){return[U.RF,(0,n.AH)(ft||(ft=qt`:host{display:block;height:100%}hass-tabs-subpage-data-table{--data-table-row-height:60px}hass-tabs-subpage-data-table.narrow{--data-table-row-height:72px}a{text-decoration:none}.empty{--mdc-icon-size:80px;max-width:500px}.empty ha-button{--mdc-icon-size:24px}.empty h1{font-size:var(--ha-font-size-3xl)}ha-assist-chip{--ha-assist-chip-container-shape:10px}ha-dropdown ha-assist-chip{--md-assist-chip-trailing-space:8px}ha-label{--ha-label-background-color:var(--color, var(--grey-color));--ha-label-background-opacity:0.5}`))]}constructor(...t){super(...t),this.isWide=!1,this.narrow=!1,this._searchParms=new URLSearchParams(window.location.search),this._selected=[],this._filter="",this._filters={},this._sizeController=new a.P(this,{callback:t=>{var i;return null===(i=t[0])||void 0===i?void 0:i.contentRect.width}}),this._scripts=(0,h.A)((t,i,e,s,a,o)=>null===o?[]:(o?t.filter(t=>o.includes(t.entity_id)):t).map(t=>{var o,r;const n=i.find(i=>i.entity_id===t.entity_id),l=null==n?void 0:n.categories.script,d=a&&(null==n?void 0:n.labels),h=(0,I.hB)(i,t.entity_id);return Object.assign(Object.assign({},t),{},{name:(0,y.u)(t),area:null!=n&&n.area_id?null===(o=e[null==n?void 0:n.area_id])||void 0===o?void 0:o.name:void 0,last_triggered:t.attributes.last_triggered||void 0,category:l?null==s||null===(r=s.find(t=>t.category_id===l))||void 0===r?void 0:r.name:void 0,labels:(d||[]).map(t=>a.find(i=>i.label_id===t)),assistants:h,assistants_sortable_key:(0,Q.HX)(h),selectable:void 0!==n})})),this._columns=(0,h.A)((t,i)=>({icon:{title:"",showNarrow:!0,moveable:!1,label:t("ui.panel.config.script.picker.headers.icon"),type:"icon",template:t=>(0,n.qy)(yt||(yt=qt`<ha-state-icon .hass="${0}" .stateObj="${0}" style="${0}"></ha-state-icon>`),this.hass,t,(0,d.W)({color:t.state===q.Hh?"var(--error-color)":"unset"}))},name:{title:t("ui.panel.config.script.picker.headers.name"),main:!0,sortable:!0,filterable:!0,direction:"asc",flex:2,extraTemplate:t=>t.labels.length?(0,n.qy)(vt||(vt=qt`<ha-data-table-labels @label-clicked="${0}" .labels="${0}"></ha-data-table-labels>`),this._labelClicked,t.labels):n.s6},area:{title:t("ui.panel.config.script.picker.headers.area"),groupable:!0,filterable:!0,sortable:!0},category:{title:t("ui.panel.config.script.picker.headers.category"),defaultHidden:!0,groupable:!0,filterable:!0,sortable:!0},labels:{title:"",hidden:!0,filterable:!0,template:t=>t.labels.map(t=>t.name).join(" ")},last_triggered:{sortable:!0,title:t("ui.card.automation.last_triggered"),template:t=>{if(!t.last_triggered)return this.hass.localize("ui.components.relative_time.never");const i=new Date(t.last_triggered),e=new Date,s=(0,r.c)(e,i),a=(0,u.CL)(i,this.hass.locale,this.hass.config),o="last-triggered-"+(0,b.Y)(t.entity_id);return(0,n.qy)(bt||(bt=qt` ${0} `),s>3?a:(0,n.qy)(mt||(mt=qt` <ha-tooltip for="${0}">${0}</ha-tooltip> <span id="${0}">${0}</span> `),o,a,o,(0,g.K)(i,this.hass.locale)))}},actions:{title:"",label:this.hass.localize("ui.panel.config.generic.headers.actions"),type:"overflow-menu",showNarrow:!0,moveable:!1,hideable:!1,template:t=>(0,n.qy)(Ct||(Ct=qt` <ha-icon-overflow-menu .hass="${0}" narrow .items="${0}"> </ha-icon-overflow-menu> `),this.hass,[{path:Pt,label:this.hass.localize("ui.panel.config.script.picker.show_info"),action:()=>this._showInfo(t)},{path:Rt,label:this.hass.localize("ui.panel.config.automation.picker.show_settings"),action:()=>this._openSettings(t)},{path:Tt,label:this.hass.localize("ui.panel.config.script.picker."+(t.category?"edit_category":"assign_category")),action:()=>this._editCategory(t)},{path:Wt,label:this.hass.localize("ui.panel.config.script.picker.run"),action:()=>this._runScript(t)},{path:Kt,label:this.hass.localize("ui.panel.config.script.picker.show_trace"),action:()=>this._showTrace(t)},{divider:!0},{path:It,label:this.hass.localize("ui.panel.config.script.picker.duplicate"),action:()=>this._duplicate(t)},{label:this.hass.localize("ui.panel.config.script.picker.delete"),path:Et,action:()=>this._deleteConfirm(t),warning:!0}])},assistants:(0,Q.MD)(t,this.hass,this._availableAssistants,i)})),this._labelClicked=t=>{const i=t.detail.label;this._filters=Object.assign(Object.assign({},this._filters),{},{"ha-filter-labels":{value:[i.label_id],items:void 0}}),this._applyFilters()},this._handleBulkCategory=t=>{const i=t.detail.item.value;"category_create"!==i?"category_none"!==i?null!=i&&i.startsWith("category_")&&this._bulkAddCategory(i.substring(9)):this._bulkAddCategory(null):this._bulkCreateCategory()},this._handleBulkLabel=t=>{t.preventDefault();const i=t.detail.item.value;if("label_create"!==i){if(null!=i&&i.startsWith("label_")){const e=t.detail.item.action;this._bulkLabel(i.substring(6),e)}}else this._bulkCreateLabel()},this._runScript=async t=>{const i=this.entityRegistry.find(i=>i.entity_id===t.entity_id);i&&((0,O.TP)(this.hass,i.unique_id)?this._showInfo(t):(await(0,O.kR)(this.hass,i.unique_id),(0,T.P)(this,{message:this.hass.localize("ui.notification_toast.triggered",{name:(0,y.u)(t)})})))},this._bulkCreateCategory=()=>{(0,N.S)(this,{scope:"script",createEntry:async t=>{const i=await(0,S.s_)(this.hass,"script",t);return this._bulkAddCategory(i.category_id),i}})},this._bulkCreateLabel=()=>{(0,X.f)(this,{createEntry:async t=>{const i=await(0,E._9)(this.hass,t);this._bulkLabel(i.label_id,"add")}})},this._handleBulkArea=t=>{const i=t.detail.item.value;"area_create"!==i?"area_none"!==i?null!=i&&i.startsWith("area_")&&this._bulkAddArea(i.substring(5)):this._bulkAddArea(null):this._bulkCreateArea()},this._bulkCreateArea=()=>{(0,D.J)(this,{createEntry:async t=>{const i=await(0,V.L3)(this.hass,t);return this._bulkAddArea(i.area_id),i}})},this._renderCategoryItems=(t="")=>{var i;return(0,n.qy)(wt||(wt=qt`${0} <ha-dropdown-item .slot="${0}" value="category_none"> ${0} </ha-dropdown-item> <wa-divider .slot="${0}"></wa-divider> <ha-dropdown-item .slot="${0}" value="category_create"> ${0} </ha-dropdown-item>`),null===(i=this._categories)||void 0===i?void 0:i.map(i=>(0,n.qy)($t||($t=qt`<ha-dropdown-item .slot="${0}" .value="${0}"> ${0} ${0} </ha-dropdown-item>`),t,`category_${i.category_id}`,i.icon?(0,n.qy)(At||(At=qt`<ha-icon slot="icon" .icon="${0}"></ha-icon>`),i.icon):(0,n.qy)(kt||(kt=qt`<ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon>`),Tt),i.name)),t,this.hass.localize("ui.panel.config.automation.picker.bulk_actions.no_category"),t,t,this.hass.localize("ui.panel.config.category.editor.add"))},this._renderLabelItems=(t="")=>{var i;return(0,n.qy)(Ht||(Ht=qt`${0} <wa-divider .slot="${0}"></wa-divider> <ha-dropdown-item .slot="${0}" value="label_create"> ${0} </ha-dropdown-item>`),null===(i=this._labels)||void 0===i?void 0:i.map(i=>{const e=i.color?(0,c.MP)(i.color):void 0,s=this._selected.every(t=>{var e;return null===(e=this.hass.entities[t])||void 0===e?void 0:e.labels.includes(i.label_id)}),a=!s&&this._selected.some(t=>{var e;return null===(e=this.hass.entities[t])||void 0===e?void 0:e.labels.includes(i.label_id)});return(0,n.qy)(xt||(xt=qt`<ha-dropdown-item .slot="${0}" .value="${0}" .action="${0}"> <ha-checkbox slot="icon" .checked="${0}" .indeterminate="${0}" reducedTouchTarget></ha-checkbox> <ha-label style="${0}" .description="${0}"> ${0} ${0} </ha-label> </ha-dropdown-item>`),t,`label_${i.label_id}`,s?"remove":"add",s,a,e?`--color: ${e}`:"",i.description,i.icon?(0,n.qy)(Mt||(Mt=qt`<ha-icon slot="icon" .icon="${0}"></ha-icon>`),i.icon):n.s6,i.name)}),t,t,this.hass.localize("ui.panel.config.labels.add_label"))},this._renderAreaItems=(t="")=>(0,n.qy)(Vt||(Vt=qt`${0} <ha-dropdown-item .slot="${0}" value="area_none"> ${0} </ha-dropdown-item> <wa-divider .slot="${0}"></wa-divider> <ha-dropdown-item .slot="${0}" value="area_create"> ${0} </ha-dropdown-item>`),Object.values(this.hass.areas).map(i=>(0,n.qy)(St||(St=qt`<ha-dropdown-item .slot="${0}" .value="${0}"> ${0} ${0} </ha-dropdown-item>`),t,`area_${i.area_id}`,i.icon?(0,n.qy)(zt||(zt=qt`<ha-icon slot="icon" .icon="${0}"></ha-icon>`),i.icon):(0,n.qy)(Lt||(Lt=qt`<ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon>`),Dt),i.name)),t,this.hass.localize("ui.panel.config.devices.picker.bulk_actions.no_area"),t,t,this.hass.localize("ui.panel.config.devices.picker.bulk_actions.add_area")),this._handleBulkAction=t=>{const i=t.detail.item,e=i.value;if(e)if(e.startsWith("category_"))"category_create"===e?this._bulkCreateCategory():"category_none"===e?this._bulkAddCategory(null):this._bulkAddCategory(e.substring(9));else if(e.startsWith("label_"))if("label_create"===e)this._bulkCreateLabel();else{const t=i.action;this._bulkLabel(e.substring(6),t)}else e.startsWith("area_")&&("area_create"===e?this._bulkCreateArea():"area_none"===e?this._bulkAddArea(null):this._bulkAddArea(e.substring(5)))}}}(0,s.Cg)([(0,l.MZ)({attribute:!1})],Yt.prototype,"hass",void 0),(0,s.Cg)([(0,l.MZ)({attribute:!1})],Yt.prototype,"scripts",void 0),(0,s.Cg)([(0,l.MZ)({attribute:"is-wide",type:Boolean})],Yt.prototype,"isWide",void 0),(0,s.Cg)([(0,l.MZ)({type:Boolean})],Yt.prototype,"narrow",void 0),(0,s.Cg)([(0,l.MZ)({attribute:!1})],Yt.prototype,"route",void 0),(0,s.Cg)([(0,l.MZ)({attribute:!1})],Yt.prototype,"cloudStatus",void 0),(0,s.Cg)([(0,l.MZ)({attribute:!1})],Yt.prototype,"entityRegistry",void 0),(0,s.Cg)([(0,l.wk)()],Yt.prototype,"_searchParms",void 0),(0,s.Cg)([(0,l.wk)()],Yt.prototype,"_selected",void 0),(0,s.Cg)([(0,l.wk)()],Yt.prototype,"_activeFilters",void 0),(0,s.Cg)([(0,l.wk)()],Yt.prototype,"_filteredScripts",void 0),(0,s.Cg)([(0,l.wk)(),(0,_.I)({storage:"sessionStorage",key:"script-table-search",state:!0,subscribe:!1})],Yt.prototype,"_filter",void 0),(0,s.Cg)([(0,l.wk)(),(0,_.I)({storage:"sessionStorage",key:"script-table-filters-full",state:!0,subscribe:!1,serializer:L.iS,deserializer:L.Dc})],Yt.prototype,"_filters",void 0),(0,s.Cg)([(0,l.wk)()],Yt.prototype,"_expandedFilter",void 0),(0,s.Cg)([(0,l.wk)()],Yt.prototype,"_categories",void 0),(0,s.Cg)([(0,l.wk)()],Yt.prototype,"_labels",void 0),(0,s.Cg)([(0,l.wk)(),(0,o.Fg)({context:z.ih,subscribe:!0})],Yt.prototype,"_entityReg",void 0),(0,s.Cg)([(0,_.I)({key:"script-table-sort",state:!1,subscribe:!1})],Yt.prototype,"_activeSorting",void 0),(0,s.Cg)([(0,_.I)({key:"script-table-grouping",state:!1,subscribe:!1})],Yt.prototype,"_activeGrouping",void 0),(0,s.Cg)([(0,_.I)({key:"script-table-collapsed",state:!1,subscribe:!1})],Yt.prototype,"_activeCollapsed",void 0),(0,s.Cg)([(0,_.I)({key:"script-table-column-order",state:!1,subscribe:!1})],Yt.prototype,"_activeColumnOrder",void 0),(0,s.Cg)([(0,_.I)({key:"script-table-hidden-columns",state:!1,subscribe:!1})],Yt.prototype,"_activeHiddenColumns",void 0),Yt=(0,s.Cg)([(0,l.EM)("ha-script-picker")],Yt),i()}catch(it){i(it)}})},84042:function(t,i,e){e.a(t,async function(t,i){try{e(89463),e(74423),e(18111),e(22489),e(7588),e(3362),e(62953);var s=e(40445),a=e(16527),o=e(53289),r=e(96196),n=e(77845),l=e(94333),d=e(63533),h=e(44537),c=e(93905),p=e(68348),u=e(1087),g=e(51758),_=e(6030),f=(e(26300),e(3587),e(77423)),y=e(38911),v=e(84025),b=e(54706),m=e(36918),C=e(81619),w=e(68469),$=e(89552),A=e(78614),k=e(84047),H=e(57116),x=e(95415),M=t([w,$,x,A]);[w,$,x,A]=M.then?(await M)():M;let V,S,z,L,q,R=t=>t;const I="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z",E="M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.67 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z",O=(0,d.Ik)({alias:(0,d.lq)((0,d.Yj)()),description:(0,d.lq)((0,d.Yj)()),sequence:(0,d.lq)((0,d.YO)((0,d.bz)())),icon:(0,d.lq)((0,d.Yj)()),mode:(0,d.lq)((0,d.vP)([typeof v.FN])),max:(0,d.lq)((0,d.ai)()),fields:(0,d.lq)((0,d.Ik)())});class Z extends((0,b.E)(r.WF)){addFields(){this._openFields=!0,(0,u.r)(this,"value-changed",{value:Object.assign(Object.assign({},this.config),{},{fields:{[this.hass.localize("ui.panel.config.script.editor.field.field")||"field"]:{selector:{text:null}}}})})}hassSubscribe(){return[(0,f.Pd)(this.hass,t=>{this._configEntries.setValue(t)})]}updated(t){var i;this._openFields&&t.has("config")&&(this._openFields=!1,null===(i=this._scriptFields)||void 0===i||i.updateComplete.then(()=>{var t;return null===(t=this._scriptFields)||void 0===t?void 0:t.focusLastField()}))}_renderContent(){var t,i;return(0,r.qy)(V||(V=R` ${0} ${0} <div class="header"> <h2 id="sequence-heading" class="name"> ${0} </h2> <a href="${0}" target="_blank" rel="noreferrer"> <ha-icon-button .path="${0}" .label="${0}"></ha-icon-button> </a> </div> <ha-automation-action role="region" aria-labelledby="sequence-heading" .actions="${0}" .highlightedActions="${0}" @value-changed="${0}" @open-sidebar="${0}" @request-close-sidebar="${0}" @close-sidebar="${0}" .hass="${0}" .narrow="${0}" .disabled="${0}" root sidebar></ha-automation-action> `),this.config.description?(0,r.qy)(S||(S=R`<ha-markdown class="description" breaks .content="${0}"></ha-markdown>`),this.config.description):r.s6,this.config.fields?(0,r.qy)(z||(z=R`<div class="header"> <h2 id="fields-heading" class="name"> ${0} </h2> <a href="${0}" target="_blank" rel="noreferrer"> <ha-icon-button .path="${0}" .label="${0}"></ha-icon-button> </a> </div> <ha-script-fields role="region" aria-labelledby="fields-heading" .fields="${0}" .highlightedFields="${0}" @value-changed="${0}" .hass="${0}" .disabled="${0}" .narrow="${0}" @open-sidebar="${0}" @request-close-sidebar="${0}" @close-sidebar="${0}"></ha-script-fields>`),this.hass.localize("ui.panel.config.script.editor.field.fields"),(0,m.o)(this.hass,"/integrations/script/#fields"),E,this.hass.localize("ui.panel.config.script.editor.field.link_help_fields"),this.config.fields,null===(t=this._pastedConfig)||void 0===t?void 0:t.fields,this._fieldsChanged,this.hass,this.disabled,this.narrow,this._openSidebar,this.triggerCloseSidebar,this._handleCloseSidebar):r.s6,this.hass.localize("ui.panel.config.script.editor.sequence"),(0,m.o)(this.hass,"/docs/scripts/"),E,this.hass.localize("ui.panel.config.script.editor.link_available_actions"),this.config.sequence||[],null===(i=this._pastedConfig)||void 0===i?void 0:i.sequence,this._sequenceChanged,this._openSidebar,this.triggerCloseSidebar,this._handleCloseSidebar,this.hass,this.narrow,this.disabled||this.saving)}render(){return(0,r.qy)(L||(L=R` <div class="${0}"> <div class="content-wrapper"> <div class="content ${0}"> <slot name="alerts"></slot> ${0} </div> <div class="fab-positioner"> <div class="fab-positioner"> <ha-fab slot="fab" class="${0}" .label="${0}" .disabled="${0}" extended @click="${0}"> <ha-svg-icon slot="icon" .path="${0}"></ha-svg-icon> </ha-fab> </div> </div> </div> <div class="sidebar-positioner"> <ha-automation-sidebar .sidebarKey="${0}" tabindex="-1" class="${0}" .narrow="${0}" .isWide="${0}" .hass="${0}" .config="${0}" .disabled="${0}" @value-changed="${0}" @sidebar-resized="${0}" @sidebar-resizing-stopped="${0}" @sidebar-reset-size="${0}"></ha-automation-sidebar> </div> </div> `),(0,l.H)({"has-sidebar":this._sidebarConfig&&!this.narrow}),this._sidebarConfig&&this.narrow?"has-bottom-sheet":"",this._renderContent(),this.dirty?"dirty":"",this.hass.localize("ui.common.save"),this.saving,this._saveScript,I,this._sidebarKey,(0,l.H)({hidden:!this._sidebarConfig}),this.narrow,this.isWide,this.hass,this._sidebarConfig,this.disabled,this._sidebarConfigChanged,this._resizeSidebar,this._stopResizeSidebar,this._resetSidebarWidth)}firstUpdated(t){super.firstUpdated(t),this.style.setProperty("--sidebar-dynamic-width",`${this._sidebarWidthPx}px`);"1"===(0,_.p9)("expanded")&&(this._clearParam("expanded"),this.expandAll())}_clearParam(t){window.history.replaceState(null,"",(0,g.Z)((0,_.s8)(t)))}_fieldsChanged(t){t.stopPropagation(),this.resetPastedConfig(),(0,u.r)(this,"value-changed",{value:Object.assign(Object.assign({},this.config),{},{fields:t.detail.value})})}_sequenceChanged(t){t.stopPropagation(),this.resetPastedConfig(),(0,u.r)(this,"value-changed",{value:Object.assign(Object.assign({},this.config),{},{sequence:t.detail.value})})}connectedCallback(){super.connectedCallback(),window.addEventListener("paste",this._handlePaste)}disconnectedCallback(){window.removeEventListener("paste",this._handlePaste),super.disconnectedCallback()}_appendToExistingConfig(t){this._pastedConfig=t;const i=Object.assign({},this.config);i&&("fields"in t&&(i.fields=Object.assign(Object.assign({},i.fields),t.fields)),"sequence"in t&&(i.sequence=(0,h.e)(i.sequence||[]).concat((0,h.e)(t.sequence))),this._showPastedToastWithUndo(),(0,u.r)(this,"value-changed",{value:Object.assign({},i)}))}_replaceExistingConfig(t){this._pastedConfig=t,this._showPastedToastWithUndo(),(0,u.r)(this,"value-changed",{value:Object.assign({},t)})}_showPastedToastWithUndo(){(0,C.P)(this,{message:this.hass.localize("ui.panel.config.script.editor.paste_toast_message"),duration:4e3,action:{text:this.hass.localize("ui.common.undo"),action:()=>{(0,u.r)(this,"undo-change"),this._pastedConfig=void 0}}})}resetPastedConfig(){this._pastedConfig=void 0,(0,C.P)(this,{message:"",duration:0})}async _openSidebar(t){var i,e,s,a;null===(i=this._sidebarConfig)||void 0===i||null===(e=i.close)||void 0===e||e.call(i),this._sidebarConfig=t.detail,this._sidebarKey++,await(null===(s=this._sidebarElement)||void 0===s?void 0:s.updateComplete),null===(a=this._sidebarElement)||void 0===a||a.focus()}_sidebarConfigChanged(t){t.stopPropagation(),this._sidebarConfig&&(this._sidebarConfig=Object.assign(Object.assign({},this._sidebarConfig),t.detail.value))}triggerCloseSidebar(){if(this._sidebarConfig){var t;if(this._sidebarElement)return void this._sidebarElement.triggerCloseSidebar();null===(t=this._sidebarConfig)||void 0===t||t.close(),this._sidebarKey=0}}_handleCloseSidebar(){this._sidebarConfig=void 0}_saveScript(){this.triggerCloseSidebar(),(0,u.r)(this,"save-script")}_tryInsertAfterSelected(t){return!(!this._sidebarConfig||!("insertAfter"in this._sidebarConfig))&&this._sidebarConfig.insertAfter(t)}expandAll(){var t;null===(t=this._collapsableElements)||void 0===t||t.forEach(t=>{t.expandAll()})}collapseAll(){var t;null===(t=this._collapsableElements)||void 0===t||t.forEach(t=>{t.collapseAll()})}copySelectedRow(){var t;null!==(t=this._sidebarConfig)&&void 0!==t&&t.copy&&this._sidebarConfig.copy()}cutSelectedRow(){var t;null!==(t=this._sidebarConfig)&&void 0!==t&&t.cut&&this._sidebarConfig.cut()}deleteSelectedRow(){var t;null!==(t=this._sidebarConfig)&&void 0!==t&&t.delete&&this._sidebarConfig.delete()}_resizeSidebar(t){t.stopPropagation();const i=t.detail.deltaInPx;var e;this._prevSidebarWidthPx||(this._prevSidebarWidthPx=(null===(e=this._sidebarElement)||void 0===e?void 0:e.clientWidth)||A.Q);const s=i+this._prevSidebarWidthPx;this._sidebarWidthPx=s,this.style.setProperty("--sidebar-dynamic-width",`${this._sidebarWidthPx}px`)}_stopResizeSidebar(t){t.stopPropagation(),this._prevSidebarWidthPx=void 0}_resetSidebarWidth(t){t.stopPropagation(),this._prevSidebarWidthPx=void 0,this._sidebarWidthPx=A.Q,this.style.setProperty("--sidebar-dynamic-width",`${this._sidebarWidthPx}px`)}static get styles(){return[H.T_,H.qK,(0,r.AH)(q||(q=R`.header{display:flex;align-items:center}.header:first-child{margin-top:-16px}.header .name{font-size:var(--ha-font-size-xl);font-weight:var(--ha-font-weight-normal);flex:1}.description{margin-top:16px}`))]}constructor(...t){super(...t),this.isWide=!1,this.narrow=!1,this.disabled=!1,this.saving=!1,this.dirty=!1,this._sidebarKey=0,this._sidebarWidthPx=A.Q,this._configEntries=new a.DT(this,{context:y.g5,initialValue:[]}),this._openFields=!1,this._handlePaste=async t=>{var i;if(!(0,p.u)(t.composedPath()))return;const e=null===(i=t.clipboardData)||void 0===i?void 0:i.getData("text");if(!e)return;let s;try{s=(0,o.Hh)(e)}catch(c){return void(0,C.P)(this,{message:this.hass.localize("ui.panel.config.script.editor.paste_invalid_config"),duration:4e3,dismissable:!0})}if(!s||"object"!=typeof s)return;let a=s;"script"in a&&(a=a.script,Object.keys(a).length&&(a=a[Object.keys(a)[0]])),Array.isArray(a)&&(a=1===a.length?a[0]:{sequence:a});const r=(0,v.pq)(a);let n;(!["sequence","unknown"].includes(r)||"sequence"===r&&"metadata"in a)&&(a={sequence:[a]});try{n=(0,v.nB)(a)}catch(c){return}try{(0,d.vA)(n,O)}catch(c){return void(0,C.P)(this,{message:this.hass.localize("ui.panel.config.script.editor.paste_invalid_config"),duration:4e3,dismissable:!0})}if(n){var l;t.preventDefault();const i=Object.keys(n).filter(t=>(0,h.e)(n[t]).length);if(1===i.length&&["sequence"].includes(i[0])&&this._tryInsertAfterSelected(n[i[0]]))return void this._showPastedToastWithUndo();if(this.dirty||null!==(l=(0,h.e)(this.config.sequence))&&void 0!==l&&l.length||Object.keys(this.config.fields||{}).length){if(!(await new Promise(t=>{(0,k.Z)(this,{domain:"script",pastedConfig:n,onClose:()=>t(!1),onAppend:()=>{this._appendToExistingConfig(n),t(!1)},onReplace:()=>t(!0)})})))return}this._replaceExistingConfig(n)}}}}(0,s.Cg)([(0,n.MZ)({attribute:!1})],Z.prototype,"hass",void 0),(0,s.Cg)([(0,n.MZ)({attribute:"is-wide",type:Boolean})],Z.prototype,"isWide",void 0),(0,s.Cg)([(0,n.MZ)({type:Boolean})],Z.prototype,"narrow",void 0),(0,s.Cg)([(0,n.MZ)({type:Boolean})],Z.prototype,"disabled",void 0),(0,s.Cg)([(0,n.MZ)({type:Boolean})],Z.prototype,"saving",void 0),(0,s.Cg)([(0,n.MZ)({attribute:!1})],Z.prototype,"config",void 0),(0,s.Cg)([(0,n.MZ)({attribute:!1})],Z.prototype,"dirty",void 0),(0,s.Cg)([(0,n.wk)()],Z.prototype,"_pastedConfig",void 0),(0,s.Cg)([(0,n.wk)()],Z.prototype,"_sidebarConfig",void 0),(0,s.Cg)([(0,n.wk)()],Z.prototype,"_sidebarKey",void 0),(0,s.Cg)([(0,c.I)({key:"automation-sidebar-width",state:!1,subscribe:!1})],Z.prototype,"_sidebarWidthPx",void 0),(0,s.Cg)([(0,n.P)("ha-script-fields")],Z.prototype,"_scriptFields",void 0),(0,s.Cg)([(0,n.P)("ha-automation-sidebar")],Z.prototype,"_sidebarElement",void 0),(0,s.Cg)([(0,n.YG)("ha-automation-action, ha-script-fields")],Z.prototype,"_collapsableElements",void 0),Z=(0,s.Cg)([(0,n.EM)("manual-script-editor")],Z),i()}catch(V){i(V)}})}}]);
//# sourceMappingURL=8735.50b1ace02b499789.js.map