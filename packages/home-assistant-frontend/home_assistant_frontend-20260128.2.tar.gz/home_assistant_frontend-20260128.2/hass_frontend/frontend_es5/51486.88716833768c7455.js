"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["51486"],{90433:function(t,e,i){i.d(e,{Vy:function(){return h},fI:function(){return r},ux:function(){return n}});var a=i(22786),s=i(79468);const o=54;function h(t,e){const i=t%o+1;return e.getPropertyValue(`--color-${i}`)}function r(t,e){const i=e.getPropertyValue(`--graph-color-${t+1}`)||h(t,e);return(0,s.RQ)(i)}const n=(0,a.A)(t=>Array.from({length:o},(e,i)=>r(i,t)),(t,e)=>t[0].getPropertyValue("--graph-color-1")===e[0].getPropertyValue("--graph-color-1")&&t[0].getPropertyValue("--color-1")===e[0].getPropertyValue("--color-1"))},36525:function(t,e,i){i.a(t,async function(t,a){try{i.d(e,{n:function(){return T}});i(74423),i(44114),i(26910),i(18111),i(22489),i(7588),i(61701),i(3362),i(17642),i(58004),i(33853),i(45876),i(32475),i(15024),i(31698),i(62953);var s=i(40445),o=i(96196),h=i(77845),r=i(6415),n=i(22786),d=i(90433),l=i(36312),c=i(95747),p=i(20058),u=i(8549),m=i(15638),y=i(23528),g=i(44439),f=t([g,c,y,p]);[g,c,y,p]=f.then?(await f)():f;let _,x,v,b,D,M=t=>t;const T={mean:"mean",min:"min",max:"max",sum:"sum",state:"sum",change:"sum"};class S extends o.WF{shouldUpdate(t){return t.size>1||!t.has("hass")}willUpdate(t){(t.has("statisticsData")||t.has("statTypes")||t.has("chartType")||t.has("hideLegend")||t.has("_hiddenStats"))&&this._generateData(),(!this.hasUpdated||t.has("unit")||t.has("period")||t.has("chartType")||t.has("minYAxis")||t.has("maxYAxis")||t.has("fitYData")||t.has("logarithmicScale")||t.has("hideLegend")||t.has("startTime")||t.has("endTime")||t.has("_legendData")||t.has("_chartData"))&&this._createOptions()}firstUpdated(){this._computedStyle=getComputedStyle(this)}render(){return(0,l.x)(this.hass,"history")?this.isLoadingData&&!this.statisticsData?(0,o.qy)(x||(x=M`<div class="info"> ${0} </div>`),this.hass.localize("ui.components.statistics_charts.loading_statistics")):this.statisticsData&&Object.keys(this.statisticsData).length?(0,o.qy)(b||(b=M` <ha-chart-base .hass="${0}" .data="${0}" .options="${0}" .height="${0}" style="${0}" @dataset-hidden="${0}" @dataset-unhidden="${0}" .expandLegend="${0}"></ha-chart-base> `),this.hass,this._chartData,this._chartOptions,this.height,(0,r.W)({height:this.height}),this._datasetHidden,this._datasetUnhidden,this.expandLegend):(0,o.qy)(v||(v=M`<div class="info"> ${0} </div>`),this.hass.localize("ui.components.statistics_charts.no_statistics_found")):(0,o.qy)(_||(_=M`<div class="info"> ${0} </div>`),this.hass.localize("ui.components.history_charts.history_disabled"))}_datasetHidden(t){this._hiddenStats.add(t.detail.id),this.requestUpdate("_hiddenStats")}_datasetUnhidden(t){this._hiddenStats.delete(t.detail.id),this.requestUpdate("_hiddenStats")}_createOptions(){var t,e;const i=null!==(t=this.daysToShow)&&void 0!==t?t:1;let a=this.minYAxis,s=this.maxYAxis;"number"==typeof a?this.fitYData&&(a=({min:t})=>Math.min(this._roundYAxis(t,Math.floor),this.minYAxis)):this.logarithmicScale&&(a=({min:t})=>{const e=t>0?.95*t:1.05*t;return this._roundYAxis(e,Math.floor)}),"number"==typeof s?this.fitYData&&(s=({max:t})=>Math.max(this._roundYAxis(t,Math.ceil),this.maxYAxis)):this.logarithmicScale&&(s=({max:t})=>{const e=t>0?1.05*t:.95*t;return this._roundYAxis(e,Math.ceil)});const o=null!==(e=this.endTime)&&void 0!==e?e:new Date;let h=this.startTime;h||(this._chartData.forEach(t=>{var e;if(!Array.isArray(t.data)||!t.data[0])return;const i=t.data[0],a=Array.isArray(i)?i[0]:null===(e=i.value)||void 0===e?void 0:e[0];a&&(!h||new Date(a)<h)&&(h=new Date(a))}),h||(h=new Date(o.getTime()-24*i*3600*1e3))),this._chartOptions={xAxis:[{id:"xAxis",type:"time",min:h,max:this.endTime},{id:"hiddenAxis",type:"time",show:!1}],yAxis:{type:this.logarithmicScale?"log":"value",name:this.unit,nameGap:2,nameTextStyle:{align:"left"},position:(0,m.qC)(this.hass)?"right":"left",scale:"bar"!==this.chartType||this.logarithmicScale||void 0!==a||void 0!==s,min:this._clampYAxis(a),max:this._clampYAxis(s),splitLine:{show:!0},axisLabel:{formatter:this._formatYAxisLabel}},legend:{type:"custom",show:!this.hideLegend,data:this._legendData},grid:{top:15,left:1,right:1,bottom:0,containLabel:!0},tooltip:{trigger:"axis",appendTo:document.body,formatter:this._renderTooltip}}}async _generateData(){var t;if(!this.statisticsData)return;const e=this.metadata||await this._getStatisticsMetaData(Object.keys(this.statisticsData));let i=0;const a=Object.entries(this.statisticsData),s=[],o=[],h=[];let r,n;if(0===a.length)return;r=this.endTime||new Date(Math.max(...a.map(([t,e])=>new Date(e[e.length-1].start).getTime()))),r>new Date&&(r=new Date);const l=this.names||{};a.forEach(([t,a])=>{const r=null==e?void 0:e[t];let c=l[t];void 0===c&&(c=(0,y.$O)(this.hass,t,r)),this.unit||(void 0===n?n=(0,y.JE)(this.hass,t,r):null!==n&&n!==(0,y.JE)(this.hass,t,r)&&(n=null));let p,u=null;const m=[],g=[],f=(t,e,i)=>{i.length&&(t>e||(m.forEach((e,a)=>{"line"===this.chartType&&p&&u&&p.getTime()!==t.getTime()&&(e.data.push(this._transformDataValue([p,...u[a]])),e.data.push([p,null])),e.data.push(this._transformDataValue([t,...i[a]]))}),u=i,p=e))},_=(0,d.fI)(i,this._computedStyle||getComputedStyle(this));i++;const x=[],v=this.statTypes.includes("mean")&&(0,y.iY)(a,"mean"),b=this.statTypes.includes("max")&&(0,y.iY)(a,"max"),D=this.statTypes.includes("min")&&(0,y.iY)(a,"min"),M=[v,b,D].filter(Boolean).length>1,T=this.statTypes.includes("state"),S=b?"max":"mean",A=D?"min":"mean",C=M?[...this.statTypes].sort((t,e)=>"min"===t||"max"===e?-1:"max"===t||"min"===e?1:0):this.statTypes;let $=!1;C.forEach(e=>{if((0,y.iY)(a,e)){const a=M&&(e===S||e===A);x.push(e);const s=a&&D&&b&&v||T&&["change","sum"].includes(e)?_+(this.hideLegend?"00":"7F"):_,o=a?_+"3F":_+"7F",r={id:`${t}-${e}`,type:this.chartType,smooth:"line"===this.chartType&&.4,smoothMonotone:"x",cursor:"default",data:[],name:c?`${c} (${this.hass.localize(`ui.components.statistics_charts.statistic_types.${e}`)})`:this.hass.localize(`ui.components.statistics_charts.statistic_types.${e}`),symbol:"none",sampling:a&&M?"lttb":"minmax",animationDurationUpdate:0,lineStyle:{width:1.5},itemStyle:"bar"===this.chartType?{borderRadius:[4,4,0,0],borderColor:s,borderWidth:1.5}:void 0,color:"bar"===this.chartType?o:s};if(a&&"line"===this.chartType&&(r.stack=`band-${t}`,r.stackStrategy="all",this._hiddenStats.has(`${t}-${A}`)?(r.stackOrder="seriesDesc",r.areaStyle=void 0):(r.stackOrder="seriesAsc",M&&e===S&&(r.areaStyle={color:_+"3F"}))),!this.hideLegend){const a=v?"mean"===e:!1===$;var i;if(a)g.push({id:t,name:c,color:r.color,borderColor:null===(i=r.itemStyle)||void 0===i?void 0:i.borderColor});$=$||a}m.push(r),h.push(t)}});let w=null,Y=null;a.forEach(e=>{const i=new Date(e.start);if(w===i)return;w=i;const a=[];x.forEach(i=>{const s=[];if("sum"===i)null==Y?(s.push(0),Y=e.sum):s.push((e.sum||0)-Y);else if(i===S&&"line"===this.chartType&&M&&!this._hiddenStats.has(`${t}-${A}`)){const t=e[S]||0;s.push(Math.abs(t-(e[A]||0))),s.push(t)}else{var o;s.push(null!==(o=e[i])&&void 0!==o?o:null)}a.push(s)}),this._hiddenStats.has(t)||f(i,new Date(e.end),a)}),Array.prototype.push.apply(s,m),Array.prototype.push.apply(o,g)}),n&&(this.unit=n),o.forEach(({id:t,name:e,color:i,borderColor:a})=>{s.push({id:t,name:e,color:i,itemStyle:{borderColor:a},type:this.chartType,data:[],xAxisIndex:1})}),this._chartData=s,o.length!==(null===(t=this._legendData)||void 0===t?void 0:t.length)&&(this._legendData=o.length>1?o.map(({id:t,name:e})=>({id:t,name:e})):void 0),this._statisticIds=h}_transformDataValue(t){return"bar"===this.chartType&&t[1]&&t[1]<0?{value:t,itemStyle:{borderRadius:[0,0,4,4]}}:t}_clampYAxis(t){if(this.logarithmicScale){if("number"==typeof t)return Math.max(t,Number.EPSILON);if("function"==typeof t)return e=>Math.max(t(e),Number.EPSILON)}return t}_roundYAxis(t,e){return Math.abs(t)<1?t:e(t)}constructor(...t){super(...t),this.statTypes=["sum","min","mean","max"],this.chartType="line",this.fitYData=!1,this.hideLegend=!1,this.logarithmicScale=!1,this.isLoadingData=!1,this.clickForMoreInfo=!0,this._chartData=[],this._statisticIds=[],this._hiddenStats=new Set,this._previousYAxisLabelValue=0,this._renderTooltip=t=>{const e={},i=this.unit?`${(0,u.A)(this.unit,this.hass.locale)}${this.unit}`:"";return t.map((t,a)=>{var s,o;if(e[t.seriesIndex])return"";e[t.seriesIndex]=!0;const h=this._statisticIds[t.seriesIndex],r=this.hass.states[h],n=this.hass.entities[h],d=String(null!==(s=t.value[2])&&void 0!==s?s:t.value[1]),l=null!==(o=(0,p.ZQ)(r,n))&&void 0!==o?o:{maximumFractionDigits:2},u=`${(0,p.ZV)(d,this.hass.locale,l)}${i}`;return`${0===a?(0,c.yg)(new Date(t.value[0]),this.hass.locale,this.hass.config)+"<br>":""}${t.marker} ${t.seriesName}: ${u}`}).filter(Boolean).join("<br>")},this._getStatisticsMetaData=(0,n.A)(async t=>{const e=await(0,y.Wr)(this.hass,t),i={};return e.forEach(t=>{i[t.statistic_id]=t}),i}),this._formatYAxisLabel=t=>{const e=Math.max(1,-Math.floor(Math.log10(Math.abs(t-this._previousYAxisLabelValue||1)))),i=(0,p.ZV)(t,this.hass.locale,{maximumFractionDigits:e});return this._previousYAxisLabelValue=t,i}}}S.styles=(0,o.AH)(D||(D=M`:host{display:block;min-height:60px}.info{text-align:center;line-height:60px;color:var(--secondary-text-color)}`)),(0,s.Cg)([(0,h.MZ)({attribute:!1})],S.prototype,"hass",void 0),(0,s.Cg)([(0,h.MZ)({attribute:!1})],S.prototype,"statisticsData",void 0),(0,s.Cg)([(0,h.MZ)({attribute:!1})],S.prototype,"metadata",void 0),(0,s.Cg)([(0,h.MZ)({attribute:!1})],S.prototype,"names",void 0),(0,s.Cg)([(0,h.MZ)()],S.prototype,"unit",void 0),(0,s.Cg)([(0,h.MZ)({attribute:!1})],S.prototype,"startTime",void 0),(0,s.Cg)([(0,h.MZ)({attribute:!1})],S.prototype,"endTime",void 0),(0,s.Cg)([(0,h.MZ)({attribute:!1,type:Array})],S.prototype,"statTypes",void 0),(0,s.Cg)([(0,h.MZ)({attribute:!1})],S.prototype,"chartType",void 0),(0,s.Cg)([(0,h.MZ)({attribute:!1,type:Number})],S.prototype,"minYAxis",void 0),(0,s.Cg)([(0,h.MZ)({attribute:!1,type:Number})],S.prototype,"maxYAxis",void 0),(0,s.Cg)([(0,h.MZ)({attribute:"fit-y-data",type:Boolean})],S.prototype,"fitYData",void 0),(0,s.Cg)([(0,h.MZ)({attribute:"hide-legend",type:Boolean})],S.prototype,"hideLegend",void 0),(0,s.Cg)([(0,h.MZ)({attribute:"logarithmic-scale",type:Boolean})],S.prototype,"logarithmicScale",void 0),(0,s.Cg)([(0,h.MZ)({attribute:"is-loading-data",type:Boolean})],S.prototype,"isLoadingData",void 0),(0,s.Cg)([(0,h.MZ)({attribute:"click-for-more-info",type:Boolean})],S.prototype,"clickForMoreInfo",void 0),(0,s.Cg)([(0,h.MZ)()],S.prototype,"period",void 0),(0,s.Cg)([(0,h.MZ)({attribute:"days-to-show",type:Number})],S.prototype,"daysToShow",void 0),(0,s.Cg)([(0,h.MZ)({type:String})],S.prototype,"height",void 0),(0,s.Cg)([(0,h.MZ)({attribute:"expand-legend",type:Boolean})],S.prototype,"expandLegend",void 0),(0,s.Cg)([(0,h.wk)()],S.prototype,"_chartData",void 0),(0,s.Cg)([(0,h.wk)()],S.prototype,"_legendData",void 0),(0,s.Cg)([(0,h.wk)()],S.prototype,"_statisticIds",void 0),(0,s.Cg)([(0,h.wk)()],S.prototype,"_chartOptions",void 0),(0,s.Cg)([(0,h.wk)()],S.prototype,"_hiddenStats",void 0),S=(0,s.Cg)([(0,h.EM)("statistics-chart")],S),a()}catch(_){a(_)}})}}]);
//# sourceMappingURL=51486.88716833768c7455.js.map