export const __rspack_esm_id="66471";export const __rspack_esm_ids=["66471"];export const __webpack_modules__={90433(t,a,e){e.d(a,{Vy:()=>s,fI:()=>i,ux:()=>n});var r=e(22786),o=e(79468);function s(t,a){const e=t%54+1;return a.getPropertyValue(`--color-${e}`)}function i(t,a){const e=a.getPropertyValue(`--graph-color-${t+1}`)||s(t,a);return(0,o.RQ)(e)}const n=(0,r.A)(t=>Array.from({length:54},(a,e)=>i(e,t)),(t,a)=>t[0].getPropertyValue("--graph-color-1")===a[0].getPropertyValue("--graph-color-1")&&t[0].getPropertyValue("--color-1")===a[0].getPropertyValue("--color-1"))},40235(t,a,e){e.a(t,async function(t,r){try{e.r(a),e.d(a,{HuiPowerSourcesGraphCard:()=>w});e(44114),e(18111),e(7588),e(61701),e(18237),e(13579);var o=e(62826),s=e(73684),i=e(83309),n=e(40600),c=e(81859),h=e(96196),l=e(44457),d=e(94333),p=e(22786),g=e(71578),u=e(44439),_=(e(76776),e(38114)),y=e(54706),f=e(784),v=e(97372),m=e(79468),b=t([u,_,v]);[u,_,v]=b.then?(await b)():b;class w extends((0,y.E)(h.WF)){hassSubscribe(){return[(0,_.tb)(this.hass,{key:this._config?.collection_key}).subscribe(t=>this._getStatistics(t))]}getCardSize(){return 3}setConfig(t){this._config=t}shouldUpdate(t){return(0,f.xP)(this,t)||t.size>1||!t.has("hass")}render(){return this.hass&&this._config?h.qy` <ha-card> ${this._config.title?h.qy`<h1 class="card-header">${this._config.title}</h1>`:""} <div class="content ${(0,d.H)({"has-header":!!this._config.title})}"> <ha-chart-base .hass="${this.hass}" .data="${this._chartData}" .options="${this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd,this._legendData)}"></ha-chart-base> ${this._chartData.some(t=>t.data.length)?h.s6:h.qy`<div class="no-data"> ${(0,s.c)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period")} </div>`} </div> </ha-card> `:h.s6}async _getStatistics(t){const a=[];this._legendData=[];const e={solar:{stats:[],color:"--energy-solar-color",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.solar")},grid:{stats:[],color:"--energy-grid-consumption-color",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.grid")},battery:{stats:[],color:"--energy-battery-out-color",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.battery")}},r=getComputedStyle(this);for(const a of t.prefs.energy_sources)"solar"!==a.type?"battery"!==a.type?"grid"===a.type&&a.power&&e.grid.stats.push(...a.power.map(t=>t.stat_rate)):a.stat_rate&&e.battery.stats.push(a.stat_rate):a.stat_rate&&e.solar.stats.push(a.stat_rate);const o={type:"line",smooth:.4,smoothMonotone:"x",lineStyle:{width:1}},s=Date.now();Object.keys(e).forEach((n,c)=>{if(e[n].stats.length){const h=r.getPropertyValue(e[n].color),l=(0,m.xp)(h),{positive:d,negative:p}=this._processData(e[n].stats.map(a=>{const e=t.stats[a]??[];if((0,i.r)(s,this._start)&&(0,i.r)(s,this._end)){const t=(0,_.h4)(this.hass.states[a]);void 0!==t&&e.push({start:s,end:s,mean:t/1e3})}return e}));a.push({...o,id:n,name:e[n].name,color:h,stack:"positive",areaStyle:{color:new g.LinearGradient(0,0,0,1,[{offset:0,color:`rgba(${l[0]}, ${l[1]}, ${l[2]}, 0.75)`},{offset:1,color:`rgba(${l[0]}, ${l[1]}, ${l[2]}, 0.25)`}])},data:d,z:3-c}),"solar"!==n&&a.push({...o,id:`${n}-negative`,name:e[n].name,color:h,stack:"negative",areaStyle:{color:new g.LinearGradient(0,1,0,0,[{offset:0,color:`rgba(${l[0]}, ${l[1]}, ${l[2]}, 0.75)`},{offset:1,color:`rgba(${l[0]}, ${l[1]}, ${l[2]}, 0.25)`}])},data:p,z:4-c}),this._legendData.push({id:n,secondaryIds:"solar"!==n?[`${n}-negative`]:[],name:e[n].name,itemStyle:{color:`rgba(${l[0]}, ${l[1]}, ${l[2]}, 0.75)`,borderColor:h}})}}),this._start=t.start,this._end=t.end||(0,n.o)(),this._chartData=(0,v.JR)(a);const c=[];this._chartData[0]?.data.forEach((t,a)=>{const e="object"==typeof t&&"value"in t?t.value[0]:t[0];c[a]=[e,0],this._chartData.forEach(t=>{const e="object"==typeof t.data[a]&&"value"in t.data[a]?t.data[a].value[1]:t.data[a][1];c[a][1]+=e})}),this._chartData.push({...o,id:"usage",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.usage"),color:r.getPropertyValue("--primary-text-color"),lineStyle:{type:[7,2],width:1.5},data:c,z:5}),this._legendData.push({id:"usage",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.usage"),itemStyle:{color:r.getPropertyValue("--primary-text-color")}})}_processData(t){const a={};t.forEach(t=>{t.forEach(t=>{if(null==t.mean)return;const e=(t.start+t.end)/2;a[e]=[...a[e]??[],t.mean]})});const e=[],r=[];return Object.entries(a).forEach(([t,a])=>{const o=Number(t),s=a.reduce((t,a)=>t+a,0);e.push([o,Math.max(0,s)]),r.push([o,Math.min(0,s)])}),{positive:e,negative:r}}constructor(...t){super(...t),this._chartData=[],this._start=(0,c.R)(),this._end=(0,n.o)(),this.hassSubscribeRequiredHostProps=["_config"],this._createOptions=(0,p.A)((t,a,e,r,o,s,i)=>({...(0,v.od)(t,a,e,r,"kW",o,s,void 0,!0),legend:{show:!1!==this._config?.show_legend,type:"custom",data:i}}))}}w.styles=h.AH`ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:var(--ha-space-4)}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:var(--ha-space-8);margin-inline-start:var(--ha-space-8);margin-inline-end:initial;box-sizing:border-box}`,(0,o.Cg)([(0,l.MZ)({attribute:!1})],w.prototype,"hass",void 0),(0,o.Cg)([(0,l.wk)()],w.prototype,"_config",void 0),(0,o.Cg)([(0,l.wk)()],w.prototype,"_chartData",void 0),(0,o.Cg)([(0,l.wk)()],w.prototype,"_legendData",void 0),(0,o.Cg)([(0,l.wk)()],w.prototype,"_start",void 0),(0,o.Cg)([(0,l.wk)()],w.prototype,"_end",void 0),(0,o.Cg)([(0,l.wk)()],w.prototype,"_compareStart",void 0),(0,o.Cg)([(0,l.wk)()],w.prototype,"_compareEnd",void 0),w=(0,o.Cg)([(0,l.EM)("hui-power-sources-graph-card")],w),r()}catch(t){r(t)}})},71578(t,a,e){e.r(a),e.d(a,{LinearGradient:()=>m.A,default:()=>b});var r=e(88648),o=e(59126),s=e(25636),i=e(2403),n=e(3650),c=e(30137),h=e(69913),l=e(43401),d=e(87370),p=e(57610),g=e(44390),u=e(11069),_=e(88132),y=e(6036),f=e(88298),v=e(15490),m=e(67665);r.Y([s.a,i.a,n.a,c.a,h.a,l.a,d.a,p.a,g.a,u.a,y._,f.i,v.a,_.a]);const b=o},43382(t,a,e){e.d(a,{A:()=>o});var r=e(51039);function o(t){return(0,r.w)(t,Date.now())}},6116(t,a,e){e.d(a,{o:()=>s});var r=e(6439),o=e(83339);function s(t,a,e){const s=(0,o.b)(t,a)/6e4;return(0,r.u)(e?.roundingMethod)(s)}},40600(t,a,e){e.d(a,{o:()=>o});var r=e(73983);function o(t){return(0,r.D)(Date.now(),t)}},83309(t,a,e){e.d(a,{r:()=>s});var r=e(74816),o=e(35932);function s(t,a,e){const[s,i]=(0,r.x)(e?.in,t,a);return+(0,o.o)(s)===+(0,o.o)(i)}},73684(t,a,e){e.d(a,{c:()=>i});var r=e(51039),o=e(43382),s=e(83309);function i(t,a){return(0,s.r)((0,r.w)(a?.in||t,t),(0,o.A)(a?.in||t))}},81859(t,a,e){e.d(a,{R:()=>o});var r=e(35932);function o(t){return(0,r.o)(Date.now(),t)}}};
//# sourceMappingURL=66471.538945ea2c210bca.js.map