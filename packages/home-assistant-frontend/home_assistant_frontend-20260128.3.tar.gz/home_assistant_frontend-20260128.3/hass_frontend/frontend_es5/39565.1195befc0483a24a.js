"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["39565"],{90433:function(t,e,s){s.d(e,{Vy:function(){return i},fI:function(){return r},ux:function(){return c}});var o=s(22786),a=s(79468);const n=54;function i(t,e){const s=t%n+1;return e.getPropertyValue(`--color-${s}`)}function r(t,e){const s=e.getPropertyValue(`--graph-color-${t+1}`)||i(t,e);return(0,a.RQ)(s)}const c=(0,o.A)(t=>Array.from({length:n},(e,s)=>r(s,t)),(t,e)=>t[0].getPropertyValue("--graph-color-1")===e[0].getPropertyValue("--graph-color-1")&&t[0].getPropertyValue("--color-1")===e[0].getPropertyValue("--color-1"))},18427:function(t,e,s){s.d(e,{g:function(){return n}});s(42762);var o=s(79468),a=s(39274);function n(t,e,s,n,i,r){const c=t.getPropertyValue(i+"-"+r).trim(),d=c.length>0?c:t.getPropertyValue(i).trim();let h=(0,o.RQ)(d);return 0===c.length&&r&&(h=(0,o.v2)((0,o.BE)(e?(0,a.T)((0,o.Nc)((0,o.xp)(h)),r):(0,a.d)((0,o.Nc)((0,o.xp)(h)),r)))),n?h+=s?"32":"7F":s&&(h+="7F"),h}},93590:function(t,e,s){s.a(t,async function(t,o){try{s.r(e),s.d(e,{HuiEnergyDevicesDetailGraphCard:function(){return E}});s(74423),s(44114),s(72712),s(26910),s(18111),s(22489),s(20116),s(7588),s(61701),s(18237),s(27495),s(25440),s(62953);var a=s(40445),n=s(40600),i=s(81859),r=s(96196),c=s(77845),d=s(94333),h=s(22786),u=s(90433),p=s(18427),l=(s(76776),s(44439)),_=s(38114),m=s(23528),g=s(54706),f=s(784),v=s(97372),y=s(93905),b=s(20058),k=t([l,_,m,b,v]);[l,_,m,b,v]=k.then?(await k)():k;let S,C,$,D=t=>t;const w="kWh";class E extends((0,g.E)(r.WF)){hassSubscribe(){var t;return[(0,_.tb)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe(t=>{this._data=t})]}getCardSize(){return 3}setConfig(t){this._config=t}shouldUpdate(t){return(0,f.xP)(this,t)||t.size>1||!t.has("hass")}willUpdate(t){(t.has("_config")||t.has("_data"))&&this._processStatistics()}render(){return this.hass&&this._config?(0,r.qy)(S||(S=D` <ha-card> ${0} <div class="content ${0}"> <ha-chart-base .hass="${0}" .data="${0}" .options="${0}" @dataset-hidden="${0}" @dataset-unhidden="${0}"></ha-chart-base> </div> </ha-card> `),this._config.title?(0,r.qy)(C||(C=D`<h1 class="card-header">${0}</h1>`),this._config.title):"",(0,d.H)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,w,this._compareStart,this._compareEnd),this._datasetHidden,this._datasetUnhidden):r.s6}_datasetHidden(t){this._hiddenStats=[...this._hiddenStats,this._getStatIdFromId(t.detail.id)]}_datasetUnhidden(t){this._hiddenStats=this._hiddenStats.filter(e=>e!==this._getStatIdFromId(t.detail.id))}_processStatistics(){if(!this._data)return;const t=this._data;this._start=t.start,this._end=t.end||(0,n.o)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare;const e=t.stats,s=t.statsCompare,o=getComputedStyle(this),a=t.prefs.device_consumption,i={};a.forEach(t=>{t.included_in_stat&&(i[t.included_in_stat]=i[t.included_in_stat]||[],i[t.included_in_stat].push(t.stat_consumption))});const r={};t.prefs.device_consumption.forEach(t=>{const s=t.stat_consumption in e&&(0,m.$j)(e[t.stat_consumption])||0;r[t.stat_consumption]=s});const c={};t.prefs.device_consumption.forEach(t=>{c[t.stat_consumption]=(i[t.stat_consumption]||[]).reduce((t,e)=>t-r[e],r[t.stat_consumption])});const d=t.prefs.device_consumption.map(t=>t.stat_consumption);d.sort((t,e)=>c[e]-c[t]);const h=[],{summedData:u,compareSummedData:p}=(0,_.gv)(t),l="from_grid"in u||"solar"in u||"from_battery"in u,{consumption:g,compareConsumption:f}=l?(0,_.DR)(u,p):{consumption:void 0,compareConsumption:void 0};if(s){const e=this._processDataSet(o,s,t.statsMetadata,t.prefs.device_consumption,d,i,!0);if(h.push(...e),l){const t=this._processUntracked(o,e,f,!0);h.push(t)}}h.push({id:"compare-placeholder",type:"bar",stack:t.statsCompare?"devicesCompare":"devices",data:[]});const y=this._processDataSet(o,e,t.statsMetadata,t.prefs.device_consumption,d,i);if(h.push(...y),this._legendData=y.map(t=>{var e;return{id:t.id,secondaryIds:[`compare-${t.id}`],name:t.name,itemStyle:{color:t.color,borderColor:null===(e=t.itemStyle)||void 0===e?void 0:e.borderColor}}}),l){var b;const t=this._processUntracked(o,y,g,!1);h.push(t),this._legendData.push({id:t.id,secondaryIds:[`compare-${t.id}`],name:t.name,itemStyle:{color:t.color,borderColor:null===(b=t.itemStyle)||void 0===b?void 0:b.borderColor}})}(0,v.RR)(h),this._chartData=h}_processUntracked(t,e,s,o){const a={};e.forEach(t=>{t.data.forEach(t=>{a[t[o?2:0]]=(a[t[o?2:0]]||0)+t[1]})});const n=(0,v.ok)(this._start,this._compareStart),i=[];Object.keys(s.used_total).sort((t,e)=>Number(t)-Number(e)).forEach(t=>{const e=Number(t),r=[e,s.used_total[t]-(a[t]||0)];o&&(r[2]=r[0],r[0]=n(new Date(e)).getTime()),i.push(r)});const r=Date.now();return{type:"bar",cursor:"default",id:o?`compare-untracked-${r}`:`untracked-${r}`,name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),itemStyle:{borderColor:(0,p.g)(t,this.hass.themes.darkMode,!1,o,"--history-unknown-color")},barMaxWidth:50,color:(0,p.g)(t,this.hass.themes.darkMode,!0,o,"--history-unknown-color"),data:i,stack:o?"devicesCompare":"devices"}}_processDataSet(t,e,s,o,a,n,i=!1){const r=[],c=(0,v.ok)(this._start,this._compareStart);return o.forEach((o,d)=>{var h;const p=a.indexOf(o.stat_consumption);if(null!==(h=this._config)&&void 0!==h&&h.max_devices&&p>=this._config.max_devices)return void console.warn(`Max devices exceeded for ${o.name} (${p} >= ${this._config.max_devices})`);const l=(0,u.fI)(d,t);let _=null;const g=[];if(o.stat_consumption in e){const t=e[o.stat_consumption];for(const s of t){if(null===s.change||void 0===s.change||0===s.change)continue;if(_===s.start)continue;let t=0;(n[o.stat_consumption]||[]).forEach(o=>{var a;const n=e[o];t+=(null==n||null===(a=n.find(t=>t.start===s.start))||void 0===a?void 0:a.change)||0});const a=[s.start,s.change-t];i&&(a[2]=a[0],a[0]=c(new Date(s.start)).getTime()),g.push(a),_=s.start}}const f=(o.name||(0,m.$O)(this.hass,o.stat_consumption,s[o.stat_consumption]))+(o.stat_consumption in n?` (${this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked")})`:"");r.push({type:"bar",cursor:"default",id:i?`compare-${o.stat_consumption}-${p}`:`${o.stat_consumption}-${p}`,name:f,itemStyle:{borderColor:i?l+"7F":l},barMaxWidth:50,color:i?l+"32":l+"7F",data:g,stack:i?"devicesCompare":"devices"})}),a.map(t=>r.find(e=>this._getStatIdFromId(e.id)===t)).filter(Boolean)}_getStatIdFromId(t){return t.replace(/^compare-/,"").replace(/-\d+$/,"")}constructor(...t){super(...t),this._chartData=[],this._start=(0,i.R)(),this._end=(0,n.o)(),this._hiddenStats=[],this.hassSubscribeRequiredHostProps=["_config"],this._formatTotal=t=>this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,b.ZV)(t,this.hass.locale),unit:w}),this._createOptions=(0,h.A)((t,e,s,o,a,n,i)=>{const r=(0,v.od)(t,e,s,o,a,n,i,this._formatTotal),c=this._legendData?this._legendData.filter(t=>t.id&&this._hiddenStats.includes(this._getStatIdFromId(t.id))).reduce((t,e)=>(t[e.id]=!1,t),{}):{};return Object.assign(Object.assign({},r),{},{legend:{show:!0,type:"custom",data:this._legendData,selected:c},grid:{top:15,bottom:0,left:1,right:1,containLabel:!0}})})}}E.styles=(0,r.AH)($||($=D`.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}`)),(0,a.Cg)([(0,c.MZ)({attribute:!1})],E.prototype,"hass",void 0),(0,a.Cg)([(0,c.wk)()],E.prototype,"_config",void 0),(0,a.Cg)([(0,c.wk)()],E.prototype,"_chartData",void 0),(0,a.Cg)([(0,c.wk)()],E.prototype,"_data",void 0),(0,a.Cg)([(0,c.wk)()],E.prototype,"_legendData",void 0),(0,a.Cg)([(0,c.wk)()],E.prototype,"_start",void 0),(0,a.Cg)([(0,c.wk)()],E.prototype,"_end",void 0),(0,a.Cg)([(0,c.wk)()],E.prototype,"_compareStart",void 0),(0,a.Cg)([(0,c.wk)()],E.prototype,"_compareEnd",void 0),(0,a.Cg)([(0,c.wk)(),(0,y.I)({key:"energy-devices-hidden-stats",state:!0,subscribe:!1})],E.prototype,"_hiddenStats",void 0),E=(0,a.Cg)([(0,c.EM)("hui-energy-devices-detail-graph-card")],E),o()}catch(S){o(S)}})},6116:function(t,e,s){s.d(e,{o:function(){return n}});var o=s(6439),a=s(83339);function n(t,e,s){const n=(0,a.b)(t,e)/6e4;return(0,o.u)(null==s?void 0:s.roundingMethod)(n)}},40600:function(t,e,s){s.d(e,{o:function(){return a}});var o=s(73983);function a(t){return(0,o.D)(Date.now(),t)}},81859:function(t,e,s){s.d(e,{R:function(){return a}});var o=s(35932);function a(t){return(0,o.o)(Date.now(),t)}}}]);
//# sourceMappingURL=39565.1195befc0483a24a.js.map