export const __rspack_esm_id="48102";export const __rspack_esm_ids=["48102"];export const __webpack_modules__={90433(t,e,a){a.d(e,{Vy:()=>o,fI:()=>n,ux:()=>r});var i=a(22786),s=a(79468);function o(t,e){const a=t%54+1;return e.getPropertyValue(`--color-${a}`)}function n(t,e){const a=e.getPropertyValue(`--graph-color-${t+1}`)||o(t,e);return(0,s.RQ)(a)}const r=(0,i.A)(t=>Array.from({length:54},(e,a)=>n(a,t)),(t,e)=>t[0].getPropertyValue("--graph-color-1")===e[0].getPropertyValue("--graph-color-1")&&t[0].getPropertyValue("--color-1")===e[0].getPropertyValue("--color-1"))},91069(t,e,a){a.a(t,async function(t,i){try{a.d(e,{EO:()=>S,Yq:()=>C,_U:()=>x,eE:()=>b,fU:()=>k,ol:()=>v,xo:()=>w});var s=a(78016),o=a(31810),n=a(49134),r=a(81977),c=a(36307),l=a(35932),d=a(73983),h=a(6946),_=a(92913),u=a(83339),p=a(77972),g=a(31886),m=a(46927),f=t([g]);g=(f.then?(await f)():f)[0];const y=(t,e,a,i)=>{const s=a(new g.BB(t,e),i);return s instanceof Date?new Date(s.getTime()):s},v=(t,e,a,i,s)=>a.time_zone===m.Wj.server?y(t,i.time_zone,e,s):e(t,s),w=(t,e,a,i,s)=>a.time_zone===m.Wj.server?y(t,i.time_zone,e,s):e(t,s),S=(t,e,a,i,s)=>w(t,a,i,s,i.time_zone===m.Wj.server?new g.BB(e,s.time_zone):e),b=(t,e,a,i,g)=>{let m,f;if(w(t,s.e,i,g)&&w(e,o.c,i,g)){const s=(S(e,t,n.W,i,g)+1)*(a?1:-1);m=v(t,r.P,i,g,s),f=v(v(e,r.P,i,g,s),c.p,i,g)}else if(w(t,t=>(0,l.o)(t).getMilliseconds()===t.getMilliseconds(),i,g)&&w(e,t=>(0,d.D)(t).getMilliseconds()===t.getMilliseconds(),i,g)){const s=(S(e,t,h.c,i,g)+1)*(a?1:-1);m=v(t,_.f,i,g,s),f=v(e,_.f,i,g,s)}else{const s=S(e,t,u.b,i,g)*(a?1:-1);m=v(t,p.A,i,g,s),f=v(e,p.A,i,g,s)}return{start:m,end:f}},x=(t,e)=>{const a=new g.BB(t,e);return new Date(a.getTime())},C=(t,e)=>new g.BB(t,e).toISOString().split("T")[0],k=(t,e)=>new g.BB(t,e).toISOString().split("T")[1].split(".")[0];i()}catch(t){i(t)}})},46223(t,e,a){a.a(t,async function(t,i){try{a.d(e,{b:()=>S});var s=a(35932),o=a(73983),n=a(92913),r=a(52640),c=a(69137),l=a(35660),d=a(36307),h=a(11650),_=a(15797),u=a(33977),p=a(69748),g=a(55144),m=a(21828),f=a(66708),y=a(91069),v=a(380),w=t([y]);y=(w.then?(await w)():w)[0];const S=(t,e)=>{const a=new Date,i=(0,v.P)(t.locale);switch(e){case"today":return[(0,y.ol)(a,s.o,t.locale,t.config,{weekStartsOn:i}),(0,y.ol)(a,o.D,t.locale,t.config,{weekStartsOn:i})];case"yesterday":return[(0,y.ol)((0,n.f)(a,-1),s.o,t.locale,t.config,{weekStartsOn:i}),(0,y.ol)((0,n.f)(a,-1),o.D,t.locale,t.config,{weekStartsOn:i})];case"this_week":return[(0,y.ol)(a,r.k,t.locale,t.config,{weekStartsOn:i}),(0,y.ol)(a,c.$,t.locale,t.config,{weekStartsOn:i})];case"this_month":return[(0,y.ol)(a,l.w,t.locale,t.config),(0,y.ol)(a,d.p,t.locale,t.config)];case"this_quarter":return[(0,y.ol)(a,h.a,t.locale,t.config),(0,y.ol)(a,_.j,t.locale,t.config)];case"this_year":return[(0,y.ol)(a,u.D,t.locale,t.config),(0,y.ol)(a,p.Q,t.locale,t.config)];case"now-7d":return[(0,y.ol)(a,g.e,t.locale,t.config,7),(0,y.ol)(a,g.e,t.locale,t.config,0)];case"now-30d":return[(0,y.ol)(a,g.e,t.locale,t.config,30),(0,y.ol)(a,g.e,t.locale,t.config,0)];case"now-12m":return[(0,y.ol)(a,m.a,t.locale,t.config,12),(0,y.ol)(a,m.a,t.locale,t.config,0)];case"now-1h":return[(0,y.ol)(a,f.O,t.locale,t.config,1),(0,y.ol)(a,f.O,t.locale,t.config,0)];case"now-12h":return[(0,y.ol)(a,f.O,t.locale,t.config,12),(0,y.ol)(a,f.O,t.locale,t.config,0)];case"now-24h":return[(0,y.ol)(a,f.O,t.locale,t.config,24),(0,y.ol)(a,f.O,t.locale,t.config,0)]}return[a,a]};i()}catch(t){i(t)}})},75428(t,e,a){a.d(e,{D:()=>o});var i=a(75158),s=a.n(i);const o=t=>s()(t,{whiteList:{},stripIgnoreTag:!0,stripIgnoreTagBody:!0})},23528(t,e,a){a.d(e,{$3:()=>g,$O:()=>x,$j:()=>m,ED:()=>o,JE:()=>C,OQ:()=>k,PU:()=>T,Ph:()=>u,Uf:()=>b,W1:()=>p,Wr:()=>d,Z:()=>c,gF:()=>f,iY:()=>y,jU:()=>n,nN:()=>S,p3:()=>l,pJ:()=>_,r_:()=>r,sz:()=>h});a(18111),a(13579);var i=a(28978),s=a(380),o=function(t){return t[t.NONE=0]="NONE",t[t.ARITHMETIC=1]="ARITHMETIC",t[t.CIRCULAR=2]="CIRCULAR",t}({});const n=["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"],r=["L","gal","ft³","m³","CCF","MCF"],c=t=>t.sendMessagePromise({type:"recorder/info"}),l=(t,e)=>t.callWS({type:"recorder/list_statistic_ids",statistic_type:e}),d=(t,e)=>t.callWS({type:"recorder/get_statistics_metadata",statistic_ids:e}),h=(t,e,a,i,s="hour",o,n)=>t.callWS({type:"recorder/statistics_during_period",start_time:e.toISOString(),end_time:a?.toISOString(),statistic_ids:i,period:s,units:o,types:n}),_=(t,e,a,i)=>t.callWS({type:"recorder/statistic_during_period",statistic_id:e,units:i,fixed_period:a.fixed_period?{start_time:a.fixed_period.start instanceof Date?a.fixed_period.start.toISOString():a.fixed_period.start,end_time:a.fixed_period.end instanceof Date?a.fixed_period.end.toISOString():a.fixed_period.end}:void 0,calendar:a.calendar?{..."week"===a.calendar.period?{first_weekday:(0,s.D)(t.locale).substring(0,3)}:{},...a.calendar}:void 0,rolling_window:a.rolling_window}),u=t=>t.callWS({type:"recorder/validate_statistics"}),p=(t,e,a,i)=>t.callWS({type:"recorder/update_statistics_metadata",statistic_id:e,unit_of_measurement:a,unit_class:i}),g=(t,e)=>t.callWS({type:"recorder/clear_statistics",statistic_ids:e}),m=t=>{let e=null;if(!t)return null;for(const a of t)null!==a.change&&void 0!==a.change&&(null===e?e=a.change:e+=a.change);return e},f=(t,e)=>{let a=null;for(const i of e){if(!(i in t))continue;const e=m(t[i]);null!==e&&(null===a?a=e:a+=e)}return a},y=(t,e)=>t.some(t=>void 0!==t[e]&&null!==t[e]),v=["mean","min","max"],w=["sum","state","change"],S=(t,e)=>!(!v.includes(e)||0===t.mean_type)||!(!w.includes(e)||!t.has_sum),b=(t,e,a,i,s)=>{const o=new Date(a).toISOString();return t.callWS({type:"recorder/adjust_sum_statistics",statistic_id:e,start_time:o,adjustment:i,adjustment_unit_of_measurement:s})},x=(t,e,a)=>{const s=t.states[e];return s?(0,i.u)(s):a?.name||e},C=(t,e,a)=>{let i;return e&&(i=t.states[e]?.attributes.unit_of_measurement),void 0===i?a?.statistics_unit_of_measurement:i},k=t=>t.includes(":"),T=t=>t.callWS({type:"recorder/update_statistics_issues"})},18427(t,e,a){a.d(e,{g:()=>o});var i=a(79468),s=a(39274);function o(t,e,a,o,n,r){const c=t.getPropertyValue(n+"-"+r).trim(),l=c.length>0?c:t.getPropertyValue(n).trim();let d=(0,i.RQ)(l);return 0===c.length&&r&&(d=(0,i.v2)((0,i.BE)(e?(0,s.T)((0,i.Nc)((0,i.xp)(d)),r):(0,s.d)((0,i.Nc)((0,i.xp)(d)),r)))),o?d+=a?"32":"7F":a&&(d+="7F"),d}},78231(t,e,a){a.a(t,async function(t,i){try{a.r(e),a.d(e,{HuiEnergyDevicesGraphCard:()=>T});a(44114),a(18111),a(22489),a(20116),a(7588),a(61701),a(18237);var s=a(62826),o=a(96196),n=a(44457),r=a(94333),c=a(22786),l=a(8343),d=a(75428),h=a(90433),_=a(20058),u=a(44439),p=a(38114),g=a(23528),m=a(54706),f=a(784),y=(a(76776),a(1087)),v=a(3461),w=(a(26300),a(93905)),S=a(71769),b=a(18427),x=t([u,p,_]);[u,p,_]=x.then?(await x)():x;const C="M13,2.05V5.08C16.39,5.57 19,8.47 19,12C19,12.9 18.82,13.75 18.5,14.54L21.12,16.07C21.68,14.83 22,13.45 22,12C22,6.82 18.05,2.55 13,2.05M12,19A7,7 0 0,1 5,12C5,8.47 7.61,5.57 11,5.08V2.05C5.94,2.55 2,6.81 2,12A10,10 0 0,0 12,22C15.3,22 18.23,20.39 20.05,17.91L17.45,16.38C16.17,18 14.21,19 12,19Z",k="M22,21H2V3H4V19H6V10H10V19H12V6H16V19H18V14H22V21Z";class T extends((0,m.E)(o.WF)){hassSubscribe(){return[(0,p.tb)(this.hass,{key:this._config?.collection_key}).subscribe(t=>{this._data=t,this._getStatistics(t)}),(0,S.m)("all and (max-width: 450px), all and (max-height: 500px)",t=>{this._isMobile=t})]}getCardSize(){return 3}setConfig(t){this._config=t}_getAllowedModes(){return this._config?.modes&&0!==this._config.modes.length?this._config.modes:["bar","pie"]}shouldUpdate(t){return(0,f.xP)(this,t)||t.size>1||!t.has("hass")}willUpdate(t){if(super.willUpdate(t),t.has("_config")&&this._config){const t=this._getAllowedModes();this._chartType&&t.includes(this._chartType)||(this._chartType=t[0])}}render(){if(!this.hass||!this._config||!this._chartType)return o.s6;const t=this._getAllowedModes();return o.qy` <ha-card> <div class="card-header"> <span>${this._config.title?this._config.title:o.s6}</span> ${t.length>1?o.qy` <ha-icon-button .path="${"pie"===this._chartType?k:C}" .label="${this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.change_chart_type")}" @click="${this._handleChartTypeChange}"></ha-icon-button> `:o.s6} </div> <div class="content ${(0,r.H)({"has-header":!!this._config.title})}"> <ha-chart-base .hass="${this.hass}" .data="${this._chartData}" .options="${this._createOptions(this._chartData,this._chartType,this._legendData)}" .height="${`${Math.max(t.includes("pie")?300:100,28*(this._legendData?.length||0)+50)}px`}" .extraComponents="${[l.a]}" @chart-click="${this._handleChartClick}" @dataset-hidden="${this._datasetHidden}" @dataset-unhidden="${this._datasetUnhidden}"></ha-chart-base> </div> </ha-card> `}_renderTooltip(t){const e=`<h4 style="text-align: center; margin: 0;">${(0,d.D)(this._getDeviceName(t.name))}</h4>`,a=`${(0,_.ZV)(t.value[0],this.hass.locale,t.value<.1?{maximumFractionDigits:3}:void 0)} kWh ${t.percent?`(${t.percent} %)`:""}`;return`${e}${t.marker} ${t.seriesName}: <div style="direction:ltr; display: inline;">${a}</div>`}_getDeviceName(t){const e=this._compoundStats.includes(t)?` (${this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.untracked")})`:"";return(this._data?.prefs.device_consumption.find(e=>e.stat_consumption===t)?.name||(0,g.$O)(this.hass,t,this._data?.statsMetadata[t]))+e}async _getStatistics(t){const e=t.stats,a=t.statsCompare,i=[],s=[],o=[{type:this._chartType,radius:[a?"50%":"40%","70%"],universalTransition:!0,name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.energy_usage"),itemStyle:{borderRadius:"bar"===this._chartType?[0,4,4,0]:4},data:i,barWidth:a?10:20,cursor:"default",minShowLabelAngle:15,label:"pie"===this._chartType?{formatter:({name:t})=>this._getDeviceName(t),overflow:"break",alignTo:this._isMobile?"edge":"none",edgeDistance:1}:void 0,labelLine:{length2:10}}];a&&o.push({type:this._chartType,radius:["30%","50%"],universalTransition:!0,name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.previous_energy_usage"),itemStyle:{borderRadius:"bar"===this._chartType?[0,4,4,0]:4},data:s,barWidth:10,cursor:"default",label:"pie"===this._chartType?{show:!1}:void 0,emphasis:"pie"===this._chartType?{focus:"series",blurScope:"global"}:void 0});const n=getComputedStyle(this);this._compoundStats=t.prefs.device_consumption.map(t=>t.included_in_stat).filter(Boolean);const r=t.prefs.device_consumption,c={};r.forEach(t=>{c[t.stat_consumption]=t.stat_consumption in e&&(0,g.$j)(e[t.stat_consumption])||0});const l={};if(a&&r.forEach(t=>{l[t.stat_consumption]=t.stat_consumption in a&&(0,g.$j)(a[t.stat_consumption])||0}),r.forEach((t,e)=>{let o=c[t.stat_consumption];if(this._config?.hide_compound_stats){if(this._compoundStats.includes(t.stat_consumption))return}else{const e=r.reduce((e,a)=>a.included_in_stat===t.stat_consumption?e+c[a.stat_consumption]:e,0);o-=Math.min(o,e)}const d=(0,h.fI)(e,n);if(i.push({id:t.stat_consumption,value:[o,t.stat_consumption],name:t.stat_consumption,itemStyle:{color:d+"7F",borderColor:d}}),a){let e=t.stat_consumption in a&&(0,g.$j)(a[t.stat_consumption])||0;const i=r.reduce((e,a)=>a.included_in_stat===t.stat_consumption?e+l[a.stat_consumption]:e,0);e-=Math.min(e,i),s.push({id:t.stat_consumption,value:[e,t.stat_consumption],name:t.stat_consumption,itemStyle:{color:d+"32",borderColor:d+"7F"}})}}),"pie"===this._chartType){const e=i,{summedData:r,compareSummedData:c}=(0,p.gv)(t),{consumption:l,compareConsumption:d}=(0,p.DR)(r,c),h=l.total.used_total,u="from_grid"in r||"solar"in r||"from_battery"in r?h-e.reduce((t,e)=>t+e.value[0],0):0;if(u>0){const t=(0,b.g)(n,this.hass.themes.darkMode,!1,!1,"--history-unknown-color");if(e.push({id:"untracked",value:[u,"untracked"],name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.untracked_consumption"),itemStyle:{color:t+"7F",borderColor:t}}),a){const e=d.total.used_total-s.reduce((t,e)=>t+e.value[0],0);e>0&&s.push({id:"untracked",value:[e,"untracked"],name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.untracked_consumption"),itemStyle:{color:t+"32",borderColor:t+"7F"}})}}const g=e.reduce((t,e)=>this._hiddenStats.includes(e.id)?t:t+e.value[0],0);o.push({type:"pie",radius:["0%",a?"30%":"40%"],name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.total_energy_usage"),data:[g],label:{show:!0,position:"center",color:n.getPropertyValue("--secondary-text-color"),fontSize:n.getPropertyValue("--ha-font-size-m"),lineHeight:24,fontWeight:"bold",formatter:`{a}\n${(0,_.ZV)(g,this.hass.locale)} kWh`},cursor:"default",itemStyle:{color:"rgba(0, 0, 0, 0)"},tooltip:{show:!1}})}i.sort((t,e)=>e.value[0]-t.value[0]),this._config?.max_devices&&i.length>this._config.max_devices&&i.splice(this._config.max_devices),this._legendData=i.map(t=>({...t,name:this._getDeviceName(t.name)}));for(let t=i.length-1;t>=0;t--)this._hiddenStats.includes(i[t].id)&&i.splice(t,1);a&&(o[1].data=i.map(t=>s.find(e=>e.id===t.id))),this._chartData=o,await this.updateComplete}_handleChartClick(t){if("axisLabel"===t.detail.targetType&&t.detail.value&&!(0,g.OQ)(t.detail.value))(0,y.r)(this,"hass-more-info",{entityId:t.detail.value});else if("pie"===t.detail.seriesType&&"tspan"===t.detail.event?.target?.type){const e=t.detail.data.id;"untracked"!==e&&(0,y.r)(this,"hass-more-info",{entityId:e})}}_handleChartTypeChange(){if(!this._chartType)return;const t=this._getAllowedModes(),e=(t.indexOf(this._chartType)+1)%t.length;this._chartType=t[e],this._getStatistics(this._data)}_datasetHidden(t){this._hiddenStats=[...this._hiddenStats,t.detail.id],this._getStatistics(this._data)}_datasetUnhidden(t){this._hiddenStats=this._hiddenStats.filter(e=>e!==t.detail.id),this._getStatistics(this._data)}constructor(...t){super(...t),this._chartData=[],this._legendData=[],this._hiddenStats=[],this._isMobile=!1,this._compoundStats=[],this.hassSubscribeRequiredHostProps=["_config"],this._createOptions=(0,c.A)((t,e,a)=>{const i={grid:{top:5,left:5,right:40,bottom:0,containLabel:!0},tooltip:{show:!0,formatter:this._renderTooltip.bind(this)},xAxis:{show:!1},yAxis:{show:!1},legend:{type:"custom",show:!1}};return"bar"===e?(i.xAxis={show:!0,type:"value",name:"kWh",axisPointer:{show:!1}},i.yAxis={show:!0,type:"category",inverse:!0,triggerEvent:!0,data:t[0]?.data?.map(t=>t.name),axisLabel:{formatter:this._getDeviceName.bind(this),overflow:"truncate",fontSize:12,margin:5,width:Math.min(this._isMobile?100:200,Math.max(...t[0]?.data?.map(t=>(0,v.W)(this._getDeviceName(t.name),12)+5)||[]))}}):i.legend={type:"custom",show:!0,data:a,selected:a.filter(t=>t.id&&this._hiddenStats.includes(t.id)).reduce((t,e)=>(t[e.id]=!1,t),{})},i})}}T.styles=o.AH`.card-header{display:flex;justify-content:space-between;align-items:center;padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}ha-chart-base{--chart-max-height:none}ha-icon-button{transform:rotate(90deg);color:var(--secondary-text-color);cursor:pointer}`,(0,s.Cg)([(0,n.MZ)({attribute:!1})],T.prototype,"hass",void 0),(0,s.Cg)([(0,n.wk)()],T.prototype,"_config",void 0),(0,s.Cg)([(0,n.wk)()],T.prototype,"_chartData",void 0),(0,s.Cg)([(0,n.wk)()],T.prototype,"_data",void 0),(0,s.Cg)([(0,n.wk)()],T.prototype,"_legendData",void 0),(0,s.Cg)([(0,n.wk)(),(0,w.I)({key:"energy-devices-graph-chart-type",state:!0,subscribe:!1})],T.prototype,"_chartType",void 0),(0,s.Cg)([(0,n.wk)(),(0,w.I)({key:"energy-devices-pie-hidden-stats",state:!0,subscribe:!1})],T.prototype,"_hiddenStats",void 0),(0,s.Cg)([(0,n.wk)()],T.prototype,"_isMobile",void 0),T=(0,s.Cg)([(0,n.EM)("hui-energy-devices-graph-card")],T),i()}catch(t){i(t)}})},3461(t,e,a){let i;function s(t,e,a="Roboto, Noto, sans-serif"){i||(i=document.createElement("canvas"));const s=i.getContext("2d");if(!s)return 0;s.font=`${e}px ${a}`;const o=s.measureText(t);return Math.ceil(Math.max(o.actualBoundingBoxRight+o.actualBoundingBoxLeft,o.width))}a.d(e,{W:()=>s})}};
//# sourceMappingURL=48102.64c165fb98f1f78d.js.map