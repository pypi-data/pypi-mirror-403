export const __rspack_esm_id="42568";export const __rspack_esm_ids=["42568"];export const __webpack_modules__={3515(t,i,s){s.a(t,async function(t,e){try{s.r(i),s.d(i,{DEFAULT_DAYS_TO_SHOW:()=>S,HuiStatisticsGraphCard:()=>v});s(18111),s(20116),s(7588),s(61701);var n=s(62826),a=s(6946),h=s(66708),r=s(96196),_=s(44457),o=s(94333),c=s(6030),d=(s(76776),s(43661),s(34127)),g=s(38114),y=s(23528),l=s(37642),p=s(13632),u=s(784),f=s(20939),m=s(97372),b=t([d,g,m]);[d,g,m]=b.then?(await b)():b;const S=30;class v extends r.WF{static async getConfigElement(){return await Promise.all([s.e("19260"),s.e("54884"),s.e("51486"),s.e("59988")]).then(s.bind(s,9562)),document.createElement("hui-statistics-graph-card-editor")}static getStubConfig(t,i,s){const e=(0,p.B)(t,1,i,s,["sensor"],t=>"state_class"in t.attributes);return{type:"statistics-graph",entities:e.length?[e[0]]:[]}}disconnectedCallback(){super.disconnectedCallback(),this._unsubscribeEnergy(),this._interval&&(clearInterval(this._interval),this._interval=void 0)}connectedCallback(){super.connectedCallback(),this.hasUpdated&&(this._config?.energy_date_selection?this._subscribeEnergy():void 0===this._interval&&this._setFetchStatisticsTimer(!0))}_subscribeEnergy(){this._energySub||(this._energySub=(0,g.tb)(this.hass,{key:this._config?.collection_key}).subscribe(t=>{this._energyStart=t.start,this._energyEnd=t.end,this._getStatistics()}))}_unsubscribeEnergy(){this._energySub&&(this._energySub(),this._energySub=void 0),this._energyStart=void 0,this._energyEnd=void 0}getCardSize(){return 5+(this._config?.title?2:0)+(this._config?.hide_legend?0:this._entities?.length||0)}getGridOptions(){return{columns:12,min_columns:6,min_rows:3}}setConfig(t){if(!t.entities||!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(!t.entities.length)throw new Error("You must include at least one entity");this._entities=t.entities?(0,f.L)(t.entities,!1):[],this._entityIds=this._entities.map(t=>t.entity),"string"==typeof t.stat_types?this._statTypes=[t.stat_types]:t.stat_types?this._statTypes=t.stat_types:this._statTypes=["change","state","sum","min","max","mean"],this._config=t,this._computeNames()}_computeNames(){this.hass&&this._config&&(this._names={},this._entities.forEach(t=>{const i=this.hass.states[t.entity];this._names[t.entity]=(0,l.v)(this.hass,i,t.name)||t.entity}))}shouldUpdate(t){return(0,u.pY)(this,t)||t.size>1||!t.has("hass")}willUpdate(t){if(super.willUpdate(t),(t.has("hass")||t.has("_config"))&&this._computeNames(),!this._config||!t.has("_config"))return;const i=t.get("_config");if(this.hass){if(this._config.energy_date_selection&&!this._energySub)return void this._subscribeEnergy();if(!this._config.energy_date_selection&&this._energySub)return this._unsubscribeEnergy(),void this._setFetchStatisticsTimer();this._config.energy_date_selection&&this._energySub&&t.has("_config")&&i?.collection_key!==this._config.collection_key&&(this._unsubscribeEnergy(),this._subscribeEnergy())}t.has("_config")&&i?.entities!==this._config.entities?this._setFetchStatisticsTimer(!0):!t.has("_config")||i?.stat_types===this._config.stat_types&&i?.days_to_show===this._config.days_to_show&&i?.period===this._config.period&&i?.unit===this._config.unit||this._setFetchStatisticsTimer()}async _setFetchStatisticsTimer(t=!1){clearInterval(this._interval),this._interval=0,t&&await this._getStatisticsMetaData(this._entityIds),await this._getStatistics(),this._config?.energy_date_selection||(this._interval=window.setInterval(()=>this._getStatistics(),this._intervalTimeout))}get _period(){return this._config?.period??(this._energyStart&&this._energyEnd?(0,g.TI)(this._energyStart,this._energyEnd):void 0)}render(){if(!this.hass||!this._config)return r.s6;const t="number"==typeof this._config.grid_options?.rows,i=this._energyStart&&this._energyEnd?(0,a.c)(this._energyEnd,this._energyStart):this._config.days_to_show||S,s=this._energyStart||(0,h.O)(new Date,24*i+1),e=`/history?${(0,c.KH)({entity_id:this._entityIds.join(","),start_date:s.toISOString()})}`;return r.qy` <ha-card> ${this._config.title?r.qy` <h1 class="card-header"> ${this._config.title} <a id="${this._historyLinkId}" href="${e}" aria-label="${this.hass.localize("panel.history")}"> <ha-icon-next></ha-icon-next> </a> <ha-tooltip for="${this._historyLinkId}" placement="left"> ${this.hass.localize("panel.history")} </ha-tooltip> </h1> `:r.s6} <div class="content ${(0,o.H)({"has-header":!!this._config.title,"has-rows":!!this._config.grid_options?.rows})}"> <statistics-chart .hass="${this.hass}" .isLoadingData="${!this._statistics}" .statisticsData="${this._statistics}" .metadata="${this._metadata}" .period="${this._period}" .chartType="${this._config.chart_type||"line"}" .statTypes="${this._statTypes}" .names="${this._names}" .unit="${this._unit}" .minYAxis="${this._config.min_y_axis}" .maxYAxis="${this._config.max_y_axis}" .startTime="${this._energyStart}" .endTime="${this._energyEnd&&this._energyStart?(0,m.Gs)(this._period,this._energyEnd):void 0}" .fitYData="${this._config.fit_y_data||!1}" .hideLegend="${this._config.hide_legend||!1}" .logarithmicScale="${this._config.logarithmic_scale||!1}" .daysToShow="${i}" .height="${t?"100%":void 0}" .expandLegend="${this._config.expand_legend}"></statistics-chart> </div> </ha-card> `}get _intervalTimeout(){return 1e3*("5minute"===this._config?.period?5:60)*60}async _getStatisticsMetaData(t){const i=await(0,y.Wr)(this.hass,t),s={};i.forEach(t=>{s[t.statistic_id]=t}),this._metadata=s}async _getStatistics(){const t=this._energyStart??(0,h.O)(new Date,24*(this._config.days_to_show||S)+1),i=this._energyEnd;try{let s;if(this._config.unit&&this._metadata){const t=Object.values(this._metadata).find(t=>(0,y.JE)(this.hass,t?.statistic_id,t)===this._config.unit);t&&(s=t.unit_class,this._unit=this._config.unit)}if(!s&&this._metadata){const t=this._metadata[this._entityIds[0]];s=t?.unit_class,this._unit=s&&(0,y.JE)(this.hass,t.statistic_id,t)||void 0}const e=s?{[s]:this._unit}:void 0,n=await(0,y.sz)(this.hass,t,i,this._entityIds,this._period,e,this._statTypes);this._statistics={},this._entities.forEach(t=>{const i=t.entity;i in n&&(this._statistics[i]=n[i])})}catch(t){this._statistics=void 0}}constructor(...t){super(...t),this._entities=[],this._entityIds=[],this._historyLinkId=`history-${Math.random().toString(36).substring(2,9)}`,this._names={}}}v.styles=r.AH`ha-card{display:flex;flex-direction:column;height:100%}.card-header{justify-content:space-between;display:flex;padding-bottom:0}.card-header ha-icon-next{--mdc-icon-button-size:24px;line-height:24px;color:var(--primary-text-color)}.content{padding:16px;flex:1}.has-header{padding-top:0}statistics-chart{height:100%}.has-rows{--chart-max-height:100%}`,(0,n.Cg)([(0,_.MZ)({attribute:!1})],v.prototype,"hass",void 0),(0,n.Cg)([(0,_.wk)()],v.prototype,"_config",void 0),(0,n.Cg)([(0,_.wk)()],v.prototype,"_statistics",void 0),(0,n.Cg)([(0,_.wk)()],v.prototype,"_metadata",void 0),(0,n.Cg)([(0,_.wk)()],v.prototype,"_unit",void 0),(0,n.Cg)([(0,_.wk)()],v.prototype,"_energyStart",void 0),(0,n.Cg)([(0,_.wk)()],v.prototype,"_energyEnd",void 0),v=(0,n.Cg)([(0,_.EM)("hui-statistics-graph-card")],v),e()}catch(t){e(t)}})}};
//# sourceMappingURL=42568.2fd3ee076e0518b7.js.map