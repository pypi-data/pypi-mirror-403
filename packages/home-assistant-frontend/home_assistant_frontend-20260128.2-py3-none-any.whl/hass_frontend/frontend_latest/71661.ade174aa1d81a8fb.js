export const __rspack_esm_id="71661";export const __rspack_esm_ids=["71661"];export const __webpack_modules__={90433(e,t,n){n.d(t,{Vy:()=>r,fI:()=>i,ux:()=>s});var o=n(22786),a=n(79468);function r(e,t){const n=e%54+1;return t.getPropertyValue(`--color-${n}`)}function i(e,t){const n=t.getPropertyValue(`--graph-color-${e+1}`)||r(e,t);return(0,a.RQ)(n)}const s=(0,o.A)(e=>Array.from({length:54},(t,n)=>i(n,e)),(e,t)=>e[0].getPropertyValue("--graph-color-1")===t[0].getPropertyValue("--graph-color-1")&&e[0].getPropertyValue("--color-1")===t[0].getPropertyValue("--color-1"))},91069(e,t,n){n.a(e,async function(e,o){try{n.d(t,{EO:()=>b,Yq:()=>I,_U:()=>S,eE:()=>w,fU:()=>z,ol:()=>v,xo:()=>m});var a=n(78016),r=n(31810),i=n(49134),s=n(81977),c=n(36307),d=n(35932),l=n(73983),u=n(6946),h=n(92913),g=n(83339),f=n(77972),p=n(31886),y=n(46927),x=e([p]);p=(x.then?(await x)():x)[0];const _=(e,t,n,o)=>{const a=n(new p.BB(e,t),o);return a instanceof Date?new Date(a.getTime()):a},v=(e,t,n,o,a)=>n.time_zone===y.Wj.server?_(e,o.time_zone,t,a):t(e,a),m=(e,t,n,o,a)=>n.time_zone===y.Wj.server?_(e,o.time_zone,t,a):t(e,a),b=(e,t,n,o,a)=>m(e,n,o,a,o.time_zone===y.Wj.server?new p.BB(t,a.time_zone):t),w=(e,t,n,o,p)=>{let y,x;if(m(e,a.e,o,p)&&m(t,r.c,o,p)){const a=(b(t,e,i.W,o,p)+1)*(n?1:-1);y=v(e,s.P,o,p,a),x=v(v(t,s.P,o,p,a),c.p,o,p)}else if(m(e,e=>(0,d.o)(e).getMilliseconds()===e.getMilliseconds(),o,p)&&m(t,e=>(0,l.D)(e).getMilliseconds()===e.getMilliseconds(),o,p)){const a=(b(t,e,u.c,o,p)+1)*(n?1:-1);y=v(e,h.f,o,p,a),x=v(t,h.f,o,p,a)}else{const a=b(t,e,g.b,o,p)*(n?1:-1);y=v(e,f.A,o,p,a),x=v(t,f.A,o,p,a)}return{start:y,end:x}},S=(e,t)=>{const n=new p.BB(e,t);return new Date(n.getTime())},I=(e,t)=>new p.BB(e,t).toISOString().split("T")[0],z=(e,t)=>new p.BB(e,t).toISOString().split("T")[1].split(".")[0];o()}catch(e){o(e)}})},46223(e,t,n){n.a(e,async function(e,o){try{n.d(t,{b:()=>b});var a=n(35932),r=n(73983),i=n(92913),s=n(52640),c=n(69137),d=n(35660),l=n(36307),u=n(11650),h=n(15797),g=n(33977),f=n(69748),p=n(55144),y=n(21828),x=n(66708),_=n(91069),v=n(380),m=e([_]);_=(m.then?(await m)():m)[0];const b=(e,t)=>{const n=new Date,o=(0,v.P)(e.locale);switch(t){case"today":return[(0,_.ol)(n,a.o,e.locale,e.config,{weekStartsOn:o}),(0,_.ol)(n,r.D,e.locale,e.config,{weekStartsOn:o})];case"yesterday":return[(0,_.ol)((0,i.f)(n,-1),a.o,e.locale,e.config,{weekStartsOn:o}),(0,_.ol)((0,i.f)(n,-1),r.D,e.locale,e.config,{weekStartsOn:o})];case"this_week":return[(0,_.ol)(n,s.k,e.locale,e.config,{weekStartsOn:o}),(0,_.ol)(n,c.$,e.locale,e.config,{weekStartsOn:o})];case"this_month":return[(0,_.ol)(n,d.w,e.locale,e.config),(0,_.ol)(n,l.p,e.locale,e.config)];case"this_quarter":return[(0,_.ol)(n,u.a,e.locale,e.config),(0,_.ol)(n,h.j,e.locale,e.config)];case"this_year":return[(0,_.ol)(n,g.D,e.locale,e.config),(0,_.ol)(n,f.Q,e.locale,e.config)];case"now-7d":return[(0,_.ol)(n,p.e,e.locale,e.config,7),(0,_.ol)(n,p.e,e.locale,e.config,0)];case"now-30d":return[(0,_.ol)(n,p.e,e.locale,e.config,30),(0,_.ol)(n,p.e,e.locale,e.config,0)];case"now-12m":return[(0,_.ol)(n,y.a,e.locale,e.config,12),(0,_.ol)(n,y.a,e.locale,e.config,0)];case"now-1h":return[(0,_.ol)(n,x.O,e.locale,e.config,1),(0,_.ol)(n,x.O,e.locale,e.config,0)];case"now-12h":return[(0,_.ol)(n,x.O,e.locale,e.config,12),(0,_.ol)(n,x.O,e.locale,e.config,0)];case"now-24h":return[(0,_.ol)(n,x.O,e.locale,e.config,24),(0,_.ol)(n,x.O,e.locale,e.config,0)]}return[n,n]};o()}catch(e){o(e)}})},75428(e,t,n){n.d(t,{D:()=>r});var o=n(75158),a=n.n(o);const r=e=>a()(e,{whiteList:{},stripIgnoreTag:!0,stripIgnoreTagBody:!0})},3609(e,t,n){n.a(e,async function(e,t){try{n(44114),n(18111),n(22489),n(20116),n(7588),n(61701),n(18237),n(17642),n(58004),n(33853),n(45876),n(32475),n(15024),n(31698);var o=n(62826),a=n(44457),r=n(96196),i=n(22786),s=n(88696),c=n(1087),d=n(40257),l=n(3461),u=n(75428),h=n(44439),g=(n(38962),e([h]));h=(g.then?(await g)():g)[0];const f=5,p=12,y=6,x=5;class _ extends r.WF{render(){const e={grid:{top:0,bottom:0,left:0,right:0},tooltip:{trigger:"item",formatter:this._renderTooltip,appendTo:document.body}};return r.qy`<ha-chart-base .data="${this._createData(this.data,this._sizeController.value?.width)}" .options="${e}" height="100%" .extraComponents="${[d.A]}" @chart-click="${this._handleChartClick}"></ha-chart-base>`}_processLinks(e,t){const n=new Map,o=new Map,a=[];return t.forEach(t=>{const r=e.find(e=>e.id===t.source),i=e.find(e=>e.id===t.target);if(!r||!i)return;const s=o.get(r.id)||0,c=n.get(i.id)||0,d=r.value-s,l=i.value-c,u=Math.min(t.value??d,d,l);n.set(i.id,c+u),o.set(r.id,s+u),u>0&&a.push({...t,value:u})}),a}_findParentIndex(e,t,n){const o=t.find(t=>t.target===e)?.source;if(!o)return-1;let a=0;for(let e=n.length-1;e>=0;e--){const t=n[e],r=t.findIndex(e=>e.id===o);if(-1!==r)return a+r;a+=t.length}return-1}constructor(...e){super(...e),this.data={nodes:[],links:[]},this.vertical=!1,this._sizeController=new s.P(this,{callback:e=>e[0]?.contentRect}),this._renderTooltip=e=>{const t=e.data,n=this.valueFormatter?this.valueFormatter(t.value):t.value;if(t.id){const o=this.data.nodes.find(e=>e.id===t.id);return`${e.marker} ${(0,u.D)(o?.label??t.id)}<br>${n}`}if(t.source&&t.target){const e=this.data.nodes.find(e=>e.id===t.source),o=this.data.nodes.find(e=>e.id===t.target);return`${(0,u.D)(e?.label??t.source)} → ${(0,u.D)(o?.label??t.target)}<br>${n}`}return null},this._handleChartClick=e=>{const t=e.detail;if("node"!==t.dataType)return;const n=t.data?.id;if(!n)return;const o=this.data.nodes.find(e=>e.id===n);o?.entityId&&(0,c.r)(this,"node-click",{node:o})},this._createData=(0,i.A)((e,t=0)=>{const n=e.nodes.filter(e=>e.value>0),o=[...new Set(n.map(e=>e.index))].sort(),a=new Map,r=[];o.forEach((t,o)=>{a.set(t,o);const i=n.filter(e=>e.index===t);i.length>0&&r.push(r.length>0?i.sort((t,n)=>{const o=this._findParentIndex(t.id,e.links,r),a=this._findParentIndex(n.id,e.links,r);return o===a?0:-1===o?1:-1===a?-1:o-a}):i)});const i=this._processLinks(n,e.links),s=t/o.length-30-x;return{id:"sankey",type:"sankey",nodes:r.flat().map(e=>({id:e.id,value:e.value,itemStyle:{color:e.color},depth:a.get(e.index)})),links:i,draggable:!1,orient:this.vertical?"vertical":"horizontal",nodeWidth:15,nodeGap:y,lineStyle:{color:"gradient",opacity:.4,curveness:.5},layoutIterations:0,animationDuration:500,label:{formatter:t=>e.nodes.find(e=>e.id===t.data.id)?.label??t.data.id,position:this.vertical?"bottom":"right",distance:x,minMargin:5,overflow:"break"},labelLayout:e=>{if(this.vertical){const t=e.text.split(" ").reduce((e,t)=>e.length>t.length?e:t,""),n=(0,l.W)(t,p),o=e.rect.width+6,a=Math.min(p,o/n*p);return{fontSize:a>1?a:0,width:o,align:"center",dy:-2}}const t=e.rect.height+8,n=Math.min(t/e.labelRect.height*p,p);return{fontSize:n,lineHeight:n,width:s,height:e.rect.height}},top:this.vertical?0:f,bottom:this.vertical?25:f,left:this.vertical?f:0,right:this.vertical?f:s+x,emphasis:{focus:"adjacency"}}})}}_.styles=r.AH`:host{display:block;flex:1;max-width:100%;background:var(--ha-card-background,var(--card-background-color))}ha-chart-base{width:100%;height:100%}`,(0,o.Cg)([(0,a.MZ)({attribute:!1})],_.prototype,"hass",void 0),(0,o.Cg)([(0,a.MZ)({attribute:!1})],_.prototype,"data",void 0),(0,o.Cg)([(0,a.MZ)({type:Boolean})],_.prototype,"vertical",void 0),(0,o.Cg)([(0,a.MZ)({type:String,attribute:!1})],_.prototype,"valueFormatter",void 0),(0,o.Cg)([(0,a.wk)()],_.prototype,"_sizeController",void 0),_=(0,o.Cg)([(0,a.EM)("ha-sankey-chart")],_),t()}catch(e){t(e)}})},23528(e,t,n){n.d(t,{$3:()=>p,$O:()=>S,$j:()=>y,ED:()=>r,JE:()=>I,OQ:()=>z,PU:()=>k,Ph:()=>g,Uf:()=>w,W1:()=>f,Wr:()=>l,Z:()=>c,gF:()=>x,iY:()=>_,jU:()=>i,nN:()=>b,p3:()=>d,pJ:()=>h,r_:()=>s,sz:()=>u});n(18111),n(13579);var o=n(28978),a=n(380),r=function(e){return e[e.NONE=0]="NONE",e[e.ARITHMETIC=1]="ARITHMETIC",e[e.CIRCULAR=2]="CIRCULAR",e}({});const i=["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"],s=["L","gal","ft³","m³","CCF","MCF"],c=e=>e.sendMessagePromise({type:"recorder/info"}),d=(e,t)=>e.callWS({type:"recorder/list_statistic_ids",statistic_type:t}),l=(e,t)=>e.callWS({type:"recorder/get_statistics_metadata",statistic_ids:t}),u=(e,t,n,o,a="hour",r,i)=>e.callWS({type:"recorder/statistics_during_period",start_time:t.toISOString(),end_time:n?.toISOString(),statistic_ids:o,period:a,units:r,types:i}),h=(e,t,n,o)=>e.callWS({type:"recorder/statistic_during_period",statistic_id:t,units:o,fixed_period:n.fixed_period?{start_time:n.fixed_period.start instanceof Date?n.fixed_period.start.toISOString():n.fixed_period.start,end_time:n.fixed_period.end instanceof Date?n.fixed_period.end.toISOString():n.fixed_period.end}:void 0,calendar:n.calendar?{..."week"===n.calendar.period?{first_weekday:(0,a.D)(e.locale).substring(0,3)}:{},...n.calendar}:void 0,rolling_window:n.rolling_window}),g=e=>e.callWS({type:"recorder/validate_statistics"}),f=(e,t,n,o)=>e.callWS({type:"recorder/update_statistics_metadata",statistic_id:t,unit_of_measurement:n,unit_class:o}),p=(e,t)=>e.callWS({type:"recorder/clear_statistics",statistic_ids:t}),y=e=>{let t=null;if(!e)return null;for(const n of e)null!==n.change&&void 0!==n.change&&(null===t?t=n.change:t+=n.change);return t},x=(e,t)=>{let n=null;for(const o of t){if(!(o in e))continue;const t=y(e[o]);null!==t&&(null===n?n=t:n+=t)}return n},_=(e,t)=>e.some(e=>void 0!==e[t]&&null!==e[t]),v=["mean","min","max"],m=["sum","state","change"],b=(e,t)=>!(!v.includes(t)||0===e.mean_type)||!(!m.includes(t)||!e.has_sum),w=(e,t,n,o,a)=>{const r=new Date(n).toISOString();return e.callWS({type:"recorder/adjust_sum_statistics",statistic_id:t,start_time:r,adjustment:o,adjustment_unit_of_measurement:a})},S=(e,t,n)=>{const a=e.states[t];return a?(0,o.u)(a):n?.name||t},I=(e,t,n)=>{let o;return t&&(o=e.states[t]?.attributes.unit_of_measurement),void 0===o?n?.statistics_unit_of_measurement:o},z=e=>e.includes(":"),k=e=>e.callWS({type:"recorder/update_statistics_issues"})},48949(e,t,n){n.d(t,{Q:()=>s});var o=n(62826),a=n(44457),r=n(84187),i=n(71769);const s=e=>{class t extends e{connectedCallback(){super.connectedCallback(),this._unsubMql=(0,i.m)("all and (max-width: 450px), all and (max-height: 500px)",e=>{this._isMobileSize=e})}disconnectedCallback(){super.disconnectedCallback(),this._unsubMql?.(),this._unsubMql=void 0}constructor(...e){super(...e),this._isMobileSize=!1,this._isMobileClient=r.M}}return(0,o.Cg)([(0,a.wk)()],t.prototype,"_isMobileSize",void 0),t}},40257(e,t,n){n.d(t,{A:()=>h});var o=n(84267),a=(n(44114),n(18111),n(22489),n(20116),n(30531),n(7588),n(61701),n(18237),n(17642),n(58004),n(33853),n(45876),n(32475),n(15024),n(31698),n(83354));function r(e){return"passThrough"in e}function i(e,t){e.eachSeriesByType("sankey",e=>{if("justify"!==e.get("nodeAlign"))return;const n=e.get("nodeWidth"),o=e.get("nodeGap"),i=(0,a.Lj)(e,t).refContainer,{width:d,height:l}=i,u=e.getGraph();!function(e,t,n,o,a,i,d){const l=e.filter(e=>e.getLayout().value>0),u=[...new Set(l.map(e=>e.hostGraph.data.getRawDataItem(e.dataIndex).depth||0))].sort(),h=function(e,t){const n=[];return t.forEach(t=>{const o=function(e,t,n){if(0===e.getLayout().value)return[];const o=s(e.node1,t),a=s(e.node2,t),r=function(e){const t=e.hostGraph.edgeData.getRawDataItem(e.dataIndex);return t.value}(e),i=function(e,t,n){return n.slice(e+1,t)}(o.depthIndex,a.depthIndex,t),c=e.node1.hostGraph.data.getRawDataItem(e.node1.dataIndex),d=e.node2.hostGraph.data.getRawDataItem(e.node2.dataIndex),l=i.map(e=>{const t=function(e,t,n,o){return{passThrough:!0,id:`${e}-${t}-${n}`,value:o,depth:n,sourceId:e,targetId:t}}(c.id,d.id,e,r);return n.push(t),t.id});return l}(t,e,n);t.passThroughNodeIds=o}),n}(u,t),g=function(e,t,n,o,a,i,s){const{sectionSize:d,sectionDepthSize:l}=function(e,t,n,o,a){const r=("vertical"===e?t:n)-2*a,i="vertical"===e?n/o.length:t/o.length;return{sectionSize:r,sectionDepthSize:i}}(i,o,a,n,s),u=function(e,t){const n={};return e.forEach(e=>{const t=e.getLayout().depth;n[t]?n[t].push(e):n[t]=[e]}),t.forEach(e=>{n[e.depth]?n[e.depth].push(e):n[e.depth]=[e]}),n}(e,t),h=function(e,t){const n={};return t.forEach((o,a)=>{const i=[...e[o]||[]].sort((o,i)=>{const s=r(o),c=r(i);if(s&&c){if(a>0){const s=t[a-1],c=n[s]||e[s]||[],d=c.findIndex(e=>(r(e),e.id)===o.sourceId),l=c.findIndex(e=>(r(e),e.id)===i.sourceId);if(d!==l&&-1!==d&&-1!==l)return d-l}if(a<t.length-1){const n=t[a+1],s=e[n]||[],c=s.findIndex(e=>(r(e),e.id)===o.targetId),d=s.findIndex(e=>(r(e),e.id)===i.targetId);if(c!==d&&-1!==c&&-1!==d)return c-d}}return 0});n[o]=i}),n}(u,n);let g=0;const f=n.map(e=>{const t=function(e){return e.map(e=>({node:e,id:e.id,value:r(e)?e.value:e.getLayout().value,x:0,y:0,dx:0,dy:0,size:0}))}(h[e]||[]),n=d-(t.length+1)*s,o=t.reduce((e,t)=>e+t.value,0),{nodes:a,valueToSizeRatio:i}=c(t,n,o,g);return i>g&&(g=i),{nodes:a,depth:e,totalValue:o,valueToSizeRatio:i}});return f.forEach((e,t)=>{!function(e,t,n,o,a,r){let i=0;e.valueToSizeRatio!==a?e.nodes.forEach(e=>{const t=Math.max(1,Math.floor(e.value/a));i+=t,e.size=t}):i=e.nodes.reduce((e,t)=>e+t.size,0);const s=n-i;let c=s/(e.nodes.length+1);e.nodes.forEach(n=>{"vertical"===r?(n.x=c,n.y=t*o):(n.x=t*o,n.y=c),c+=n.size+s/(e.nodes.length+1)})}(e,t,d,l,g,i)}),f.flatMap(e=>e.nodes)}(l,h,u,a,i,d,o);!function(e,t,n){const o=function(e){return"vertical"===e?{breadth:"x",depth:"y",breadthSize:"dx",depthSize:"dy"}:{breadth:"y",depth:"x",breadthSize:"dy",depthSize:"dx"}}(n),a="vertical"===n?"curveVertical":"curveHorizontal";(function(e,t,n){e.forEach(e=>{e[n.breadthSize]=e.size,e[n.depthSize]=t,r(e.node)||e.node.setLayout({x:e.x,y:e.y,dx:e.dx,dy:e.dy},!0)})})(e,t,o),function(e,t){e.forEach(e=>{r(e.node)||e.node.outEdges.forEach(n=>{const o=n.hostGraph.edgeData.getRawDataItem(n.dataIndex).value/e.value*e.size;n.setLayout({[t.breadthSize]:o,[t.depthSize]:0},!0)})})}(e,o),function(e,t){e.forEach(e=>{r(e.node)||(e.node.outEdges.sort((e,n)=>e.node2.getLayout()[t.breadth]-n.node2.getLayout()[t.breadth]),e.node.inEdges.sort((e,n)=>e.node1.getLayout()[t.breadth]-n.node1.getLayout()[t.breadth]))})}(e,o),e.forEach(t=>{r(t.node)||(function(e,t,n){if(r(e.node))return;let o=0;e.node.outEdges.forEach(a=>{a.setLayout({x:"vertical"===t?e.x+o:e.x+e.dx,y:"vertical"===t?e.y+e.dy:e.y+o},!0),o+=a.getLayout()[n.breadthSize]})}(t,n,o),function(e,t,n,o,a){if(r(e.node))return;let i=0;e.node.inEdges.forEach(r=>{const s=function(e,t,n,o){const a=[];return e.passThroughNodeIds.forEach(e=>{const r=t.find(t=>t.id===e);a.push({x:r.x,y:r.y,type:o}),"vertical"===n?a.push({x:r.x,y:r.y+r.dy,type:"line"}):a.push({x:r.x+r.dx,y:r.y,type:"line"})}),a}(r,t,n,a);r.setLayout({targets:[...s,{x:"vertical"===n?e.x+i:e.x,y:"vertical"===n?e.y:e.y+i,type:a}]},!0),i+=r.getLayout()[o.breadthSize]})}(t,e,n,o,a))})}(g,n,d)}(u.nodes,u.edges,n,o,d,l,e.get("orient"))})}function s(e,t){const n=e.hostGraph.data.getRawDataItem(e.dataIndex).depth||0,o=t.findIndex(e=>e===n);return{depth:n,depthIndex:o}}function c(e,t,n,o=0){let a=n/t;a<o&&(a=o);let r=0;const i=e.map(e=>{if(1===e.size)return e;let t=Math.floor(e.value/a);return t<1&&(r+=1-t,t=1),{...e,size:t}});return r>0?c(i,t-r,n,a):{nodes:i,valueToSizeRatio:a}}var d=n(30052);class l extends d.A{render(e,t,n){super.render(e,t,n);const o=e.getData("edge");e.getGraph().eachEdge(e=>{const t=e.getLayout(),n=e.getModel().getModel("lineStyle").get("curveness"),a=o.getItemGraphicEl(e.dataIndex);a.buildPath=e=>function(e,t,n){if(!t.targets?.length)return;e.moveTo(t.x,t.y);const o=t.targets[t.targets.length-1],a=[{x:t.x,y:t.y,type:o.type},...t.targets];for(let t=1;t<a.length;t++){const o=a[t],r=a[t-1];"curveHorizontal"===o.type?e.bezierCurveTo(r.x*(1-n)+o.x*n,r.y,o.x*(1-n)+r.x*n,o.y,o.x,o.y):"curveVertical"===o.type?e.bezierCurveTo(r.x,r.y*(1-n)+o.y*n,o.x,o.y*(1-n)+r.y*n,o.x,o.y):e.lineTo(o.x,o.y)}e.lineTo(o.x+t.dx,o.y+t.dy);for(let o=a.length-2;o>=0;o--){const r={x:a[o+1].x+t.dx,y:a[o+1].y+t.dy,type:a[o+1].type},i={x:a[o].x+t.dx,y:a[o].y+t.dy,type:r.type};"curveHorizontal"===i.type?e.bezierCurveTo(r.x*(1-n)+i.x*n,r.y,i.x*(1-n)+r.x*n,i.y,i.x,i.y):"curveVertical"===i.type?e.bezierCurveTo(r.x,r.y*(1-n)+i.y*n,i.x,i.y*(1-n)+r.y*n,i.x,i.y):e.lineTo(i.x,i.y)}e.closePath()}(e,t,n),a.dirtyShape()})}}const u=l;function h(e){(0,o.a)(e),e.registerLayout(i),e.registerChartView(u)}},84187(e,t,n){n.d(t,{M:()=>o});const o=/(?:iphone|android|ipad)/i.test(navigator.userAgent)},3461(e,t,n){let o;function a(e,t,n="Roboto, Noto, sans-serif"){o||(o=document.createElement("canvas"));const a=o.getContext("2d");if(!a)return 0;a.font=`${t}px ${n}`;const r=a.measureText(e);return Math.ceil(Math.max(r.actualBoundingBoxRight+r.actualBoundingBoxLeft,r.width))}n.d(t,{W:()=>a})}};
//# sourceMappingURL=71661.ade174aa1d81a8fb.js.map