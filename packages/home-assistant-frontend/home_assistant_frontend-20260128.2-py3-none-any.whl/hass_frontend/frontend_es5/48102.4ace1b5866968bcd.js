"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["48102"],{90433:function(t,e,i){i.d(e,{Vy:function(){return o},fI:function(){return r},ux:function(){return c}});var n=i(22786),a=i(79468);const s=54;function o(t,e){const i=t%s+1;return e.getPropertyValue(`--color-${i}`)}function r(t,e){const i=e.getPropertyValue(`--graph-color-${t+1}`)||o(t,e);return(0,a.RQ)(i)}const c=(0,n.A)(t=>Array.from({length:s},(e,i)=>r(i,t)),(t,e)=>t[0].getPropertyValue("--graph-color-1")===e[0].getPropertyValue("--graph-color-1")&&t[0].getPropertyValue("--color-1")===e[0].getPropertyValue("--color-1"))},91069:function(t,e,i){i.a(t,async function(t,n){try{i.d(e,{EO:function(){return b},Yq:function(){return C},_U:function(){return x},eE:function(){return S},fU:function(){return k},ol:function(){return v},xo:function(){return w}});var a=i(78016),s=i(31810),o=i(49134),r=i(81977),c=i(36307),l=i(35932),d=i(73983),u=i(6946),h=i(92913),_=i(83339),p=i(77972),g=i(31886),f=i(46927),m=t([g]);g=(m.then?(await m)():m)[0];const y=(t,e,i,n)=>{const a=i(new g.BB(t,e),n);return a instanceof Date?new Date(a.getTime()):a},v=(t,e,i,n,a)=>i.time_zone===f.Wj.server?y(t,n.time_zone,e,a):e(t,a),w=(t,e,i,n,a)=>i.time_zone===f.Wj.server?y(t,n.time_zone,e,a):e(t,a),b=(t,e,i,n,a)=>w(t,i,n,a,n.time_zone===f.Wj.server?new g.BB(e,a.time_zone):e),S=(t,e,i,n,g)=>{let f,m;if(w(t,a.e,n,g)&&w(e,s.c,n,g)){const a=(b(e,t,o.W,n,g)+1)*(i?1:-1);f=v(t,r.P,n,g,a),m=v(v(e,r.P,n,g,a),c.p,n,g)}else if(w(t,t=>(0,l.o)(t).getMilliseconds()===t.getMilliseconds(),n,g)&&w(e,t=>(0,d.D)(t).getMilliseconds()===t.getMilliseconds(),n,g)){const a=(b(e,t,u.c,n,g)+1)*(i?1:-1);f=v(t,h.f,n,g,a),m=v(e,h.f,n,g,a)}else{const a=b(e,t,_.b,n,g)*(i?1:-1);f=v(t,p.A,n,g,a),m=v(e,p.A,n,g,a)}return{start:f,end:m}},x=(t,e)=>{const i=new g.BB(t,e);return new Date(i.getTime())},C=(t,e)=>new g.BB(t,e).toISOString().split("T")[0],k=(t,e)=>new g.BB(t,e).toISOString().split("T")[1].split(".")[0];n()}catch(y){n(y)}})},46223:function(t,e,i){i.a(t,async function(t,n){try{i.d(e,{b:function(){return b}});var a=i(35932),s=i(73983),o=i(92913),r=i(52640),c=i(69137),l=i(35660),d=i(36307),u=i(11650),h=i(15797),_=i(33977),p=i(69748),g=i(55144),f=i(21828),m=i(66708),y=i(91069),v=i(380),w=t([v,y]);[v,y]=w.then?(await w)():w;const b=(t,e)=>{const i=new Date,n=(0,v.P)(t.locale);switch(e){case"today":return[(0,y.ol)(i,a.o,t.locale,t.config,{weekStartsOn:n}),(0,y.ol)(i,s.D,t.locale,t.config,{weekStartsOn:n})];case"yesterday":return[(0,y.ol)((0,o.f)(i,-1),a.o,t.locale,t.config,{weekStartsOn:n}),(0,y.ol)((0,o.f)(i,-1),s.D,t.locale,t.config,{weekStartsOn:n})];case"this_week":return[(0,y.ol)(i,r.k,t.locale,t.config,{weekStartsOn:n}),(0,y.ol)(i,c.$,t.locale,t.config,{weekStartsOn:n})];case"this_month":return[(0,y.ol)(i,l.w,t.locale,t.config),(0,y.ol)(i,d.p,t.locale,t.config)];case"this_quarter":return[(0,y.ol)(i,u.a,t.locale,t.config),(0,y.ol)(i,h.j,t.locale,t.config)];case"this_year":return[(0,y.ol)(i,_.D,t.locale,t.config),(0,y.ol)(i,p.Q,t.locale,t.config)];case"now-7d":return[(0,y.ol)(i,g.e,t.locale,t.config,7),(0,y.ol)(i,g.e,t.locale,t.config,0)];case"now-30d":return[(0,y.ol)(i,g.e,t.locale,t.config,30),(0,y.ol)(i,g.e,t.locale,t.config,0)];case"now-12m":return[(0,y.ol)(i,f.a,t.locale,t.config,12),(0,y.ol)(i,f.a,t.locale,t.config,0)];case"now-1h":return[(0,y.ol)(i,m.O,t.locale,t.config,1),(0,y.ol)(i,m.O,t.locale,t.config,0)];case"now-12h":return[(0,y.ol)(i,m.O,t.locale,t.config,12),(0,y.ol)(i,m.O,t.locale,t.config,0)];case"now-24h":return[(0,y.ol)(i,m.O,t.locale,t.config,24),(0,y.ol)(i,m.O,t.locale,t.config,0)]}return[i,i]};n()}catch(b){n(b)}})},75428:function(t,e,i){i.d(e,{D:function(){return s}});var n=i(75158),a=i.n(n);const s=t=>a()(t,{whiteList:{},stripIgnoreTag:!0,stripIgnoreTagBody:!0})},23528:function(t,e,i){i.a(t,async function(t,n){try{i.d(e,{$3:function(){return m},$O:function(){return k},$j:function(){return y},ED:function(){return r},JE:function(){return T},OQ:function(){return D},PU:function(){return $},Ph:function(){return g},Uf:function(){return C},W1:function(){return f},Wr:function(){return h},Z:function(){return d},gF:function(){return v},iY:function(){return w},jU:function(){return c},nN:function(){return x},p3:function(){return u},pJ:function(){return p},r_:function(){return l},sz:function(){return _}});i(74423),i(18111),i(13579),i(62953);var a=i(28978),s=i(380),o=t([s]);s=(o.then?(await o)():o)[0];var r=function(t){return t[t.NONE=0]="NONE",t[t.ARITHMETIC=1]="ARITHMETIC",t[t.CIRCULAR=2]="CIRCULAR",t}({});const c=["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"],l=["L","gal","ft³","m³","CCF","MCF"],d=t=>t.sendMessagePromise({type:"recorder/info"}),u=(t,e)=>t.callWS({type:"recorder/list_statistic_ids",statistic_type:e}),h=(t,e)=>t.callWS({type:"recorder/get_statistics_metadata",statistic_ids:e}),_=(t,e,i,n,a="hour",s,o)=>t.callWS({type:"recorder/statistics_during_period",start_time:e.toISOString(),end_time:null==i?void 0:i.toISOString(),statistic_ids:n,period:a,units:s,types:o}),p=(t,e,i,n)=>t.callWS({type:"recorder/statistic_during_period",statistic_id:e,units:n,fixed_period:i.fixed_period?{start_time:i.fixed_period.start instanceof Date?i.fixed_period.start.toISOString():i.fixed_period.start,end_time:i.fixed_period.end instanceof Date?i.fixed_period.end.toISOString():i.fixed_period.end}:void 0,calendar:i.calendar?Object.assign(Object.assign({},"week"===i.calendar.period?{first_weekday:(0,s.D)(t.locale).substring(0,3)}:{}),i.calendar):void 0,rolling_window:i.rolling_window}),g=t=>t.callWS({type:"recorder/validate_statistics"}),f=(t,e,i,n)=>t.callWS({type:"recorder/update_statistics_metadata",statistic_id:e,unit_of_measurement:i,unit_class:n}),m=(t,e)=>t.callWS({type:"recorder/clear_statistics",statistic_ids:e}),y=t=>{let e=null;if(!t)return null;for(const i of t)null!==i.change&&void 0!==i.change&&(null===e?e=i.change:e+=i.change);return e},v=(t,e)=>{let i=null;for(const n of e){if(!(n in t))continue;const e=y(t[n]);null!==e&&(null===i?i=e:i+=e)}return i},w=(t,e)=>t.some(t=>void 0!==t[e]&&null!==t[e]),b=["mean","min","max"],S=["sum","state","change"],x=(t,e)=>!(!b.includes(e)||0===t.mean_type)||!(!S.includes(e)||!t.has_sum),C=(t,e,i,n,a)=>{const s=new Date(i).toISOString();return t.callWS({type:"recorder/adjust_sum_statistics",statistic_id:e,start_time:s,adjustment:n,adjustment_unit_of_measurement:a})},k=(t,e,i)=>{const n=t.states[e];return n?(0,a.u)(n):(null==i?void 0:i.name)||e},T=(t,e,i)=>{let n;var a;e&&(n=null===(a=t.states[e])||void 0===a?void 0:a.attributes.unit_of_measurement);return void 0===n?null==i?void 0:i.statistics_unit_of_measurement:n},D=t=>t.includes(":"),$=t=>t.callWS({type:"recorder/update_statistics_issues"});n()}catch(c){n(c)}})},18427:function(t,e,i){i.d(e,{g:function(){return s}});i(42762);var n=i(79468),a=i(39274);function s(t,e,i,s,o,r){const c=t.getPropertyValue(o+"-"+r).trim(),l=c.length>0?c:t.getPropertyValue(o).trim();let d=(0,n.RQ)(l);return 0===c.length&&r&&(d=(0,n.v2)((0,n.BE)(e?(0,a.T)((0,n.Nc)((0,n.xp)(d)),r):(0,a.d)((0,n.Nc)((0,n.xp)(d)),r)))),s?d+=i?"32":"7F":i&&(d+="7F"),d}},78231:function(t,e,i){i.a(t,async function(t,n){try{i.r(e),i.d(e,{HuiEnergyDevicesGraphCard:function(){return M}});i(74423),i(44114),i(72712),i(26910),i(18111),i(22489),i(20116),i(7588),i(61701),i(18237),i(3362),i(62953);var a=i(40445),s=i(96196),o=i(77845),r=i(94333),c=i(22786),l=i(8343),d=i(75428),u=i(90433),h=i(20058),_=i(44439),p=i(38114),g=i(23528),f=i(54706),m=i(784),y=(i(76776),i(1087)),v=i(3461),w=(i(26300),i(93905)),b=i(71769),S=i(18427),x=t([_,p,h,g]);[_,p,h,g]=x.then?(await x)():x;let C,k,T,D=t=>t;const $="M13,2.05V5.08C16.39,5.57 19,8.47 19,12C19,12.9 18.82,13.75 18.5,14.54L21.12,16.07C21.68,14.83 22,13.45 22,12C22,6.82 18.05,2.55 13,2.05M12,19A7,7 0 0,1 5,12C5,8.47 7.61,5.57 11,5.08V2.05C5.94,2.55 2,6.81 2,12A10,10 0 0,0 12,22C15.3,22 18.23,20.39 20.05,17.91L17.45,16.38C16.17,18 14.21,19 12,19Z",O="M22,21H2V3H4V19H6V10H10V19H12V6H16V19H18V14H22V21Z";class M extends((0,f.E)(s.WF)){hassSubscribe(){var t;return[(0,p.tb)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe(t=>{this._data=t,this._getStatistics(t)}),(0,b.m)("all and (max-width: 450px), all and (max-height: 500px)",t=>{this._isMobile=t})]}getCardSize(){return 3}setConfig(t){this._config=t}_getAllowedModes(){var t;return null!==(t=this._config)&&void 0!==t&&t.modes&&0!==this._config.modes.length?this._config.modes:["bar","pie"]}shouldUpdate(t){return(0,m.xP)(this,t)||t.size>1||!t.has("hass")}willUpdate(t){if(super.willUpdate(t),t.has("_config")&&this._config){const t=this._getAllowedModes();this._chartType&&t.includes(this._chartType)||(this._chartType=t[0])}}render(){var t;if(!this.hass||!this._config||!this._chartType)return s.s6;const e=this._getAllowedModes();return(0,s.qy)(C||(C=D` <ha-card> <div class="card-header"> <span>${0}</span> ${0} </div> <div class="content ${0}"> <ha-chart-base .hass="${0}" .data="${0}" .options="${0}" .height="${0}" .extraComponents="${0}" @chart-click="${0}" @dataset-hidden="${0}" @dataset-unhidden="${0}"></ha-chart-base> </div> </ha-card> `),this._config.title?this._config.title:s.s6,e.length>1?(0,s.qy)(k||(k=D` <ha-icon-button .path="${0}" .label="${0}" @click="${0}"></ha-icon-button> `),"pie"===this._chartType?O:$,this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.change_chart_type"),this._handleChartTypeChange):s.s6,(0,r.H)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._chartData,this._chartType,this._legendData),`${Math.max(e.includes("pie")?300:100,28*((null===(t=this._legendData)||void 0===t?void 0:t.length)||0)+50)}px`,[l.a],this._handleChartClick,this._datasetHidden,this._datasetUnhidden)}_renderTooltip(t){const e=`<h4 style="text-align: center; margin: 0;">${(0,d.D)(this._getDeviceName(t.name))}</h4>`,i=`${(0,h.ZV)(t.value[0],this.hass.locale,t.value<.1?{maximumFractionDigits:3}:void 0)} kWh ${t.percent?`(${t.percent} %)`:""}`;return`${e}${t.marker} ${t.seriesName}: <div style="direction:ltr; display: inline;">${i}</div>`}_getDeviceName(t){var e,i;const n=this._compoundStats.includes(t)?` (${this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.untracked")})`:"";return((null===(e=this._data)||void 0===e||null===(e=e.prefs.device_consumption.find(e=>e.stat_consumption===t))||void 0===e?void 0:e.name)||(0,g.$O)(this.hass,t,null===(i=this._data)||void 0===i?void 0:i.statsMetadata[t]))+n}async _getStatistics(t){var e;const i=t.stats,n=t.statsCompare,a=[],s=[],o=[{type:this._chartType,radius:[n?"50%":"40%","70%"],universalTransition:!0,name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.energy_usage"),itemStyle:{borderRadius:"bar"===this._chartType?[0,4,4,0]:4},data:a,barWidth:n?10:20,cursor:"default",minShowLabelAngle:15,label:"pie"===this._chartType?{formatter:({name:t})=>this._getDeviceName(t),overflow:"break",alignTo:this._isMobile?"edge":"none",edgeDistance:1}:void 0,labelLine:{length2:10}}];n&&o.push({type:this._chartType,radius:["30%","50%"],universalTransition:!0,name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.previous_energy_usage"),itemStyle:{borderRadius:"bar"===this._chartType?[0,4,4,0]:4},data:s,barWidth:10,cursor:"default",label:"pie"===this._chartType?{show:!1}:void 0,emphasis:"pie"===this._chartType?{focus:"series",blurScope:"global"}:void 0});const r=getComputedStyle(this);this._compoundStats=t.prefs.device_consumption.map(t=>t.included_in_stat).filter(Boolean);const c=t.prefs.device_consumption,l={};c.forEach(t=>{l[t.stat_consumption]=t.stat_consumption in i&&(0,g.$j)(i[t.stat_consumption])||0});const d={};if(n&&c.forEach(t=>{d[t.stat_consumption]=t.stat_consumption in n&&(0,g.$j)(n[t.stat_consumption])||0}),c.forEach((t,e)=>{var i;let o=l[t.stat_consumption];if(null!==(i=this._config)&&void 0!==i&&i.hide_compound_stats){if(this._compoundStats.includes(t.stat_consumption))return}else{const e=c.reduce((e,i)=>i.included_in_stat===t.stat_consumption?e+l[i.stat_consumption]:e,0);o-=Math.min(o,e)}const h=(0,u.fI)(e,r);if(a.push({id:t.stat_consumption,value:[o,t.stat_consumption],name:t.stat_consumption,itemStyle:{color:h+"7F",borderColor:h}}),n){let e=t.stat_consumption in n&&(0,g.$j)(n[t.stat_consumption])||0;const i=c.reduce((e,i)=>i.included_in_stat===t.stat_consumption?e+d[i.stat_consumption]:e,0);e-=Math.min(e,i),s.push({id:t.stat_consumption,value:[e,t.stat_consumption],name:t.stat_consumption,itemStyle:{color:h+"32",borderColor:h+"7F"}})}}),"pie"===this._chartType){const e=a,{summedData:i,compareSummedData:c}=(0,p.gv)(t),{consumption:l,compareConsumption:d}=(0,p.DR)(i,c),u=l.total.used_total,_="from_grid"in i||"solar"in i||"from_battery"in i?u-e.reduce((t,e)=>t+e.value[0],0):0;if(_>0){const t=(0,S.g)(r,this.hass.themes.darkMode,!1,!1,"--history-unknown-color");if(e.push({id:"untracked",value:[_,"untracked"],name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.untracked_consumption"),itemStyle:{color:t+"7F",borderColor:t}}),n){const e=d.total.used_total-s.reduce((t,e)=>t+e.value[0],0);e>0&&s.push({id:"untracked",value:[e,"untracked"],name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.untracked_consumption"),itemStyle:{color:t+"32",borderColor:t+"7F"}})}}const g=e.reduce((t,e)=>this._hiddenStats.includes(e.id)?t:t+e.value[0],0);o.push({type:"pie",radius:["0%",n?"30%":"40%"],name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_graph.total_energy_usage"),data:[g],label:{show:!0,position:"center",color:r.getPropertyValue("--secondary-text-color"),fontSize:r.getPropertyValue("--ha-font-size-m"),lineHeight:24,fontWeight:"bold",formatter:`{a}\n${(0,h.ZV)(g,this.hass.locale)} kWh`},cursor:"default",itemStyle:{color:"rgba(0, 0, 0, 0)"},tooltip:{show:!1}})}a.sort((t,e)=>e.value[0]-t.value[0]),null!==(e=this._config)&&void 0!==e&&e.max_devices&&a.length>this._config.max_devices&&a.splice(this._config.max_devices),this._legendData=a.map(t=>Object.assign(Object.assign({},t),{},{name:this._getDeviceName(t.name)}));for(let u=a.length-1;u>=0;u--)this._hiddenStats.includes(a[u].id)&&a.splice(u,1);n&&(o[1].data=a.map(t=>s.find(e=>e.id===t.id))),this._chartData=o,await this.updateComplete}_handleChartClick(t){var e;if("axisLabel"===t.detail.targetType&&t.detail.value&&!(0,g.OQ)(t.detail.value))(0,y.r)(this,"hass-more-info",{entityId:t.detail.value});else if("pie"===t.detail.seriesType&&"tspan"===(null===(e=t.detail.event)||void 0===e||null===(e=e.target)||void 0===e?void 0:e.type)){const e=t.detail.data.id;"untracked"!==e&&(0,y.r)(this,"hass-more-info",{entityId:e})}}_handleChartTypeChange(){if(!this._chartType)return;const t=this._getAllowedModes(),e=(t.indexOf(this._chartType)+1)%t.length;this._chartType=t[e],this._getStatistics(this._data)}_datasetHidden(t){this._hiddenStats=[...this._hiddenStats,t.detail.id],this._getStatistics(this._data)}_datasetUnhidden(t){this._hiddenStats=this._hiddenStats.filter(e=>e!==t.detail.id),this._getStatistics(this._data)}constructor(...t){super(...t),this._chartData=[],this._legendData=[],this._hiddenStats=[],this._isMobile=!1,this._compoundStats=[],this.hassSubscribeRequiredHostProps=["_config"],this._createOptions=(0,c.A)((t,e,i)=>{const n={grid:{top:5,left:5,right:40,bottom:0,containLabel:!0},tooltip:{show:!0,formatter:this._renderTooltip.bind(this)},xAxis:{show:!1},yAxis:{show:!1},legend:{type:"custom",show:!1}};var a,s;"bar"===e?(n.xAxis={show:!0,type:"value",name:"kWh",axisPointer:{show:!1}},n.yAxis={show:!0,type:"category",inverse:!0,triggerEvent:!0,data:null===(a=t[0])||void 0===a||null===(a=a.data)||void 0===a?void 0:a.map(t=>t.name),axisLabel:{formatter:this._getDeviceName.bind(this),overflow:"truncate",fontSize:12,margin:5,width:Math.min(this._isMobile?100:200,Math.max(...(null===(s=t[0])||void 0===s||null===(s=s.data)||void 0===s?void 0:s.map(t=>(0,v.W)(this._getDeviceName(t.name),12)+5))||[]))}}):n.legend={type:"custom",show:!0,data:i,selected:i.filter(t=>t.id&&this._hiddenStats.includes(t.id)).reduce((t,e)=>(t[e.id]=!1,t),{})};return n})}}M.styles=(0,s.AH)(T||(T=D`.card-header{display:flex;justify-content:space-between;align-items:center;padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}ha-chart-base{--chart-max-height:none}ha-icon-button{transform:rotate(90deg);color:var(--secondary-text-color);cursor:pointer}`)),(0,a.Cg)([(0,o.MZ)({attribute:!1})],M.prototype,"hass",void 0),(0,a.Cg)([(0,o.wk)()],M.prototype,"_config",void 0),(0,a.Cg)([(0,o.wk)()],M.prototype,"_chartData",void 0),(0,a.Cg)([(0,o.wk)()],M.prototype,"_data",void 0),(0,a.Cg)([(0,o.wk)()],M.prototype,"_legendData",void 0),(0,a.Cg)([(0,o.wk)(),(0,w.I)({key:"energy-devices-graph-chart-type",state:!0,subscribe:!1})],M.prototype,"_chartType",void 0),(0,a.Cg)([(0,o.wk)(),(0,w.I)({key:"energy-devices-pie-hidden-stats",state:!0,subscribe:!1})],M.prototype,"_hiddenStats",void 0),(0,a.Cg)([(0,o.wk)()],M.prototype,"_isMobile",void 0),M=(0,a.Cg)([(0,o.EM)("hui-energy-devices-graph-card")],M),n()}catch(C){n(C)}})},3461:function(t,e,i){let n;function a(t,e,i="Roboto, Noto, sans-serif"){n||(n=document.createElement("canvas"));const a=n.getContext("2d");if(!a)return 0;a.font=`${e}px ${i}`;const s=a.measureText(t);return Math.ceil(Math.max(s.actualBoundingBoxRight+s.actualBoundingBoxLeft,s.width))}i.d(e,{W:function(){return a}})}}]);
//# sourceMappingURL=48102.4ace1b5866968bcd.js.map