"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["66471"],{90433:function(t,a,e){e.d(a,{Vy:function(){return n},fI:function(){return i},ux:function(){return c}});var r=e(22786),o=e(79468);const s=54;function n(t,a){const e=t%s+1;return a.getPropertyValue(`--color-${e}`)}function i(t,a){const e=a.getPropertyValue(`--graph-color-${t+1}`)||n(t,a);return(0,o.RQ)(e)}const c=(0,r.A)(t=>Array.from({length:s},(a,e)=>i(e,t)),(t,a)=>t[0].getPropertyValue("--graph-color-1")===a[0].getPropertyValue("--graph-color-1")&&t[0].getPropertyValue("--color-1")===a[0].getPropertyValue("--color-1"))},40235:function(t,a,e){e.a(t,async function(t,r){try{e.r(a),e.d(a,{HuiPowerSourcesGraphCard:function(){return S}});e(44114),e(72712),e(18111),e(7588),e(61701),e(18237),e(13579),e(3362),e(62953);var o=e(40445),s=e(73684),n=e(83309),i=e(40600),c=e(81859),h=e(96196),l=e(77845),u=e(94333),d=e(22786),p=e(71578),g=e(44439),f=(e(76776),e(38114)),y=e(54706),_=e(784),v=e(97372),b=e(79468),m=t([g,f,v]);[g,f,v]=m.then?(await m)():m;let w,$,D,k,C=t=>t;class S extends((0,y.E)(h.WF)){hassSubscribe(){var t;return[(0,f.tb)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe(t=>this._getStatistics(t))]}getCardSize(){return 3}setConfig(t){this._config=t}shouldUpdate(t){return(0,_.xP)(this,t)||t.size>1||!t.has("hass")}render(){return this.hass&&this._config?(0,h.qy)(w||(w=C` <ha-card> ${0} <div class="content ${0}"> <ha-chart-base .hass="${0}" .data="${0}" .options="${0}"></ha-chart-base> ${0} </div> </ha-card> `),this._config.title?(0,h.qy)($||($=C`<h1 class="card-header">${0}</h1>`),this._config.title):"",(0,u.H)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd,this._legendData),this._chartData.some(t=>t.data.length)?h.s6:(0,h.qy)(D||(D=C`<div class="no-data"> ${0} </div>`),(0,s.c)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period"))):h.s6}async _getStatistics(t){var a;const e=[];this._legendData=[];const r={solar:{stats:[],color:"--energy-solar-color",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.solar")},grid:{stats:[],color:"--energy-grid-consumption-color",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.grid")},battery:{stats:[],color:"--energy-battery-out-color",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.battery")}},o=getComputedStyle(this);for(const n of t.prefs.energy_sources)"solar"!==n.type?"battery"!==n.type?"grid"===n.type&&n.power&&r.grid.stats.push(...n.power.map(t=>t.stat_rate)):n.stat_rate&&r.battery.stats.push(n.stat_rate):n.stat_rate&&r.solar.stats.push(n.stat_rate);const s={type:"line",smooth:.4,smoothMonotone:"x",lineStyle:{width:1}},c=Date.now();Object.keys(r).forEach((a,i)=>{if(r[a].stats.length){const h=o.getPropertyValue(r[a].color),l=(0,b.xp)(h),{positive:u,negative:d}=this._processData(r[a].stats.map(a=>{var e;const r=null!==(e=t.stats[a])&&void 0!==e?e:[];if((0,n.r)(c,this._start)&&(0,n.r)(c,this._end)){const t=(0,f.h4)(this.hass.states[a]);void 0!==t&&r.push({start:c,end:c,mean:t/1e3})}return r}));e.push(Object.assign(Object.assign({},s),{},{id:a,name:r[a].name,color:h,stack:"positive",areaStyle:{color:new p.LinearGradient(0,0,0,1,[{offset:0,color:`rgba(${l[0]}, ${l[1]}, ${l[2]}, 0.75)`},{offset:1,color:`rgba(${l[0]}, ${l[1]}, ${l[2]}, 0.25)`}])},data:u,z:3-i})),"solar"!==a&&e.push(Object.assign(Object.assign({},s),{},{id:`${a}-negative`,name:r[a].name,color:h,stack:"negative",areaStyle:{color:new p.LinearGradient(0,1,0,0,[{offset:0,color:`rgba(${l[0]}, ${l[1]}, ${l[2]}, 0.75)`},{offset:1,color:`rgba(${l[0]}, ${l[1]}, ${l[2]}, 0.25)`}])},data:d,z:4-i})),this._legendData.push({id:a,secondaryIds:"solar"!==a?[`${a}-negative`]:[],name:r[a].name,itemStyle:{color:`rgba(${l[0]}, ${l[1]}, ${l[2]}, 0.75)`,borderColor:h}})}}),this._start=t.start,this._end=t.end||(0,i.o)(),this._chartData=(0,v.JR)(e);const h=[];null===(a=this._chartData[0])||void 0===a||a.data.forEach((t,a)=>{const e="object"==typeof t&&"value"in t?t.value[0]:t[0];h[a]=[e,0],this._chartData.forEach(t=>{const e="object"==typeof t.data[a]&&"value"in t.data[a]?t.data[a].value[1]:t.data[a][1];h[a][1]+=e})}),this._chartData.push(Object.assign(Object.assign({},s),{},{id:"usage",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.usage"),color:o.getPropertyValue("--primary-text-color"),lineStyle:{type:[7,2],width:1.5},data:h,z:5})),this._legendData.push({id:"usage",name:this.hass.localize("ui.panel.lovelace.cards.energy.power_graph.usage"),itemStyle:{color:o.getPropertyValue("--primary-text-color")}})}_processData(t){const a={};t.forEach(t=>{t.forEach(t=>{var e;if(null==t.mean)return;const r=(t.start+t.end)/2;a[r]=[...null!==(e=a[r])&&void 0!==e?e:[],t.mean]})});const e=[],r=[];return Object.entries(a).forEach(([t,a])=>{const o=Number(t),s=a.reduce((t,a)=>t+a,0);e.push([o,Math.max(0,s)]),r.push([o,Math.min(0,s)])}),{positive:e,negative:r}}constructor(...t){super(...t),this._chartData=[],this._start=(0,c.R)(),this._end=(0,i.o)(),this.hassSubscribeRequiredHostProps=["_config"],this._createOptions=(0,d.A)((t,a,e,r,o,s,n)=>{var i;return Object.assign(Object.assign({},(0,v.od)(t,a,e,r,"kW",o,s,void 0,!0)),{},{legend:{show:!1!==(null===(i=this._config)||void 0===i?void 0:i.show_legend),type:"custom",data:n}})})}}S.styles=(0,h.AH)(k||(k=C`ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:var(--ha-space-4)}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:var(--ha-space-8);margin-inline-start:var(--ha-space-8);margin-inline-end:initial;box-sizing:border-box}`)),(0,o.Cg)([(0,l.MZ)({attribute:!1})],S.prototype,"hass",void 0),(0,o.Cg)([(0,l.wk)()],S.prototype,"_config",void 0),(0,o.Cg)([(0,l.wk)()],S.prototype,"_chartData",void 0),(0,o.Cg)([(0,l.wk)()],S.prototype,"_legendData",void 0),(0,o.Cg)([(0,l.wk)()],S.prototype,"_start",void 0),(0,o.Cg)([(0,l.wk)()],S.prototype,"_end",void 0),(0,o.Cg)([(0,l.wk)()],S.prototype,"_compareStart",void 0),(0,o.Cg)([(0,l.wk)()],S.prototype,"_compareEnd",void 0),S=(0,o.Cg)([(0,l.EM)("hui-power-sources-graph-card")],S),r()}catch(w){r(w)}})},71578:function(t,a,e){e.r(a),e.d(a,{LinearGradient:function(){return b.A}});var r=e(88648),o=e(59126),s=e(25636),n=e(2403),i=e(3650),c=e(30137),h=e(69913),l=e(43401),u=e(87370),d=e(57610),p=e(44390),g=e(11069),f=e(88132),y=e(6036),_=e(88298),v=e(15490),b=e(67665);r.Y([s.a,n.a,i.a,c.a,h.a,l.a,u.a,d.a,p.a,g.a,y._,_.i,v.a,f.a]),a.default=o},43382:function(t,a,e){e.d(a,{A:function(){return o}});var r=e(51039);function o(t){return(0,r.w)(t,Date.now())}},6116:function(t,a,e){e.d(a,{o:function(){return s}});var r=e(6439),o=e(83339);function s(t,a,e){const s=(0,o.b)(t,a)/6e4;return(0,r.u)(null==e?void 0:e.roundingMethod)(s)}},40600:function(t,a,e){e.d(a,{o:function(){return o}});var r=e(73983);function o(t){return(0,r.D)(Date.now(),t)}},83309:function(t,a,e){e.d(a,{r:function(){return s}});e(62953);var r=e(74816),o=e(35932);function s(t,a,e){const[s,n]=(0,r.x)(null==e?void 0:e.in,t,a);return+(0,o.o)(s)===+(0,o.o)(n)}},73684:function(t,a,e){e.d(a,{c:function(){return n}});var r=e(51039),o=e(43382),s=e(83309);function n(t,a){return(0,s.r)((0,r.w)((null==a?void 0:a.in)||t,t),(0,o.A)((null==a?void 0:a.in)||t))}},81859:function(t,a,e){e.d(a,{R:function(){return o}});var r=e(35932);function o(t){return(0,r.o)(Date.now(),t)}}}]);
//# sourceMappingURL=66471.1b70bfbb0938adf2.js.map