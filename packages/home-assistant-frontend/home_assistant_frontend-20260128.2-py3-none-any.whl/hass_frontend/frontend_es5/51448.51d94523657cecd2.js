"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["51448"],{31157:function(t,s,e){e.a(t,async function(t,i){try{e.r(s),e.d(s,{HaNumberSelector:function(){return g}});e(62953);var a=e(40445),o=e(96196),n=e(77845),l=e(94333),h=e(1087),r=(e(3449),e(70759)),u=(e(75709),t([r]));r=(u.then?(await u)():u)[0];let c,d,m,p,_,v=t=>t;class g extends o.WF{willUpdate(t){t.has("value")&&(""!==this._valueStr&&this.value===Number(this._valueStr)||(this._valueStr=null==this.value||isNaN(this.value)?"":this.value.toString()))}render(){var t,s,e,i,a,n,h,r,u,_,g,f,b,$;const x="box"===(null===(t=this.selector.number)||void 0===t?void 0:t.mode)||void 0===(null===(s=this.selector.number)||void 0===s?void 0:s.min)||void 0===(null===(e=this.selector.number)||void 0===e?void 0:e.max);let y;var w;if(!x&&(y=null!==(w=this.selector.number.step)&&void 0!==w?w:1,"any"===y)){y=1;const t=(this.selector.number.max-this.selector.number.min)/100;for(;y>t;)y/=10}const S=null===(i=this.selector.number)||void 0===i?void 0:i.translation_key;let C=null===(a=this.selector.number)||void 0===a?void 0:a.unit_of_measurement;return x&&C&&this.localizeValue&&S&&(C=this.localizeValue(`${S}.unit_of_measurement.${C}`)||C),(0,o.qy)(c||(c=v` ${0} <div class="input"> ${0} <ha-textfield .inputMode="${0}" .label="${0}" .placeholder="${0}" class="${0}" .min="${0}" .max="${0}" .value="${0}" .step="${0}" helperPersistent .helper="${0}" .disabled="${0}" .required="${0}" .suffix="${0}" type="number" autoValidate ?no-spinner="${0}" @input="${0}"> </ha-textfield> </div> ${0} `),this.label&&!x?(0,o.qy)(d||(d=v`${0}${0}`),this.label,this.required?"*":""):o.s6,x?o.s6:(0,o.qy)(m||(m=v` <ha-slider labeled .min="${0}" .max="${0}" .value="${0}" .step="${0}" .disabled="${0}" .required="${0}" @change="${0}" .withMarkers="${0}"> </ha-slider> `),this.selector.number.min,this.selector.number.max,this.value,y,this.disabled,this.required,this._handleSliderChange,(null===(n=this.selector.number)||void 0===n?void 0:n.slider_ticks)||!1),"any"===(null===(h=this.selector.number)||void 0===h?void 0:h.step)||(null!==(r=null===(u=this.selector.number)||void 0===u?void 0:u.step)&&void 0!==r?r:1)%1!=0?"decimal":"numeric",x?this.label:void 0,this.placeholder,(0,l.H)({single:x}),null===(_=this.selector.number)||void 0===_?void 0:_.min,null===(g=this.selector.number)||void 0===g?void 0:g.max,null!==(f=this._valueStr)&&void 0!==f?f:"",null!==(b=null===($=this.selector.number)||void 0===$?void 0:$.step)&&void 0!==b?b:1,x?this.helper:void 0,this.disabled,this.required,C,!x,this._handleInputChange,!x&&this.helper?(0,o.qy)(p||(p=v`<ha-input-helper-text .disabled="${0}">${0}</ha-input-helper-text>`),this.disabled,this.helper):o.s6)}_handleInputChange(t){t.stopPropagation(),this._valueStr=t.target.value;const s=""===t.target.value||isNaN(t.target.value)?void 0:Number(t.target.value);this.value!==s&&(0,h.r)(this,"value-changed",{value:s})}_handleSliderChange(t){t.stopPropagation();const s=Number(t.target.value);this.value!==s&&(0,h.r)(this,"value-changed",{value:s})}constructor(...t){super(...t),this.required=!0,this.disabled=!1,this._valueStr=""}}g.styles=(0,o.AH)(_||(_=v`.input{display:flex;justify-content:space-between;align-items:center;direction:ltr}ha-slider{flex:1;margin-right:16px;margin-inline-end:16px;margin-inline-start:0}ha-textfield{--ha-textfield-input-width:40px}.single{--ha-textfield-input-width:unset;flex:1}`)),(0,a.Cg)([(0,n.MZ)({attribute:!1})],g.prototype,"hass",void 0),(0,a.Cg)([(0,n.MZ)({attribute:!1})],g.prototype,"selector",void 0),(0,a.Cg)([(0,n.MZ)({type:Number})],g.prototype,"value",void 0),(0,a.Cg)([(0,n.MZ)({type:Number})],g.prototype,"placeholder",void 0),(0,a.Cg)([(0,n.MZ)()],g.prototype,"label",void 0),(0,a.Cg)([(0,n.MZ)()],g.prototype,"helper",void 0),(0,a.Cg)([(0,n.MZ)({attribute:!1})],g.prototype,"localizeValue",void 0),(0,a.Cg)([(0,n.MZ)({type:Boolean})],g.prototype,"required",void 0),(0,a.Cg)([(0,n.MZ)({type:Boolean})],g.prototype,"disabled",void 0),g=(0,a.Cg)([(0,n.EM)("ha-selector-number")],g),i()}catch(c){i(c)}})},19691:function(t,s,e){e.a(t,async function(t,i){try{e.r(s),e.d(s,{DialogStatisticsFixUnsupportedUnitMetadata:function(){return k}});e(44114),e(26910),e(18111),e(7588),e(3362),e(27495),e(25440),e(62953);var a=e(40445),o=e(76331),n=e(96196),l=e(77845),h=e(22786),r=e(95747),u=e(1087),c=e(65829),d=(e(72554),e(18350)),m=(e(52763),e(43661),e(28732),e(39045)),p=e(31157),_=(e(67094),e(23528)),v=e(65063),g=e(14503),f=e(81619),b=t([c,d,m,p,r,_]);[c,d,m,p,r,_]=b.then?(await b)():b;let $,x,y,w,S,C,M,z,j=t=>t;class k extends n.WF{showDialog(t){this._params=t;const s=new Date;s.setMinutes(s.getMinutes()-s.getMinutes()%5,0),this._moment=(0,o.s)(s),this._fetchStats()}closeDialog(){this._params=void 0,this._moment=void 0,this._stats5min=void 0,this._statsHour=void 0,this._origAmount=void 0,this._amount=void 0,this._chosenStat=void 0,this._busy=!1,(0,u.r)(this,"dialog-closed",{dialog:this.localName})}render(){if(!this._params)return n.s6;let t;return t=this._chosenStat?this._renderAdjustStat():this._renderPickStatistic(),(0,n.qy)($||($=j` <ha-dialog open scrimClickAction escapeKeyAction @closed="${0}" .heading="${0}"> ${0} </ha-dialog> `),this.closeDialog,this.hass.localize("ui.panel.config.developer-tools.tabs.statistics.fix_issue.adjust_sum.title"),t)}shouldUpdate(t){if(1!==t.size||!t.has("hass"))return!0;const s=t.get("hass");return!s||s.localize!==this.hass.localize}_renderPickStatistic(){let t;if(this._stats5min&&this._statsHour)if(this._statsHour.length<1&&this._stats5min.length<1)t=(0,n.qy)(y||(y=j`<p> ${0} </p>`),this.hass.localize("ui.panel.config.developer-tools.tabs.statistics.fix_issue.adjust_sum.no_statistics_found"));else{const s=this._stats5min.length>=1?this._stats5min:this._statsHour,e=(0,_.JE)(this.hass,this._params.statistic.statistic_id,this._params.statistic),i=[];for(const t of s){const s=Math.round(100*t.change)/100;i.push((0,n.qy)(w||(w=j` <ha-list-item twoline hasMeta .stat="${0}" @click="${0}"> <span>${0} ${0}</span> <span slot="secondary"> ${0} </span> <ha-icon-next slot="meta"></ha-icon-next> </ha-list-item> `),t,this._setChosenStatistic,s,e,(0,r.r6)(new Date(t.start),this.hass.locale,this.hass.config)))}t=(0,n.qy)(S||(S=j`${0}`),i)}else t=(0,n.qy)(x||(x=j`<ha-spinner></ha-spinner>`));return(0,n.qy)(C||(C=j` <div class="text-content"> ${0} </div> <div class="text-content"> <b>${0}</b> ${0} </div> <ha-selector-datetime .label="${0}" .hass="${0}" .selector="${0}" .value="${0}" @value-changed="${0}"></ha-selector-datetime> <div class="stat-list">${0}</div> <ha-button appearance="plain" slot="secondaryAction" @click="${0}"> ${0} </ha-button> <ha-button slot="primaryAction" dialogAction="cancel"> ${0} </ha-button> `),this.hass.localize("ui.panel.config.developer-tools.tabs.statistics.fix_issue.adjust_sum.info_text_1"),this.hass.localize("ui.panel.config.developer-tools.tabs.statistics.fix_issue.adjust_sum.statistic"),this._params.statistic.statistic_id,this.hass.localize("ui.panel.config.developer-tools.tabs.statistics.fix_issue.adjust_sum.pick_a_time"),this.hass,this._dateTimeSelector,this._moment,this._dateTimeSelectorChanged,t,this._fetchOutliers,this.hass.localize("ui.panel.config.developer-tools.tabs.statistics.fix_issue.adjust_sum.outliers"),this.hass.localize("ui.common.close"))}_clearChosenStatistic(){this._chosenStat=void 0}_setChosenStatistic(t){const s=t.currentTarget.stat,e=Math.round(100*s.change)/100;this._chosenStat=s,this._origAmount=e,this._amount=e}_dateTimeSelectorChanged(t){this._moment=t.detail.value,this._fetchStats()}_renderAdjustStat(){const t=(0,_.JE)(this.hass,this._params.statistic.statistic_id,this._params.statistic);return(0,n.qy)(M||(M=j` <div class="text-content"> <b>${0}</b> ${0} </div> <div class="table-row"> <span>${0}</span> <span>${0}</span> </div> <div class="table-row"> <span>${0}</span> <span>${0}</span> </div> <ha-selector-number .label="${0}" .hass="${0}" .selector="${0}" .value="${0}" .disabled="${0}" @value-changed="${0}"></ha-selector-number> <ha-button slot="secondaryAction" .disabled="${0}" @click="${0}" appearance="plain"> ${0}</ha-button> <ha-button slot="primaryAction" .disabled="${0}" @click="${0}"> ${0}</ha-button> `),this.hass.localize("ui.panel.config.developer-tools.tabs.statistics.fix_issue.adjust_sum.statistic"),this._params.statistic.statistic_id,this.hass.localize("ui.panel.config.developer-tools.tabs.statistics.fix_issue.adjust_sum.start"),(0,r.r6)(new Date(this._chosenStat.start),this.hass.locale,this.hass.config),this.hass.localize("ui.panel.config.developer-tools.tabs.statistics.fix_issue.adjust_sum.end"),(0,r.r6)(new Date(this._chosenStat.end),this.hass.locale,this.hass.config),this.hass.localize("ui.panel.config.developer-tools.tabs.statistics.fix_issue.adjust_sum.new_value"),this.hass,this._amountSelector(t||void 0),this._amount,this._busy,this._amountChanged,this._busy,this._clearChosenStatistic,this.hass.localize("ui.common.back"),this._busy,this._fixIssue,this.hass.localize("ui.panel.config.developer-tools.tabs.statistics.fix_issue.adjust_sum.adjust"))}_amountChanged(t){this._amount=t.detail.value}async _fetchStats(){this._stats5min=void 0,this._statsHour=void 0;const t=this._params.statistic.statistic_id,s=new Date(this._moment.replace(" ","T")),e=new Date(s.getTime());e.setTime(e.getTime()-72e5);const i=new Date(s.getTime());i.setTime(i.getTime()+108e5);const a=await(0,_.sz)(this.hass,e,i,[t],"hour");if(this._statsHour=t in a?a[t].slice(0,5):[],0===this._statsHour.length)return void(this._stats5min=[]);const o=new Date(s.getTime());o.setTime(o.getTime()-6e5);const n=new Date(s.getTime());n.setTime(n.getTime()+9e5);const l=await(0,_.sz)(this.hass,o,n,[t],"5minute");this._stats5min=t in l?l[t].slice(0,5):[]}async _fetchOutliers(){this._stats5min=void 0,this._statsHour=void 0;const t=this._params.statistic.statistic_id,s=new Date(0),e=new Date,i=await(0,_.sz)(this.hass,s,e,[t],"hour"),a=t in i?i[t]:[];if(0===a.length)return;const o=await(0,_.sz)(this.hass,s,e,[t],"5minute"),n=t in o?o[t]:[];n.shift();const l=[];a.forEach(t=>{l.push({hour:t,fiveMin:[]})});const h={hour:null,fiveMin:[]};let r=0;n.forEach(t=>{let s=!1;for(;r<l.length;r++){const e=l[r].hour;if(e&&t.start>=e.start&&t.end<=e.end){l[r].fiveMin.push(t),s=!0;break}}s||h.fiveMin.push(t)}),l.push(h);let u=[],c=0;const d=t=>{var s;const e=Math.abs(null!==(s=t.change)&&void 0!==s?s:0);var i;(u.length<10||e>c)&&(u.push(t),u=u.sort((t,s)=>{var e,i;return Math.abs(null!==(e=s.change)&&void 0!==e?e:0)-Math.abs(null!==(i=t.change)&&void 0!==i?i:0)}),u=u.slice(0,10),c=null!==(i=u[u.length-1].change)&&void 0!==i?i:0)};l.forEach(t=>{0===t.fiveMin.length&&t.hour?d(t.hour):t.fiveMin.forEach(t=>{d(t)})}),this._statsHour=u,this._stats5min=[]}async _fixIssue(){const t=(0,_.JE)(this.hass,this._params.statistic.statistic_id,this._params.statistic);this._busy=!0;try{await(0,_.Uf)(this.hass,this._params.statistic.statistic_id,this._chosenStat.start,this._amount-this._origAmount,t||null)}catch(s){return this._busy=!1,void(0,v.showAlertDialog)(this,{text:this.hass.localize("ui.panel.config.developer-tools.tabs.statistics.fix_issue.adjust_sum.error_sum_adjusted",{message:s.message||s})})}(0,f.P)(this,{message:this.hass.localize("ui.panel.config.developer-tools.tabs.statistics.fix_issue.adjust_sum.sum_adjusted")}),this.closeDialog()}static get styles(){return[g.RF,g.nA,(0,n.AH)(z||(z=j`@media all and (max-width:450px),all and (max-height:500px){ha-dialog{--mdc-dialog-max-height:100%;height:100%}}@media all and (min-width:850px){ha-dialog{--mdc-dialog-max-height:80%;--mdc-dialog-max-height:80%}}@media all and (min-width:451px) and (min-height:501px){ha-dialog{--mdc-dialog-max-width:480px}}.text-content,ha-selector-datetime,ha-selector-number{margin-bottom:var(--ha-space-5)}ha-list-item{margin:0 -24px;--mdc-list-side-padding:24px}.table-row{display:flex;justify-content:space-between;margin-bottom:var(--ha-space-5)}.stat-list{min-height:360px;display:flex;flex-direction:column}.stat-list ha-spinner{margin:0 auto}`))]}constructor(...t){super(...t),this._busy=!1,this._dateTimeSelector={datetime:{}},this._amountSelector=(0,h.A)(t=>({number:{step:.01,unit_of_measurement:t,mode:"box"}}))}}(0,a.Cg)([(0,l.MZ)({attribute:!1})],k.prototype,"hass",void 0),(0,a.Cg)([(0,l.wk)()],k.prototype,"_params",void 0),(0,a.Cg)([(0,l.wk)()],k.prototype,"_busy",void 0),(0,a.Cg)([(0,l.wk)()],k.prototype,"_moment",void 0),(0,a.Cg)([(0,l.wk)()],k.prototype,"_stats5min",void 0),(0,a.Cg)([(0,l.wk)()],k.prototype,"_statsHour",void 0),(0,a.Cg)([(0,l.wk)()],k.prototype,"_chosenStat",void 0),(0,a.Cg)([(0,l.wk)()],k.prototype,"_amount",void 0),k=(0,a.Cg)([(0,l.EM)("dialog-statistics-adjust-sum")],k),i()}catch($){i($)}})},43332:function(t,s,e){function i(t,s){return(t<0?"-":"")+Math.abs(t).toString().padStart(s,"0")}e.d(s,{F:function(){return i}})},76331:function(t,s,e){e.d(s,{s:function(){return n}});e(16280);var i=e(43332),a=e(94864),o=e(83504);function n(t,s){var e,n;const l=(0,o.a)(t,null==s?void 0:s.in);if(!(0,a.f)(l))throw new RangeError("Invalid time value");const h=null!==(e=null==s?void 0:s.format)&&void 0!==e?e:"extended",r=null!==(n=null==s?void 0:s.representation)&&void 0!==n?n:"complete";let u="";const c="extended"===h?"-":"",d="extended"===h?":":"";if("time"!==r){const t=(0,i.F)(l.getDate(),2),s=(0,i.F)(l.getMonth()+1,2);u=`${(0,i.F)(l.getFullYear(),4)}${c}${s}${c}${t}`}if("date"!==r){u=`${u}${""===u?"":" "}${(0,i.F)(l.getHours(),2)}${d}${(0,i.F)(l.getMinutes(),2)}${d}${(0,i.F)(l.getSeconds(),2)}`}return u}},94864:function(t,s,e){function i(t){return t instanceof Date||"object"==typeof t&&"[object Date]"===Object.prototype.toString.call(t)}e.d(s,{f:function(){return o}});var a=e(83504);function o(t){return!(!i(t)&&"number"!=typeof t||isNaN(+(0,a.a)(t)))}}}]);
//# sourceMappingURL=51448.51d94523657cecd2.js.map