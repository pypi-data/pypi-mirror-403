"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["75268"],{90433:function(e,t,r){r.d(t,{Vy:function(){return o},fI:function(){return n},ux:function(){return c}});var a=r(22786),i=r(79468);const s=54;function o(e,t){const r=e%s+1;return t.getPropertyValue(`--color-${r}`)}function n(e,t){const r=t.getPropertyValue(`--graph-color-${e+1}`)||o(e,t);return(0,i.RQ)(r)}const c=(0,a.A)(e=>Array.from({length:s},(t,r)=>n(r,e)),(e,t)=>e[0].getPropertyValue("--graph-color-1")===t[0].getPropertyValue("--graph-color-1")&&e[0].getPropertyValue("--color-1")===t[0].getPropertyValue("--color-1"))},46279:function(e,t,r){r(62953);var a=r(40445),i=r(96196),s=r(77845),o=r(14503);r(67094);let n,c,h,l,d,p,g=e=>e;class u extends i.WF{render(){return(0,i.qy)(n||(n=g` <div class="timeline-start"> ${0} ${0} </div> <div class="content"> <slot></slot> ${0} </div> `),this.label?"":(0,i.qy)(c||(c=g` <ha-svg-icon .path="${0}"></ha-svg-icon> `),this.icon||"M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"),this.lastItem?"":(0,i.qy)(h||(h=g`<div class="line"></div>`)),this.moreItems?(0,i.qy)(l||(l=g` <div> ${0} </div> `),this._showMore||1===this.moreItems.length?this.moreItems:(0,i.qy)(d||(d=g` <button class="link" @click="${0}"> Show ${0} more items </button> `),this._handleShowMore,this.moreItems.length)):"")}_handleShowMore(){this._showMore=!0}static get styles(){return[(0,i.AH)(p||(p=g`:host{display:flex;flex-direction:row}:host(:not([lastItem])){min-height:50px}:host([label]){margin-top:-8px;font-style:italic;color:var(--timeline-label-color,var(--secondary-text-color))}.timeline-start{display:flex;flex-direction:column;align-items:center;margin-right:8px;margin-inline-end:8px;margin-inline-start:initial;width:24px}:host([not-enabled]) ha-svg-icon{opacity:.5}ha-svg-icon{color:var(--timeline-ball-color,var(--timeline-color,var(--secondary-text-color)));border-radius:var(--ha-border-radius-circle)}:host([raised]) ha-svg-icon{transform:scale(1.3)}.line{flex:1;width:2px;background-color:var(--timeline-line-color,var(--timeline-color,var(--secondary-text-color)));margin:4px 0}.content{margin-top:2px}:host(:not([lastItem])) .content{padding-bottom:16px}:host([label]) .content{margin-top:0;padding-top:6px}`)),o.og]}constructor(...e){super(...e),this.label=!1,this.raised=!1,this.notEnabled=!1,this.lastItem=!1,this._showMore=!1}}(0,a.Cg)([(0,s.MZ)({type:Boolean,reflect:!0})],u.prototype,"label",void 0),(0,a.Cg)([(0,s.MZ)({type:Boolean,reflect:!0})],u.prototype,"raised",void 0),(0,a.Cg)([(0,s.MZ)({attribute:"not-enabled",reflect:!0,type:Boolean})],u.prototype,"notEnabled",void 0),(0,a.Cg)([(0,s.MZ)({attribute:"last-item",type:Boolean})],u.prototype,"lastItem",void 0),(0,a.Cg)([(0,s.MZ)({type:String})],u.prototype,"icon",void 0),(0,a.Cg)([(0,s.MZ)({attribute:!1})],u.prototype,"moreItems",void 0),(0,a.Cg)([(0,s.wk)()],u.prototype,"_showMore",void 0),u=(0,a.Cg)([(0,s.EM)("ha-timeline")],u)},98920:function(e,t,r){r.a(e,async function(e,t){try{r(39202);var a=r(40445),i=r(53289),s=r(96196),o=r(77845),n=r(15717),c=(r(26300),e([n]));n=(c.then?(await c)():c)[0];let h,l=e=>e;class d extends s.WF{render(){return(0,s.qy)(h||(h=l` <ha-code-editor .value="${0}" .hass="${0}" read-only dir="ltr"></ha-code-editor> `),(0,i.dump)(this.trace.blueprint_inputs||"").trimRight(),this.hass)}}(0,a.Cg)([(0,o.MZ)({attribute:!1})],d.prototype,"hass",void 0),(0,a.Cg)([(0,o.MZ)({attribute:!1})],d.prototype,"trace",void 0),d=(0,a.Cg)([(0,o.EM)("ha-trace-blueprint-config")],d),t()}catch(h){t(h)}})},7370:function(e,t,r){r.a(e,async function(e,t){try{r(39202);var a=r(40445),i=r(53289),s=r(96196),o=r(77845),n=r(15717),c=(r(26300),e([n]));n=(c.then?(await c)():c)[0];let h,l,d=e=>e;class p extends s.WF{render(){return(0,s.qy)(h||(h=d` <ha-code-editor .value="${0}" .hass="${0}" read-only dir="ltr"></ha-code-editor> `),(0,i.dump)(this.trace.config).trimRight(),this.hass)}static get styles(){return[(0,s.AH)(l||(l=d``))]}}(0,a.Cg)([(0,o.MZ)({attribute:!1})],p.prototype,"hass",void 0),(0,a.Cg)([(0,o.MZ)({attribute:!1})],p.prototype,"trace",void 0),p=(0,a.Cg)([(0,o.EM)("ha-trace-config")],p),t()}catch(h){t(h)}})},193:function(e,t,r){r.a(e,async function(e,t){try{r(62953);var a=r(40445),i=r(96196),s=r(77845),o=(r(67146),r(11184)),n=e([o]);o=(n.then?(await n)():n)[0];let c,h,l,d=e=>e;class p extends i.WF{render(){return this.logbookEntries.length?(0,i.qy)(c||(c=d` <ha-logbook-renderer relative-time .hass="${0}" .entries="${0}" .narrow="${0}"></ha-logbook-renderer> <hat-logbook-note .hass="${0}" .domain="${0}"></hat-logbook-note> `),this.hass,this.logbookEntries,this.narrow,this.hass,this.trace.domain):(0,i.qy)(h||(h=d`<div class="padded-box"> No Logbook entries found for this step. </div>`))}static get styles(){return[(0,i.AH)(l||(l=d`.padded-box{padding:16px}`))]}constructor(...e){super(...e),this.narrow=!1}}(0,a.Cg)([(0,s.MZ)({attribute:!1})],p.prototype,"hass",void 0),(0,a.Cg)([(0,s.MZ)({type:Boolean,reflect:!0})],p.prototype,"narrow",void 0),(0,a.Cg)([(0,s.MZ)({attribute:!1})],p.prototype,"trace",void 0),(0,a.Cg)([(0,s.MZ)({attribute:!1})],p.prototype,"logbookEntries",void 0),p=(0,a.Cg)([(0,s.EM)("ha-trace-logbook")],p),t()}catch(c){t(c)}})},29804:function(e,t,r){r.a(e,async function(e,t){try{var a=r(20054),i=(r(74423),r(44114),r(18111),r(61701),r(39202),r(62953),r(40445)),s=r(16527),o=r(53289),n=r(96196),c=r(77845),h=r(94333),l=r(95747),d=r(79800),p=r(38911),g=r(45464),u=r(63625),v=r(11184),m=r(15717),b=(r(26300),r(67146),r(44104)),$=e([v,m,g,d,l]);[v,m,g,d,l]=$.then?(await $)():$;const f=["path","timestamp","result","error","changed_variables"];let y,_,k,x,C,M,H,V,L,w,q,A,N,E,I,Z,P,R,z,T,F,S,W,D,O,B,j=e=>e;const J=["step_config","changed_variables","logbook"];class U extends n.WF{render(){return(0,n.qy)(y||(y=j` <div class="padded-box trace-info"> ${0} </div> <div class="tabs top"> ${0} </div> ${0} `),this._renderSelectedTraceInfo(),J.map(e=>(0,n.qy)(_||(_=j` <button .view="${0}" class="${0}" @click="${0}"> ${0} </button> `),e,(0,h.H)({active:this._view===e}),this._showTab,this.hass.localize(`ui.panel.config.automation.trace.tabs.${e}`))),"step_config"===this._view?this._renderSelectedConfig():"changed_variables"===this._view?this._renderChangedVars():this._renderLogbook())}_renderSelectedTraceInfo(){var e;const t=this.trace.trace;if(null===(e=this.selected)||void 0===e||!e.path)return this.hass.localize("ui.panel.config.automation.trace.path.choose");const r=this.selected.path.split("/");if("default"===r[r.length-1]){var i;const e=t[r.slice(0,r.length-1).join("/")];if(e&&"default"===(null===(i=e[0])||void 0===i||null===(i=i.result)||void 0===i?void 0:i.choice))return this.hass.localize("ui.panel.config.automation.trace.path.default_action_executed")}if(!(this.selected.path in t))return this.hass.localize("ui.panel.config.automation.trace.path.no_further_execution");const s=[];let c=!1;for(const h of Object.keys(this.trace.trace)){if(c){if(h in this.renderedNodes)break}else{if(h!==this.selected.path)continue;c=!0}const e=t[h],i=h.substring(this.selected.path.length+1).split("/");let p=this.selected.config;for(const t of i)["undefined","string"].includes(typeof p[t])||(p=p[t]);s.push(e.map((t,i)=>{const{path:s,timestamp:c,result:u,error:v,changed_variables:m}=t,b=(0,a.A)(t,f);if(!1===(null==u?void 0:u.enabled))return(0,n.qy)(k||(k=j`${0}`),this.hass.localize("ui.panel.config.automation.trace.path.disabled_step"));const $=this.selected.type;return(0,n.qy)(x||(x=j` ${0} ${0} ${0} ${0} <br> ${0} ${0} ${0} ${0} `),h===this.selected.path?p.alias?(0,n.qy)(C||(C=j`<h2>${0}</h2>`),p.alias):"trigger"===$?(0,n.qy)(M||(M=j`<h2> ${0} </h2>`),(0,d.g)(p,this.hass,this._entityReg)):"condition"===$?(0,n.qy)(H||(H=j`<h2> ${0} </h2>`),(0,d.p)(p,this.hass,this._entityReg)):"action"===$?(0,n.qy)(V||(V=j`<h2> ${0} </h2>`),(0,g.u)(this.hass,this._entityReg,p)):"chooseOption"===$?(0,n.qy)(L||(L=j`<h2> ${0} </h2>`),this.hass.localize("ui.panel.config.automation.editor.actions.type.choose.option",{number:r[r.length-1]})):n.s6:(0,n.qy)(w||(w=j`<h2> ${0} </h2>`),h.substring(this.selected.path.length+1)),1===e.length?n.s6:(0,n.qy)(q||(q=j`<h3> ${0} </h3>`),this.hass.localize("ui.panel.config.automation.trace.path.iteration",{number:i+1})),h.substring(this.selected.path.length+1).includes("condition")?(0,n.qy)(A||(A=j`[${0}]<br>`),(0,d.p)(p,this.hass,this._entityReg)):n.s6,this.hass.localize("ui.panel.config.automation.trace.path.executed",{time:(0,l.yg)(new Date(c),this.hass.locale,this.hass.config)}),v?(0,n.qy)(N||(N=j`<div class="error"> ${0} </div>`),this.hass.localize("ui.panel.config.automation.trace.path.error",{error:v})):n.s6,u?(0,n.qy)(E||(E=j`${0} <pre>${0}</pre>`),this.hass.localize("ui.panel.config.automation.trace.path.result"),(0,o.dump)(u)):n.s6,0===Object.keys(b).length?n.s6:(0,n.qy)(I||(I=j`<pre>${0}</pre>`),(0,o.dump)(b)),p.entity_id&&h.substring(this.selected.path.length+1).includes("entity_id")?(0,n.qy)(Z||(Z=j`<pre>entity: ${0}</pre>`),p.entity_id):n.s6)}))}return s}_renderSelectedConfig(){var e;if(null===(e=this.selected)||void 0===e||!e.path)return n.s6;const t=(0,u.Ci)(this.trace.config,this.selected.path);return t?(0,n.qy)(P||(P=j`<ha-code-editor .value="${0}" .hass="${0}" read-only dir="ltr"></ha-code-editor>`),(0,o.dump)(t).trimEnd(),this.hass):this.hass.localize("ui.panel.config.automation.trace.path.unable_to_find_config")}_renderChangedVars(){const e=this.trace.trace[this.selected.path];return void 0===e?(0,n.qy)(R||(R=j`<div class="padded-box"> ${0} </div>`),this.hass.localize("ui.panel.config.automation.trace.path.step_not_executed")):(0,n.qy)(z||(z=j` <div class="padded-box"> ${0} </div> `),e.map((t,r)=>(0,n.qy)(T||(T=j` ${0} ${0} `),e.length>1?(0,n.qy)(F||(F=j`<p> ${0} </p>`),this.hass.localize("ui.panel.config.automation.trace.path.iteration",{number:r+1})):"",0===Object.keys(t.changed_variables||{}).length?this.hass.localize("ui.panel.config.automation.trace.path.no_variables_changed"):(0,n.qy)(S||(S=j`<pre>${0}</pre>`),(0,o.dump)(t.changed_variables).trimEnd()))))}_renderLogbook(){const e=this.trace.trace,t=e[this.selected.path],r=Object.keys(this.trackedNodes),a=r.indexOf(this.selected.path);if(-1===a)return(0,n.qy)(W||(W=j`<div class="padded-box"> ${0} </div>`),this.hass.localize("ui.panel.config.automation.trace.path.step_not_executed"));let i;if(a===r.length-1){const e=new Date(t[0].timestamp),r=this.logbookEntries.findIndex(t=>new Date(1e3*t.when)>=e);i=-1===r?[]:this.logbookEntries.slice(r)}else{const s=e[r[a+1]],o=new Date(t[0].timestamp),n=new Date(s[0].timestamp);i=[];for(const e of this.logbookEntries||[]){const t=new Date(1e3*e.when);if(t>=o){if(!(t<n))break;i.push(e)}}}return i.length?(0,n.qy)(D||(D=j` <ha-logbook-renderer relative-time .hass="${0}" .entries="${0}" .narrow="${0}"></ha-logbook-renderer> <hat-logbook-note .hass="${0}" .domain="${0}"></hat-logbook-note> `),this.hass,i,this.narrow,this.hass,this.trace.domain):(0,n.qy)(O||(O=j`<div class="padded-box"> ${0} </div>`),this.hass.localize("ui.panel.config.automation.trace.path.no_logbook_entries"))}_showTab(e){this._view=e.target.view}static get styles(){return[b.h,(0,n.AH)(B||(B=j`.padded-box{margin:16px}:host(:not([narrow])) .trace-info{min-height:250px}pre{margin:0}.error{color:var(--error-color)}`))]}constructor(...e){super(...e),this.narrow=!1,this.renderedNodes={},this._view="step_config"}}(0,i.Cg)([(0,c.MZ)({attribute:!1})],U.prototype,"hass",void 0),(0,i.Cg)([(0,c.MZ)({type:Boolean,reflect:!0})],U.prototype,"narrow",void 0),(0,i.Cg)([(0,c.MZ)({attribute:!1})],U.prototype,"trace",void 0),(0,i.Cg)([(0,c.MZ)({attribute:!1})],U.prototype,"logbookEntries",void 0),(0,i.Cg)([(0,c.MZ)({attribute:!1})],U.prototype,"selected",void 0),(0,i.Cg)([(0,c.MZ)({attribute:!1})],U.prototype,"renderedNodes",void 0),(0,i.Cg)([(0,c.MZ)({attribute:!1})],U.prototype,"trackedNodes",void 0),(0,i.Cg)([(0,c.wk)()],U.prototype,"_view",void 0),(0,i.Cg)([(0,c.wk)(),(0,s.Fg)({context:p.ih,subscribe:!0})],U.prototype,"_entityReg",void 0),(0,i.Cg)([(0,c.wk)(),(0,s.Fg)({context:p.HD,subscribe:!0})],U.prototype,"_labelReg",void 0),U=(0,i.Cg)([(0,c.EM)("ha-trace-path-details")],U),t()}catch(f){t(f)}})},73003:function(e,t,r){r.a(e,async function(e,t){try{var a=r(40445),i=r(96196),s=r(77845),o=(r(67146),r(91819)),n=e([o]);o=(n.then?(await n)():n)[0];let c,h,l=e=>e;class d extends i.WF{render(){return(0,i.qy)(c||(c=l` <hat-trace-timeline .hass="${0}" .trace="${0}" .logbookEntries="${0}" .selectedPath="${0}" allow-pick> </hat-trace-timeline> <hat-logbook-note .hass="${0}" .domain="${0}"></hat-logbook-note> `),this.hass,this.trace,this.logbookEntries,this.selected.path,this.hass,this.trace.domain)}static get styles(){return[(0,i.AH)(h||(h=l`:host{display:block;padding:16px}`))]}}(0,a.Cg)([(0,s.MZ)({attribute:!1})],d.prototype,"hass",void 0),(0,a.Cg)([(0,s.MZ)({attribute:!1})],d.prototype,"trace",void 0),(0,a.Cg)([(0,s.MZ)({attribute:!1})],d.prototype,"logbookEntries",void 0),(0,a.Cg)([(0,s.MZ)({attribute:!1})],d.prototype,"selected",void 0),d=(0,a.Cg)([(0,s.EM)("ha-trace-timeline")],d),t()}catch(c){t(c)}})},2271:function(e,t,r){r(44114),r(26910),r(18111),r(7588),r(61701),r(62953);var a=r(40445),i=r(96196),s=r(77845),o=r(94333);let n,c,h,l,d,p,g,u=e=>e;class v extends i.WF{_updateBranches(e){let t=0;const r=[],a=[];e.target.assignedElements().forEach(e=>{const i=e.clientWidth,s=e.clientHeight;a.push({x:i/2+t,height:s,start:e.hasAttribute("graph-start"),end:e.hasAttribute("graph-end"),track:e.hasAttribute("track")}),t+=i,r.push(s)}),this._totalWidth=t,this._maxHeight=Math.max(...r),this._branches=a.sort((e,t)=>e.track&&!t.track?1:e.track&&t.track?0:-1)}render(){return(0,i.qy)(n||(n=u` <slot name="head"></slot> ${0} <div id="branches"> <svg id="lines" width="${0}" height="${0}"> ${0} </svg> <slot @slotchange="${0}"></slot> </div> ${0} `),this.start?i.s6:(0,i.qy)(c||(c=u` <svg id="top" width="${0}"> ${0} </svg> `),this._totalWidth,this._branches.map(e=>e.start?"":(0,i.JW)(h||(h=u` <path class="${0}" d="
                      M ${0} 0
                      L ${0} ${0}
                      "/> `),(0,o.H)({track:e.track}),this._totalWidth/2,e.x,20))),this._totalWidth,this._maxHeight,this._branches.map(e=>e.end?"":(0,i.JW)(l||(l=u` <path class="${0}" d="
                        M ${0} ${0}
                        v ${0}
                        "/> `),(0,o.H)({track:e.track}),e.x,e.height,this._maxHeight-e.height)),this._updateBranches,this.short?i.s6:(0,i.qy)(d||(d=u` <svg id="bottom" width="${0}"> ${0} </svg> `),this._totalWidth,this._branches.map(e=>e.end?"":(0,i.JW)(p||(p=u` <path class="${0}" d="
                      M ${0} 0
                      V ${0}
                      L ${0} ${0}
                      "/> `),(0,o.H)({track:e.track}),e.x,10,this._totalWidth/2,30))))}constructor(...e){super(...e),this.disabled=!1,this.selected=!1,this.start=!1,this.short=!1,this._branches=[],this._totalWidth=0,this._maxHeight=0}}v.styles=(0,i.AH)(g||(g=u`:host{position:relative;display:flex;flex-direction:column;align-items:center}:host(:focus){outline:0}#branches{position:relative;display:flex;flex-direction:row;align-items:start}::slotted(*){z-index:1}::slotted([slot=head]){margin-bottom:calc(var(--hat-graph-branch-height)/ -2)}#lines{position:absolute}#top{height:var(--hat-graph-branch-height)}#bottom{height:calc(var(--hat-graph-branch-height) + var(--hat-graph-spacing))}path{stroke:var(--stroke-clr);stroke-width:2;fill:none}path.track{stroke:var(--track-clr)}:host([disabled]) path{stroke:var(--disabled-clr)}`)),(0,a.Cg)([(0,s.MZ)({type:Boolean,reflect:!0})],v.prototype,"disabled",void 0),(0,a.Cg)([(0,s.MZ)({type:Boolean})],v.prototype,"selected",void 0),(0,a.Cg)([(0,s.MZ)({type:Boolean})],v.prototype,"start",void 0),(0,a.Cg)([(0,s.MZ)({type:Boolean})],v.prototype,"short",void 0),(0,a.Cg)([(0,s.wk)()],v.prototype,"_branches",void 0),v=(0,a.Cg)([(0,s.EM)("hat-graph-branch")],v)},74091:function(e,t,r){r(62953);var a=r(40445),i=r(96196),s=r(77845),o=r(37177);let n,c,h,l,d,p,g,u=e=>e;class v extends i.WF{updated(e){e.has("noFocus")&&(this.hasAttribute("tabindex")||this.noFocus?void 0!==e.get("noFocus")&&this.noFocus&&this.removeAttribute("tabindex"):this.setAttribute("tabindex","0"))}render(){const e=30+(this.graphStart?2:11);return(0,i.qy)(n||(n=u` <svg class="${0}" width="${0}px" height="${0}px" viewBox="-${0} -${0} ${0} ${0}"> ${0} <g class="node"> <circle cx="0" cy="0" r="${0}"/> ${0} ${0} <g style="pointer-events:none" transform="translate(-12 -12)"> ${0} </g> </g> </svg> `),o.n?"safari":"",40,e,Math.ceil(20),this.graphStart?Math.ceil(e/2):Math.ceil(25),40,e,this.graphStart?i.s6:(0,i.JW)(c||(c=u` <path class="connector" d="
              M 0 ${0}
              L 0 0
            " line-caps="round"/> `),-25),15,this.error?(0,i.JW)(h||(h=u` <g class="error"> <circle cx="-12" cy="${0}" r="8"></circle> <path transform="translate(-18 -21) scale(.5)" class="exclamation" d="${0}/"> </path></g> `),-15,"M10 3H14V14H10V3M10 21V17H14V21H10Z"):i.s6,this.badge?(0,i.JW)(l||(l=u` <g class="number"> <circle cx="12" cy="${0}" r="8"></circle> <text x="12" y="${0}" text-anchor="middle" alignment-baseline="middle">${0}</text> </g> `),-15,-15,this.badge>9?"9+":this.badge):i.s6,this.iconPath?(0,i.JW)(d||(d=u`<path class="icon" d="${0}/"></path>`),this.iconPath):(0,i.JW)(p||(p=u`<foreignObject><span class="icon"><slot name="icon"></slot></span></foreignObject>`)))}constructor(...e){super(...e),this.disabled=!1,this.error=!1,this.notEnabled=!1,this.graphStart=!1,this.noFocus=!1}}v.styles=(0,i.AH)(g||(g=u`:host{display:flex;flex-direction:column;min-width:calc(var(--hat-graph-node-size) + var(--hat-graph-spacing));height:calc(var(--hat-graph-node-size) + var(--hat-graph-spacing) + 1px)}:host([graph-start]){height:calc(var(--hat-graph-node-size) + 2px)}:host([track]){--stroke-clr:var(--track-clr);--icon-clr:var(--default-icon-clr)}:host([active]) circle{--stroke-clr:var(--active-clr);--icon-clr:var(--default-icon-clr)}:host(:focus){outline:0}:host(:hover) circle{--stroke-clr:var(--hover-clr);--icon-clr:var(--default-icon-clr)}:host([not-enabled]) circle{--stroke-clr:var(--disabled-clr)}:host([not-enabled][active]) circle{--stroke-clr:var(--disabled-active-clr)}:host([not-enabled]:hover) circle{--stroke-clr:var(--disabled-hover-clr)}svg:not(.safari){width:100%;height:100%}circle,path.connector{stroke:var(--stroke-clr);stroke-width:2;fill:none}circle{fill:var(--background-clr);stroke:var(--circle-clr,var(--stroke-clr))}.error circle{fill:var(--error-color);stroke:none;stroke-width:0}.error .exclamation{fill:var(--text-primary-color)}.number circle{fill:var(--track-clr);stroke:none;stroke-width:0}.number text{font-size:var(--ha-font-size-xs);fill:var(--text-primary-color)}path.icon{fill:var(--icon-clr)}foreignObject{width:24px;height:24px}.icon{color:var(--icon-clr)}`)),(0,a.Cg)([(0,s.MZ)({attribute:!1})],v.prototype,"iconPath",void 0),(0,a.Cg)([(0,s.MZ)({type:Boolean,reflect:!0})],v.prototype,"disabled",void 0),(0,a.Cg)([(0,s.MZ)({type:Boolean})],v.prototype,"error",void 0),(0,a.Cg)([(0,s.MZ)({attribute:"not-enabled",reflect:!0,type:Boolean})],v.prototype,"notEnabled",void 0),(0,a.Cg)([(0,s.MZ)({attribute:"graph-start",reflect:!0,type:Boolean})],v.prototype,"graphStart",void 0),(0,a.Cg)([(0,s.MZ)({type:Boolean,attribute:"nofocus"})],v.prototype,"noFocus",void 0),(0,a.Cg)([(0,s.MZ)({reflect:!0,type:Number})],v.prototype,"badge",void 0),v=(0,a.Cg)([(0,s.EM)("hat-graph-node")],v)},3903:function(e,t,r){r(62953);var a=r(40445),i=r(96196),s=r(77845);let o,n,c=e=>e;class h extends i.WF{render(){return(0,i.qy)(o||(o=c` <svg viewBox="-${0} 0 10 ${0}"> <path d="
              M 0 ${0}
              V 0
            " line-caps="round"/> } </svg> `),5,41,41)}constructor(...e){super(...e),this.disabled=!1}}h.styles=(0,i.AH)(n||(n=c`:host{display:flex;flex-direction:column;align-items:center}svg{width:var(--hat-graph-spacing);height:calc(var(--hat-graph-spacing) + var(--hat-graph-node-size) + 1px)}:host([track]){--stroke-clr:var(--track-clr)}:host-context([disabled]){--stroke-clr:var(--disabled-clr)}path{stroke:var(--stroke-clr);stroke-width:2;fill:none}`)),(0,a.Cg)([(0,s.MZ)({reflect:!0,type:Boolean})],h.prototype,"disabled",void 0),h=(0,a.Cg)([(0,s.EM)("hat-graph-spacer")],h)},67146:function(e,t,r){r(62953);var a=r(40445),i=r(96196),s=r(77845);let o;class n extends i.WF{render(){return"script"===this.domain?this.hass.localize("ui.panel.config.automation.trace.messages.not_all_entries_are_related_script_note"):this.hass.localize("ui.panel.config.automation.trace.messages.not_all_entries_are_related_automation_note")}constructor(...e){super(...e),this.domain="automation"}}n.styles=(0,i.AH)(o||(o=(e=>e)`:host{display:block;text-align:center;font-style:italic;padding:16px;margin-top:8px}`)),(0,a.Cg)([(0,s.MZ)({attribute:!1})],n.prototype,"hass",void 0),(0,a.Cg)([(0,s.MZ)()],n.prototype,"domain",void 0),n=(0,a.Cg)([(0,s.EM)("hat-logbook-note")],n)},68886:function(e,t,r){r.a(e,async function(e,t){try{r(74423),r(26910),r(18111),r(20116),r(61701),r(13579),r(62953);var a=r(40445),i=r(96196),s=r(77845),o=r(44537),n=r(1087),c=r(88249),h=r(84025),l=(r(26300),r(65329)),d=(r(2271),r(74091),r(3903),r(30780)),p=e([l]);l=(p.then?(await p)():p)[0];let g,u,v,m,b,$,f,y,_,k,x,C,M,H,V,L,w,q,A,N,E,I,Z=e=>e;const P="M4 2A2 2 0 0 0 2 4V12H4V8H6V12H8V4A2 2 0 0 0 6 2H4M4 4H6V6H4M22 15.5V14A2 2 0 0 0 20 12H16V22H20A2 2 0 0 0 22 20V18.5A1.54 1.54 0 0 0 20.5 17A1.54 1.54 0 0 0 22 15.5M20 20H18V18H20V20M20 16H18V14H20M5.79 21.61L4.21 20.39L18.21 2.39L19.79 3.61Z",R="M11,5H8L12,1L16,5H13V9.43C12.25,9.89 11.58,10.46 11,11.12V5M22,11L18,7V10C14.39,9.85 11.31,12.57 11,16.17C9.44,16.72 8.62,18.44 9.17,20C9.72,21.56 11.44,22.38 13,21.83C14.56,21.27 15.38,19.56 14.83,18C14.53,17.14 13.85,16.47 13,16.17C13.47,12.17 17.47,11.97 17.95,11.97V14.97L22,11M10.63,11.59C9.3,10.57 7.67,10 6,10V7L2,11L6,15V12C7.34,12.03 8.63,12.5 9.64,13.4C9.89,12.76 10.22,12.15 10.63,11.59Z",z="M13,20H11V8L5.5,13.5L4.08,12.08L12,4.16L19.92,12.08L18.5,13.5L13,8V20Z",T="M21 13H14.4L19.1 17.7L17.7 19.1L13 14.4V21H11V14.3L6.3 19L4.9 17.6L9.4 13H3V11H9.6L4.9 6.3L6.3 4.9L11 9.6V3H13V9.4L17.6 4.8L19 6.3L14.3 11H21V13Z",F="M19.59,7L12,14.59L6.41,9H11V7H3V15H5V10.41L12,17.41L21,8.41",S="M20,5.41L18.59,4L7,15.59V9H5V19H15V17H8.41",W="M14,4L16.29,6.29L13.41,9.17L14.83,10.59L17.71,7.71L20,10V4M10,4H4V10L6.29,7.71L11,12.41V20H13V11.59L7.71,6.29",D="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,5V19H5V5H19Z",O="M19,19H5V5H15V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V11H19M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z",B="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z",j="M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z",J="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z",U="M8,3A2,2 0 0,0 6,5V9A2,2 0 0,1 4,11H3V13H4A2,2 0 0,1 6,15V19A2,2 0 0,0 8,21H10V19H8V14A2,2 0 0,0 6,12A2,2 0 0,0 8,10V5H10V3M16,3A2,2 0 0,1 18,5V9A2,2 0 0,0 20,11H21V13H20A2,2 0 0,0 18,15V19A2,2 0 0,1 16,21H14V19H16V14A2,2 0 0,1 18,12A2,2 0 0,1 16,10V5H14V3H16Z",K="M15,4V6H18V18H15V20H20V4M4,4V20H9V18H6V6H9V4H4Z",Q="M7,13V11H21V13H7M7,19V17H21V19H7M7,7V5H21V7H7M3,8V5H2V4H4V8H3M2,17V16H5V20H2V19H4V18.5H3V17.5H4V17H2M4.25,10A0.75,0.75 0 0,1 5,10.75C5,10.95 4.92,11.14 4.79,11.27L3.12,13H5V14H2V13.08L4,11H2V10H4.25Z",G="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z",X="M12,5A2,2 0 0,1 14,7C14,7.24 13.96,7.47 13.88,7.69C17.95,8.5 21,11.91 21,16H3C3,11.91 6.05,8.5 10.12,7.69C10.04,7.47 10,7.24 10,7A2,2 0 0,1 12,5M22,19H2V17H22V19Z",Y="M16,4.5V7H5V9H16V11.5L19.5,8M16,12.5V15H5V17H16V19.5L19.5,16";class ee extends i.WF{_selectNode(e,t,r){return()=>{(0,n.r)(this,"graph-node-selected",{config:e,path:t,type:r})}}_renderTrigger(e,t){var r;const a=`trigger/${t}`,s=this.trace&&a in this.trace.trace;return this.renderedNodes[a]={config:e,path:a,type:"trigger"},s&&(this.trackedNodes[a]=this.renderedNodes[a]),(0,i.qy)(g||(g=Z` <hat-graph-node graph-start ?track="${0}" @focus="${0}" ?active="${0}" .iconPath="${0}" .notEnabled="${0}" .error="${0}" tabindex="${0}"></hat-graph-node> `),s,this._selectNode(e,a,"trigger"),this.selected===a,T,"enabled"in e&&!1===e.enabled,null===(r=this.trace.trace[a])||void 0===r?void 0:r.some(e=>e.error),s?"0":"-1")}_renderCondition(e,t){const r=`condition/${t}`;return this.renderedNodes[r]={config:e,path:r,type:"condition"},this.trace&&r in this.trace.trace&&(this.trackedNodes[r]=this.renderedNodes[r]),this._renderConditionNode(e,r)}_renderActionNode(e,t,r=!1,a=!1){const i=Object.keys(this._typeRenderers).find(t=>t in e)||"other";return this.renderedNodes[t]={config:e,path:t,type:"action"},this.trace&&t in this.trace.trace&&(this.trackedNodes[t]=this.renderedNodes[t]),this._typeRenderers[i].bind(this)(e,t,r,a)}_renderChooseNode(e,t,r=!1,a=!1){var s,n,c;const h=this.trace.trace[t],l=h?h.map(e=>void 0===e.result||"default"===e.result.choice?"default":e.result.choice):[],d=l.includes("default");return(0,i.qy)(u||(u=Z` <hat-graph-branch tabindex="${0}" @focus="${0}" ?track="${0}" ?active="${0}" .notEnabled="${0}"> <hat-graph-node .graphStart="${0}" .iconPath="${0}" ?track="${0}" ?active="${0}" .notEnabled="${0}" .error="${0}" slot="head" nofocus></hat-graph-node> ${0} <div ?track="${0}"> <hat-graph-spacer ?track="${0}"></hat-graph-spacer> ${0} </div> </hat-graph-branch> `),void 0===h?"-1":"0",this._selectNode(e,t,"action"),void 0!==h,this.selected===t,a||!1===e.enabled,r,R,void 0!==h,this.selected===t,a||!1===e.enabled,null===(s=this.trace.trace[t])||void 0===s?void 0:s.some(e=>e.error),e.choose?null===(n=(0,o.e)(e.choose))||void 0===n?void 0:n.map((r,s)=>{const n=`${t}/choose/${s}`,c=l.includes(s);return this.renderedNodes[n]={config:r,path:n,type:"chooseOption"},c&&(this.trackedNodes[n]=this.renderedNodes[n]),(0,i.qy)(v||(v=Z` <div class="graph-container" ?track="${0}"> <hat-graph-node .iconPath="${0}" @focus="${0}" ?track="${0}" ?active="${0}" .notEnabled="${0}"></hat-graph-node> ${0} </div> `),c,!h||c?O:D,this._selectNode(r,n,"chooseOption"),c,this.selected===n,a||!1===e.enabled,null!==r.sequence?(0,o.e)(r.sequence).map((t,r)=>this._renderActionNode(t,`${n}/sequence/${r}`,!1,a||!1===e.enabled)):"")}):"",d,d,null!==e.default?null===(c=(0,o.e)(e.default))||void 0===c?void 0:c.map((r,i)=>this._renderActionNode(r,`${t}/default/${i}`,!1,a||!1===e.enabled)):"")}_renderIfNode(e,t,r=!1,a=!1){var s;const n=this.trace.trace[t];let c=!1,h=!1;for(const i of n||[]){var l,d;if(c||"then"!==(null===(l=i.result)||void 0===l?void 0:l.choice)||(c=!0),(h||"else"!==(null===(d=i.result)||void 0===d?void 0:d.choice))&&i.result||(h=!0),h&&c)break}return(0,i.qy)(m||(m=Z` <hat-graph-branch tabindex="${0}" @focus="${0}" ?track="${0}" ?active="${0}" .notEnabled="${0}"> <hat-graph-node .graphStart="${0}" .iconPath="${0}" ?track="${0}" ?active="${0}" .notEnabled="${0}" slot="head" nofocus></hat-graph-node> ${0} <div class="graph-container" ?track="${0}"> <hat-graph-node .iconPath="${0}" ?track="${0}" ?active="${0}" .notEnabled="${0}" nofocus></hat-graph-node> ${0} </div> </hat-graph-branch> `),void 0===n?"-1":"0",this._selectNode(e,t,"action"),void 0!==n,this.selected===t,a||!1===e.enabled,r,W,void 0!==n,this.selected===t,a||!1===e.enabled,e.else?(0,i.qy)(b||(b=Z`<div class="graph-container" ?track="${0}"> <hat-graph-node .iconPath="${0}" ?track="${0}" ?active="${0}" .notEnabled="${0}" nofocus></hat-graph-node>${0} </div>`),h,F,h,this.selected===t,a||!1===e.enabled,(0,o.e)(e.else).map((r,i)=>this._renderActionNode(r,`${t}/else/${i}`,!1,a||!1===e.enabled))):(0,i.qy)($||($=Z`<hat-graph-spacer ?track="${0}"></hat-graph-spacer>`),h),c,S,c,this.selected===t,a||!1===e.enabled,(0,o.e)(null!==(s=e.then)&&void 0!==s?s:[]).map((r,i)=>this._renderActionNode(r,`${t}/then/${i}`,!1,a||!1===e.enabled)))}_renderConditionNode(e,t,r=!1,a=!1){const s=this.trace.trace[t];let o=!1,n=!1,c=!1;if(s)for(const i of s)if(i.result&&(o=!0,i.result.result?n=!0:c=!0),n&&c)break;return(0,i.qy)(f||(f=Z` <hat-graph-branch @focus="${0}" ?track="${0}" ?active="${0}" .notEnabled="${0}" tabindex="${0}" short> <hat-graph-node .graphStart="${0}" slot="head" ?track="${0}" ?active="${0}" .notEnabled="${0}" .iconPath="${0}" nofocus></hat-graph-node> <div style="${0}" graph-start graph-end></div> <div ?track="${0}"></div> <hat-graph-node .iconPath="${0}" nofocus ?track="${0}" ?active="${0}" .notEnabled="${0}"></hat-graph-node> </hat-graph-branch> `),this._selectNode(e,t,"condition"),o,this.selected===t,a||!1===e.enabled,void 0===s?"-1":"0",r,o,this.selected===t,a||!1===e.enabled,P,"width: 40px;",n,J,c,this.selected===t,a||!1===e.enabled)}_renderRepeatNode(e,t,r=!1,a=!1){var s;const n=this.trace.trace[t],c=null===(s=this.trace)||void 0===s||null===(s=s.trace[`${t}/repeat/sequence/0`])||void 0===s?void 0:s.length;return(0,i.qy)(y||(y=Z` <hat-graph-branch tabindex="${0}" @focus="${0}" ?track="${0}" ?active="${0}" .notEnabled="${0}"> <hat-graph-node .graphStart="${0}" .iconPath="${0}" ?track="${0}" ?active="${0}" .notEnabled="${0}" slot="head" nofocus></hat-graph-node> <hat-graph-node .iconPath="${0}" ?track="${0}" ?active="${0}" .notEnabled="${0}" nofocus .badge="${0}"></hat-graph-node> <div ?track="${0}"> ${0} </div> </hat-graph-branch> `),void 0===n?"-1":"0",this._selectNode(e,t,"action"),t in this.trace.trace,this.selected===t,a||!1===e.enabled,r,G,t in this.trace.trace,this.selected===t,a||!1===e.enabled,z,c>1,this.selected===t,a||!1===e.enabled,c>1?c:void 0,n,(0,o.e)(e.repeat.sequence).map((r,i)=>this._renderActionNode(r,`${t}/repeat/sequence/${i}`,!1,a||!1===e.enabled)))}_renderServiceNode(e,t,r=!1,a=!1){var s;return(0,i.qy)(_||(_=Z` <hat-graph-node .graphStart="${0}" .iconPath="${0}" @focus="${0}" ?track="${0}" ?active="${0}" .notEnabled="${0}" .error="${0}" tabindex="${0}"> ${0} </hat-graph-node> `),r,e.action?void 0:X,this._selectNode(e,t,"action"),t in this.trace.trace,this.selected===t,a||!1===e.enabled,null===(s=this.trace.trace[t])||void 0===s?void 0:s.some(e=>e.error),this.trace&&t in this.trace.trace?"0":"-1",e.action?(0,i.qy)(k||(k=Z`<ha-service-icon slot="icon" .hass="${0}" .service="${0}"></ha-service-icon>`),this.hass,e.action):i.s6)}_renderWaitNode(e,t,r=!1,a=!1){var s;return(0,i.qy)(x||(x=Z` <hat-graph-node .graphStart="${0}" .iconPath="${0}" @focus="${0}" ?track="${0}" ?active="${0}" .notEnabled="${0}" .error="${0}" tabindex="${0}"></hat-graph-node> `),r,U,this._selectNode(e,t,"action"),t in this.trace.trace,this.selected===t,a||!1===e.enabled,null===(s=this.trace.trace[t])||void 0===s?void 0:s.some(e=>e.error),this.trace&&t in this.trace.trace?"0":"-1")}_renderSequenceNode(e,t,r=!1,a=!1){const s=this.trace.trace[t];return(0,i.qy)(C||(C=Z` <hat-graph-branch tabindex="${0}" @focus="${0}" ?track="${0}" ?active="${0}" .notEnabled="${0}"> <div class="graph-container" ?track="${0}"> <hat-graph-node .graphStart="${0}" .iconPath="${0}" ?track="${0}" ?active="${0}" .notEnabled="${0}" slot="head" nofocus></hat-graph-node> ${0} </div> </hat-graph-branch> `),void 0===s?"-1":"0",this._selectNode(e,t,"action"),t in this.trace.trace,this.selected===t,a||!1===e.enabled,t in this.trace.trace,r,Q,t in this.trace.trace,this.selected===t,a||!1===e.enabled,(0,o.e)(e.sequence).map((r,i)=>this._renderActionNode(r,`${t}/sequence/${i}`,!1,a||!1===e.enabled)))}_renderParallelNode(e,t,r=!1,a=!1){const s=this.trace.trace[t];return(0,i.qy)(M||(M=Z` <hat-graph-branch tabindex="${0}" @focus="${0}" ?track="${0}" ?active="${0}" .notEnabled="${0}"> <hat-graph-node .graphStart="${0}" .iconPath="${0}" ?track="${0}" ?active="${0}" .notEnabled="${0}" slot="head" nofocus></hat-graph-node> ${0} </hat-graph-branch> `),void 0===s?"-1":"0",this._selectNode(e,t,"action"),t in this.trace.trace,this.selected===t,a||!1===e.enabled,r,Y,t in this.trace.trace,this.selected===t,a||!1===e.enabled,(0,o.e)(e.parallel).map((r,s)=>"sequence"in r?(0,i.qy)(H||(H=Z`<div ?track="${0}"> ${0} </div>`),t in this.trace.trace,(0,o.e)(r.sequence).map((r,i)=>this._renderActionNode(r,`${t}/parallel/${s}/sequence/${i}`,!1,a||!1===e.enabled))):this._renderActionNode(r,`${t}/parallel/${s}/sequence/0`,!1,a||!1===e.enabled)))}_renderOtherNode(e,t,r=!1,a=!1){var s;return(0,i.qy)(V||(V=Z` <hat-graph-node .graphStart="${0}" .iconPath="${0}" @focus="${0}" ?track="${0}" ?active="${0}" .error="${0}" .notEnabled="${0}"></hat-graph-node> `),r,d.O$[(0,h.pq)(e)]||K,this._selectNode(e,t,"action"),t in this.trace.trace,this.selected===t,null===(s=this.trace.trace[t])||void 0===s?void 0:s.some(e=>e.error),a||!1===e.enabled)}render(){const e="triggers"in this.trace.config?"triggers":"trigger",t="conditions"in this.trace.config?"conditions":"condition",r="actions"in this.trace.config?"actions":"action",a=Object.keys(this.trackedNodes),s=e in this.trace.config?(0,c.aI)((0,o.e)(this.trace.config[e])).map((e,t)=>this._renderTrigger(e,t)):void 0;try{var n;return(0,i.qy)(L||(L=Z` <div class="parent graph-container"> ${0} ${0} ${0} ${0} </div> <div class="actions"> <ha-icon-button .disabled="${0}" @click="${0}" .path="${0}"></ha-icon-button> <ha-icon-button .disabled="${0}" @click="${0}" .path="${0}"></ha-icon-button> </div> `),s?(0,i.qy)(w||(w=Z`<hat-graph-branch start .short="${0}"> ${0} </hat-graph-branch>`),s.length<2,s):"",t in this.trace.config?(0,i.qy)(q||(q=Z`${0}`),null===(n=(0,o.e)(this.trace.config[t]))||void 0===n?void 0:n.map((e,t)=>this._renderCondition(e,t))):"",r in this.trace.config?(0,i.qy)(A||(A=Z`${0}`),(0,o.e)(this.trace.config[r]).map((e,t)=>this._renderActionNode(e,`action/${t}`))):"","sequence"in this.trace.config?(0,i.qy)(N||(N=Z`${0}`),(0,o.e)(this.trace.config.sequence).map((e,t)=>this._renderActionNode(e,`sequence/${t}`,0===t))):"",0===a.length||a[0]===this.selected,this._previousTrackedNode,j,0===a.length||a[a.length-1]===this.selected,this._nextTrackedNode,B)}catch(h){return(0,i.qy)(E||(E=Z` <div class="error"> Error rendering graph. Please download trace and share with the developers. </div> `))}}willUpdate(e){super.willUpdate(e),e.has("trace")&&(this.renderedNodes={},this.trackedNodes={})}updated(e){if(super.updated(e),e.has("trace")){if(!this.selected||!(this.selected in this.trackedNodes)){const e=this.trackedNodes[Object.keys(this.trackedNodes)[0]];e&&(0,n.r)(this,"graph-node-selected",e)}if(this.trace){const e=Object.keys(this.trace.trace),t=Object.keys(this.renderedNodes).sort((t,r)=>e.indexOf(t)-e.indexOf(r)),r={},a={};for(const i of t)a[i]=this.renderedNodes[i],i in this.trackedNodes&&(r[i]=this.trackedNodes[i]);this.renderedNodes=a,this.trackedNodes=r}}}_previousTrackedNode(){const e=Object.keys(this.trackedNodes),t=e.indexOf(this.selected)-1;t>=0&&(0,n.r)(this,"graph-node-selected",this.trackedNodes[e[t]])}_nextTrackedNode(){const e=Object.keys(this.trackedNodes),t=e.indexOf(this.selected)+1;t<e.length&&(0,n.r)(this,"graph-node-selected",this.trackedNodes[e[t]])}static get styles(){return(0,i.AH)(I||(I=Z`:host{display:flex;--stroke-clr:var(--stroke-color, var(--secondary-text-color));--active-clr:var(--active-color, var(--primary-color));--track-clr:var(--track-color, var(--accent-color));--hover-clr:var(--hover-color, var(--primary-color));--disabled-clr:var(--disabled-color, var(--disabled-text-color));--disabled-active-clr:rgba(var(--rgb-primary-color), 0.5);--disabled-hover-clr:rgba(var(--rgb-primary-color), 0.7);--default-trigger-color:3,169,244;--rgb-trigger-color:var(--trigger-color, var(--default-trigger-color));--background-clr:var(--background-color, white);--default-icon-clr:var(--icon-color, black);--icon-clr:var(--stroke-clr);--hat-graph-spacing:${0}px;--hat-graph-node-size:${0}px;--hat-graph-branch-height:${0}px}.graph-container{display:flex;flex-direction:column;align-items:center}.actions{display:flex;flex-direction:column}.parent{margin-left:8px;margin-top:16px}.error{padding:16px;max-width:300px}`),10,30,20)}constructor(...e){super(...e),this.renderedNodes={},this.trackedNodes={},this._typeRenderers={condition:this._renderConditionNode,and:this._renderConditionNode,or:this._renderConditionNode,not:this._renderConditionNode,service:this._renderServiceNode,wait_template:this._renderWaitNode,wait_for_trigger:this._renderWaitNode,repeat:this._renderRepeatNode,choose:this._renderChooseNode,if:this._renderIfNode,sequence:this._renderSequenceNode,parallel:this._renderParallelNode,other:this._renderOtherNode}}}(0,a.Cg)([(0,s.MZ)({attribute:!1})],ee.prototype,"trace",void 0),(0,a.Cg)([(0,s.MZ)({attribute:!1})],ee.prototype,"selected",void 0),ee=(0,a.Cg)([(0,s.EM)("hat-script-graph")],ee),t()}catch(g){t(g)}})},91819:function(e,t,r){r.a(e,async function(e,t){try{r(89463),r(44114),r(18111),r(7588),r(27495),r(25440),r(62953);var a=r(40445),i=r(16527),s=r(96196),o=r(77845),n=r(32288),c=r(95747),h=r(98975),l=r(1087),d=r(17451),p=r(38911),g=r(84025),u=r(45464),v=r(63625),m=(r(46279),e([h,u,c]));[h,u,c]=m.then?(await m)():m;let b,$,f,y,_,k,x,C,M,H,V=e=>e;const L="M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z",w="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z",q="M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z",A="M13,2.03V2.05L13,4.05C17.39,4.59 20.5,8.58 19.96,12.97C19.5,16.61 16.64,19.5 13,19.93V21.93C18.5,21.38 22.5,16.5 21.95,11C21.5,6.25 17.73,2.5 13,2.03M11,2.06C9.05,2.25 7.19,3 5.67,4.26L7.1,5.74C8.22,4.84 9.57,4.26 11,4.06V2.06M4.26,5.67C3,7.19 2.25,9.04 2.05,11H4.05C4.24,9.58 4.8,8.23 5.69,7.1L4.26,5.67M2.06,13C2.26,14.96 3.03,16.81 4.27,18.33L5.69,16.9C4.81,15.77 4.24,14.42 4.06,13H2.06M7.1,18.37L5.67,19.74C7.18,21 9.04,21.79 11,22V20C9.58,19.82 8.23,19.25 7.1,18.37M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z",N="M13,2.03V2.05L13,4.05C17.39,4.59 20.5,8.58 19.96,12.97C19.5,16.61 16.64,19.5 13,19.93V21.93C18.5,21.38 22.5,16.5 21.95,11C21.5,6.25 17.73,2.5 13,2.03M11,2.06C9.05,2.25 7.19,3 5.67,4.26L7.1,5.74C8.22,4.84 9.57,4.26 11,4.06V2.06M4.26,5.67C3,7.19 2.25,9.04 2.05,11H4.05C4.24,9.58 4.8,8.23 5.69,7.1L4.26,5.67M2.06,13C2.26,14.96 3.03,16.81 4.27,18.33L5.69,16.9C4.81,15.77 4.24,14.42 4.06,13H2.06M7.1,18.37L5.67,19.74C7.18,21 9.04,21.79 11,22V20C9.58,19.82 8.23,19.25 7.1,18.37M16.82,15.19L12.71,11.08C13.12,10.04 12.89,8.82 12.03,7.97C11.13,7.06 9.78,6.88 8.69,7.38L10.63,9.32L9.28,10.68L7.29,8.73C6.75,9.82 7,11.17 7.88,12.08C8.74,12.94 9.96,13.16 11,12.76L15.11,16.86C15.29,17.05 15.56,17.05 15.74,16.86L16.78,15.83C17,15.65 17,15.33 16.82,15.19Z",E="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9Z",I=2,Z=1e3,P=(e,t)=>Math.abs(t.getTime()-e.getTime())>Z;class R{setLastReportedTime(e){this.lastReportedTime=e}renderTime(e,t){this.entries.push((0,s.qy)(b||(b=V` <ha-timeline label> ${0} later </ha-timeline> `),(0,h.K)(e,this.hass.locale,t,!1))),this.lastReportedTime=t}maybeRenderTime(e){return P(e,this.lastReportedTime)?(this.renderTime(this.lastReportedTime,e),!0):(this.lastReportedTime=e,!1)}constructor(e,t,r){this.hass=e,this.entries=t,this.lastReportedTime=new Date(r.timestamp.start)}}class z{get curItem(){return this.logbookEntries[this.curIndex]}get hasNext(){return this.curIndex<this.logbookEntries.length}maybeRenderItem(){const e=this.curItem;this.curIndex++;const t=new Date(1e3*e.when);if(0===this.pendingItems.length)return void this.pendingItems.push([t,e]);const r=this.pendingItems[this.pendingItems.length-1][0];P(r,t)&&(this._renderLogbookEntries(),this.timeTracker.renderTime(r,t)),this.pendingItems.push([t,e])}flush(){this.pendingItems.length>0&&this._renderLogbookEntries()}_renderLogbookEntries(){this.timeTracker.maybeRenderTime(this.pendingItems[0][0]);const e=[];let t,r;for(t=0;t<Math.min(this.pendingItems.length,I);t++)e.push(this._renderLogbookEntryHelper(this.pendingItems[t][1]));if(t<this.pendingItems.length)for(r=[];t<this.pendingItems.length;t++)r.push(this._renderLogbookEntryHelper(this.pendingItems[t][1]));this.entries.push((0,s.qy)($||($=V` <ha-timeline .icon="${0}" .moreItems="${0}"> ${0} </ha-timeline> `),q,r,e)),this.timeTracker.setLastReportedTime(this.pendingItems[this.pendingItems.length-1][0]),this.pendingItems=[]}_renderLogbookEntryHelper(e){return(0,s.qy)(f||(f=V`${0} (${0}) ${0}<br>`),e.name,e.entity_id,e.message||`turned ${e.state}`)}constructor(e,t,r){this.entries=e,this.timeTracker=t,this.logbookEntries=r,this.pendingItems=[],this.curIndex=r.length>0&&"automation"===r[0].domain?1:0}}class T{get curItem(){return this._getItem(this.curIndex)}get hasNext(){return this.curIndex<this.keys.length}renderItem(){this.curIndex=this._renderItem(this.curIndex)}_getItem(e){return this.trace.trace[this.keys[e]]}_renderItem(e,t,r){const a=this._getItem(e);if(r){let r=0;return a.forEach(a=>{r=this._renderIteration(e,a,t)}),r}return this._renderIteration(e,a[0],t)}_renderIteration(e,t,r){if((0,v.AB)(t.path))return this._handleTrigger(e,t);const a=new Date(t.timestamp);for(;this.logbookRenderer.hasNext&&new Date(1e3*this.logbookRenderer.curItem.when)<a;)this.logbookRenderer.maybeRenderItem();this.logbookRenderer.flush(),this.timeTracker.maybeRenderTime(a);const i=t.path;let s;try{s=(0,v.Ci)(this.trace.config,i)}catch(c){return this._renderEntry(i,this.hass.localize("ui.panel.config.automation.trace.messages.path_error",{path:i})),e+1}const o=i.split("/");if(!(2===o.length)&&!r)return this._renderEntry(i,i.replace(/\//g," ")),e+1;if(r||(r=(0,g.pq)(s)),"choose"===r)return this._handleChoose(e);if("repeat"===r)return this._handleRepeat(e);if("if"===r)return this._handleIf(e);if("sequence"===r)return this._handleSequence(e);if("parallel"===r)return this._handleParallel(e);this._renderEntry(i,(0,u.u)(this.hass,this.entityReg,s,r),void 0,!1===s.enabled);let n=e+1;for(;n<this.keys.length&&this.keys[n].split("/").length!==o.length;n++);return n}_handleTrigger(e,t){var r,a;return this._renderEntry(t.path,this.hass.localize("ui.panel.config.automation.trace.messages.triggered_by",{triggeredBy:null!==(r=t.changed_variables.trigger)&&void 0!==r&&r.alias?"alias":"other",alias:null===(a=t.changed_variables.trigger)||void 0===a?void 0:a.alias,triggeredPath:"trigger"===t.path?"manual":"trigger",trigger:this.trace.trigger,time:(0,c.yg)(new Date(t.timestamp),this.hass.locale,this.hass.config)}),w),e+1}_handleChoose(e){var t;const r=this.keys[e],a=r.split("/").length,i=this._getItem(e)[0],s="default"===(null===(t=i.result)||void 0===t?void 0:t.choice),o=this._getDataFromPath(this.keys[e]),n=!1===o.enabled,c=o.alias||this.hass.localize("ui.panel.config.automation.trace.messages.choose");if(s)this._renderEntry(r,this.hass.localize("ui.panel.config.automation.trace.messages.default_action_executed",{name:c}),void 0,n);else if(i.result){const t="default"!==i.result.choice?i.result.choice+1:void 0,a=this._getDataFromPath(`${this.keys[e]}/choose/${i.result.choice}`),s=a?`${a.alias||this.hass.localize("ui.panel.config.automation.trace.messages.option_executed",{option:t})}`:this.hass.localize("ui.panel.config.automation.trace.messages.error",{error:i.error});this._renderEntry(r,`${c}: ${s}`,void 0,n)}else this._renderEntry(r,this.hass.localize("ui.panel.config.automation.trace.messages.no_action_executed",{name:c}),void 0,n);let h;for(h=e+1;h<this.keys.length;h++){const e=this.keys[h].split("/");if(e.length<=a)return h;if(s&&"default"===e[a+1]||!s&&"sequence"===e[a+3])break}for(;h<this.keys.length;){const e=this.keys[h];if(e.split("/").length<=a)return h;h=this._renderItem(h,(0,g.pq)(this._getDataFromPath(e)))}return h}_handleRepeat(e){const t=this.keys[e],r=t.split("/").length,a=this._getDataFromPath(this.keys[e]),i=!1===a.enabled,s=a.alias||(0,u.u)(this.hass,this.entityReg,a);let o;for(this._renderEntry(t,s,void 0,i),o=e+1;o<this.keys.length;o++){const e=this.keys[o];if(e.split("/").length<=r)return o;o=this._renderItem(o,(0,g.pq)(this._getDataFromPath(e)),!0)}return o}_handleIf(e){var t;const r=this.keys[e],a=r.split("/").length,i=this._getItem(e)[0],s=this._getDataFromPath(this.keys[e]),o=!1===s.enabled,n=s.alias||this.hass.localize("ui.panel.config.automation.trace.messages.if");if(null!==(t=i.result)&&void 0!==t&&t.choice){const t=this._getDataFromPath(`${this.keys[e]}/${i.result.choice}/`),a=t?t.alias||this.hass.localize("ui.panel.config.automation.trace.messages.action_executed",{action:i.result.choice}):this.hass.localize("ui.panel.config.automation.trace.messages.error",{error:i.error});this._renderEntry(r,`${n}: ${a}`,void 0,o)}else this._renderEntry(r,this.hass.localize("ui.panel.config.automation.trace.messages.no_action_executed",{name:n}),void 0,o);let c;for(c=e+1;c<this.keys.length;c++){const e=this.keys[c],t=this.keys[c].split("/");if(t.length<=a)return c;"condition"===t[a+1]||t.length<a+2||(c=this._renderItem(c,(0,g.pq)(this._getDataFromPath(e))))}return c}_handleSequence(e){const t=this.keys[e],r=this._getDataFromPath(this.keys[e]);let a;for(this._renderEntry(t,r.alias||(0,u.u)(this.hass,this.entityReg,r,"sequence"),void 0,!1===r.enabled),a=e+1;a<this.keys.length;a++){const e=this.keys[a];this._renderItem(a,(0,g.pq)(this._getDataFromPath(e)))}return a}_handleParallel(e){const t=this.keys[e],r=t.split("/").length,a=this._getDataFromPath(this.keys[e]),i=!1===a.enabled,s=a.alias||this.hass.localize("ui.panel.config.automation.trace.messages.execute_in_parallel");let o;for(this._renderEntry(t,s,void 0,i),o=e+1;o<this.keys.length;o++){const e=this.keys[o];if(e.split("/").length<=r)return o;o=this._renderItem(o,(0,g.pq)(this._getDataFromPath(e)))}return o}_renderEntry(e,t,r=E,a=!1){this.entries.push((0,s.qy)(y||(y=V` <ha-timeline .icon="${0}" data-path="${0}" .notEnabled="${0}"> ${0}${0} </ha-timeline> `),r,e,a,t,a?(0,s.qy)(_||(_=V`<span class="disabled"> ${0}</span>`),this.hass.localize("ui.panel.config.automation.trace.messages.disabled")):""))}_getDataFromPath(e){return(0,v.Ci)(this.trace.config,e)}constructor(e,t,r,a,i,s){this.hass=e,this.entityReg=t,this.entries=r,this.trace=a,this.logbookRenderer=i,this.timeTracker=s,this.curIndex=0,this.keys=Object.keys(a.trace)}}class F extends s.WF{render(){if(!this.trace)return s.s6;const e=[],t=new R(this.hass,e,this.trace),r=new z(e,t,this.logbookEntries||[]),a=new T(this.hass,this._entityReg,e,this.trace,r,t);for(;a.hasNext;)a.renderItem();for(;r.hasNext;)r.maybeRenderItem();r.flush();const i=()=>(0,c.yg)(new Date(this.trace.timestamp.finish),this.hass.locale,this.hass.config),o=()=>((new Date(this.trace.timestamp.finish).getTime()-new Date(this.trace.timestamp.start).getTime())/1e3).toFixed(2);let h;if("running"===this.trace.state)h={description:this.hass.localize("ui.panel.config.automation.trace.messages.still_running"),icon:A};else if("debugged"===this.trace.state)h={description:this.hass.localize("ui.panel.config.automation.trace.messages.debugged"),icon:N};else if("finished"===this.trace.script_execution)h={description:this.hass.localize("ui.panel.config.automation.trace.messages.finished",{time:i(),executiontime:o()}),icon:w};else if("aborted"===this.trace.script_execution)h={description:this.hass.localize("ui.panel.config.automation.trace.messages.aborted",{time:i(),executiontime:o()}),icon:L};else if("cancelled"===this.trace.script_execution)h={description:this.hass.localize("ui.panel.config.automation.trace.messages.cancelled",{time:i(),executiontime:o()}),icon:L};else{let e,t,r=!1;switch(this.trace.script_execution){case"failed_conditions":e="stopped_failed_conditions";break;case"failed_single":e="stopped_failed_single";break;case"failed_max_runs":e="stopped_failed_max_runs";break;case"error":r=!0,e="stopped_error",t=(0,s.qy)(k||(k=V`<br><br>${0}`),this.trace.error);break;default:r=!0,e="stopped_unknown_reason"}h={description:(0,s.qy)(x||(x=V`${0} ${0}`),this.hass.localize(`ui.panel.config.automation.trace.messages.${e}`,{reason:this.trace.script_execution,time:i(),executiontime:o()}),t||""),icon:L,className:r?"error":void 0}}return e.push((0,s.qy)(C||(C=V` <ha-timeline last-item .icon="${0}" class="${0}"> ${0} </ha-timeline> `),h.icon,(0,n.J)(h.className),h.description)),(0,s.qy)(M||(M=V`${0}`),e)}updated(e){if(super.updated(e),this.allowPick&&e.has("trace")&&this.trace&&this.selectedPath&&!(this.selectedPath in this.trace.trace)){const e=this.shadowRoot.querySelector("ha-timeline[data-path]");e&&((0,l.r)(this,"value-changed",{value:e.dataset.path}),this.selectedPath=e.dataset.path)}(e.has("trace")||e.has("selectedPath"))&&this.shadowRoot.querySelectorAll("ha-timeline[data-path]").forEach(e=>{if((0,d.j)(e,"selected",this.selectedPath===e.dataset.path),!this.allowPick||0===e.tabIndex)return;e.tabIndex=0;const t=()=>{this.selectedPath=e.dataset.path,(0,l.r)(this,"value-changed",{value:e.dataset.path})};e.addEventListener("click",t),e.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||t()}),e.addEventListener("mouseover",()=>{e.raised=!0}),e.addEventListener("mouseout",()=>{e.raised=!1})})}static get styles(){return[(0,s.AH)(H||(H=V`ha-timeline[lastItem].condition{--timeline-ball-color:var(--error-color)}ha-timeline[data-path]{cursor:pointer}ha-timeline[selected]{--timeline-ball-color:var(--primary-color)}ha-timeline:focus{outline:0;--timeline-ball-color:var(--accent-color)}.error{--timeline-ball-color:var(--error-color);color:var(--error-color)}`))]}constructor(...e){super(...e),this.allowPick=!1}}(0,a.Cg)([(0,o.MZ)({attribute:!1})],F.prototype,"hass",void 0),(0,a.Cg)([(0,o.MZ)({attribute:!1})],F.prototype,"trace",void 0),(0,a.Cg)([(0,o.MZ)({attribute:!1})],F.prototype,"logbookEntries",void 0),(0,a.Cg)([(0,o.MZ)({attribute:!1})],F.prototype,"selectedPath",void 0),(0,a.Cg)([(0,o.MZ)({attribute:"allow-pick",type:Boolean})],F.prototype,"allowPick",void 0),(0,a.Cg)([(0,o.wk)(),(0,i.Fg)({context:p.ih,subscribe:!0})],F.prototype,"_entityReg",void 0),F=(0,a.Cg)([(0,o.EM)("hat-trace-timeline")],F),t()}catch(b){t(b)}})},44104:function(e,t,r){r.d(t,{h:function(){return i}});let a;const i=(0,r(96196).AH)(a||(a=(e=>e)`.tabs{background-color:var(--primary-background-color);border-top:1px solid var(--divider-color);border-bottom:1px solid var(--divider-color);display:flex;padding-left:4px;padding-inline-start:4px;padding-inline-end:initial}.tabs.top{border-top:none}.tabs>*{padding:2px 16px;cursor:pointer;position:relative;bottom:-1px;border:none;border-bottom:2px solid transparent;user-select:none;background:0 0;color:var(--primary-text-color);outline:0;transition:background 15ms linear}.tabs>.active{border-bottom-color:var(--primary-color)}.tabs>:focus,.tabs>:hover{background:var(--secondary-background-color)}`))},30039:function(e,t,r){r.d(t,{R:function(){return a}});const a=(e,t="")=>{const r=document.createElement("a");r.target="_blank",r.href=e,r.download=t,r.style.display="none",document.body.appendChild(r),r.dispatchEvent(new MouseEvent("click")),document.body.removeChild(r)}},18866:function(e,t,r){var a=r(43802).end,i=r(60706);e.exports=i("trimEnd")?function(){return a(this)}:"".trimEnd},39202:function(e,t,r){r(33313);var a=r(46518),i=r(18866);a({target:"String",proto:!0,name:"trimEnd",forced:"".trimEnd!==i},{trimEnd:i})},33313:function(e,t,r){var a=r(46518),i=r(18866);a({target:"String",proto:!0,name:"trimEnd",forced:"".trimRight!==i},{trimRight:i})}}]);
//# sourceMappingURL=75268.0c467572ec9028e0.js.map