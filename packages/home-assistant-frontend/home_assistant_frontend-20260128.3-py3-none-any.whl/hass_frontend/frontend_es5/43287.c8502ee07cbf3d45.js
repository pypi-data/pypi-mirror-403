"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["43287"],{91069:function(e,t,a){a.a(e,async function(e,r){try{a.d(t,{EO:function(){return w},Yq:function(){return C},_U:function(){return k},eE:function(){return $},fU:function(){return S},ol:function(){return p},xo:function(){return v}});var n=a(78016),l=a(31810),o=a(49134),s=a(81977),c=a(36307),i=a(35932),d=a(73983),u=a(6946),_=a(92913),h=a(83339),g=a(77972),m=a(31886),y=a(46927),f=e([m]);m=(f.then?(await f)():f)[0];const b=(e,t,a,r)=>{const n=a(new m.BB(e,t),r);return n instanceof Date?new Date(n.getTime()):n},p=(e,t,a,r,n)=>a.time_zone===y.Wj.server?b(e,r.time_zone,t,n):t(e,n),v=(e,t,a,r,n)=>a.time_zone===y.Wj.server?b(e,r.time_zone,t,n):t(e,n),w=(e,t,a,r,n)=>v(e,a,r,n,r.time_zone===y.Wj.server?new m.BB(t,n.time_zone):t),$=(e,t,a,r,m)=>{let y,f;if(v(e,n.e,r,m)&&v(t,l.c,r,m)){const n=(w(t,e,o.W,r,m)+1)*(a?1:-1);y=p(e,s.P,r,m,n),f=p(p(t,s.P,r,m,n),c.p,r,m)}else if(v(e,e=>(0,i.o)(e).getMilliseconds()===e.getMilliseconds(),r,m)&&v(t,e=>(0,d.D)(e).getMilliseconds()===e.getMilliseconds(),r,m)){const n=(w(t,e,u.c,r,m)+1)*(a?1:-1);y=p(e,_.f,r,m,n),f=p(t,_.f,r,m,n)}else{const n=w(t,e,h.b,r,m)*(a?1:-1);y=p(e,g.A,r,m,n),f=p(t,g.A,r,m,n)}return{start:y,end:f}},k=(e,t)=>{const a=new m.BB(e,t);return new Date(a.getTime())},C=(e,t)=>new m.BB(e,t).toISOString().split("T")[0],S=(e,t)=>new m.BB(e,t).toISOString().split("T")[1].split(".")[0];r()}catch(b){r(b)}})},46223:function(e,t,a){a.a(e,async function(e,r){try{a.d(t,{b:function(){return w}});var n=a(35932),l=a(73983),o=a(92913),s=a(52640),c=a(69137),i=a(35660),d=a(36307),u=a(11650),_=a(15797),h=a(33977),g=a(69748),m=a(55144),y=a(21828),f=a(66708),b=a(91069),p=a(380),v=e([p,b]);[p,b]=v.then?(await v)():v;const w=(e,t)=>{const a=new Date,r=(0,p.P)(e.locale);switch(t){case"today":return[(0,b.ol)(a,n.o,e.locale,e.config,{weekStartsOn:r}),(0,b.ol)(a,l.D,e.locale,e.config,{weekStartsOn:r})];case"yesterday":return[(0,b.ol)((0,o.f)(a,-1),n.o,e.locale,e.config,{weekStartsOn:r}),(0,b.ol)((0,o.f)(a,-1),l.D,e.locale,e.config,{weekStartsOn:r})];case"this_week":return[(0,b.ol)(a,s.k,e.locale,e.config,{weekStartsOn:r}),(0,b.ol)(a,c.$,e.locale,e.config,{weekStartsOn:r})];case"this_month":return[(0,b.ol)(a,i.w,e.locale,e.config),(0,b.ol)(a,d.p,e.locale,e.config)];case"this_quarter":return[(0,b.ol)(a,u.a,e.locale,e.config),(0,b.ol)(a,_.j,e.locale,e.config)];case"this_year":return[(0,b.ol)(a,h.D,e.locale,e.config),(0,b.ol)(a,g.Q,e.locale,e.config)];case"now-7d":return[(0,b.ol)(a,m.e,e.locale,e.config,7),(0,b.ol)(a,m.e,e.locale,e.config,0)];case"now-30d":return[(0,b.ol)(a,m.e,e.locale,e.config,30),(0,b.ol)(a,m.e,e.locale,e.config,0)];case"now-12m":return[(0,b.ol)(a,y.a,e.locale,e.config,12),(0,b.ol)(a,y.a,e.locale,e.config,0)];case"now-1h":return[(0,b.ol)(a,f.O,e.locale,e.config,1),(0,b.ol)(a,f.O,e.locale,e.config,0)];case"now-12h":return[(0,b.ol)(a,f.O,e.locale,e.config,12),(0,b.ol)(a,f.O,e.locale,e.config,0)];case"now-24h":return[(0,b.ol)(a,f.O,e.locale,e.config,24),(0,b.ol)(a,f.O,e.locale,e.config,0)]}return[a,a]};r()}catch(w){r(w)}})},23528:function(e,t,a){a.a(e,async function(e,r){try{a.d(t,{$3:function(){return f},$O:function(){return S},$j:function(){return b},ED:function(){return s},JE:function(){return O},OQ:function(){return x},PU:function(){return W},Ph:function(){return m},Uf:function(){return C},W1:function(){return y},Wr:function(){return _},Z:function(){return d},gF:function(){return p},iY:function(){return v},jU:function(){return c},nN:function(){return k},p3:function(){return u},pJ:function(){return g},r_:function(){return i},sz:function(){return h}});a(74423),a(18111),a(13579),a(62953);var n=a(28978),l=a(380),o=e([l]);l=(o.then?(await o)():o)[0];var s=function(e){return e[e.NONE=0]="NONE",e[e.ARITHMETIC=1]="ARITHMETIC",e[e.CIRCULAR=2]="CIRCULAR",e}({});const c=["entity_not_recorded","entity_no_longer_recorded","state_class_removed","units_changed","mean_type_changed","no_state"],i=["L","gal","ft³","m³","CCF","MCF"],d=e=>e.sendMessagePromise({type:"recorder/info"}),u=(e,t)=>e.callWS({type:"recorder/list_statistic_ids",statistic_type:t}),_=(e,t)=>e.callWS({type:"recorder/get_statistics_metadata",statistic_ids:t}),h=(e,t,a,r,n="hour",l,o)=>e.callWS({type:"recorder/statistics_during_period",start_time:t.toISOString(),end_time:null==a?void 0:a.toISOString(),statistic_ids:r,period:n,units:l,types:o}),g=(e,t,a,r)=>e.callWS({type:"recorder/statistic_during_period",statistic_id:t,units:r,fixed_period:a.fixed_period?{start_time:a.fixed_period.start instanceof Date?a.fixed_period.start.toISOString():a.fixed_period.start,end_time:a.fixed_period.end instanceof Date?a.fixed_period.end.toISOString():a.fixed_period.end}:void 0,calendar:a.calendar?Object.assign(Object.assign({},"week"===a.calendar.period?{first_weekday:(0,l.D)(e.locale).substring(0,3)}:{}),a.calendar):void 0,rolling_window:a.rolling_window}),m=e=>e.callWS({type:"recorder/validate_statistics"}),y=(e,t,a,r)=>e.callWS({type:"recorder/update_statistics_metadata",statistic_id:t,unit_of_measurement:a,unit_class:r}),f=(e,t)=>e.callWS({type:"recorder/clear_statistics",statistic_ids:t}),b=e=>{let t=null;if(!e)return null;for(const a of e)null!==a.change&&void 0!==a.change&&(null===t?t=a.change:t+=a.change);return t},p=(e,t)=>{let a=null;for(const r of t){if(!(r in e))continue;const t=b(e[r]);null!==t&&(null===a?a=t:a+=t)}return a},v=(e,t)=>e.some(e=>void 0!==e[t]&&null!==e[t]),w=["mean","min","max"],$=["sum","state","change"],k=(e,t)=>!(!w.includes(t)||0===e.mean_type)||!(!$.includes(t)||!e.has_sum),C=(e,t,a,r,n)=>{const l=new Date(a).toISOString();return e.callWS({type:"recorder/adjust_sum_statistics",statistic_id:t,start_time:l,adjustment:r,adjustment_unit_of_measurement:n})},S=(e,t,a)=>{const r=e.states[t];return r?(0,n.u)(r):(null==a?void 0:a.name)||t},O=(e,t,a)=>{let r;var n;t&&(r=null===(n=e.states[t])||void 0===n?void 0:n.attributes.unit_of_measurement);return void 0===r?null==a?void 0:a.statistics_unit_of_measurement:r},x=e=>e.includes(":"),W=e=>e.callWS({type:"recorder/update_statistics_issues"});r()}catch(c){r(c)}})},18427:function(e,t,a){a.d(t,{g:function(){return l}});a(42762);var r=a(79468),n=a(39274);function l(e,t,a,l,o,s){const c=e.getPropertyValue(o+"-"+s).trim(),i=c.length>0?c:e.getPropertyValue(o).trim();let d=(0,r.RQ)(i);return 0===c.length&&s&&(d=(0,r.v2)((0,r.BE)(t?(0,n.T)((0,r.Nc)((0,r.xp)(d)),s):(0,n.d)((0,r.Nc)((0,r.xp)(d)),s)))),l?d+=a?"32":"7F":a&&(d+="7F"),d}},24408:function(e,t,a){a.a(e,async function(e,r){try{a.r(t),a.d(t,{HuiEnergySourcesTableCard:function(){return P}});a(74423),a(18111),a(22489),a(61701),a(13579),a(53921),a(62953);var n=a(40445),l=a(68560),o=a(96196),s=a(77845),c=a(94333),i=a(6415),d=a(20058),u=a(18427),_=(a(76776),a(38114)),h=a(23528),g=a(54706),m=a(784),y=a(1087),f=e([d,_,h]);[d,_,h]=f.then?(await f)():f;let b,p,v,w,$,k,C,S,O,x,W,q,M,z,D,R,j,I,T,E=e=>e;const B={grid_return:"--energy-grid-return-color",grid_consumption:"--energy-grid-consumption-color",battery_in:"--energy-battery-in-color",battery_out:"--energy-battery-out-color",solar:"--energy-solar-color",gas:"--energy-gas-color",water:"--energy-water-color"};class P extends((0,g.E)(o.WF)){hassSubscribe(){var e;return[(0,_.tb)(this.hass,{key:null===(e=this._config)||void 0===e?void 0:e.collection_key}).subscribe(e=>{this._data=e})]}getCardSize(){return 3}setConfig(e){this._config=e}shouldUpdate(e){return(0,m.xP)(this,e)||e.size>1||!e.has("hass")}_renderRow(e,t,a,r,n,l,s,_,g,m,y){var f;return(0,o.qy)(b||(b=E`<tr class="mdc-data-table__row ${0}" @click="${0}" .entity="${0}"> <td class="mdc-data-table__cell cell-bullet"> <div class="bullet" style="${0}"></div> </td> <th class="mdc-data-table__cell" scope="row"> ${0} </th> ${0} <td class="mdc-data-table__cell mdc-data-table__cell--numeric"> ${0} ${0} </td> ${0} </tr>`),(0,c.H)({clickable:!(0,h.OQ)(a)}),this._handleMoreInfo,a,(0,i.W)({borderColor:(0,u.g)(e,this.hass.themes.darkMode,!1,!1,B[t],r),backgroundColor:(0,u.g)(e,this.hass.themes.darkMode,!0,!1,B[t],r)}),(0,h.$O)(this.hass,a,null===(f=this._data)||void 0===f?void 0:f.statsMetadata[a]),y?(0,o.qy)(p||(p=E`<td class="mdc-data-table__cell mdc-data-table__cell--numeric"> ${0} ${0} </td> ${0}`),(0,d.ZV)(l,this.hass.locale),s,m?(0,o.qy)(v||(v=E`<td class="mdc-data-table__cell mdc-data-table__cell--numeric"> ${0} </td>`),null!==g?(0,d.ZV)(g,this.hass.locale,{style:"currency",currency:this.hass.config.currency}):""):""):"",(0,d.ZV)(n,this.hass.locale),s,m?(0,o.qy)(w||(w=E` <td class="mdc-data-table__cell mdc-data-table__cell--numeric"> ${0} </td>`),null!==_?(0,d.ZV)(_,this.hass.locale,{style:"currency",currency:this.hass.config.currency}):""):"")}_renderTotalRow(e,t,a,r,n,l,s,c,u,_){return(0,o.qy)($||($=E` <tr class="mdc-data-table__row ${0}"> <td class="mdc-data-table__cell cell-bullet"> ${0} </td> <th class="mdc-data-table__cell" scope="row">${0}</th> ${0} <td class="mdc-data-table__cell mdc-data-table__cell--numeric"> ${0} </td> ${0} </tr>`),u&&!_?"":"total",u?(0,o.qy)(k||(k=E`<div class="bullet" style="${0}"></div>`),(0,i.W)({borderColor:u.border,backgroundColor:u.background})):o.s6,e,c?(0,o.qy)(C||(C=E`<td class="mdc-data-table__cell mdc-data-table__cell--numeric"> ${0} </td> ${0}`),null===a?"":`${(0,d.ZV)(a,this.hass.locale)} ${r}`,s?(0,o.qy)(S||(S=E`<td class="mdc-data-table__cell mdc-data-table__cell--numeric"> ${0} </td>`),null!==l?(0,d.ZV)(l,this.hass.locale,{style:"currency",currency:this.hass.config.currency}):""):""):"",null===t?"":`${(0,d.ZV)(t,this.hass.locale)} ${r}`,s?(0,o.qy)(O||(O=E`<td class="mdc-data-table__cell mdc-data-table__cell--numeric"> ${0} </td>`),null!==n?(0,d.ZV)(n,this.hass.locale,{style:"currency",currency:this.hass.config.currency}):""):"")}render(){var e,t,a,r,n,l,s,c,i;if(!this.hass||!this._config)return o.s6;if(!this._data)return(0,o.qy)(x||(x=E`${0}`),this.hass.localize("ui.panel.lovelace.cards.energy.loading"));let d=0,g=0,m=0,y=!1,f=0,b=0,p=0;const v={gas:0,water:0,solar:0},w={gas:0,water:0,solar:0},$={gas:0,water:0},k={gas:0,water:0},C={gas:!1,water:!1},S=(0,_.E$)(this._data.prefs),O=null===(e=this._config)||void 0===e?void 0:e.types,T=O?Object.fromEntries(Object.entries(S).filter(([e])=>O.includes(e))):S,P=getComputedStyle(this),U=!!(null!==(t=T.grid)&&void 0!==t&&t[0].flow_from.some(e=>e.stat_cost||e.entity_energy_price||e.number_energy_price)||null!==(a=T.grid)&&void 0!==a&&a[0].flow_to.some(e=>e.stat_compensation||e.entity_energy_price||e.number_energy_price)||null!==(r=T.gas)&&void 0!==r&&r.some(e=>e.stat_cost||e.entity_energy_price||e.number_energy_price)||null!==(n=T.water)&&void 0!==n&&n.some(e=>e.stat_cost||e.entity_energy_price||e.number_energy_price)),V={solar:"kWh",gas:this._data.gasUnit,water:this._data.waterUnit},Z=void 0!==this._data.statsCompare,A=(e,t)=>{const a=(0,h.$j)(this._data.stats[e]),r=Z&&(0,h.$j)(this._data.statsCompare[e]),n=t&&(0,h.$j)(this._data.stats[t])||0,l=Z&&t&&(0,h.$j)(this._data.statsCompare[t])||0;return null!==a||Z&&null!==r?{hasData:!0,energy:a||0,energyCompare:r||0,cost:n,costCompare:l}:{hasData:!1,energy:a||0,energyCompare:r||0,cost:n,costCompare:l}},N=this._config.show_only_totals,F=e=>{var t;return(0,o.qy)(W||(W=E` ${0} ${0}`),null===(t=T[e])||void 0===t?void 0:t.map((t,a)=>{const r=e in C&&(t.stat_cost||this._data.info.cost_sensors[t.stat_energy_from]),{hasData:n,energy:l,energyCompare:s,cost:c,costCompare:i}=A(t.stat_energy_from,r||null);return n||c||i?(v[e]+=l,w[e]+=s,r&&(C[e]=!0,$[e]+=c,k[e]+=i),N?o.s6:this._renderRow(P,e,t.stat_energy_from,a,l,s,V[e],r?c:null,r?i:null,U,Z)):o.s6}),T[e]?this._renderTotalRow(this.hass.localize(`ui.panel.lovelace.cards.energy.energy_sources_table.${e}_total`),v[e],w[e],V[e],C[e]?$[e]:null,C[e]?k[e]:null,U,Z,N?{border:(0,u.g)(P,this.hass.themes.darkMode,!1,!1,B[e],0),background:(0,u.g)(P,this.hass.themes.darkMode,!0,!1,B[e],0)}:void 0):"")};return(0,o.qy)(q||(q=E` <ha-card> ${0} <div class="mdc-data-table"> <div class="mdc-data-table__table-container"> <table class="mdc-data-table__table" aria-label="Energy sources"> <thead> <tr class="mdc-data-table__header-row"> <th class="mdc-data-table__header-cell"></th> <th class="mdc-data-table__header-cell" role="columnheader" scope="col"> ${0} </th> ${0} <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric" role="columnheader" scope="col"> ${0} </th> ${0} </tr> </thead> <tbody class="mdc-data-table__content"> ${0} ${0} ${0} ${0} ${0} ${0} ${0} ${0} </tbody> </table> </div> </div> </ha-card>`),this._config.title?(0,o.qy)(M||(M=E`<h1 class="card-header">${0}</h1>`),this._config.title):"",this.hass.localize("ui.panel.lovelace.cards.energy.energy_sources_table.source"),Z?(0,o.qy)(z||(z=E`<th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric" role="columnheader" scope="col"> ${0} </th> ${0}`),this.hass.localize("ui.panel.lovelace.cards.energy.energy_sources_table.previous_energy"),U?(0,o.qy)(D||(D=E`<th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric" role="columnheader" scope="col"> ${0} </th>`),this.hass.localize("ui.panel.lovelace.cards.energy.energy_sources_table.previous_cost")):""):"",this.hass.localize("ui.panel.lovelace.cards.energy.energy_sources_table.energy"),U?(0,o.qy)(R||(R=E` <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric" role="columnheader" scope="col"> ${0} </th>`),this.hass.localize("ui.panel.lovelace.cards.energy.energy_sources_table.cost")):"",F("solar"),null===(l=T.battery)||void 0===l?void 0:l.map((e,t)=>{const{hasData:a,energy:r,energyCompare:n}=A(e.stat_energy_from,null),{hasData:l,energy:s,energyCompare:c}=A(e.stat_energy_to,null);return a||l?(m+=r-s,p+=n-c,N?o.s6:(0,o.qy)(j||(j=E` ${0}${0}`),this._renderRow(P,"battery_out",e.stat_energy_from,t,r,n,"kWh",null,null,U,Z),this._renderRow(P,"battery_in",e.stat_energy_to,t,-s,-c,"kWh",null,null,U,Z))):o.s6}),T.battery?this._renderTotalRow(this.hass.localize("ui.panel.lovelace.cards.energy.energy_sources_table.battery_total"),m,p,"kWh",null,null,U,Z,N?{border:(0,u.g)(P,this.hass.themes.darkMode,!1,!1,B.battery_out,0),background:(0,u.g)(P,this.hass.themes.darkMode,!0,!1,B.battery_out,0)}:void 0):"",null===(s=T.grid)||void 0===s?void 0:s.map(e=>(0,o.qy)(I||(I=E`${0} ${0}`),e.flow_from.map((e,t)=>{const a=e.stat_cost||this._data.info.cost_sensors[e.stat_energy_from],{hasData:r,energy:n,energyCompare:l,cost:s,costCompare:c}=A(e.stat_energy_from,a||null);return r||s||c?(d+=n,f+=l,a&&(y=!0,g+=s,b+=c),N?o.s6:this._renderRow(P,"grid_consumption",e.stat_energy_from,t,n,l,"kWh",s,c,U,Z)):o.s6}),e.flow_to.map((e,t)=>{const a=e.stat_compensation||this._data.info.cost_sensors[e.stat_energy_to],{hasData:r,energy:n,energyCompare:l,cost:s,costCompare:c}=A(e.stat_energy_to,a||null);return r||s||c?(d-=n,f-=l,null!==a&&(y=!0,g-=s,b-=c),N?o.s6:this._renderRow(P,"grid_return",e.stat_energy_to,t,-n,-l,"kWh",-s,-c,U,Z)):o.s6}))),T.grid&&(null!==(c=T.grid)&&void 0!==c&&null!==(c=c[0].flow_from)&&void 0!==c&&c.length||null!==(i=T.grid)&&void 0!==i&&null!==(i=i[0].flow_to)&&void 0!==i&&i.length)?this._renderTotalRow(this.hass.localize("ui.panel.lovelace.cards.energy.energy_sources_table.grid_total"),d,f,"kWh",y?g:null,y?b:null,U,Z,N?{border:(0,u.g)(P,this.hass.themes.darkMode,!1,!1,B.grid_consumption,0),background:(0,u.g)(P,this.hass.themes.darkMode,!0,!1,B.grid_consumption,0)}:void 0):"",F("gas"),F("water"),[C.gas,C.water,y].filter(Boolean).length>1?this._renderTotalRow(this.hass.localize("ui.panel.lovelace.cards.energy.energy_sources_table.total_costs"),null,null,"",$.gas+g+$.water,k.gas+b+k.water,U,Z,void 0,!0):"")}_handleMoreInfo(e){var t;const a=null===(t=e.currentTarget)||void 0===t?void 0:t.entity;a&&!(0,h.OQ)(a)&&(0,y.r)(this,"hass-more-info",{entityId:a})}static get styles(){return(0,o.AH)(T||(T=E`${0} .mdc-data-table{width:100%;border:0}.mdc-data-table__cell,.mdc-data-table__header-cell{color:var(--primary-text-color);border-bottom-color:var(--divider-color);text-align:var(--float-start)}.mdc-data-table__row:not(.mdc-data-table__row--selected):hover{background-color:rgba(var(--rgb-primary-text-color),.04)}.clickable{cursor:pointer}.total{--mdc-typography-body2-font-weight:var(--ha-font-weight-medium)}.total .mdc-data-table__cell{border-top:1px solid var(--divider-color)}ha-card{max-height:100%;overflow:auto}.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.cell-bullet{width:32px;padding-right:0;padding-inline-end:0;padding-inline-start:16px;direction:var(--direction)}.bullet{border-width:1px;border-style:solid;border-radius:var(--ha-border-radius-sm);height:16px;width:32px}.mdc-data-table__cell--numeric{direction:ltr}`),(0,o.iz)(l))}constructor(...e){super(...e),this.hassSubscribeRequiredHostProps=["_config"]}}(0,n.Cg)([(0,s.MZ)({attribute:!1})],P.prototype,"hass",void 0),(0,n.Cg)([(0,s.wk)()],P.prototype,"_config",void 0),(0,n.Cg)([(0,s.wk)()],P.prototype,"_data",void 0),P=(0,n.Cg)([(0,s.EM)("hui-energy-sources-table-card")],P),r()}catch(b){r(b)}})}}]);
//# sourceMappingURL=43287.c8502ee07cbf3d45.js.map