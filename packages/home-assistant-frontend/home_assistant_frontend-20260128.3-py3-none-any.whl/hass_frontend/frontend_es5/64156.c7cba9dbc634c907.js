/*! For license information please see 64156.c7cba9dbc634c907.js.LICENSE.txt */
"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["64156"],{86233:function(e,t,i){function r(e,t){if(e.closest)return e.closest(t);for(var i=e;i;){if(a(i,t))return i;i=i.parentElement}return null}function a(e,t){return(e.matches||e.webkitMatchesSelector||e.msMatchesSelector).call(e,t)}i.d(t,{cK:function(){return a},kp:function(){return r}})},31580:function(e,t,i){i.d(t,{J8:function(){return a},Rr:function(){return o},b9:function(){return r},iV:function(){return n}});i(94490);const r=e=>{let t=e;return"string"==typeof e&&(t=parseInt(e,16)),"0x"+t.toString(16).padStart(4,"0")},a=(e,t)=>{const i=e.user_given_name?e.user_given_name:e.name,r=t.user_given_name?t.user_given_name:t.name;return i.localeCompare(r)},n=(e,t)=>{const i=e.name,r=t.name;return i.localeCompare(r)},o=e=>`${e.name} (Endpoint id: ${e.endpoint_id}, Id: ${r(e.id)}, Type: ${e.type})`},94728:function(e,t,i){i.a(e,async function(e,r){try{i.r(t),i.d(t,{ZHANetworkVisualizationPage:function(){return _}});i(74423),i(44114),i(26910),i(18111),i(20116),i(7588),i(3362),i(27495),i(25440),i(62953);var a=i(40445),n=i(96196),o=i(77845),s=i(76774),l=i(91926),c=i(7358),u=i(84621),h=(i(31168),i(31580)),d=i(63670),p=e([c,d]);[c,d]=p.then?(await p)():p;let f,v,g=e=>e;const y="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z";class _ extends n.WF{firstUpdated(e){super.firstUpdated(e),this.hass&&this._fetchData()}render(){return(0,n.qy)(f||(f=g` <hass-tabs-subpage .tabs="${0}" .hass="${0}" .narrow="${0}" .isWide="${0}" .route="${0}" header="${0}"> <ha-network-graph .hass="${0}" .data="${0}" .tooltipFormatter="${0}" @chart-click="${0}"> <ha-icon-button slot="button" class="refresh-button" .path="${0}" @click="${0}" label="${0}"></ha-icon-button> </ha-network-graph> </hass-tabs-subpage> `),d.zhaTabs,this.hass,this.narrow,this.isWide,this.route,this.hass.localize("ui.panel.config.zha.visualization.header"),this.hass,this._networkData,this._tooltipFormatter,this._handleChartClick,y,this._refreshTopology,this.hass.localize("ui.panel.config.zha.visualization.refresh_topology"))}async _fetchData(){this._devices=await(0,u.Uc)(this.hass),this._networkData=this._createChartData(this._devices)}async _refreshTopology(){await(0,u.xU)(this.hass),await this._fetchData()}_handleChartClick(e){if("node"===e.detail.dataType&&"pointer"===e.detail.event.target.cursor){const{id:t}=e.detail.data,i=this._devices.find(e=>e.ieee===t);i&&(0,l.o)(`/config/devices/device/${i.device_reg_id}`)}}static get styles(){return[(0,n.AH)(v||(v=g`ha-network-graph{height:100%}`))]}_createChartData(e){const t=getComputedStyle(this),i=t.getPropertyValue("--primary-color"),r=t.getPropertyValue("--cyan-color"),a=t.getPropertyValue("--teal-color"),n=t.getPropertyValue("--error-color"),o=[],l=[],c=[{name:this.hass.localize("ui.panel.config.zha.visualization.coordinator"),symbol:"roundRect",itemStyle:{color:i}},{name:this.hass.localize("ui.panel.config.zha.visualization.router"),symbol:"circle",itemStyle:{color:r}},{name:this.hass.localize("ui.panel.config.zha.visualization.end_device"),symbol:"circle",itemStyle:{color:a}},{name:this.hass.localize("ui.panel.config.zha.visualization.offline"),symbol:"circle",itemStyle:{color:n}}];return e.forEach(c=>{const u="Coordinator"===c.device_type;let h;h=c.available?u?0:"Router"===c.device_type?1:2:3;const d=this.hass.devices[c.device_reg_id],p=d?(0,s.w)(d,this.hass).area:void 0;o.push({id:c.ieee,name:c.user_given_name||c.name||c.ieee,context:null==p?void 0:p.name,category:h,value:u?3:"Router"===c.device_type?2:1,symbolSize:u?40:"Router"===c.device_type?30:20,symbol:u?"roundRect":"circle",itemStyle:{color:c.available?u?i:"Router"===c.device_type?r:a:n},polarDistance:0===h?0:1===h?.5:.9,fixed:u});const f=l.filter(e=>e.source===c.ieee||e.target===c.ieee);if(c.routes&&c.routes.length>0)c.routes.forEach(e=>{const r=c.neighbors.find(t=>t.nwk===e.next_hop);if(!r)return;const a=f.find(e=>e.source===r.ieee||e.target===r.ieee);if(a){var n;if(a.source===c.ieee)a.value=Math.max(a.value,parseInt(r.lqi));else a.reverseValue=Math.max(null!==(n=a.reverseValue)&&void 0!==n?n:0,parseInt(r.lqi));const t=this._getLQIWidth(parseInt(r.lqi));a.symbolSize=t/4*6+3,a.lineStyle=Object.assign(Object.assign({},a.lineStyle),{},{width:t,color:"Active"===e.route_status?i:a.lineStyle.color,type:["Child","Parent"].includes(r.relationship)?"solid":a.lineStyle.type})}else{const a=this._getLQIWidth(parseInt(r.lqi)),n={source:c.ieee,target:r.ieee,value:parseInt(r.lqi),lineStyle:{width:a,color:"Active"===e.route_status?i:t.getPropertyValue("--dark-primary-color"),type:["Child","Parent"].includes(r.relationship)?"solid":"dotted"},symbolSize:a/4*6+3,ignoreForceLayout:"0x0000"!==e.dest_nwk};l.push(n),f.push(n)}});else if(0===f.length){var v;const i=null!==(v=c.neighbors)&&void 0!==v?v:[];0===i.length&&e.forEach(e=>{if(e.neighbors&&e.neighbors.length>0){const t=e.neighbors.find(e=>e.ieee===c.ieee);t&&i.push({ieee:e.ieee,lqi:t.lqi})}});const r=i.sort((e,t)=>parseInt(t.lqi)-parseInt(e.lqi))[0];r&&l.push({source:c.ieee,target:r.ieee,value:parseInt(r.lqi),symbolSize:5,lineStyle:{width:1,color:t.getPropertyValue("--dark-primary-color"),type:"dotted"},ignoreForceLayout:!0})}}),e.forEach(e=>{if("Coordinator"===e.device_type)l.forEach(t=>{t.source!==e.ieee&&t.target!==e.ieee||(t.ignoreForceLayout=!1)});else{let t;!l.some(i=>{if(i.source===e.ieee||i.target===e.ieee){var r,a;if(!i.ignoreForceLayout)return!0;i.value>(null!==(r=null===(a=t)||void 0===a?void 0:a.value)&&void 0!==r?r:-1)&&(t=i)}return!1})&&t&&(t.ignoreForceLayout=!1)}}),{nodes:o,links:l,categories:c}}_getLQIWidth(e){return e>200?3:e>100?2:1}constructor(...e){super(...e),this.narrow=!1,this.isWide=!1,this._networkData={nodes:[],links:[],categories:[]},this._devices=[],this._tooltipFormatter=e=>{const{dataType:t,data:i,name:r}=e;if("edge"===t){var a;const{source:e,target:t,value:r}=i,n=this._networkData.nodes.find(e=>e.id===t).name,o=this._networkData.nodes.find(t=>t.id===e).name,s=`${o} → ${n}${r?` <b>LQI:</b> ${r}`:""}`,l=null===(a=this._networkData.links.find(i=>i.source===e&&i.target===t))||void 0===a?void 0:a.reverseValue;return l?`${s}<br>${n} → ${o} <b>LQI:</b> ${l}`:s}const n=this._devices.find(e=>e.ieee===i.id);if(!n)return r;let o=`<b>IEEE: </b>${n.ieee}`;o+=`<br><b>${this.hass.localize("ui.panel.config.zha.visualization.device_type")}: </b>${n.device_type.replace("_"," ")}`,null!=n.nwk&&(o+=`<br><b>NWK: </b>${(0,h.b9)(n.nwk)}`),null!=n.manufacturer&&null!=n.model?o+=`<br><b>${this.hass.localize("ui.panel.config.zha.visualization.device")}: </b>${n.manufacturer} ${n.model}`:o+=`<br><b>${this.hass.localize("ui.panel.config.zha.visualization.device_not_in_db")}</b>`;const l=this.hass.devices[n.device_reg_id];if(l){const e=(0,s.w)(l,this.hass).area;e&&(o+=`<br><b>${this.hass.localize("ui.panel.config.zha.visualization.area")}: </b>${e.name}`)}return o}}}(0,a.Cg)([(0,o.MZ)({attribute:!1})],_.prototype,"hass",void 0),(0,a.Cg)([(0,o.MZ)({attribute:!1})],_.prototype,"route",void 0),(0,a.Cg)([(0,o.MZ)({type:Boolean,reflect:!0})],_.prototype,"narrow",void 0),(0,a.Cg)([(0,o.MZ)({attribute:"is-wide",type:Boolean})],_.prototype,"isWide",void 0),(0,a.Cg)([(0,o.wk)()],_.prototype,"_networkData",void 0),(0,a.Cg)([(0,o.wk)()],_.prototype,"_devices",void 0),_=(0,a.Cg)([(0,o.EM)("zha-network-visualization-page")],_),r()}catch(f){r(f)}})},48646:function(e,t,i){var r=i(69565),a=i(28551),n=i(1767),o=i(50851);e.exports=function(e,t){t&&"string"==typeof e||a(e);var i=o(e);return n(a(void 0!==i?r(i,e):e))}},78350:function(e,t,i){var r=i(46518),a=i(70259),n=i(79306),o=i(48981),s=i(26198),l=i(1469);r({target:"Array",proto:!0},{flatMap:function(e){var t,i=o(this),r=s(i);return n(e),t=l(i,0),a(t,i,i,r,0,1,e,arguments.length>1?arguments[1]:void 0),t}})},30237:function(e,t,i){i(6469)("flatMap")},30531:function(e,t,i){var r=i(46518),a=i(69565),n=i(79306),o=i(28551),s=i(1767),l=i(48646),c=i(19462),u=i(9539),h=i(96395),d=i(30684),p=i(84549);var f=!h&&!d("flatMap",function(){}),v=!h&&!f&&p("flatMap",TypeError),g=h||f||v||function(){try{var e=Iterator.prototype.flatMap.call(new Map([[4,5]]).entries(),function(e){return e});e.next(),e.return()}catch(t){return!0}}(),y=c(function(){for(var e,t,i=this.iterator,r=this.mapper;;){if(t=this.inner)try{if(!(e=o(a(t.next,t.iterator))).done)return e.value;this.inner=null}catch(n){u(i,"throw",n)}if(e=o(a(this.next,i)),this.done=!!e.done)return;try{this.inner=l(r(e.value,this.counter++),!1)}catch(n){u(i,"throw",n)}}});r({target:"Iterator",proto:!0,real:!0,forced:g},{flatMap:function(e){o(this);try{n(e)}catch(t){u(this,"throw",t)}return v?a(v,this,e):new y(s(this),{mapper:e,inner:null})}})},54495:function(e,t,i){i.d(t,{OA:function(){return r.OA},WL:function(){return r.WL},u$:function(){return r.u$}});var r=i(42017)},6415:function(e,t,i){i.d(t,{W:function(){return r.W}});var r=i(64913)}}]);
//# sourceMappingURL=64156.c7cba9dbc634c907.js.map