export const __rspack_esm_id="39565";export const __rspack_esm_ids=["39565"];export const __webpack_modules__={90433(t,e,s){s.d(e,{Vy:()=>r,fI:()=>i,ux:()=>n});var a=s(22786),o=s(79468);function r(t,e){const s=t%54+1;return e.getPropertyValue(`--color-${s}`)}function i(t,e){const s=e.getPropertyValue(`--graph-color-${t+1}`)||r(t,e);return(0,o.RQ)(s)}const n=(0,a.A)(t=>Array.from({length:54},(e,s)=>i(s,t)),(t,e)=>t[0].getPropertyValue("--graph-color-1")===e[0].getPropertyValue("--graph-color-1")&&t[0].getPropertyValue("--color-1")===e[0].getPropertyValue("--color-1"))},18427(t,e,s){s.d(e,{g:()=>r});var a=s(79468),o=s(39274);function r(t,e,s,r,i,n){const c=t.getPropertyValue(i+"-"+n).trim(),d=c.length>0?c:t.getPropertyValue(i).trim();let h=(0,a.RQ)(d);return 0===c.length&&n&&(h=(0,a.v2)((0,a.BE)(e?(0,o.T)((0,a.Nc)((0,a.xp)(h)),n):(0,o.d)((0,a.Nc)((0,a.xp)(h)),n)))),r?h+=s?"32":"7F":s&&(h+="7F"),h}},71209(t,e,s){s.a(t,async function(t,a){try{s.r(e),s.d(e,{HuiEnergyDevicesDetailGraphCard:()=>C});s(44114),s(18111),s(22489),s(20116),s(7588),s(61701),s(18237);var o=s(62826),r=s(40600),i=s(81859),n=s(96196),c=s(44457),d=s(94333),h=s(22786),p=s(90433),_=s(18427),u=(s(76776),s(44439)),l=s(38114),m=s(23528),g=s(54706),f=s(784),y=s(97372),v=s(93905),b=s(20058),k=t([u,l,b,y]);[u,l,b,y]=k.then?(await k)():k;const S="kWh";class C extends((0,g.E)(n.WF)){hassSubscribe(){return[(0,l.tb)(this.hass,{key:this._config?.collection_key}).subscribe(t=>{this._data=t})]}getCardSize(){return 3}setConfig(t){this._config=t}shouldUpdate(t){return(0,f.xP)(this,t)||t.size>1||!t.has("hass")}willUpdate(t){(t.has("_config")||t.has("_data"))&&this._processStatistics()}render(){return this.hass&&this._config?n.qy` <ha-card> ${this._config.title?n.qy`<h1 class="card-header">${this._config.title}</h1>`:""} <div class="content ${(0,d.H)({"has-header":!!this._config.title})}"> <ha-chart-base .hass="${this.hass}" .data="${this._chartData}" .options="${this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,S,this._compareStart,this._compareEnd)}" @dataset-hidden="${this._datasetHidden}" @dataset-unhidden="${this._datasetUnhidden}"></ha-chart-base> </div> </ha-card> `:n.s6}_datasetHidden(t){this._hiddenStats=[...this._hiddenStats,this._getStatIdFromId(t.detail.id)]}_datasetUnhidden(t){this._hiddenStats=this._hiddenStats.filter(e=>e!==this._getStatIdFromId(t.detail.id))}_processStatistics(){if(!this._data)return;const t=this._data;this._start=t.start,this._end=t.end||(0,r.o)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare;const e=t.stats,s=t.statsCompare,a=getComputedStyle(this),o=t.prefs.device_consumption,i={};o.forEach(t=>{t.included_in_stat&&(i[t.included_in_stat]=i[t.included_in_stat]||[],i[t.included_in_stat].push(t.stat_consumption))});const n={};t.prefs.device_consumption.forEach(t=>{const s=t.stat_consumption in e&&(0,m.$j)(e[t.stat_consumption])||0;n[t.stat_consumption]=s});const c={};t.prefs.device_consumption.forEach(t=>{c[t.stat_consumption]=(i[t.stat_consumption]||[]).reduce((t,e)=>t-n[e],n[t.stat_consumption])});const d=t.prefs.device_consumption.map(t=>t.stat_consumption);d.sort((t,e)=>c[e]-c[t]);const h=[],{summedData:p,compareSummedData:_}=(0,l.gv)(t),u="from_grid"in p||"solar"in p||"from_battery"in p,{consumption:g,compareConsumption:f}=u?(0,l.DR)(p,_):{consumption:void 0,compareConsumption:void 0};if(s){const e=this._processDataSet(a,s,t.statsMetadata,t.prefs.device_consumption,d,i,!0);if(h.push(...e),u){const t=this._processUntracked(a,e,f,!0);h.push(t)}}h.push({id:"compare-placeholder",type:"bar",stack:t.statsCompare?"devicesCompare":"devices",data:[]});const v=this._processDataSet(a,e,t.statsMetadata,t.prefs.device_consumption,d,i);if(h.push(...v),this._legendData=v.map(t=>({id:t.id,secondaryIds:[`compare-${t.id}`],name:t.name,itemStyle:{color:t.color,borderColor:t.itemStyle?.borderColor}})),u){const t=this._processUntracked(a,v,g,!1);h.push(t),this._legendData.push({id:t.id,secondaryIds:[`compare-${t.id}`],name:t.name,itemStyle:{color:t.color,borderColor:t.itemStyle?.borderColor}})}(0,y.RR)(h),this._chartData=h}_processUntracked(t,e,s,a){const o={};e.forEach(t=>{t.data.forEach(t=>{o[t[a?2:0]]=(o[t[a?2:0]]||0)+t[1]})});const r=(0,y.ok)(this._start,this._compareStart),i=[];Object.keys(s.used_total).sort((t,e)=>Number(t)-Number(e)).forEach(t=>{const e=Number(t),n=[e,s.used_total[t]-(o[t]||0)];a&&(n[2]=n[0],n[0]=r(new Date(e)).getTime()),i.push(n)});const n=Date.now();return{type:"bar",cursor:"default",id:a?`compare-untracked-${n}`:`untracked-${n}`,name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),itemStyle:{borderColor:(0,_.g)(t,this.hass.themes.darkMode,!1,a,"--history-unknown-color")},barMaxWidth:50,color:(0,_.g)(t,this.hass.themes.darkMode,!0,a,"--history-unknown-color"),data:i,stack:a?"devicesCompare":"devices"}}_processDataSet(t,e,s,a,o,r,i=!1){const n=[],c=(0,y.ok)(this._start,this._compareStart);return a.forEach((a,d)=>{const h=o.indexOf(a.stat_consumption);if(this._config?.max_devices&&h>=this._config.max_devices)return void console.warn(`Max devices exceeded for ${a.name} (${h} >= ${this._config.max_devices})`);const _=(0,p.fI)(d,t);let u=null;const l=[];if(a.stat_consumption in e){const t=e[a.stat_consumption];for(const s of t){if(null===s.change||void 0===s.change||0===s.change)continue;if(u===s.start)continue;let t=0;(r[a.stat_consumption]||[]).forEach(a=>{const o=e[a];t+=o?.find(t=>t.start===s.start)?.change||0});const o=[s.start,s.change-t];i&&(o[2]=o[0],o[0]=c(new Date(s.start)).getTime()),l.push(o),u=s.start}}const g=(a.name||(0,m.$O)(this.hass,a.stat_consumption,s[a.stat_consumption]))+(a.stat_consumption in r?` (${this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked")})`:"");n.push({type:"bar",cursor:"default",id:i?`compare-${a.stat_consumption}-${h}`:`${a.stat_consumption}-${h}`,name:g,itemStyle:{borderColor:i?_+"7F":_},barMaxWidth:50,color:i?_+"32":_+"7F",data:l,stack:i?"devicesCompare":"devices"})}),o.map(t=>n.find(e=>this._getStatIdFromId(e.id)===t)).filter(Boolean)}_getStatIdFromId(t){return t.replace(/^compare-/,"").replace(/-\d+$/,"")}constructor(...t){super(...t),this._chartData=[],this._start=(0,i.R)(),this._end=(0,r.o)(),this._hiddenStats=[],this.hassSubscribeRequiredHostProps=["_config"],this._formatTotal=t=>this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,b.ZV)(t,this.hass.locale),unit:S}),this._createOptions=(0,h.A)((t,e,s,a,o,r,i)=>{const n=(0,y.od)(t,e,s,a,o,r,i,this._formatTotal),c=this._legendData?this._legendData.filter(t=>t.id&&this._hiddenStats.includes(this._getStatIdFromId(t.id))).reduce((t,e)=>(t[e.id]=!1,t),{}):{};return{...n,legend:{show:!0,type:"custom",data:this._legendData,selected:c},grid:{top:15,bottom:0,left:1,right:1,containLabel:!0}}})}}C.styles=n.AH`.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}`,(0,o.Cg)([(0,c.MZ)({attribute:!1})],C.prototype,"hass",void 0),(0,o.Cg)([(0,c.wk)()],C.prototype,"_config",void 0),(0,o.Cg)([(0,c.wk)()],C.prototype,"_chartData",void 0),(0,o.Cg)([(0,c.wk)()],C.prototype,"_data",void 0),(0,o.Cg)([(0,c.wk)()],C.prototype,"_legendData",void 0),(0,o.Cg)([(0,c.wk)()],C.prototype,"_start",void 0),(0,o.Cg)([(0,c.wk)()],C.prototype,"_end",void 0),(0,o.Cg)([(0,c.wk)()],C.prototype,"_compareStart",void 0),(0,o.Cg)([(0,c.wk)()],C.prototype,"_compareEnd",void 0),(0,o.Cg)([(0,c.wk)(),(0,v.I)({key:"energy-devices-hidden-stats",state:!0,subscribe:!1})],C.prototype,"_hiddenStats",void 0),C=(0,o.Cg)([(0,c.EM)("hui-energy-devices-detail-graph-card")],C),a()}catch(t){a(t)}})},6116(t,e,s){s.d(e,{o:()=>r});var a=s(6439),o=s(83339);function r(t,e,s){const r=(0,o.b)(t,e)/6e4;return(0,a.u)(s?.roundingMethod)(r)}},40600(t,e,s){s.d(e,{o:()=>o});var a=s(73983);function o(t){return(0,a.D)(Date.now(),t)}},81859(t,e,s){s.d(e,{R:()=>o});var a=s(35932);function o(t){return(0,a.o)(Date.now(),t)}}};
//# sourceMappingURL=39565.ed590f1eeadff8c7.js.map