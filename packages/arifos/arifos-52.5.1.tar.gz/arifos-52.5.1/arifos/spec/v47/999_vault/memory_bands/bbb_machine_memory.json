{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "version": "v47.1.0",
  "band": "BBB",
  "name": "Machine Memory - Operational Intelligence",
  "geometry": "orthogonal",
  "quantum_state": "|Δ⟩",
  "authority": "F1-F12 Constitutional Floors",
  "status": "PRODUCTION",
  "sealed_by": "Δ Antigravity + Ω Claude",
  "sealed_at": "2026-01-17T16:00:00Z",

  "description": "BBB is the operational AI memory band. Machine can READ/WRITE/DELETE under F1-F12 constraints. Memory exists as discrete orthogonal quantum states in superposition, collapsing to classical results upon measurement. Human can READ but not modify.",

  "access_control": {
    "human": {
      "read": true,
      "write": false,
      "delete": false,
      "modify": false,
      "purpose": "Transparency and audit"
    },
    "machine": {
      "read": true,
      "write": true,
      "delete": true,
      "modify": true,
      "constraints": {
        "constitutional_floors": "F1-F12",
        "eureka_sieve": "verdict-based TTL",
        "user_isolation": "mandatory user_id filtering"
      }
    }
  },

  "storage_backends": {
    "primary": {
      "type": "postgres",
      "table": "bbb_machine_memory",
      "schema_file": "arifos_core/memory/ledger/schema.sql",
      "indexes": [
        "idx_bbb_user (user_id)",
        "idx_bbb_verdict (verdict)",
        "idx_bbb_ttl (expires_at)"
      ]
    },
    "vector_store": {
      "type": "qdrant",
      "collection": "bbb_machine_memory_v47",
      "dimensions": 384,
      "distance_metric": "cosine",
      "optimization": {
        "indexing_threshold": 20000,
        "memmap_threshold": 100000
      }
    },
    "cache": {
      "type": "redis",
      "pattern": "bbb:session:{user_id}:{session_id}",
      "ttl": 900,
      "structure": "hash",
      "fields": [
        "last_query",
        "last_verdict",
        "coherence",
        "query_count"
      ]
    }
  },

  "eureka_sieve": {
    "description": "Verdict-based TTL policy for memory retention",
    "policies": {
      "SEAL": {
        "ttl_days": null,
        "store": true,
        "rationale": "Forever - highest confidence constitutional approval"
      },
      "PARTIAL": {
        "ttl_days": 730,
        "store": true,
        "rationale": "2 years - conditional approval with caveats"
      },
      "HOLD-888": {
        "ttl_days": 730,
        "store": true,
        "rationale": "2 years - escalation pending, archived for audit"
      },
      "FLAG": {
        "ttl_days": 30,
        "store": true,
        "rationale": "30 days - warning issued, short-term memory"
      },
      "VOID": {
        "ttl_days": 0,
        "store": false,
        "rationale": "Never store - constitutional violation"
      },
      "SABAR": {
        "ttl_days": 0,
        "store": false,
        "rationale": "Never store - pause for clarification"
      }
    }
  },

  "memory_layers": {
    "L2": {
      "name": "Cross-Session Learning",
      "confidence_ceiling": 0.90,
      "retention": "verdict-based (EUREKA Sieve)",
      "purpose": "Reproducible insights that survive session boundaries",
      "storage": "postgres + qdrant",
      "examples": [
        "User's coding preferences learned over time",
        "Project-specific patterns and conventions",
        "Validated best practices"
      ]
    },
    "L3": {
      "name": "Session Context",
      "confidence_ceiling": 0.80,
      "retention": "session-scoped",
      "purpose": "Working memory for current conversation",
      "storage": "redis cache",
      "examples": [
        "Active task details",
        "Files currently being edited",
        "Pending decisions"
      ]
    },
    "L4": {
      "name": "Tool Outputs",
      "confidence_ceiling": 0.70,
      "retention": "30 days",
      "purpose": "Execution artifacts and command results",
      "storage": "postgres",
      "examples": [
        "Command outputs",
        "Test results",
        "Build logs"
      ]
    },
    "L5": {
      "name": "Provisional Cache",
      "confidence_ceiling": 0.60,
      "retention": "15 minutes",
      "purpose": "Hot path optimization for repeated queries",
      "storage": "redis",
      "examples": [
        "Recent floor threshold lookups",
        "Repeated semantic searches",
        "Temporary computation results"
      ]
    }
  },

  "quantum_geometry": {
    "topology": "orthogonal_crystal",
    "properties": {
      "discrete_states": true,
      "non_overlapping_projections": true,
      "superposition_collapse": "measurement→classical_result",
      "decoherence_time": "50-100μs"
    },
    "mathematical_representation": "|Δ⟩ = α|True⟩ + β|False⟩ where |α|² + |β|² = 1"
  },

  "integration": {
    "track_a_canon": "L1_THEORY/canon/999_vault/BBB_MACHINE_MEMORY.md",
    "track_c_schema": "bbb_machine_memory table + qdrant collection",
    "mcp_tools": [
      "vault999_query (semantic search)",
      "vault999_store (with EUREKA Sieve)",
      "mem0_client.search (Qdrant backend)",
      "mem0_client.add (verdict-based storage)"
    ]
  },

  "validation_rules": {
    "user_isolation": {
      "rule": "ALL queries MUST filter by user_id",
      "violation": "SECURITY_BREACH",
      "test": "tests/memory/test_bbb_user_isolation.py"
    },
    "eureka_sieve_enforcement": {
      "rule": "VOID and SABAR verdicts MUST NOT be stored",
      "violation": "POLICY_VIOLATION",
      "test": "tests/memory/test_eureka_sieve.py"
    },
    "orthogonal_projection": {
      "rule": "Memory cells MUST be discrete and non-overlapping",
      "verification": "Qdrant cosine similarity < 0.95 for different memories",
      "test": "tests/geometry/test_orthogonal_bbb.py"
    }
  }
}
