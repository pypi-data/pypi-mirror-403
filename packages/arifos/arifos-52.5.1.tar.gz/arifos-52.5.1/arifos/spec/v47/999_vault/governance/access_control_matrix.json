{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "version": "v47.1.0",
  "name": "VAULT-999 Access Control Matrix",
  "enforcement": "F11 Command Authority",
  "status": "PRODUCTION",
  "sealed_by": "ARIF FAZIL + Δ Antigravity",
  "sealed_at": "2026-01-17T17:00:00Z",

  "description": "Defines access permissions across AAA/BBB/CCC memory bands and cross-band query rules. F11 Command Authority enforces AAA sovereignty.",

  "access_matrix": {
    "AAA": {
      "band": "AAA",
      "geometry": "toroidal",
      "human": {
        "read": true,
        "write": true,
        "delete": true,
        "modify": true,
        "authentication": "PGP_KEY_REQUIRED"
      },
      "machine": {
        "read": false,
        "write": false,
        "delete": false,
        "modify": false,
        "query_attempt": "FORBIDDEN",
        "violation_response": {
          "verdict": "VOID",
          "action": "audit_log",
          "alert_type": "F11_SOVEREIGNTY_BREACH",
          "penalty": "session_termination",
          "escalation": "human_notification"
        }
      },
      "rationale": "AAA is sacred human memory. Machine access violates F11 Command Authority."
    },

    "BBB": {
      "band": "BBB",
      "geometry": "orthogonal",
      "human": {
        "read": true,
        "write": false,
        "delete": false,
        "modify": false,
        "purpose": "Transparency and audit oversight"
      },
      "machine": {
        "read": true,
        "write": true,
        "delete": true,
        "modify": true,
        "constraints": [
          "F1-F12 constitutional floors",
          "EUREKA Sieve (verdict-based TTL)",
          "User isolation (mandatory user_id filter)"
        ],
        "verdict_based_storage": {
          "SEAL": "store_forever",
          "PARTIAL": "store_730_days",
          "VOID": "never_store",
          "SABAR": "never_store"
        }
      },
      "rationale": "BBB is operational AI memory. Machine needs write access for learning. Human can audit but not manipulate."
    },

    "CCC": {
      "band": "CCC",
      "geometry": "fractal",
      "human": {
        "read": true,
        "write": false,
        "delete": false,
        "modify": "phoenix72_only",
        "amendment_protocol": "72-hour cooling + sovereign SEAL"
      },
      "machine": {
        "read": true,
        "write": false,
        "delete": false,
        "modify": false,
        "read_purpose": "Constitutional floor threshold lookups",
        "immutability": "hash_chain_enforced"
      },
      "rationale": "CCC is immutable constitutional law. Read-only except via Phoenix-72 amendments."
    }
  },

  "cross_band_queries": {
    "description": "Rules for querying across memory band boundaries",

    "AAA_to_BBB": {
      "allowed": false,
      "rationale": "AAA is human-only. No outbound queries to machine memory.",
      "violation": "FORBIDDEN"
    },

    "AAA_to_CCC": {
      "allowed": false,
      "rationale": "AAA is sovereign. No constitutional checks on human memory.",
      "violation": "FORBIDDEN"
    },

    "BBB_to_AAA": {
      "allowed": false,
      "rationale": "Machine accessing AAA violates F11 Command Authority.",
      "violation": "VOID + F11_ALERT"
    },

    "BBB_to_CCC": {
      "allowed": true,
      "access_type": "READ_ONLY",
      "purpose": "Floor threshold lookups for constitutional validation",
      "cached": true,
      "cache_location": "redis:ccc:floor:{floor_id}",
      "example_query": "SELECT threshold_value FROM ccc_constitutional_floors WHERE floor_id = 'F2'",
      "rationale": "Machine memory must validate against constitutional floors."
    },

    "CCC_to_AAA": {
      "allowed": false,
      "rationale": "Constitutional law doesn't query human memory.",
      "violation": "FORBIDDEN"
    },

    "CCC_to_BBB": {
      "allowed": true,
      "access_type": "VALIDATION",
      "purpose": "Floor checks validate machine memory operations",
      "direction": "CCC validates BBB writes",
      "example": "Before storing to bbb_machine_memory, check F2 (Truth) >= 0.99",
      "rationale": "Constitutional floors govern machine memory operations."
    }
  },

  "enforcement_mechanisms": {
    "F11_protection": {
      "layer": "application",
      "implementation": "arifos_core/mcp/tools/memory_vault.py",
      "check": "if band == 'AAA' and requester == 'machine': return VOID",
      "audit": "aaa_human_vault_index.machine_access_attempts counter"
    },

    "user_isolation": {
      "layer": "database",
      "implementation": "WHERE user_id = ?",
      "enforcement": "ALL BBB queries MUST include user_id filter",
      "violation": "SECURITY_BREACH"
    },

    "immutability": {
      "layer": "database",
      "implementation": "hash_chain + append-only cooling_ledger",
      "verification": "verify_hash_chain() function",
      "violation": "TAMPER_DETECTED"
    }
  },

  "violation_responses": {
    "F11_BREACH": {
      "verdict": "VOID",
      "log_to": "cooling_ledger",
      "alert_human": true,
      "terminate_session": true,
      "severity": "CRITICAL"
    },

    "USER_ISOLATION_BREACH": {
      "verdict": "VOID",
      "log_to": "cooling_ledger",
      "alert_human": true,
      "terminate_session": false,
      "severity": "HIGH"
    },

    "IMMUTABILITY_BREACH": {
      "verdict": "VOID",
      "log_to": "cooling_ledger",
      "alert_human": true,
      "restore_from_backup": true,
      "severity": "CRITICAL"
    },

    "EUREKA_SIEVE_VIOLATION": {
      "verdict": "SABAR",
      "log_to": "cooling_ledger",
      "alert_human": false,
      "severity": "MEDIUM"
    }
  },

  "integration": {
    "track_a_canon": "L1_THEORY/canon/999_vault/*.md (AAA/BBB/CCC boundaries documented)",
    "track_b_specs": "L2_PROTOCOLS/v47/999_vault/memory_bands/*.json",
    "track_c_enforcement": "arifos_core/memory/ledger/schema.sql (constraints + triggers)",
    "mcp_layer": "vault999_query validates band access before database query"
  },

  "test_requirements": {
    "tests/integration/test_aaa_f11_enforcement.py": "Machine query to AAA → VOID verdict",
    "tests/integration/test_bbb_user_isolation.py": "User A cannot see User B's memories",
    "tests/integration/test_ccc_immutability.py": "Direct writes to CCC → ERROR",
    "tests/integration/test_cross_band_queries.py": "BBB→CCC READ allowed, BBB→AAA FORBIDDEN"
  }
}
