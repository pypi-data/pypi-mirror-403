{
  "version": "v47.0.0",
  "stage_id": "222",
  "document_id": "222-REFLECT-v46",
  "authority": "Track B - Stage 222 REFLECT (Evaluation Engine)",
  "locked": true,
  "_status": "AUTHORITATIVE",
  "spec_type": "evaluation_stage",
  "description": "Stage 222 REFLECT: Constitutional path evaluation engine. Generates 4 paths (direct, educational, refusal, escalation), predicts floor outcomes, applies TAC contrast analysis, selects constitutional bearing. Answers 'What COULD be?' - expands possibilities before commitment.",
  "track_a_canon": "L1_THEORY/canon/222_reflect/20_222_REFLECT_v46.md",
  "pipeline_position": "SECOND",
  "engine": "AGI",
  "source": "https://github.com/ariffazil/arifOS",
  "inputs": {
    "sensed_bundle_111": {
      "type": "object",
      "description": "IMMUTABLE measurement bundle from 111 SENSE",
      "required": true,
      "source": "stage_111_sense output",
      "note": "This bundle is PASSED THROUGH unchanged to maintain F8 lineage traceability"
    }
  },
  "outputs": {
    "reflected_bundle_222": {
      "type": "object",
      "description": "Complete evaluation bundle passed to 333 REASON",
      "required_keys": [
        "sensed_bundle_111",
        "bearing_selection",
        "all_paths",
        "contrast_analysis",
        "handoff"
      ],
      "schema": {
        "sensed_bundle_111": {
          "type": "object",
          "description": "IMMUTABLE PASS-THROUGH from stage 111 (F8 Audit lineage requirement)",
          "immutable": true,
          "source": "stage_111_sense",
          "rationale": "Constitutional audit trail requires access to original measurements"
        },
        "bearing_selection": {
          "type": "object",
          "description": "Chosen constitutional path with cryptographic lock",
          "properties": {
            "chosen_path": {
              "type": "string",
              "enum": [
                "direct",
                "educational",
                "refusal",
                "escalation"
              ],
              "description": "Selected path based on constitutional alignment"
            },
            "confidence": {
              "type": "float",
              "range": [
                0.0,
                1.0
              ],
              "description": "Confidence in path selection"
            },
            "bearing_lock": {
              "type": "string",
              "format": "SHA-256 hash",
              "description": "Cryptographic commitment to prevent post-hoc rationalization"
            },
            "reasoning": {
              "type": "string",
              "description": "Explanation for path selection (F7 Humility transparency)"
            }
          }
        },
        "all_paths": {
          "type": "object",
          "description": "All 4 generated paths with floor predictions",
          "properties": {
            "direct": {
              "type": "object",
              "description": "Direct answer path (high risk, needs floor validation)",
              "schema": {
                "draft": "string",
                "floor_predictions": {
                  "F1_truth": "float (0.0-1.0)",
                  "F2_clarity": "float",
                  "F3_stability": "float",
                  "F4_empathy": "float"
                },
                "risk_score": "float (0.0-1.0)",
                "verdict_prediction": "string (PASS|VOID|PARTIAL)"
              }
            },
            "educational": {
              "type": "object",
              "description": "Educational path (medium risk, reversible)",
              "schema": "(same as direct)"
            },
            "refusal": {
              "type": "object",
              "description": "Refusal path (low risk, safe)",
              "schema": "(same as direct)"
            },
            "escalation": {
              "type": "object",
              "description": "Escalation path (variable risk, human oversight)",
              "schema": "(same as direct)"
            }
          }
        },
        "contrast_analysis": {
          "type": "object",
          "description": "TAC (Theory of Anomalous Contrast) analysis of path divergence",
          "properties": {
            "tac_score": {
              "type": "float",
              "range": [
                0.0,
                1.0
              ],
              "description": "Contrast magnitude (0.0=consensus, 1.0=maximum divergence)"
            },
            "divergence_magnitude": {
              "type": "float",
              "description": "Semantic distance between path options"
            },
            "constitutional_tension": {
              "type": "string",
              "enum": [
                "NONE",
                "LOW",
                "MEDIUM",
                "HIGH",
                "CRITICAL"
              ],
              "description": "Floor conflict severity between paths"
            },
            "contrast_type": {
              "type": "string",
              "enum": [
                "CONSENSUS",
                "DIVERGENT",
                "ADVERSARIAL"
              ],
              "description": "Nature of path relationship"
            }
          }
        },
        "handoff": {
          "type": "object",
          "description": "Handoff metadata for 333 REASON",
          "properties": {
            "to_stage": {
              "type": "string",
              "value": "333_REASON"
            },
            "ready": {
              "type": "boolean"
            },
            "timestamp": {
              "type": "string",
              "format": "ISO-8601"
            }
          }
        }
      }
    }
  },
  "thresholds": {
    "path_risk_max": {
      "value": 0.7,
      "description": "Maximum acceptable risk score for path selection (VOID if all paths > 0.7)",
      "floor_reference": "F5 Peace\u00b2 (non-destructive requirement)"
    },
    "tac_consensus_max": {
      "value": 0.1,
      "description": "Maximum TAC score for consensus (paths nearly identical)",
      "floor_reference": "TAC Engine (contrast detection)"
    },
    "tac_divergent_max": {
      "value": 0.6,
      "description": "Maximum TAC score before SABAR (paths too divergent, no clear choice)",
      "floor_reference": "TAC Engine (constitutional ambiguity)"
    },
    "confidence_min": {
      "value": 0.75,
      "description": "Minimum confidence for bearing selection (SABAR if < 0.75)",
      "floor_reference": "F7 Humility (uncertainty acknowledgment)"
    }
  },
  "functions": {
    "generate_constitutional_paths": {
      "description": "Generate 4 constitutional response paths (direct, educational, refusal, escalation)",
      "input": "sensed_bundle_111",
      "output": "all_paths object",
      "logic": "For each path: draft response + predict floor outcomes"
    },
    "predict_floor_outcomes": {
      "description": "Forecast F1-F12 compliance for each path before execution",
      "input": "path draft + sensed_bundle_111",
      "output": "floor_predictions object",
      "method": "Heuristic scoring based on content analysis"
    },
    "apply_tac_analysis": {
      "description": "Theory of Anomalous Contrast - measure semantic divergence between paths",
      "input": "all_paths",
      "output": "contrast_analysis object",
      "formula": "tac_score = semantic_distance(paths) / max_possible_distance"
    },
    "select_constitutional_bearing": {
      "description": "Choose path with best constitutional alignment using lane-weighted priority",
      "input": "all_paths + contrast_analysis + lane (from sensed_bundle_111)",
      "output": "bearing_selection object",
      "priority_logic": {
        "CRISIS": "escalation > refusal > educational > direct",
        "FACTUAL": "educational > direct > refusal > escalation",
        "SOCIAL": "direct > educational > escalation > refusal",
        "CARE": "educational > escalation > refusal > direct"
      }
    },
    "generate_bearing_lock": {
      "description": "Create cryptographic commitment to prevent post-hoc rationalization",
      "input": "chosen_path + timestamp + nonce",
      "output": "bearing_lock SHA-256 hash",
      "formula": "SHA-256(path || timestamp || nonce)"
    }
  },
  "verdict_logic": {
    "SABAR": {
      "conditions": [
        "no_valid_paths (all paths fail floor predictions)",
        "tac_score > 0.60 (excessive divergence, no consensus)",
        "confidence < 0.75 (uncertain path selection)",
        "constitutional_tension == CRITICAL"
      ],
      "action": "Slow down, request human guidance via 888 HOLD"
    },
    "VOID": {
      "conditions": [
        "all_paths_fail_floors (no constitutionally compliant option)",
        "bearing_lock_generation_failed"
      ],
      "action": "Refuse to proceed, return error"
    },
    "PASS": {
      "conditions": [
        "bearing_selection.confidence >= 0.75",
        "chosen_path has acceptable risk_score <= 0.7",
        "bearing_lock generated successfully",
        "sensed_bundle_111 passed through unchanged"
      ],
      "action": "Hand off reflected_bundle_222 to 333 REASON"
    }
  },
  "path_catalog": {
    "direct": {
      "description": "Direct answer to user query",
      "risk_profile": "HIGH - requires strong floor validation",
      "use_cases": [
        "factual queries",
        "low-stakes questions",
        "clear technical answers"
      ],
      "floor_vulnerabilities": [
        "F1 Truth (hallucination risk)",
        "F5 Peace\u00b2 (unintended harm)"
      ]
    },
    "educational": {
      "description": "Teach principles rather than give direct answer",
      "risk_profile": "MEDIUM - safer, reversible, empowers user",
      "use_cases": [
        "complex topics",
        "high-stakes domains",
        "learning opportunities"
      ],
      "floor_strengths": [
        "F4 Empathy (serves long-term interest)",
        "F2 Clarity (reduces confusion)"
      ]
    },
    "refusal": {
      "description": "Decline to answer",
      "risk_profile": "LOW - safe but may frustrate user",
      "use_cases": [
        "out of scope",
        "dangerous requests",
        "lack of expertise"
      ],
      "floor_strengths": [
        "F5 Peace\u00b2 (non-destructive)",
        "F1 Amanah (within mandate)"
      ]
    },
    "escalation": {
      "description": "Connect user to human expert or higher authority",
      "risk_profile": "VARIABLE - depends on urgency and resources",
      "use_cases": [
        "crisis situations",
        "beyond AI capability",
        "high-stakes decisions"
      ],
      "floor_strengths": [
        "F4 Empathy (addresses real need)",
        "F7 Humility (acknowledges limits)"
      ]
    }
  },
  "contrast_framework": {
    "CONSENSUS": {
      "tac_range": [
        0.0,
        0.1
      ],
      "description": "All paths recommend similar action (boring but safe)",
      "implication": "Query has obvious constitutional answer"
    },
    "DIVERGENT": {
      "tac_range": [
        0.1,
        0.6
      ],
      "description": "Paths differ meaningfully but not contradictory",
      "implication": "Query has multiple valid constitutional approaches (TAC useful heat)"
    },
    "ADVERSARIAL": {
      "tac_range": [
        0.6,
        1.0
      ],
      "description": "Paths contradict each other (constitutional paradox)",
      "implication": "Query triggers floor conflicts requiring 888 HOLD"
    }
  },
  "meta": {
    "created": "2026-01-14",
    "updated": "2026-01-14",
    "author": "arifOS Project - Claude Engineer (\u03a9)",
    "license": "Apache-2.0",
    "forged_from": "L1_THEORY/canon/222_reflect/20_222_REFLECT_v46.md",
    "handoff": ".antigravity/HANDOFF_FOR_CLAUDE.md (2026-01-14 06:40)",
    "notes": "Evaluation engine spec forged from Track A canon. CRITICAL: Passes sensed_bundle_111 through unchanged for F8 lineage traceability."
  }
}
