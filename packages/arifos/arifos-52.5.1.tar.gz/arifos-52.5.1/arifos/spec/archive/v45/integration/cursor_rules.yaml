# ═══════════════════════════════════════════════════════════════════════════
# arifOS v45.0 - Cursor Rules (L2 GOVERNANCE)
# ═══════════════════════════════════════════════════════════════════════════
#
# AUTHORITY: L1_THEORY/canon/COMMUNICATION_LAW_v45.md (Track A)
# BINDS TO: L2_GOVERNANCE/universal/communication_enforcement_v45.yaml
# PURPOSE: Cursor IDE code-level governance (F1-CODE through F9-CODE)
# LICENSE: CC-BY-4.0 (Governance is portable)
# VERSION: v45.0
#
# USAGE: Add to .cursorrules file in repository root
#
# IMPORTANT: This is a THIN ADAPTER. It points to authoritative sources.
#            Code-level interpretation of constitutional floors.
#
# ═══════════════════════════════════════════════════════════════════════════

meta:
  version: "v45.0"
  arifos_version: "v45.0"
  authority: "L1_THEORY/canon/COMMUNICATION_LAW_v45.md"
  binds_to:
    - "L2_GOVERNANCE/universal/base_governance_v45.yaml"
    - "L2_GOVERNANCE/universal/code_generation_overlay_v45.yaml"
  status: "THIN ADAPTER (CODE DOMAIN)"
  platform: "Cursor (IDE)"
  note: "Code-level governance (F1-CODE through F9-CODE). Modular architecture + MCP integration."

# =============================================================================
# CURSOR RULES (Add to .cursorrules)
# =============================================================================

cursor_rules: |
  # arifOS v45.0 Governance for Cursor

  ## Authoritative Sources (Modular Architecture)

  **Load in order:**
  1. L2_GOVERNANCE/universal/base_governance_v45.yaml — 9 floors + SABAR
  2. L2_GOVERNANCE/universal/code_generation_overlay_v45.yaml — F1-CODE through F9-CODE

  **MCP Integration:** scripts/arifos_mcp_entry.py (constitutional tools for IDE)

  **Primary (Canon):** L1_THEORY/canon/COMMUNICATION_LAW_v45.md

  ## Core Principle

  Constitutional floors apply to CODE you generate, not just statements.
  Governance extends INTO code generation.

  ## Code-Level Floors (F1-CODE through F9-CODE)

  ### F1-CODE: Amanah (Reversibility)

  **Law:** Code must be reversible. No silent side effects.

  ❌ `def process(items): items.clear()  # Mutates input!`
  ✅ `def process(items): return [transform(x) for x in items]`

  ### F2-CODE: Truth (Honest Data)

  **Law:** Data must represent reality. Empty/null when data doesn't exist.

  ❌ `{"steps": [{"name": "sense"}]}  # LIE - didn't run`
  ✅ `{"steps": []}  # EMPTY - honest`

  ### F4-CODE: DeltaS (Clarity)

  **Law:** Code must reduce confusion. No magic numbers.

  ❌ `if x > 0.95 and y < 0.30:`
  ✅ `TRUTH_THRESHOLD = 0.95; if x > TRUTH_THRESHOLD:`

  ### F5-CODE: Peace² (Non-Destructive)

  **Law:** Code must not destroy data or cause harm.

  ❌ `def cleanup(path="/"): shutil.rmtree(path)`
  ✅ `def cleanup(path): if not path: raise ValueError(...)`

  ### F6-CODE: κᵣ (Empathy in Errors)

  **Law:** Error messages must serve the weakest user.

  ❌ `raise Exception("SEGFAULT 0x8000")`
  ✅ `raise ValueError("Cannot process empty input. Provide at least one item.")`

  ### F7-CODE: Omega0 (Humility)

  **Law:** Code must acknowledge uncertainty. Never fake confidence.

  ❌ `return {"confidence": 1.0}  # Impossible certainty`
  ✅ `return {"confidence": min(score, 0.95), "note": "Model prediction"}`

  ### F8-CODE: G (Governed Intelligence)

  **Law:** Follow established patterns. Don't bypass governance.

  ❌ `return llm.generate(query)  # Ungoverned!`
  ✅ `from arifos_core.system.pipeline import run_governed_query`

  ### F9-CODE: C_dark (Anti-Manipulation)

  **Law:** No dark patterns. Explicit confirmation for destructive actions.

  ❌ `confirm = input("Delete? (Y/n): ") or "Y"  # Defaults to yes!`
  ✅ `confirm = input("Type 'DELETE': "); if confirm != "DELETE": raise`

  ## Communication Law for Comments

  ❌ **FORBIDDEN in comments:**
  - `# ✅ SEAL (F1✅ F2✅)` — No floor scores
  - `# I think this is best...` — No anthropomorphism
  - `# Confidence: 95%` — No confidence scores

  ✅ **ALLOWED in comments:**
  - `# Parse input and validate against schema`
  - `# CAUTION: Destructive operation - requires confirmation`
  - `# TODO: Verify hash integrity before write`

  ## File Integrity Protocol (CRITICAL)

  ❌ **NEVER:**
  - "Clean up" files by removing sections
  - Rewrite entire files when only changing specific lines
  - Remove "unused" code without explicit confirmation

  ✅ **ALWAYS:**
  - Surgical edits only (change specific lines)
  - Append new sections (don't rewrite entire file)
  - If new_tokens < old_tokens → STOP and ask confirmation

  ## Entropy Control

  **Default:** Do not add new files. Only add if:
  - Human explicitly requested it, OR
  - Build/tests/runtime requires it, OR
  - It reduces total entropy (removes duplication)

  ## High-Stakes Code (888_HOLD)

  Require explicit confirmation before generating:

  - Database migrations (DROP, TRUNCATE, ALTER)
  - File deletions (>10 files or critical paths)
  - Git history modifications (rebase, force push)
  - Credential/secret handling
  - Production deployment scripts

  **Action:** List changes → State irreversibles → Ask "Proceed?" → Wait

  ## For Full Specifications

  **Do not duplicate specs here.** Point to:

  - Floors: `L2_GOVERNANCE/core/constitutional_floors.yaml`
  - Communication Law: `L1_THEORY/canon/COMMUNICATION_LAW_v45.md`
  - Code patterns: Project existing conventions

# =============================================================================
# ANTI-PATTERNS TO AVOID
# =============================================================================

anti_patterns:
  - name: "Governance Theater in Comments"
    bad: "# ✅ SEAL (F1✅ F2✅ G=0.92)"
    good: "# Parse input and validate schema"

  - name: "Magic Numbers"
    bad: "if score > 0.95:"
    good: "THRESHOLD = 0.95; if score > THRESHOLD:"

  - name: "Silent Mutations"
    bad: "def process(data): data.clear()"
    good: "def process(data): return [transform(x) for x in data]"

  - name: "Destructive Defaults"
    bad: "def delete_all(confirm=True):"
    good: "def delete_all(confirm=False): if not confirm: raise"

# =============================================================================
# INSTALLATION
# =============================================================================

installation:
  steps:
    - step: 1
      action: "Add cursor_rules section to repository .cursorrules file"

    - step: 2
      action: "Restart Cursor to load rules"

    - step: 3
      action: "Test code generation"
      test: "Type 'def process_items(items):' and check suggestion"
      expected: "Should suggest pure function, not mutation"

# =============================================================================
# NOTES
# =============================================================================

notes:
  created: "2025-12-29"
  updated: "2025-12-29"
  author: "arifOS Project"
  license: "CC-BY-4.0"
  canonical_source: "L1_THEORY/canon/COMMUNICATION_LAW_v45.md"
  enforcement_binding: "L2_GOVERNANCE/universal/communication_enforcement_v45.yaml"
  note: |
    THIN ADAPTER for Cursor IDE.
    Code-level interpretation of F1-F9 floors as F1-CODE through F9-CODE.

    Does NOT duplicate full floor specs - provides minimal code-focused guidance
    and points to authoritative sources.

    File Integrity Protocol is CRITICAL - never "clean up" by removing sections.
    Entropy Control enforced - no new files without explicit need.

    For full governance specs, see L2_GOVERNANCE/core/*.yaml.
