(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,884916,e=>{"use strict";var t=e.i(991047),a=e.i(283276),i=e.i(242397),r=e.i(721394);e.i(139507);var o=e.i(600943),n=e.i(7284),s=e.i(295456),l=e.i(663888),d=e.i(234308),u=e.i(45721),c=e.i(721431),h=e.i(842196),p=e.i(138961),f=e.i(11507),m=e.i(222942);function x(e){return(0,m.default)("MuiSwitch",e)}let y=(0,f.default)("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]);var g=e.i(707706);let b=(0,c.styled)("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:a}=e;return[t.root,a.edge&&t[`edge${(0,l.default)(a.edge)}`],t[`size${(0,l.default)(a.size)}`]]}})({display:"inline-flex",width:58,height:38,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"},variants:[{props:{edge:"start"},style:{marginLeft:-8}},{props:{edge:"end"},style:{marginRight:-8}},{props:{size:"small"},style:{width:40,height:24,padding:7,[`& .${y.thumb}`]:{width:16,height:16},[`& .${y.switchBase}`]:{padding:4,[`&.${y.checked}`]:{transform:"translateX(16px)"}}}}]}),w=(0,c.styled)(u.default,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{let{ownerState:a}=e;return[t.switchBase,{[`& .${y.input}`]:t.input},"default"!==a.color&&t[`color${(0,l.default)(a.color)}`]]}})((0,h.default)(({theme:e})=>({position:"absolute",top:0,left:0,zIndex:1,color:e.vars?e.vars.palette.Switch.defaultColor:`${"light"===e.palette.mode?e.palette.common.white:e.palette.grey[300]}`,transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),[`&.${y.checked}`]:{transform:"translateX(20px)"},[`&.${y.disabled}`]:{color:e.vars?e.vars.palette.Switch.defaultDisabledColor:`${"light"===e.palette.mode?e.palette.grey[100]:e.palette.grey[600]}`},[`&.${y.checked} + .${y.track}`]:{opacity:.5},[`&.${y.disabled} + .${y.track}`]:{opacity:e.vars?e.vars.opacity.switchTrackDisabled:`${"light"===e.palette.mode?.12:.2}`},[`& .${y.input}`]:{left:"-100%",width:"300%"}})),(0,h.default)(({theme:e})=>({"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.active,(e.vars||e).palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[...Object.entries(e.palette).filter((0,d.default)(["light"])).map(([t])=>({props:{color:t},style:{[`&.${y.checked}`]:{color:(e.vars||e).palette[t].main,"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[t].main,(e.vars||e).palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${y.disabled}`]:{color:e.vars?e.vars.palette.Switch[`${t}DisabledColor`]:`${"light"===e.palette.mode?e.lighten(e.palette[t].main,.62):e.darken(e.palette[t].main,.55)}`}},[`&.${y.checked} + .${y.track}`]:{backgroundColor:(e.vars||e).palette[t].main}}}))]}))),v=(0,c.styled)("span",{name:"MuiSwitch",slot:"Track"})((0,h.default)(({theme:e})=>({height:"100%",width:"100%",borderRadius:7,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:e.vars?e.vars.palette.common.onBackground:`${"light"===e.palette.mode?e.palette.common.black:e.palette.common.white}`,opacity:e.vars?e.vars.opacity.switchTrack:`${"light"===e.palette.mode?.38:.3}`}))),j=(0,c.styled)("span",{name:"MuiSwitch",slot:"Thumb"})((0,h.default)(({theme:e})=>({boxShadow:(e.vars||e).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"}))),k=o.forwardRef(function(e,a){let i=(0,p.useDefaultProps)({props:e,name:"MuiSwitch"}),{className:r,color:o="primary",edge:d=!1,size:u="medium",sx:c,slots:h={},slotProps:f={},...m}=i,y={...i,color:o,edge:d,size:u},k=(e=>{let{classes:t,edge:a,size:i,color:r,checked:o,disabled:n}=e,d={root:["root",a&&`edge${(0,l.default)(a)}`,`size${(0,l.default)(i)}`],switchBase:["switchBase",`color${(0,l.default)(r)}`,o&&"checked",n&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},u=(0,s.default)(d,x,t);return{...t,...u}})(y),C={slots:h,slotProps:f},[S,$]=(0,g.default)("root",{className:(0,n.default)(k.root,r),elementType:b,externalForwardedProps:C,ownerState:y,additionalProps:{sx:c}}),[R,B]=(0,g.default)("thumb",{className:k.thumb,elementType:j,externalForwardedProps:C,ownerState:y}),q=(0,t.jsx)(R,{...B}),[z,D]=(0,g.default)("track",{className:k.track,elementType:v,externalForwardedProps:C,ownerState:y});return(0,t.jsxs)(S,{...$,children:[(0,t.jsx)(w,{type:"checkbox",icon:q,checkedIcon:q,ref:a,ownerState:y,...m,classes:{...k,root:k.switchBase},slots:{...h.switchBase&&{root:h.switchBase},...h.input&&{input:h.input}},slotProps:{...f.switchBase&&{root:"function"==typeof f.switchBase?f.switchBase(y):f.switchBase},input:{role:"switch"},...f.input&&{input:"function"==typeof f.input?f.input(y):f.input}}}),(0,t.jsx)(z,{...D})]})});var C=e.i(691838),S=e.i(367745),$=e.i(238240),R=e.i(492192),B=e.i(707682),q=e.i(70800),z=e.i(790689),D=e.i(216382),T=e.i(411972),_=e.i(280490),I=e.i(968287),P=e.i(457918),Q=e.i(854535),A=e.i(861291),M=e.i(307215),E=e.i(149238),N=e.i(197469),O=e.i(837510),L=e.i(950655);function U({supportCalendarUrl:e="https://cal.com/team/recce/chat"}){let{data:o}=(0,O.useRecceInstanceInfo)();return(0,t.jsx)("div",{className:"flex flex-1 h-full min-h-0 m-2 p-4 bg-blue-50 rounded-lg shadow-md justify-center",children:(0,t.jsxs)("div",{className:"w-4/5 flex flex-col overflow-y-auto gap-6 px-8 pb-8",children:[(0,t.jsxs)(r.default,{alignItems:"center",spacing:2,children:[(0,t.jsx)(a.default,{sx:{p:1,bgcolor:"background.paper",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:2},children:(0,t.jsx)(a.default,{component:N.RiTerminalBoxLine,sx:{fontSize:28,color:"iochmara.500"}})}),(0,t.jsx)(S.default,{variant:"h5",sx:{mt:2},children:"Wait, there's more!"}),(0,t.jsxs)(S.default,{sx:{fontSize:"1rem",textAlign:"center"},children:["Query functions disabled without a"," ",(0,t.jsx)(S.default,{component:"span",sx:{fontWeight:"bold"},children:"data warehouse connection"})]})]}),(0,t.jsx)(r.default,{sx:{width:"50%",mt:3,mx:"auto"},children:(0,t.jsx)(i.default,{color:"iochmara",variant:"contained",size:"large",onClick:()=>{window.open((0,L.getSettingsUrl)(o,e),"_blank")},children:"Connect to Data Warehouse"})})]})})}var G=e.i(448492);let K=()=>{let{isCustomQueries:e,setCustomQueries:i,sqlQuery:o,setBaseSqlQuery:n}=(0,Q.useRecceQueryContext)();return(0,t.jsxs)(a.default,{children:[(0,t.jsxs)(r.default,{direction:"row",spacing:.5,alignItems:"center",fontSize:"0.75rem",children:[(0,t.jsx)(S.default,{variant:"body2",sx:{fontSize:"0.75rem"},children:"Custom Queries"}),(0,t.jsx)(C.default,{title:"Custom queries allow you to use two SQL queries to compare results between current and base environments.",children:(0,t.jsx)(a.default,{component:"span",sx:{display:"flex",color:"grey.600"},children:(0,t.jsx)(R.PiInfoFill,{fontSize:"1rem"})})})]}),(0,t.jsx)(k,{size:"small",checked:e,onChange:()=>{!e&&n&&n(o),i(!e)},color:"primary"})]})},W=()=>{let{sqlQuery:e,baseSqlQuery:r,setSqlQuery:n,setBaseSqlQuery:s,primaryKeys:l,setPrimaryKeys:d,isCustomQueries:u}=(0,Q.useRecceQueryContext)(),{lineageGraph:c,envInfo:h}=(0,_.useLineageGraphContext)(),{featureToggles:p,singleEnv:f}=(0,P.useRecceInstanceContext)(),m=e;h?.adapterType==="sqlmesh"&&e===Q.defaultSqlQuery&&(m="select * from db.mymodel"),"read only"===p.mode&&(m=`--- Would like to do query here? Book a demo with us at ${M.RECCE_SUPPORT_CALENDAR_URL}
${m}`);let{showRunId:x}=(0,I.useRecceActionContext)(),{apiClient:y}=(0,A.useApiConfig)(),g=async e=>{let t="query_base"===e?r??"":m,a=function(e){switch(e){case"query":return B.submitQuery;case"query_base":return B.submitQueryBase;case"query_diff":return B.submitQueryDiff;default:throw Error(`Unknown query type: ${e}`)}}(e),i={sql_template:t};"query_diff"===e&&(i.primary_keys=l,u&&(i.base_sql_template=r));let{run_id:o}=await a(i,{nowait:!0},y);return x(o),await (0,q.waitRun)(o,void 0,y)},{mutate:b,isPending:w}=(0,$.useMutation)({mutationFn:g}),v=(0,o.useMemo)(()=>{let e={};if(!c)return"N/A";for(let t in c.nodes){let a=c.nodes[t].data.data.current?.schema;a&&(e[a]=(e[a]||0)+1)}return Object.keys(e).reduce((t,a)=>e[a]>(e[t]||0)?a:t,"N/A")},[c]);return f||"metadata only"===p.mode?(0,t.jsxs)(a.default,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,t.jsxs)(a.default,{sx:{display:"flex",justifyContent:"right",alignItems:"center",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid",borderColor:"divider"},children:[(0,t.jsx)(z.HistoryToggle,{}),(0,t.jsx)(a.default,{sx:{flexGrow:1}}),f?(0,t.jsx)(C.default,{title:"Please configure the base environment before running the diff",placement:"left",children:(0,t.jsx)("span",{children:(0,t.jsx)(i.default,{variant:"contained",disabled:!0,size:"small",sx:{fontSize:"14px",mt:"16px"},children:"Run Diff"})})}):(0,t.jsx)(D.SetupConnectionPopover,{display:"metadata only"===p.mode,children:(0,t.jsx)(i.default,{variant:"contained",disabled:!0,size:"small",sx:{fontSize:"14px",mt:"16px"},children:"Run Diff"})})]}),(0,t.jsx)(G.DualSqlEditor,{value:m,onChange:n,onRun:()=>{b("query")},labels:["base (production)",`current (${v})`],SetupGuide:"metadata only"===p.mode?(0,t.jsx)(U,{}):(0,t.jsx)(T.BaseEnvironmentSetupGuide,{})})]}):(0,t.jsxs)(a.default,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,t.jsxs)(a.default,{sx:{display:"flex",justifyContent:"right",alignItems:"flex-end",padding:"4pt 8pt",gap:"5px",height:"54px",borderBottom:"1px solid",borderColor:"divider",flex:"0 0 54px"},children:[(0,t.jsx)(z.HistoryToggle,{}),(0,t.jsx)(K,{}),(0,t.jsx)(a.default,{sx:{flexGrow:1}}),(0,t.jsx)(E.QueryForm,{defaultPrimaryKeys:l,onPrimaryKeysChange:d}),(0,t.jsx)(i.default,{variant:"contained",onClick:()=>{b("query_diff")},disabled:w||p.disableDatabaseQuery,size:"small",children:"Run Diff"})]}),(0,t.jsx)(a.default,{sx:{width:"100%",flex:1,overflowY:"auto"},children:u?(0,t.jsx)(G.DualSqlEditor,{value:m,baseValue:r,onChange:n,onChangeBase:s,onRun:()=>{b("query")},onRunBase:()=>{b("query_base")},onRunDiff:()=>{b("query_diff")}}):(0,t.jsx)(G.default,{value:m,onChange:n,onRun:()=>{b("query")},onRunDiff:()=>{b("query_diff")}})})]})};function F(){return(0,t.jsx)(W,{})}e.s(["default",()=>F],884916)}]);