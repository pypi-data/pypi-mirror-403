# MySQL Server Configuration File
#
# 注意：
# 1. 这个文件应该被挂载到容器的 /etc/mysql/conf.d/my.cnf 或者 /etc/mysql/my.cnf
#    具体路径取决于 MySQL Docker 镜像的配置方式。通常 /etc/mysql/conf.d/ 目录下的 .cnf 文件会被加载。
# 2. 更改此文件后，你需要重启 MySQL 容器才能使更改生效。
# 3. 根据你的硬件资源（特别是内存）和工作负载调整这些值。

[mysqld]
# --- 基本设置 ---
# 服务器监听的IP地址。0.0.0.0 表示监听所有网络接口，这在 Docker 中是必要的。
bind-address = 0.0.0.0
port = 3306
# 服务器ID，对于主从复制是必需的，如果只是单实例可以随意设置一个唯一值。
server-id = 1
# 默认存储引擎
default-storage-engine = InnoDB
# 默认字符集和排序规则 (推荐使用 utf8mb4 以支持包括 emoji 在内的所有 Unicode 字符)
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
# 跳过反向DNS解析，可以加快连接速度
skip-name-resolve

# --- 路径设置 (通常在 Docker 容器内不需要修改，除非你有特殊需求) ---
# datadir = /var/lib/mysql  (通常由 Docker 镜像管理)
# socket = /var/run/mysqld/mysqld.sock (通常由 Docker 镜像管理)
# pid-file = /var/run/mysqld/mysqld.pid (通常由 Docker 镜像管理)
# log-error = /var/log/mysql/error.log (通常由 Docker 镜像管理，日志会输出到 stdout/stderr)

# --- InnoDB 相关设置 ---
# InnoDB 缓冲池大小，这是最重要的性能参数之一。
# 根据容器可用的内存进行调整。例如，如果容器有 4GB 内存，可以设置为 2G 或 3G。
# 对于小型应用或开发环境，128M-512M 可能就足够了。
innodb_buffer_pool_size = 256M
# InnoDB 日志文件大小。
innodb_log_file_size = 64M
# InnoDB 日志缓冲区大小。
innodb_log_buffer_size = 16M
# InnoDB I/O 线程数。通常根据 CPU 核心数设置。
innodb_read_io_threads = 4
innodb_write_io_threads = 4
# InnoDB 刷新日志到磁盘的方式。
# 1 (默认): 每次事务提交都刷新到磁盘，最安全但可能稍慢。
# 0: 每秒刷新一次，性能较好，但数据库崩溃可能丢失最后一秒的事务。
# 2: 每次事务提交都写入操作系统缓存，每秒刷新到磁盘，折中方案。
innodb_flush_log_at_trx_commit = 1
# InnoDB 锁等待超时时间（秒）
innodb_lock_wait_timeout = 50
# 开启 InnoDB 文件按表存放，每个表会生成独立的 .ibd 文件。
innodb_file_per_table = 1

# --- 日志设置 ---
# 错误日志 (通常 Docker 容器会将错误日志输出到 stderr)
log_error = /var/log/mysql/error.log

# 慢查询日志 (对于性能调优非常有用)
slow_query_log = 1
slow_query_log_file = /var/log/mysql/mysql-slow.log
# 定义什么是“慢”查询（秒）
long_query_time = 2
# 记录没有使用索引的查询到慢查询日志 (可能会产生大量日志)
# log_queries_not_using_indexes = 1

# 一般查询日志 (记录所有执行的SQL语句，非常消耗资源，仅用于调试)
general_log = 0
general_log_file = /var/log/mysql/mysql-general.log



# --- 连接和线程 ---
# 最大并发连接数。
max_connections = 151 # MySQL 默认值，根据应用需求调整
# 每个连接的线程栈大小。
thread_stack = 256K
# 线程缓存大小，用于缓存空闲的客户端连接线程。
thread_cache_size = 8
# 单个数据包/查询的最大大小。
max_allowed_packet = 64M
# 临时表的最大大小 (内存中)
tmp_table_size = 32M
max_heap_table_size = 32M

# --- SQL 模式 ---
# MySQL 8.0 默认的 sql_mode 比较严格，通常是好的。
# 对于旧应用迁移，可能需要调整。
# sql_mode = "STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION" (MySQL 5.7 默认)
# sql_mode = "ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION" (MySQL 8.0 默认)

# --- 其他 ---
# 设置时区 (如果 Docker 容器内没有设置 TZ 环境变量，可以在这里设置)
# default_time_zone = '+8:00' # 或者 'Asia/Shanghai'

# [client]
# # 客户端默认字符集
# default-character-set = utf8mb4

# [mysql]
# # mysql 命令行客户端的默认字符集
# default-character-set = utf8mb4

# [mysqldump]
# # mysqldump 工具的一些设置
# quick
# quote-names
# max_allowed_packet = 64M


