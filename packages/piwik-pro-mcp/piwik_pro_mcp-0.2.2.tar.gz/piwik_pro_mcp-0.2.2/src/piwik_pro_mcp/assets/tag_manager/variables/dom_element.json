{
  "template_name": "dom_element",
  "display_name": "DOM Element Variable",
  "description": "Extracts values from DOM elements on the page using CSS selectors or XPath. Perfect for reading form values, text content, attributes, or any data stored in HTML elements that needs to be captured for tracking purposes.",
  "ai_usage_guide": {
    "when_to_use": [
      "Extract form field values (input, select, textarea) for tracking",
      "Read text content from specific page elements (headings, product names, prices)",
      "Get attribute values from HTML elements (data attributes, IDs, classes)",
      "Capture dynamic content that changes based on user interactions",
      "Read meta information from page elements for enhanced tracking",
      "Extract product details from e-commerce pages for conversion tracking"
    ],
    "common_use_cases": [
      "Form tracking: Get values from email, name, or other form fields",
      "E-commerce: Extract product names, prices, SKUs from product pages",
      "Content tracking: Read article titles, categories, or author information",
      "User input: Capture search terms, filter selections, or user preferences",
      "Dynamic content: Get values from elements populated by JavaScript",
      "A/B testing: Read test variant information from page elements",
      "Error tracking: Capture error messages or validation states",
      "Navigation: Extract current page section or breadcrumb information"
    ],
    "best_practices": [
      "Use specific CSS selectors that uniquely identify the target element",
      "Test selectors in browser developer tools before deployment",
      "Confirm the element exists at the time the variable executes to avoid empty results",
      "Consider timing - some elements may load asynchronously",
      "Use stable selectors that won't break with design changes",
      "Validate that the element exists before attempting to read from it"
    ],
    "selector_recommendations": [
      "Prefer ID selectors (#element-id) for unique elements",
      "Use data attributes (data-track-value) for tracking-specific elements",
      "Avoid complex CSS selectors that might be fragile",
      "Test selectors across different page states and user interactions",
      "Use :nth-child() carefully as it can break with content changes"
    ]
  },
  "mcp_usage": {
    "create_variable": {
      "function_name": "create_variable",
      "description": "Create a new DOM element variable to extract values from page elements",
      "required_parameters": {
        "app_id": {
          "type": "string",
          "description": "UUID of your Piwik PRO app"
        },
        "name": {
          "type": "string",
          "description": "Descriptive name for the DOM element variable"
        },
        "variable_type": {
          "type": "string",
          "value": "dom_element",
          "description": "Must be 'dom_element' for DOM element variables"
        },
        "value": {
          "type": "string",
          "description": "Selector value used to find the DOM element (interpretation depends on selector_type)"
        },
        "options": {
          "type": "object",
          "description": "Selection settings for the DOM lookup",
          "properties": {
            "selector_type": {
              "type": "string",
              "description": "Selector strategy to use",
              "allowed_values": [
                "element_id",
                "css",
                "xpath"
              ]
            },
            "extract_text_content": {
              "type": "boolean",
              "description": "Whether to return text content (true) or the raw element HTML (false)"
            }
          }
        }
      }
    },
    "update_variable": {
      "function_name": "update_variable",
      "description": "Update an existing DOM element variable - only editable fields will be processed",
      "required_parameters": {
        "app_id": {
          "type": "string",
          "description": "UUID of your Piwik PRO app"
        },
        "variable_id": {
          "type": "string",
          "description": "UUID of the variable to update"
        }
      },
      "optional_parameters": {
        "name": {
          "type": "string",
          "description": "Updated descriptive name for the variable"
        },
        "value": {
          "type": "string",
          "description": "Updated selector value"
        },
        "options": {
          "type": "object",
          "description": "Updated selection settings",
          "properties": {
            "selector_type": {
              "type": "string",
              "description": "Selector strategy to use",
              "allowed_values": [
                "element_id",
                "css",
                "xpath"
              ]
            },
            "extract_text_content": {
              "type": "boolean",
              "description": "Whether to return text content (true) or raw element HTML (false)"
            }
          }
        }
      }
    }
  },
  "required_attributes": {
    "name": {
      "type": "string",
      "mutability": "editable",
      "description": "Descriptive name for the DOM element variable",
      "examples": [
        "Product Name",
        "Search Query",
        "User Email",
        "Current Price",
        "Error Message"
      ],
      "validation": {
        "required": true,
        "min_length": 1,
        "max_length": 255
      },
      "recommendation": "Use clear names that indicate what element value is being captured"
    },
    "template": {
      "type": "string",
      "mutability": "create-only",
      "description": "Variable template type",
      "examples": [
        "dom_element"
      ],
      "validation": {
        "required": true,
        "allowed_values": [
          "dom_element"
        ]
      },
      "edit_note": "âš ï¸ Cannot be changed after creation - template determines variable behavior"
    },
    "value": {
      "type": "string",
      "mutability": "editable",
      "description": "Selector value used to locate the DOM element",
      "examples": [
        "#product-title",
        ".price-current",
        "input[name='email']",
        "data-track-id",
        "//article//span[@class='category'][1]"
      ],
      "validation": {
        "required": true,
        "min_length": 1,
        "max_length": 500
      },
      "recommendation": "Provide a selector value that matches the chosen selector_type. For example, supply only the ID token when using 'element_id', or a full CSS/XPath expression for the other types."
    },
    "options": {
      "type": "object",
      "mutability": "editable",
      "description": "Selection settings controlling how the DOM element value is extracted",
      "validation": {
        "required_fields": [
          "selector_type",
          "extract_text_content"
        ],
        "allow_additional_properties": false
      },
      "fields": {
        "selector_type": {
          "type": "string",
          "description": "Selector interpretation mode",
          "examples": [
            "element_id",
            "css",
            "xpath"
          ],
          "validation": {
            "required": true,
            "allowed_values": [
              "element_id",
              "css",
              "xpath"
            ]
          },
          "recommendation": "Choose 'element_id' when you have a stable ID token, 'css' for CSS selectors, or 'xpath' for advanced DOM traversal."
        },
        "extract_text_content": {
          "type": "boolean",
          "description": "When true, returns the element's textContent; when false, returns the serialized element",
          "examples": [
            true,
            false
          ],
          "validation": {
            "required": true
          },
          "recommendation": "Use true for most text/attribute capture scenarios. Set to false only if you need the entire element markup."
        }
      }
    }
  },
  "optional_attributes": {},
  "read_only_attributes": {
    "created_at": {
      "mutability": "read-only",
      "description": "Timestamp when the variable was created",
      "edit_note": "ðŸš« Automatically set by the API, cannot be modified"
    },
    "updated_at": {
      "mutability": "read-only",
      "description": "Timestamp when the variable was last updated",
      "edit_note": "ðŸš« Automatically updated by the API on changes"
    }
  },
  "field_mutability_guide": {
    "description": "Understanding field editability after variable creation",
    "mutability_types": {
      "editable": {
        "description": "âœ… Can be updated anytime after creation",
        "examples": [
          "name",
          "value",
          "options.selector_type",
          "options.extract_text_content"
        ],
        "use_cases": [
          "Renaming variables",
          "Updating selectors when page structure changes",
          "Switching between CSS, XPath, or element-id selection",
          "Toggling between textContent extraction and raw element output"
        ]
      },
      "create-only": {
        "description": "âš ï¸ Set during creation, immutable after creation",
        "examples": [
          "template"
        ],
        "explanation": "Template determines the variable type and behavior - cannot be changed to maintain data integrity"
      },
      "read-only": {
        "description": "ðŸš« Auto-generated by API, never user-modifiable",
        "examples": [
          "created_at",
          "updated_at"
        ],
        "explanation": "System timestamps managed automatically by Piwik PRO"
      }
    }
  },
  "complete_examples": {
    "create_example": {
      "description": "Creating a DOM element variable to capture product name",
      "mcp_call": {
        "function": "create_variable",
        "parameters": {
          "app_id": "abc12345-1234-5678-9012-123456789abc",
          "attributes": {
            "name": "Product Name",
            "variable_type": "dom_element",
            "value": "#product-title",
            "options": {
              "selector_type": "css",
              "extract_text_content": true
            }
          }
        }
      }
    },
    "update_example": {
      "description": "Updating DOM element variable to target a different selector",
      "mcp_call": {
        "function": "update_variable",
        "parameters": {
          "app_id": "abc12345-1234-5678-9012-123456789abc",
          "variable_id": "var-67890-1234-5678-9012-123456789def",
          "attributes": {
            "name": "Enhanced Product Name",
            "value": ".product-details h1",
            "options": {
              "selector_type": "css",
              "extract_text_content": true
            }
          }
        }
      }
    },
    "form_field_example": {
      "description": "Using element ID selection and returning serialized markup",
      "mcp_call": {
        "function": "create_variable",
        "parameters": {
          "app_id": "abc12345-1234-5678-9012-123456789abc",
          "attributes": {
            "name": "Hero Banner",
            "variable_type": "dom_element",
            "value": "hero-banner",
            "options": {
              "selector_type": "element_id",
              "extract_text_content": false
            }
          }
        }
      }
    },
    "data_attribute_example": {
      "description": "Capturing text from a data attribute wrapper using CSS selector",
      "mcp_call": {
        "function": "create_variable",
        "parameters": {
          "app_id": "abc12345-1234-5678-9012-123456789abc",
          "attributes": {
            "name": "Product SKU",
            "variable_type": "dom_element",
            "value": "[data-product-sku]",
            "options": {
              "selector_type": "css",
              "extract_text_content": true
            }
          }
        }
      }
    },
    "xpath_example": {
      "description": "Using XPath to select a complex element",
      "mcp_call": {
        "function": "create_variable",
        "parameters": {
          "app_id": "abc12345-1234-5678-9012-123456789abc",
          "attributes": {
            "name": "Article Category",
            "variable_type": "dom_element",
            "value": "//article//span[@class='category'][1]",
            "options": {
              "selector_type": "xpath",
              "extract_text_content": true
            }
          }
        }
      }
    }
  },
  "common_mistakes": [
    "Using fragile selectors that break when page design changes",
    "Mixing CSS syntax with selector_type 'element_id', causing the selector to fail",
    "Forgetting to include required options fields (selector_type and extract_text_content)",
    "Selecting elements that load asynchronously without proper timing considerations",
    "Using overly complex selectors that are hard to maintain",
    "Not testing selectors across different page states and user interactions",
    "Leaving extract_text_content set incorrectly, resulting in unexpected output"
  ],
  "troubleshooting": {
    "element_not_found": {
      "problem": "DOM element variable returns empty or default values",
      "solutions": [
        "Verify the element selector is correct using browser developer tools",
        "Check if the element loads asynchronously and adjust timing",
        "Ensure the selector is specific enough to target the right element",
        "Test the selector on the actual page where the variable will be used",
        "Confirm the element exists when the variable is being evaluated",
        "Double-check that selector_type matches the provided value format"
      ]
    },
    "unexpected_output": {
      "problem": "Captured value format does not match expectations",
      "solutions": [
        "Review extract_text_content: set to true to return textContent, false for raw HTML",
        "Inspect the element in browser dev tools to confirm the available content",
        "Ensure the selector targets the correct node (e.g., the wrapper span rather than a parent container)",
        "Consider whether dynamic scripts modify the element after the variable runs",
        "Test the variable directly in preview mode to see the resolved value"
      ]
    },
    "selector_too_broad": {
      "problem": "Selector matches multiple elements, getting wrong value",
      "solutions": [
        "Make the selector more specific by adding additional criteria",
        "Use ID selectors when possible for unique elements",
        "Add parent element context to narrow down the selection",
        "Use pseudo-selectors like :first-child or :nth-of-type if needed",
        "Test selectors to ensure they match exactly one element"
      ]
    },
    "timing_issues": {
      "problem": "Element exists but variable returns default value due to timing",
      "solutions": [
        "Ensure the element is present when the variable is evaluated",
        "Consider using event-based triggers that fire after element loads",
        "Add delays or conditions to wait for dynamic content",
        "Use mutation observers or element visibility triggers",
        "Test on pages with slower loading times"
      ]
    }
  },
  "selector_patterns": {
    "basic_css_selectors": {
      "description": "Common CSS selector patterns for DOM elements",
      "examples": {
        "by_id": "#element-id",
        "by_class": ".class-name",
        "by_attribute": "[data-attribute='value']",
        "by_tag": "h1, h2, h3",
        "descendant": ".parent .child",
        "direct_child": ".parent > .child",
        "nth_child": ".list-item:nth-child(2)"
      }
    },
    "form_selectors": {
      "description": "Specific selectors for form elements",
      "examples": {
        "input_by_name": "input[name='field-name']",
        "input_by_type": "input[type='email']",
        "select_dropdown": "select[name='category']",
        "textarea": "textarea[name='message']",
        "checkbox_checked": "input[type='checkbox']:checked",
        "radio_selected": "input[type='radio']:checked"
      }
    },
    "xpath_patterns": {
      "description": "XPath expressions for complex element selection",
      "examples": {
        "by_text": "//span[text()='Exact Text']",
        "contains_text": "//div[contains(text(), 'Partial')]",
        "by_position": "//ul/li[1]",
        "parent_child": "//div[@class='parent']//span[@class='child']",
        "following_sibling": "//label[text()='Name']/following-sibling::input"
      }
    }
  },
  "related_mcp_tools": {
    "discovery": [
      "piwik_get_available_variable_templates() - List all available variable templates",
      "piwik_get_variable_template() - Get detailed template information"
    ],
    "management": [
      "piwik_create_variable() - Create new variables with this template",
      "piwik_update_variable() - Update existing variables (editable fields only)",
      "piwik_list_variables() - List all variables in your app",
      "piwik_get_variable() - Get detailed information about specific variables"
    ],
    "workflow": [
      "piwik_list_tags() - Find tags that might use this variable",
      "piwik_list_triggers() - Find triggers that might use this variable"
    ]
  }
}