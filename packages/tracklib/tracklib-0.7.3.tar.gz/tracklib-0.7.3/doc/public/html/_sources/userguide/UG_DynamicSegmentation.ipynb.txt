{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "4cbe5c02-8328-4c1b-94b6-30ced91d65de",
   "metadata": {},
   "source": [
    "# Dynamic segmentation\n",
    "\n",
    "A route is a linear feature, which also has a linear measurement system stored with its geometry\n",
    "\n",
    "A Events are linearly referenced data, such as speed limits, ... which occur along routes\n",
    "\n",
    "\"peut-être défini formally as the process of computing  the location of events along a route (Nyerges 1990).\"\n",
    "\n",
    "Les outils pouvant gérer le reférencement linéaire et la segmentation dynamique sont disponibles dans la librairie tracklib.\n",
    "\n",
    "Plusieurs déclencheurs doivent être mis en place (par ordre de difficulté) :\n",
    "- snapping des extrémités des tronçons lors de la creation ou la modification ;\n",
    "\n",
    "```python\n",
    "  # Projeté\n",
    "  distmin, xproj, yproj, iproj = tkl.proj_polyligne(Xp, Yp, pt.x(), pt.y())\n",
    "```\n",
    "- calcul de la géométrie résultante à partir des positions, lors de la création ou la modification de celles-ci ;\n",
    "```python\n",
    "  # P1, P2\n",
    "  proj_polyligne\n",
    "```\n",
    "\n",
    "- découpage des tronçons aux intersections lors de la creation ou la modification ;\n",
    "- répercution des positions sur tous les tronçons lorsqu'un objet est positionné sur une intersection ;\n",
    "- recalcul des positions impactées après découpage des tronçons aux intersections ;\n",
    "\n",
    "```python\n",
    "  # Projeté\n",
    "  distmin, xproj, yproj, iproj = tkl.proj_polyligne(Xp, Yp, pt.x(), pt.y())\n",
    "```\n",
    "<br/>\n",
    "\n",
    "Ainsi qu'une série d'outils pour exploiter l'ensemble :\n",
    "- détection des objets superposés sur le linéaire, à partir des positions ;\n",
    "\n",
    "```python\n",
    "  en ce moment\n",
    "```\n",
    "\n",
    "- transformation d'un point (lat, lng) en une distance et une position ;\n",
    "- transformation d'un ligne en une liste de positions sur le réseau ;\n",
    "- fusion des objets adjacents sur le réseau si leurs attributs sont identiques ;\n",
    "\n",
    "\n",
    "</div>"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "01169a07-d8ab-44b6-8a7c-55383b9697d9",
   "metadata": {},
   "source": [
    "## As usual, let's start by defining our environment\n",
    "\n",
    "The first task is only useful for the online notebook and import the local tracklib code source. It's not necessary if tracklib is installed from PyPI."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "110a40f3-2ee9-4565-aa44-2b45951d0749",
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "import sys\n",
    "\n",
    "# Import de tracklib\n",
    "module_path = os.path.abspath(os.path.join('../../..'))\n",
    "if module_path not in sys.path:\n",
    "    sys.path.append(module_path)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c0770818-50b2-4b36-af2c-d0315084cc31",
   "metadata": {},
   "source": [
    "Let's load the necessary libraries"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "21e883d4-71a6-4719-a08e-49482f247e66",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Matplotlib to create visualizations\n",
    "import matplotlib.pyplot as plt\n",
    "\n",
    "# Import tracklib library\n",
    "import tracklib as tkl"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2c41e887-2130-469d-a461-c1305dafb794",
   "metadata": {},
   "source": [
    "## Soit un exemple pour illustrer tout cela:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "056bec02-5587-4d88-ba12-df53c5a72820",
   "metadata": {},
   "outputs": [],
   "source": [
    "tkl.ObsTime.setReadFormat(\"4Y-2M-2DT2h:2m:2sZ\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "c9b174e9-4516-4cd2-8c83-bbd0893bc764",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.12"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
