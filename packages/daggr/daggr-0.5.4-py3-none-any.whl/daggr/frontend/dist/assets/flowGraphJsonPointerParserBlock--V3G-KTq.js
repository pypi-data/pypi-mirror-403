import{k as j,b as I,R as m}from"./declarationMapper-4emcUw2B.js";import{b0 as d,g as P,V as _,y as N,f as V}from"./index-C7ioxznG.js";import{F as D}from"./flowGraphCachedOperationBlock-DshMczcK.js";import"./index-BmJkaHuF.js";import"./KHR_interactivity-0REspvdU.js";import"./objectModelMapping-CY2JGqxk.js";const w=new RegExp(/\/\{(\w+)\}(?=\/|$)/g);class G{constructor(r,s){this.path=r,this.ownerBlock=s,this.templatedInputs=[];let n=w.exec(r);const o=new Set;for(;n;){const[,e]=n;if(o.has(e))throw new Error("Duplicate template variable detected.");o.add(e),this.templatedInputs.push(s.registerDataInput(e,j,new I(0))),n=w.exec(r)}}getAccessor(r,s){let n=this.path;for(const o of this.templatedInputs){const e=o.getValue(s).value;if(typeof e!="number"||e<0)throw new Error("Invalid value for templated input.");n=n.replace(`{${o.name}}`,e.toString())}return r.convert(n)}}class O extends D{constructor(r){super(m,r),this.config=r,this.object=this.registerDataOutput("object",m),this.propertyName=this.registerDataOutput("propertyName",m),this.setterFunction=this.registerDataOutput("setFunction",m,this._setPropertyValue.bind(this)),this.getterFunction=this.registerDataOutput("getFunction",m,this._getPropertyValue.bind(this)),this.generateAnimationsFunction=this.registerDataOutput("generateAnimationsFunction",m,this._getInterpolationAnimationPropertyInfo.bind(this)),this.templateComponent=new G(r.jsonPointer,this)}_doOperation(r){var i,p,a;const s=this.templateComponent.getAccessor(this.config.pathConverter,r),n=s.info.get(s.object),o=(p=(i=s.info).getTarget)==null?void 0:p.call(i,s.object),e=(a=s.info.getPropertyName)==null?void 0:a[0](s.object);if(o)this.object.setValue(o,r),e&&this.propertyName.setValue(e,r);else throw new Error("Object is undefined");return n}_setPropertyValue(r,s,n,o){var p,a;const e=this.templateComponent.getAccessor(this.config.pathConverter,o),i=e.info.type;i.startsWith("Color")&&(n=b(n,i)),(a=(p=e.info).set)==null||a.call(p,n,e.object)}_getPropertyValue(r,s,n){const o=this.templateComponent.getAccessor(this.config.pathConverter,n),e=o.info.type,i=o.info.get(o.object);return e.startsWith("Color")?E(i):i}_getInterpolationAnimationPropertyInfo(r,s,n){const o=this.templateComponent.getAccessor(this.config.pathConverter,n);return(e,i,p,a)=>{var u;const l=[],f=o.info.type;return f.startsWith("Color")&&(e=e.map(h=>({frame:h.frame,value:b(h.value,f)}))),(u=o.info.interpolation)==null||u.forEach((h,g)=>{var y;const A=((y=o.info.getPropertyName)==null?void 0:y[g](o.object))||"Animation-interpolation-"+g;let C=e;p!==h.type&&(C=e.map(c=>({frame:c.frame,value:h.getValue(void 0,c.value.asArray?c.value.asArray():[c.value],0,1)})));const F=h.buildAnimations(o.object,A,60,C);for(const c of F)a&&c.babylonAnimation.setEasingFunction(a),l.push(c.babylonAnimation)}),l}}getClassName(){return"FlowGraphJsonPointerParserBlock"}}function b(t,r){return t.getClassName().startsWith("Color")?t:r==="Color3"?new d(t.x,t.y,t.z):r==="Color4"?new P(t.x,t.y,t.z,t.w):t}function E(t){if(t instanceof d)return new _(t.r,t.g,t.b);if(t instanceof P)return new N(t.r,t.g,t.b,t.a);throw new Error("Invalid color type")}V("FlowGraphJsonPointerParserBlock",O);export{O as FlowGraphJsonPointerParserBlock};
