import{B as C,o as g,O as P,V as y,T as M,c as S,p as D,S as L,aM as E,_ as u,s as c,aN as A,aO as z,f as I}from"./index-C7ioxznG.js";import"./abstractEngine.cubeTexture-DucgXMgN.js";import"./index-BmJkaHuF.js";const v=.8;class l extends C{set boundingBoxSize(t){if(this._boundingBoxSize&&this._boundingBoxSize.equals(t))return;this._boundingBoxSize=t;const i=this.getScene();i&&i.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(t){this._rotationY=t,this.setReflectionTextureMatrix(g.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(t,i,e){let r="";for(const s of t)r+=s;return new l(r,i,null,e,t)}static CreateFromPrefilteredData(t,i,e=null,r=!0){const s=i.useDelayedTextureLoading;i.useDelayedTextureLoading=!1;const a=new l(t,i,null,!1,null,null,null,void 0,!0,e,r);return i.useDelayedTextureLoading=s,a}constructor(t,i,e=null,r=!1,s=null,a=null,n=null,o=5,h=!1,f=null,d=!1,m=v,x=0,b,_){var R;super(i),this.onLoadObservable=new P,this.boundingBoxPosition=y.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new g,this._buffer=null,this.name=t,this.url=t,this._noMipmap=r,this.hasAlpha=!1,this.isCube=!0,this._textureMatrix=g.Identity(),this.coordinatesMode=M.CUBIC_MODE;let p=null,B=null;e!==null&&!Array.isArray(e)?(p=e.extensions??null,this._noMipmap=e.noMipmap??!1,s=e.files??null,B=e.buffer??null,this._format=e.format??5,h=e.prefiltered??!1,f=e.forcedExtension??null,this._createPolynomials=e.createPolynomials??!1,this._lodScale=e.lodScale??v,this._lodOffset=e.lodOffset??0,this._loaderOptions=e.loaderOptions,this._useSRGBBuffer=e.useSRGBBuffer,a=e.onLoad??null,n=e.onError??null):(this._noMipmap=r,this._format=o,this._createPolynomials=d,p=e,this._loaderOptions=b,this._useSRGBBuffer=_,this._lodScale=m,this._lodOffset=x),!(!t&&!s)&&this.updateURL(t,f,a,h,n,p,(R=this.getScene())==null?void 0:R.useDelayedTextureLoading,s,B)}getClassName(){return"CubeTexture"}updateURL(t,i=null,e=null,r=!1,s=null,a=null,n=!1,o=null,h=null){(!this.name||this.name.startsWith("data:"))&&(this.name=t),this.url=t,i&&(this._forcedExtension=i);const f=t.lastIndexOf("."),d=i||(f>-1?t.substring(f).toLowerCase():""),m=d.indexOf(".dds")===0,x=d.indexOf(".env")===0,b=d.indexOf(".basis")===0;if(x?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=r,r&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),o)this._files=o;else if(!b&&!x&&!m&&!a&&(a=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,a){for(let _=0;_<a.length;_++)this._files.push(t+a[_]);this._extensions=a}this._buffer=h,n?(this.delayLoadState=4,this._delayedOnLoad=e,this._delayedOnError=s):this._loadTexture(e,s)}delayLoad(t){this.delayLoadState===4&&(t&&(this._forcedExtension=t),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(t){var s,a;if(t.updateFlag===this._textureMatrix.updateFlag||(t.isIdentity()!==this._textureMatrix.isIdentity()&&((s=this.getScene())==null||s.markAllMaterialsAsDirty(1,n=>n.getActiveTextures().indexOf(this)!==-1)),this._textureMatrix=t,!((a=this.getScene())!=null&&a.useRightHandedSystem)))return;const i=S.Vector3[0],e=S.Quaternion[0],r=S.Vector3[1];this._textureMatrix.decompose(i,e,r),e.z*=-1,e.w*=-1,g.ComposeToRef(i,e,r,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var t;return(t=this.getScene())!=null&&t.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(t=null,i=null){var n;const e=this.getScene(),r=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const s=()=>{var o;this.onLoadObservable.notifyObservers(this),r&&(r.dispose(),(o=this.getScene())==null||o.markAllMaterialsAsDirty(1)),t&&t()},a=(o,h)=>{this._loadingError=!0,this._errorObject={message:o,exception:h},i&&i(o,h),M.OnTextureLoadErrorObservable.notifyObservers(this)};this._texture?this._texture.isReady?D.SetImmediate(()=>s()):this._texture.onLoadedObservable.add(()=>s()):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,e,this._lodScale,this._lodOffset,t,a,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,e,this._files,this._noMipmap,t,a,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),(n=this._texture)==null||n.onLoadedObservable.add(()=>this.onLoadObservable.notifyObservers(this)))}static Parse(t,i,e){const r=L.Parse(()=>{let s=!1;return t.prefiltered&&(s=t.prefiltered),new l(e+(t.url??t.name),i,t.extensions,!1,t.files||null,null,null,void 0,s,t.forcedExtension)},t,i);if(t.boundingBoxPosition&&(r.boundingBoxPosition=y.FromArray(t.boundingBoxPosition)),t.boundingBoxSize&&(r.boundingBoxSize=y.FromArray(t.boundingBoxSize)),t.animations)for(let s=0;s<t.animations.length;s++){const a=t.animations[s],n=E("BABYLON.Animation");n&&r.animations.push(n.Parse(a))}return r}clone(){let t=0;const i=L.Clone(()=>{const e=new l(this.url,this.getScene()||this._getEngine(),this._extensions,this._noMipmap,this._files);return t=e.uniqueId,e},this);return i.uniqueId=t,i}}u([c()],l.prototype,"url",void 0);u([A()],l.prototype,"boundingBoxPosition",void 0);u([A()],l.prototype,"boundingBoxSize",null);u([c("rotationY")],l.prototype,"rotationY",null);u([c("files")],l.prototype,"_files",void 0);u([c("forcedExtension")],l.prototype,"_forcedExtension",void 0);u([c("extensions")],l.prototype,"_extensions",void 0);u([z("textureMatrix")],l.prototype,"_textureMatrix",void 0);u([z("textureMatrixRefraction")],l.prototype,"_textureMatrixRefraction",void 0);M._CubeTextureParser=l.Parse;I("BABYLON.CubeTexture",l);export{l as CubeTexture};
