import{b0 as b,T as j,g as M,H as B,V as w,a as V,L,bU as P,v,w as E,c1 as C,p as x,aK as D}from"./index-C7ioxznG.js";import{A}from"./assetContainer-WmWzRef8.js";import{S as T}from"./standardMaterial-BUPzOZe7.js";import"./index-BmJkaHuF.js";class g{constructor(){this.materials=[]}parseMTL(t,n,e,o){if(n instanceof ArrayBuffer)return;const l=n.split(`
`),h=/\s+/;let p,a=null;for(let d=0;d<l.length;d++){const u=l[d].trim();if(u.length===0||u.charAt(0)==="#")continue;const r=u.indexOf(" ");let s=r>=0?u.substring(0,r):u;s=s.toLowerCase();const i=r>=0?u.substring(r+1).trim():"";if(s==="newmtl")a&&this.materials.push(a),t._blockEntityCollection=!!o,a=new T(i,t),a._parentContainer=o,t._blockEntityCollection=!1;else if(s==="kd"&&a)p=i.split(h,3).map(parseFloat),a.diffuseColor=b.FromArray(p);else if(s==="ka"&&a)p=i.split(h,3).map(parseFloat),a.ambientColor=b.FromArray(p);else if(s==="ks"&&a)p=i.split(h,3).map(parseFloat),a.specularColor=b.FromArray(p);else if(s==="ke"&&a)p=i.split(h,3).map(parseFloat),a.emissiveColor=b.FromArray(p);else if(s==="ns"&&a)a.specularPower=parseFloat(i);else if(s==="d"&&a)a.alpha=parseFloat(i);else if(s==="map_ka"&&a)a.ambientTexture=g._GetTexture(e,i,t);else if(s==="map_kd"&&a)a.diffuseTexture=g._GetTexture(e,i,t);else if(s==="map_ks"&&a)a.specularTexture=g._GetTexture(e,i,t);else if(s!=="map_ns")if(s==="map_bump"&&a){const _=i.split(h),F=_.indexOf("-bm");let f=null;F>=0&&(f=_[F+1],_.splice(F,2)),a.bumpTexture=g._GetTexture(e,_.join(" "),t),a.bumpTexture&&f!==null&&(a.bumpTexture.level=parseFloat(f))}else s==="map_d"&&a&&(a.opacityTexture=g._GetTexture(e,i,t))}a&&this.materials.push(a)}static _GetTexture(t,n,e){if(!n)return null;let o=t;if(t==="file:"){let l=n.lastIndexOf("\\");l===-1&&(l=n.lastIndexOf("/")),l>-1?o+=n.substring(l+1):o+=n}else o+=n;return new j(o,e,!1,g.INVERT_TEXTURE_Y)}}g.INVERT_TEXTURE_Y=!0;class m{constructor(t,n,e){this._positions=[],this._normals=[],this._uvs=[],this._colors=[],this._extColors=[],this._meshesFromObj=[],this._indicesForBabylon=[],this._wrappedPositionForBabylon=[],this._wrappedUvsForBabylon=[],this._wrappedColorsForBabylon=[],this._wrappedNormalsForBabylon=[],this._tuplePosNorm=[],this._curPositionInIndices=0,this._hasMeshes=!1,this._unwrappedPositionsForBabylon=[],this._unwrappedColorsForBabylon=[],this._unwrappedNormalsForBabylon=[],this._unwrappedUVForBabylon=[],this._triangles=[],this._materialNameFromObj="",this._objMeshName="",this._increment=1,this._isFirstMaterial=!0,this._grayColor=new M(.5,.5,.5,1),this._hasLineData=!1,this._materialToUse=t,this._babylonMeshesArray=n,this._loadingOptions=e}_isInArray(t,n){t[n[0]]||(t[n[0]]={normals:[],idx:[]});const e=t[n[0]].normals.indexOf(n[1]);return e===-1?-1:t[n[0]].idx[e]}_isInArrayUV(t,n){t[n[0]]||(t[n[0]]={normals:[],idx:[],uv:[]});const e=t[n[0]].normals.indexOf(n[1]);return e!=1&&n[2]===t[n[0]].uv[e]?t[n[0]].idx[e]:-1}_setData(t){t.indiceUvsFromObj??(t.indiceUvsFromObj=-1),t.indiceNormalFromObj??(t.indiceNormalFromObj=-1);let n;this._loadingOptions.optimizeWithUV?n=this._isInArrayUV(this._tuplePosNorm,[t.indicePositionFromObj,t.indiceNormalFromObj,t.indiceUvsFromObj]):n=this._isInArray(this._tuplePosNorm,[t.indicePositionFromObj,t.indiceNormalFromObj]),n===-1?(this._indicesForBabylon.push(this._wrappedPositionForBabylon.length),this._wrappedPositionForBabylon.push(t.positionVectorFromOBJ),t.textureVectorFromOBJ!==void 0&&this._wrappedUvsForBabylon.push(t.textureVectorFromOBJ),t.normalsVectorFromOBJ!==void 0&&this._wrappedNormalsForBabylon.push(t.normalsVectorFromOBJ),t.positionColorsFromOBJ!==void 0&&this._wrappedColorsForBabylon.push(t.positionColorsFromOBJ),this._tuplePosNorm[t.indicePositionFromObj].normals.push(t.indiceNormalFromObj),this._tuplePosNorm[t.indicePositionFromObj].idx.push(this._curPositionInIndices++),this._loadingOptions.optimizeWithUV&&this._tuplePosNorm[t.indicePositionFromObj].uv.push(t.indiceUvsFromObj)):this._indicesForBabylon.push(n)}_unwrapData(){try{for(let t=0;t<this._wrappedPositionForBabylon.length;t++)this._unwrappedPositionsForBabylon.push(this._wrappedPositionForBabylon[t].x*this._handednessSign,this._wrappedPositionForBabylon[t].y,this._wrappedPositionForBabylon[t].z),this._wrappedNormalsForBabylon.length&&this._unwrappedNormalsForBabylon.push(this._wrappedNormalsForBabylon[t].x*this._handednessSign,this._wrappedNormalsForBabylon[t].y,this._wrappedNormalsForBabylon[t].z),this._wrappedUvsForBabylon.length&&this._unwrappedUVForBabylon.push(this._wrappedUvsForBabylon[t].x,this._wrappedUvsForBabylon[t].y),this._unwrappedColorsForBabylon.length&&this._unwrappedColorsForBabylon.push(this._wrappedColorsForBabylon[t].r,this._wrappedColorsForBabylon[t].g,this._wrappedColorsForBabylon[t].b,this._wrappedColorsForBabylon[t].a);this._wrappedPositionForBabylon.length=0,this._wrappedNormalsForBabylon.length=0,this._wrappedUvsForBabylon.length=0,this._wrappedColorsForBabylon.length=0,this._tuplePosNorm.length=0,this._curPositionInIndices=0}catch{throw new Error("Unable to unwrap data while parsing OBJ data.")}}_getTriangles(t,n){for(let e=n;e<t.length-1;e++)this._pushTriangle(t,e)}_getColor(t){if(this._loadingOptions.importVertexColors)return this._extColors[t]??this._colors[t]}_setDataForCurrentFaceWithPattern1(t,n){this._getTriangles(t,n);for(let e=0;e<this._triangles.length;e++){const o=parseInt(this._triangles[e])-1;this._setData({indicePositionFromObj:o,positionVectorFromOBJ:this._positions[o],positionColorsFromOBJ:this._getColor(o)})}this._triangles.length=0}_setDataForCurrentFaceWithPattern2(t,n){this._getTriangles(t,n);for(let e=0;e<this._triangles.length;e++){const o=this._triangles[e].split("/"),l=parseInt(o[0])-1,h=parseInt(o[1])-1;this._setData({indicePositionFromObj:l,indiceUvsFromObj:h,positionVectorFromOBJ:this._positions[l],textureVectorFromOBJ:this._uvs[h],positionColorsFromOBJ:this._getColor(l)})}this._triangles.length=0}_setDataForCurrentFaceWithPattern3(t,n){this._getTriangles(t,n);for(let e=0;e<this._triangles.length;e++){const o=this._triangles[e].split("/"),l=parseInt(o[0])-1,h=parseInt(o[1])-1,p=parseInt(o[2])-1;this._setData({indicePositionFromObj:l,indiceUvsFromObj:h,indiceNormalFromObj:p,positionVectorFromOBJ:this._positions[l],textureVectorFromOBJ:this._uvs[h],normalsVectorFromOBJ:this._normals[p]})}this._triangles.length=0}_setDataForCurrentFaceWithPattern4(t,n){this._getTriangles(t,n);for(let e=0;e<this._triangles.length;e++){const o=this._triangles[e].split("//"),l=parseInt(o[0])-1,h=parseInt(o[1])-1;this._setData({indicePositionFromObj:l,indiceNormalFromObj:h,positionVectorFromOBJ:this._positions[l],normalsVectorFromOBJ:this._normals[h],positionColorsFromOBJ:this._getColor(l)})}this._triangles.length=0}_setDataForCurrentFaceWithPattern5(t,n){this._getTriangles(t,n);for(let e=0;e<this._triangles.length;e++){const o=this._triangles[e].split("/"),l=this._positions.length+parseInt(o[0]),h=this._uvs.length+parseInt(o[1]),p=this._normals.length+parseInt(o[2]);this._setData({indicePositionFromObj:l,indiceUvsFromObj:h,indiceNormalFromObj:p,positionVectorFromOBJ:this._positions[l],textureVectorFromOBJ:this._uvs[h],normalsVectorFromOBJ:this._normals[p],positionColorsFromOBJ:this._getColor(l)})}this._triangles.length=0}_addPreviousObjMesh(){this._meshesFromObj.length>0&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._unwrapData(),this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._handledMesh.indices=this._indicesForBabylon.slice(),this._handledMesh.positions=this._unwrappedPositionsForBabylon.slice(),this._unwrappedNormalsForBabylon.length&&(this._handledMesh.normals=this._unwrappedNormalsForBabylon.slice()),this._unwrappedUVForBabylon.length&&(this._handledMesh.uvs=this._unwrappedUVForBabylon.slice()),this._unwrappedColorsForBabylon.length&&(this._handledMesh.colors=this._unwrappedColorsForBabylon.slice()),this._handledMesh.hasLines=this._hasLineData,this._indicesForBabylon.length=0,this._unwrappedPositionsForBabylon.length=0,this._unwrappedColorsForBabylon.length=0,this._unwrappedNormalsForBabylon.length=0,this._unwrappedUVForBabylon.length=0,this._hasLineData=!1)}_optimizeNormals(t){const n=t.getVerticesData(B.PositionKind),e=t.getVerticesData(B.NormalKind),o={};if(!n||!e)return;for(let h=0;h<n.length/3;h++){const p=n[h*3+0],a=n[h*3+1],d=n[h*3+2],u=p+"_"+a+"_"+d;let r=o[u];r||(r=[],o[u]=r),r.push(h)}const l=new w;for(const h in o){const p=o[h];if(p.length<2)continue;const a=p[0];for(let d=1;d<p.length;++d){const u=p[d];e[a*3+0]+=e[u*3+0],e[a*3+1]+=e[u*3+1],e[a*3+2]+=e[u*3+2]}l.copyFromFloats(e[a*3+0],e[a*3+1],e[a*3+2]),l.normalize();for(let d=0;d<p.length;++d){const u=p[d];e[u*3+0]=l.x,e[u*3+1]=l.y,e[u*3+2]=l.z}}t.setVerticesData(B.NormalKind,e)}static _IsLineElement(t){return t.startsWith("l")}static _IsObjectElement(t){return t.startsWith("o")}static _IsGroupElement(t){return t.startsWith("g")}static _GetZbrushMRGB(t,n){if(!t.startsWith("mrgb"))return null;if(t=t.replace("mrgb","").trim(),n)return[];const e=/[a-z0-9]/g,o=t.match(e);if(!o||o.length%8!==0)return[];const l=[];for(let h=0;h<o.length/8;h++){const p=o[h*8+2]+o[h*8+3],a=o[h*8+4]+o[h*8+5],d=o[h*8+6]+o[h*8+7];l.push(new M(parseInt(p,16)/255,parseInt(a,16)/255,parseInt(d,16)/255,1))}return l}parse(t,n,e,o,l){var u;n=n.replace(/#MRGB/g,"mrgb"),n=n.replace(/#.*$/gm,"").trim(),this._loadingOptions.useLegacyBehavior?(this._pushTriangle=(r,s)=>this._triangles.push(r[0],r[s],r[s+1]),this._handednessSign=1):e.useRightHandedSystem?(this._pushTriangle=(r,s)=>this._triangles.push(r[0],r[s+1],r[s]),this._handednessSign=1):(this._pushTriangle=(r,s)=>this._triangles.push(r[0],r[s],r[s+1]),this._handednessSign=-1);const h=n.split(`
`),p=[];let a=[];p.push(a);for(let r=0;r<h.length;r++){const s=h[r].trim().replace(/\s\s/g," ");if(!(s.length===0||s.charAt(0)==="#"))if((m._IsGroupElement(s)||m._IsObjectElement(s))&&(a=[],p.push(a)),m._IsLineElement(s)){const i=s.split(" ");for(let _=1;_<i.length-1;_++)a.push(`l ${i[_]} ${i[_+1]}`)}else a.push(s)}const d=p.flat();for(let r=0;r<d.length;r++){const s=d[r].trim().replace(/\s\s/g," ");let i;if(!(s.length===0||s.charAt(0)==="#"))if(m.VertexPattern.test(s)){if(i=s.match(/[^ ]+/g),this._positions.push(new w(parseFloat(i[1]),parseFloat(i[2]),parseFloat(i[3]))),this._loadingOptions.importVertexColors)if(i.length>=7){const _=parseFloat(i[4]),F=parseFloat(i[5]),f=parseFloat(i[6]);this._colors.push(new M(_>1?_/255:_,F>1?F/255:F,f>1?f/255:f,i.length===7||i[7]===void 0?1:parseFloat(i[7])))}else this._colors.push(this._grayColor)}else if((i=m.NormalPattern.exec(s))!==null)this._normals.push(new w(parseFloat(i[1]),parseFloat(i[2]),parseFloat(i[3])));else if((i=m.UVPattern.exec(s))!==null)this._uvs.push(new V(parseFloat(i[1])*this._loadingOptions.UVScaling.x,parseFloat(i[2])*this._loadingOptions.UVScaling.y));else if((i=m.FacePattern3.exec(s))!==null)this._setDataForCurrentFaceWithPattern3(i[1].trim().split(" "),1);else if((i=m.FacePattern4.exec(s))!==null)this._setDataForCurrentFaceWithPattern4(i[1].trim().split(" "),1);else if((i=m.FacePattern5.exec(s))!==null)this._setDataForCurrentFaceWithPattern5(i[1].trim().split(" "),1);else if((i=m.FacePattern2.exec(s))!==null)this._setDataForCurrentFaceWithPattern2(i[1].trim().split(" "),1);else if((i=m.FacePattern1.exec(s))!==null)this._setDataForCurrentFaceWithPattern1(i[1].trim().split(" "),1);else if((i=m.LinePattern1.exec(s))!==null)this._setDataForCurrentFaceWithPattern1(i[1].trim().split(" "),0),this._hasLineData=!0;else if((i=m.LinePattern2.exec(s))!==null)this._setDataForCurrentFaceWithPattern2(i[1].trim().split(" "),0),this._hasLineData=!0;else if(i=m._GetZbrushMRGB(s,!this._loadingOptions.importVertexColors))for(const _ of i)this._extColors.push(_);else if((i=m.LinePattern3.exec(s))!==null)this._setDataForCurrentFaceWithPattern3(i[1].trim().split(" "),0),this._hasLineData=!0;else if(m.GroupDescriptor.test(s)||m.ObjectDescriptor.test(s)){const _={name:s.substring(2).trim(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:m.ObjectDescriptor.test(s)};this._addPreviousObjMesh(),this._meshesFromObj.push(_),this._hasMeshes=!0,this._isFirstMaterial=!0,this._increment=1}else if(m.UseMtlDescriptor.test(s)){if(this._materialNameFromObj=s.substring(7).trim(),!this._isFirstMaterial||!this._hasMeshes){this._addPreviousObjMesh();const _={name:(this._objMeshName||"mesh")+"_mm"+this._increment.toString(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:!1};this._increment++,this._meshesFromObj.push(_),this._hasMeshes=!0}this._hasMeshes&&this._isFirstMaterial&&(this._meshesFromObj[this._meshesFromObj.length-1].materialName=this._materialNameFromObj,this._isFirstMaterial=!1)}else m.MtlLibGroupDescriptor.test(s)?l(s.substring(7).trim()):m.SmoothDescriptor.test(s)||L.Log("Unhandled expression at line : "+s)}if(this._hasMeshes&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData(),this._handledMesh.indices=this._indicesForBabylon,this._handledMesh.positions=this._unwrappedPositionsForBabylon,this._unwrappedNormalsForBabylon.length&&(this._handledMesh.normals=this._unwrappedNormalsForBabylon),this._unwrappedUVForBabylon.length&&(this._handledMesh.uvs=this._unwrappedUVForBabylon),this._unwrappedColorsForBabylon.length&&(this._handledMesh.colors=this._unwrappedColorsForBabylon),this._handledMesh.hasLines=this._hasLineData),!this._hasMeshes){let r=null;if(this._indicesForBabylon.length)this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData();else{for(const s of this._positions)this._unwrappedPositionsForBabylon.push(s.x,s.y,s.z);if(this._normals.length)for(const s of this._normals)this._unwrappedNormalsForBabylon.push(s.x,s.y,s.z);if(this._uvs.length)for(const s of this._uvs)this._unwrappedUVForBabylon.push(s.x,s.y);if(this._extColors.length)for(const s of this._extColors)this._unwrappedColorsForBabylon.push(s.r,s.g,s.b,s.a);else if(this._colors.length)for(const s of this._colors)this._unwrappedColorsForBabylon.push(s.r,s.g,s.b,s.a);this._materialNameFromObj||(r=new T(P.RandomId(),e),r.pointsCloud=!0,this._materialNameFromObj=r.name,this._normals.length||(r.disableLighting=!0,r.emissiveColor=b.White()))}this._meshesFromObj.push({name:P.RandomId(),indices:this._indicesForBabylon,positions:this._unwrappedPositionsForBabylon,colors:this._unwrappedColorsForBabylon,normals:this._unwrappedNormalsForBabylon,uvs:this._unwrappedUVForBabylon,materialName:this._materialNameFromObj,directMaterial:r,isObject:!0,hasLines:this._hasLineData})}for(let r=0;r<this._meshesFromObj.length;r++){if(t&&this._meshesFromObj[r].name){if(t instanceof Array){if(t.indexOf(this._meshesFromObj[r].name)===-1)continue}else if(this._meshesFromObj[r].name!==t)continue}this._handledMesh=this._meshesFromObj[r],e._blockEntityCollection=!!o;const s=new v(this._meshesFromObj[r].name,e);if(s._parentContainer=o,e._blockEntityCollection=!1,this._handledMesh._babylonMesh=s,!this._handledMesh.isObject){for(let _=r-1;_>=0;--_)if(this._meshesFromObj[_].isObject&&this._meshesFromObj[_]._babylonMesh){s.parent=this._meshesFromObj[_]._babylonMesh;break}}if(this._materialToUse.push(this._meshesFromObj[r].materialName),this._handledMesh.hasLines&&(s._internalMetadata??(s._internalMetadata={}),s._internalMetadata._isLine=!0),((u=this._handledMesh.positions)==null?void 0:u.length)===0){this._babylonMeshesArray.push(s);continue}const i=new E;if(i.indices=this._handledMesh.indices,i.positions=this._handledMesh.positions,this._loadingOptions.computeNormals||!this._handledMesh.normals){const _=new Array;E.ComputeNormals(this._handledMesh.positions,this._handledMesh.indices,_),i.normals=_}else i.normals=this._handledMesh.normals;this._handledMesh.uvs&&(i.uvs=this._handledMesh.uvs),this._handledMesh.colors&&(i.colors=this._handledMesh.colors),i.applyToMesh(s),this._loadingOptions.invertY&&(s.scaling.y*=-1),this._loadingOptions.optimizeNormals&&this._optimizeNormals(s),this._babylonMeshesArray.push(s),this._handledMesh.directMaterial&&(s.material=this._handledMesh.directMaterial)}}}m.ObjectDescriptor=/^o/;m.GroupDescriptor=/^g/;m.MtlLibGroupDescriptor=/^mtllib /;m.UseMtlDescriptor=/^usemtl /;m.SmoothDescriptor=/^s /;m.VertexPattern=/^v(\s+[\d|.|+|\-|e|E]+){3,7}/;m.NormalPattern=/^vn(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/;m.UVPattern=/^vt(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/;m.FacePattern1=/^f\s+(([\d]{1,}[\s]?){3,})+/;m.FacePattern2=/^f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/;m.FacePattern3=/^f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/;m.FacePattern4=/^f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/;m.FacePattern5=/^f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/;m.LinePattern1=/^l\s+(([\d]{1,}[\s]?){2,})+/;m.LinePattern2=/^l\s+((([\d]{1,}\/[\d]{1,}[\s]?){2,})+)/;m.LinePattern3=/^l\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){2,})+)/;class c{static get INVERT_TEXTURE_Y(){return g.INVERT_TEXTURE_Y}static set INVERT_TEXTURE_Y(t){g.INVERT_TEXTURE_Y=t}constructor(t){this.name=C.name,this.extensions=C.extensions,this._assetContainer=null,this._loadingOptions={...c._DefaultLoadingOptions,...t??{}}}static get _DefaultLoadingOptions(){return{computeNormals:c.COMPUTE_NORMALS,optimizeNormals:c.OPTIMIZE_NORMALS,importVertexColors:c.IMPORT_VERTEX_COLORS,invertY:c.INVERT_Y,invertTextureY:c.INVERT_TEXTURE_Y,UVScaling:c.UV_SCALING,materialLoadingFailsSilently:c.MATERIAL_LOADING_FAILS_SILENTLY,optimizeWithUV:c.OPTIMIZE_WITH_UV,skipMaterials:c.SKIP_MATERIALS,useLegacyBehavior:c.USE_LEGACY_BEHAVIOR}}_loadMTL(t,n,e,o){const l=n+t;x.LoadFile(l,e,void 0,void 0,!1,(h,p)=>{o(l,p)})}createPlugin(t){return new c(t[C.name])}canDirectLoad(){return!1}importMeshAsync(t,n,e,o){return this._parseSolidAsync(t,n,e,o).then(l=>({meshes:l,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[],spriteManagers:[]}))}loadAsync(t,n,e){return this.importMeshAsync(null,t,n,e).then(()=>{})}loadAssetContainerAsync(t,n,e){const o=new A(t);return this._assetContainer=o,this.importMeshAsync(null,t,n,e).then(l=>(l.meshes.forEach(h=>o.meshes.push(h)),l.meshes.forEach(h=>{const p=h.material;p&&o.materials.indexOf(p)==-1&&(o.materials.push(p),p.getActiveTextures().forEach(d=>{o.textures.indexOf(d)==-1&&o.textures.push(d)}))}),this._assetContainer=null,o)).catch(l=>{throw this._assetContainer=null,l})}_parseSolidAsync(t,n,e,o){let l="";const h=new g,p=[],a=[];e=e.replace(/#.*$/gm,"").trim(),new m(p,a,this._loadingOptions).parse(t,e,n,this._assetContainer,r=>{l=r});const u=[];return l!==""&&!this._loadingOptions.skipMaterials&&u.push(new Promise((r,s)=>{this._loadMTL(l,o,i=>{try{h.parseMTL(n,i,o,this._assetContainer);for(let _=0;_<h.materials.length;_++){let F=0;const f=[];let y;for(;(y=p.indexOf(h.materials[_].name,F))>-1;)f.push(y),F=y+1;if(y===-1&&f.length===0)h.materials[_].dispose();else for(let O=0;O<f.length;O++){const I=a[f[O]],N=h.materials[_];I.material=N,I.getTotalIndices()||(N.pointsCloud=!0)}}r()}catch(_){x.Warn(`Error processing MTL file: '${l}'`),this._loadingOptions.materialLoadingFailsSilently?r():s(_)}},(i,_)=>{x.Warn(`Error downloading MTL file: '${l}'`),this._loadingOptions.materialLoadingFailsSilently?r():s(_)})})),Promise.all(u).then(()=>{const r=s=>{var i;return!!(((i=s._internalMetadata)==null?void 0:i._isLine)??!1)};return a.forEach(s=>{if(r(s)){let i=s.material??new T(s.name+"_line",n);i.getBindedMeshes().filter(F=>!r(F)).length>0&&(i=i.clone(i.name+"_line")??i),i.wireframe=!0,s.material=i,s._internalMetadata&&(s._internalMetadata._isLine=void 0)}}),a})}}c.OPTIMIZE_WITH_UV=!0;c.INVERT_Y=!1;c.IMPORT_VERTEX_COLORS=!1;c.COMPUTE_NORMALS=!1;c.OPTIMIZE_NORMALS=!1;c.UV_SCALING=new V(1,1);c.SKIP_MATERIALS=!1;c.MATERIAL_LOADING_FAILS_SILENTLY=!0;c.USE_LEGACY_BEHAVIOR=!1;D(new c);export{c as OBJFileLoader};
