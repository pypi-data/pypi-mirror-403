import{b0 as m,V as d,bR as p,bQ as _}from"./index-C7ioxznG.js";import{GLTFLoader as f}from"./glTFLoader-dcV3nFjy.js";import"./index-BmJkaHuF.js";import"./bone-D3wPsQsS.js";import"./skeleton-Dp5NNatR.js";import"./rawTexture-B_Rn1rXF.js";import"./assetContainer-WmWzRef8.js";import"./objectModelMapping-CY2JGqxk.js";const n="KHR_materials_volume";class A{constructor(s){this.name=n,this.order=173,this._loader=s,this.enabled=this._loader.isExtensionUsed(n),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(s,i,o){return f.LoadExtensionAsync(s,i,this.name,async(e,t)=>{const r=new Array;return r.push(this._loader.loadMaterialPropertiesAsync(s,i,o)),r.push(this._loadVolumePropertiesAsync(e,i,o,t)),await Promise.all(r).then(()=>{})})}_loadVolumePropertiesAsync(s,i,o,e){const t=this._loader._getOrCreateMaterialAdapter(o);if(t.transmissionWeight===0&&t.subsurfaceWeight===0||!e.thicknessFactor)return Promise.resolve();const r=e.attenuationDistance!==void 0?e.attenuationDistance:Number.MAX_VALUE,a=e.attenuationColor!==void 0&&e.attenuationColor.length==3?m.FromArray(e.attenuationColor):m.White(),c=new d(-Math.log(a.r),-Math.log(a.g),-Math.log(a.b));c.scaleInPlace(1/Math.max(r,.001)),t.extinctionCoefficient=c,t.transmissionDepth=r,t.transmissionColor=a,t.volumeThickness=e.thicknessFactor??0;const h=new Array;return e.thicknessTexture&&(e.thicknessTexture.nonColorData=!0,h.push(this._loader.loadTextureInfoAsync(`${s}/thicknessTexture`,e.thicknessTexture,u=>{u.name=`${o.name} (Thickness)`,t.volumeThicknessTexture=u}))),Promise.all(h).then(()=>{})}}p(n);_(n,!0,l=>new A(l));export{A as KHR_materials_volume};
