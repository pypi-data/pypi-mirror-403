import{L as V,l as X}from"./index-C7ioxznG.js";import{WebGPUEngine as f}from"./webgpuEngine-BjcpRZgU.js";import"./index-BmJkaHuF.js";import"./instancesVertex-C9_ob8I4.js";import"./bakedVertexAnimation-mwPok164.js";import"./instancesDeclaration-BPQ1TXm4.js";import"./helperFunctions-CFR2hQoc.js";import"./fresnelFunction-BycPBHvF.js";import"./meshUboDeclaration-DfeiWLXB.js";import"./sceneUboDeclaration-DbExGHC1.js";import"./decalFragment-CGgkhmMA.js";import"./audioEngine-uesWbcoE.js";f.prototype.unBindMultiColorAttachmentFramebuffer=function(t,e=!1,n){n&&n(),this._endCurrentRenderPass(),t.disableAutomaticMSAAResolve||this.resolveMultiFramebuffer(t,!1),e||this.generateMipMapsMultiFramebuffer(t),this._currentRenderTarget=null,this._mrtAttachments=[],this._cacheRenderPipeline.setMRT([]),this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments)};f.prototype.createMultipleRenderTarget=function(t,e,n){let a=!1,i=!0,l=!1,m=!1,c=15,g=1,p=1;const U=0,v=3,H=!1,k=5,N=3553;let x=[],M=[],T=[],_=[],y=[],R=[],b=[],S=[],F=[],A=[],d=!1;const u=this._createHardwareRenderTargetWrapper(!0,!1,t);e!==void 0&&(a=e.generateMipMaps??!1,i=e.generateDepthBuffer??!0,l=e.generateStencilBuffer??!1,m=e.generateDepthTexture??!1,g=e.textureCount??1,c=e.depthTextureFormat??15,x=e.types||x,M=e.samplingModes||M,T=e.useSRGBBuffers||T,_=e.formats||_,y=e.targetTypes||y,R=e.faceIndex||R,b=e.layerIndex||b,S=e.layerCounts||S,F=e.labels||F,A=e.creationFlags||A,p=e.samples??p,d=e.dontCreateTextures??!1);const D=t.width??t,G=t.height??t,B=[],I=[],P=[];u.label=(e==null?void 0:e.label)??"MultiRenderTargetWrapper",u._generateDepthBuffer=i,u._generateStencilBuffer=l,u._attachments=I,u._defaultAttachments=P;let h=null;(i||l||m)&&!d&&(m||(i&&l?c=13:i?c=14:c=19),h=u.createDepthStencilTexture(0,!1,l,1,c,u.label+"-DepthStencil"));const w=e!==void 0&&typeof e=="object"&&e.createMipMaps&&!a;for(let s=0;s<g;s++){let C=M[s]||v,o=x[s]||U;const Y=_[s]||k,j=(T[s]||H)&&this._caps.supportSRGBBuffers,E=y[s]||N,L=S[s]??1,O=A[s];if((o===1&&!this._caps.textureFloatLinearFiltering||o===2&&!this._caps.textureHalfFloatLinearFiltering)&&(C=1),o===1&&!this._caps.textureFloat&&(o=0,V.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),I.push(s+1),P.push(n?s+1:s===0?1:0),E===-1||d)continue;const r=new X(this,6);switch(B[s]=r,E){case 34067:r.isCube=!0;break;case 32879:r.is3D=!0,r.baseDepth=r.depth=L;break;case 35866:r.is2DArray=!0,r.baseDepth=r.depth=L;break}r.baseWidth=D,r.baseHeight=G,r.width=D,r.height=G,r.isReady=!0,r.samples=1,r.generateMipMaps=a,r.samplingMode=C,r.type=o,r._cachedWrapU=0,r._cachedWrapV=0,r._useSRGBBuffer=j,r.format=Y,r.label=F[s]??u.label+"-Texture"+s,this._internalTexturesCache.push(r),w&&(r.generateMipMaps=!0),this._textureHelper.createGPUTextureForInternalTexture(r,void 0,void 0,void 0,O),w&&(r.generateMipMaps=!1)}return h&&(h.incrementReferences(),B[g]=h,this._internalTexturesCache.push(h)),u.setTextures(B),u.setLayerAndFaceIndices(b,R),d?u._samples=p:this.updateMultipleRenderTargetTextureSampleCount(u,p),u};f.prototype.updateMultipleRenderTargetTextureSampleCount=function(t,e){if(!t||!t.textures||t.textures.length===0||t.textures[0].samples===e)return e;const n=t.textures.length;if(n===0)return 1;e=Math.min(e,this.getCaps().maxMSAASamples);for(let a=0;a<n;++a){const l=t.textures[a]._hardwareTexture;l==null||l.releaseMSAATextures()}for(let a=0;a<n;++a){const i=t.textures[a];i.samples=e}return t._depthStencilTexture&&(t._depthStencilTexture.samples=e),t._samples=e,e};f.prototype.generateMipMapsMultiFramebuffer=function(t){const e=t;if(!e.isMulti)return;const a=e._attachments.length;for(let i=0;i<a;i++){const l=e.textures[i];l.generateMipMaps&&!l.isCube&&!l.is3D&&this._generateMipmaps(l)}};f.prototype.resolveMultiFramebuffer=function(t,e=!0){this.resolveFramebuffer(t,e)};f.prototype.bindAttachments=function(t){t.length===0||!this._currentRenderTarget||(this._mrtAttachments=t,this._currentRenderPass&&this._cacheRenderPipeline.setMRTAttachments(t))};f.prototype.buildTextureLayout=function(t,e=!1){const n=[];if(e)n.push(1);else for(let a=0;a<t.length;a++)t[a]?n.push(a+1):n.push(0);return n};f.prototype.restoreSingleAttachment=function(){};f.prototype.restoreSingleAttachmentForRenderTarget=function(){};
