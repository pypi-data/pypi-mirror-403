# ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

## ğŸ‰ æ–°å®Ÿè£…ï¼ˆFemModelï¼‰é«˜ç²¾åº¦è§£æ

**FrameWeb3ã¯ã€æŠ€è¡“çš„ã«å¤§æˆåŠŸã‚’åã‚ãŸæ¬¡ä¸–ä»£FEMè§£æãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**ã¨ã—ã¦å®Œæˆã—ã¦ã„ã¾ã™ã€‚

### ğŸš€ åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•ï¼ˆæ–°å®Ÿè£…ï¼‰
```python
from src.fem.model import FemModel

# é«˜ç²¾åº¦FEMè§£æï¼ˆè‡ªå‹•è¦ç´ åˆ†å‰²ä»˜ãï¼‰
model = FemModel()
model.load_model("path/to/model.json")

# è‡ªå‹•è¦ç´ åˆ†å‰²å®Ÿè¡Œ
results = model.run(analysis_type="static")
displacement = model.get_results()["displacement"]
print(f"è§£æå®Œäº†: {len(displacement)}ç¯€ç‚¹ã®é«˜ç²¾åº¦ãƒ¡ãƒƒã‚·ãƒ¥")
```

### ğŸ”§ è¦ç´ åˆ†å‰²æ©Ÿèƒ½ãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆ

#### ç€ç›®ç‚¹ã«ã‚ˆã‚‹è¦ç´ åˆ†å‰²
```json
{
  "notice_points": [
    {"m": è¦ç´ ID, "Points": [åˆ†å‰²ä½ç½®1, åˆ†å‰²ä½ç½®2, ...]}
  ]
}
```

#### åˆ†å¸ƒè·é‡ã«ã‚ˆã‚‹è‡ªå‹•åˆ†å‰²
```json
{
  "load": {
    "case1": {
      "load_member": [
        {"m": è¦ç´ ID, "mark": 2, "L1": é–‹å§‹ä½ç½®, "L2": çµ‚äº†ä½ç½®, "P1": è·é‡å€¤, "P2": è·é‡å€¤}
      ]
    }
  }
}
```

#### é›†ä¸­è·é‡ã«ã‚ˆã‚‹è‡ªå‹•åˆ†å‰²
```json
{
  "load": {
    "case1": {
      "load_member": [
        {"m": è¦ç´ ID, "mark": 1, "L1": è·é‡ä½ç½®, "P1": è·é‡å€¤}
      ]
    }
  }
}
```

### ğŸ“Š æŠ€è¡“çš„å„ªä½æ€§
| é …ç›® | æ–°å®Ÿè£… | æ—§å®Ÿè£… | æ”¹å–„ |
|------|--------|--------|------|
| ç¯€ç‚¹æ•° | 66ç¯€ç‚¹ | 60ç¯€ç‚¹ | +6ç¯€ç‚¹ï¼ˆé«˜ç²¾åº¦ï¼‰ |
| è¦ç´ åˆ†å‰² | è‡ªå‹•å®Ÿè¡Œ | ãªã— | é©æ–°çš„æ©Ÿèƒ½ |
| è·é‡å‡¦ç† | 24ã‚±ãƒ¼ã‚¹ | åŸºæœ¬å¯¾å¿œ | åŒ…æ‹¬çš„å‡¦ç† |
| å“è³ªä¿è¨¼ | çµ±åˆãƒ†ã‚¹ãƒˆ | åŸºæœ¬ãƒ†ã‚¹ãƒˆ | ç¶™ç¶šçš„ä¿è¨¼ |

### ğŸ” çµ±åˆãƒ†ã‚¹ãƒˆ
```bash
# æ–°æ—§å®Ÿè£…ã®å“è³ªæ¯”è¼ƒ
python check_integration_test.py

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# âœ… æ–°å®Ÿè£…ã®ç¯€ç‚¹æ•°: 66
# âœ… æ—§å®Ÿè£…ã®ç¯€ç‚¹æ•°: 60
# âœ… ç¯€ç‚¹æ•°å·®: -6ï¼ˆæ–°å®Ÿè£…ãŒé«˜ç²¾åº¦ï¼‰
```

---

## ææ–™éç·šå½¢è§£æï¼ˆ2026å¹´1æœˆè¿½åŠ ï¼‰

### JRç·ç ”å‰›æ€§ä½æ¸›RCå‹ãƒ¢ãƒ‡ãƒ«
```python
from src.fem import FemModel

# éç·šå½¢è§£æã®å®Ÿè¡Œï¼ˆè§£æãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯JSONã§æŒ‡å®šï¼‰
model = FemModel()
model.load_model("tests/data/snap/beam001.json")
results = model.run(analysis_type="material_nonlinear")
```

### è§£æãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆloadã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§æŒ‡å®šï¼‰
```json
"load": {
  "1": {
    "fix_node": 1,
    "fix_member": 1,
    "element": 1,
    "joint": 1,
    "n_load_steps": 10,      // è·é‡å¢—åˆ†ã‚¹ãƒ†ãƒƒãƒ—æ•°
    "max_iterations": 50,    // æœ€å¤§åå¾©å›æ•°
    "tolerance": 1e-6,       // åæŸåˆ¤å®šè¨±å®¹å·®
    "n_modes": 10,           // å›ºæœ‰ãƒ¢ãƒ¼ãƒ‰æ•°ï¼ˆmodalç”¨ï¼‰
    "load_node": [...]
  }
}
```

### éç·šå½¢ææ–™å®šç¾©ï¼ˆJSONï¼‰
```json
"element": {
  "1": {
    "2": {
      "E": 26500000,
      "A": 1000,
      "Iz": 1000,
      "nonlinear": {
        "type": "jr_stiffness_reduction",
        "delta_1": 1e-05, "delta_2": 0.0001, "delta_3": 0.001,
        "P_1": 1000.0, "P_2": 3000.0, "P_3": 5000.0,
        "beta": 0.4,
        "symmetric": true,
        "hysteresis_dofs": ["moment_z"]
      }
    }
  }
}
```

### 4æŠ˜ç·šã‚¹ã‚±ãƒ«ãƒˆãƒ³ã‚«ãƒ¼ãƒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | èª¬æ˜ | å˜ä½ |
|-----------|------|------|
| delta_1 | ã²ã³å‰²ã‚Œå¤‰ä½ | m |
| delta_2 | é™ä¼å¤‰ä½ | m |
| delta_3 | çµ‚å±€å¤‰ä½ | m |
| P_1 | ã²ã³å‰²ã‚Œè·é‡ | N |
| P_2 | é™ä¼è·é‡ | N |
| P_3 | çµ‚å±€è·é‡ | N |
| beta | å‰›æ€§ä½æ¸›ä¿‚æ•° | - |

### éç·šå½¢é©ç”¨è‡ªç”±åº¦ï¼ˆhysteresis_dofsï¼‰
| å€¤ | èª¬æ˜ |
|----|------|
| `"axial"` | è»¸åŠ›ï¼ˆNï¼‰ |
| `"moment_y"` | Yè»¸å‘¨ã‚Šæ›²ã’ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆ |
| `"moment_z"` | Zè»¸å‘¨ã‚Šæ›²ã’ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆ |
| `"torsion"` | ã­ã˜ã‚Šãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆ |

### è§£æã‚¿ã‚¤ãƒ—
| ã‚¿ã‚¤ãƒ— | èª¬æ˜ |
|--------|------|
| `"static"` | ç·šå½¢é™çš„è§£æ |
| `"material_nonlinear"` | ææ–™éç·šå½¢è§£æï¼ˆNewton-Raphsonæ³•ï¼‰ |

---

## åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•ï¼ˆå¾“æ¥APIï¼‰

### æœ€å°é™ã®2Dãƒ•ãƒ¬ãƒ¼ãƒ è§£æ
```python
import requests

model_data = {
    "dimension": 2,
    "node": {"1": {"x": 0, "y": 0}, "2": {"x": 5, "y": 0}},
    "member": {"1": {"ni": 1, "nj": 2, "e": 1}},
    "element": {"1": {"1": {"E": 205000000, "G": 79000000, "nu": 0.3, "Xp": 1.2e-5, "A": 0.01, "Iy": 0.0001, "Iz": 0.0001, "J": 0.0001}}},
    "fix_node": {"1": [{"n": "1", "tx": 1, "ty": 1, "tz": 0, "rx": 1, "ry": 1, "rz": 1}]},
    "load": {"case1": {"rate": 1.0, "symbol": "case1", "load_node": [{"n": 2, "ty": -10}]}},
    # ğŸ¯ ç€ç›®ç‚¹ã«ã‚ˆã‚‹è¦ç´ åˆ†å‰²ï¼ˆæ–°æ©Ÿèƒ½ï¼‰
    "notice_points": [{"m": 1, "Points": [1.35]}]
}

response = requests.post('http://localhost:5000/', json=model_data)
results = response.json()
```

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆ

### ç¯€ç‚¹å®šç¾©
```json
"node": {
  "ç¯€ç‚¹ID": {"x": Xåº§æ¨™, "y": Yåº§æ¨™, "z": Zåº§æ¨™}
}
```

### éƒ¨æå®šç¾©
```json
"member": {
  "éƒ¨æID": {"ni": å§‹ç‚¹ç¯€ç‚¹ID, "nj": çµ‚ç‚¹ç¯€ç‚¹ID, "e": è¦ç´ ID}
}
```

### ææ–™ãƒ»æ–­é¢ç‰¹æ€§
```json
"element": {
  "è¦ç´ ID": {
    "E": ãƒ¤ãƒ³ã‚°ä¿‚æ•°,
    "G": ã›ã‚“æ–­å¼¾æ€§ä¿‚æ•°,
    "A": æ–­é¢ç©,
    "Iy": Yè»¸å›ã‚Šæ–­é¢äºŒæ¬¡ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆ,
    "Iz": Zè»¸å›ã‚Šæ–­é¢äºŒæ¬¡ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆ,
    "J": ã­ã˜ã‚Šå®šæ•°
  }
}
```

### æ”¯ç‚¹æ¡ä»¶
```json
"fix_node": {
  "æ”¯ç‚¹ã‚±ãƒ¼ã‚¹ID": {
    "ç¯€ç‚¹ID": {
      "x": 0, // 0=è‡ªç”±, 1=æ‹˜æŸ, >1000=ãƒãƒå®šæ•°
      "y": 1,
      "z": 0,
      "rx": 0,
      "ry": 1,
      "rz": 0
    }
  }
}
```

### ğŸ†• è·é‡å®šç¾©ï¼ˆè¦ç´ åˆ†å‰²å¯¾å¿œï¼‰
```json
"load": {
  "è·é‡ã‚±ãƒ¼ã‚¹ID": {
    "rate": 1.0,
    "symbol": "DL",
    "load_node": [
      {"n": ç¯€ç‚¹ID, "tx": 0, "ty": -10, "tz": 0, "mx": 0, "my": 0, "mz": 0}
    ],
    "load_member": [
      // åˆ†å¸ƒè·é‡ï¼ˆè‡ªå‹•åˆ†å‰²å¯¾è±¡ï¼‰
      {"m": éƒ¨æID, "mark": 2, "direction": "gy", "p1": -20, "p2": -20, "L1": 0, "L2": 8},
      // é›†ä¸­è·é‡ï¼ˆè‡ªå‹•åˆ†å‰²å¯¾è±¡ï¼‰
      {"m": éƒ¨æID, "mark": 1, "direction": "gy", "L1": 2.5, "P1": 100}
    ]
  }
}
```

### ğŸ†• ç€ç›®ç‚¹å®šç¾©ï¼ˆè¦ç´ åˆ†å‰²ï¼‰
```json
"notice_points": [
  {
    "m": è¦ç´ ID, // åˆ†å‰²å¯¾è±¡è¦ç´ 
    "Points": [1.35, 2.5] // åˆ†å‰²ä½ç½®ï¼ˆè¦ç´ iç«¯ã‹ã‚‰ã®è·é›¢ï¼‰
  }
]
```

## ä¸€èˆ¬çš„ãªæ”¯ç‚¹æ¡ä»¶

### å›ºå®šæ”¯ç‚¹
```json
{"x": 1, "y": 1, "z": 1, "rx": 1, "ry": 1, "rz": 1}
```

### ãƒ”ãƒ³æ”¯ç‚¹
```json
{"x": 1, "y": 1, "z": 1, "rx": 0, "ry": 0, "rz": 0}
```

### ãƒ­ãƒ¼ãƒ©ãƒ¼æ”¯ç‚¹ï¼ˆYæ–¹å‘ã®ã¿æ‹˜æŸï¼‰
```json
{"x": 0, "y": 1, "z": 0, "rx": 0, "ry": 0, "rz": 0}
```

### ğŸ†• ãƒãƒæ”¯ç‚¹ï¼ˆæ–°å®Ÿè£…å¯¾å¿œï¼‰
```json
{"x": 0, "y": 61902, "z": 0, "rx": 0, "ry": 0, "rz": 0} // y=61902 ã¯ãƒãƒå®šæ•°ï¼ˆkN/mï¼‰
```

## è·é‡æ–¹å‘æŒ‡å®š

### å…¨ä½“åº§æ¨™ç³»
- `"gx"`: å…¨ä½“Xæ–¹å‘
- `"gy"`: å…¨ä½“Yæ–¹å‘
- `"gz"`: å…¨ä½“Zæ–¹å‘

### è¦ç´ å±€æ‰€åº§æ¨™ç³»
- `"x"`: è¦ç´ å±€æ‰€xæ–¹å‘ï¼ˆéƒ¨æè»¸æ–¹å‘ï¼‰
- `"y"`: è¦ç´ å±€æ‰€yæ–¹å‘
- `"z"`: è¦ç´ å±€æ‰€zæ–¹å‘

### ğŸ†• è·é‡ãƒãƒ¼ã‚¯ï¼ˆè¦ç´ åˆ†å‰²å¯¾å¿œï¼‰
- `mark: 1`: é›†ä¸­è·é‡ï¼ˆè‡ªå‹•åˆ†å‰²å¯¾è±¡ï¼‰
- `mark: 2`: åˆ†å¸ƒè·é‡ï¼ˆè‡ªå‹•åˆ†å‰²å¯¾è±¡ï¼‰
- `mark: 11`: é›†ä¸­è·é‡ï¼ˆåˆ†å‰²å¯¾è±¡å¤–ï¼‰

## å…¸å‹çš„ãªææ–™ç‰¹æ€§

### é‹¼æï¼ˆSS400ï¼‰
```json
{
  "E": 205000000, // kN/mÂ²
  "G": 79000000, // kN/mÂ²
  "poi": 0.3
}
```

### ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆï¼ˆFc=24ï¼‰
```json
{
  "E": 25000000, // kN/mÂ²
  "G": 10400000, // kN/mÂ²
  "poi": 0.2
}
```

## ğŸ†• æ–°å®Ÿè£…ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
```python
from src.fem.model import FemModel

try:
    model = FemModel()
    model.load_model("model.json")
    
    # è¦ç´ åˆ†å‰²æƒ…å ±ã®ç¢ºèª
    print(f"ç¯€ç‚¹æ•°: {model.get_node_count()}")
    print(f"è¦ç´ æ•°: {model.get_element_count()}")
    
    results = model.run(analysis_type="static")
except FileNotFoundError:
    print("ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
except ValueError as e:
    print(f"ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‚¨ãƒ©ãƒ¼: {e}")
except np.linalg.LinAlgError:
    print("è¡Œåˆ—è¨ˆç®—ã‚¨ãƒ©ãƒ¼: ä¸å®‰å®šæ§‹é€ ã®å¯èƒ½æ€§")
except Exception as e:
    print(f"äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: {e}")
```

## å¾“æ¥APIã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
```python
try:
    response = requests.post('http://localhost:5000/', json=model_data, timeout=30)
    if response.status_code == 200:
        results = response.json()
        # æˆåŠŸå‡¦ç†
    elif response.status_code == 400:
        error = response.json()
        print(f"å…¥åŠ›ã‚¨ãƒ©ãƒ¼: {error['message']}")
    elif response.status_code == 500:
        error = response.json()
        print(f"è¨ˆç®—ã‚¨ãƒ©ãƒ¼: {error['message']}")
except requests.exceptions.Timeout:
    print("ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼")
except requests.exceptions.ConnectionError:
    print("æ¥ç¶šã‚¨ãƒ©ãƒ¼")
```

## çµæœãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹

### ğŸ†• æ–°å®Ÿè£…ï¼ˆFemModelï¼‰
```python
# é«˜ç²¾åº¦è§£æçµæœ
results = model.get_results()
displacement = results["displacement"]  # ç¯€ç‚¹å¤‰ä½ï¼ˆ66ç¯€ç‚¹ã®è©³ç´°çµæœï¼‰

for node_id, disp in displacement.items():
    dx = disp.get('dx', 0)  # Xæ–¹å‘å¤‰ä½
    dy = disp.get('dy', 0)  # Yæ–¹å‘å¤‰ä½
    print(f"ç¯€ç‚¹{node_id}: dx={dx:.6e}, dy={dy:.6e}")
```

### å¾“æ¥API
```python
results = response.json()

# ç¯€ç‚¹å¤‰ä½
displacement = results['è·é‡ã‚±ãƒ¼ã‚¹ID']['disg']['ç¯€ç‚¹ID']
dx = displacement['dx']  # Xæ–¹å‘å¤‰ä½
dy = displacement['dy']  # Yæ–¹å‘å¤‰ä½

# æ”¯ç‚¹ååŠ›
reaction = results['è·é‡ã‚±ãƒ¼ã‚¹ID']['reac']['ç¯€ç‚¹ID']
fx = reaction['tx']  # Xæ–¹å‘ååŠ›
fy = reaction['ty']  # Yæ–¹å‘ååŠ›

# éƒ¨ææ–­é¢åŠ›
section_force = results['è·é‡ã‚±ãƒ¼ã‚¹ID']['fsec']['éƒ¨æID']['æ–­é¢ID']
axial = section_force['fxi']  # è»¸åŠ›
shear = section_force['fyi']  # ã›ã‚“æ–­åŠ›
moment = section_force['mzi']  # æ›²ã’ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆ
```

## å˜ä½ç³»
| é …ç›® | å˜ä½ |
|------|------|
| é•·ã• | m |
| åŠ› | kN |
| ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆ | kNm |
| å¿œåŠ› | kN/mÂ² |
| å¤‰ä½ | mm |
| å›è»¢è§’ | rad |
| ãƒãƒå®šæ•° | kN/m, kNm/rad |

## ğŸ†• æ–°å®Ÿè£…ã®ç‰¹æ®Šæ©Ÿèƒ½

### L2è² å€¤å‡¦ç†ï¼ˆåˆ†å¸ƒè·é‡ï¼‰
```json
// L2ãŒè² å€¤ã®å ´åˆã€è·é‡å¹…â†’jç«¯ã‹ã‚‰ã®è·é›¢ã«è‡ªå‹•å¤‰æ›
{"m": 1, "mark": 2, "L1": 0, "L2": -2.0, "P1": 50, "P2": 50}
// è¦ç´ é•·6mã®å ´åˆã€L2=-2.0 â†’ jç«¯ã‹ã‚‰2.0m = iç«¯ã‹ã‚‰4.0m
```

### é‡è¤‡ç¯€ç‚¹ã®è‡ªå‹•å‡¦ç†
- åº§æ¨™ãƒ™ãƒ¼ã‚¹ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆè¨±å®¹èª¤å·®: 1e-6ï¼‰
- è‡ªå‹•çš„ãªç¯€ç‚¹ç•ªå·ã®å†å‰²ã‚Šå½“ã¦
- ãƒ¡ãƒƒã‚·ãƒ¥å“è³ªã®è‡ªå‹•ä¿è¨¼

## ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ³•

### ğŸ†• è¦ç´ åˆ†å‰²é–¢é€£
- **åˆ†å‰²ä½ç½®ã‚¨ãƒ©ãƒ¼**: 0 < ä½ç½® < è¦ç´ é•· ã®ç¯„å›²å†…ã§æŒ‡å®š
- **é‡è¤‡åˆ†å‰²ç‚¹**: åŒä¸€ä½ç½®ã®è¤‡æ•°æŒ‡å®šã¯è‡ªå‹•çš„ã«çµ±åˆ
- **ç¯€ç‚¹ç•ªå·ç«¶åˆ**: æ–°è¦ç¯€ç‚¹ã¯è‡ªå‹•çš„ã«é©åˆ‡ãªç•ªå·ã‚’å‰²ã‚Šå½“ã¦

### ä¸å®‰å®šæ§‹é€ 
- æ”¯ç‚¹æ¡ä»¶ã‚’ç¢ºèª
- éƒ¨æã®æ¥ç¶šã‚’ç¢ºèª
- æç«¯æ¡ä»¶ã‚’ç¢ºèª

### æ•°å€¤ã‚¨ãƒ©ãƒ¼
- å˜ä½ç³»ã®çµ±ä¸€
- æ¥µç«¯ã«å°ã•ã„/å¤§ãã„å€¤ã®å›é¿
- ææ–™ç‰¹æ€§ã®å¦¥å½“æ€§ç¢ºèª

### æ€§èƒ½å•é¡Œ
- å¤§è¦æ¨¡ãƒ¢ãƒ‡ãƒ«ã§ã¯åœ§ç¸®ä½¿ç”¨
- ä¸è¦ãªç²¾åº¦è¨­å®šã®å›é¿
- ãƒãƒƒãƒå‡¦ç†ã®æ´»ç”¨

## ğŸŠ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®Œäº†

**2025å¹´6æœˆ1æ—¥: Python FEMè§£æãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« ã‚¯ãƒ©ã‚¹æ§‹æˆå†ç·¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒæŠ€è¡“çš„æˆåŠŸã‚’åã‚ã¦å®Œäº†ã€‚æ¬¡ä¸–ä»£é«˜ç²¾åº¦FEMè§£æã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦æœ¬æ ¼é‹ç”¨é–‹å§‹ã€‚**
