---
hide:
- navigation
---
# Note
<font color=gray size=3> ä¸€äº›é€†å‘è¿‡ç¨‹çš„ç¬”è®°</font>

### å……å€¼ç”µè´¹
ZZU çš„ç”µè´¹å……å€¼ç³»ç»Ÿå¯¹å……å€¼çš„è¯·æ±‚ä½“è¿›è¡Œäº†åŠ å¯†ï¼Œè¿™æœ¬æ²¡æœ‰é—®é¢˜ï¼Œä½†ä»–å±…ç„¶é€‰æ‹©çš„æ˜¯å›½å¯†ç®—æ³•ï¼ŒSM2 å’Œ SM4ã€‚å¯èƒ½æ˜¯å›½äº§åŒ–æŒ‡æ ‡å§ï¼Œå”‰ğŸ˜®â€ğŸ’¨ã€‚  
ç”šè‡³ä»–ä½¿ç”¨çš„ `sm-crypto` å¯¹äº SM2 ç®—æ³•çš„å®ç°å¹¶ä¸å¤Ÿè§„èŒƒï¼Œæ²¡æœ‰å¯¹ `04` å¤´è¿›è¡Œå¤„ç†ï¼Œæ•´çš„æˆ‘æ‡µäº†åŠå¤©

ä»¥ä¸‹ä¸º `server/utilities/pay` ä¸­ `params` çš„åŸå§‹ç»“æ„ï¼ˆæ ¼å¼åŒ–åï¼‰
```json
{
    "utilityType": "electric",
    "payCode": "06",
    "password": "{æ”¯ä»˜å¯†ç }",
    "amt": "{å……å€¼é‡‘é¢}",
    "timestamp": {timestamp},
    "bigArea": "",
    "area": "{area}",
    "building": "{building}",
    "unit": "",
    "level": "{level}",
    "room": "{area}-{building}--{level}-{room}",
    "subArea": "",
    "customfield": {
    }
}
```
ä½¿ç”¨ SM2 ç®—æ³• (CipherMode: C1C3C2) å¯¹å…¶è¿›è¡ŒåŠ å¯†ï¼ˆåŠ å¯†æ—¶éœ€å°†å…¶å‹ç¼©ï¼‰ï¼Œç„¶ååˆ å» `04` å¤´ã€‚å…¬é’¥ç”± `server/auth/getEncrypt` ä¸­çš„ `publicKey` è¿›è¡Œ SM4 è§£å¯†åå¾—åˆ°ï¼ŒSM4 å¯†é’¥ä¸º`773638372d392b33435f48266a655f35 (Hex)`

### Sign
æ ‘ç»´æ•™åŠ¡çš„å¤§å¤šæ•°è¯·æ±‚çš„è¯·æ±‚å¤´é‡Œéƒ½æœ‰ä¸ª `sign` å€¼ï¼Œå¤§å®¶éƒ½çŸ¥é“è¿™æ˜¯æ‹¿æ¥æ ¡éªŒçš„ï¼Œç„¶è€Œæ ‘ç»´æ•™åŠ¡æ ¹æœ¬ä¸å¯¹ `sign` å€¼è¿›è¡Œæ ¡éªŒï¼Œç”šè‡³è¯·æ±‚å¤´é‡Œæ²¡æœ‰ `sign` éƒ½æ²¡å…³ç³».....    
æˆ‘å½“æ—¶é€†å‘æŠ˜è…¾äº†åŠå¤©ï¼Œæ°”æ­»äº† ğŸ˜¡ğŸ˜¡ğŸ˜¡   
å…·ä½“é€»è¾‘å¿˜äº†ï¼Œç›´æ¥æ”¾ Python å®ç°å§
```Python
def get_sign(dynamic_secret: str, params: str) -> str:
    """è®¡ç®—è¯·æ±‚çš„ sign å€¼

    Args:
        dynamic_secret (str): login åè‡ªåŠ¨è·å–ï¼Œæ¥è‡ª login-token è¯·æ±‚
        params (str): URL è¯·æ±‚å‚æ•°

    Returns:
        str: sign å€¼
    """
    parsed_params: Dict[str, str] = {k: v[0] for k, v in parse_qs(params).items()}

    timestamp = parsed_params.pop("timestamp", "")
    random = parsed_params.pop("random", "")

    sorted_values = [v for k, v in sorted(parsed_params.items())]

    parts_to_sign = [dynamic_secret] + sorted_values + [timestamp, random]
    original_string = "|".join(parts_to_sign)

    sign = hashlib.md5(original_string.encode("utf-8")).hexdigest().upper()
    return sign
```

### è‡ªåŠ©æœåŠ¡ç³»ç»Ÿ
å…ˆä¸æè‡ªåŠ©æœåŠ¡ç³»ç»Ÿé‚£éšè—äº†çš„ã€ç¥å¥‡çš„ã€ä¸ºç©ºçš„éªŒè¯ç ï¼Œä»–è¿˜æœ‰ä¸ª `checkcode`ã€‚  
æˆ‘ä¸€å¼€å§‹è¿˜ä»¥ä¸ºå®ƒæ˜¯å“ªé‡Œç®—å‡ºæ¥çš„ï¼Œæœ€åå‘ç°å…¶å®å®ƒçš„å€¼ç›´æ¥å†™åœ¨ç½‘é¡µé‡Œäº†....


### ç»Ÿä¸€è®¤è¯
ä¼—æ‰€å‘¨çŸ¥è±«è§éƒ‘å¤§ APP ç«¯çš„ç»Ÿä¸€è®¤è¯ä½¿ç”¨çš„æ˜¯æ ‡å‡†çš„ JWT æ–¹æ¡ˆã€‚é‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨ ZZU.Py è¿›è¡Œè´¦å¯†ç™»å½•ï¼Œæ‰‹æœºä¸Šå°±ä¼šè¢«è¸¢ä¸‹çº¿å‘¢ï¼Ÿ  
å…³é”®åœ¨äº `https://cas.s.zzu.edu.cn/token/login/userOnlineDetect` ã€‚è±«è§éƒ‘å¤§ APP ç«¯å¯åŠ¨æ—¶ä¼šé€šè¿‡è¿™ä¸ªæ¥å£ä¸ŠæŠ¥å­¦å· ã€`deviceId` å’Œ `userToken`ï¼Œå¹¶æ ¹æ®å“åº”å†³å®šè¦ä¸è¦è®©ä½ é‡æ–°ç™»å½•ã€‚  
ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ Block æ‰è¿™ä¸ªè¯·æ±‚ï¼Œæ‰‹æœºä¸Šçš„è±«è§éƒ‘å¤§ APP å°±ä¸ä¼šå› ä¸º ZZU.Py è¿›è¡Œè´¦å¯†ç™»å½•è€Œè¢«è¸¢ä¸‹çº¿äº†ã€‚  
æœ¬æ¥è¿˜æƒ³åç¼–è¯‘ apk çœ‹çœ‹èƒ½ä¸èƒ½æ”¹ä¸‹...ç»“æœå‘ç°åŠ äº†çˆ±åŠ å¯†ä¼ä¸šç‰ˆçš„å£³ï¼Œé¥¶äº†æˆ‘å§...  
å†™ä¸ª Xposed æ¨¡å—è¿›è¡Œ Hookï¼Œç„¶åç”¨ LSPatch æ‰“åŒ…åº”è¯¥æ˜¯ä¸ªåŠæ³•ï¼Œå¯æƒœæˆ‘ä¸ä¼š Java ï¼Œå°±ç•™ç»™æœ‰ç¼˜äººå®ç°å§ã€‚