[tools]
node = "22"
python = "3.12"

[tasks.install]
description = "Install all dependencies"
run = """
npm install
pip install -e ".[test]"
pip install build twine
"""

[tasks.build]
description = "Build both packages"
depends = ["build:js", "build:py"]

[tasks."build:js"]
description = "Build TypeScript package"
run = "npm run build"

[tasks."build:py"]
description = "Build Python package"
run = "python -m build"

[tasks.test]
description = "Run all tests"
depends = ["test:js", "test:py"]

[tasks."test:js"]
description = "Run TypeScript tests"
run = "npm test"

[tasks."test:py"]
description = "Run Python tests"
run = "pytest"

[tasks."test:watch"]
description = "Run TypeScript tests in watch mode"
run = "npm run test:watch"

[tasks.clean]
description = "Clean build artifacts"
run = """
rm -rf dist
rm -rf python/sloplog/__pycache__
rm -rf test/python/__pycache__
rm -rf *.egg-info
"""

[tasks.publish]
description = "Publish both packages"
depends = ["publish:js", "publish:py"]

[tasks."publish:js"]
description = "Publish to npm"
depends = ["test:js"]
run = "npm publish"

[tasks."publish:py"]
description = "Publish to PyPI"
depends = ["test:py", "build:py"]
run = "twine upload dist/*"

[tasks."publish:js:dry"]
description = "Dry run npm publish"
depends = ["test:js"]
run = "npm publish --dry-run"

[tasks."publish:py:dry"]
description = "Check Python package before publishing"
depends = ["build:py"]
run = "twine check dist/*"

[tasks.lint]
description = "Run all linters"
depends = ["lint:js", "lint:py"]

[tasks."lint:js"]
description = "Lint TypeScript/JavaScript files with ESLint"
run = "npx eslint ."

[tasks."lint:py"]
description = "Type check Python files with Pyright"
run = "npx pyright"

[tasks."lint:fix"]
description = "Fix auto-fixable linting issues"
run = "npx eslint . --fix"

[tasks.format]
description = "Format all files"
depends = ["format:js", "format:py"]

[tasks."format:js"]
description = "Format TypeScript/JavaScript files with Prettier"
run = "npx prettier --write '**/*.{ts,js,json,md}'"

[tasks."format:py"]
description = "Format Python files with Ruff (if available)"
run = "ruff format python || echo 'Ruff not installed, skipping Python formatting'"

[tasks."format:check"]
description = "Check formatting without making changes"
depends = ["format:check:js"]

[tasks."format:check:js"]
description = "Check TypeScript/JavaScript formatting"
run = "npx prettier --check '**/*.{ts,js,json,md}'"

[tasks.check]
description = "Run all checks (lint + format check)"
depends = ["lint", "format:check"]
