#!/usr/bin/env python3
"""Standalone promotional screen displaying the Clanki logo with shimmer animation."""

import os
import sys
import time

# fmt: off
LOGO_DATA = [
    [('+',131,131,131),('+',129,129,129),('+',128,128,128),('=',127,127,127),('=',126,126,126),('=',125,125,125),('=',123,123,123),('=',122,122,122),('=',121,121,121),('=',120,120,120),('=',118,118,118),('=',117,117,117),('@',232,232,232),('@',255,255,255),('@',255,255,255),('%',176,217,244),('#',141,199,239),('@',230,243,251),('@',253,254,254),('@',253,253,254),('@',241,241,241),('*',155,155,155),('-',96,96,96),('-',100,100,100),('-',98,98,98),('-',96,96,96),('-',96,96,96),('-',95,95,95),('-',95,95,95),('-',94,94,94)],
    [('=',111,111,111),('=',119,119,119),('=',127,127,127),('+',132,132,132),('+',135,135,135),('+',135,135,135),('+',133,133,133),('+',130,130,130),('+',128,128,128),('=',127,127,127),('=',121,121,121),('+',140,140,140),('@',252,252,252),('@',255,255,255),('@',255,255,255),('#',143,202,239),('*',100,180,233),('*',105,183,234),('%',163,211,241),('@',243,249,252),('@',253,253,253),('@',253,253,253),('%',222,222,222),('+',134,134,134),('-',100,100,100),('=',104,104,104),('-',101,101,101),('-',98,98,98),('-',96,96,96),('-',99,99,99)],
    [('.',41,41,41),('.',40,40,40),('.',39,39,39),('.',42,42,42),('.',48,48,48),(':',57,57,57),(':',71,71,71),('-',86,86,86),('-',102,102,102),('=',118,118,118),('=',123,123,123),('*',157,157,157),('@',255,255,255),('@',255,255,254),('@',254,254,254),('#',136,197,239),('*',109,184,236),('*',114,187,236),('*',109,185,235),('#',115,187,236),('%',193,226,246),('@',253,254,254),('@',253,253,254),('@',254,254,254),('%',216,216,216),('#',180,180,180),('#',191,191,191),('#',204,204,204),('%',223,223,223),('@',241,241,241)],
    [('.',49,49,49),('.',48,48,48),('.',47,47,47),('.',46,46,46),('.',45,45,45),('.',43,43,43),('.',42,42,42),('.',39,39,39),('.',37,37,37),('.',37,37,37),(' ',25,25,25),('=',106,106,106),('@',255,255,255),('@',254,254,253),('@',246,250,253),('#',127,193,237),('#',123,192,237),('#',129,194,238),('#',124,192,237),('#',122,190,237),('#',115,187,237),('#',133,196,238),('%',199,228,247),('@',242,249,253),('@',253,254,254),('@',255,255,255),('@',255,255,255),('@',252,253,254),('@',240,248,252),('@',223,240,250)],
    [(':',55,55,55),(':',54,54,54),(':',52,52,52),('.',51,51,51),('.',50,50,50),('.',48,48,48),('.',48,48,48),('.',47,47,47),('.',45,45,45),('.',42,42,42),('.',26,26,26),('*',158,158,158),('@',255,255,255),('@',254,255,253),('@',213,234,249),('+',32,147,225),('+',40,151,226),('+',55,158,228),('*',78,169,231),('*',103,182,234),('#',123,191,237),('#',134,196,238),('#',129,194,238),('#',126,193,237),('#',137,198,239),('#',140,200,240),('#',134,197,239),('#',125,192,238),('#',116,188,236),('*',111,186,236)],
    [(':',61,61,61),(':',59,59,59),(':',59,59,59),(':',58,58,58),(':',54,54,54),('.',49,49,49),(':',55,55,55),('-',80,80,80),('=',121,121,121),('*',173,173,173),('%',224,224,224),('@',253,254,254),('@',252,253,254),('@',249,252,253),('#',116,188,236),('+',43,153,227),('+',53,158,228),('+',49,156,227),('+',46,154,227),('+',41,152,226),('+',40,151,226),('+',50,156,227),('*',73,167,230),('*',102,181,234),('#',127,194,238),('#',139,199,239),('#',137,198,239),('#',132,196,238),('#',131,194,238),('#',129,194,237)],
    [(':',68,68,68),(':',62,62,62),(':',70,70,70),('=',112,112,112),('*',165,165,165),('%',207,207,207),('@',242,242,242),('@',253,253,254),('@',255,255,254),('@',253,254,254),('@',245,250,252),('@',210,233,249),('#',157,208,242),('*',88,175,233),('*',69,165,230),('*',70,165,231),('*',67,164,230),('+',65,163,229),('+',62,162,229),('+',60,161,229),('+',58,159,228),('+',56,159,228),('+',53,158,228),('+',48,155,228),('+',46,154,227),('+',57,159,228),('*',84,173,232),('#',117,188,236),('#',141,200,239),('#',144,202,240)],
    [('-',86,86,86),('#',186,186,186),('@',247,247,247),('@',253,253,253),('@',254,255,255),('@',251,252,253),('@',227,242,251),('%',198,227,247),('#',160,210,242),('#',125,192,237),('*',100,180,234),('*',90,175,232),('*',92,176,233),('*',92,176,233),('*',88,174,233),('*',86,173,232),('*',83,172,232),('*',81,171,232),('*',78,170,232),('*',76,169,231),('*',74,168,231),('*',72,166,231),('*',69,165,230),('*',67,164,230),('+',65,163,229),('+',63,162,229),('+',60,161,229),('+',54,158,228),('+',57,160,229),('*',81,171,232)],
    [('%',209,209,209),('@',254,254,254),('@',252,253,253),('@',247,251,253),('%',179,218,244),('#',129,194,238),('#',117,188,236),('#',118,188,236),('#',119,190,237),('#',118,188,236),('*',114,187,236),('*',111,185,236),('*',109,184,235),('*',107,184,235),('*',104,182,234),('*',102,181,234),('*',100,180,234),('*',97,179,233),('*',95,178,233),('*',93,177,233),('*',90,175,233),('*',88,174,233),('*',85,173,232),('*',83,172,232),('*',81,171,232),('*',78,170,232),('*',76,169,231),('*',73,168,231),('*',71,167,230),('*',70,166,230)],
    [('=',118,118,118),('%',220,220,220),('@',253,253,253),('@',255,254,254),('@',253,253,254),('@',241,248,252),('@',216,236,249),('%',192,224,246),('%',165,212,242),('#',144,201,239),('#',129,194,238),('#',124,192,237),('#',125,192,237),('#',123,191,237),('#',120,190,237),('#',118,189,236),('#',116,188,236),('*',113,187,236),('*',111,186,235),('*',108,185,235),('*',106,183,235),('*',104,182,234),('*',102,181,234),('*',100,180,234),('*',97,179,234),('*',95,178,233),('*',92,176,233),('*',90,175,233),('*',87,174,233),('*',85,173,232)],
    [('-',90,90,90),('-',85,85,85),('=',111,111,111),('*',159,159,159),('#',200,200,200),('@',233,233,233),('@',253,254,254),('@',255,254,254),('@',255,255,255),('@',254,254,254),('@',244,249,252),('@',220,238,250),('%',189,223,245),('#',150,204,240),('#',135,197,238),('#',135,197,238),('#',132,196,238),('#',130,194,238),('#',127,193,237),('#',125,192,237),('#',123,191,237),('#',120,190,236),('#',118,189,236),('#',115,188,236),('*',113,186,236),('*',111,185,236),('*',108,185,235),('*',106,183,234),('*',104,182,234),('*',101,181,234)],
    [('-',95,95,95),('-',94,94,94),('-',94,94,94),('-',91,91,91),('-',86,86,86),('-',86,86,86),('-',99,99,99),('=',124,124,124),('*',159,159,159),('#',195,195,195),('@',233,233,233),('@',253,254,254),('@',253,254,254),('@',254,254,254),('%',196,227,246),('#',146,202,240),('#',149,204,241),('#',146,203,240),('#',144,201,240),('#',141,200,239),('#',139,199,239),('#',137,198,238),('#',134,197,238),('#',132,196,238),('#',130,194,238),('#',128,193,238),('#',125,192,237),('#',123,191,237),('#',121,190,237),('#',118,189,236)],
    [('-',101,101,101),('-',99,99,99),('-',98,98,98),('-',97,97,97),('-',95,95,95),('-',94,94,94),('-',94,94,94),('-',93,93,93),('-',90,90,90),('-',87,87,87),('-',78,78,78),('+',148,148,148),('@',255,255,255),('@',254,253,253),('@',251,253,254),('%',177,217,244),('%',162,210,243),('%',162,210,243),('#',160,209,242),('#',157,208,242),('#',155,207,241),('#',153,206,241),('#',148,204,241),('#',150,204,241),('%',164,211,242),('%',172,215,243),('%',169,213,243),('#',160,209,242),('#',149,204,241),('#',138,198,239)],
    [('=',107,107,107),('=',105,105,105),('=',104,104,104),('-',102,102,102),('-',101,101,101),('-',100,100,100),('-',98,98,98),('-',97,97,97),('-',96,96,96),('-',95,95,95),('-',91,91,91),('=',103,103,103),('@',243,243,243),('@',255,255,255),('@',255,255,254),('%',206,231,248),('%',176,217,244),('%',179,218,245),('%',176,217,244),('%',174,216,244),('%',170,214,244),('%',173,215,243),('@',214,235,249),('@',248,251,254),('@',253,254,254),('@',255,255,254),('@',255,255,254),('@',255,255,255),('@',255,255,255),('@',253,253,254)],
    [('=',112,112,112),('=',111,111,111),('=',109,109,109),('=',108,108,108),('=',107,107,107),('=',105,105,105),('=',104,104,104),('=',103,103,103),('-',102,102,102),('-',100,100,100),('-',100,100,100),('-',95,95,95),('%',224,224,224),('@',255,255,255),('@',255,255,254),('@',226,241,251),('%',193,225,247),('%',195,226,247),('%',192,225,246),('%',188,223,246),('@',214,235,249),('@',251,253,254),('@',253,254,254),('@',254,254,255),('%',218,218,218),('+',140,140,140),('+',135,135,135),('+',152,152,152),('*',176,176,176),('#',197,197,197)],
]
# fmt: on

# ASCII art for "CLANKI" - 30 chars wide to match logo
# Block style using Unicode characters
CLANKI_TEXT = [
    "   █▀▀ █   ▄▀█ █▄ █ █▄▀ █     ",
    "   █▄▄ █▄▄ █▀█ █ ▀█ █ █ █     ",
]  # Each line is exactly 30 characters

# Animation constants
SHIMMER_WIDTH = 12
ANIMATION_INTERVAL = 0.02  # 20ms per frame
PAUSE_FRAMES = 150  # Pause between shimmer cycles

# Base gray for the text (will be brightened by shimmer)
TEXT_BASE_COLOR = (110, 110, 110)


def rgb_to_ansi(r: int, g: int, b: int) -> str:
    """Convert RGB to ANSI 24-bit color escape sequence."""
    return f"\033[38;2;{r};{g};{b}m"


def render_frame(shimmer_pos: int) -> list[str]:
    """Render a single frame of the logo with shimmer effect."""
    lines = []
    height = len(LOGO_DATA)

    for y, row in enumerate(LOGO_DATA):
        line = ""
        for x, (char, r, g, b) in enumerate(row):
            # Diagonal position: x + y gives the diagonal line
            diag = x + y
            distance = abs(diag - shimmer_pos)

            if distance < SHIMMER_WIDTH:
                # Shimmer intensity falls off with distance
                intensity = 1.0 - (distance / SHIMMER_WIDTH)
                boost = int(120 * intensity)
                r = min(255, r + boost)
                g = min(255, g + boost)
                b = min(255, b + boost)

            line += rgb_to_ansi(r, g, b) + char

        line += "\033[0m"
        lines.append(line)

    return lines


def render_text(shimmer_pos: int, y_offset: int) -> list[str]:
    """Render CLANKI text with shimmer effect."""
    lines = []
    text_width = len(CLANKI_TEXT[0]) if CLANKI_TEXT else 0

    for y, row in enumerate(CLANKI_TEXT):
        line = ""
        for x, char in enumerate(row):
            r, g, b = TEXT_BASE_COLOR

            # Diagonal position (continuing from logo)
            diag = x + (y + y_offset)
            distance = abs(diag - shimmer_pos)

            if distance < SHIMMER_WIDTH:
                intensity = 1.0 - (distance / SHIMMER_WIDTH)
                boost = int(100 * intensity)
                r = min(255, r + boost)
                g = min(255, g + boost)
                b = min(255, b + boost)

            line += rgb_to_ansi(r, g, b) + char

        line += "\033[0m"
        lines.append(line)

    return lines


def center_lines(lines: list[str], width: int, raw_widths: list[int]) -> list[str]:
    """Center lines horizontally."""
    centered = []
    for i, line in enumerate(lines):
        raw_width = raw_widths[i]
        padding = (width - raw_width) // 2
        centered.append(" " * max(0, padding) + line)
    return centered


def main():
    # Get terminal size
    try:
        term_size = os.get_terminal_size()
        width = term_size.columns
        height = term_size.lines
    except OSError:
        width = 80
        height = 24

    # Logo dimensions
    logo_height = len(LOGO_DATA)
    logo_width = len(LOGO_DATA[0]) if LOGO_DATA else 0
    text_height = len(CLANKI_TEXT)
    text_width = len(CLANKI_TEXT[0]) if CLANKI_TEXT else 0

    # Shimmer range (covers logo + spacing + text)
    spacing = 2
    total_content_height = logo_height + spacing + text_height
    start_pos = -SHIMMER_WIDTH
    end_pos = logo_width + total_content_height + SHIMMER_WIDTH

    # Vertical centering
    top_padding = (height - total_content_height) // 2

    # Clear screen and hide cursor
    print("\033[2J\033[H\033[?25l", end="", flush=True)

    shimmer_pos = start_pos
    pause_counter = 0

    try:
        while True:
            # Move cursor to top
            print("\033[H", end="")

            # Print top padding
            for _ in range(max(0, top_padding)):
                print()

            # Render and print logo frame
            logo_lines = render_frame(shimmer_pos)
            for line in center_lines(logo_lines, width, [logo_width] * logo_height):
                print(line)

            # Print spacing
            for _ in range(spacing):
                print()

            # Render and print animated text (y_offset accounts for logo + spacing)
            text_y_offset = logo_height + spacing
            text_lines = render_text(shimmer_pos, text_y_offset)
            for line in center_lines(text_lines, width, [text_width] * text_height):
                print(line)

            sys.stdout.flush()

            # Advance shimmer
            if pause_counter > 0:
                pause_counter -= 1
            else:
                shimmer_pos += 1
                if shimmer_pos >= end_pos:
                    pause_counter = PAUSE_FRAMES
                    shimmer_pos = start_pos

            time.sleep(ANIMATION_INTERVAL)

    except KeyboardInterrupt:
        pass
    finally:
        # Show cursor and reset colors
        print("\033[?25h\033[0m", end="")


if __name__ == "__main__":
    main()
