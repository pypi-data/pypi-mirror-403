"""Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT."""

from __future__ import annotations
from .chain import Chain
from .v2useroperation import V2UserOperation, V2UserOperationTypedDict
from compass_api_sdk.types import BaseModel, UNSET_SENTINEL
from pydantic import model_serializer
from typing import List, Optional
from typing_extensions import NotRequired, TypedDict


class V2BundleRequestTypedDict(TypedDict):
    r"""Request to execute multiple earn actions in a single atomic transaction.

    ## Supported Action Types

    - **V2_TRANSFER_FROM_EOA**: Transfer tokens from the owner's EOA to the Earn Account
    using Permit2. Requires a signed Permit2 message.
    - **V2_TRANSFER_TO_EOA**: Transfer tokens from the Earn Account back to the owner's EOA.
    No signature required (Safe owns the tokens).
    - **V2_SWAP**: Swap tokens within the Earn Account using 1inch aggregator.
    - **V2_MANAGE**: Deposit or withdraw from DeFi venues (Aave, Morpho, Vaults, etc.)

    ## Using V2_TRANSFER_FROM_EOA (Deposit to Earn Account)

    To include a transfer from EOA in your bundle, follow these steps:

    1. **One-time setup**: Approve Permit2 to spend the token by calling
    `POST /v2/gas_sponsorship/approve_transfer` and executing the returned transaction.

    2. **Get Permit2 signature**: Call `POST /v2/earn/transfer` with:
    - `action`: \"DEPOSIT\"
    - `gas_sponsorship`: true
    - `spender`: omit this field (defaults to Safe address for bundle use)

    This returns EIP-712 typed data. Sign it with the owner's wallet.

    3. **Include in bundle**: Add a V2_TRANSFER_FROM_EOA action with the signature
    and nonce/deadline from the typed data.

    The bundle will atomically: pull tokens from EOA → execute subsequent actions.

    ## Using V2_TRANSFER_TO_EOA (Withdraw to EOA)

    To transfer tokens from the Earn Account back to the owner's EOA, simply add
    a V2_TRANSFER_TO_EOA action to your bundle. No signature is required since
    the Safe already owns the tokens.

    Use `amount: \"ALL\"` to transfer the entire token balance.
    """

    owner: str
    r"""The owner's wallet address that controls the Earn Account."""
    chain: Chain
    r"""The chain to use."""
    actions: List[V2UserOperationTypedDict]
    r"""List of actions to bundle. Actions are executed in order."""
    gas_sponsorship: NotRequired[bool]
    r"""If true, returns EIP-712 typed data for gas sponsorship. The owner must sign this data and submit to /gas_sponsorship/prepare."""


class V2BundleRequest(BaseModel):
    r"""Request to execute multiple earn actions in a single atomic transaction.

    ## Supported Action Types

    - **V2_TRANSFER_FROM_EOA**: Transfer tokens from the owner's EOA to the Earn Account
    using Permit2. Requires a signed Permit2 message.
    - **V2_TRANSFER_TO_EOA**: Transfer tokens from the Earn Account back to the owner's EOA.
    No signature required (Safe owns the tokens).
    - **V2_SWAP**: Swap tokens within the Earn Account using 1inch aggregator.
    - **V2_MANAGE**: Deposit or withdraw from DeFi venues (Aave, Morpho, Vaults, etc.)

    ## Using V2_TRANSFER_FROM_EOA (Deposit to Earn Account)

    To include a transfer from EOA in your bundle, follow these steps:

    1. **One-time setup**: Approve Permit2 to spend the token by calling
    `POST /v2/gas_sponsorship/approve_transfer` and executing the returned transaction.

    2. **Get Permit2 signature**: Call `POST /v2/earn/transfer` with:
    - `action`: \"DEPOSIT\"
    - `gas_sponsorship`: true
    - `spender`: omit this field (defaults to Safe address for bundle use)

    This returns EIP-712 typed data. Sign it with the owner's wallet.

    3. **Include in bundle**: Add a V2_TRANSFER_FROM_EOA action with the signature
    and nonce/deadline from the typed data.

    The bundle will atomically: pull tokens from EOA → execute subsequent actions.

    ## Using V2_TRANSFER_TO_EOA (Withdraw to EOA)

    To transfer tokens from the Earn Account back to the owner's EOA, simply add
    a V2_TRANSFER_TO_EOA action to your bundle. No signature is required since
    the Safe already owns the tokens.

    Use `amount: \"ALL\"` to transfer the entire token balance.
    """

    owner: str
    r"""The owner's wallet address that controls the Earn Account."""

    chain: Chain
    r"""The chain to use."""

    actions: List[V2UserOperation]
    r"""List of actions to bundle. Actions are executed in order."""

    gas_sponsorship: Optional[bool] = None
    r"""If true, returns EIP-712 typed data for gas sponsorship. The owner must sign this data and submit to /gas_sponsorship/prepare."""

    @model_serializer(mode="wrap")
    def serialize_model(self, handler):
        optional_fields = set(["gas_sponsorship"])
        serialized = handler(self)
        m = {}

        for n, f in type(self).model_fields.items():
            k = f.alias or n
            val = serialized.get(k)

            if val != UNSET_SENTINEL:
                if val is not None or k not in optional_fields:
                    m[k] = val

        return m
