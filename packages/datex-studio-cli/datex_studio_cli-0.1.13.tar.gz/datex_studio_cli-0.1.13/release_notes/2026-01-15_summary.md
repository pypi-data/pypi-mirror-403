# Recent Work Summary - Datex Studio CLI

*January 15, 2026*

## Overview

Today we completed a significant expansion of the Datex Studio CLI (`dxs`), adding new capabilities and aligning the tool with recent changes to the Wavelength API.

---

## Major Themes

### 1. Restricted Mode for Safe Agent Operations

Added `DXS_RESTRICTED_MODE` environment variable to enable a safe mode for AI agent usage. When enabled, the CLI blocks commands that write files or perform destructive operations:

- **File writing blocked**: `document build/resume/graph-only`, `explore extract-code/summarize`, `source graph --save-to`, `explore trace --batch`, `--save` and `--save-attachments` options
- **Destructive operations blocked**: `branch delete/publish`, `servicepack create/delete`, `env deploy`
- **API mutations blocked**: `api POST/PUT/PATCH/DELETE` (GET remains allowed)
- **Local state changes blocked**: `config set`, `auth logout`
- **Explicitly allowed**: `branch create` (as it's non-destructive)

This allows the CLI to be safely used in environments where file system writes and remote mutations should be prevented.

### 2. Multi-Identity Authentication and Organization Switching

Added support for managing multiple Azure AD identities:

- **New commands**: `dxs auth list` (show all identities), `dxs auth switch` (switch between identities)
- **Enhanced logout**: `dxs auth logout --all` to clear all stored identities
- **Organization tracking**: Organization info is stored per identity after login
- **Safety checks**: Added `OrganizationMismatchError` to prevent accidental cross-org operations on publish, deploy, and servicepack create
- **Auto-migration**: v1 credentials are automatically migrated to the new v2 multi-identity format

This enables workflows where users work across multiple Datex organizations without repeatedly logging in/out.

### 3. API Alignment with Wavelength January 2026 Changes

The Wavelength API underwent some naming changes, and we updated the CLI to match:
- Branch statuses renamed (DRAFT → MAIN, ACTIVE → PUBLISHED_MAIN)
- "ApplicationType" renamed to "ApplicationDefinitionType" throughout
- Updated filter options and documentation to reflect the new terminology

### 2. Service Pack Management

Added a whole new command group for working with Service Packs:
- `dxs servicepack list` - View available service packs
- `dxs servicepack create` - Create new service packs
- `dxs servicepack delete` - Remove service packs
- Also added `--group` option when creating branches to associate them with Service Packs

### 3. Branch Operations

Expanded branch management capabilities:
- Added `dxs source branch delete` with safety checks (candelete verification and confirmation prompts)
- Added `dxs source branch publish` to publish branches, with optional version naming (auto-generates timestamp-based versions like the Wavelength UI does)

### 4. Environment & Deployment Commands

New environment management features:
- `dxs env list` - List available environments
- `dxs env components` - View environment components
- `dxs env deploy` - Trigger deployments to components
- `dxs env list-authorized` - Show environments you have access to

### 5. User Management Commands

Added commands to work with users:
- `dxs user list` - List users in the system
- `dxs user studio-access` - Check studio access for users

### 6. Authentication Improvements

Added support for `DXS_ACCESS_TOKEN` environment variable for token injection, making it easier to use the CLI in automated scenarios.

### 7. Documentation & Skill Notes

Created a comprehensive "skill-notes" documentation structure covering:
- Getting started (authentication, configuration)
- Working with repositories and branches
- Source control operations (viewing changes, commit history, dependencies)
- Exploring configs
- Code review workflows
- DevOps integration
- Reference materials (command cheatsheet, output formats, branch statuses)

Also added a Code Review Skill for structured code reviews.

---

## Files Changed

The work touched about 70+ files, with roughly 7,200 lines added and 1,100 removed. Major areas:
- New command modules: `env.py`, `servicepack.py`, `user.py`
- Significant updates to: `branch.py`, `source.py`, `explore.py`, `auth.py`
- New utilities: `restricted.py` for restricted mode enforcement
- Major overhaul of `token_cache.py` for multi-identity support
- New API endpoints and models
- Extensive new documentation in `skill-notes/`

---

## Summary

The CLI has grown substantially - it now has much more complete coverage of the Wavelength platform's capabilities, particularly around branch lifecycle management (create → develop → publish → deploy), Service Pack organization, and environment deployments.

The latest additions focus on **safety and multi-org workflows**: Restricted Mode allows the CLI to be used safely by AI agents in controlled environments, while multi-identity authentication enables seamless switching between different Datex organizations without re-authentication. The documentation was also significantly expanded to help AI agents understand how to use the tool effectively.
