{"version":3,"file":"BuilderSettingsDeploySharedBlueprint-DhSd1Wns.js","sources":["../../../ui/src/builder/settings/BuilderSettingsDeploySharedBlueprint.vue"],"sourcesContent":["<template>\n\t<WdsModal\n\t\tv-if=\"isOpen\"\n\t\t:actions=\"modalActions\"\n\t\ttitle=\"Publish Blueprint\"\n\t\tdisplay-close-button\n\t\t@close=\"handleClose\"\n\t>\n\t\t<div class=\"DeploySharedBlueprint\">\n\t\t\t<WdsFieldWrapper label=\"Name\" required>\n\t\t\t\t<WdsTextInput\n\t\t\t\t\tv-model=\"form.name\"\n\t\t\t\t\tplaceholder=\"e.g., Data Fetch Pipeline\"\n\t\t\t\t\t:error=\"errors.name\"\n\t\t\t\t\t@update:model-value=\"handleNameChange\"\n\t\t\t\t/>\n\t\t\t</WdsFieldWrapper>\n\n\t\t\t<WdsFieldWrapper label=\"Description\" required>\n\t\t\t\t<textarea\n\t\t\t\t\tv-model=\"form.description\"\n\t\t\t\t\tplaceholder=\"Describe what this shared blueprint does\"\n\t\t\t\t\tclass=\"DeploySharedBlueprint__textarea\"\n\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t'DeploySharedBlueprint__textarea--error':\n\t\t\t\t\t\t\terrors.description,\n\t\t\t\t\t}\"\n\t\t\t\t/>\n\t\t\t</WdsFieldWrapper>\n\n\t\t\t<div\n\t\t\t\tv-if=\"isGlobalBlueprintProposalsEnabled\"\n\t\t\t\tclass=\"DeploySharedBlueprint__globalOption\"\n\t\t\t>\n\t\t\t\t<label class=\"DeploySharedBlueprint__checkbox\">\n\t\t\t\t\t<input v-model=\"form.proposeAsGlobal\" type=\"checkbox\" />\n\t\t\t\t\t<span>Propose as global blueprint</span>\n\t\t\t\t</label>\n\t\t\t\t<p class=\"DeploySharedBlueprint__hint\">\n\t\t\t\t\tGlobal blueprints are available to all organizations and\n\t\t\t\t\trequire approval via GitHub PR.\n\t\t\t\t</p>\n\t\t\t</div>\n\n\t\t\t<div v-if=\"prUrl\" class=\"DeploySharedBlueprint__success\">\n\t\t\t\t<p>Pull request created successfully!</p>\n\t\t\t\t<a :href=\"prUrl\" target=\"_blank\" rel=\"noopener noreferrer\">\n\t\t\t\t\t{{ prUrl }}\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</div>\n\t</WdsModal>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, watch, inject, shallowRef } from \"vue\";\nimport WdsModal, { ModalAction } from \"@/wds/WdsModal.vue\";\nimport WdsFieldWrapper from \"@/wds/WdsFieldWrapper.vue\";\nimport WdsTextInput from \"@/wds/WdsTextInput.vue\";\nimport injectionKeys from \"@/injectionKeys\";\nimport { useToasts } from \"@/builder/useToast\";\nimport { useComponentActions } from \"@/builder/useComponentActions\";\nimport { useWriterTracking } from \"@/composables/useWriterTracking\";\nimport { useWriterApi } from \"@/composables/useWriterApi\";\n\nconst props = defineProps<{\n\tblueprintId: string;\n}>();\n\nconst isOpen = defineModel({ type: Boolean });\n\nconst wf = inject(injectionKeys.core);\nconst wfbm = inject(injectionKeys.builderManager);\nconst { pushToast } = useToasts();\nconst { setContentValue, extractBlueprintComponents } = useComponentActions(\n\twf,\n\twfbm,\n);\nconst tracking = useWriterTracking(wf);\nconst { writerApi } = useWriterApi();\n\nconst blueprint = computed(() => wf.getComponentById(props.blueprintId));\n\nconst isGlobalBlueprintProposalsEnabled = computed(\n\t() =>\n\t\tArray.isArray(wf.featureFlags.value) &&\n\t\twf.featureFlags.value.includes(\"global_blueprint_proposals\"),\n);\n\nconst blueprintName = computed(\n\t() => blueprint.value?.content?.key || \"Shared Blueprint\",\n);\n\nconst blueprintDescription = computed(\n\t() => blueprint.value?.content?.deployedDescription || \"\",\n);\n\nconst form = ref({\n\tname: \"\",\n\tdescription: \"\",\n\tproposeAsGlobal: false,\n});\n\nconst errors = shallowRef<Record<string, string>>({});\nconst isDeploying = ref(false);\nconst prUrl = ref<string | null>(null);\n\nfunction validateForm(): boolean {\n\tconst newErrors: Record<string, string> = {};\n\n\tif (!form.value.name.trim()) {\n\t\tnewErrors.name = \"Name is required\";\n\t}\n\tif (!form.value.description.trim()) {\n\t\tnewErrors.description = \"Description is required\";\n\t}\n\n\terrors.value = newErrors;\n\treturn Object.keys(newErrors).length === 0;\n}\n\n// Sync name changes back to blueprint key\nfunction handleNameChange(newName: string) {\n\tif (props.blueprintId && newName.trim()) {\n\t\tsetContentValue(props.blueprintId, \"key\", newName.trim());\n\t}\n}\n\nasync function handleDeploy() {\n\tif (!validateForm()) {\n\t\tpushToast({\n\t\t\ttype: \"error\",\n\t\t\tmessage: \"Please fill in all required fields\",\n\t\t});\n\t\treturn;\n\t}\n\n\tconst orgId = wf.writerOrgId.value;\n\tif (!orgId) {\n\t\tpushToast({\n\t\t\ttype: \"error\",\n\t\t\tmessage:\n\t\t\t\t\"Organization ID is required. Please set up your environment variable.\",\n\t\t});\n\t\treturn;\n\t}\n\n\tisDeploying.value = true;\n\tprUrl.value = null;\n\n\ttry {\n\t\t// Extract components from frontend\n\t\tconst components = extractBlueprintComponents(props.blueprintId);\n\n\t\tif (form.value.proposeAsGlobal) {\n\t\t\t// Propose as global blueprint via GitHub PR\n\t\t\tconst result = await writerApi.proposeSharedBlueprintGlobal({\n\t\t\t\ttitle: form.value.name.trim(),\n\t\t\t\tdescription: form.value.description.trim(),\n\t\t\t\tcomponents: components,\n\t\t\t\tmetadata: {},\n\t\t\t});\n\n\t\t\tprUrl.value = result.pr_url;\n\n\t\t\tpushToast({\n\t\t\t\ttype: \"success\",\n\t\t\t\tmessage: `Global blueprint proposed! A PR has been created for review.`,\n\t\t\t});\n\t\t\ttracking.track(\"blueprints_global_proposed\");\n\n\t\t\t// Don't close the modal - show the PR URL\n\t\t} else {\n\t\t\t// Publish to org's shared blueprints\n\t\t\tconst data = await writerApi.publishSharedBlueprint(orgId, {\n\t\t\t\ttitle: form.value.name.trim(),\n\t\t\t\tdescription: form.value.description.trim(),\n\t\t\t\tcomponents: components,\n\t\t\t\tmetadata: {},\n\t\t\t});\n\n\t\t\t// Update blueprint's published snippet ID and description\n\t\t\tsetContentValue(\n\t\t\t\tprops.blueprintId,\n\t\t\t\t\"publishedSnippetId\",\n\t\t\t\tdata.snippet_id,\n\t\t\t);\n\t\t\tsetContentValue(\n\t\t\t\tprops.blueprintId,\n\t\t\t\t\"deployedDescription\",\n\t\t\t\tform.value.description.trim(),\n\t\t\t);\n\n\t\t\tpushToast({\n\t\t\t\ttype: \"success\",\n\t\t\t\tmessage: `Blueprint \"${form.value.name.trim()}\" published successfully`,\n\t\t\t});\n\t\t\ttracking.track(\"blueprints_shared_published\");\n\n\t\t\tresetForm();\n\t\t\tisOpen.value = false;\n\n\t\t\ttry {\n\t\t\t\tawait wf.init();\n\t\t\t} catch (_error) {\n\t\t\t\tpushToast({\n\t\t\t\t\ttype: \"error\",\n\t\t\t\t\tmessage:\n\t\t\t\t\t\t\"Blueprint published but failed to reload. Please refresh the page.\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t} catch (error) {\n\t\tpushToast({\n\t\t\ttype: \"error\",\n\t\t\tmessage: `Error publishing blueprint: ${error instanceof Error ? error.message : String(error)}`,\n\t\t});\n\t} finally {\n\t\tisDeploying.value = false;\n\t}\n}\n\nfunction handleClose() {\n\tif (!isDeploying.value) {\n\t\tresetForm();\n\t\tisOpen.value = false;\n\t}\n}\n\nfunction resetForm() {\n\tform.value = {\n\t\tname: blueprintName.value,\n\t\tdescription: blueprintDescription.value,\n\t\tproposeAsGlobal: false,\n\t};\n\terrors.value = {};\n\tprUrl.value = null;\n}\n\nconst modalActions = computed<ModalAction[]>(() => {\n\tconst publishText = form.value.proposeAsGlobal ? \"Propose\" : \"Publish\";\n\tconst publishingText = form.value.proposeAsGlobal\n\t\t? \"Proposing...\"\n\t\t: \"Publishing...\";\n\n\t// If PR was created, show close button only\n\tif (prUrl.value) {\n\t\treturn [\n\t\t\t{\n\t\t\t\tdesc: \"Close\",\n\t\t\t\tfn: handleClose,\n\t\t\t},\n\t\t];\n\t}\n\n\treturn [\n\t\t{\n\t\t\tdesc: \"Cancel\",\n\t\t\tfn: handleClose,\n\t\t},\n\t\t{\n\t\t\tdesc: isDeploying.value ? publishingText : publishText,\n\t\t\tfn: handleDeploy,\n\t\t\tdisabled: isDeploying.value,\n\t\t},\n\t];\n});\n\n// Initialize form when modal opens\nwatch(isOpen, (newValue) => {\n\tif (newValue) {\n\t\tresetForm();\n\t}\n});\n</script>\n\n<style scoped>\n.DeploySharedBlueprint {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 16px;\n\tpadding: 16px;\n}\n\n.DeploySharedBlueprint__textarea {\n\twidth: 100%;\n\tmin-height: 100px;\n\tpadding: 8px;\n\tborder: 1px solid var(--builderSeparatorColor);\n\tborder-radius: 4px;\n\tfont-size: 14px;\n\tfont-family: inherit;\n\tresize: vertical;\n}\n\n.DeploySharedBlueprint__textarea:focus {\n\toutline: none;\n\tborder-color: var(--builderPrimaryColor);\n}\n\n.DeploySharedBlueprint__textarea--error {\n\tborder-color: var(--builderErrorColor);\n}\n\n.DeploySharedBlueprint__globalOption {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 4px;\n\tpadding: 12px;\n\tbackground: var(--builderSubtleSeparatorColor);\n\tborder-radius: 4px;\n}\n\n.DeploySharedBlueprint__checkbox {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n\tcursor: pointer;\n\tfont-size: 14px;\n}\n\n.DeploySharedBlueprint__checkbox input {\n\tcursor: pointer;\n}\n\n.DeploySharedBlueprint__hint {\n\tfont-size: 12px;\n\tcolor: var(--builderSecondaryTextColor);\n\tmargin: 0;\n}\n\n.DeploySharedBlueprint__success {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 8px;\n\tpadding: 12px;\n\tbackground: var(--builderSuccessBackgroundColor, #e6f7e6);\n\tborder: 1px solid var(--builderSuccessColor, #4caf50);\n\tborder-radius: 4px;\n}\n\n.DeploySharedBlueprint__success p {\n\tmargin: 0;\n\tfont-weight: 500;\n}\n\n.DeploySharedBlueprint__success a {\n\tcolor: var(--builderPrimaryColor);\n\tword-break: break-all;\n}\n</style>\n"],"names":["props","__props","isOpen","_useModel","wf","inject","injectionKeys","wfbm","pushToast","useToasts","setContentValue","extractBlueprintComponents","useComponentActions","tracking","useWriterTracking","writerApi","useWriterApi","blueprint","computed","isGlobalBlueprintProposalsEnabled","blueprintName","_b","_a","blueprintDescription","form","ref","errors","shallowRef","isDeploying","prUrl","validateForm","newErrors","handleNameChange","newName","handleDeploy","orgId","components","result","data","resetForm","error","handleClose","modalActions","publishText","publishingText","watch","newValue"],"mappings":"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"}