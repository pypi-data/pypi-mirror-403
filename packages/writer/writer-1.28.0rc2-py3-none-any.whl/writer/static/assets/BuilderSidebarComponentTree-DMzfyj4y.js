import{a as ve,B as fe}from"./BuilderApp-DhqlqS0y.js";import{c as g,d as te,r as ne,i as R,a as M,u as oe,w as z,b6 as he,b5 as ye,L as E,o as d,b as P,z as B,g as y,f as h,D as T,x as b,y as D,S as C,R as u,t as K,E as Q,bD as Ce,C as X,ax as ae,l as _e,aN as be,_ as re,b0 as Z,bE as Ie,W,A as ee}from"./index-C1IizHaQ.js";import"./WdsCheckbox-BYkw_Bvq.js";import"./marked.esm-273vDTCT.js";function se(p,i){function o(s){if(!i.value)return!0;const m=p.getComponentDefinition(s.type);return!!(m!=null&&m.name.toLocaleLowerCase().includes(i.value)||Object.values(s.content).filter(c=>typeof c=="string"&&c.toLocaleLowerCase().includes(i.value)).length>0)}return{isComponentMatchingQuery:o}}function Be(p,i,o){const{isComponentMatchingQuery:s}=se(p,i);return{searchResultCount:g(()=>{if(!i.value)return;let a=0;for(const c of p.getComponentsNested(o.value))s(c)&&a++;return a})}}function Te(p,i,o){const{isComponentMatchingQuery:s}=se(p,i),m=g(()=>!i.value||s(o.value));return{hasMatchingChildren:g(()=>{if(!i.value)return!0;for(const c of p.getComponentsNested(o.value.id))if(s(c))return!0;return!1}),matched:m}}const Se={class:"BuilderSidebarComponentTreeBranch__nameRight"},ke={class:"previewText"},Pe=te({__name:"BuilderSidebarComponentTreeBranch",props:{componentId:{type:String,required:!0},query:{type:String,required:!1,default:""}},emits:["expandBranch","delete"],setup(p,{emit:i}){const o=p,s=ne(),m=[{label:"Delete",value:"delete",icon:"trash-2"}],a=R(M.core),c=R(M.builderManager),O=g(()=>c.isComponentIdSelected(o.componentId)),_=oe(a),{createAndInsertComponent:q,moveComponent:S,goToComponentParentPage:V,isDraggingAllowed:$,isDeleteAllowed:N}=ae(a,c,_),{getComponentInfoFromDrag:A,removeInsertionCandidacy:x,isParentSuitable:F}=be(a),{isComponentVisible:U}=_e(a),w=i,r=g(()=>{var e;return((e=o.query)==null?void 0:e.toLocaleLowerCase())??""}),t=g(()=>a.getComponentById(o.componentId)),{hasMatchingChildren:l,matched:I}=Te(a,r,t);z(l,e=>{var n;return(n=s.value)==null?void 0:n.toggleCollapse(!e)},{immediate:!0});const G=g(()=>a.getComponents(o.componentId,{sortedByPosition:!0}).filter(e=>{var n;return((n=a.getComponentDefinition(e.type))==null?void 0:n.category)!=="Internal"})),{name:ie,previewText:H}=he(a,t);async function le(e){V(o.componentId),await E(),c.handleSelectionFromEvent(e,o.componentId,void 0,"tree"),j()}function j(){s.value&&(s.value.expand(),w("expandBranch"))}function de(){var L;const e=(L=s.value)==null?void 0:L.$el;if(!e)return;const n=e.closest(".BuilderSidebarComponentTree"),v=n.getBoundingClientRect(),f=s.value.$el.offsetTop-v.height/2,k=s.value.$el.offsetLeft-v.left-16;n.scrollTo({top:f,left:Math.max(0,k),behavior:"smooth"})}function ue(e){c.setSelection(null),e.dataTransfer.setData(`application/json;writer=${t.value.type},${t.value.id}`,"{}")}function ce(e){x(e)}function pe(e){const n=A(e);if(!n)return;const{draggedType:v,draggedId:f}=n;F(o.componentId,f,v)&&e.preventDefault()}function me(e){const n=A(e);if(!n)return;const{draggedType:v,draggedId:f,sourceBlueprintId:k}=n;if(f)S(f,t.value.id);else{const L=k?{content:{sourceBlueprintId:k}}:void 0;q(v,t.value.id,void 0,L)}x(e)}function ge(e){e==="delete"&&N(o.componentId)&&w("delete",o.componentId)}const J=g(()=>{if(!a.activePageId.value)return!1;const e=a.getComponents(c.activeRootId.value).some(v=>v.id===a.activePageId.value);return ye.has(t.value.type)&&e&&o.componentId!==a.activePageId.value});return z(a.activePageId,()=>{var e;a.activePageId.value&&J.value&&((e=s.value)==null||e.toggleCollapse(!0))}),z(c.firstSelectedItem,async e=>{e&&e.componentId===o.componentId&&e.source!="tree"&&(j(),await E(),de())},{immediate:!0}),(e,n)=>{var v;return t.value?(d(),P(ve,{key:0,ref_key:"treeBranch",ref:s,class:"BuilderSidebarComponentTreeBranch","component-id":p.componentId,name:u(ie),query:p.query,"has-children":G.value.length>0,"data-automation-key":t.value.type,draggable:u($)(p.componentId),matched:u(I),selected:O.value,variant:u(Ce).has(t.value.type)?"root":void 0,"disable-collapse":u(X).has(t.value.type),"no-nested-space":u(X).has(t.value.type),collapsed:J.value,"right-click-options":m,"dropdown-options":((v=t.value)==null?void 0:v.type)==="blueprints_blueprint"&&u(N)(o.componentId)?m:void 0,onSelect:le,onDropdownSelect:n[1]||(n[1]=f=>ge(f)),onDragover:pe,onDragstart:ue,onDragend:ce,onDrop:me},{nameRight:B(()=>[y("span",Se,[Object.keys(t.value.handlers??{}).length>0?(d(),h(T,{key:0},[n[2]||(n[2]=y("span",{class:"middot"},null,-1)),b(D,{name:"zap"})],64)):C("",!0),u(U)(t.value.id)?C("",!0):(d(),h(T,{key:1},[n[3]||(n[3]=y("span",{class:"middot"},null,-1)),b(D,{name:"eye-off"})],64)),t.value.isCodeManaged?(d(),h(T,{key:2},[n[4]||(n[4]=y("span",{class:"middot"},null,-1)),b(D,{name:"square-terminal"})],64)):C("",!0),u(H)?(d(),h(T,{key:3},[n[5]||(n[5]=y("span",{class:"middot"},null,-1)),y("span",ke,K(u(H)),1)],64)):C("",!0)])]),children:B(()=>[(d(!0),h(T,null,Q(G.value,f=>(d(),P(Y,{key:f.id,"component-id":f.id,query:p.query,onExpandBranch:j,onDelete:n[0]||(n[0]=k=>e.$emit("delete",k))},null,8,["component-id","query"]))),128))]),_:1},8,["component-id","name","query","has-children","data-automation-key","draggable","matched","selected","variant","disable-collapse","no-nested-space","collapsed","dropdown-options"])):C("",!0)}}}),Y=re(Pe,[["__scopeId","data-v-5108eeed"]]),De={key:0},xe={key:1,class:"sections"},we={class:"section__header"},Ee={class:"section__title"},Ne={class:"section__content"},Ae={key:0,class:"section__empty"},Le={class:"add"},Re=te({__name:"BuilderSidebarComponentTree",setup(p){const i=R(M.core),o=R(M.builderManager),s=ne(""),m=oe(i),{createAndInsertComponent:a,setContentValue:c,removeComponentSubtree:O}=ae(i,o,m),_=o.activeRootId,{searchResultCount:q}=Be(i,s,_),S=g(()=>i.getComponents("blueprints_root",{sortedByPosition:!0})),V=g(()=>S.value.filter(r=>!Z(r))),$=g(()=>S.value.filter(r=>Z(r))),N=g(()=>{var t;const r=[{key:"blueprints",title:"Blueprints",items:V.value,addAction:"add-blueprint",onAdd:x,emptyText:"No blueprints yet"}];return(t=i.featureFlags.value)!=null&&t.includes("shared_blueprints")&&r.push({key:"shared-blueprints",title:"Shared Blueprints",items:$.value,addAction:"add-shared-blueprint",onAdd:U,emptyText:"No shared blueprints yet"}),r});async function A(){const r=a("page","root");i.setActivePageId(r),await E(),o.setSelection(r),m.track("ui_page_added")}async function x(){const r=F(),t=a("blueprints_blueprint","blueprints_root",void 0,r?{content:{key:r}}:void 0);await E(),i.setActivePageId(t),o.setSelection(t),m.track("blueprints_new_added")}function F(){const r=S.value.map(l=>{var I;return(I=l.content)==null?void 0:I.key}).filter(l=>l==null?void 0:l.startsWith("BLUEPRINT_")).map(l=>Number.parseInt(l.replace("BLUEPRINT_",""),10)).filter(l=>!Number.isNaN(l));return`BLUEPRINT_${(r.length>0?Math.max(...r):S.value.length+10)+1}`}async function U(){const r=a("blueprints_blueprint","blueprints_root");c(r,"isSharedBlueprint",Ie),i.setActivePageId(r),await E(),o.setSelection(r),m.track("blueprints_shared_added")}function w(r){O(r)}return(r,t)=>(d(),P(fe,{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=l=>s.value=l),class:"BuilderSidebarComponentTree",placeholder:"Component tree","search-count":u(q)},{footer:B(()=>[y("div",Le,[u(_)=="root"?(d(),P(W,{key:0,variant:"special",size:"small","data-automation-action":"add-page",onClick:A},{default:B(()=>[b(D,{name:"plus"}),t[1]||(t[1]=ee(" Add page "))]),_:1})):C("",!0),u(_)=="blueprints_root"?(d(),P(W,{key:1,variant:"special",size:"small","data-automation-action":"add-blueprint-footer",onClick:x},{default:B(()=>[b(D,{name:"plus"}),t[2]||(t[2]=ee(" Add blueprint "))]),_:1})):C("",!0)])]),default:B(()=>[u(_)=="root"?(d(),h("div",De,[b(Y,{class:"rootBranch","component-id":u(_),query:s.value,onDelete:w},null,8,["component-id","query"])])):u(_)=="blueprints_root"?(d(),h("div",xe,[(d(!0),h(T,null,Q(N.value,l=>(d(),h("div",{key:l.key,class:"section"},[y("div",we,[y("span",Ee,K(l.title),1),b(W,{variant:"neutral",size:"smallIcon","data-automation-action":l.addAction,onClick:l.onAdd},{default:B(()=>[b(D,{name:"plus"})]),_:2},1032,["data-automation-action","onClick"])]),y("div",Ne,[(d(!0),h(T,null,Q(l.items,I=>(d(),P(Y,{key:I.id,"component-id":I.id,query:s.value,onDelete:w},null,8,["component-id","query"]))),128)),l.items.length===0?(d(),h("div",Ae,K(l.emptyText),1)):C("",!0)])]))),128))])):C("",!0)]),_:1},8,["modelValue","search-count"]))}}),$e=re(Re,[["__scopeId","data-v-3c61a11b"]]);export{$e as default};
//# sourceMappingURL=BuilderSidebarComponentTree-DMzfyj4y.js.map
