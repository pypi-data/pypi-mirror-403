function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./index-C1IizHaQ.js","./index-BFl0hGbo.css","./BuilderEmbeddedCodeEditor-CY65_X2M.js","./BuilderEmbeddedCodeEditor-DwW24RYH.css","./BuilderSidebarToolkit-CzIYCBw7.js","./WdsCheckbox-BYkw_Bvq.js","./WdsCheckbox-DKvpPA4D.css","./marked.esm-273vDTCT.js","./BuilderSidebarToolkit-qpHpXQZx.css","./BuilderSidebarComponentTree-DMzfyj4y.js","./BuilderSidebarComponentTree-CdxKHjcJ.css","./BuilderSettings-G-znf-iB.js","./WdsDropdownMenu-Ba7OuweF.js","./WdsDropdownMenu-CzzPN9Wg.css","./WdsTabs-CJTYrdrm.js","./WdsTabs-DKj7BqI0.css","./WdsFieldWrapper-aazsDYxB.js","./WdsFieldWrapper-CS1B2KEf.css","./useKeyValueEditor-6fUhwaEz.js","./BuilderSettings-CPoDxXAb.css","./ComponentRenderer-CqqiitL-.js","./ComponentRenderer-Bnqq2NuG.css","./BuilderInsertionOverlay-C0UeiiyW.js","./BuilderInsertionOverlay-D2XS0ij9.css","./BuilderInsertionLabel-Dg7795FO.js","./BuilderInsertionLabel-_YS5WPfq.css","./BuilderVault-DIVf2hoI.js","./BuilderVault-Cx6oQSES.css","./BuilderJournal-CjO99tYJ.js","./SharedCopyClipboardButton-6Jnavq2l.js","./SharedCopyClipboardButton-BipJKGtz.css","./BuilderJournal-DHv3Pvvm.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{d as R,i as W,a as F,r as O,u as ye,c as S,o as t,f as v,g as d,x as B,y as V,A as q,G as K,R as p,S as $,_ as z,T as Le,U as Ee,V as Ce,X as Et,Y as De,w as ae,q as oe,Z as Mt,$ as it,a0 as _t,b as P,a1 as yt,D as j,s as me,v as Be,t as N,m as ie,a2 as gt,z as L,a3 as Se,a4 as Lt,a5 as ht,a6 as Ft,a7 as bt,W as te,a8 as he,K as Ne,L as _e,a9 as Nt,aa as rt,J as le,ab as Rt,E as ue,ac as Ut,ad as Wt,ae as Te,af as ct,ag as se,ah as xe,ai as qe,aj as nt,ak as we,al as zt,am as Vt,an as lt,ao as ce,Q as pe,ap as kt,aq as wt,ar as St,as as Ot,at as Ke,au as qt,av as Kt,aw as Bt,ax as Re,ay as jt,az as Ht,aA as Gt,aB as Yt,aC as Jt,aD as Ct,aE as Fe,aF as Zt,aG as Xt,aH as Qt,aI as ea,aJ as ta,aK as aa,p as pt,aL as na,aM as oa,H as ra,aN as la,aO as ot}from"./index-C1IizHaQ.js";import{W as sa}from"./WdsCheckbox-BYkw_Bvq.js";import{marked as ia}from"./marked.esm-273vDTCT.js";const ua={class:"BuilderSwitcher"},da=R({__name:"BuilderSwitcher",setup(e){const a=W(F.core),n=W(F.builderManager);let r=O(null);const o=ye(a),s={ui:void 0,blueprints:void 0};function i(k){return k==="blueprints"||k==="ui"}function u(k){const _=n.mode.value;if(_!==k){switch(i(_)&&a.activePageId.value&&(s[_]=a.activePageId.value),r.value=k,k){case"ui":o.track("nav_ui_opened");break;case"preview":o.track("nav_preview_opened");break;case"blueprints":o.track("nav_blueprints_opened");break;case"vault":o.track("nav_vault_opened");break;case"journal":o.track("nav_journal_opened");break}if(n.mode.value=k,i(k))if(s[k]&&a.getComponentById(s[k]))a.setActivePageId(s[k]);else{const y=k==="blueprints"?a.getFirstBlueprint():a.getFirstPage();y&&a.setActivePageId(y.id)}(k==="preview"||_==="blueprints"||k==="blueprints")&&n.setSelection(null)}}const f=S(()=>n.getMode());return(k,_)=>(t(),v("div",ua,[d("button",{"data-automation-action":"set-mode-ui",class:K({active:f.value=="ui"}),type:"button",onClick:_[0]||(_[0]=y=>u("ui"))},[B(V,{name:"frame"}),_[5]||(_[5]=q(" Interface "))],2),d("button",{"data-automation-action":"set-mode-blueprints",class:K({active:f.value=="blueprints"}),type:"button",onClick:_[1]||(_[1]=y=>u("blueprints"))},[B(V,{name:"wds-blueprints"}),_[6]||(_[6]=q(" Blueprints "))],2),p(a).isWriterCloudApp.value?(t(),v("button",{key:0,class:K({active:f.value=="vault"}),"data-automation-action":"set-mode-vault",type:"button",onClick:_[2]||(_[2]=y=>u("vault"))},[B(V,{name:"key-round"}),_[7]||(_[7]=q(" Vault "))],2)):$("",!0),d("button",{class:K({active:f.value=="preview"}),"data-automation-action":"set-mode-preview",type:"button",onClick:_[3]||(_[3]=y=>u("preview"))},[B(V,{name:"view"}),_[8]||(_[8]=q(" Preview "))],2),p(a).isWriterCloudApp.value&&p(a).featureFlags.value.includes("journal")?(t(),v("button",{key:1,class:K({active:f.value=="journal"}),"data-automation-action":"set-mode-journal",type:"button",onClick:_[4]||(_[4]=y=>u("journal"))},[B(V,{name:"scroll-text"}),_[9]||(_[9]=q(" Journal "))],2)):$("",!0)]))}}),ca=z(da,[["__scopeId","data-v-fb62fbc1"]]),pa={class:"BuilderStateExplorer"},va=R({__name:"BuilderStateExplorer",setup(e){const a=W(F.core);return(n,r)=>(t(),v("div",pa,[B(Le,{data:p(a).userState.value,"enable-copy-to-json":!0,"initial-depth":1,"hide-root":!0},null,8,["data"])]))}}),fa=z(va,[["__scopeId","data-v-45c6b03e"]]),ma=R({__name:"WdsStateDot",props:{state:{type:String,required:!0}},setup(e){return(a,n)=>(t(),v("div",{class:K(["WdsStateDotState",`WdsStateDotState--${e.state}`])},null,2))}}),$t=z(ma,[["__scopeId","data-v-4eacfc04"]]);function _a(e,a){let n;return()=>{n&&clearTimeout(n),n=setTimeout(e,a)}}function ya(e){const a=Ee(),n=ye(e),r=it(),{pushToast:o}=Ce(),{writerApi:s,apiBaseUrl:i}=Et({signal:a.signal}),u=S(()=>e.getComponentById("root")),f=O(!1),k=De(),_=De(),y=_a(async()=>{e.isWriterCloudApp.value&&e.mode.value==="edit"&&!h.value&&s.updateApplicationMetadata(e.writerOrgId.value,e.writerAppId.value,{name:C.value}),await e.sendComponentUpdate()},1e3),C=S({get:()=>u.value.content.appName,set:w=>{u.value.content.appName!==w&&(u.value.content.appName=w,y())}});ae(()=>u.value.content.appName,y),ae(_,()=>{var T;const w=(T=_.value)==null?void 0:T.name;w!==void 0&&(C.value=w)});const l=S(()=>{var x,E;const w=(E=(x=_.value.writer)==null?void 0:x.teamIds)==null?void 0:E[0];if(!w)return;const T=`/organization/${e.writerOrgId.value}/team/${w}/framework/${e.writerAppId.value}`;return new URL(T,i)}),g=S(()=>{if(!(!e.writerOrgId.value||!e.writerAppId.value))return new URL(`/aistudio/organization/${e.writerOrgId.value}/agent/${e.writerAppId.value}/deploy`,i)}),h=S(()=>{var w;return(w=_.value)!=null&&w.lastDeployedAt?new Date(_.value.lastDeployedAt):void 0}),c=S(()=>!!(e.isWriterCloudApp.value&&_.value)),b=S(()=>{var w;return((w=_.value)==null?void 0:w.status)==="deployed"});ae(e.writerApplication,I,{immediate:!0}),oe(()=>{document.addEventListener("visibilitychange",async()=>{document.visibilityState==="visible"&&await I()},{signal:a.signal})});async function I(){if(e.writerApplication.value)try{_.value=await s.fetchApplicationDeployment(e.writerOrgId.value,e.writerAppId.value)}catch(w){r.error("Failed to fetch deployment information",w),_.value=void 0}}async function m(){if(e.writerApplication.value){if(!b.value){const w=`/aistudio/organization/${e.writerOrgId.value}/agent/${e.writerAppId.value}/deploy`,T=new URL(w,i);window.open(T,"_blank");return}f.value=!0,k.value=void 0;try{await s.publishApplication(e.writerOrgId.value,e.writerAppId.value,{applicationVersionId:_.value.applicationVersion.id,applicationVersionDataId:_.value.applicationVersionData.id}),await I();const w=l.value?{label:"See it live",func:()=>window.open(l.value,"_blank"),icon:"open_in_new"}:void 0;o({type:"success",message:"agent deployed",action:w}),n.track("deployment_succeeded")}catch(w){n.track("deployment_failed",{error:String(w)}),k.value=w,r.error("Deploy failed",w),o({type:"error",message:"deploy failed"})}finally{f.value=!1}}}return{name:C,canDeploy:c,writerDeployUrl:g,hasBeenPublished:b,publishApplication:m,isDeploying:Mt(f),lastDeployedAt:h}}const ga=["data-writer-tooltip"],ha=["src","alt"],ba={key:1,class:"SharedWriterAvatar__initials"},ka=R({__name:"SharedWriterAvatar",props:{userId:{type:Number,required:!0},showTooltip:{type:Boolean,required:!1}},setup(e){const a=e,n=S(()=>a.userId),r=O(!1),{user:o,isLoading:s}=_t(n),i=S(()=>{var _;return((_=o.value)==null?void 0:_.avatar)??""}),u=S(()=>{var _;return(((_=o.value)==null?void 0:_.firstName)??"?").at(0)}),f=S(()=>{if(!(!a.showTooltip||!o.value))return`${o.value.firstName??""} ${o.value.lastName??""}`}),k=S(()=>o.value?`Avatar of ${o.value.firstName??""} ${o.value.lastName??""}`:`Avatar of the user ID ${n.value}`);return(_,y)=>(t(),v("div",{class:"SharedWriterAvatar","data-writer-tooltip":f.value},[p(s)||i.value&&!r.value?(t(),P(yt,{key:0,class:"SharedWriterAvatar__loader"})):$("",!0),p(s)?$("",!0):(t(),v(j,{key:1},[i.value?me((t(),v("img",{key:0,src:i.value,alt:k.value,class:"SharedWriterAvatar__img",onLoad:y[0]||(y[0]=C=>r.value=!0)},null,40,ha)),[[Be,r.value]]):(t(),v("div",ba,N(u.value),1))],64))],8,ga))}}),ut=z(ka,[["__scopeId","data-v-d974552d"]]),wa=["data-writer-tooltip"],Sa={key:0,class:"profile"},Ba={key:1,class:"profile"},Ca=R({__name:"BuilderHeaderConnected",setup(e){const a=W(F.collaborationManager),n=S(()=>a.connectedProfiles.value.length),r=S(()=>{var s;return(s=a.connectedProfiles.value)==null?void 0:s[0]}),o=S(()=>"Also editing: "+a.connectedProfiles.value.map(i=>i.displayName).join(", "));return(s,i)=>n.value>0?(t(),v("div",{key:0,class:"BuilderHeaderConnected","data-writer-tooltip":o.value,"data-writer-tooltip-placement":"bottom"},[n.value==1?(t(),v("div",Sa,[B(ut,{"user-id":r.value.userId},null,8,["user-id"])])):$("",!0),n.value>1?(t(),v("div",Ba," +"+N(n.value),1)):$("",!0)],8,wa)):$("",!0)}}),$a=z(Ca,[["__scopeId","data-v-a13cab91"]]),Ia=R({__name:"BuilderHeaderMoreDropdown",setup(e){const a=S(()=>[{label:"Import agent .zip file",value:"import",icon:"upload"},{label:"Download agent .zip file",value:"export",icon:"download"},{label:r.preventTasks.value.has("stayAwake")?"Turn off stay awake mode":"Keep session awake",value:"awake",icon:"coffee"}]),n=W(F.core),r=W(F.socketTimeout),o=ie("exportInput"),s=ye(n),i=Ce(),u=O(!1),f=O(!1),k=O(!1),_=S(()=>[{disabled:u.value,desc:"Cancel",fn:()=>{k.value=!1,f.value=!1}},{disabled:!k.value,loading:u.value,desc:"Import",fn:C}]);async function y(){if(s.track("nav_export_clicked"),!o.value)return;const g=await fetch("./api/export");if(!g.ok)throw new Error("Failed to connect to export API");const h=await g.blob(),c=window.URL.createObjectURL(h),b=document.createElement("a");b.href=c,b.download="export.zip",document.body.appendChild(b),b.click(),document.body.removeChild(b),window.URL.revokeObjectURL(c)}async function C(){if(s.track("nav_import_clicked"),!o.value)return;const g=o.value.files[0];if(g){u.value=!0;try{const h=new FormData;if(h.append("file",g),!(await fetch("./api/import",{method:"POST",body:h})).ok)throw new Error("Failed to connect to import API");f.value=!1,i.pushToast({type:"success",message:"Project imported successfully."})}catch(h){i.pushToast({type:"error",message:"Failed to import the project: "+(h instanceof Error?h.message:String(h))})}finally{u.value=!1}}}async function l(g){switch(g){case"export":try{await y()}catch(h){i.pushToast({message:`Failed to export the project: ${h}`,type:"error"})}break;case"import":o.value.value="",o.value.click();break;case"awake":r==null||r.togglePreventTaskId("stayAwake")}}return(g,h)=>(t(),v(j,null,[B(gt,{class:"BuilderHeaderMoreDropdown","trigger-variant":"secondary",options:a.value,onSelect:l},null,8,["options"]),me(d("input",{ref_key:"exportInput",ref:o,type:"file",accept:".zip,application/zip",onChange:h[0]||(h[0]=c=>f.value=!0)},null,544),[[Be,!1]]),f.value?(t(),P(Se,{key:0,actions:_.value,title:"Are you sure you want to continue?",description:"Your current work will be replaced with the agent in the zip file. This includes replacement of current pages, blueprints, local scripts, and custom assets.",size:"normal"},{default:L(()=>[B(sa,{modelValue:k.value,"onUpdate:modelValue":h[1]||(h[1]=c=>k.value=c),label:"Yes, I want to replace the current agent with the imported file"},null,8,["modelValue"])]),_:1},8,["actions"])):$("",!0)],64))}}),Pa=z(Ia,[["__scopeId","data-v-095be7a9"]]);function Ta(e){const a=Ce();let n;function r(i){n?a.pushToast({id:n,...i}):n=a.pushToast(i)}ae(e.syncHealth,(i,u)=>{switch(i){case"idle":return r({type:"loading",message:"Connecting to the server",closable:!1,delayMs:1/0});case"connected":return r({message:u==="suspended"?"The server has restarted":"The connection to the server has been restored.",type:"success"});case"offline":return r({type:"loading",message:"Connection was lost due to a network issue or an ongoing update. Please hang tight!",closable:!1,delayMs:1/0});case"suspended":return r({message:"Restarting the server...",type:"loading",closable:!1,delayMs:1/0})}});const o=S(()=>{let i="";switch(e.syncHealth.value){case"offline":i+="Offline. Not syncing.";break;case"connected":i+="Online. Syncing...";break;case"idle":i+="Sync not initialised.";break;case"suspended":i+="Sync suspended.";break}return e.featureFlags.value.length>0&&(i+=` Feature flags: ${e.featureFlags.value.join(", ")}`),i}),s=S(()=>{switch(e.syncHealth.value){case"offline":case"suspended":case"idle":return"error";default:return"deployed"}});return{syncHealthStatus:o,stateDotState:s}}const Aa={class:"BuilderHeader"},xa={class:"BuilderHeader__logo"},Da=["href"],Ea={key:1,src:ht,alt:"Writer Framework logo"},Ma=["disabled"],La={class:"BuilderHeader__toolbar"},Fa={class:"BuilderHeader__toolbar__deployBtn"},Na=R({__name:"BuilderHeader",setup(e){const a=W(F.core),n=W(F.socketTimeout),r=O(!1),o=O(!1),s=ye(a),i=Ce(),u=Lt(),{stateDotState:f,syncHealthStatus:k}=Ta(a),_=S(()=>n==null?void 0:n.preventTasks.value.has("stayAwake"));function y(){n==null||n.togglePreventTaskId("stayAwake")}const{canDeploy:C,isDeploying:l,publishApplication:g,hasBeenPublished:h,lastDeployedAt:c,writerDeployUrl:b,name:I}=ya(a),m=new Intl.DateTimeFormat(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"});async function w(){s.track("nav_deploy_clicked"),h.value?T.value=!0:await g()}const T=O(!1),x=[{desc:"Cancel",fn:()=>{T.value=!1}},{desc:"Yes, deploy changes",fn:async()=>{T.value=!1,await g()}}],E=S(()=>c.value?`Editor Last saved ${m.format(c.value)}`:void 0),M=S(()=>h.value===!0?"Deploy changes":(h.value===!1,"Configure deployment"));function U(){s.track("nav_state_explorer_opened"),r.value=!0}function Y(){o.value=!0}async function Q(){try{await u.copy(location.href)}catch{i.pushToast({type:"error",message:"Could not copy link."})}}return(X,J)=>(t(),v("div",Aa,[d("div",xa,[p(b)?(t(),v("a",{key:0,href:p(b).toString(),target:"_blank",class:"BuilderHeader__goBack"},J[3]||(J[3]=[d("img",{src:ht,alt:"Writer Framework logo"},null,-1)]),8,Da)):(t(),v("img",Ea)),J[4]||(J[4]=d("hr",null,null,-1)),p(a).isWriterCloudApp.value?me((t(),v("input",{key:2,"onUpdate:modelValue":J[0]||(J[0]=de=>bt(I)?I.value=de:null),type:"text",disabled:!!p(c),class:"BuilderHeader__logo__appTitle"},null,8,Ma)),[[Ft,p(I)]]):$("",!0)]),B(ca,{class:"BuilderHeader__switcher"}),d("div",La,[J[6]||(J[6]=d("hr",null,null,-1)),B(te,{variant:"secondary",size:"smallIcon","data-writer-tooltip":"State Explorer","data-writer-tooltip-placement":"bottom",onClick:U},{default:L(()=>[B(V,{name:"compass"})]),_:1}),B(te,{variant:"secondary",size:"smallIcon","data-writer-tooltip":"Invite collaborators","data-writer-tooltip-placement":"bottom",onClick:Y},{default:L(()=>[B(V,{name:"share-2"})]),_:1}),B(Pa),p(C)?(t(),P(te,{key:0,size:"small",loading:p(l),"data-writer-tooltip":E.value,"data-writer-tooltip-placement":"bottom","data-automation-key":"deploy",onClick:w},{default:L(()=>[d("span",Fa,N(M.value),1),T.value?(t(),P(Se,{key:0,title:"Are you sure you want to deploy these changes?",size:"normal",actions:x},{default:L(()=>J[5]||(J[5]=[d("p",{class:"BuilderHeader__toolbar__deployModal__text"}," This will replace the current live version of this agent everywhere it is currently deployed. ",-1)])),_:1})):$("",!0)]),_:1},8,["loading","data-writer-tooltip"])):$("",!0),B($a),B($t,{state:p(f),"data-writer-tooltip":p(k),"data-writer-tooltip-placement":"left"},null,8,["state","data-writer-tooltip"]),_.value?(t(),P(te,{key:1,variant:"secondary",size:"smallIcon","data-writer-tooltip":"Turn off stay awake mode that prevents the session from expiring.","data-writer-tooltip-placement":"left",onClick:y},{default:L(()=>[B(V,{name:"coffee"})]),_:1})):$("",!0),r.value?(t(),P(Se,{key:2,title:"State Explorer","display-close-button":"",onClose:J[1]||(J[1]=de=>r.value=!1)},{default:L(()=>[B(fa)]),_:1})):$("",!0),o.value?(t(),P(Se,{key:3,title:"Share edit link with collaborators",description:"All AI Studio builders in your org can edit this agent with you in real time. Copy the link below to point them directly to editing this agent.","display-close-button":"",actions:[{desc:"Close",fn:()=>o.value=!1},{desc:p(u).copied.value?"Copied":"Copy edit link",fn:Q,icon:p(u).copied.value?"check":"clipboard",disabled:p(u).copied.value}],onClose:J[2]||(J[2]=de=>o.value=!1)},null,8,["actions"])):$("",!0)])]))}}),Ra=z(Na,[["__scopeId","data-v-1a28dcd5"]]),Ua={class:"text"},Wa=200,za=4,Va=R({__name:"BuilderTooltip",setup(e){const a=ie("rootEl"),n=O(!1),r=O(null);let o=null,s=null;const i=O("top"),u=O({top:0,left:0});async function f(){if(!o||(r.value=o.dataset.writerTooltip,!r.value))return;const l=o.dataset.writerTooltipGap?parseInt(o.dataset.writerTooltipGap):za;if(n.value=k(o),!n.value)return;await _e();const{x:g,y:h,width:c,height:b}=o.getBoundingClientRect(),{width:I,height:m}=a.value.getBoundingClientRect();switch(i.value){case"top":u.value.top=h-m-l,u.value.left=g+c/2-I/2;break;case"right":u.value.top=h+b/2-m/2,u.value.left=g+c+l;break;case"left":u.value.left=g-I-l,u.value.top=h+b/2-m/2;break;case"bottom":u.value.top=h+b+l,u.value.left=g+c/2-I/2;break}}function k(l){return l.getAttribute("data-writer-tooltip-strategy")==="overflow"?l.scrollWidth>l.clientWidth:!0}function _(l){const h=l.target.closest("[data-writer-tooltip]");if(h)o!==h&&(n.value=!1);else{n.value=!1,o=null;return}o=h,i.value=o.dataset.writerTooltipPlacement??"top",setTimeout(()=>y(h),Wa)}async function y(l){l===o&&(s==null||s.disconnect(),s=new MutationObserver(f),s.observe(o,{attributes:!0,attributeFilter:["data-writer-tooltip","data-writer-tooltip-placement","data-writer-tooltip-strategy"]}),f())}const C=S(()=>{const{top:l,left:g}=u.value;return{top:`${l}px`,left:`${g}px`}});return oe(()=>{document.documentElement.addEventListener("mouseover",_)}),he(()=>{document.documentElement.removeEventListener("mouseover",_),s==null||s.disconnect()}),(l,g)=>me((t(),v("div",{ref_key:"rootEl",ref:a,class:"BuilderTooltip",style:Ne(C.value)},[d("div",{class:K(["arrow",i.value])},null,2),d("div",Ua,N(r.value),1)],4)),[[Be,n.value]])}}),Oa=z(Va,[["__scopeId","data-v-7ba01c7c"]]),qa=""+new URL("art-paper-D70v1WMA.svg",import.meta.url).href,Ka={class:"BuilderPanel__collapser"},ja={class:"BuilderPanel__title"},Ha={class:"BuilderPanel__titleCompanion"},Ga=["data-order"],Ya={key:0,class:"BuilderPanel__contents__leftPanel"},Ja={class:"BuilderPanel__actions"},Za={class:"BuilderPanel__actionsCompanion"},Xa=R({__name:"BuilderPanel",props:{panelId:{},name:{},actions:{},contentsTeleportEl:{},scrollable:{type:Boolean},keyboardShortcutKey:{},enableLeftPanel:{type:Boolean},enableDropFile:{type:Boolean},maxFileSizeLimit:{}},emits:{openned:e=>typeof e=="boolean",filesDrop:e=>Array.isArray(e)&&e.length>0},setup(e,{expose:a,emit:n}){const r=W(F.builderManager),o=["code","log"],s=e,i=S(()=>{if(typeof s.maxFileSizeLimit=="number")return`Files can be up to ${Nt(s.maxFileSizeLimit)}`}),u=n,f=ie("mainContents");a({mainContents:f});const k=S(()=>s.enableDropFile&&_.value),_=O(!1);function y(m,w){s.enableDropFile&&(m.preventDefault(),_.value=w)}function C(m){m.preventDefault(),_.value=!1}function l(m){s.enableDropFile&&m.length>0&&u("filesDrop",m)}const g=S(()=>!r.openPanels.value.has(s.panelId)),h=S(()=>o.indexOf(s.panelId));function c(m){if(r.openPanels.value.has(m)){r.openPanels.value.delete(m),u("openned",!1);return}r.openPanels.value.add(m),u("openned",!0)}function b(m){const w=Wt(m);if(w&&m.key==s.keyboardShortcutKey.toLowerCase()){m.preventDefault(),c(s.panelId);return}s.actions.forEach(T=>{if(!T.keyboardShortcut)return;const{key:x,modifierKey:E}=T.keyboardShortcut;x.toLowerCase()==m.key&&(!w&&E||(m.preventDefault(),T.callback()))})}function I(m){if(!m)return"";let w=" (";return m.modifierKey&&(w+=rt()),w+=m.key,w+=")",w}return oe(async()=>{document.addEventListener("keydown",b)}),he(()=>{document.removeEventListener("keydown",b)}),(m,w)=>(t(),v("div",{class:K(["BuilderPanel",{collapsed:g.value}])},[d("div",Ka,[B(te,{variant:"neutral",size:"small","data-automation-action":"toggle-panel","data-automation-key":m.panelId,"data-writer-tooltip":`Toggle ${m.name} (${p(rt)()}${m.keyboardShortcutKey})`,onClick:w[0]||(w[0]=T=>c(m.panelId))},{default:L(()=>[B(V,{name:g.value?"chevron-right":"chevron-up"},null,8,["name"]),d("span",ja,N(m.name),1)]),_:1},8,["data-automation-key","data-writer-tooltip"])]),d("div",Ha,[le(m.$slots,"titleCompanion",{},void 0,!0)]),g.value?$("",!0):(t(),P(Ut,{key:0,to:m.contentsTeleportEl},[d("div",{style:Ne({order:h.value}),"data-order":h.value,class:K(["BuilderPanel__contents",{"BuilderPanel__contents--leftPanel":m.enableLeftPanel,"BuilderPanel__contents--dropingFile":k.value}]),onDrop:C,onDragover:w[1]||(w[1]=T=>y(T,!0)),onDragleave:w[2]||(w[2]=T=>y(T,!1))},[k.value?(t(),P(Rt,{key:0,multiple:"",label:"Drop files here",restrictions:i.value,onDrop:l},null,8,["restrictions"])):(t(),v(j,{key:1},[m.enableLeftPanel?(t(),v("div",Ya,[le(m.$slots,"leftPanel",{},void 0,!0)])):$("",!0),d("div",Ja,[d("div",Za,[le(m.$slots,"actionsCompanion",{},void 0,!0)]),(t(!0),v(j,null,ue(m.actions,(T,x)=>(t(),P(te,{key:x,"data-writer-tooltip":T.name+I(T.keyboardShortcut),"data-writer-tooltip-placement":"left",variant:"neutral",size:"smallIcon",disabled:T.isDisabled,onClick:T.callback},{default:L(()=>[B(V,{name:T.icon},null,8,["name"])]),_:2},1032,["data-writer-tooltip","disabled","onClick"]))),128))]),d("div",{ref_key:"mainContents",ref:f,class:"BuilderPanel__mainContents"},[le(m.$slots,"default",{},void 0,!0)],512)],64))],46,Ga)],8,["to"]))],2))}}),It=z(Xa,[["__scopeId","data-v-5ccf1c14"]]),st=150;function Qa(e){const a=O(structuredClone(Te(e.sourceFiles.value)));ae(e.sourceFiles,(b,I)=>{let m=!1,w=structuredClone(Te(a.value));const T=i(I).map(n);for(const x of ct(b)){const E=se(x,I),M=se(x,b);if(xe(M))continue;if(E===void 0||qe(M)){w=nt(x,w,structuredClone(Te(M))),m=!0;continue}if(!we(E))continue;const U=!E.complete&&M.complete,Y=E.complete&&M.complete;if(!U&&!Y)continue;const Q=n(x);if(T.includes(Q))continue;const X=se(x,w);we(X)&&(m=!0,X.complete=!0,X.content=M.content)}for(const x of zt(w))se(x,b)===void 0&&(w=Vt(x,w),m=!0);m&&(a.value=w)});function n(b){return b.join("/")}const r=De(),o=S(()=>Array.from(ct(a.value))),s=S(()=>i(e.sourceFiles.value));function i(b){return o.value.filter(I=>{const m=se(I,a.value);if(qe(m))return!1;if(!we(m))return!0;const w=se(I,b);return we(w)?!m.complete||!w.complete?!1:m.content!==w.content:!0})}const u=S(()=>{if(r.value!==void 0)return se(r.value,a.value)}),f=S({get(){return we(u.value)?u.value.content:""},set(b){if(r.value===void 0)return;const I=se(r.value,a.value);we(I)&&(I.content=b)}});function k(b=1){const I=`new-file-${b}.txt`;return se([I],a.value)?k(b+1):I}async function _(){const b=k();a.value=nt([b],Te(a.value)),l([b]),await e.sendCreateSourceFileRequest([b])}const y=S(()=>{var I;return(I=r.value)!=null&&I.length?r.value.at(-1).split(".").at(-1):""}),C=S(()=>{switch(y.value){case"py":return"python";case"js":case"mjs":return"javascript";case"ts":return"typescript";case"md":case"markdown":return"markdown";default:return y.value}});function l(b){r.value=b,we(u.value)&&!u.value.complete&&e.requestSourceFileLoading(b)}async function g(b){if(!(!r.value||!u.value)&&(u.value.type==="file"&&await e.sendCodeSaveRequest(f.value,r.value),b)){const I=[...Te(r.value)];r.value=void 0;try{await e.sendRenameSourceFileRequest(I,b)}catch(m){throw r.value=I,m}l(b)}}function h(b){return new Promise((I,m)=>{const w=new FileReader;w.addEventListener("loadend",T=>{const x=T.target.result;if(x instanceof ArrayBuffer){const E=String.fromCharCode.apply(null,new Uint8Array(x));return I(E)}I(x.split(",")[1])}),w.addEventListener("error",()=>{m()}),w.readAsDataURL(b)})}async function c(b){const I=st*1024*1024;if(b.size>I)throw Error(`Cannot upload file bigger than ${st}mb`);const m=[b.name];if(se(m,e.sourceFiles.value))throw Error(`The file ${b.name} already exists`);a.value=nt(m,Te(a.value),{type:"binary",uploading:!0});const w=await h(b);await e.sendFileUploadRequest(m,w)}return{code:f,sourceFileDraft:a,fileOpen:u,filepathOpen:r,pathsUnsaved:s,openedFileLanguage:C,save:g,upload:c,openFile:l,openNewFile:_,getNewFilename:k}}const en={class:"BuilderTree"},tn=["draggable","data-automation-key","aria-expanded"],an=["data-writer-tooltip"],nn={key:1,class:"BuilderTree__main__dropdown"},on=R({__name:"BuilderTree",props:lt({name:{type:String,required:!0},query:{type:String,required:!1,default:void 0},variant:{type:String,required:!1,default:void 0},noNestedSpace:{type:Boolean,required:!1},dataAutomationKey:{type:String,required:!1,default:void 0},hasChildren:{type:Boolean},draggable:{type:Boolean},matched:{type:Boolean},selected:{type:Boolean},disabled:{type:Boolean},dropdownOptions:{type:Array,required:!1,default:void 0},disableCollapse:{type:Boolean,required:!1}},{collapsed:{type:Boolean,required:!1,default:!1},collapsedModifiers:{}}),emits:lt({expandBranch:()=>!0,select:e=>!!e,dragover:e=>!!e,dragstart:e=>!!e,dragend:e=>!!e,drop:e=>!!e,dropdownSelect:e=>typeof e=="string"},["update:collapsed"]),setup(e,{expose:a,emit:n}){const r=ce({loader:()=>pe(()=>import("./index-C1IizHaQ.js").then(C=>C.bK),__vite__mapDeps([0,1]),import.meta.url)}),o=e,s=n;a({expand:_,toggleCollapse:y});const i=kt(e,"collapsed"),u=O(!1),f=S(()=>!o.matched),k=S(()=>!o.hasChildren);function _(){i.value=!1,s("expandBranch")}function y(C){C??(C=!i.value),C!==i.value&&(i.value=C)}return(C,l)=>(t(),v("div",en,[d("div",{class:K(["BuilderTree__main",{selected:e.selected,notMatched:f.value,childless:k.value}]),tabindex:"0",draggable:e.draggable,"data-automation-key":e.dataAutomationKey,"aria-expanded":!i.value,onMouseenter:l[2]||(l[2]=g=>u.value=!0),onMouseleave:l[3]||(l[3]=g=>u.value=!1),onClick:l[4]||(l[4]=g=>C.$emit("select",g)),onKeydown:l[5]||(l[5]=St(g=>C.$emit("select",g),["enter"])),onDragover:l[6]||(l[6]=g=>C.$emit("dragover",g)),onDragstart:l[7]||(l[7]=g=>C.$emit("dragstart",g)),onDragend:l[8]||(l[8]=g=>C.$emit("dragend",g)),onDrop:l[9]||(l[9]=g=>C.$emit("drop",g))},[e.hasChildren&&!e.disableCollapse?(t(),P(te,{key:0,class:"BuilderTree__main__collapser",variant:"neutral",size:"icon",disabled:e.disabled,onClick:l[0]||(l[0]=wt(g=>y(void 0),["stop"]))},{default:L(()=>[B(V,{name:i.value?"chevron-down":"chevron-up"},null,8,["name"])]),_:1},8,["disabled"])):$("",!0),le(C.$slots,"nameLeft",{},void 0,!0),d("span",{class:K(["BuilderTree__main__name",{"BuilderTree__main__name--disabled":e.disabled,"BuilderTree__main__name--root":e.variant==="root"}]),"data-writer-tooltip":e.name,"data-writer-tooltip-strategy":"overflow"},N(e.name),11,an),le(C.$slots,"nameRight",{},void 0,!0),e.dropdownOptions&&u.value?(t(),v("div",nn,[B(p(r),{options:e.dropdownOptions,"trigger-custom-size":"16px",onSelect:l[1]||(l[1]=g=>C.$emit("dropdownSelect",g))},null,8,["options"])])):$("",!0)],42,tn),B(Ot,null,{default:L(()=>[me(d("div",{class:K(["BuilderTree__children",{"BuilderTree__children--noNestedSpace":e.noNestedSpace}])},[le(C.$slots,"children",{},void 0,!0)],2),[[Be,!i.value&&e.hasChildren]])]),_:3})]))}}),rn=z(on,[["__scopeId","data-v-8c085d0a"]]),ln=["width","height","viewBox","aria-valuenow"],sn=["r","cx","cy","stroke","stroke-width"],un=["r","cx","cy","stroke","stroke-width","stroke-dasharray","stroke-dashoffset"],dn=R({__name:"WdsProgressLinear",props:{progress:{type:Number,required:!1,default:100},sizePx:{type:Number,required:!1,default:12},strokeWidth:{type:Number,required:!1,default:2}},setup(e){const a=e,n=S(()=>a.sizePx/2),r=S(()=>a.sizePx/2-a.strokeWidth/2),o=S(()=>2*Math.PI*r.value),s=S(()=>o.value*((100-a.progress)/100)),i=S(()=>`0 0 ${a.sizePx} ${a.sizePx}`);return(u,f)=>(t(),v("svg",{width:e.sizePx,height:e.sizePx,viewBox:i.value,style:{transform:"rotate(-90deg)"},role:"progressbar","aria-valuenow":e.progress,"aria-valuemin":"0","aria-valuemax":"100"},[d("circle",{r:r.value,cx:n.value,cy:n.value,fill:"transparent",stroke:p(Ke).Blue1,"stroke-width":e.strokeWidth},null,8,sn),d("circle",{r:r.value,cx:n.value,cy:n.value,fill:"transparent",stroke:p(Ke).Blue5,"stroke-width":e.strokeWidth,"stroke-dasharray":o.value,"stroke-dashoffset":s.value},null,8,un)],8,ln))}}),cn=R({__name:"BuilderCodePanelFileUploading",props:{timeMs:{type:Number,required:!0}},setup(e){const a=e,n=O(0);return oe(()=>{let r;const o=s=>{r||(r=s);const i=s-r;n.value=Math.min(i/a.timeMs*100,100),n.value<100&&requestAnimationFrame(o)};requestAnimationFrame(o)}),(r,o)=>(t(),P(dn,{class:"BuilderCodePanelFileUploading",progress:n.value,"size-px":12,"stroke-width":2},null,8,["progress"]))}}),pn=z(cn,[["__scopeId","data-v-449f2dac"]]),vt=[{label:"Delete",value:"delete",icon:"trash-2"}],vn=R({__name:"BuilderCodePanelSourceFilesTree",props:{sourceFiles:{type:Object,required:!0},path:{type:Array,default:()=>[]},pathActive:{type:Array,default:()=>[]},pathsUnsaved:{type:Array,default:()=>[]},displayAddFileButton:{type:Boolean}},emits:{select:e=>Array.isArray(e),delete:e=>Array.isArray(e),addFile:()=>!0},setup(e,{emit:a}){const n=e,r=a;function o(l){return l.join("/")}const s=S(()=>o(n.pathActive)),i=S(()=>n.pathsUnsaved.map(o)),u=S(()=>xe(n.sourceFiles)?Object.entries(n.sourceFiles.children).sort((l,g)=>l[0].localeCompare(g[0])):[]);function f(l){const g=se([...n.path,l],n.sourceFiles);return qe(g)&&g.uploading}function k(l){const g=o([...n.path,l]);return i.value.includes(g)}function _(l){return o([...n.path,l])===s.value}function y(l){if(!xe(n.sourceFiles)||f(l))return;const g=n.sourceFiles.children[l];xe(g)||r("select",[...n.path,l])}function C(l,g){l==="delete"&&r("delete",[...n.path,g])}return(l,g)=>(t(),v("div",null,[(t(!0),v(j,null,ue(u.value,([h,c])=>(t(),P(rn,{key:h,name:h,matched:"","has-children":p(xe)(c),selected:_(h),disabled:f(h),"right-click-options":vt,"dropdown-options":p(xe)(c)||p(qe)(c)?vt:void 0,onSelect:b=>y(h),onDropdownSelect:b=>C(b,h)},qt({children:L(()=>[B(Pt,{"source-files":c,"path-active":e.pathActive,"paths-unsaved":e.pathsUnsaved,path:[...e.path,h],onSelect:g[0]||(g[0]=b=>l.$emit("select",b)),onDelete:g[1]||(g[1]=b=>l.$emit("delete",b))},null,8,["source-files","path-active","paths-unsaved","path"])]),_:2},[f(h)||k(h)?{name:"nameLeft",fn:L(()=>[f(h)?(t(),P(pn,{key:0,"time-ms":2e3})):k(h)?(t(),P($t,{key:1,state:"newDraft"})):$("",!0)]),key:"0"}:void 0]),1032,["name","has-children","selected","disabled","dropdown-options","onSelect","onDropdownSelect"]))),128))]))}}),Pt=z(vn,[["__scopeId","data-v-13c86c55"]]),fn=["disabled"],mn={class:"WdsButtonLink__text"},_n=R({__name:"WdsButtonLink",props:{variant:{type:String,default:"primary"},weight:{type:String,default:"default"},leftIcon:{type:String,required:!1,default:void 0},rightIcon:{type:String,required:!1,default:void 0},text:{type:String,required:!0},disabled:{type:Boolean}},setup(e){const a=e,n=S(()=>[`WdsButtonLink--variant-${a.variant}`,`WdsButtonLink--weight-${a.weight}`]);return(r,o)=>(t(),v("button",{class:K(["WdsButtonLink",n.value]),disabled:e.disabled,type:"button"},[e.leftIcon?(t(),P(V,{key:0,name:e.leftIcon},null,8,["name"])):$("",!0),d("span",mn,N(e.text),1),e.rightIcon?(t(),P(V,{key:1,name:e.rightIcon},null,8,["name"])):$("",!0)],10,fn))}}),Tt=z(_n,[["__scopeId","data-v-f2cbc67f"]]),yn={class:"BuilderCodePanelFileUploadBtn"},gn=R({__name:"BuilderCodePanelFileUploadBtn",emits:{selected:e=>Array.isArray(e)&&e.length>0},setup(e,{emit:a}){const n=ie("input"),r=a;function o(){const{files:s}=n.value;s instanceof FileList&&s.length>0&&(r("selected",Array.from(s)),n.value.value="")}return(s,i)=>(t(),v("form",yn,[me(d("input",{ref_key:"input",ref:n,type:"file",multiple:"",onChange:o},null,544),[[Be,!1]]),B(Tt,{"left-icon":"upload",text:"Upload",onClick:i[0]||(i[0]=u=>p(n).click())})]))}}),ft="You have unsaved changes. Are you sure you want to leave?";function hn(e){const a=O(!1),n=O(null);function r(){a.value=!0,e==null||e.preventTasks.value.add("codeUnsaved")}function o(){a.value=!1,e==null||e.preventTasks.value.delete("codeUnsaved")}function s(u){if(a.value)return u.preventDefault(),u.returnValue=ft,ft}oe(()=>{n.value=s,window.addEventListener("beforeunload",n.value)}),he(()=>{n.value&&window.removeEventListener("beforeunload",n.value)});const i=Ee();return oe(()=>{window.addEventListener("beforeunload",s,{signal:i.signal})}),{enablePrevention:r,disablePrevention:o}}function bn(){const e=De(!1),a=De(null),n=(i,u)=>{e.value=!0,a.value={action:i,description:u}};return{showModal:e,executePendingAction:()=>{a.value&&(a.value.action(),a.value=null),e.value=!1},cancelPendingAction:()=>{a.value=null,e.value=!1},checkUnsavedChanges:(i,u,f)=>i?(n(u,f),!0):!1}}function kn(e){const a=Ee();function n(o,s){switch(s){case"ctrl":return o.ctrlKey&&!o.metaKey;case"cmd":return o.metaKey&&!o.ctrlKey;case"alt":return o.altKey;case"shift":return o.shiftKey;default:return!o.ctrlKey&&!o.metaKey&&!o.altKey&&!o.shiftKey}}function r(o){for(const s of e){const i=o.key.toLowerCase()===s.key.toLowerCase(),u=n(o,s.modifier);if(i&&u){s.preventDefault!==!1&&o.preventDefault(),s.handler();return}}}oe(()=>{document.addEventListener("keydown",r,{signal:a.signal})})}const wn={class:"UnsavedChangesModal__content"},Sn={class:"UnsavedChangesModal__icon"},Bn={class:"UnsavedChangesModal__message"},Cn=R({__name:"UnsavedChangesModal",props:{filename:{type:String,required:!0},isSaving:{type:Boolean,required:!1}},emits:{save:()=>!0,cancel:()=>!0},setup(e,{emit:a}){const n=e,r=a,o=S(()=>[{desc:"Cancel",fn:()=>r("cancel")},{desc:"Save",fn:()=>r("save"),disabled:n.isSaving}]);return(s,i)=>(t(),P(Se,{title:"Unsaved Changes",description:"You have unsaved changes. What would you like to do?",actions:o.value,"display-close-button":"",onClose:i[0]||(i[0]=u=>r("cancel"))},{default:L(()=>[d("div",wn,[d("div",Sn,[B(V,{name:"alert-triangle"})]),d("div",Bn,[d("p",null,[i[1]||(i[1]=q(" The file ")),d("strong",null,N(e.filename),1),i[2]||(i[2]=q(" has unsaved changes. "))]),i[3]||(i[3]=d("p",null,"Your changes will be lost if you don't save them.",-1))])])]),_:1},8,["actions"]))}}),$n=z(Cn,[["__scopeId","data-v-7f5bb12c"]]),In={class:"BuilderCodePanel__tree"},Pn={class:"BuilderCodePanel__tree__actions"},Tn={key:1,class:"BuilderCodePanel__noPreview"},An={class:"BuilderCodePanel__actionsCompanion"},xn=R({__name:"BuilderCodePanel",props:{contentsTeleportEl:{}},setup(e){const a=ce({loader:()=>pe(()=>import("./index-C1IizHaQ.js").then(A=>A.bK),__vite__mapDeps([0,1]),import.meta.url)}),n=ce({loader:()=>pe(()=>import("./BuilderEmbeddedCodeEditor-CY65_X2M.js").then(A=>A.B),__vite__mapDeps([2,0,1,3]),import.meta.url)}),r=W(F.core),o=W(F.builderManager),s=[{label:"Rename file",value:"rename",icon:"pencil"},{label:"Delete file",value:"delete",icon:"trash-2",variant:"danger"}],i=ye(r),{sourceFileDraft:u,openFile:f,upload:k,openNewFile:_,code:y,openedFileLanguage:C,filepathOpen:l,fileOpen:g,pathsUnsaved:h,save:c}=Qa(r),b=W(F.socketTimeout),{enablePrevention:I,disablePrevention:m}=hn(b),{showModal:w,checkUnsavedChanges:T,executePendingAction:x,cancelPendingAction:E}=bn();async function M(A){await Promise.all(A.map(U))}async function U(A){try{await k(A),Q({type:"success",message:`File ${A.name} uploaded`})}catch(H){Q({type:"error",message:H.message})}}const Y=S(()=>{var A;return(A=g.value)==null?void 0:A.type}),{pushToast:Q}=Ce(),X=it();function J(A){const H=new AbortController;oe(()=>{document.addEventListener("keydown",async re=>{const tt=re.metaKey||re.ctrlKey,at=re.key==="s"||re.key==="S";!tt||!at||(re.preventDefault(),await A())},{signal:H.signal})}),he(()=>H.abort())}J(async()=>{await $e()}),kn([{key:"w",modifier:"ctrl",handler:Z},{key:"w",modifier:"cmd",handler:Z}]);const de=ie("filenameEl"),be=O(""),ve=O(!1),ge=S(()=>{var A;return((A=l.value)==null?void 0:A.join("/"))??""}),je=S(()=>ge.value!=="main.py"),Ue=S(()=>ge.value!==be.value),He=S(()=>ve.value||ge.value==="main.py"),fe=S(()=>{if(Ue.value)return!1;if(l.value===void 0)return!0;const A=h.value.map(re=>re.join("/")).includes(ge.value),H=l.value&&!se(l.value,r.sourceFiles.value);return!A&&!H});ae(l,()=>{var A;be.value=((A=l.value)==null?void 0:A.join("/"))??""}),ae(r.sessionTimestamp,()=>{ve.value=!1}),Kt(()=>{fe.value?m():I()}),ae(()=>o.openPanels.value.has("code"),(A,H)=>{H&&!A&&et()});function Ge(A){A&&(i.track("nav_code_opened"),l.value===void 0&&f(["main.py"]))}async function We(){var A;ge.value!=="main.py"&&(await _e(),(A=de.value)==null||A.focus())}async function Ye(A){switch(A){case"rename":return We();case"delete":await Me(l.value)}}async function ze(){await _(),We()}async function Me(A){await r.sendDeleteSourceFileRequest(A),Q({type:"success",message:"The file was deleted"}),l.value.join("/").startsWith(A.join("/"))&&f(["main.py"])}async function $e(){if(l.value===void 0)return Q({type:"error",message:"There is no file open"});if(fe.value)return Q({type:"info",message:"There are no file changes to save"});ve.value=!0;const A=Ue.value?be.value.split("/"):void 0;if(A){const H=Ve(A);if(H)return Q({type:"error",message:H})}try{await c(A),Q({type:"success",message:"The file was saved"}),i.track("nav_code_file_updated",{path:l.value})}catch(H){X.error("The file hasn't been saved.",H),Q({type:"error",message:"The file hasn't been saved"});return}finally{ve.value=!1}}async function Je(){await $e(),x()}function Ze(){E()}async function Xe(A){T(!fe.value,()=>f(A),"switch file")||f(A)}async function Qe(A){T(!fe.value,()=>Me(A),"delete file")||await Me(A)}function Z(){T(!fe.value,()=>o.openPanels.value.delete("code"),"close panel")||o.openPanels.value.delete("code")}function et(){T(!fe.value,()=>{},"close panel")&&_e(()=>{o.openPanels.value.add("code")})}function Ve(A){return A[0]===""?"Path should not have a leading slash":A[0]===".wf"?".wf is reserved for Writer Framework":A.some(H=>H==="")?"Invalid path":null}return(A,H)=>(t(),v(j,null,[B(It,{"panel-id":"code",name:"Code","contents-teleport-el":A.contentsTeleportEl,actions:[],scrollable:!1,"enable-left-panel":"","keyboard-shortcut-key":"J",class:"BuilderCodePanel","enable-drop-file":"","max-file-size-limit":p(st)*1e3*1e3,onFilesDrop:M,onOpenned:Ge},{leftPanel:L(()=>[d("div",In,[B(Pt,{"path-active":p(l),"paths-unsaved":p(h),"source-files":p(u),onAddFile:ze,onSelect:Xe,onDelete:Qe},null,8,["path-active","paths-unsaved","source-files"]),d("div",Pn,[B(Tt,{"left-icon":"plus",text:"Add file",onClick:ze}),B(gn,{onSelected:M})])])]),actionsCompanion:L(()=>[d("div",An,[B(Bt,{ref_key:"filenameEl",ref:de,modelValue:be.value,"onUpdate:modelValue":H[1]||(H[1]=re=>be.value=re),disabled:!je.value,class:"BuilderCodePanel__actionsCompanion__filename",autofocus:"",variant:"ghost",onKeydown:St($e,["enter"])},null,8,["modelValue","disabled"]),B(te,{variant:"primary",size:"small",disabled:ve.value||fe.value,class:"BuilderCodePanel__actionsCompanion__saveBtn",onClick:$e},{default:L(()=>[B(V,{name:"save"}),H[3]||(H[3]=q(" Save file "))]),_:1},8,["disabled"]),B(p(a),{disabled:He.value,options:s,onSelect:Ye},null,8,["disabled"])])]),default:L(()=>[Y.value==="file"?(t(),P(p(n),{key:0,modelValue:p(y),"onUpdate:modelValue":H[0]||(H[0]=re=>bt(y)?y.value=re:null),variant:"full",language:p(C),disabled:ve.value},null,8,["modelValue","language","disabled"])):$("",!0),Y.value==="binary"?(t(),v("div",Tn,H[2]||(H[2]=[d("img",{class:"BuilderCodePanel__noPreview__img",src:qa},null,-1),d("p",{class:"BuilderCodePanel__noPreview__title"},"Canâ€™t Preview File",-1),d("p",{class:"BuilderCodePanel__noPreview__desc"}," Non-text files are not available to view here ",-1)]))):$("",!0)]),_:1},8,["contents-teleport-el","max-file-size-limit"]),p(w)?(t(),P($n,{key:0,filename:ge.value,"is-saving":ve.value,onSave:Je,onCancel:Ze},null,8,["filename","is-saving"])):$("",!0)],64))}}),Dn=z(xn,[["__scopeId","data-v-deaca6f9"]]),En={class:"BuiderLogBlueprintExecutionTrace"},Mn={key:0,class:"trace"},Ln={class:"type"},Fn={key:0},Nn={key:1},Rn={class:"main"},Un={key:0},Wn={key:1},zn={key:2},Vn={key:3},On={class:"details"},qn={class:"data","data-automation-key":"result"},Kn={key:1,class:"nothing"},jn={class:"data","data-automation-key":"return-value"},Hn={class:"environment"},Gn={class:"data"},Yn={key:1,class:"nothing"},Jn={class:"callStack"},Zn={class:"eyebrow"},Xn=R({__name:"BuilderLogBlueprintExecutionTrace",props:{executionItem:{}},emits:["closeModal"],setup(e,{emit:a}){const n=W(F.core),r=W(F.builderManager),o=ye(n),s=a,{goToComponentParentPage:i}=Re(n,r),u=e,f=S(()=>{var C;const y=((C=u.executionItem.executionEnvironment)==null?void 0:C.call_stack)??[];return Object.fromEntries(y.map(l=>[l,n.getComponentById(l)]))}),k=S(()=>{var y;return((y=u.executionItem.executionEnvironment)==null?void 0:y.trace)??[]});oe(()=>{o.track("blueprints_logs_trace_opened")});async function _(y){s("closeModal"),r.setMode("blueprints"),await _e(),i(y),await _e(),r.setSelection(y,void 0,"log")}return(y,C)=>{var l,g,h;return t(),v("div",En,[k.value.length>0?(t(),v("div",Mn,[(t(!0),v(j,null,ue(k.value,(c,b)=>(t(),v("div",{key:b,class:"traceEntry"},[d("div",Ln,[c.type=="functionCall"?(t(),v("span",Fn,"âš¡ï¸")):$("",!0),c.type=="reasoning"?(t(),v("span",Nn,"ðŸ§ ")):$("",!0)]),d("div",Rn,[c.thought?(t(),v("div",Un,[C[0]||(C[0]=d("strong",null,"Thought.",-1)),q(" "+N(c.thought),1)])):$("",!0),c.action?(t(),v("div",Wn,[C[1]||(C[1]=d("strong",null,"Action.",-1)),q(" "+N(c.action),1)])):$("",!0),c.name?(t(),v("div",zn,N(c.name),1)):$("",!0),c.parameters?(t(),v("div",Vn,[B(Le,{"hide-root":!0,data:c.parameters,"initial-depth":1,class:"data"},null,8,["data"])])):$("",!0)])]))),128))])):$("",!0),d("div",On,[d("div",null,[C[2]||(C[2]=d("h3",null,"Result",-1)),C[3]||(C[3]=d("p",null," The value resulting of the execution of this block. This value is added to the execution environment of the direct dependents of this block. There, it's accessible via @{result}. ",-1)),d("div",qn,[(l=y.executionItem)!=null&&l.result?(t(),P(Le,{key:0,data:y.executionItem.result,"initial-depth":1},null,8,["data"])):(t(),v("div",Kn,"No result."))])]),d("div",null,[C[4]||(C[4]=d("h3",null,"Return value",-1)),C[5]||(C[5]=d("p",null," The value being returned, which is used to determine the result of 'Run blueprint' blocks and 'Chat completion' tool calls. ",-1)),d("div",jn,[(g=y.executionItem)!=null&&g.returnValue?(t(),P(Le,{key:0,data:y.executionItem.returnValue,"initial-depth":1},null,8,["data"])):(t(),v(j,{key:1},[q(" No return value. ")],64))])])]),d("div",Hn,[C[6]||(C[6]=d("h3",null,"Execution environment",-1)),C[7]||(C[7]=d("p",null," The following values were made available to this block during execution time. These values are accessible via the same template syntax i.e. @{my_var}, as state elements. ",-1)),d("div",Gn,[(h=y.executionItem)!=null&&h.executionEnvironment?(t(),P(Le,{key:0,data:y.executionItem.executionEnvironment,"initial-depth":1},null,8,["data"])):(t(),v("div",Yn,"Empty execution environment."))])]),d("div",Jn,[C[8]||(C[8]=d("h3",null,"Call stack",-1)),(t(!0),v(j,null,ue(f.value,(c,b)=>{var I,m,w;return t(),v("div",{key:b,class:K(["component",{active:b==y.executionItem.componentId}])},[d("div",null,[d("div",Zn,[b==y.executionItem.componentId?(t(),v(j,{key:0},[q(" This block Â· ")],64)):$("",!0),q(" "+N(((I=p(n).getComponentDefinition(c==null?void 0:c.type))==null?void 0:I.name)??"Unavailable component")+" Â· Id: "+N(b),1)]),q(" "+N(((m=c==null?void 0:c.content)==null?void 0:m.alias)??((w=p(n).getComponentDefinition(c==null?void 0:c.type))==null?void 0:w.name)??"Unavailable component"),1)]),c?(t(),P(te,{key:0,variant:"neutral",size:"smallIcon","data-writer-tooltip":"Jump to this block",onClick:T=>_(b)},{default:L(()=>[B(V,{name:"square-dashed-mouse-pointer"})]),_:2},1032,["onClick"])):$("",!0)],2)}),128))])])}}}),Qn=z(Xn,[["__scopeId","data-v-f98f57c8"]]),eo={class:"BuilderListItem"},to=["viewBox"],ao=["d","stroke"],no=["d","stroke"],oo={class:"BuilderListItem__content"},ro=R({__name:"BuilderListItem",props:{isLast:{type:Boolean,required:!1},height:{type:Number,required:!1,default:1e3},color:{type:String,required:!1,default:Ke.Blue2},colorLast:{type:String,required:!1,default:Ke.Blue2}},setup(e){const a=e,n=S(()=>a.height/2),r=S(()=>`0 0 17 ${a.height}`),o=S(()=>["M1 0",`V${n.value-8}`,`C1 ${n.value-4}.4183 4.58172 ${n.value} 9 ${n.value}`,"H17"].join(" ")),s=S(()=>[`M1 ${n.value-8}`,`V${a.height}`].join(" "));return(i,u)=>(t(),v("div",eo,[(t(),v("svg",{viewBox:r.value,fill:"none",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMinYMax meet",class:"BuilderListItem__anchor"},[e.isLast?$("",!0):(t(),v("path",{key:0,d:s.value,stroke:e.colorLast,"stroke-width":"1"},null,8,ao)),d("path",{d:o.value,stroke:e.color,"stroke-width":"1"},null,8,no)],8,to)),d("div",oo,[le(i.$slots,"default",{},void 0,!0)])]))}}),lo=z(ro,[["__scopeId","data-v-33f3edcd"]]),so={class:"BuilderLogBlueprintExecution"},io={class:"name"},uo={key:0},co={class:"eyebrow"},po={class:"outcome"},vo={class:"result"},fo={class:"time"},mo={key:0,class:"message markdown"},_o=R({__name:"BuilderLogBlueprintExecution",props:{executionLog:{}},setup(e){const a=W(F.core),n=W(F.builderManager),{goToComponentParentPage:r}=Re(a,n),o=e,s=O(null),i={in_progress:5,error:4,success:3,stopped:2,skipped:1,none:0},u=S(()=>({summary:[...o.executionLog.summary.filter(y=>!!y.outcome).filter(y=>(i[y.outcome]??i.success)>1).map(y=>({...y,component:a.getComponentById(y.componentId),componentDef:a.getComponentById(y.componentId)?a.getComponentDefinition(a.getComponentById(y.componentId).type):void 0}))]}));async function f(_){n.setMode("blueprints"),await _e(),r(_),await _e(),n.setSelection(_,void 0,"log")}function k(_){return _<0?"N/A":_<.1?"< 0.1s":`${_.toFixed(2)}s`}return(_,y)=>{const C=jt("dompurify-html");return t(),v("div",so,[(t(!0),v(j,null,ue(u.value.summary,(l,g)=>(t(),P(lo,{key:g,"is-last":g+1===u.value.summary.length},{default:L(()=>{var h,c,b,I,m,w,T,x,E,M,U,Y;return[d("div",{class:K(["itemWrapper",{"itemWrapper--first":g===0,"itemWrapper--last":g+1===u.value.summary.length}])},[d("div",{class:K(["item",{selected:p(n).isComponentIdSelected(l.componentId)}])},[d("div",io,[(c=(h=l.component)==null?void 0:h.content)!=null&&c.alias?(t(),v("div",uo,[d("div",co,N(((b=l.componentDef)==null?void 0:b.name)??"Unavailable component"),1),q(" "+N((m=(I=l.component)==null?void 0:I.content)==null?void 0:m.alias),1)])):(t(),v(j,{key:1},[q(N(((w=l.componentDef)==null?void 0:w.name)??"Unavailable component"),1)],64)),l.component?(t(),P(te,{key:2,variant:"neutral",size:"smallIcon","data-writer-tooltip":"Jump to this block",onClick:Q=>f(l.componentId)},{default:L(()=>[B(V,{name:"square-dashed-mouse-pointer"})]),_:2},1032,["onClick"])):$("",!0)]),d("div",po,[l.outcome!=="in_progress"?(t(),v(j,{key:0},[d("div",{class:K(["ball",(E=(x=(T=l.componentDef)==null?void 0:T.outs)==null?void 0:x[l.outcome])==null?void 0:E.style])},null,2),q(" "+N(((Y=(U=(M=l.componentDef)==null?void 0:M.outs)==null?void 0:U[l.outcome])==null?void 0:Y.name)??l.outcome),1)],64)):(t(),v(j,{key:1},[y[1]||(y[1]=d("div",{class:"ballContainer"},[d("div",{class:"ball inProgress"})],-1)),y[2]||(y[2]=q(" In progress... "))],64))]),d("div",vo,[s.value==g?(t(),P(Se,{key:0,title:"Trace",size:"wide",actions:[{desc:"Done",fn:()=>s.value=null}]},{default:L(()=>[B(Qn,{"execution-item":l,onCloseModal:y[0]||(y[0]=()=>s.value=null)},null,8,["execution-item"])]),_:2},1032,["actions"])):$("",!0),l.result||l.returnValue||l.executionEnvironment?(t(),P(te,{key:1,variant:"special",size:"small",onClick:()=>s.value=g},{default:L(()=>[B(V,{name:"file-search-2"}),y[3]||(y[3]=q(" Trace "))]),_:2},1032,["onClick"])):$("",!0)]),d("div",fo,N(k(l.executionTimeInSeconds)),1),l.message?me((t(),v("div",mo,null,512)),[[C,p(ia).parse(l.message)]]):$("",!0)],2)],2)]}),_:2},1032,["is-last"]))),128))])}}}),yo=z(_o,[["__scopeId","data-v-a691c27b"]]),go={class:"BuilderLogIndicator"},ho={key:0,class:"number error"},bo={class:"icon"},ko={key:1,class:"number info"},wo={class:"icon"},So=R({__name:"BuilderLogIndicator",setup(e){const a=W(F.builderManager),n=S(()=>a.getLogEntries().reduce((r,o)=>(o.type in r||(r[o.type]=0),r[o.type]++,r),{}));return(r,o)=>(t(),v("div",go,[n.value.error>0?(t(),v("div",ho,[d("div",bo,[B(V,{name:"triangle-alert"})]),q(" "+N(n.value.error??0),1)])):$("",!0),n.value.info>0?(t(),v("div",ko,[d("div",wo,[B(V,{name:"info"})]),q(" "+N(n.value.info??0),1)])):$("",!0)]))}}),Bo=z(So,[["__scopeId","data-v-f0898ae9"]]),Co={key:0,class:"entries"},$o={class:"icon"},Io={class:"title"},Po={class:"time"},To={class:"content"},Ao={key:0,class:"codeContainer"},xo={key:1,class:"emptyMessage"},Do=R({__name:"BuilderLogPanel",props:{contentsTeleportEl:{}},setup(e){const a=W(F.core),n=W(F.builderManager),r=ie("panel"),o=ye(a);async function s(k){k&&(o.track("nav_logs_opened"),await _e(),await f())}const i=[{icon:"trash-2",name:"Clear log",callback:()=>{n.clearLogEntries()},keyboardShortcut:{modifierKey:!0,key:"L"}}],u=S(()=>n.getLogEntries());async function f(){var g;const k=(g=r.value)==null?void 0:g.mainContents;if(!k)return;const _=k.querySelector(".item.selected");if(!_)return;const y=k.getBoundingClientRect(),C=_.getBoundingClientRect(),l=k.scrollTop+(C.top-y.top)-(y.height/2-C.height/2);k.scrollTo({top:l,behavior:"smooth"})}return ae(n.selection,async()=>{await _e(),await f()}),(k,_)=>(t(),P(It,{ref_key:"panel",ref:r,"panel-id":"log",name:"Log","contents-teleport-el":k.contentsTeleportEl,actions:i,scrollable:!0,"keyboard-shortcut-key":"K",class:"BuilderLogPanel",onOpenned:s},{titleCompanion:L(()=>[B(Bo)]),default:L(()=>[u.value.length>0?(t(),v("div",Co,[(t(!0),v(j,null,ue(u.value,(y,C)=>(t(),v(j,{key:C},[d("div",{class:K(["entry",y.type])},[d("div",$o,[B(V,{name:y.type==="error"?"triangle-alert":"info"},null,8,["name"])]),d("div",Io,N(y.title)+N(y.repeated>0?` Â· Repeated ${y.repeated} times`:""),1),d("div",Po,N(y.timestampReceived.toLocaleTimeString()),1),d("div",To,[q(N(y.message)+" ",1),y.code?(t(),v("div",Ao,[d("code",null,N(y.code),1)])):$("",!0)])],2),y.blueprintExecution?(t(),P(yo,{key:0,"execution-log":y.blueprintExecution},null,8,["execution-log"])):$("",!0)],64))),128))])):$("",!0),u.value.length==0?(t(),v("div",xo,_[0]||(_[0]=[d("div",null,[q(" Exceptions and other relevant messages will be shown here."),d("br"),q("Also, you can include print statements in event handlers to create log entries. ")],-1)]))):$("",!0)]),_:1},8,["contents-teleport-el"]))}}),Eo=z(Do,[["__scopeId","data-v-5bf9ec81"]]),Mo={class:"switches"},Lo=R({__name:"BuilderPanelSwitcher",setup(e){const a=W(F.builderManager),n=ie("screenEl");return(r,o)=>(t(),v("div",{class:K(["BuilderPanelSwitcher",{openPanels:p(a).openPanels.value.size>0}])},[d("div",{ref_key:"screenEl",ref:n,class:"screen"},null,512),d("div",Mo,[B(Dn,{"contents-teleport-el":p(n)},null,8,["contents-teleport-el"]),B(Eo,{"contents-teleport-el":p(n)},null,8,["contents-teleport-el"])])],2))}}),Fo=z(Lo,[["__scopeId","data-v-93f8be10"]]),No=["href"],Ro=["disabled"],Uo=R({__name:"BuilderSidebarButton",props:{icon:{type:String,required:!0},active:{type:Boolean},disabled:{type:Boolean},href:{type:String,required:!1,default:void 0}},setup(e){return(a,n)=>e.href?(t(),v("a",{key:0,class:"BuilderSidebarButton",href:e.href},[B(V,{name:e.icon},null,8,["name"])],8,No)):(t(),v("button",{key:1,class:K(["BuilderSidebarButton",{"BuilderSidebarButton--active":e.active}]),role:"button",disabled:e.disabled},[B(V,{name:e.icon},null,8,["name"])],10,Ro))}}),Ae=z(Uo,[["__scopeId","data-v-044cd21a"]]),Wo={class:"BuilderSidebarVersion"},zo={class:"BuilderSidebarVersion__capsule"},Vo=R({__name:"BuilderSidebarVersion",props:{version:{type:String,required:!0}},setup(e){return(a,n)=>(t(),v("span",Wo,[d("span",zo," BETA "+N(e.version),1)]))}}),Oo=z(Vo,[["__scopeId","data-v-bbae565d"]]),qo={key:0,class:"BuilderSidebarPanel__inputContainer"},Ko={class:"BuilderSidebarPanel__footer"},jo=R({__name:"BuilderSidebarPanel",props:lt({hideSearchBar:{type:Boolean,required:!1},placeholder:{type:String,required:!1,default:""},searchCount:{type:Number,required:!1,default:void 0}},{modelValue:{type:String,required:!1,default:""},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const a=kt(e,"modelValue"),n=e,r=S(()=>{if(n.searchCount!==void 0)return`${n.searchCount} result${n.searchCount===1?"":"s"}`}),o=O(!1);function s(i){i.target instanceof HTMLElement&&(o.value=i.target.scrollTop>0)}return(i,u)=>(t(),v("div",{class:K(["BuilderSidebarPanel",{"BuilderSidebarPanel--mainScrollSeparator":o.value}])},[e.hideSearchBar?$("",!0):(t(),v("div",qo,[B(Bt,{modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=f=>a.value=f),class:"searchInput","left-icon":"search","data-automation-action":"search",placeholder:e.placeholder,"right-text":r.value,"right-icon":a.value?"x":void 0,onRightIconClick:u[1]||(u[1]=f=>a.value="")},null,8,["modelValue","placeholder","right-text","right-icon"])])),d("div",{class:"BuilderSidebarPanel__main",onScroll:s},[le(i.$slots,"default",{},void 0,!0)],32),d("div",Ko,[le(i.$slots,"footer",{},void 0,!0)])],2))}}),Ho=z(jo,[["__scopeId","data-v-fcaea8d5"]]),Go=["data-note-id"],Yo={class:"BuilderSidebarNote__header"},Jo={class:"BuilderSidebarNote__header__avatar"},Zo={class:"BuilderSidebarNote__header__avatar__type"},Xo={class:"BuilderSidebarNote__header__info"},Qo={key:1},er={key:0,class:"BuilderSidebarNote__header__actions"},tr={key:0,class:"BuilderSidebarNote__content"},ar={key:0},nr=R({__name:"BuilderSidebarNote",props:{component:{type:Object,required:!0},excerpt:{type:Boolean}},emits:{select:()=>!0,edit:()=>!0,delete:()=>!0},setup(e,{emit:a}){const n=e,{user:r}=Ht(),o=a,s=W(F.notesManager),{createdAtFormatted:i,type:u,content:f,createdBy:k}=s.useNoteInformation(S(()=>n.component)),{user:_,isLoading:y,error:C}=_t(k),l=S(()=>y.value||C.value),g=S(()=>f.value.length<100?f.value:`${f.value.slice(0,100)}...`),h=S(()=>f.value.split(`
`)),c=S(()=>_.value?[_.value.firstName,_.value.lastName].filter(Boolean).join(" "):""),b=S(()=>{var m;if(((m=r.value)==null?void 0:m.id)===k.value)return[{value:"edit",label:"Edit",icon:"pencil"},{value:"delete",label:"Delete",icon:"trash-2",variant:"danger"}]});function I(m){switch(m){case"edit":return o("edit");case"delete":return o("delete")}}return(m,w)=>(t(),v("div",{class:"BuilderSidebarNote","data-note-id":e.component.id,tabindex:"0",onClick:w[0]||(w[0]=T=>m.$emit("select"))},[d("div",Yo,[d("div",Jo,[d("div",Zo,[p(u)==="blueprints"?(t(),P(V,{key:0,name:"wds-blueprints"})):p(u)==="ui"?(t(),P(V,{key:1,name:"frame"})):$("",!0)]),B(ut,{"user-id":p(k)},null,8,["user-id"])]),d("div",Xo,[l.value?(t(),P(yt,{key:0,class:"BuilderSidebarNote__header__info__loader"})):(t(),v("p",Qo,N(c.value),1)),d("p",null,N(p(i)),1)]),b.value?(t(),v("div",er,[B(gt,{options:b.value,"trigger-custom-size":"16px",onSelect:I},null,8,["options"])])):$("",!0)]),p(f)?(t(),v("div",tr,[e.excerpt?(t(),v("p",ar,N(g.value),1)):(t(!0),v(j,{key:1},ue(h.value,(T,x)=>(t(),v("p",{key:x},N(T),1))),128))])):$("",!0)],8,Go))}}),mt=z(nr,[["__scopeId","data-v-4129b8b4"]]),or={},rr={class:"BuilderSidebarNotesEmpty"};function lr(e,a){return t(),v("div",rr,a[0]||(a[0]=[Gt('<svg width="77" height="77" viewBox="0 0 77 77" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-98d925a1><circle cx="38.5" cy="38.5" r="38.5" fill="#E4E9FF" data-v-98d925a1></circle><path d="M54 44.3333C54 45.2763 53.6254 46.1807 52.9586 46.8475C52.2918 47.5143 51.3874 47.8889 50.4444 47.8889H29.1111L22 55V26.5556C22 25.6126 22.3746 24.7082 23.0414 24.0414C23.7082 23.3746 24.6126 23 25.5556 23H50.4444C51.3874 23 52.2918 23.3746 52.9586 24.0414C53.6254 24.7082 54 25.6126 54 26.5556V44.3333Z" fill="white" data-v-98d925a1></path><path d="M38 30.1111V40.7778V30.1111Z" fill="white" data-v-98d925a1></path><path d="M32.6667 35.4444H43.3333H32.6667Z" fill="white" data-v-98d925a1></path><path d="M38 30.1111V40.7778M32.6667 35.4444H43.3333M54 44.3333C54 45.2763 53.6254 46.1807 52.9586 46.8475C52.2918 47.5143 51.3874 47.8889 50.4444 47.8889H29.1111L22 55V26.5556C22 25.6126 22.3746 24.7082 23.0414 24.0414C23.7082 23.3746 24.6126 23 25.5556 23H50.4444C51.3874 23 52.2918 23.3746 52.9586 24.0414C53.6254 24.7082 54 25.6126 54 26.5556V44.3333Z" stroke="black" stroke-linecap="round" stroke-linejoin="round" data-v-98d925a1></path></svg><h5 data-v-98d925a1>No Notes</h5><p data-v-98d925a1>Click anywhere on a blueprint or interface to add a note</p>',3)]))}const sr=z(or,[["render",lr],["__scopeId","data-v-98d925a1"]]),ir={class:"BuilderSidebarNoteForm"},ur=R({__name:"BuilderSidebarNoteForm",props:{component:{type:Object,required:!0},autofocus:{type:Boolean}},emits:{submit:e=>typeof e=="string"},setup(e){const a=e,n=W(F.notesManager),r=O(n.getNoteContent(a.component));return(o,s)=>(t(),v("div",ir,[B(Yt,{modelValue:r.value,"onUpdate:modelValue":s[0]||(s[0]=i=>r.value=i),class:"BuilderSidebarNoteForm__input",autofocus:e.autofocus},null,8,["modelValue","autofocus"]),B(te,{class:"BuilderSidebarNoteForm__submit",variant:"secondary",size:"smallIcon",disabled:!r.value,onClick:s[1]||(s[1]=i=>o.$emit("submit",r.value))},{default:L(()=>[B(V,{name:"send"})]),_:1},8,["disabled"])]))}}),dr=z(ur,[["__scopeId","data-v-157847b0"]]),cr={key:0,class:"BuilderSidebarNotes__note"},pr={key:2,class:"BuilderSidebarNotes__notes"},vr=R({__name:"BuilderSidebarNotes",setup(e){const a=W(F.core),n=W(F.builderManager),{selectedNote:r,selectNote:o,selectedNoteMode:s,selectedNoteId:i,getAllNotes:u,searchNotes:f,deleteNote:k,hoveredNoteId:_,useNoteInformation:y}=W(F.notesManager),{createAndInsertComponent:C}=Re(a,n),l=Jt({componentId:i,fieldKey:"content"}),g=O(""),h=S(()=>Array.from(u()).toSorted(I)),c=S(()=>Array.from(f(g.value)).toSorted(I)),b=S(()=>!!(r.value||h.value.length===0));function I(T,x){const E=y(T).createdAt.value,M=y(x).createdAt.value;return new Date(M).getTime()-new Date(E).getTime()}function m(T){return y(T).state.value}function w(T){a.getComponentById(i.value)?l.value=T:C(r.value.type,r.value.parentId,void 0,{content:{...r.value.content,content:T},x:r.value.x,y:r.value.y}),o(void 0)}return(T,x)=>(t(),P(Ho,{modelValue:g.value,"onUpdate:modelValue":x[4]||(x[4]=E=>g.value=E),class:"BuilderSidebarNotes","hide-search-bar":b.value},{default:L(()=>[p(r)?(t(),v("div",cr,[p(s)==="edit"?(t(),P(dr,{key:0,component:p(r),autofocus:"",onSubmit:w},null,8,["component"])):(t(),P(mt,{key:1,component:p(r),onGoBack:x[0]||(x[0]=E=>p(o)(void 0)),onEdit:x[1]||(x[1]=E=>p(o)(p(i),"edit")),onDelete:x[2]||(x[2]=E=>p(k)(p(i)))},null,8,["component"]))])):c.value.length===0?(t(),P(sr,{key:1})):(t(),v("div",pr,[(t(!0),v(j,null,ue(c.value,E=>(t(),P(mt,{key:E.id,component:E,class:K(["BuilderSidebarNotes__notes__note",{"BuilderSidebarNotes__notes__note--hover":m(E)==="hover"}]),excerpt:"",onSelect:M=>p(o)(E.id,"show"),onEdit:M=>p(o)(E.id,"edit"),onDelete:M=>p(k)(E.id),onMouseenter:M=>_.value=E.id,onMouseleave:x[3]||(x[3]=M=>_.value=void 0)},null,8,["component","class","onSelect","onEdit","onDelete","onMouseenter"]))),128))]))]),_:1},8,["modelValue","hide-search-bar"]))}}),fr=z(vr,[["__scopeId","data-v-3dc5600c"]]),mr={class:"BuilderSidebar"},_r={class:"BuilderSidebar__toolbar"},yr={key:0,class:"BuilderSidebar__toolbar__top"},gr={key:1,class:"BuilderSidebar__toolbar__center"},hr={class:"BuilderSidebar__toolbar__bottom"},br={key:0,class:"BuilderSidebar__pane"},kr={key:1},wr=R({__name:"BuilderSidebar",emits:{activePaneChanged:e=>e===void 0||typeof e=="string"},setup(e,{emit:a}){const n=ce({loader:()=>pe(()=>import("./BuilderSidebarToolkit-CzIYCBw7.js"),__vite__mapDeps([4,0,1,5,6,7,8]),import.meta.url)}),r=ce({loader:()=>pe(()=>import("./BuilderSidebarComponentTree-DMzfyj4y.js"),__vite__mapDeps([9,0,1,5,6,7,10]),import.meta.url)});function o(M){return typeof M=="string"&&["layers","add"].includes(M)}const s=W(F.core),i=W(F.builderManager),u=W(F.notesManager),f=a,k=S(()=>C()),{undo:_,redo:y,getUndoRedoSnapshot:C}=Re(s,i),l=S(()=>i.mode.value==="preview"),g="1.28.0rc2",h=Ct("activePane",o),c=O(l.value?void 0:h.value),b=S(()=>c.value!=="notes"?!1:u.selectedNoteId.value!==void 0);function I(){c.value==="notes"&&u.selectNote(void 0)}ae(c,()=>{u.isAnnotating.value=c.value==="notes"},{immediate:!0}),ae(l,()=>{l.value&&c.value}),ae(u.selectedNoteId,()=>{u.selectedNoteId.value&&(c.value="notes")});const m=S(()=>({layers:i.mode.value==="ui"?"Interface Layers":"Blueprint Layers",add:"Add block",notes:"Notes"})),w=rt();async function T(M){if(!(!(Fe()?M.metaKey:M.ctrlKey)||M.target.closest("textarea, input, select")))switch(M.key){case"l":M.preventDefault(),c.value="layers";break;case"Enter":M.preventDefault(),c.value="add";break}}const x=new AbortController;oe(()=>{document.addEventListener("keydown",T,{signal:x.signal})}),he(()=>x.abort());function E(M){c.value=c.value===M?void 0:M,h.value=c.value,u.selectNote(void 0),f("activePaneChanged",M)}return(M,U)=>(t(),v("div",mr,[d("div",_r,[l.value?$("",!0):(t(),v("div",yr,[U[6]||(U[6]=d("hr",null,null,-1)),B(Ae,{icon:"layers","data-writer-tooltip-placement":"right","data-writer-tooltip":`${m.value.layers} (${p(w)}L)`,active:c.value==="layers","data-automation-action":"sidebar-layers",onClick:U[0]||(U[0]=Y=>E("layers"))},null,8,["data-writer-tooltip","active"]),B(Ae,{icon:"wds-blocks","data-writer-tooltip-placement":"right","data-writer-tooltip":`${m.value.add} (${p(w)}Enter)`,active:c.value==="add","data-automation-action":"sidebar-add",onClick:U[1]||(U[1]=Y=>E("add"))},null,8,["data-writer-tooltip","active"]),p(s).isWriterCloudApp.value?(t(),P(Ae,{key:0,icon:"message-square","data-writer-tooltip-placement":"right","data-writer-tooltip":`${m.value.notes}`,active:c.value==="notes","data-automation-action":"sidebar-notes",onClick:U[2]||(U[2]=Y=>E("notes"))},null,8,["data-writer-tooltip","active"])):$("",!0)])),l.value?$("",!0):(t(),v("div",gr,[U[7]||(U[7]=d("hr",null,null,-1)),B(Ae,{icon:"undo-2","data-automation-key":"undo","data-writer-tooltip-placement":"right","data-writer-tooltip":`Undo (${p(w)}Z)`,disabled:!k.value.isUndoAvailable,onClick:U[3]||(U[3]=Y=>p(_)())},null,8,["data-writer-tooltip","disabled"]),B(Ae,{"data-automation-key":"redo","data-writer-tooltip-placement":"right","data-writer-tooltip":`Redo (${p(w)}Y)`,icon:"redo-2",disabled:!k.value.isRedoAvailable,onClick:U[4]||(U[4]=Y=>p(y)())},null,8,["data-writer-tooltip","disabled"])])),d("div",hr,[p(g)?(t(),P(Oo,{key:0,version:p(g)},null,8,["version"])):$("",!0),U[8]||(U[8]=d("hr",null,null,-1)),B(Ae,{target:"_blank",href:"https://dev.writer.com/agent-builder/overview",icon:"circle-question-mark","data-writer-tooltip-placement":"right","data-writer-tooltip":"Docs"})])]),c.value&&!l.value?(t(),v("div",br,[d("div",{class:K(["BuilderSidebar__pane__header",{"BuilderSidebar__pane__header--goBack":b.value}])},[b.value?(t(),v(j,{key:0},[B(te,{variant:"neutral",size:"smallIcon",onClick:I},{default:L(()=>[B(V,{name:"arrow-left"})]),_:1}),U[9]||(U[9]=d("h2",null,"Back",-1))],64)):(t(),v("h2",kr,N(m.value[c.value]),1)),B(te,{variant:"neutral",size:"smallIcon",onClick:U[5]||(U[5]=Y=>c.value=void 0)},{default:L(()=>[B(V,{name:"arrow-left-to-line"})]),_:1})],2),c.value==="add"?(t(),P(p(n),{key:0})):$("",!0),c.value==="layers"?(t(),P(p(r),{key:1})):$("",!0),c.value==="notes"?(t(),P(fr,{key:2})):$("",!0)])):$("",!0)]))}}),Sr=z(wr,[["__scopeId","data-v-bf0b63b3"]]),Br={class:"WdsToast__icon"},Cr=R({__name:"WdsToast",props:{type:{type:String,required:!0},message:{type:String,required:!0},closable:{type:Boolean},action:{type:Object,required:!1,default:void 0}},emits:{close:()=>!0},setup(e){const a=e,n=S(()=>{switch(a.type){case"info":return"info";case"success":return"check";case"error":return"x";default:return"circle-question-mark"}});return(r,o)=>(t(),v("div",{class:K(["WdsToast",`WdsToast--${e.type}`])},[d("div",Br,[e.type==="loading"?(t(),P(Zt,{key:0,size:18,color:"white"})):e.type==="info"?(t(),v(j,{key:1},[q("i")],64)):(t(),P(V,{key:2,name:n.value},null,8,["name"]))]),d("p",null,N(e.message),1),e.action?(t(),v("button",{key:0,class:"WdsToast__action",onClick:o[0]||(o[0]=(...s)=>e.action.func&&e.action.func(...s))},[q(N(e.action.label)+" ",1),e.type==="info"?(t(),v(j,{key:0},[q("i")],64)):(t(),P(V,{key:1,name:e.action.icon},null,8,["name"]))])):$("",!0),e.closable?(t(),P(te,{key:1,class:"WdsToast__close",variant:"neutral",size:"smallIcon",onClick:o[1]||(o[1]=s=>r.$emit("close"))},{default:L(()=>[B(V,{name:"x"})]),_:1})):$("",!0)],2))}}),$r=z(Cr,[["__scopeId","data-v-aa18760d"]]),Ir={class:"BuilderToasts"},Pr=R({__name:"BuilderToasts",setup(e){const{toasts:a,removeToast:n}=Ce();return(r,o)=>(t(),v("div",Ir,[B(Xt,{name:"list",tag:"div"},{default:L(()=>[(t(!0),v(j,null,ue(p(a),s=>(t(),P($r,{key:s.id,class:"BuilderToasts__toast",closable:s.closable,message:s.message,type:s.type,action:s.action,onClick:i=>s.closable!==!1?p(n)(s.id):void 0},null,8,["closable","message","type","action","onClick"]))),128))]),_:1})]))}}),Tr=z(Pr,[["__scopeId","data-v-915650dd"]]),Ar=200,xr=36,Dr=R({__name:"BuilderInstanceTracker",props:{instancePath:{},matchSize:{type:Boolean},verticalOffsetPixels:{},isOffBoundsAllowed:{type:Boolean},preventSettingsBarOverlap:{type:Boolean}},setup(e,{expose:a}){const n=e,{instancePath:r,matchSize:o,verticalOffsetPixels:s,isOffBoundsAllowed:i,preventSettingsBarOverlap:u}=Qt(n),f=De({});let k=0;const _=ie("rootEl");function y(c){const b=document.querySelector(".ComponentRenderer"),{top:I,left:m}=c.getBoundingClientRect(),{clientHeight:w}=document.body,{clientWidth:T}=b,{left:x}=b.getBoundingClientRect(),E=document.querySelector(".BuilderSettings"),{left:M}=(E==null?void 0:E.getBoundingClientRect())||{left:1/0};let{clientHeight:U,clientWidth:Y}=(o!=null&&o.value?c:_.value)??{};if(U===void 0||Y===void 0)return;let Q=s!=null&&s.value?s.value:0,X=m,J=I+Q;if(i.value||(X=Math.max(x,X),X=Math.min(x+T-Y,X),J=Math.max(xr,J),J=Math.min(w-U,J)),u.value){let de=0;X+Y>M&&(de=Math.max(X-(M-Y),0)),X-=de}f.value={display:"block",top:`${J}px`,left:`${X}px`,width:`${Y}px`,height:`${U}px`}}function C(){f.value={display:"none"}}function l(){let c=document.querySelector(`.ComponentRenderer [data-writer-instance-path="${r.value}"]`);if(!c){C();return}const b=getComputedStyle(c);if(!b){C();return}if(b.display=="contents"&&(c=c.querySelector("[data-writer-id]")),!c){C();return}y(c)}function g(){k=requestAnimationFrame(async()=>{l(),!h.signal.aborted&&(await new Promise(c=>setTimeout(c,Ar)),g())})}const h=Ee();return a({refresh:l}),oe(async()=>{window.addEventListener("scroll",l,{signal:h.signal}),g()}),he(()=>{cancelAnimationFrame(k)}),(c,b)=>(t(),v("div",{ref_key:"rootEl",ref:_,class:"BuilderInstanceTracker",style:Ne(f.value)},[le(c.$slots,"default",{},void 0,!0)],4))}}),Oe=z(Dr,[["__scopeId","data-v-c3e9e555"]]),Er={ref:"rootEl",class:"BuilderCollaborationTracker"},Mr={class:"bubble"},Lr={class:"main"},Fr=R({__name:"BuilderCollaborationTracker",setup(e){const a=W(F.collaborationManager);function n(r){return!(ea(r).length<=2)}return(r,o)=>(t(),v("div",Er,[(t(!0),v(j,null,ue(p(a).connectedUsersByInstancePath.value,(s,i)=>(t(),v(j,{key:i},[n(i)?(t(),P(Oe,{key:0,"is-off-bounds-allowed":!1,"instance-path":i,"vertical-offset-pixels":-32,class:"instanceTracker"},{default:L(()=>[d("div",Mr,[d("div",Lr,[(t(!0),v(j,null,ue(s,u=>(t(),P(ut,{key:u,"show-tooltip":!0,"user-id":u},null,8,["user-id"]))),128))]),o[0]||(o[0]=d("div",{class:"triangle"},null,-1))])]),_:2},1032,["instance-path"])):$("",!0)],64))),128))],512))}}),Nr=z(Fr,[["__scopeId","data-v-15c19d63"]]),Rr={class:"ShareResizeVertical__top"},Ur={class:"ShareResizeVertical__divider"},Wr={class:"ShareResizeVertical__bottom"},zr=R({__name:"ShareResizeVertical",props:{initialBottomSize:{type:Number,required:!0},disabled:{type:Boolean,required:!1}},setup(e){const a=e,n=ie("root"),r=Ee(),o=ta(a,"initialBottomSize");let s=O(o.value);ae(o,()=>s.value=o.value);const i=S(()=>({gridTemplateRows:`minmax(0px, 1fr) 1px ${s.value}px`}));function u(){if(!n.value)return;document.addEventListener("mousemove",k,{signal:r.signal}),document.addEventListener("mouseup",_,{signal:r.signal});const f=n.value.getBoundingClientRect();function k(y){s.value=f.bottom-y.clientY}function _(){document.removeEventListener("mouseup",_),document.removeEventListener("mousemove",k)}}return(f,k)=>(t(),v("div",{ref_key:"root",ref:n,class:"ShareResizeVertical",style:Ne(i.value)},[d("div",Rr,[le(f.$slots,"top",{},void 0,!0)]),d("div",Ur,[e.disabled?$("",!0):(t(),v("div",{key:0,class:"ShareResizeVertical__divider__hand",onMousedown:wt(u,["prevent"])},null,32))]),d("div",Wr,[le(f.$slots,"bottom",{},void 0,!0)])],4))}}),Vr=z(zr,[["__scopeId","data-v-0de30584"]]),Or=R({__name:"BuilderAppSocketTimeoutModal",setup(e){const a=W(F.socketTimeout),n=S(()=>[{desc:"Keep session awake",loading:a.reconnecting.value,fn:()=>{a.preventTasks.value.add("stayAwake"),a.reconnect()}},{desc:"Reconnect",loading:a.reconnecting.value,fn:()=>{a.reconnect()}}]),r=`Youâ€™ve been disconnected because you were inactive for ${a.timeoutMin} minutes. Click below to reconnect and pick up where you left off.`;return(o,s)=>p(a).socketClosed.value?(t(),P(Se,{key:0,title:"Session Expired",description:r,actions:n.value},null,8,["actions"])):$("",!0)}}),qr=4e3;function Kr(e,a){const n=a*60*1e3,r=it(),o=Ee();let s;const i=O(!1),u=O(!1),f=Ct("useSocketTimeout_preventTasks",m=>Array.isArray(m)&&m.every(w=>typeof w=="string")),k=O(new Set),_=S(()=>k.value.size>0);function y(m){k.value.has(m)?k.value.delete(m):k.value.add(m)}const C=new Set(["collaborationPing","listResources","keepAlive"]),l=S(()=>{for(const m of e.frontendMessageMap.value.values())if(!C.has(m.type))return!0;return!1}),g=S(()=>!_.value&&!l.value);function h(){return!g.value||document.visibilityState!=="hidden"?!1:(c(),r.log(`[SocketTimeout] planning timeout in ${a}min`),s=setTimeout(()=>{g.value&&(r.warn(`[SocketTimeout] Closing socket after ${a} minutes of inactivity (tab hidden)`),e.stopSync(qr),i.value=!0,r.info("[SocketTimeout] Socket closed"))},n),!0)}function c(){s&&(r.log("[SocketTimeout] canceling timeout "),clearTimeout(s),s=void 0)}ae(g,()=>{g.value?document.visibilityState==="hidden"&&h():c()}),ae(k,()=>{f.value=[...k.value]},{deep:!0}),ae(l,(m,w)=>{w&&!m&&document.visibilityState==="hidden"&&(r.log("[SocketTimeout] Preventing socket to be closed due to finished task in background..."),k.value.add("pendingMessageInBackground"))});async function b(){r.info("[SocketTimeout] Attempting to reconnect socket..."),u.value=!0;try{await e.init(),i.value=!1,r.info("[SocketTimeout] Socket reconnected successfully")}catch(m){r.error("[SocketTimeout] Failed to reconnect socket, reloading page",m),window.location.reload()}finally{u.value=!1}}function I(){document.visibilityState==="visible"?(k.value.delete("pendingMessageInBackground"),c()):g.value&&h()}return oe(()=>{f&&(k.value=new Set(f.value)),document.addEventListener("visibilitychange",I,{signal:o.signal})}),{timeoutMin:a,socketClosed:i,reconnecting:u,prevent:_,preventTasks:k,togglePreventTaskId:y,onVisibilityChange:I,clearSchedule:c,schedule:h,reconnect:b}}const jr={class:"BlueprintsNavigationStack","data-writer-unselectable":""},Hr={class:"BlueprintsNavigationStack_container"},Gr={class:"BlueprintsNavigationStack_title_prefix"},Yr={key:0},Jr=R({__name:"BlueprintsNavigationStack",setup(e){const a=W(F.core),n=W(F.builderManager),{component:r,definition:o}=aa(a,n.firstSelectedId),s=ye(a),i=S(()=>a.getCurrentPageInPageStack()),u=S(()=>{var h,c,b;return n.selection.value.length>1||!r.value||r.value.type==="blueprints_blueprint"?null:((c=(h=r.value)==null?void 0:h.content)==null?void 0:c.alias)||((b=o.value)==null?void 0:b.name)||"Unknown"});function f(h,c,b,I){return h?c!=null&&c.key?`${c.key} (${b})`:`Go to ${I} blueprint (${b})`:`(${b})`}const k=S(()=>{const h=Fe()?"âŒƒ-":"Ctrl+-";return f(a.canGoBackInPageStack(),a.getPreviousPageInPageStack(),h,"previous")}),_=S(()=>{const h=Fe()?"âŒƒâ‡§-":"Ctrl+Shift+-";return f(a.canGoForwardInPageStack(),a.getNextPageInPageStack(),h,"next")});function y(h,c){if(!(h==="forward"?a.canGoForwardInPageStack():a.canGoBackInPageStack()))return;c.preventDefault(),c.stopPropagation(),n.setSelection(null);const I=a.navigateInPageStack(null,h);I&&(n.mode.value=I.type==="blueprint"?"blueprints":"ui",n.setSelection(I.id,void 0,"click"),s.track("blueprints_navigation_stack_clicked",{direction:h,source:c instanceof MouseEvent?"click":"keyboard"}))}function C(h){y("forward",h)}function l(h){y("backward",h)}function g(h){h.ctrlKey&&(!h.shiftKey&&h.key==="-"?l(h):h.shiftKey&&(h.key==="_"||h.key==="-")&&C(h))}return oe(()=>{window.addEventListener("keydown",g)}),he(()=>{window.removeEventListener("keydown",g)}),(h,c)=>{var b,I,m;return t(),v("div",jr,[d("div",Hr,[B(te,{size:"smallIcon",variant:"tertiary",class:"BlueprintsNavigationStack_button",disabled:!p(a).canGoBackInPageStack(),"data-writer-tooltip-placement":"bottom","data-writer-unselectable":"","data-writer-tooltip":k.value,onClick:l},{default:L(()=>[B(V,{name:"chevron-left"})]),_:1},8,["disabled","data-writer-tooltip"]),B(te,{size:"smallIcon",variant:"tertiary",class:"BlueprintsNavigationStack_button",disabled:!p(a).canGoForwardInPageStack(),"data-writer-tooltip-placement":"bottom","data-writer-unselectable":"","data-writer-tooltip":_.value,onClick:C},{default:L(()=>[B(V,{name:"chevron-right"})]),_:1},8,["disabled","data-writer-tooltip"]),d("span",Gr,N(((b=i.value)==null?void 0:b.type)==="blueprint"?"Blueprint":"Page")+": ",1),d("div",null,N(((I=i.value)==null?void 0:I.key)??((m=i.value)==null?void 0:m.id)),1),u.value?(t(),v("div",Yr,"> "+N(u.value),1)):$("",!0)])])}}}),Zr=z(Jr,[["__scopeId","data-v-d2ec8303"]]),Xr={class:"builderMain"},Qr=R({__name:"BuilderApp",setup(e){pt(F.isAutogenModalShown,O(!1));const a=ce({loader:()=>pe(()=>import("./BuilderSettings-G-znf-iB.js").then(D=>D.a),__vite__mapDeps([11,0,1,12,5,6,13,14,15,16,17,18,19]),import.meta.url)}),n=ce({loader:()=>pe(()=>import("./ComponentRenderer-CqqiitL-.js"),__vite__mapDeps([20,0,1,21]),import.meta.url)}),r=ce({loader:()=>pe(()=>import("./BuilderInsertionOverlay-C0UeiiyW.js"),__vite__mapDeps([22,0,1,23]),import.meta.url)}),o=ce({loader:()=>pe(()=>import("./BuilderInsertionLabel-Dg7795FO.js"),__vite__mapDeps([24,0,1,25]),import.meta.url)}),s=ce({loader:()=>pe(()=>import("./BuilderVault-DIVf2hoI.js"),__vite__mapDeps([26,18,0,1,16,17,27]),import.meta.url)}),i=ce({loader:()=>pe(()=>import("./BuilderJournal-CjO99tYJ.js"),__vite__mapDeps([28,0,1,14,15,29,12,5,6,13,30,31]),import.meta.url)}),u=W(F.core),f=W(F.builderManager),k=W(F.notesManager),_=W(F.collaborationManager),y=ye(u),C=Ce(),l=Number(localStorage.getItem("socketTimeoutMin"))||10;pt(F.socketTimeout,Kr(u,l));const g=ie("noteEl"),h=ie("rendererEl"),c=ie("rendererWrapperEl");function b(){if(g.value!=null&&typeof g.value[Symbol.iterator]=="function")for(const ee of g.value)ee.refresh()}const{candidateId:I,candidateInstancePath:m,isCandidacyConfirmed:w,dropComponent:T,assignInsertionCandidacy:x,removeInsertionCandidacy:E}=la(u),{createAndInsertComponent:M,undo:U,redo:Y,moveComponent:Q,moveComponentUp:X,moveComponentDown:J,cutComponent:de,isPasteAllowed:be,isCopyAllowed:ve,isCutAllowed:ge,isDeleteAllowed:je,isGoToParentAllowed:Ue,isGoToChildAllowed:He,isGoToNextSiblingAllowed:fe,isGoToPrevSiblingAllowed:Ge,pasteComponent:We,copyComponent:Ye,removeComponentsSubtree:ze,goToParent:Me,goToChild:$e,goToNextSibling:Je,goToPrevSibling:Ze,moveComponentToParent:Xe,moveComponentInsideNextSibling:Qe}=Re(u,f,y),Z=f.mode,et=f.firstSelectedId,Ve=S(()=>f.openPanels.value.size>0),A=S(()=>Array.from(k.getNotes(u.activePageId.value)).map(D=>({...D,parentInstancePath:k.useNoteInformation(D).parentInstancePath.value})).filter(D=>D.parentInstancePath!==void 0));async function H(D){if(D.key==="Escape"){f.setSelection(null),f.expandedEditorForComponent.value=null;return}const ee=Fe()?D.metaKey:D.ctrlKey;if(D.target.closest("textarea, input, select, [contenteditable]"))return;if(D.key==="z"&&ee){D.preventDefault(),U();return}if(D.key==="y"&&ee){D.preventDefault(),Y();return}if(!f.isSingleSelectionActive.value||!f.firstSelectedItem.value)return;const{componentId:G,instancePath:Ie}=f.firstSelectedItem.value;if(D.key===(Fe()?"Backspace":"Delete")){const ke=f.selection.value.filter(Pe=>je(Pe.componentId)).map(Pe=>Pe.componentId);ze(...ke);return}if(ee)if(D.shiftKey)switch(D.key){case"ArrowDown":D.preventDefault(),fe(G)&&Je(G);break;case"ArrowUp":D.preventDefault(),Ge(G)&&Ze(G);break;case"ArrowLeft":D.preventDefault(),Ue(G)&&Me(G,Ie);break;case"ArrowRight":D.preventDefault(),He(G)&&$e(G);break}else switch(D.key){case"ArrowDown":D.preventDefault(),J(G);break;case"ArrowUp":D.preventDefault(),X(G);break;case"ArrowLeft":D.preventDefault(),Xe(G);break;case"ArrowRight":D.preventDefault(),Qe(G);break;case"v":if(!be(G))return;try{await We(G)}catch(ke){C.pushToast({type:"error",message:String(ke)})}break;case"c":ve(G)&&Ye(G);break;case"x":ge(G)&&de(G);break}}function re(D){Z.value!=="preview"&&x(D)}function tt(D){if(Z.value==="preview")return;f.setSelection(null);const ee=T(D);if(!ee)return;const{draggedType:ne,draggedId:G,parentId:Ie,position:ke}=ee;G?Q(G,Ie,ke):M(ne,Ie,ke)}function at(D){if(Z.value==="preview"||D.target.closest("[data-writer-unselectable]"))return;if(Z.value==="blueprints"&&f.selectionStatus.value===ot.Multiple){const Pe=D.target.closest("[data-writer-id]");if(Pe&&f.isComponentIdSelected(Pe.dataset.writerId)){D.preventDefault(),D.stopPropagation();return}}const ne=D.target.closest("[data-writer-id]");if(!ne)return;const G=ne.dataset.writerId,Ie=ne.dataset.writerInstancePath;f.isComponentIdSelected(G)&&f.selectionStatus.value!==ot.Multiple||k.isAnnotating.value||(D.preventDefault(),D.stopPropagation(),f.handleSelectionFromEvent(D,G,Ie,"click"))}function At(){f.isSettingsBarCollapsed.value=!1}const xt=D=>{if(Z.value==="preview")return;const ee=D.target.closest("[data-writer-id]");if(!ee)return;const ne=ee.dataset.writerId;if(!ne)return;const{type:G}=u.getComponentById(ne);f.selectionStatus.value===ot.Multiple&&(f.setSelection(ne,void 0,"click"),f.isSettingsBarCollapsed.value=!0),D.dataTransfer.setData(`application/json;writer=${G},${ne}`,"{}")};function Dt(D){f.setSelection(null),E(D)}const dt=new AbortController;return ae(f.selection,()=>{_&&(_.updateOutgoingPing({action:"select",selection:f.selection.value}),_.sendCollaborationPing())}),oe(()=>{document.addEventListener("keydown",H,{signal:dt.signal})}),he(()=>{dt.abort()}),(D,ee)=>(t(),v("div",{class:"BuilderApp",tabindex:"-1",style:Ne(p(ra))},[d("div",{class:K(["mainGrid",{openPanels:p(f).openPanels.value.size>0}])},[B(Ra,{class:"builderHeader"}),me(B(Sr,{class:"sidebar",onActivePaneChanged:b},null,512),[[Be,p(Z)==="ui"||p(Z)==="blueprints"]]),B(Vr,{"initial-bottom-size":Ve.value?440:48,disabled:!Ve.value,class:K({"mainGrid--fullWidth":p(Z)==="preview"||p(Z)==="vault"||p(Z)==="journal"})},{top:L(()=>[d("div",Xr,[me(B(Zr,null,null,512),[[Be,p(Z)==="ui"||p(Z)==="blueprints"]]),p(Z)==="vault"?(t(),P(p(s),{key:0})):$("",!0),(t(),P(na,null,[p(Z)==="journal"?(t(),P(p(i),{key:0})):$("",!0)],1024)),p(Z)!=="vault"&&p(Z)!=="journal"?(t(),v("div",{key:1,ref_key:"rendererWrapperEl",ref:c,class:K(["rendererWrapper",{addNoteCursor:p(k).isAnnotating.value&&p(f).mode.value!=="preview"}]),onScroll:b},[B(p(n),{ref_key:"rendererEl",ref:h,class:K(["componentRenderer",{settingsOpen:p(f).isSingleSelectionActive}]),onDragover:re,onDragstart:xt,onDragend:Dt,onDrop:tt,onClickCapture:at,onDblclick:At},null,8,["class"])],34)):$("",!0),p(f).isSingleSelectionActive&&p(Z)!=="journal"&&p(Z)!=="vault"?(t(),P(p(a),{key:p(et)??"noneSelected"})):$("",!0)])]),bottom:L(()=>[B(Fo,{class:"panelSwitcher"})]),_:1},8,["initial-bottom-size","disabled","class"])],2),p(Z)!=="preview"?(t(),v(j,{key:0},[B(Nr,{class:"collaborationTracker"}),p(I)&&!p(w)?(t(),v(j,{key:0},[(t(),P(Oe,{key:p(m),class:"insertionOverlayTracker","is-off-bounds-allowed":!0,"instance-path":p(m),"match-size":!0},{default:L(()=>[B(p(r))]),_:1},8,["instance-path"])),(t(),P(Oe,{key:p(m),class:"insertionLabelTracker","instance-path":p(m),"vertical-offset-pixels":-48},{default:L(()=>[B(p(o),null,{default:L(()=>[q(N(p(u).getComponentDefinition(p(u).getComponentById(p(I)).type).name),1)]),_:1})]),_:1},8,["instance-path"]))],64)):$("",!0)],64)):$("",!0),p(Z)==="ui"?(t(!0),v(j,{key:1},ue(A.value,ne=>(t(),P(Oe,{key:ne.id,ref_for:!0,ref_key:"noteEl",ref:g,class:"BuilderApp__noteTracker","is-off-bounds-allowed":!0,"instance-path":ne.parentInstancePath,"match-size":!0},{default:L(()=>[B(oa,{class:"BuilderApp__noteTracker__note","component-id":ne.id},null,8,["component-id"])]),_:2},1032,["instance-path"]))),128)):$("",!0),ee[0]||(ee[0]=d("div",{id:"modal"},null,-1)),ee[1]||(ee[1]=d("div",{id:"drawer"},null,-1)),B(Or),B(Oa,{id:"tooltip"}),B(Tr)],4))}}),el=z(Qr,[["__scopeId","data-v-f59230c5"]]),ol=Object.freeze(Object.defineProperty({__proto__:null,default:el},Symbol.toStringTag,{value:"Module"}));export{Ho as B,Tt as W,rn as a,lo as b,ol as c,_a as u};
//# sourceMappingURL=BuilderApp-DhqlqS0y.js.map
