{"version":3,"file":"index-BYScS2mV.js","sources":["../../../ui/src/observability/launchDarklyAdapter.ts","../../../ui/src/observability/index.ts"],"sourcesContent":["import type {\n\tIncrementMetricOptions,\n\tObservabilityProvider,\n\tRecordDistributionOptions,\n} from \"./base\";\nimport { LDObserve } from \"@launchdarkly/observability\";\nimport { useLogger } from \"@/composables/useLogger\";\n\nconst logger = useLogger();\n\nexport class LaunchDarklyAdapter implements ObservabilityProvider {\n\tprivate initialized = false;\n\tprivate ldObserve: typeof LDObserve;\n\n\tisEnabled(): boolean {\n\t\treturn typeof LDObserve !== \"undefined\";\n\t}\n\n\tgetName(): string {\n\t\treturn \"launchdarkly\";\n\t}\n\n\tasync initialize(_app?: unknown, _router?: unknown): Promise<boolean> {\n\t\tif (this.initialized) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (!this.isEnabled()) {\n\t\t\tlogger.info(\n\t\t\t\t\"LaunchDarkly client ID not provided, skipping LaunchDarkly initialization\",\n\t\t\t);\n\t\t\treturn false;\n\t\t}\n\n\t\ttry {\n\t\t\tthis.ldObserve = LDObserve;\n\t\t\tthis.initialized = true;\n\t\t\treturn true;\n\t\t} catch (error) {\n\t\t\tlogger.warn(\n\t\t\t\t\"Failed to initialize LaunchDarkly observability adapter:\",\n\t\t\t\terror,\n\t\t\t);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tincrementMetric(name: string, options?: IncrementMetricOptions): void {\n\t\tif (!this.initialized) return;\n\t\ttry {\n\t\t\tthis.ldObserve.recordIncr({\n\t\t\t\tname,\n\t\t\t\tattributes: options?.tags,\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tlogger.warn(`Failed to increment metric ${name}:`, e);\n\t\t}\n\t}\n\n\trecordDistribution(\n\t\tname: string,\n\t\tvalue: number,\n\t\toptions?: RecordDistributionOptions,\n\t): void {\n\t\tif (!this.initialized) return;\n\t\ttry {\n\t\t\tthis.ldObserve.recordHistogram({\n\t\t\t\tname,\n\t\t\t\tvalue,\n\t\t\t\tattributes: options?.tags,\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tlogger.warn(`Failed to record distribution ${name}:`, e);\n\t\t}\n\t}\n\n\tsetGauge(\n\t\tname: string,\n\t\tvalue: number,\n\t\toptions?: RecordDistributionOptions,\n\t): void {\n\t\tif (!this.initialized) return;\n\t\ttry {\n\t\t\tthis.ldObserve.recordGauge({\n\t\t\t\tname,\n\t\t\t\tvalue,\n\t\t\t\tattributes: options?.tags,\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tlogger.warn(`Failed to set gauge ${name}:`, e);\n\t\t}\n\t}\n\n\tcaptureException(\n\t\terror: Error | string,\n\t\tcontext?: Record<string, unknown>,\n\t): void {\n\t\tif (!this.initialized) {\n\t\t\treturn;\n\t\t}\n\t\ttry {\n\t\t\tconst errorObj = error instanceof Error ? error : new Error(error);\n\n\t\t\tconst payload: Record<string, string> = {};\n\t\t\tif (context) {\n\t\t\t\tfor (const [key, value] of Object.entries(context)) {\n\t\t\t\t\tpayload[key] = String(value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (context?.source) {\n\t\t\t\tpayload.source = String(context.source);\n\t\t\t}\n\t\t\tif (context?.errorType) {\n\t\t\t\tpayload.errorType = String(context.errorType);\n\t\t\t} else if (errorObj.name) {\n\t\t\t\tpayload.errorType = errorObj.name;\n\t\t\t}\n\n\t\t\tthis.ldObserve.recordError(\n\t\t\t\terrorObj,\n\t\t\t\terrorObj.message || String(error),\n\t\t\t\tObject.keys(payload).length > 0 ? payload : undefined,\n\t\t\t);\n\t\t} catch (e) {\n\t\t\tlogger.warn(\"[LaunchDarkly] Failed to capture exception:\", e);\n\t\t}\n\t}\n\n\tcaptureMessage(\n\t\tmessage: string,\n\t\tlevel?: \"info\" | \"warning\" | \"error\",\n\t\tcontext?: Record<string, unknown>,\n\t): void {\n\t\tif (!this.initialized) return;\n\t\ttry {\n\t\t\tif (level === \"error\") {\n\t\t\t\tconst payload: Record<string, string> = {};\n\t\t\t\tif (context) {\n\t\t\t\t\tfor (const [key, value] of Object.entries(context)) {\n\t\t\t\t\t\tpayload[key] = String(value);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.ldObserve.recordError(\n\t\t\t\t\tnew Error(message),\n\t\t\t\t\tmessage,\n\t\t\t\t\tObject.keys(payload).length > 0 ? payload : undefined,\n\t\t\t\t);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tlogger.warn(\"Failed to capture message:\", e);\n\t\t}\n\t}\n\n\t/**\n\t * Required by ObservabilityProvider interface, but LaunchDarkly manages\n\t * user context differently. Context is set during client initialization\n\t * via buildLDContext() and initializeLaunchDarkly() in launchDarklyClient.ts.\n\t * This method is a no-op to satisfy the interface contract.\n\t */\n\tsetUser(_user: {\n\t\tid?: string;\n\t\temail?: string;\n\t\tusername?: string;\n\t\t[key: string]: unknown;\n\t}): void {\n\t\t// LaunchDarkly context is set during client initialization\n\t}\n\n\t/**\n\t * Required by ObservabilityProvider interface, but LaunchDarkly manages\n\t * context differently. Context is set during client initialization\n\t * via buildLDContext() and initializeLaunchDarkly() in launchDarklyClient.ts.\n\t * This method is a no-op to satisfy the interface contract.\n\t */\n\tsetContext(_key: string, _value: unknown): void {\n\t\t// LaunchDarkly context is set during client initialization\n\t}\n}\n","import { observabilityRegistry } from \"./base\";\nimport { LaunchDarklyAdapter } from \"./launchDarklyAdapter\";\n\nexport type { ObservabilityProvider } from \"./base\";\nexport { ObservabilityRegistry, observabilityRegistry } from \"./base\";\nexport { LaunchDarklyAdapter } from \"./launchDarklyAdapter\";\nexport {\n\ttrackError,\n\tincrementMetric,\n\trecordDistribution,\n\tsetGauge,\n\tMETRIC_NAMES,\n\tflushMetricQueue,\n} from \"./frontendMetrics\";\n\ntry {\n\tobservabilityRegistry.register(\"launchdarkly\", new LaunchDarklyAdapter());\n} catch (error) {\n\t// eslint-disable-next-line no-console\n\tconsole.debug(\"LaunchDarkly adapter not available:\", error);\n}\n"],"names":["logger","useLogger","LaunchDarklyAdapter","__publicField","LDObserve","_app","_router","error","name","options","e","value","context","errorObj","payload","key","message","level","_user","_key","_value","observabilityRegistry"],"mappings":"yWAQA,MAAMA,EAASC,EAAU,EAElB,MAAMC,CAAqD,CAA3D,cACEC,EAAA,mBAAc,IACdA,EAAA,kBAER,WAAqB,CACpB,OAAO,OAAOC,EAAc,GAC7B,CAEA,SAAkB,CACV,MAAA,cACR,CAEA,MAAM,WAAWC,EAAgBC,EAAqC,CACrE,GAAI,KAAK,YACD,MAAA,GAGJ,GAAA,CAAC,KAAK,YACF,OAAAN,EAAA,KACN,2EAAA,EAEM,GAGJ,GAAA,CACH,YAAK,UAAYI,EACjB,KAAK,YAAc,GACZ,SACCG,EAAO,CACR,OAAAP,EAAA,KACN,2DACAO,CAAA,EAEM,EACR,CACD,CAEA,gBAAgBC,EAAcC,EAAwC,CACrE,GAAK,KAAK,YACN,GAAA,CACH,KAAK,UAAU,WAAW,CACzB,KAAAD,EACA,WAAYC,GAAA,YAAAA,EAAS,IAAA,CACrB,QACOC,EAAG,CACXV,EAAO,KAAK,8BAA8BQ,CAAI,IAAKE,CAAC,CACrD,CACD,CAEA,mBACCF,EACAG,EACAF,EACO,CACP,GAAK,KAAK,YACN,GAAA,CACH,KAAK,UAAU,gBAAgB,CAC9B,KAAAD,EACA,MAAAG,EACA,WAAYF,GAAA,YAAAA,EAAS,IAAA,CACrB,QACOC,EAAG,CACXV,EAAO,KAAK,iCAAiCQ,CAAI,IAAKE,CAAC,CACxD,CACD,CAEA,SACCF,EACAG,EACAF,EACO,CACP,GAAK,KAAK,YACN,GAAA,CACH,KAAK,UAAU,YAAY,CAC1B,KAAAD,EACA,MAAAG,EACA,WAAYF,GAAA,YAAAA,EAAS,IAAA,CACrB,QACOC,EAAG,CACXV,EAAO,KAAK,uBAAuBQ,CAAI,IAAKE,CAAC,CAC9C,CACD,CAEA,iBACCH,EACAK,EACO,CACH,GAAC,KAAK,YAGN,GAAA,CACH,MAAMC,EAAWN,aAAiB,MAAQA,EAAQ,IAAI,MAAMA,CAAK,EAE3DO,EAAkC,CAAA,EACxC,GAAIF,EACH,SAAW,CAACG,EAAKJ,CAAK,IAAK,OAAO,QAAQC,CAAO,EACxCE,EAAAC,CAAG,EAAI,OAAOJ,CAAK,EAIzBC,GAAA,MAAAA,EAAS,SACJE,EAAA,OAAS,OAAOF,EAAQ,MAAM,GAEnCA,GAAA,MAAAA,EAAS,UACJE,EAAA,UAAY,OAAOF,EAAQ,SAAS,EAClCC,EAAS,OACnBC,EAAQ,UAAYD,EAAS,MAG9B,KAAK,UAAU,YACdA,EACAA,EAAS,SAAW,OAAON,CAAK,EAChC,OAAO,KAAKO,CAAO,EAAE,OAAS,EAAIA,EAAU,MAAA,QAErCJ,EAAG,CACJV,EAAA,KAAK,8CAA+CU,CAAC,CAC7D,CACD,CAEA,eACCM,EACAC,EACAL,EACO,CACP,GAAK,KAAK,YACN,GAAA,CACH,GAAIK,IAAU,QAAS,CACtB,MAAMH,EAAkC,CAAA,EACxC,GAAIF,EACH,SAAW,CAACG,EAAKJ,CAAK,IAAK,OAAO,QAAQC,CAAO,EACxCE,EAAAC,CAAG,EAAI,OAAOJ,CAAK,EAI7B,KAAK,UAAU,YACd,IAAI,MAAMK,CAAO,EACjBA,EACA,OAAO,KAAKF,CAAO,EAAE,OAAS,EAAIA,EAAU,MAAA,CAE9C,QACQJ,EAAG,CACJV,EAAA,KAAK,6BAA8BU,CAAC,CAC5C,CACD,CAQA,QAAQQ,EAKC,CAET,CAQA,WAAWC,EAAcC,EAAuB,CAEhD,CACD,CCpKA,GAAI,CACHC,EAAsB,SAAS,eAAgB,IAAInB,CAAqB,CACzE,OAASK,EAAO,CAEP,QAAA,MAAM,sCAAuCA,CAAK,CAC3D"}