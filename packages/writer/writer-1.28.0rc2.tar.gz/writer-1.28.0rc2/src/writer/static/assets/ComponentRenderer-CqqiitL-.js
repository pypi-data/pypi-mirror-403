import{d as j,i as M,a as p,c as v,o as k,b as J,B as _e,e as he,f as O,g,t as A,h as ye,u as Ce,C as ee,r as W,j as be,p as T,w as X,F as Se,k as D,l as oe,_ as Q,m as Ee,n as Ie,q as ae,s as te,v as ne,x as L,y as Y,z as Pe,A as Me,W as Te,D as we,E as $e,G as re,H as ke,I as Be,J as De,K as Ae,L as Re,M as Ve,N as xe,O as Le,P as G,Q as se}from"./index-C1IizHaQ.js";const Oe=10,We=j({__name:"ChildlessPlaceholder",props:{componentId:{type:String,required:!0}},setup(y){const s=M(p.core),l=y,C=(r,d)=>{const S=r.map(m=>s.getComponentDefinition(m)).map(m=>m==null?void 0:m.name);return`${S.slice(0,-1).join(", ")} ${S.length>1?d:""} ${S.at(-1)}`},c=v(()=>{const r=s.getContainableTypes(l.componentId);let d;return r.length<=Oe&&(d=`You can add ${C(r,"and")} components`),d});return(r,d)=>(k(),J(_e,{class:"ChildlessPlaceholder","component-id":y.componentId,message:c.value},null,8,["component-id","message"]))}}),qe=["draggable"],Fe={class:"title"},He={class:"message"},je=j({__name:"RenderError",props:{componentType:{type:String,required:!0},message:{type:String,required:!0},draggable:{type:Boolean,required:!1}},setup(y){const s=M(p.core),l=M(p.componentId),C=v(()=>s.getComponentById(l)),c=v(()=>{var d;return s.getComponentById((d=C.value)==null?void 0:d.parentId)}),r=v(()=>{var d;return((d=c.value)==null?void 0:d.type)==="blueprints_blueprint"});return(d,u)=>r.value?(k(),J(he,{key:0,draggable:!1})):(k(),O("div",{key:1,class:"RenderError",draggable:y.draggable},[g("div",Fe,[g("h2",null,"Error rendering "+A(y.componentType),1)]),g("div",He,A(y.message),1)],8,qe))}}),ze={props:{componentId:{type:String,required:!0},instancePath:{type:Array,required:!0},instanceData:{type:Array,required:!0}},setup(y){const s=M(p.core),l=M(p.builderManager),C=M(p.secretsManager),c=y.componentId,r=v(()=>s.getComponentById(c)),d=ye(r.value.type),u=y.instancePath,S=y.instanceData,{getEvaluatedFields:E,isComponentVisible:m}=oe(s,C),b=E(u),R=Ce(s),V=v(()=>s.getComponents(c,{sortedByPosition:!0}).filter(t=>{var o;return((o=s.getComponentDefinition(t.type))==null?void 0:o.category)!=="Internal"})),w=v(()=>!!l&&l.getMode()!="preview"),z=v(()=>{var t;return w.value&&!r.value.isCodeManaged&&!ee.has(r.value.type)&&((t=K.value)==null?void 0:t.toolkit)!=="blueprints"}),q=(t,o)=>(t?s.getContainableTypes(t):[...ee]).includes(o),e=W(!1),n=()=>{if(!(V.value.length>0))return D(We,{componentId:r.value.id})},a=(t,o=0,i)=>D(ie,{componentId:t,key:`${t}:${o}`,instancePath:[...u,{componentId:t,instanceNumber:o}],instanceData:[...S,W(null)],...i??{}}),f=t=>o=>{if(!q(c,o.type)&&t==="default")return!0;const _=s.getComponentDefinition(o.type).slot??"default";return _==="*"||_===t},$=(t=0,o="default",i=()=>!0,_=!1)=>{const I=h=>!w.value||_?[]:[D("div",{"data-writer-slot-of-id":c,"data-writer-position":h})],P=V.value.filter(f(o)).filter(i),B=P.filter(h=>!h.isCodeManaged).map(h=>a(h.id,t,{contextSlot:o})),F=P.filter(h=>h.isCodeManaged).map(h=>a(h.id,t,{contextSlot:o}));return[...I(0),...B.map((h,H)=>[h,I(H+1)]).flat(),...F]},x=be(u);T(p.evaluatedFields,b),T(p.componentId,c),T(p.isBeingEdited,w),T(p.isDisabled,e),T(p.instancePath,u),T(p.instanceData,S),T(p.renderProxiedComponent,a),T(p.getChildrenVNodes,$),T(p.flattenedInstancePath,x);const le={"data-writer-id":c,"data-writer-instance-path":x},K=v(()=>s.getComponentDefinition(r.value.type)),N=v(()=>{var t;return(t=K.value)==null?void 0:t.fields}),U=W(!1);X(()=>l==null?void 0:l.isComponentIdSelected(c),t=>{U.value=t},{immediate:!0});const ce=v(()=>Object.entries(N.value??{}).filter(([,t])=>t.category===Se.Style).reduce((t,[o])=>(t[o]=b[o].value,t),{}));X(ce,()=>{U.value=!1,R.track("ui_block_styles_updated")});const Z=v(()=>V.value.length==0),de=v(()=>m(c,u)),ue=(t,o)=>{if((!t||!(t!=null&&t.startsWith("$goToPage_")))&&!o)return _=>{s.forwardEvent(_,u,!0)};if(t!=null&&t.startsWith("$goToPage_")){const _=t.substring(10);return I=>s.setActivePageFromKey(_)}return null},pe=v(()=>{const t={};return Object.keys(K.value.events??{}).forEach(i=>{var P;const _=`on${i.charAt(0).toUpperCase()}${i.slice(1)}`,I=i===((P=r.value.binding)==null?void 0:P.eventType);t[_]=B=>{var h,H;I&&s.forwardEvent(B,u,!0);const F=((h=r.value.handlers)==null?void 0:h[i])??null;(H=ue(F,I))==null||H(B)}}),t}),ve=v(()=>{const t=N.value;if(!t)return;const o={};return Object.keys(t).forEach(i=>{t[i].applyStyleVariable&&b[i]&&(o[`--${i}`]=b[i].value)}),o}),me=v(()=>{const t="cssClasses",o=N.value;if(!o||!o[t]||!b[t])return;const i=String(b[t].value),_=i==null?void 0:i.split(" ").map(P=>P.trim()),I={};return _.forEach(P=>{I[P]=!0}),I}),fe=function(){return{class:{[`wf-type-${r.value.type}`]:!0,component:!0,childless:Z.value,selected:U.value,disabled:e.value,beingEdited:w.value,...me.value},style:{...ve.value,...de.value?{}:{display:"none"}},...le,...e.value?[]:pe.value,draggable:z.value}},ge=(t,o)=>w.value?D(je,{...t,componentType:r.value.type,message:o}):D("div");return()=>{const t=w.value?n():void 0,o=({instanceNumber:_=0,slotName:I="default",componentFilter:P=()=>!0,positionlessSlot:B=!1})=>Z.value?B?void 0:t:$(_,I,P,B),i=fe();return q(r.value.parentId,r.value.type)?D(d,i,{default:o}):ge(i,"Parent is not suitable for this component")}}},ie=Q(ze,[["__scopeId","data-v-683afb33"]]),Ke={class:"counter"},Ne={class:"main"},Ue={class:"clearContainer"},Ye={class:"content"},Ge={class:"title"},Xe={class:"time"},Je={class:"message"},Qe=100,Ze=j({__name:"RendererNotifications",setup(y){const s=M(p.core),l=W(!1),C=Ee("balloon"),c=Ie([]),r=S=>{const{type:E,title:m,message:b,code:R}=S;c.unshift({type:E,title:m,message:b,code:R,timestampReceived:new Date}),c.splice(Qe),C.value.classList.remove("alert"),C.value.offsetWidth,C.value.classList.add("alert")};ae(()=>{s.addMailSubscription("notification",r)});const d=()=>{c.length!=0&&(l.value=!l.value)},u=()=>{c.splice(0),l.value=!1};return(S,E)=>te((k(),O("div",{class:"RendererNotifications colorTransformer",onClick:d},[g("div",{ref_key:"balloon",ref:C,class:"balloon",title:"Toggle notifications"},[L(Y,{name:"bell"}),g("div",Ke,A(c.length),1)],512),E[1]||(E[1]=g("div",{class:"balloonFlash"},null,-1)),te(g("div",Ne,[g("div",Ue,[L(Te,{onClick:u},{default:Pe(()=>[L(Y,{name:"trash-2"}),E[0]||(E[0]=Me(" Clear all "))]),_:1})]),(k(!0),O(we,null,$e(c,(m,b)=>(k(),O("div",{key:b,class:"notification"},[g("div",{class:re(["icon",m.type])},[L(Y,{name:"triangle-alert"})],2),g("div",Ye,[g("header",null,[g("strong",Ge,A(m.title),1),g("span",Xe,A(m.timestampReceived.toLocaleTimeString()),1)]),g("div",Je,A(m.message),1)])]))),128))],512),[[ne,l.value]])],512)),[[ne,c.length>0]])}}),et=Q(Ze,[["__scopeId","data-v-758218e7"]]),tt={class:"rootComponentArea"},nt=j({__name:"ComponentRenderer",setup(y){const s=M(p.core),l=M(p.builderManager),C=M(p.secretsManager),c=oe(s,C),r={},d=v(()=>(l==null?void 0:l.activeRootId.value)??"root"),u=c.getEvaluatedFields([{componentId:"root",instanceNumber:0}]),S=v(()=>{var e,n,a,f,$,x;return{...ke,"--accentColor":(e=u.accentColor)==null?void 0:e.value,"--emptinessColor":(n=u.emptinessColor)==null?void 0:n.value,"--containerBackgroundColor":(a=u.parentIdBackgroundColor)==null?void 0:a.value,"--primaryTextColor":(f=u.primaryTextColor)==null?void 0:f.value,"--secondaryTextColor":($=u.secondaryTextColor)==null?void 0:$.value,"--separatorColor":(x=u.separatorColor)==null?void 0:x.value}}),E=v(()=>s.frontendMessageMap.value.size>0);X(()=>{var e;return(e=u.appName)==null?void 0:e.value},e=>{e!=""&&m(e)},{immediate:!0});function m(e){const n=s.mode.value;let a;e&&n=="edit"?a=`${e} | Writer | Builder`:!e&&n=="edit"?a="Writer | Builder":e&&n=="run"?a=`${e}`:!e&&n=="run"&&(a="Writer"),document.title=a}async function b(e,n){const a=document.querySelector(`[data-writer-stylesheet-key="${e}"]`);a==null||a.remove();const f=document.createElement("link");f.dataset.writerStylesheetKey=e,f.setAttribute("href",G(n)),f.setAttribute("rel","stylesheet"),document.head.appendChild(f)}async function R(e,n){const a=document.querySelector(`[data-writer-script-key="${e}"]`);a==null||a.remove();const f=document.createElement("script");f.dataset.writerScriptKey=e,f.src=G(n),f.setAttribute("rel","modulepreload"),document.head.appendChild(f)}async function V(e,n){const a=G(n);r[e]=a,await se(()=>import(a),[],import.meta.url)}async function w(e,n,a){const f=r[e],$=await se(()=>import(f),[],import.meta.url);if(!$){console.warn(`The module with key "${e}" cannot be found. Please check that it has been imported.`);return}$[n](...a)}function z(){s.addMailSubscription("fileDownload",e=>{const n=document.createElement("a");n.href=e.data,n.download=e.fileName,n.click()}),s.addMailSubscription("openUrl",e=>{const n=document.createElement("a");n.href=e,n.target="_blank",n.rel="noopener noreferrer",n.click()}),s.addMailSubscription("pageChange",async e=>{(l==null?void 0:l.getMode())==="blueprints"&&l.setMode("ui"),await Re(),Ve(e),s.setActivePageFromKey(e)}),s.addMailSubscription("routeVarsChange",e=>{xe(e)}),s.addMailSubscription("importStylesheet",({stylesheetKey:e,path:n})=>{b(e,n)}),s.addMailSubscription("importScript",({scriptKey:e,path:n})=>{R(e,n)}),s.addMailSubscription("importModule",({moduleKey:e,specifier:n})=>{V(e,n)}),s.addMailSubscription("functionCall",({moduleKey:e,functionName:n,args:a})=>{w(e,n,a)})}function q(){const e=Le(),n=new CustomEvent("wf-app-open",{detail:{payload:e}}),a={componentId:"root",instanceNumber:0};s.forwardEvent(n,[a],!0)}return Be(()=>{z()}),ae(()=>{q()}),(e,n)=>(k(),O("main",{class:re(["ComponentRenderer",{loadingActive:E.value}]),tabindex:"-1",style:Ae(S.value)},[L(et,{class:"notifications"}),n[0]||(n[0]=g("div",{class:"loadingBar"},null,-1)),g("div",tt,[(k(),J(ie,{key:d.value,"component-id":d.value,"instance-path":[{componentId:d.value,instanceNumber:0}],"instance-data":[W(null)]},null,8,["component-id","instance-path","instance-data"])),De(e.$slots,"default",{},void 0,!0)])],6))}}),ot=Q(nt,[["__scopeId","data-v-af7e67a2"]]);export{ot as default};
//# sourceMappingURL=ComponentRenderer-CqqiitL-.js.map
