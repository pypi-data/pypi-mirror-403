{"version":3,"file":"BuilderBlueprintLibraryPanel-DXlhbCL9.js","sources":["../../../ui/src/builder/panels/BuilderBlueprintLibraryItem.vue","../../../ui/src/builder/panels/BuilderBlueprintLibraryPanel.vue"],"sourcesContent":["<template>\n\t<div class=\"BuilderBlueprintLibraryItem\">\n\t\t<div class=\"BuilderBlueprintLibraryItem__header\">\n\t\t\t<h3 class=\"BuilderBlueprintLibraryItem__title\">\n\t\t\t\t{{ block.title }}\n\t\t\t</h3>\n\t\t</div>\n\t\t<p class=\"BuilderBlueprintLibraryItem__description\">\n\t\t\t{{ block.description }}\n\t\t</p>\n\t\t<div class=\"BuilderBlueprintLibraryItem__actions\">\n\t\t\t<WdsButton\n\t\t\t\tvariant=\"primary\"\n\t\t\t\tsize=\"small\"\n\t\t\t\t:disabled=\"isInstalling\"\n\t\t\t\t@click=\"handleInstall\"\n\t\t\t>\n\t\t\t\t<WdsIcon name=\"download\" />\n\t\t\t\t{{ isInstalling ? \"Installing...\" : \"Install\" }}\n\t\t\t</WdsButton>\n\t\t</div>\n\t</div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, inject } from \"vue\";\nimport WdsButton from \"@/wds/WdsButton.vue\";\nimport WdsIcon from \"@/wds/WdsIcon.vue\";\nimport { useToasts } from \"../useToast\";\nimport injectionKeys from \"@/injectionKeys\";\nimport { useWriterApi } from \"@/composables/useWriterApi\";\nimport { useComponentActions } from \"@/builder/useComponentActions\";\nimport { useLogger } from \"@/composables/useLogger\";\nimport type { Component } from \"@/writerTypes\";\n\nconst props = defineProps<{\n\tblock: {\n\t\tid: string;\n\t\ttitle: string;\n\t\tdescription: string;\n\t\tcreatedBy: number;\n\t};\n}>();\n\nconst emit = defineEmits<{\n\tinstalled: [];\n}>();\n\nconst wf = inject(injectionKeys.core);\nconst wfbm = inject(injectionKeys.builderManager);\nconst { pushToast } = useToasts();\nconst { writerApi } = useWriterApi();\nconst { installSharedBlueprint } = useComponentActions(wf, wfbm);\nconst isInstalling = ref(false);\n\nasync function handleInstall() {\n\tconst orgId = wf.writerOrgId.value;\n\tif (!orgId) {\n\t\tpushToast({\n\t\t\ttype: \"error\",\n\t\t\tmessage:\n\t\t\t\t\"Organization ID is required. Please set up your environment variable.\",\n\t\t});\n\t\treturn;\n\t}\n\n\tisInstalling.value = true;\n\ttry {\n\t\t// Fetch blueprint from be.agent-storage\n\t\tconst blueprint = await writerApi.getSharedBlueprint(\n\t\t\torgId,\n\t\t\tprops.block.id,\n\t\t);\n\n\t\t// Install blueprint\n\t\tconst components = blueprint.components as Component[];\n\n\t\tconst _blueprintId = installSharedBlueprint({\n\t\t\tid: blueprint.id,\n\t\t\ttitle: blueprint.title,\n\t\t\tdescription: blueprint.description || undefined,\n\t\t\tcomponents,\n\t\t});\n\n\t\t// Track installation (fire-and-forget, don't block UX)\n\t\tconst appId = wf.writerAppId.value;\n\t\tif (appId) {\n\t\t\twriterApi\n\t\t\t\t.trackBlueprintInstallation(orgId, props.block.id, appId)\n\t\t\t\t.catch(useLogger().error);\n\t\t}\n\n\t\tpushToast({\n\t\t\ttype: \"success\",\n\t\t\tmessage: `Blueprint \"${props.block.title}\" installed successfully`,\n\t\t});\n\n\t\temit(\"installed\");\n\t} catch (error) {\n\t\tpushToast({\n\t\t\ttype: \"error\",\n\t\t\tmessage: `Failed to install blueprint: ${error instanceof Error ? error.message : String(error)}`,\n\t\t});\n\t} finally {\n\t\tisInstalling.value = false;\n\t}\n}\n</script>\n\n<style scoped>\n.BuilderBlueprintLibraryItem {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 12px;\n\tpadding: 16px;\n\tborder: 1px solid var(--builderSeparatorColor);\n\tborder-radius: 8px;\n\tbackground: var(--builderBackgroundColor);\n\ttransition: border-color 0.2s;\n}\n\n.BuilderBlueprintLibraryItem:hover {\n\tborder-color: var(--builderPrimaryColor);\n}\n\n.BuilderBlueprintLibraryItem__header {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: flex-start;\n\tgap: 12px;\n}\n\n.BuilderBlueprintLibraryItem__title {\n\tfont-size: 16px;\n\tfont-weight: 600;\n\tmargin: 0;\n\tflex: 1;\n}\n\n.BuilderBlueprintLibraryItem__description {\n\tfont-size: 14px;\n\tcolor: var(--builderSecondaryTextColor);\n\tmargin: 0;\n\tline-height: 1.5;\n\tdisplay: -webkit-box;\n\t-webkit-line-clamp: 2;\n\t-webkit-box-orient: vertical;\n\toverflow: hidden;\n}\n\n.BuilderBlueprintLibraryItem__actions {\n\tdisplay: flex;\n\tjustify-content: flex-end;\n\tmargin-top: auto;\n}\n</style>\n","<template>\n\t<WdsModal\n\t\tv-if=\"isOpen && isBlueprintLibraryEnabled\"\n\t\ttitle=\"Blueprint Library\"\n\t\tsize=\"wide\"\n\t\tdisplay-close-button\n\t\t@close=\"handleClose\"\n\t>\n\t\t<div class=\"BuilderBlueprintLibraryPanel\">\n\t\t\t<div class=\"BuilderBlueprintLibraryPanel__header\">\n\t\t\t\t<div class=\"BuilderBlueprintLibraryPanel__search\">\n\t\t\t\t\t<WdsTextInput\n\t\t\t\t\t\tv-model=\"searchQuery\"\n\t\t\t\t\t\tplaceholder=\"Search blueprints...\"\n\t\t\t\t\t\tleft-icon=\"search\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"BuilderBlueprintLibraryPanel__content\">\n\t\t\t\t<WdsSkeletonLoader\n\t\t\t\t\tv-if=\"isLoading\"\n\t\t\t\t\tclass=\"BuilderBlueprintLibraryPanel__loading\"\n\t\t\t\t/>\n\n\t\t\t\t<div\n\t\t\t\t\tv-else-if=\"blueprints.length === 0\"\n\t\t\t\t\tclass=\"BuilderBlueprintLibraryPanel__empty\"\n\t\t\t\t>\n\t\t\t\t\t<p>No blueprints found</p>\n\t\t\t\t\t<p\n\t\t\t\t\t\tv-if=\"searchQuery\"\n\t\t\t\t\t\tclass=\"BuilderBlueprintLibraryPanel__empty__hint\"\n\t\t\t\t\t>\n\t\t\t\t\t\tTry adjusting your search\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<div v-else class=\"BuilderBlueprintLibraryPanel__sections\">\n\t\t\t\t\t<SharedCollapsible\n\t\t\t\t\t\tv-if=\"globalBlueprints.length > 0\"\n\t\t\t\t\t\tclass=\"BuilderBlueprintLibraryPanel__section\"\n\t\t\t\t\t\t:open=\"true\"\n\t\t\t\t\t\t:icons=\"{\n\t\t\t\t\t\t\topen: 'chevron-down',\n\t\t\t\t\t\t\tclose: 'chevron-right',\n\t\t\t\t\t\t}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template #title>\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tclass=\"BuilderBlueprintLibraryPanel__sectionTitle\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tAgents for everyone\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template #content>\n\t\t\t\t\t\t\t<div class=\"BuilderBlueprintLibraryPanel__grid\">\n\t\t\t\t\t\t\t\t<BuilderBlueprintLibraryItem\n\t\t\t\t\t\t\t\t\tv-for=\"blueprint in globalBlueprints\"\n\t\t\t\t\t\t\t\t\t:key=\"blueprint.id\"\n\t\t\t\t\t\t\t\t\t:block=\"blueprint\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</SharedCollapsible>\n\n\t\t\t\t\t<SharedCollapsible\n\t\t\t\t\t\tv-if=\"orgBlueprints.length > 0\"\n\t\t\t\t\t\tclass=\"BuilderBlueprintLibraryPanel__section\"\n\t\t\t\t\t\t:open=\"true\"\n\t\t\t\t\t\t:icons=\"{\n\t\t\t\t\t\t\topen: 'chevron-down',\n\t\t\t\t\t\t\tclose: 'chevron-right',\n\t\t\t\t\t\t}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template #title>\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tclass=\"BuilderBlueprintLibraryPanel__sectionTitle\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tAgents for your organization\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template #content>\n\t\t\t\t\t\t\t<div class=\"BuilderBlueprintLibraryPanel__grid\">\n\t\t\t\t\t\t\t\t<BuilderBlueprintLibraryItem\n\t\t\t\t\t\t\t\t\tv-for=\"blueprint in orgBlueprints\"\n\t\t\t\t\t\t\t\t\t:key=\"blueprint.id\"\n\t\t\t\t\t\t\t\t\t:block=\"blueprint\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</SharedCollapsible>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</WdsModal>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, watch, inject } from \"vue\";\nimport WdsModal from \"@/wds/WdsModal.vue\";\nimport BuilderBlueprintLibraryItem from \"./BuilderBlueprintLibraryItem.vue\";\nimport WdsTextInput from \"@/wds/WdsTextInput.vue\";\nimport WdsSkeletonLoader from \"@/wds/WdsSkeletonLoader.vue\";\nimport SharedCollapsible from \"@/components/shared/SharedCollapsible.vue\";\nimport injectionKeys from \"@/injectionKeys\";\nimport { useToasts } from \"../useToast\";\nimport { useDebouncer } from \"@/composables/useDebouncer\";\nimport { useWriterApi } from \"@/composables/useWriterApi\";\n\nconst isOpen = defineModel({ type: Boolean });\n\nconst wf = inject(injectionKeys.core);\nconst { pushToast } = useToasts();\nconst { writerApi } = useWriterApi();\n\nconst isBlueprintLibraryEnabled = computed(\n\t() =>\n\t\tArray.isArray(wf.featureFlags.value) &&\n\t\twf.featureFlags.value.includes(\"blueprint_library\"),\n);\n\nconst searchQuery = ref(\"\");\nconst blueprints = ref<\n\tArray<{\n\t\tid: string;\n\t\ttitle: string;\n\t\tdescription: string;\n\t\tcategory: string;\n\t\tisReadonly: boolean;\n\t\tcreatedBy: number;\n\t}>\n>([]);\nconst isLoading = ref(false);\nconst hasLoadedOnce = ref(false);\n\nconst globalBlueprints = computed(() =>\n\tblueprints.value.filter((bp) => bp.isReadonly === true),\n);\nconst orgBlueprints = computed(() =>\n\tblueprints.value.filter((bp) => bp.isReadonly !== true),\n);\n\nasync function loadBlueprints() {\n\tif (!isBlueprintLibraryEnabled.value) return;\n\n\tconst orgId = wf.writerOrgId.value;\n\tif (!orgId) {\n\t\tpushToast({\n\t\t\ttype: \"error\",\n\t\t\tmessage:\n\t\t\t\t\"Organization ID is required. Please set up your environment variable.\",\n\t\t});\n\t\tisLoading.value = false;\n\t\treturn;\n\t}\n\n\t// Only show loading state on initial load, not during search refinements\n\tif (!hasLoadedOnce.value) {\n\t\tisLoading.value = true;\n\t}\n\ttry {\n\t\tconst results = await writerApi.listSharedBlueprints(\n\t\t\torgId,\n\t\t\tsearchQuery.value || undefined,\n\t\t);\n\n\t\t// Transform to match frontend format\n\t\tblueprints.value = results.map((bp) => ({\n\t\t\tid: bp.id,\n\t\t\ttitle: bp.title,\n\t\t\tdescription: bp.description,\n\t\t\tcategory: bp.category || \"Shared Blueprints\",\n\t\t\tisReadonly: Boolean(bp.isReadonly),\n\t\t\tcreatedBy: bp.createdBy,\n\t\t}));\n\t\thasLoadedOnce.value = true;\n\t} catch (error) {\n\t\tpushToast({\n\t\t\ttype: \"error\",\n\t\t\tmessage: `Failed to load blueprints: ${error instanceof Error ? error.message : String(error)}`,\n\t\t});\n\t} finally {\n\t\tisLoading.value = false;\n\t}\n}\n\nconst debouncedLoadBlueprints = useDebouncer(loadBlueprints, 300);\n\nwatch(searchQuery, debouncedLoadBlueprints);\n\nfunction handleClose() {\n\tisOpen.value = false;\n\thasLoadedOnce.value = false;\n\tsearchQuery.value = \"\";\n}\n\nwatch(isOpen, (newValue) => {\n\tif (newValue && isBlueprintLibraryEnabled.value) {\n\t\tloadBlueprints();\n\t}\n});\n</script>\n\n<style scoped>\n.BuilderBlueprintLibraryPanel {\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 100%;\n\tmax-height: 80vh;\n}\n\n.BuilderBlueprintLibraryPanel__header {\n\tdisplay: flex;\n\tgap: 12px;\n\tpadding: 16px;\n\tborder-bottom: 1px solid var(--builderSeparatorColor);\n\talign-items: center;\n\tflex-shrink: 0;\n}\n\n.BuilderBlueprintLibraryPanel__search {\n\tflex: 1;\n}\n\n.BuilderBlueprintLibraryPanel__content {\n\tflex: 1;\n\toverflow-y: auto;\n\tmin-height: 0;\n}\n\n.BuilderBlueprintLibraryPanel__sections {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 24px;\n\tpadding: 16px;\n}\n\n.BuilderBlueprintLibraryPanel__section {\n\t--accentColor: var(--builderSecondaryTextColor);\n}\n\n.BuilderBlueprintLibraryPanel__section :deep(.content) {\n\tpadding-top: 12px;\n\tpadding-left: 0;\n}\n\n.BuilderBlueprintLibraryPanel__sectionTitle {\n\tfont-size: 14px;\n\tfont-weight: 600;\n\tcolor: var(--builderSecondaryTextColor);\n\ttext-transform: uppercase;\n\tletter-spacing: 0.5px;\n}\n\n.BuilderBlueprintLibraryPanel__grid {\n\tdisplay: grid;\n\tgrid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n\tgap: 16px;\n}\n\n.BuilderBlueprintLibraryPanel__loading,\n.BuilderBlueprintLibraryPanel__empty {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 48px;\n\tcolor: var(--builderSecondaryTextColor);\n\ttext-align: center;\n}\n\n.BuilderBlueprintLibraryPanel__empty__hint {\n\tfont-size: 12px;\n\tmargin-top: 8px;\n}\n</style>\n"],"names":["props","__props","emit","__emit","wf","inject","injectionKeys","wfbm","pushToast","useToasts","writerApi","useWriterApi","installSharedBlueprint","useComponentActions","isInstalling","ref","handleInstall","orgId","blueprint","components","_blueprintId","appId","useLogger","error","isOpen","_useModel","isBlueprintLibraryEnabled","computed","searchQuery","blueprints","isLoading","hasLoadedOnce","globalBlueprints","bp","orgBlueprints","loadBlueprints","results","debouncedLoadBlueprints","useDebouncer","watch","handleClose","newValue"],"mappings":"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"}