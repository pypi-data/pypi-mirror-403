import{d as W,i as h,a as I,c as a,o as k,f as x,J as R,g as y,x as c,y as H,R as l,at as E,aF as U,S as M,_ as N,u as Q,V as X,z as w,W as L,t as Y,b as q,D as J,E as K,ax as Z,aI as ee,A as te,l as ne}from"./index-C1IizHaQ.js";import{W as V,b as G}from"./BuilderApp-DhqlqS0y.js";import{a as se}from"./useBlueprintRun-DWmMgV1z.js";import{W as re}from"./BuilderSettings-G-znf-iB.js";import"./WdsCheckbox-BYkw_Bvq.js";import"./marked.esm-273vDTCT.js";import"./WdsDropdownMenu-Ba7OuweF.js";import"./WdsTabs-CJTYrdrm.js";import"./WdsFieldWrapper-aazsDYxB.js";import"./useKeyValueEditor-6fUhwaEz.js";const ie={class:"BuilderBlueprintState"},oe={class:"BuilderBlueprintState__status BuilderBlueprintState__status--success"},le={class:"BuilderBlueprintState__status BuilderBlueprintState__status--error"},ae=W({__name:"BuilderBlueprintState",props:{blueprintId:{type:String,required:!0}},setup(p){const s=p,d=h(I.core),r=h(I.builderManager),m=a(()=>d.getComponents(s.blueprintId)),v=a(()=>m.value.map(n=>n.id)),_=a(()=>{var t,B,f;const u=(t=r.getLogEntries().filter(b=>b.blueprintExecution?b.blueprintExecution.summary.some(T=>v.value.includes(T.componentId)):!1).at(0))==null?void 0:t.blueprintExecution.summary.at(-1);if(!u)return;if(u.outcome==="in_progress")return"in_progress";const S=d.getComponentById(u.componentId);return((f=(B=d.getComponentDefinition(S.type).outs)==null?void 0:B[u.outcome])==null?void 0:f.style)??"success"});return(n,u)=>(k(),x("div",ie,[_.value?_.value==="success"?R(n.$slots,"success",{key:1},()=>[y("div",oe,[c(H,{name:"check"})])],!0):_.value==="error"?R(n.$slots,"error",{key:2},()=>[y("div",le,[c(H,{name:"circle-alert"})])],!0):_.value==="in_progress"?R(n.$slots,"running",{key:3},()=>[c(U,{class:"BuilderBlueprintState__status",color:l(E).Gray5},null,8,["color"])],!0):M("",!0):R(n.$slots,"unknown",{key:0},void 0,!0)]))}}),ue=N(ae,[["__scopeId","data-v-1ef50b43"]]);function ce(p,s,d){function r(n){return n.type==="blueprints_uieventtrigger"&&n.content.refComponentId===l(s)&&n.content.refEventType===l(d)}const m=a(()=>[...new Set(v.value.map(u=>u.parentId))].map(u=>p.getComponentById(u)).filter(Boolean)),v=a(()=>p.getComponents("blueprints_root").flatMap(n=>p.getComponents(n.id).filter(r))),_=a(()=>v.value.length>0);return{blueprints:m,triggers:v,isLinked:_}}const de=["aria-busy"],pe={class:"BuilderSettingsHandlersBlueprint__title"},me={class:"BuilderSettingsHandlersBlueprint__list"},_e={class:"BuilderSettingsHandlersBlueprint__list__item"},ve={class:"BuilderSettingsHandlersBlueprint__list__item"},fe=W({__name:"BuilderSettingsHandlersBlueprint",props:{component:{type:Object,required:!0},eventType:{type:String,required:!0},eventDescription:{type:String,required:!1,default:void 0}},setup(p){const s=h(I.core),d=h(I.builderManager),r=p,m=Q(s),{createAndInsertComponentsTree:v,removeComponentsSubtree:_}=Z(s,d,m),n=a(()=>r.eventType.replace(/^wf-/,"").replaceAll("-"," ")),{blueprints:u,triggers:S}=ce(s,a(()=>r.component.id),a(()=>r.eventType)),{run:g,isRunning:t}=se(s,a(()=>S.value.map(e=>({blueprintId:e.parentId,branchId:e.id})))),{pushToast:B}=X();function f(){const e=u.value.map(o=>{const i=(o.content.key??"0").match(/\d+/);return i?Number(i[0]):0});return e.length===0?1:Math.max(...e)+1}async function b(){var A;const{type:e}=r.component,{name:o,events:i}=s.getComponentDefinition(e),D=`${o} - ${r.eventType}`,j=`${e}@${r.eventType.replace(/^wf-/,"")}_${f()}`;let $=(A=i==null?void 0:i[r.eventType])==null?void 0:A.eventPayloadExample;typeof $=="object"&&$!==null&&($=JSON.stringify($));const[z]=v("blueprints_root",[{type:"blueprints_blueprint",initProperties:{content:{key:j}}},{type:"blueprints_uieventtrigger",initProperties:{content:{alias:D,refComponentId:r.component.id,refEventType:r.eventType,defaultResult:$?String($):void 0},x:96,y:96}}]);B({type:"success",message:`${D} added`,action:{label:"Go to blueprint",func:()=>{var F;return P(z,(F=C(z))==null?void 0:F.id)},icon:"wds-blueprints"}})}function C(e){return s.getComponents(e).find(o=>o.type==="blueprints_uieventtrigger"&&o.content.refComponentId===r.component.id&&o.content.refEventType===r.eventType)}function T(e){const o=[e.id];s.getComponents(e.parentId).length===1&&o.push(e.parentId),_(...o)}function O(e){var o,i;return((i=(o=s.getComponentById(e.parentId))==null?void 0:o.content)==null?void 0:i.key)||"Blueprint"}function P(e,o){s.setActivePageId(e),d.setMode("blueprints"),d.setSelection(o??e,void 0,"click")}return(e,o)=>(k(),x("div",{class:"BuilderSettingsHandlersBlueprint","aria-busy":l(t)},[y("div",pe,[c(L,{class:"BuilderSettingsHandlersBlueprint__title__btn",variant:"special",size:"icon","aria-label":"Run the attached blueprints",disabled:l(t),loading:l(t),onClick:l(g)},{default:w(()=>[c(H,{name:"play"})]),_:1},8,["disabled","loading","onClick"]),y("p",null,Y(n.value),1),p.eventDescription?(k(),q(L,{key:0,"data-writer-tooltip":p.eventDescription,variant:"neutral",size:"smallIcon","custom-size":"18px"},{default:w(()=>[c(H,{name:"circle-question-mark"})]),_:1},8,["data-writer-tooltip"])):M("",!0)]),y("div",me,[(k(!0),x(J,null,K(l(S),(i,D)=>(k(),q(G,{key:i.id,color:l(E).Blue6,"color-last":l(S).length===D+1?l(E).Blue2:l(E).Blue6},{default:w(()=>[y("div",_e,[c(V,{variant:"secondary",disabled:l(t),text:O(i),"data-writer-tooltip":O(i),"data-writer-tooltip-strategy":"overflow",onClick:j=>P(i.parentId,i.id)},null,8,["disabled","text","data-writer-tooltip","onClick"]),c(ue,{"blueprint-id":i.parentId},null,8,["blueprint-id"]),c(L,{variant:"neutral",size:"smallIcon","custom-size":"18px","aria-label":"Unlink blueprint","data-writer-tooltip":"This will remove the trigger but will not delete the blueprint",disabled:l(t),onClick:j=>T(i)},{default:w(()=>[c(H,{name:"link-2-off"})]),_:2},1032,["disabled","onClick"])])]),_:2},1032,["color","color-last"]))),128)),c(G,{"is-last":"",color:l(E).Blue2},{default:w(()=>[y("div",ve,[c(V,{variant:"primary",weight:"semibold",disabled:l(t),"left-icon":"plus",text:"Create blueprint",onClick:b},null,8,["disabled"])])]),_:1},8,["color"])])],8,de))}}),ge=N(fe,[["__scopeId","data-v-5af57bf8"]]),Be=["inert"],be={class:"BuilderSettingsHandlers__list"},ye=W({__name:"BuilderSettingsHandlers",props:{isReadOnly:{type:Boolean}},setup(p){const s=h(I.core),d=h(I.builderManager),r=h(I.secretsManager),m=a(()=>s.getComponentById(d.firstSelectedId.value)),v=a(()=>{var g,t;return ee((t=(g=d.firstSelectedItem)==null?void 0:g.value)==null?void 0:t.instancePath)}),{getEvaluatedFields:_}=ne(s,r),n=a(()=>_(v.value)),u=a(()=>{if(!m.value)return{};const{type:g}=m.value,t=s.getComponentDefinition(g),B=(t==null?void 0:t.events)??{},f=Object.entries(B).filter(([C,T])=>T.enabled===void 0?!0:T.enabled({evaluatedFields:n.value})),b=Object.fromEntries(f);return Object.keys({...m.value.handlers}).forEach(C=>{b[C]||(b[C]={desc:"Custom event"})}),b}),S=a(()=>d.isSingleSelectionActive.value?Object.keys(u.value).length>0:!1);return(g,t)=>S.value?(k(),x("div",{key:0,inert:p.isReadOnly,class:"BuilderSettingsHandlers"},[c(re,{class:"BuilderSettingsHandlers__title"},{default:w(()=>t[0]||(t[0]=[te("Blueprints")])),_:1}),y("div",be,[(k(!0),x(J,null,K(u.value,(B,f)=>(k(),x("div",{key:f},[c(ge,{component:m.value,"event-type":f,"event-description":B.desc},null,8,["component","event-type","event-description"])]))),128))])],8,Be)):M("",!0)}}),He=N(ye,[["__scopeId","data-v-7bb69b92"]]);export{He as default};
//# sourceMappingURL=BuilderSettingsHandlers-C79-kk9h.js.map
