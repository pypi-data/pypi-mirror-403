name: Update direct_url.json schema from packaging.python.org

on:
  workflow_dispatch: {}
  schedule:
    - cron: "40 12 * * 1-5"

concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref || github.run_id }}
  cancel-in-progress: true

permissions: {}

jobs:
  update_schema:
    name: Update schema
    runs-on: ubuntu-slim
    permissions:
      contents: write  # Allow the workflow to push changes to the repository
    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
        with:
          persist-credentials: false
      - name: Update schema
        run: |
          curl -o tests/fixtures/direct_url.schema.json https://packaging.python.org/en/latest/specifications/schemas/direct-url.schema.json
      - name: Commit changes
        run: |
          git config user.name "GitHub Actions"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add tests/fixtures/direct_url.schema.json
          git commit -m "chore: update direct_url.schema.json"
      - name: Push changes
        run: |
          git push
