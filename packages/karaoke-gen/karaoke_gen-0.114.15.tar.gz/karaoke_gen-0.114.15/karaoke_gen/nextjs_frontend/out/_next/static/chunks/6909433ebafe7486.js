(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,54858,e=>{"use strict";var t=e.i(47167);let a="localhost"===window.location.hostname?"":t.default.env.NEXT_PUBLIC_API_URL||"https://api.nomadkaraoke.com";function i(e){localStorage.setItem("karaoke_access_token",e)}function s(){return localStorage.getItem("karaoke_access_token")}function r(){localStorage.removeItem("karaoke_access_token")}function n(){let e={},t=s();return t&&(e.Authorization=`Bearer ${t}`),e}class o extends Error{status;data;constructor(e,t,a){super(e),this.name="ApiError",this.status=t,this.data=a}}async function c(e){if(!e.ok){let t;try{t=await e.json()}catch{t={detail:e.statusText}}throw new o(function(e,t){if("string"==typeof e?.detail)return e.detail;if("string"==typeof e?.message)return e.message;if("string"==typeof e?.error)return e.error;if(e?.detail?.message)return String(e.detail.message);if(e?.detail?.error)return String(e.detail.error);if(e?.detail&&"object"==typeof e.detail)try{return JSON.stringify(e.detail)}catch{}return t}(t,`Request failed with status ${e.status}`),e.status,t)}return e.json()}function d(e){return{async submitCorrections(t){let i={corrections:{...t,lines:t.corrected_segments}},s=await fetch(`${a}/api/jobs/${e}/corrections`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify(i)});await c(s)},async submitAnnotations(t){let i=await fetch(`${a}/api/jobs/${e}/annotations`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({annotations:t})});await c(i)},updateHandlers:async t=>c(await fetch(`${a}/api/review/${e}/handlers`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({enabled_handlers:t})})),async addLyrics(t,i){let s=await fetch(`${a}/api/review/${e}/add-lyrics`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({source:t,lyrics:i})});return(await c(s)).data},getAudioUrl(t){let i=s(),r=`${a}/api/review/${e}/audio/${t}`;return i?`${r}?token=${encodeURIComponent(i)}`:r},generatePreviewVideo:async t=>c(await fetch(`${a}/api/review/${e}/preview-video`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify(t)})),getPreviewVideoUrl(t){let i=s(),r=`${a}/api/review/${e}/preview-video/${t}`;return i?`${r}?token=${encodeURIComponent(i)}`:r},completeReview:async()=>c(await fetch(`${a}/api/jobs/${e}/complete-review`,{method:"POST",headers:n()}))}}e.s(["API_BASE_URL",0,a,"ApiError",()=>o,"adminApi",0,{async getStats(e){let t=new URLSearchParams;e?.exclude_test!==void 0&&t.set("exclude_test",String(e.exclude_test));let i=`${a}/api/admin/stats/overview${t.toString()?"?"+t.toString():""}`;return c(await fetch(i,{headers:n()}))},async listUsers(e){let t=new URLSearchParams;e?.limit&&t.set("limit",String(e.limit)),e?.offset&&t.set("offset",String(e.offset)),e?.search&&t.set("search",e.search),e?.sort_by&&t.set("sort_by",e.sort_by),e?.sort_order&&t.set("sort_order",e.sort_order),e?.include_inactive&&t.set("include_inactive","true"),e?.exclude_test!==void 0&&t.set("exclude_test",String(e.exclude_test));let i=`${a}/api/users/admin/users${t.toString()?"?"+t.toString():""}`;return c(await fetch(i,{headers:n()}))},getUserDetail:async e=>c(await fetch(`${a}/api/users/admin/users/${encodeURIComponent(e)}/detail`,{headers:n()})),addCredits:async(e,t,i)=>c(await fetch(`${a}/api/users/admin/credits`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({email:e,amount:t,reason:i})})),impersonateUser:async e=>c(await fetch(`${a}/api/admin/users/${encodeURIComponent(e)}/impersonate`,{method:"POST",headers:n()})),enableUser:async e=>c(await fetch(`${a}/api/users/admin/users/${encodeURIComponent(e)}/enable`,{method:"POST",headers:n()})),disableUser:async e=>c(await fetch(`${a}/api/users/admin/users/${encodeURIComponent(e)}/disable`,{method:"POST",headers:n()})),async listAllJobs(e){let t=new URLSearchParams;e?.status&&t.set("status",e.status),e?.user_email&&t.set("user_email",e.user_email),e?.environment&&t.set("environment",e.environment),e?.created_after&&t.set("created_after",e.created_after),e?.created_before&&t.set("created_before",e.created_before),e?.limit&&t.set("limit",String(e.limit)),e?.exclude_test!==void 0&&t.set("exclude_test",String(e.exclude_test));let i=`${a}/api/jobs${t.toString()?"?"+t.toString():""}`;return c(await fetch(i,{headers:n()}))},async getBetaStats(e){let t=new URLSearchParams;e?.exclude_test!==void 0&&t.set("exclude_test",String(e.exclude_test));let i=`${a}/api/users/admin/beta/stats${t.toString()?"?"+t.toString():""}`;return c(await fetch(i,{headers:n()}))},getBetaFeedback:async(e=50)=>c(await fetch(`${a}/api/users/admin/beta/feedback?limit=${e}`,{headers:n()})),deleteJob:async(e,t=!0)=>c(await fetch(`${a}/api/jobs/${e}?delete_files=${t}`,{method:"DELETE",headers:n()})),async listAudioSearches(e){let t=new URLSearchParams;e?.limit&&t.set("limit",String(e.limit)),e?.status_filter&&t.set("status_filter",e.status_filter),e?.exclude_test!==void 0&&t.set("exclude_test",String(e.exclude_test));let i=`${a}/api/admin/audio-searches${t.toString()?"?"+t.toString():""}`;return c(await fetch(i,{headers:n()}))},clearAudioSearchCache:async e=>c(await fetch(`${a}/api/admin/audio-searches/${e}/clear-cache`,{method:"POST",headers:n()})),clearAllCache:async()=>c(await fetch(`${a}/api/admin/cache`,{method:"DELETE",headers:n()})),getCacheStats:async()=>c(await fetch(`${a}/api/admin/cache/stats`,{headers:n()})),getCompletionMessage:async e=>c(await fetch(`${a}/api/admin/jobs/${e}/completion-message`,{headers:n()})),sendCompletionEmail:async(e,t,i=!0)=>c(await fetch(`${a}/api/admin/jobs/${e}/send-completion-email`,{method:"POST",headers:{...n(),"Content-Type":"application/json"},body:JSON.stringify({to_email:t,cc_admin:i})})),getJobFiles:async e=>c(await fetch(`${a}/api/admin/jobs/${e}/files`,{headers:n()})),updateJob:async(e,t)=>c(await fetch(`${a}/api/admin/jobs/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify(t)})),resetJob:async(e,t)=>c(await fetch(`${a}/api/admin/jobs/${e}/reset`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({target_state:t})})),deleteJobOutputs:async e=>c(await fetch(`${a}/api/admin/jobs/${e}/delete-outputs`,{method:"POST",headers:n()})),clearWorkers:async e=>c(await fetch(`${a}/api/admin/jobs/${e}/clear-workers`,{method:"POST",headers:n()})),triggerWorker:async(e,t="video")=>c(await fetch(`${a}/api/admin/jobs/${e}/trigger-worker`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({worker_type:t})})),getRateLimitStats:async()=>c(await fetch(`${a}/api/admin/rate-limits/stats`,{headers:n()})),getUserRateLimitStatus:async e=>c(await fetch(`${a}/api/admin/rate-limits/users/${encodeURIComponent(e)}`,{headers:n()})),getBlocklists:async()=>c(await fetch(`${a}/api/admin/rate-limits/blocklists`,{headers:n()})),addDisposableDomain:async e=>c(await fetch(`${a}/api/admin/rate-limits/blocklists/disposable-domains`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({domain:e})})),removeDisposableDomain:async e=>c(await fetch(`${a}/api/admin/rate-limits/blocklists/disposable-domains/${encodeURIComponent(e)}`,{method:"DELETE",headers:n()})),addBlockedEmail:async e=>c(await fetch(`${a}/api/admin/rate-limits/blocklists/blocked-emails`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({email:e})})),removeBlockedEmail:async e=>c(await fetch(`${a}/api/admin/rate-limits/blocklists/blocked-emails/${encodeURIComponent(e)}`,{method:"DELETE",headers:n()})),addBlockedIP:async e=>c(await fetch(`${a}/api/admin/rate-limits/blocklists/blocked-ips`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({ip_address:e})})),removeBlockedIP:async e=>c(await fetch(`${a}/api/admin/rate-limits/blocklists/blocked-ips/${encodeURIComponent(e)}`,{method:"DELETE",headers:n()})),getUserOverrides:async()=>c(await fetch(`${a}/api/admin/rate-limits/overrides`,{headers:n()})),setUserOverride:async(e,t)=>c(await fetch(`${a}/api/admin/rate-limits/overrides/${encodeURIComponent(e)}`,{method:"PUT",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify(t)})),removeUserOverride:async e=>c(await fetch(`${a}/api/admin/rate-limits/overrides/${encodeURIComponent(e)}`,{method:"DELETE",headers:n()}))},"api",0,{async listJobs(e){let t=new URLSearchParams;e?.status&&t.set("status",e.status),e?.limit&&t.set("limit",String(e.limit)),e?.exclude_test!==void 0&&t.set("exclude_test",String(e.exclude_test));let i=`${a}/api/jobs${t.toString()?"?"+t.toString():""}`;return c(await fetch(i,{headers:n()}))},getJob:async e=>c(await fetch(`${a}/api/jobs/${e}`,{headers:n()})),async uploadJob(e,t,i,s){let r=new FormData;return r.append("file",e),r.append("artist",t),r.append("title",i),s?.enable_cdg!==void 0&&r.append("enable_cdg",String(s.enable_cdg)),s?.enable_txt!==void 0&&r.append("enable_txt",String(s.enable_txt)),s?.brand_prefix&&r.append("brand_prefix",s.brand_prefix),s?.enable_youtube_upload!==void 0&&r.append("enable_youtube_upload",String(s.enable_youtube_upload)),s?.theme_id&&r.append("theme_id",s.theme_id),s?.color_overrides&&r.append("color_overrides",JSON.stringify(s.color_overrides)),s?.non_interactive!==void 0&&r.append("non_interactive",String(s.non_interactive)),c(await fetch(`${a}/api/jobs/upload`,{method:"POST",headers:n(),body:r}))},async createJobFromUrl(e,t,i,s){let r={url:e};return t&&(r.artist=t),i&&(r.title=i),s?.enable_cdg!==void 0&&(r.enable_cdg=s.enable_cdg),s?.enable_txt!==void 0&&(r.enable_txt=s.enable_txt),s?.brand_prefix&&(r.brand_prefix=s.brand_prefix),s?.enable_youtube_upload!==void 0&&(r.enable_youtube_upload=s.enable_youtube_upload),s?.theme_id&&(r.theme_id=s.theme_id),s?.color_overrides&&(r.color_overrides=s.color_overrides),s?.non_interactive!==void 0&&(r.non_interactive=s.non_interactive),c(await fetch(`${a}/api/jobs/create-from-url`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify(r)}))},getReviewData:async e=>c(await fetch(`${a}/api/jobs/${e}/review-data`,{headers:n()})),async completeReview(e,t){let i=t?{instrumental_selection:t}:void 0;return c(await fetch(`${a}/api/jobs/${e}/complete-review`,{method:"POST",headers:i?{"Content-Type":"application/json",...n()}:n(),body:i?JSON.stringify(i):void 0}))},getInstrumentalOptions:async e=>c(await fetch(`${a}/api/jobs/${e}/instrumental-options`,{headers:n()})),selectInstrumental:async(e,t)=>c(await fetch(`${a}/api/jobs/${e}/select-instrumental`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({selection:t})})),getInstrumentalAnalysis:async e=>c(await fetch(`${a}/api/jobs/${e}/instrumental-analysis`,{headers:n()})),getWaveformData:async(e,t=1e3)=>c(await fetch(`${a}/api/jobs/${e}/waveform-data?num_points=${t}`,{headers:n()})),async uploadCustomInstrumental(e,t){let i=new FormData;return i.append("file",t),c(await fetch(`${a}/api/jobs/${e}/upload-instrumental`,{method:"POST",headers:n(),body:i}))},createCustomInstrumental:async(e,t)=>c(await fetch(`${a}/api/jobs/${e}/create-custom-instrumental`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({mute_regions:t})})),getAudioStreamUrl(e,t){let i=s(),r=`${a}/api/jobs/${e}/audio-stream/${t}`;return i?`${r}?token=${encodeURIComponent(i)}`:r},getDownloadUrls:async e=>c(await fetch(`${a}/api/jobs/${e}/download-urls`,{headers:n()})),cancelJob:async(e,t)=>c(await fetch(`${a}/api/jobs/${e}/cancel`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({reason:t||"Cancelled by user"})})),deleteJob:async(e,t=!0)=>c(await fetch(`${a}/api/jobs/${e}?delete_files=${t}`,{method:"DELETE",headers:n()})),getDownloadUrl(e,t,i){let r=`${a}/api/jobs/${e}/download/${t}/${i}`,n=s();return n?`${r}?token=${encodeURIComponent(n)}`:r},async searchAudio(e,t,i=!1,s){let r={artist:e,title:t,auto_download:i};return s?.enable_cdg!==void 0&&(r.enable_cdg=s.enable_cdg),s?.enable_txt!==void 0&&(r.enable_txt=s.enable_txt),s?.brand_prefix&&(r.brand_prefix=s.brand_prefix),s?.enable_youtube_upload!==void 0&&(r.enable_youtube_upload=s.enable_youtube_upload),s?.theme_id&&(r.theme_id=s.theme_id),s?.color_overrides&&(r.color_overrides=s.color_overrides),s?.non_interactive!==void 0&&(r.non_interactive=s.non_interactive),s?.display_artist&&(r.display_artist=s.display_artist),s?.display_title&&(r.display_title=s.display_title),c(await fetch(`${a}/api/audio-search/search`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify(r)}))},getAudioSearchResults:async e=>c(await fetch(`${a}/api/audio-search/${e}/results`,{headers:n()})),selectAudioResult:async(e,t)=>c(await fetch(`${a}/api/audio-search/${e}/select`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({selection_index:t})})),async getJobLogs(e,t=100){let i=await fetch(`${a}/api/jobs/${e}/logs?limit=${t}`,{headers:n()});return(await c(i)).logs||[]},retryJob:async e=>c(await fetch(`${a}/api/jobs/${e}/retry`,{method:"POST",headers:n()})),async listThemes(){let e=await fetch(`${a}/api/themes`,{headers:n()});return(await c(e)).themes},async getTheme(e){let t=await fetch(`${a}/api/themes/${e}`,{headers:n()});return(await c(t)).theme},async getThemePreview(e){let t=await fetch(`${a}/api/themes/${e}/preview`,{headers:n()});return(await c(t)).preview_url},async getThemeYoutubeDescription(e){let t=await fetch(`${a}/api/themes/${e}/youtube-description`,{headers:n()});return(await c(t)).description},sendMagicLink:async e=>c(await fetch(`${a}/api/users/auth/magic-link`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})})),verifyMagicLink:async e=>c(await fetch(`${a}/api/users/auth/verify?token=${encodeURIComponent(e)}`,{method:"GET"})),getCurrentUser:async()=>c(await fetch(`${a}/api/users/me`,{headers:n()})),logout:async()=>c(await fetch(`${a}/api/users/auth/logout`,{method:"POST",headers:n()})),async getBackendInfo(){let e=a?`${a}/`:"/backend-info";return c(await fetch(e,{headers:n()}))},getEncodingWorkerHealth:async()=>c(await fetch(`${a}/api/health/encoding-worker`)),async getCreditPackages(){let e=await fetch(`${a}/api/users/credits/packages`);return(await c(e)).packages},async createCheckout(e,t){let i=await fetch(`${a}/api/users/credits/checkout`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({package_id:e,email:t.toLowerCase()})});return(await c(i)).checkout_url},async createMadeForYouCheckout(e){let t=await fetch(`${a}/api/users/made-for-you/checkout`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email.toLowerCase(),artist:e.artist,title:e.title,source_type:e.source_type,youtube_url:e.youtube_url,notes:e.notes})}),i=await c(t);if(!i.checkout_url)throw Error("No checkout URL received");return i.checkout_url},enrollBetaTester:async(e,t,i)=>c(await fetch(`${a}/api/users/beta/enroll`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.toLowerCase(),promise_text:t,accept_corrections_work:i})})),getVapidPublicKey:async()=>c(await fetch(`${a}/api/push/vapid-public-key`)),subscribePush:async(e,t,i)=>c(await fetch(`${a}/api/push/subscribe`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({endpoint:e,keys:t,device_name:i})})),unsubscribePush:async e=>c(await fetch(`${a}/api/push/unsubscribe`,{method:"POST",headers:{"Content-Type":"application/json",...n()},body:JSON.stringify({endpoint:e})})),listPushSubscriptions:async()=>c(await fetch(`${a}/api/push/subscriptions`,{headers:n()}))},"clearAccessToken",()=>r,"createLyricsReviewApiClient",()=>d,"getAccessToken",()=>s,"lyricsReviewApi",0,{getCorrectionData:async e=>c(await fetch(`${a}/api/review/${e}/correction-data`,{headers:n()})),getAudioUrl(e,t){let i=s(),r=`${a}/api/review/${e}/audio/${t}`;return i?`${r}?token=${encodeURIComponent(i)}`:r}},"setAccessToken",()=>i])},68834,e=>{"use strict";var t=e.i(71645);let a=e=>{let t,a=new Set,i=(e,i)=>{let s="function"==typeof e?e(t):e;if(!Object.is(s,t)){let e=t;t=(null!=i?i:"object"!=typeof s||null===s)?s:Object.assign({},t,s),a.forEach(a=>a(t,e))}},s=()=>t,r={setState:i,getState:s,getInitialState:()=>n,subscribe:e=>(a.add(e),()=>a.delete(e))},n=t=e(i,s,r);return r},i=e=>{let i=e?a(e):a,s=e=>(function(e,a=e=>e){let i=t.default.useSyncExternalStore(e.subscribe,t.default.useCallback(()=>a(e.getState()),[e,a]),t.default.useCallback(()=>a(e.getInitialState()),[e,a]));return t.default.useDebugValue(i),i})(i,e);return Object.assign(s,i),s},s=e=>e?i(e):i;e.s(["create",()=>s],68834)},79473,e=>{"use strict";let t=e=>a=>{try{let i=e(a);if(i instanceof Promise)return i;return{then:e=>t(e)(i),catch(e){return this}}}catch(e){return{then(e){return this},catch:a=>t(a)(e)}}},a=(e,a)=>(i,s,r)=>{let n,o={storage:function(e,t){let a;try{a=e()}catch(e){return}return{getItem:e=>{var t;let i=e=>null===e?null:JSON.parse(e,void 0),s=null!=(t=a.getItem(e))?t:null;return s instanceof Promise?s.then(i):i(s)},setItem:(e,t)=>a.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>a.removeItem(e)}}(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...a},c=!1,d=new Set,l=new Set,u=o.storage;if(!u)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),i(...e)},s,r);let p=()=>{let e=o.partialize({...s()});return u.setItem(o.name,{state:e,version:o.version})},h=r.setState;r.setState=(e,t)=>(h(e,t),p());let m=e((...e)=>(i(...e),p()),s,r);r.getInitialState=()=>m;let y=()=>{var e,a;if(!u)return;c=!1,d.forEach(e=>{var t;return e(null!=(t=s())?t:m)});let r=(null==(a=o.onRehydrateStorage)?void 0:a.call(o,null!=(e=s())?e:m))||void 0;return t(u.getItem.bind(u))(o.name).then(e=>{if(e)if("number"!=typeof e.version||e.version===o.version)return[!1,e.state];else{if(o.migrate){let t=o.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;let[a,r]=e;if(i(n=o.merge(r,null!=(t=s())?t:m),!0),a)return p()}).then(()=>{null==r||r(n,void 0),n=s(),c=!0,l.forEach(e=>e(n))}).catch(e=>{null==r||r(void 0,e)})};return r.persist={setOptions:e=>{o={...o,...e},e.storage&&(u=e.storage)},clearStorage:()=>{null==u||u.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>y(),hasHydrated:()=>c,onHydrate:e=>(d.add(e),()=>{d.delete(e)}),onFinishHydration:e=>(l.add(e),()=>{l.delete(e)})},o.skipHydration||y(),n||m};e.s(["persist",()=>a])},38036,e=>{"use strict";var t=e.i(68834),a=e.i(79473),i=e.i(54858);let s=(0,t.create)()((0,a.persist)((e,t)=>({user:null,isLoading:!1,error:null,hasHydrated:!1,isImpersonating:!1,originalAdminToken:null,impersonatedUserEmail:null,setHasHydrated:t=>e({hasHydrated:t}),sendMagicLink:async t=>{e({isLoading:!0,error:null});try{return await i.api.sendMagicLink(t),e({isLoading:!1}),!0}catch(t){return e({isLoading:!1,error:t instanceof Error?t.message:"Failed to send magic link"}),!1}},verifyMagicLink:async t=>{e({isLoading:!0,error:null});try{let a=await i.api.verifyMagicLink(t);(0,i.setAccessToken)(a.session_token);let s={token:a.session_token,email:a.user.email,role:a.user.role,credits:a.user.credits,display_name:a.user.display_name,total_jobs_created:a.user.total_jobs_created,total_jobs_completed:a.user.total_jobs_completed};return e({user:s,isLoading:!1}),!0}catch(t){return e({isLoading:!1,error:t instanceof Error?t.message:"Invalid or expired link"}),!1}},fetchUser:async()=>{let t=(0,i.getAccessToken)();if(!t)return e({user:null}),!1;e({isLoading:!0});try{let a=await i.api.getCurrentUser(),s={token:t,email:a.user.email,role:a.user.role,credits:a.user.credits,display_name:a.user.display_name,total_jobs_created:a.user.total_jobs_created,total_jobs_completed:a.user.total_jobs_completed};return e({user:s,isLoading:!1}),!0}catch{return(0,i.clearAccessToken)(),e({user:null,isLoading:!1}),!1}},logout:async()=>{try{await i.api.logout()}catch{}(0,i.clearAccessToken)(),e({user:null,error:null})},updateCredits:t=>e(e=>({user:e.user?{...e.user,credits:t}:null})),clearError:()=>e({error:null}),loginWithToken:async t=>{e({isLoading:!0,error:null});try{(0,i.setAccessToken)(t);let a=await i.api.getCurrentUser(),s={token:t,email:a.user.email,role:a.user.role,credits:a.user.credits,display_name:a.user.display_name,total_jobs_created:a.user.total_jobs_created,total_jobs_completed:a.user.total_jobs_completed};return e({user:s,isLoading:!1}),!0}catch{return(0,i.clearAccessToken)(),e({user:null,isLoading:!1,error:"Invalid token or server unavailable"}),!1}},startImpersonation:async a=>{if(t().isImpersonating)return e({error:"Already impersonating a user. End current impersonation first."}),!1;e({isLoading:!0,error:null});let s=(0,i.getAccessToken)();try{let t;if(!s)throw Error("No active session to preserve");let r=await i.adminApi.impersonateUser(a);(0,i.setAccessToken)(r.session_token);try{t=await i.api.getCurrentUser()}catch(e){throw(0,i.setAccessToken)(s),e}let n={token:r.session_token,email:t.user.email,role:t.user.role,credits:t.user.credits,display_name:t.user.display_name,total_jobs_created:t.user.total_jobs_created,total_jobs_completed:t.user.total_jobs_completed};return e({user:n,isLoading:!1,isImpersonating:!0,originalAdminToken:s,impersonatedUserEmail:a}),!0}catch(t){return e({isLoading:!1,error:t instanceof Error?t.message:"Failed to impersonate user"}),!1}},endImpersonation:()=>{let{originalAdminToken:a}=t();a&&((0,i.setAccessToken)(a),e({isImpersonating:!1,originalAdminToken:null,impersonatedUserEmail:null}),t().fetchUser())}}),{name:"nomad-karaoke-auth",partialize:e=>({user:e.user}),onRehydrateStorage:()=>e=>{e?.setHasHydrated(!0)}}));(0,i.getAccessToken)()&&s.getState().fetchUser(),e.s(["useAuth",0,s])}]);