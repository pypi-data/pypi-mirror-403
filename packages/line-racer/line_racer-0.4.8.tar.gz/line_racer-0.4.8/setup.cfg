[build_ext]
inplace=1

[tox:tox]
# py is the default test environment ([testenv])
envlist = {py,py311},flake8
isolated_build = True
skipsdist = True

[testenv]
# Install line_racer in tox venv, use `--no-build-isolation` for the meson install to work
# Then run tests and coverage on the installed package
# Pass Gitlab's 'CI' environment variable
passenv =
    CI

commands =
    python -I -m pip install --no-build-isolation . -U -vvv
    pytest tests --cov={envsitepackagesdir}/line_racer --cov-report=term-missing

deps =
    meson-python
    ninja
    pytest
    pytest-cov
    numpy
    scipy
    pandas
    zarr>=3.0.0

[testenv:flake8]
commands = flake8 line_racer/
deps =
    flake8
skip_install = true

[coverage:run]
# Omit all modules starting with '_'
omit =
    */_*

[coverage:report]
omit =
    */_*

[flake8]
max-line-length = 120

[tool:pytest]
norecursedirs =
    .tox
    build
    docs
    line_racer
    scripts

