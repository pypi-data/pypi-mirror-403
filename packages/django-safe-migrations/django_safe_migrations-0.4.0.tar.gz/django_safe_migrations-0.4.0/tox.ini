[tox]
isolated_build = True
envlist =
    py39-django{32,42}
    py310-django{32,42,50,51}
    py311-django{42,50,51}
    py312-django{42,50,51,60}
    py313-django{42,50,51,60}
    lint
    typecheck

[testenv]
deps =
    django32: Django>=3.2,<4.0
    django42: Django>=4.2,<5.0
    django50: Django>=5.0,<5.1
    django51: Django>=5.1,<5.2
    django60: Django>=6.0,<6.1
    pytest>=7.0
    pytest-django>=4.5
    pytest-cov>=4.0
    pytest-xdist>=3.0
setenv =
    PYTHONDONTWRITEBYTECODE=1
    PYTHONWARNINGS=once::DeprecationWarning
commands =
    pytest tests -n 2 -q --tb=line --cov=django_safe_migrations --cov-report=term-missing {posargs}

[testenv:lint]
skip_install = true
deps =
    black>=22.0
    flake8>=5.0
    isort>=5.0
commands =
    black --check django_safe_migrations tests
    isort --check-only django_safe_migrations tests
    flake8 django_safe_migrations tests

[testenv:typecheck]
deps =
    mypy>=1.0
    django-stubs>=4.0
    Django>=4.2
commands =
    mypy django_safe_migrations

[testenv:format]
skip_install = true
deps =
    black>=22.0
    isort>=5.0
commands =
    black django_safe_migrations tests
    isort django_safe_migrations tests

[gh-actions]
python =
    3.9: py39
    3.10: py310
    3.11: py311
    3.12: py312
    3.13: py313

[flake8]
max-line-length = 88
extend-ignore = E203, W503, D100, D104
exclude = .git,.tox,.venv,build,dist,migrations
per-file-ignores =
    tests/*: D101,D102,D103
