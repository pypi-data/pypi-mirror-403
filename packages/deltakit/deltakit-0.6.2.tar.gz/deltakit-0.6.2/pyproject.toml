[build-system]
requires = ["setuptools>=80"]
build-backend = "setuptools.build_meta"

[project]
name = "deltakit"
version = "0.6.2"
description = "A Python toolkit to enable users with the design and execution of quantum error correction (QEC) experiments."
readme = "README.md"
requires-python = ">=3.10,<3.14"
license = "Apache-2.0"
license-files = ["LICENSE"]

authors = [{ name = "Deltakit Team", email = "deltakit@riverlane.com" }]

classifiers = [
  "Development Status :: 3 - Alpha",
  "Intended Audience :: Science/Research",
  "Intended Audience :: Developers",
  "Operating System :: OS Independent",
  "Programming Language :: Python",
  "Programming Language :: Python :: 3",
  "Programming Language :: Python :: 3 :: Only",
  "Programming Language :: Python :: 3.10",
  "Programming Language :: Python :: 3.11",
  "Programming Language :: Python :: 3.12",
  "Programming Language :: Python :: 3.13",
  "Programming Language :: Python :: Implementation :: CPython",
  "Topic :: Scientific/Engineering",
  "Topic :: Scientific/Engineering :: Quantum Computing",
  "Typing :: Typed",
]

dependencies = [
  "deltakit-circuit~=0.6",
  "deltakit-core~=0.6",
  "deltakit-decode~=0.6",
  "deltakit-explorer~=0.6",
]

[project.urls]
Homepage = "https://github.com/Deltakit/deltakit"
Source = "https://github.com/Deltakit/deltakit"
Documentation = "https://deltakit.riverlane.com/"
Issues = "https://github.com/Deltakit/deltakit/issues"
Changelog = "https://github.com/Deltakit/deltakit/releases"

[dependency-groups]
tests_extras = [
  "matplotlib~=3.10,>=3.10.7",
  "numpy~=2.0",
  "pandas~=2.2,>=2.2.2",
]
test = [
  "pytest>=9.0",
  "pytest-cov>=7.0",
  "pytest-skip-slow>=0.0.5",
  { include-group = "tests_extras" },
]
lint = ["mypy~=1.17", "ruff~=0.14", "typos~=1.34", "deptry~=0.23"]
docs_extras = [
  "tqdm~=4.67",
  "stim~=1.11; python_version >= '3.10' and python_version < '3.12'",
  "stim~=1.13; python_version >= '3.12' and python_version < '3.13'",
  "stim~=1.15; python_version >= '3.13'",
  "numpy~=2.0",
  "matplotlib~=3.10,>=3.10.7",
  "pandas~=2.2,>=2.2.2",
]
docs = [
  { include-group = "docs_extras" },
  "myst_nb>=1.0",
  "sphinxawesome-theme>=5.3",
  "sphinx-autodoc-typehints>=3.0",
  "sphinx-copybutton>=0.5",
  "sphinx-design>=0.6",
  "sphinx-autobuild>=2024.10.3",
  "myst-parser>=4.0",
  "vale>=3.12",
  "jupytext>=1.17",
  "jupyter>=1.1",
  "ipykernel>=6.29",
]
security = ["bandit~=1.8", "pip-audit~=2.7"]
dev = [
  { include-group = "test" },
  { include-group = "lint" },
  { include-group = "docs" },
  { include-group = "security" },
  # other
  "pre-commit~=4.2",
  "validate-pyproject~=0.24.1",
]
release = [
  "tomlkit~=0.14",
  "pip-licenses>=5.0",
  "python-semantic-release~=10.2",
]

[tool.uv.workspace]
members = [
  "deltakit-core",
  "deltakit-circuit",
  "deltakit-decode",
  "deltakit-explorer",
  "deltakit-compile",
]

[tool.uv.sources]
deltakit-core = { workspace = true }
deltakit-circuit = { workspace = true }
deltakit-decode = { workspace = true }
deltakit-explorer = { workspace = true }
deltakit-compile = { workspace = true }

[tool.mypy]
files = "src/**/*.py"

# The ldpc.mod2 stubs files contain syntax errors, and so make mypy fail earlier than expected
# with a SyntaxError. Ignoring the whole module for mypy.
[[tool.mypy.overrides]]
module = ["ldpc.mod2"]
follow_imports = "skip"
follow_imports_for_stubs = true

# for ruff configuration, see `ruff.toml`

[tool.pytest.ini_options]
# By default, pytest should test all of deltakit, including sub-packages.
testpaths = [
  "./tests/",
  "./deltakit-circuit/tests/",
  "./deltakit-core/tests/",
  "./deltakit-decode/tests/",
  "./deltakit-explorer/tests/",
]
addopts = ["-ra", "--showlocals", "--strict-markers", "--strict-config"]
xfail_strict = true
filterwarnings = [
  "error",
  # Note: the below line ignore a specific warning about changes in multiprocessing.
  # This warning is only raised by a few tests in deltakit-decode. This is a temporary
  # fix.
  "ignore:This process .* is multi-threaded, use of fork\\(\\) may lead to deadlocks in the child.:DeprecationWarning",
]

[tool.bandit]
exclude_dirs = ['.github', '.tox', '.venv', 'tools/vale.py']
skips = [
  'B101',
  'B311',
] # B101 is just use of `assert`; 'B311' is use of random module

[tool.typos.default]
locale = 'en-gb'

[tool.typos.default.extend-words]
# Don't correct "iy" - often used in the context of "probability of an IY operation"
iy = "iy"
anc = "anc"
BA = "BA"
youre = "you're"
distribtuion = "distribution"
interm = "interm"
ket = "ket"
ND = "ND"                         # part of NDArray
Alise = "Alise"
DEPOLARIZE = "DEPOLARIZE"
depolarization = "depolarization"
Authorization = "Authorization"   # Web-related field.
color = "color"                   # Used in matplotlib and stim APIs.
colors = "colors"
optimize = "optimize"             # scipy.optimize
ax = "ax"                         # Typical naming for matplotlib Axes instances.
center = "center"
stabilizer = "stabilizer"
stabilizers = "stabilizers"
synchronize = "synchronize"       # multiprocessing import
neighbors = "neighbors"
labeled = "labeled"
labeler = "labeler"

[tool.typos.files]
# Paths/patterns to exclude from spell checking
extend-exclude = [
  "docs/styles",
  "**/LICENSE",
  "**/*.html",
  "licenses.confluence",
]

[tool.semantic_release]
allow_zero_version = true
version_toml = ["pyproject.toml:project.version"]

[tool.semantic_release.branches.main]
match = "*"

[tool.semantic_release.branches.other]
match = ".*"

[tool.semantic_release.changelog]
exclude_commit_patterns = [
  '''task(?:\([^)]*?\))?: .+''',
  '''chore(?:\([^)]*?\))?: .+''',
  '''ci(?:\([^)]*?\))?: .+''',
  '''refactor(?:\([^)]*?\))?: .+''',
  '''style(?:\([^)]*?\))?: .+''',
  '''tests?(?:\([^)]*?\))?: .+''',
  '''build\((?!deps\): .+)''',
  '''release(?:\([^)]*?\))?: .+''',
  '''dev(?:\([^)]*?\))?: .+''',
  '''Initial [Cc]ommit.*''',
]
mode = "update"

[tool.semantic_release.commit_parser_options]
other_allowed_tags = [
  "build",
  "chore",
  "ci",
  "docs",
  "style",
  "refactor",
  "tests",
  "release",
  "dev",
]
allowed_tags = [
  "feat",
  "fix",
  "perf",
  "build",
  "chore",
  "ci",
  "docs",
  "style",
  "refactor",
  "tests",
  "release",
  "dev",
]

[tool.deptry]
extend_exclude = ["deltakit_*", "docs/", "tools/"]

[tool.coverage.report]
exclude_also = ["raise NotImplementedError", "return NotImplemented"]
skip_covered = true

[tool.coverage.run]
source_pkgs = [
  "deltakit_circuit",
  "deltakit_core",
  "deltakit_decode",
  "deltakit_explorer",
]
relative_files = true

[tool.coverage.paths]
deltakit_circuit = [
  "deltakit-circuit/src/deltakit_circuit",
  ".venv/lib/python*/site-packages/deltakit_circuit",
]
deltakit_core = [
  "deltakit-core/src/deltakit_core",
  ".venv/lib/python*/site-packages/deltakit_core",
]
deltakit_decode = [
  "deltakit-decode/src/deltakit_decode",
  ".venv/lib/python*/site-packages/deltakit_decode",
]
deltakit_explorer = [
  "deltakit-explorer/src/deltakit_explorer",
  ".venv/lib/python*/site-packages/deltakit_explorer",
]
