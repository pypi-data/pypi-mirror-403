{"version":3,"file":"main.LinoEditor_LinoBody.e60785bd75e7def92f4e.js","mappings":"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","sources":["webpack://lino_react/./lino_react/react/components/LinoEditor.jsx"],"sourcesContent":["export const name = \"LinoEditor\";\n\nimport React from \"react\";\nimport { RegisterImportPool } from \"./Base\";\nimport { LeafComponentInput } from \"./LinoComponentUtils\";\nimport * as constants from \"./constants\";\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nlet ex; const exModulePromises = ex = {\n    qm: import(/* webpackChunkName: \"quillmodules_LinoEditor\" */\"./quillmodules\"),\n};RegisterImportPool(ex);\n\n\nexport class LinoEditor extends LeafComponentInput {\n    static requiredModules = [\"qm\"].concat(LeafComponentInput.requiredModules);\n    static iPool = Object.assign(ex, LeafComponentInput.iPool.copy());\n\n    static defaultProps = {\n        ...LeafComponentInput.defaultProps,\n        leafIndex: 0,\n    }\n\n    constructor(props) {\n        super(props);\n        this.state = {...this.state,\n                      plain: props.elem.field_options.format === \"plain\"}\n\n        this.closeEditor = this.closeEditor.bind(this);\n        this.onGlobalKeyDown = this.onGlobalKeyDown.bind(this);\n    }\n\n    onReady() {\n        window.addEventListener('keydown', this.onGlobalKeyDown);\n    }\n\n    componentWillUnmount() {\n        window.removeEventListener('keydown', this.onGlobalKeyDown);\n    }\n\n    onGlobalKeyDown(e) {\n        if (e.code == 'Escape') this.closeEditor(e);\n    }\n\n    closeEditor() {\n        const { c } = this;\n        const DO = () => {\n            c.history.pushPath({\n                pathname: `/api/${c.value.packId}/${c.value.actorId}/${c.value.pk}`,\n                params: c.actionHandler.defaultStaticParams()\n            })\n        }\n        if (!c.isModified()) {DO()} else\n            c.actionHandler.discardModDConfirm({agree: DO});\n    }\n\n    headerExtend() {\n        return <span className=\"ql-formats\">\n            <button type='button'\n                onClick={async (e) => {\n                    const data = await this.c.actionHandler.submit({});\n                    if (data.success) this.closeEditor(e);\n                }}\n                aria-label='Submit changes'>\n                <i className=\"pi pi-save\"></i></button>\n            <button type='button'\n                onClick={this.closeEditor}\n                aria-label='Close window'>\n                <i className=\"pi pi-times\"></i></button>\n        </span>\n    }\n\n    render () {\n        if (!this.state.ready) return null;\n        const { APP } = this.c;\n        return <div className=\"l-editor\"\n            lang={this.c.value[constants.URL_PARAM_USER_LANGUAGE]}\n            onKeyDown={async (e) => {\n                if ((e.ctrlKey || e.metaKey) && e.code === \"KeyS\") {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    const data = await this.c.actionHandler.submit({});\n                    if (data.success) this.closeEditor(e);\n                } else if (e.code !== 'Escape') e.stopPropagation();\n            }}\n            spellCheck={!APP.state.site_data.disable_spell_check}>\n                <this.ex.qm.QuillEditor\n                    autoFocus={true}\n                    c={this.c}\n                    headerExtend={this.headerExtend()}\n                    htmlValue={this.state.plain ? null : this.getValue()}\n                    inGrid={false}\n                    parent={this}\n                    plain={this.state.plain}\n                    showHeader={true}\n                    value={this.state.plain ? this.getValue() : null} />\n        </div>\n    }\n}\n"],"names":["ex","name","qm","RegisterImportPool","LinoEditor","_LeafComponentInput","props","_this","_classCallCheck","state","_objectSpread","plain","elem","field_options","format","closeEditor","bind","onGlobalKeyDown","_inherits","_createClass","key","value","window","addEventListener","this","removeEventListener","e","code","c","DO","history","pushPath","pathname","concat","packId","actorId","pk","params","actionHandler","defaultStaticParams","isModified","discardModDConfirm","agree","_this2","React","className","type","onClick","_ref","_asyncToGenerator","_regeneratorRuntime","_callee","_context","prev","next","submit","sent","success","stop","_x","apply","arguments","_this3","ready","APP","lang","constants","onKeyDown","_ref2","_callee2","_context2","ctrlKey","metaKey","stopPropagation","preventDefault","_x2","spellCheck","site_data","disable_spell_check","QuillEditor","autoFocus","headerExtend","htmlValue","getValue","inGrid","parent","showHeader","LeafComponentInput","requiredModules","iPool","Object","assign","copy","defaultProps","leafIndex"],"ignoreList":[],"sourceRoot":""}