{"version":3,"file":"main.DashboardItems_SiteContext.db6580226a3454b431fe.js","mappings":"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","sources":["webpack://lino_react/./lino_react/react/components/DashboardItems.jsx"],"sourcesContent":["export const name = \"DashboardItems\";\n\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { RegisterImportPool, Component } from \"./Base\";\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nlet ex; const exModulePromises = ex = {\n    lm: import(/* webpackChunkName: \"LoadingMask_DashboardItems\" */\"./LoadingMask\"),\n    prButton: import(/* webpackChunkName: \"prButton_DashboardItems\" */\"primereact/button\"),\n    queryString: import(/* webpackChunkName: \"queryString_DashboardItems\" */\"query-string\"),\n};RegisterImportPool(ex);\n\n\nclass DashboardItem extends Component {\n    static requiredModules = ['lm', 'queryString', 'prButton'];\n    static iPool = ex;\n\n    static propTypes = {\n        itemIndex: (props, ...args) => {\n            if (!props.dashboardMain) return PropTypes.number.isRequired(props, ...args);\n        },\n        dashboardMain: PropTypes.bool.isRequired,\n        APP: PropTypes.object.isRequired\n    }\n    static defaultProps = {\n        dashboardMain: false\n    }\n    async prepare() {\n        super.prepare();\n        this.ex.queryString = this.ex.queryString.default;\n    }\n    constructor(props) {\n        super(props);\n        this.state = {...this.state, data: null, mask: true, actorID: null}\n        this.reload = this.reloadData;\n    }\n\n    onReady() {\n        this.reloadData();\n    }\n\n    liveUpdate = (params) => this.reload();\n\n    /**\n    * @param {bool} selfInit self-initiated reload through the refresh button\n    */\n    reloadData = (selfInit) => {\n        this.setState({mask: true});\n        const query = {fmt: 'json'}, { APP } = this.props,\n            { actionHandler } = APP.URLContext;\n        actionHandler.commonParams(query);\n        const path = this.props.dashboardMain ? 'api/main_html' : `dashboard/${this.props.itemIndex}`;\n        actionHandler.silentFetch({\n            path: `${path}?${this.ex.queryString.stringify(query)}`,\n            signal: actionHandler.abortController.signal\n        }).then((data) => {\n            if (data.version_mismatch && (this.props.itemIndex === 0 || selfInit)) {\n                APP.reload();\n                return;\n            }\n            this.setState({data: data.html, mask: false, actorID: data.actorID});\n        })\n    }\n\n    render() {\n        if (!this.state.ready) return null;\n        const {data} = this.state;\n        if (!this.props.APP.URLContext.filled(data)) return null;\n        return <this.ex.lm.LoadingMask mask={this.state.mask}>\n            {!this.props.dashboardMain && <this.ex.prButton.Button\n                icon=\"pi pi-refresh\" style={{float: 'right'}}\n                onClick={(e) => {\n                    this.reloadData(true);\n                }}/>}\n            <div dangerouslySetInnerHTML={{__html: data}}/>\n        </this.ex.lm.LoadingMask>\n    }\n}\n\n\nexport class DashboardItems extends Component {\n    static propTypes = {\n        APP: PropTypes.object.isRequired\n    };\n    constructor(props) {\n        super(props);\n        this.state = {\n            ...this.state,\n            items: Array((props.APP.state.user_settings.dashboard_items || 0) + 1)\n        };\n        this.reloadData = this.reload;\n    }\n\n    reload() {\n        this.props.APP.URLContext.actionHandler.clearRequestPool();\n        this.state.items.forEach((item, i) => {\n            item.reload()\n        });\n    }\n\n    render() {\n        if (!this.state.ready) return null;\n        return <div>\n            {[...this.state.items.keys()].map(i =>\n                <DashboardItem\n                    dashboardMain={i === 0} itemIndex={i - 1} APP={this.props.APP}\n                    key={i} ref={ref => this.state.items[i] = ref}/>\n            )}\n        </div>\n    }\n}\n"],"names":["ex","name","lm","prButton","queryString","RegisterImportPool","DashboardItem","_Component","props","_this","_classCallCheck","_callSuper","_initialiseProps","call","state","_objectSpread","data","mask","actorID","reload","reloadData","_inherits","_createClass","key","value","_prepare","_asyncToGenerator","_regeneratorRuntime","_callee","_context","prev","next","_superPropGet","this","stop","apply","arguments","_this2","ready","APP","URLContext","filled","React","LoadingMask","dashboardMain","Button","icon","style","float","onClick","e","dangerouslySetInnerHTML","__html","Component","requiredModules","iPool","propTypes","itemIndex","_PropTypes$number","_len","length","args","Array","_key","PropTypes","isRequired","concat","defaultProps","_this5","liveUpdate","params","selfInit","setState","query","fmt","actionHandler","commonParams","path","silentFetch","stringify","signal","abortController","then","version_mismatch","html","DashboardItems","_Component2","_this3","items","user_settings","dashboard_items","clearRequestPool","forEach","item","i","_this4","_toConsumableArray","keys","map","ref"],"ignoreList":[],"sourceRoot":""}