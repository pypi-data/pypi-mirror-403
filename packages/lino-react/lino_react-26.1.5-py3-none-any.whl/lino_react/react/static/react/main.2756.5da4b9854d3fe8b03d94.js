"use strict";(self.webpackChunklino_react=self.webpackChunklino_react||[]).push([[2756],{2756:(e,t,n)=>{n.r(t),n.d(t,{ABCComponent:()=>C,Labeled:()=>R,LeafComponentBase:()=>O,LeafComponentDelayedValue:()=>D,LeafComponentInput:()=>L,LeafComponentInputChoices:()=>N,maintainTableWidth:()=>W,name:()=>T});var a=n(8168),l=n(467),i=n(4467),r=n(991),o=n(6822),s=n(3954),u=n(5501),p=n(3029),d=n(2901),c=n(4756),h=n.n(c),f=n(6540),m=n(5556),_=n.n(m),y=n(6606),v=n(8524);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){(0,i.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function b(e,t,n,a){var l=(0,r.A)((0,s.A)(1&a?e.prototype:e),t,n);return 2&a&&"function"==typeof l?function(e){return l.apply(n,e)}:l}function E(e,t,n){return t=(0,s.A)(t),(0,o.A)(e,A()?Reflect.construct(t,n||[],(0,s.A)(e).constructor):t.apply(e,n))}function A(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(A=function(){return!!e})()}var P,T="LinoComponentUtils";P={classNames:n.e(4166).then(n.t.bind(n,6942,23)),prDropdown:Promise.all([n.e(8026),n.e(7134),n.e(8887),n.e(5573),n.e(7335),n.e(9685),n.e(6836),n.e(6799),n.e(5350)]).then(n.bind(n,8485)),prInputText:Promise.all([n.e(8026),n.e(9109),n.e(8887),n.e(5573),n.e(7335),n.e(9685),n.e(2123)]).then(n.bind(n,413)),queryString:Promise.all([n.e(4166),n.e(2298)]).then(n.bind(n,8091)),sc:Promise.resolve().then(n.bind(n,5614)),u:Promise.resolve().then(n.bind(n,7540))};function W(e){var t=this,n=Object.keys(this.flexs);(void 0!==e?n.length===e:n.length>1)&&n.forEach(function(e){var n=document.getElementById(e).getElementsByClassName("p-datatable");1===n.length&&((n=n[0]).getBoundingClientRect().width/document.getElementsByClassName("layout-topbar")[0].getBoundingClientRect().width>t.flexs[e]&&Array.from(n.querySelectorAll(".p-datatable table")).forEach(function(e){Array.from(e.classList).join(" ").includes("p-datatable")&&e.style.setProperty("table-layout","auto")}))})}(0,y.RegisterImportPool)(P);var R=function(e){var t=e.actions,n=void 0===t?[]:t,a=e.label,l=e.elem,i=e.children,r=e.hide_label,o=void 0!==r&&r,s=e.isFilled,u=void 0!==s&&s,p=(0,y.getExReady)(P,["classNames"]);return a=a||l.label,p.ready?f.createElement(f.Fragment,null,!o&&a&&f.createElement(f.Fragment,null,f.createElement("label",{className:p.classNames.default("l-label","l-span-clickable",{"l-label--unfilled":!u}),title:Object.assign({},l.value||{}).quicktip||l.help_text},a,n.map(function(e,t){return f.createElement(f.Fragment,{key:t}," | ",f.createElement("span",{dangerouslySetInnerHTML:{__html:e}}))}),":"),f.createElement("br",null)),i):null};R.propTypes={actions:_().array,label:_().string,elem:_().object.isRequired,hide_label:_().bool,isFilled:_().bool,children:_().element.isRequired};var C=function(){return(0,d.A)(function e(){(0,p.A)(this,e)},null,[{key:"getValueByName",value:function(e){var t=e.name,n=e.props,a=e.context;return n[v.URL_PARAM_WINDOW_TYPE]===v.WINDOW_TYPE_PARAMS?a.param_values[t]:n[v.URL_PARAM_WINDOW_TYPE]===v.WINDOW_TYPE_TABLE?a.rows[n.column.rowIndex][t]:n[v.URL_PARAM_WINDOW_TYPE]===v.WINDOW_TYPE_CARDS?a[t]:a.data[t]}}])}(),O=function(e){function t(e,n){var a;return(0,p.A)(this,t),(a=E(this,t,[e,n])).filled=function(){return!["",null,void 0].includes(a.getValue())},a.wrapperClasses=[],a.dataKey=e[v.URL_PARAM_WINDOW_TYPE]===v.WINDOW_TYPE_TABLE?e.elem.fields_index:e.elem.name,a.upController=e.urlParams.controller,a.c=e.urlParams.controller,a.filled=a.filled.bind(a),a.getValue=a.getValue.bind(a),a.getValueByName=a.getValueByName.bind(a),a.innerHTML=a.innerHTML.bind(a),a.setLeafRef=a.setLeafRef.bind(a),a}return(0,u.A)(t,e),(0,d.A)(t,[{key:"getValueByName",value:function(e){return C.getValueByName({name:e,props:this.props,context:this.context})}},{key:"getValue",value:function(){return this.getValueByName(this.dataKey)}},{key:"formatValue",value:function(e){return e}},{key:"innerHTML",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.formatValue(this.getValue());return this.c.filled(n)||(n=" "),n instanceof Object&&(n=JSON.stringify(n)),e?f.createElement("div",{style:t,dangerouslySetInnerHTML:{__html:n}}):f.createElement("div",{style:t},n)}},{key:"setLeafRef",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.input,n=void 0!==t&&t,a=e.type,l=void 0===a?"":a;this.props[v.URL_PARAM_WINDOW_TYPE]!==v.WINDOW_TYPE_DETAIL&&this.props[v.URL_PARAM_WINDOW_TYPE]!==v.WINDOW_TYPE_INSERT||(this.upController.dataContext.setLeafRef({name:"slave"===l?this.actorID:this.props.elem.name,ref:this,input:n,type:l}),this.props.urlParams.controller.onLeafMount())}}])}(y.Component);O.requiredModules=["classNames"],O.iPool=P,O.contextType=y.DataContextType,O.propTypesFromLinoLayout=(0,i.A)((0,i.A)({column:_().object,editing_mode:_().bool,hide_label:_().bool},v.URL_PARAM_WINDOW_TYPE,_().oneOf([v.WINDOW_TYPE_TABLE,v.WINDOW_TYPE_DETAIL,v.WINDOW_TYPE_CARDS,v.WINDOW_TYPE_GALLERIA,v.WINDOW_TYPE_INSERT,v.WINDOW_TYPE_PARAMS,v.WINDOW_TYPE_UNKNOWN])),"tabIndex",_().number.isRequired),O.propTypes=I(I({},O.propTypesFromLinoLayout),{},{elem:_().object.isRequired,urlParams:_().object.isRequired,leafIndex:_().number.isRequired}),O.defaultProps=(0,i.A)({editing_mode:!1,hide_label:!1},v.URL_PARAM_WINDOW_TYPE,v.WINDOW_TYPE_UNKNOWN);var D=function(e){function t(e,n){var a,l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,p.A)(this,t),(a=E(this,t,[e,n])).liveUpdate=function(e){(null==e.mk||e.mk===a.state.mk&&e.mt===a.state.mt)&&a.update()},a.delayed=!!e.elem.delayed_value;var i={};return e.hasOwnContext||Object.assign(i,a.upController.actionHandler.masterRelateForSlave()),a.state=I(I(I({},a.state),{},{value:null,data_url:null},i),{},{key:a.upController.newSlug(),haveCTX:a.delayed&&!l}),a.state.UCMount=!a.state.haveCTX||!a.delayed,a.actorID=e.elem.actor_id||(e.elem.name.includes(".")?e.elem.name:"".concat(e.urlParams.packId,".").concat(e.elem.name)),a.shouldComponentUpdate=a.shouldComponentUpdate.bind(a),a.getData=a.getData.bind(a),a.getValue=a.getValue.bind(a),a.update=a.update.bind(a),a}return(0,u.A)(t,e),(0,d.A)(t,[{key:"onReady",value:function(){var e=b(t,"getValue",this,3)([]);this.delayed?(this.props.hasOwnContext||this.setLeafRef({type:"slave"}),this.upController.globals.panels[this.actorID]=this,null!==e?this.getData(e.delayed_value_url):this.setState({value:" ",data_url:void 0})):this.setState({value:e})}},{key:"shouldComponentUpdate",value:function(e,n,a){var l=b(t,"getValue",this,3)([]),i=this.state.value!==n.value||this.state.UCMount!==n.UCMount||this.state.ready!==n.ready;return this.delayed&&(i=i||null!==this.state.value&&(l||{}).delayed_value_url!==this.state.data_url),i}},{key:"componentDidUpdate",value:function(e,n){var a=b(t,"getValue",this,3)([]);this.delayed?this.state.data_url!==(a||{}).delayed_value_url&&(this.setState({value:null}),null!==a?this.update():this.setState({value:" ",data_url:void 0})):this.setState({value:a})}},{key:"componentWillUnmount",value:function(){delete this.upController.globals.panels[this.actorID]}},{key:"getValue",value:function(){return this.state.value}},{key:"getData",value:function(e){var t=this;if(this.state.UCMount){var n=this.props.urlParams.controller.actionHandler.getParams();n[v.URL_PARAM_REQUESTING_PANEL]=this.upController.actionHandler.refName,this.upController.actionHandler.silentFetch({path:"".concat(e,"?").concat(this.ex.queryString.default.stringify(n))}).then(function(n){t.setState({value:n.data,buttons:n.buttons,data_url:e}),t.upController.root.setState({})})}}},{key:"update",value:function(){this.getData(b(t,"getValue",this,3)([]).delayed_value_url)}},{key:"getChildren",value:function(){throw"NotImplemented"}},{key:"render",value:function(){var e=this;if(!this.state.ready)return null;var t=this.props.urlParams.controller;return this.state.haveCTX?f.createElement(this.ex.sc.URLContext,{getChildren:function(t){return t.controller.setContextType(v.CONTEXT_TYPE_SLAVE_GRID),e.getChildren()},params:t.actionHandler.masterRelateForSlave(),parentContext:t,path:"/api/".concat(this.actorID.split(".").join("/")),onContextReady:function(t){e.upController=t.controller,e.setState({UCMount:!0})},simple:!1,summary:this}):this.getChildren()}}])}(O);D.requiredModules=["queryString","sc"].concat(O.requiredModules),D.propTypes=I(I({},O.propTypes),{},{hasOwnContext:_().bool.isRequired}),D.defaultProps=I(I({},O.defaultProps),{},{hasOwnContext:!1});var L=function(e){function t(e,n){var a;return(0,p.A)(this,t),(a=E(this,t,[e,n])).wrapperClasses.push("lino-input-leaf"),a.state=I(I({},a.state),{},{textSelected:!1}),a.styleClasses=["disabled-input","l-card","unsaved-modification"],a.clockTimer=null,a.disabled=a.disabled.bind(a),a.filled=a.filled.bind(a),a.focus=a.focus.bind(a),a.getCellStyleClasses=a.getCellStyleClasses.bind(a),a.getLinoInput=a.getLinoInput.bind(a),a.onChangeUpdate=a.onChangeUpdate.bind(a),a.onInputRef=a.onInputRef.bind(a),a.onKeyDown=a.onKeyDown.bind(a),a.onRef=a.onRef.bind(a),a.setCellStyle=a.setCellStyle.bind(a),a.submit=a.submit.bind(a),a.leafIndexMatch=a.leafIndexMatch.bind(a),a.update=a.update.bind(a),a}return(0,u.A)(t,e),(0,d.A)(t,[{key:"prepare",value:(n=(0,l.A)(h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.inputState={inputComponent:this.ex.prInputText.InputText,inputOnly:!1,inputProps:{},onChangeUpdateAssert:function(){return!0},postOnChange:function(){return null},getValueFromEvent:function(e){return e.target.value}},this.setLeafRef({input:!0});case 1:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"disabled",value:function(){if(this.props[v.URL_PARAM_WINDOW_TYPE]===v.WINDOW_TYPE_CARDS)return!0;if(this.props[v.URL_PARAM_WINDOW_TYPE]===v.WINDOW_TYPE_PARAMS)return!1;if(!this.props.elem.editable)return!0;if(this.props[v.URL_PARAM_WINDOW_TYPE]===v.WINDOW_TYPE_TABLE){var e=this.context.rows[this.props.column.rowIndex],t=e[e.length-1];return!(!t||!t.meta||t.phantom)&&(!!e[e.length-2]||(e[e.length-3][this.props.elem.name]||!1))}return!!this.context.data.disable_editing||(this.context.data.disabled_fields[this.props.elem.name]||!1)}},{key:"findHTMLInputElement",value:function(e){return e?(e.focusInput?e=e.focusInput:e.inputRef?e=e.inputRef.current:Object.prototype.hasOwnProperty.call(e,"getInput")&&(e=e.getInput()),e):e}},{key:"select",value:function(e){var t=this;if(""==getSelection().toString()){var n=function(e){t.state.textSelected=!0,e.select()};e.select?n(e):(this.container&&(e=this.container.getElementsByTagName("input")[0]),e&&e.select&&n(e))}}},{key:"focus",value:function(){var e=this.findHTMLInputElement(this.inputEl);e&&!this.focusSet&&(e.focus?e.focus():e.click&&e.click(),this.focusSet=!0)}},{key:"getCellStyleClasses",value:function(e){var t=[];return this.props[v.URL_PARAM_WINDOW_TYPE]===v.WINDOW_TYPE_TABLE?this.context.modifiedRows[this.props.column.rowIndex].includes(this.props.elem.fields_index)&&t.push("unsaved-modification"):(t.push("l-card"),this.props[v.URL_PARAM_WINDOW_TYPE]!==v.WINDOW_TYPE_CARDS&&(e?t.push("disabled-input"):this.context.modified.includes(this.props.elem.name)&&t.push("unsaved-modification"))),t}},{key:"getValue",value:function(){var e=b(t,"getValue",this,3)([]);return this.c.filled(e)||(e=""),e}},{key:"getLinoInput",value:function(){var e=this;return f.createElement(this.inputState.inputComponent,(0,a.A)({autoFocus:this.leafIndexMatch(),onChange:function(t){e.inputState.onChangeUpdateAssert(t)&&(e.onChangeUpdate(t),e.inputState.postOnChange(t))},onFocus:function(t){e.select(t.target)},ref:this.onInputRef,style:{width:"100%"},tabIndex:this.props.tabIndex,value:this.getValue()},this.inputState.inputProps))}},{key:"onChangeUpdate",value:function(e){this.update((0,i.A)({},this.dataKey,this.inputState.getValueFromEvent(e))),this.setState({})}},{key:"onInputRef",value:function(e){this.inputEl=e}},{key:"onKeyDown",value:function(e){"Escape"===e.code&&this.props[v.URL_PARAM_WINDOW_TYPE]===v.WINDOW_TYPE_DETAIL&&this.props.editing_mode&&this.ex.u.toggleEditingMode(this.props.urlParams)}},{key:"onRef",value:function(e){var t=this;this.container=e;var n=this.disabled(),a=function(){t.container.onclick=function(){!function(){if(!n){var e=window.getSelection();e&&e.toString().length>0||(Object.assign(t.upController.globals,{currentInputRowIndex:Object.assign({rowIndex:0},t.props.column).rowIndex,currentInputIndex:t.props.leafIndex,currentInputWindowType:t.props[v.URL_PARAM_WINDOW_TYPE],currentInputAHRefName:t.upController.actionHandler.refName}),t.props[v.URL_PARAM_WINDOW_TYPE]===v.WINDOW_TYPE_DETAIL&&(t.props.editing_mode?t.state.textSelected?t.setState({textSelected:!1}):t.select(t.findHTMLInputElement(t.inputEl)):t.upController.history.replaceState({editing_mode:!0})))}}()}};e&&(this.props[v.URL_PARAM_WINDOW_TYPE]===v.WINDOW_TYPE_TABLE?(this.container=e.closest("td"),a()):this.props[v.URL_PARAM_WINDOW_TYPE]!==v.WINDOW_TYPE_DETAIL&&this.props[v.URL_PARAM_WINDOW_TYPE]!==v.WINDOW_TYPE_INSERT||a()),this.setCellStyle(this.container,n)}},{key:"setCellStyle",value:function(e,t){if(e){var n=this.getCellStyleClasses(t);this.styleClasses.forEach(function(t){e.classList.remove(t)}),n.forEach(function(t){e.classList.add(t)})}}},{key:"submit",value:function(){this.upController.actionHandler.submit({cellInfo:{rowIndex:this.props.column.rowIndex}})}},{key:"leafIndexMatch",value:function(){return(this.props[v.URL_PARAM_WINDOW_TYPE]!==v.WINDOW_TYPE_TABLE||this.props.column.rowIndex===this.upController.globals.currentInputRowIndex)&&(this.props[v.URL_PARAM_WINDOW_TYPE]===this.upController.globals.currentInputWindowType&&this.upController.actionHandler.refName===this.upController.globals.currentInputAHRefName&&this.props.leafIndex===this.upController.globals.currentInputIndex)}},{key:"update",value:function(e){this.upController.actionHandler.update({values:e,elem:this.props.elem,col:this.props.column,windowType:this.props[v.URL_PARAM_WINDOW_TYPE]})}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props.hide_label;if(!this.state.ready)return null;var t=this.disabled();return this.container&&this.setCellStyle(this.container,t),f.createElement(R,(0,a.A)({},this.props,{actions:(this.context.field_actions||{})[this.props.elem.name]||[],hide_label:e,elem:this.props.elem,isFilled:this.filled()}),f.createElement("div",{className:this.ex.classNames.default(this.wrapperClasses,{"lino-disabled-leaf":t}),onKeyDown:this.onKeyDown,ref:this.onRef},this.inputState.inputOnly||this.props.editing_mode&&!t?this.getLinoInput():this.innerHTML()))}}]);var n}(O);L.requiredModules=["prInputText","u"].concat(O.requiredModules);var N=function(e){function t(e,n){var a;return(0,p.A)(this,t),(a=E(this,t,[e,n])).onKeyDown=function(e){b(t,"onKeyDown",a,3)([e]),"Enter"===e.key&&a.inputEl.getOverlay()&&e.stopPropagation()},a.wrapperClasses.push("l-ChoiceListFieldElement"),a.state=I(I({},a.state),{},{hidden_value:null}),a.dataKeyHidden=e[v.URL_PARAM_WINDOW_TYPE]===v.WINDOW_TYPE_TABLE?e.elem.fields_index_hidden:e.elem.name+"Hidden",a.getLinoInput=a.getLinoInput.bind(a),a.getValue=a.getValue.bind(a),a.innerHTML=a.innerHTML.bind(a),a}return(0,u.A)(t,e),(0,d.A)(t,[{key:"getValue",value:function(){return{text:b(t,"getValue",this,3)([]),value:this.getValueByName(this.dataKeyHidden)}}},{key:"getLinoInput",value:function(){var e=this;return f.createElement(this.ex.prDropdown.Dropdown,{autoFocus:this.leafIndexMatch(),itemTemplate:function(e){return f.createElement("div",{dangerouslySetInnerHTML:{__html:e.text}})},onChange:function(t){t.originalEvent.ctrlKey||t.originalEvent.altKey||(e.update((0,i.A)((0,i.A)({},e.dataKey,t.value||null),e.dataKeyHidden,t.value||null)),e.setState({}))},onFocus:function(t){e.select(t.target)},optionLabel:"text",options:this.options,ref:function(t){return e.inputEl=t},showClear:this.props.elem.field_options.allowBlank,style:{width:"100%"},tabIndex:this.props.tabIndex,value:this.getValue().value,valueTemplate:function(e){return e?f.createElement("div",{dangerouslySetInnerHTML:{__html:e.text}}):f.createElement("div",null," ")}})}},{key:"innerHTML",value:function(){var e=b(t,"getValue",this,3)([]);return this.c.filled(e)||(e=" "),f.createElement("div",{dangerouslySetInnerHTML:{__html:e}})}}])}(L);N.requiredModules=["prDropdown"].concat(L.requiredModules)}}]);
//# sourceMappingURL=main.2756.5da4b9854d3fe8b03d94.js.map