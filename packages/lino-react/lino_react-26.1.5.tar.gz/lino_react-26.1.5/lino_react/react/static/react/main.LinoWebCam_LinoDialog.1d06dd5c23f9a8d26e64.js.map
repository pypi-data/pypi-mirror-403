{"version":3,"file":"main.LinoWebCam_LinoDialog.1d06dd5c23f9a8d26e64.js","mappings":"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","sources":["webpack://lino_react/./lino_react/react/components/i18n.js","webpack://lino_react/./lino_react/react/components/LinoWebCam.tsx"],"sourcesContent":["import { URL_PARAM_USER_LANGUAGE, PARAM_TYPE_WINDOW, debugMessage } from './constants';\nimport i18n from \"i18next\";\nimport LanguageDetector from \"i18next-browser-languagedetector\";\nimport HttpApi from \"i18next-http-backend\";\nimport { initReactI18next } from \"react-i18next\";\n\n\nexport const TransInit = (context, next) => {\n    const detector = new LanguageDetector();\n    detector.addDetector({\n        name: \"LinoLanguageDetector\",\n        lookup: (options) => {\n            return context.value[URL_PARAM_USER_LANGUAGE];\n        },\n        cacheUserLanguage(lng, options) {\n            context.fillPlaceHolder(PARAM_TYPE_WINDOW, URL_PARAM_USER_LANGUAGE, lng);\n            context.history.replaceByType({[URL_PARAM_USER_LANGUAGE]: lng},\n                PARAM_TYPE_WINDOW, false, true);\n            debugMessage(\"LinoLanguageDetector: cached language\", lng);\n        }\n    });\n\n    i18n\n    .use(HttpApi)\n    .use(detector)\n    .use(initReactI18next)\n    .init({\n        debug: false,\n        load: \"languageOnly\",\n        fallbackLng: window.Lino.i18nFallbackLng,\n        keySeparator: false,\n        interpolation: {\n          escapeValue: false // react already safes from xss\n        },\n        react: {\n            useSuspense: true\n        },\n        backend: {\n            loadPath: \"/static/react/locales/{{lng}}/{{ns}}.json\",\n            // addPath: \"/static/react/locales/{{lng}}/{{ns}}.json\"\n        },\n        detection: {\n            order: [\"queryString\", \"cookie\", \"LinoLanguageDetector\", \"localStorage\"],\n            lookupQuerystring: URL_PARAM_USER_LANGUAGE,\n            lookupCookie: URL_PARAM_USER_LANGUAGE,\n            lookupLocalStorage: URL_PARAM_USER_LANGUAGE,\n            // lookupSessionStorage: URL_PARAM_USER_LANGUAGE\n            caches: [\"LinoLanguageDetector\", \"localStorage\", \"cookie\"],\n        }\n    });\n\n    next(i18n);\n}\n\n\nexport default i18n;\n","// LinoWebCam.tsx\n/** @module LinoWebCam */\n\nexport const name: string = \"LinoWebCam\";\n\n// @ts-ignore\nimport * as React from 'react';\n// @ts-ignore\nimport PropTypes from 'prop-types';\nimport * as t from './types';\nimport { RegisterImportPool, getExReady, URLContextType } from \"./Base\";\n\n// @ts-ignore\nimport Webcam from \"react-webcam\";\n\n// @ts-ignore\nimport(/* webpackChunkName: \"ReactImageCropCSS_LinoWebCam\" */'react-image-crop/dist/ReactCrop.css');\n\nlet ex; const exModulePromises = ex = {\n    // @ts-ignore\n    prButton: import(/* webpackChunkName: \"prButton_LinoWebCam\" */\"primereact/button\"),\n    // @ts-ignore\n    prOverlayPanel: import(/* webpackChunkName: \"prOverlayPanel_LinoWebCam\" */\"primereact/overlaypanel\"),\n    // @ts-ignore\n    prInputNumber: import(/* webpackChunkName: \"prInputNumber_LinoWebCam\" */\"primereact/inputnumber\"),\n    // @ts-ignore\n    prInputSwitch: import(/* webpackChunkName: \"prInputSwitch_LinoWebCam\" */\"primereact/inputswitch\"),\n    // @ts-ignore\n    lcu: import(/* webpackChunkName: \"LinoComponentUtils_LinoWebCam\" */\"./LinoComponentUtils\"),\n    // @ts-ignore\n    i18n: import(/* webpackChunkName: \"i18n_LinoWebCam\" */\"./i18n\"),\n    imageCrop: import(/* webpackChunkName: \"ReactImageCrop_LinoWebCam\" */\"react-image-crop\"),\n};RegisterImportPool(ex);\n\ntype WebcamState = {\n    err_msg?: null | string;\n    deviceId?: null | string;\n    devices?: string[];\n}\n\ntype WCReferences = {\n    capture?: React.MouseEventHandler<HTMLElement>;\n    props?: LinoWebCamProps;\n    self?: CamController;\n    setState?: Function;\n    state?: WebcamState;\n    switchCamera?: React.MouseEventHandler<HTMLElement>;\n    webcamRef?: React.RefObject<Webcam>;\n}\n\ninterface CamController {\n    buildMediaConstraints(): MediaTrackConstraints;\n    mediaTrackConstraints: MediaTrackConstraints;\n    store: WCReferences;\n    settings: t.WebcamSettings;\n    settingsMod: t.WebcamSettings;\n}\n\nclass CamController implements CamController {\n    static buildReferences = (store: WCReferences): WCReferences => {\n        store.webcamRef = React.useRef(null);\n        store.capture = React.useCallback(\n            (event) => {\n                store.props.captureDone(store.webcamRef.current.getScreenshot());\n            },\n        [store.webcamRef]);\n\n        const [state, setState] = React.useState<WebcamState>({\n            err_msg: null, deviceId: null, devices: []});\n\n        store.state = state;\n        store.setState = React.useCallback((st: WebcamState) =>\n            setState((old: WebcamState) => Object.assign({}, old, st)), []);\n\n        store.switchCamera = React.useCallback(\n            event => {\n                let i = (state.devices.indexOf(state.deviceId) + 1) % state.devices.length;\n                store.setState({deviceId: state.devices[i]});\n            },\n        []);\n        return store;\n    }\n\n    constructor(store: WCReferences) {\n        this.store = store;\n        this.buildMediaConstraints();\n    }\n\n    buildMediaConstraints(): MediaTrackConstraints {\n        const constraints: MediaTrackConstraints = {};\n        this.settings = window.App.getSettings().webcam;\n        if (this.settings !== undefined) {\n            constraints.height = this.settings.height;\n            constraints.width = this.settings.width;\n        } else {\n            constraints.height = this.store.props.height * devicePixelRatio;\n            constraints.width = this.store.props.width * devicePixelRatio;\n            this.settings = Object.assign({}, constraints as t.WebcamSettings, {pixelRatio: devicePixelRatio, mirrored: true});\n            window.App.setSettings({webcam: this.settings});\n        }\n        this.settingsMod = {...this.settings};\n        if (this.store.state.deviceId) constraints.deviceId = this.store.state.deviceId\n        else constraints.facingMode = \"environment\";\n        this.mediaTrackConstraints = constraints;\n        return constraints;\n    }\n}\n\ntype LinoWebCamProps = {\n    captureDone: (data: string) => void;\n    height: number;\n    width: number;\n}\n\ntype CamSettingsProps = {CC: CamController};\n\nconst CamSettings: React.FC<CamSettingsProps> = (props) => {\n    const {settings, settingsMod} = props.CC;\n    const [mirrored, setMirrored] = React.useState<boolean>(settings.mirrored);\n    const localEx = getExReady(ex, [\"prInputNumber\", \"prInputSwitch\", \"lcu\", \"i18n\"], (mods) => {\n        mods.i18n = mods.i18n.default;\n    });\n    const getInput = React.useCallback(\n        ({label, max = null, min, onValueChange, suffix, value}) => (<div>\n            <localEx.lcu.Labeled elem={{label: label}}>\n                <localEx.prInputNumber.InputNumber buttonLayout=\"horizontal\"\n                    max={max} min={min} onValueChange={onValueChange}\n                    showButtons={true} suffix={suffix} value={value}/>\n            </localEx.lcu.Labeled></div>), [localEx]);\n    return !localEx.ready ? null : <>\n        {// TODO: interpolation translate\n            getInput({label: 'Height (# > 512)', max: props.CC.store.props.height,\n            min: 512, onValueChange: (e) => Object.assign(settingsMod,\n                {height: e.value * settingsMod.pixelRatio}),\n            suffix: 'px', value: settings.height / settings.pixelRatio})}\n        <br/>\n        {getInput({label: 'Width (# > 512)', max: props.CC.store.props.width,\n            min: 512, onValueChange: (e) => Object.assign(settingsMod,\n                {width: e.value * settingsMod.pixelRatio}),\n            suffix: 'px', value: settings.width / settings.pixelRatio})}\n        <br/>\n        {getInput({label: 'Pixel ratio (# > 1)', min: 1, onValueChange: (e) => {\n                Object.assign(settingsMod, {\n                    height: (settingsMod.height / settingsMod.pixelRatio) * e.value,\n                    width: (settingsMod.width / settingsMod.pixelRatio) * e.value,\n                    pixelRatio: e.value});\n            }, suffix: 'dpr', value: settings.pixelRatio})}\n        <br/>\n        <div>\n            <localEx.lcu.Labeled elem={{label: localEx.i18n.t(\"Mirrored\")}}>\n                <localEx.prInputSwitch.InputSwitch\n                    checked={mirrored}\n                    onChange={e => {\n                        setMirrored(e.value);\n                        Object.assign(settingsMod, {mirrored: e.value});\n                    }}/>\n            </localEx.lcu.Labeled>\n        </div>\n    </>\n};CamSettings.propTypes = {CC: PropTypes.instanceOf(CamController).isRequired};\n\ntype CamActionsProps = {CC: CamController};\n\nconst CamActions: React.FC<CamActionsProps> = (props) => {\n    const opRef = React.useRef(null);\n    const buttonStyle = {background: \"white\", color: \"black\",\n        borderRadius: \"50%\", width: \"5ch\", height: \"5ch\", margin: \"5px\"};\n    const localEx = getExReady(ex, [\"prButton\", \"prOverlayPanel\"]);\n    return !localEx.ready ? null : <><localEx.prButton.Button\n        icon=\"pi pi-camera\"\n        onClick={props.CC.store.capture}\n        style={buttonStyle}/>\n    {props.CC.store.state.devices.length > 1 &&\n        <localEx.prButton.Button\n            icon=\"pi pi-undo\"\n            onClick={props.CC.store.switchCamera}\n            style={buttonStyle}/>}\n    <localEx.prButton.Button\n        icon=\"pi pi-cog\"\n        onClick={e => opRef.current.toggle(e)}\n        style={buttonStyle}/>\n    <div onKeyDown={e => e.stopPropagation()}>\n        <localEx.prOverlayPanel.OverlayPanel\n            onHide={e => {\n                // @ts-ignore\n                document.activeElement.blur();\n                window.App.setSettings({webcam: props.CC.settingsMod});\n                props.CC.buildMediaConstraints();\n                props.CC.store.setState({});\n            }}\n            onShow={e => opRef.current.align()}\n            ref={opRef}\n            showCloseIcon={true}>\n            <CamSettings CC={props.CC}/>\n        </localEx.prOverlayPanel.OverlayPanel>\n    </div></>\n};CamActions.propTypes = {CC: PropTypes.instanceOf(CamController).isRequired};\n\nexport const LinoWebCam: React.FC = (props: LinoWebCamProps) => {\n    const store: React.RefObject<WCReferences> = React.useRef({props: props});\n    CamController.buildReferences(store.current);\n\n    const { state, setState } = store.current;\n\n    React.useEffect(() => {\n        // @ts-ignore\n        document.activeElement.blur();\n        store.current.self = new CamController(store.current);\n        navigator.mediaDevices.enumerateDevices().then(devs => setState(\n            {devices: devs.filter(\n                ({kind}) => kind === \"videoinput\").map(d => d.deviceId)}));\n    }, []);\n\n    const { self } = store.current;\n\n    return !state.devices.length ? null : <>\n        <div style={{position: 'absolute'}}>{state.err_msg}</div>\n        <Webcam\n            audio={false}\n            forceScreenshotSourceSize={true}\n            height={self.settings.height / self.settings.pixelRatio}\n            mirrored={self.settings.mirrored}\n            onUserMedia={uM => {\n                if (state.deviceId === null)\n                    setState({deviceId: uM.getVideoTracks()[0].getSettings().deviceId})}}\n            onUserMediaError={exempt => {\n                if (state.err_msg === null) setState({err_msg:\n                    \"Please allow camera access to take a photo.\"})}}\n            ref={store.current.webcamRef}\n            screenshotFormat=\"image/jpeg\"\n            videoConstraints={self.mediaTrackConstraints}\n            width={self.settings.width / self.settings.pixelRatio}\n            />\n        <div\n            style={{position: \"absolute\", bottom: \"40px\", left: \"50%\",\n                transform: \"translate(-50%, 0)\"}}>\n            <CamActions CC={self}/>\n        </div>\n    </>\n}\n\n\nLinoWebCam.propTypes = {\n    height: PropTypes.number.isRequired,\n    width: PropTypes.number.isRequired,\n    captureDone: PropTypes.func.isRequired,\n}\n\n\nexport function CropImage(props) {\n    const context = React.useContext<any>(URLContextType);\n    const [crop, setCrop] = React.useState<any>();\n    const [cropSet, setCropSet] = React.useState(false);\n    const [minWidth, setMinWidth] = React.useState(\n        context.controller.APP.state.site_data.crop_min_width || 460);\n    const aspect = context.controller.APP.state.site_data.crop_aspect_ratio;\n    const localEx = getExReady(ex, [\"imageCrop\"]);\n    return !localEx.ready ? null : <localEx.imageCrop.default\n        aspect={aspect}\n        crop={crop}\n        keepSelection={true}\n        minHeight={aspect ? minWidth / aspect : minWidth}\n        minWidth={minWidth}\n        onChange={(newCrop) => setCrop(newCrop)}\n        onComplete={(newCrop) => {\n            props.preprocessedStack.crop = JSON.stringify(newCrop);\n        }}\n        >\n        <img\n            ref={ref => {\n                if (ref && !cropSet) {\n                    const putCrop = () => {\n                        let x, y, height, width;\n                        y = height = ref.offsetHeight;\n                        x = width = ref.offsetWidth;\n                        if (height === 0) {\n                            setTimeout(putCrop, 100);\n                            return;\n                        }\n                        props.preprocessedStack.originalWidth = width;\n                        props.preprocessedStack.originalHeight = height;\n                        \n                        const minHeight = aspect ? minWidth / aspect : minWidth;\n                        if (width < minWidth && height < minHeight) {\n                            const widthScaleFactor = width / minWidth;\n                            const heightScaleFactor = height / minHeight;\n                            if (widthScaleFactor <= heightScaleFactor) {\n                                height = minHeight * (width / minWidth);\n                                x = 0;\n                                y = (y - height) / 2;\n                            } else {\n                                width = minWidth * (height / minHeight);\n                                x = (x - width) / 2;\n                                y = 0;\n                            }\n                        } else\n                        if (width < minWidth) {\n                            height = minHeight * (width / minWidth);\n                            x = 0;\n                            y = (y - height) / 2;\n                        } else\n                        if (height < minHeight) {\n                            width = minWidth * (height / minHeight);\n                            x = (x - width) / 2;\n                            y = 0;\n                        } else {\n                            width = minWidth;\n                            height = minHeight;\n                            x = (x - width) / 2;\n                            y = (y - height) / 2;\n                        }\n                        const c = {\n                            unit: 'px',\n                            x: x,\n                            y: y,\n                            width: width,\n                            height: height,\n                        };\n                        setCrop(c);\n                        props.preprocessedStack.crop = JSON.stringify(c);\n                        setMinWidth(width);\n                        setCropSet(true);\n                    }\n                    putCrop();\n                }\n            }}\n            src={props.src}/>\n    </localEx.imageCrop.default>\n}\n\n\nCropImage.propTypes = {\n    preprocessedStack: PropTypes.object.isRequired,\n    src: PropTypes.string.isRequired,\n}\n"],"names":["TransInit","context","next","detector","LanguageDetector","addDetector","name","lookup","options","value","URL_PARAM_USER_LANGUAGE","cacheUserLanguage","lng","fillPlaceHolder","PARAM_TYPE_WINDOW","history","replaceByType","_defineProperty","debugMessage","i18n","HttpApi","use","initReactI18next","init","debug","load","fallbackLng","window","Lino","i18nFallbackLng","keySeparator","interpolation","escapeValue","react","useSuspense","backend","loadPath","detection","order","lookupQuerystring","lookupCookie","lookupLocalStorage","caches","ex","prButton","prOverlayPanel","prInputNumber","prInputSwitch","lcu","imageCrop","RegisterImportPool","CamController","constructor","store","this","buildMediaConstraints","constraints","settings","App","getSettings","webcam","undefined","height","width","props","devicePixelRatio","Object","assign","pixelRatio","mirrored","setSettings","settingsMod","state","deviceId","facingMode","mediaTrackConstraints","buildReferences","webcamRef","React","useRef","capture","useCallback","event","captureDone","current","getScreenshot","setState","useState","err_msg","devices","st","old","switchCamera","i","indexOf","length","CamSettings","CC","setMirrored","localEx","getExReady","mods","default","getInput","label","max","min","onValueChange","suffix","Labeled","elem","InputNumber","buttonLayout","showButtons","ready","e","t","InputSwitch","checked","onChange","propTypes","instanceOf","isRequired","CamActions","opRef","buttonStyle","background","color","borderRadius","margin","Button","icon","onClick","style","toggle","onKeyDown","stopPropagation","OverlayPanel","onHide","document","activeElement","blur","onShow","align","ref","showCloseIcon","CropImage","useContext","URLContextType","crop","setCrop","cropSet","setCropSet","minWidth","setMinWidth","controller","APP","site_data","crop_min_width","aspect","crop_aspect_ratio","keepSelection","minHeight","newCrop","onComplete","preprocessedStack","JSON","stringify","putCrop","x","y","offsetHeight","offsetWidth","setTimeout","originalWidth","originalHeight","c","unit","src","LinoWebCam","useEffect","self","navigator","mediaDevices","enumerateDevices","then","devs","filter","kind","map","d","position","audio","forceScreenshotSourceSize","onUserMedia","uM","getVideoTracks","onUserMediaError","exempt","screenshotFormat","videoConstraints","bottom","left","transform","number","func","object","string"],"ignoreList":[],"sourceRoot":""}