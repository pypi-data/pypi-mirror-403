"use strict";(self.webpackChunklino_react=self.webpackChunklino_react||[]).push([[3211,7211],{5721:(e,t,i)=>{i.r(t),i.d(t,{TransInit:()=>c,default:()=>u});var n=i(4467),r=i(8524),a=i(2635),o=i(4997),s=i(1347),l=i(2389),c=function(e,t){var i=new o.A;i.addDetector({name:"LinoLanguageDetector",lookup:function(t){return e.value[r.URL_PARAM_USER_LANGUAGE]},cacheUserLanguage:function(t,i){e.fillPlaceHolder(r.PARAM_TYPE_WINDOW,r.URL_PARAM_USER_LANGUAGE,t),e.history.replaceByType((0,n.A)({},r.URL_PARAM_USER_LANGUAGE,t),r.PARAM_TYPE_WINDOW,!1,!0),(0,r.debugMessage)("LinoLanguageDetector: cached language",t)}}),a.Ay.use(s.A).use(i).use(l.initReactI18next).init({debug:!1,load:"languageOnly",fallbackLng:window.Lino.i18nFallbackLng,keySeparator:!1,interpolation:{escapeValue:!1},react:{useSuspense:!0},backend:{loadPath:"/static/react/locales/{{lng}}/{{ns}}.json"},detection:{order:["queryString","cookie","LinoLanguageDetector","localStorage"],lookupQuerystring:r.URL_PARAM_USER_LANGUAGE,lookupCookie:r.URL_PARAM_USER_LANGUAGE,lookupLocalStorage:r.URL_PARAM_USER_LANGUAGE,caches:["LinoLanguageDetector","localStorage","cookie"]}}),t(a.Ay)};const u=a.Ay},9850:function(e,t,i){var n,r=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[t.length]=i);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i=n(e),o=0;o<i.length;o++)"default"!==i[o]&&r(t,e,i[o]);return a(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LinoWebCam=t.name=void 0,t.CropImage=f,t.name="LinoWebCam";const l=o(i(6540)),c=s(i(5556)),u=i(6606),d=s(i(60));let p;Promise.resolve().then(()=>o(i(5712)));p={prButton:Promise.resolve().then(()=>o(i(9119))),prOverlayPanel:Promise.resolve().then(()=>o(i(619))),prInputNumber:Promise.resolve().then(()=>o(i(2925))),prInputSwitch:Promise.resolve().then(()=>o(i(4433))),lcu:Promise.resolve().then(()=>o(i(2756))),i18n:Promise.resolve().then(()=>o(i(5721))),imageCrop:Promise.resolve().then(()=>o(i(2869)))};(0,u.RegisterImportPool)(p);class g{constructor(e){this.store=e,this.buildMediaConstraints()}buildMediaConstraints(){const e={};return this.settings=window.App.getSettings().webcam,void 0!==this.settings?(e.height=this.settings.height,e.width=this.settings.width):(e.height=this.store.props.height*devicePixelRatio,e.width=this.store.props.width*devicePixelRatio,this.settings=Object.assign({},e,{pixelRatio:devicePixelRatio,mirrored:!0}),window.App.setSettings({webcam:this.settings})),this.settingsMod={...this.settings},this.store.state.deviceId?e.deviceId=this.store.state.deviceId:e.facingMode="environment",this.mediaTrackConstraints=e,e}}g.buildReferences=e=>{e.webcamRef=l.useRef(null),e.capture=l.useCallback(t=>{e.props.captureDone(e.webcamRef.current.getScreenshot())},[e.webcamRef]);const[t,i]=l.useState({err_msg:null,deviceId:null,devices:[]});return e.state=t,e.setState=l.useCallback(e=>i(t=>Object.assign({},t,e)),[]),e.switchCamera=l.useCallback(i=>{let n=(t.devices.indexOf(t.deviceId)+1)%t.devices.length;e.setState({deviceId:t.devices[n]})},[]),e};const h=e=>{const{settings:t,settingsMod:i}=e.CC,[n,r]=l.useState(t.mirrored),a=(0,u.getExReady)(p,["prInputNumber","prInputSwitch","lcu","i18n"],e=>{e.i18n=e.i18n.default}),o=l.useCallback(({label:e,max:t=null,min:i,onValueChange:n,suffix:r,value:o})=>l.createElement("div",null,l.createElement(a.lcu.Labeled,{elem:{label:e}},l.createElement(a.prInputNumber.InputNumber,{buttonLayout:"horizontal",max:t,min:i,onValueChange:n,showButtons:!0,suffix:r,value:o}))),[a]);return a.ready?l.createElement(l.Fragment,null,o({label:"Height (# > 512)",max:e.CC.store.props.height,min:512,onValueChange:e=>Object.assign(i,{height:e.value*i.pixelRatio}),suffix:"px",value:t.height/t.pixelRatio}),l.createElement("br",null),o({label:"Width (# > 512)",max:e.CC.store.props.width,min:512,onValueChange:e=>Object.assign(i,{width:e.value*i.pixelRatio}),suffix:"px",value:t.width/t.pixelRatio}),l.createElement("br",null),o({label:"Pixel ratio (# > 1)",min:1,onValueChange:e=>{Object.assign(i,{height:i.height/i.pixelRatio*e.value,width:i.width/i.pixelRatio*e.value,pixelRatio:e.value})},suffix:"dpr",value:t.pixelRatio}),l.createElement("br",null),l.createElement("div",null,l.createElement(a.lcu.Labeled,{elem:{label:a.i18n.t("Mirrored")}},l.createElement(a.prInputSwitch.InputSwitch,{checked:n,onChange:e=>{r(e.value),Object.assign(i,{mirrored:e.value})}})))):null};h.propTypes={CC:c.default.instanceOf(g).isRequired};const m=e=>{const t=l.useRef(null),i={background:"white",color:"black",borderRadius:"50%",width:"5ch",height:"5ch",margin:"5px"},n=(0,u.getExReady)(p,["prButton","prOverlayPanel"]);return n.ready?l.createElement(l.Fragment,null,l.createElement(n.prButton.Button,{icon:"pi pi-camera",onClick:e.CC.store.capture,style:i}),e.CC.store.state.devices.length>1&&l.createElement(n.prButton.Button,{icon:"pi pi-undo",onClick:e.CC.store.switchCamera,style:i}),l.createElement(n.prButton.Button,{icon:"pi pi-cog",onClick:e=>t.current.toggle(e),style:i}),l.createElement("div",{onKeyDown:e=>e.stopPropagation()},l.createElement(n.prOverlayPanel.OverlayPanel,{onHide:t=>{document.activeElement.blur(),window.App.setSettings({webcam:e.CC.settingsMod}),e.CC.buildMediaConstraints(),e.CC.store.setState({})},onShow:e=>t.current.align(),ref:t,showCloseIcon:!0},l.createElement(h,{CC:e.CC})))):null};m.propTypes={CC:c.default.instanceOf(g).isRequired};function f(e){const t=l.useContext(u.URLContextType),[i,n]=l.useState(),[r,a]=l.useState(!1),[o,s]=l.useState(t.controller.APP.state.site_data.crop_min_width||460),c=t.controller.APP.state.site_data.crop_aspect_ratio,d=(0,u.getExReady)(p,["imageCrop"]);return d.ready?l.createElement(d.imageCrop.default,{aspect:c,crop:i,keepSelection:!0,minHeight:c?o/c:o,minWidth:o,onChange:e=>n(e),onComplete:t=>{e.preprocessedStack.crop=JSON.stringify(t)}},l.createElement("img",{ref:t=>{if(t&&!r){const i=()=>{let r,l,u,d;if(l=u=t.offsetHeight,r=d=t.offsetWidth,0===u)return void setTimeout(i,100);e.preprocessedStack.originalWidth=d,e.preprocessedStack.originalHeight=u;const p=c?o/c:o;if(d<o&&u<p){d/o<=u/p?(u=p*(d/o),r=0,l=(l-u)/2):(d=o*(u/p),r=(r-d)/2,l=0)}else d<o?(u=p*(d/o),r=0,l=(l-u)/2):u<p?(d=o*(u/p),r=(r-d)/2,l=0):(d=o,u=p,r=(r-d)/2,l=(l-u)/2);const g={unit:"px",x:r,y:l,width:d,height:u};n(g),e.preprocessedStack.crop=JSON.stringify(g),s(d),a(!0)};i()}},src:e.src})):null}t.LinoWebCam=e=>{const t=l.useRef({props:e});g.buildReferences(t.current);const{state:i,setState:n}=t.current;l.useEffect(()=>{document.activeElement.blur(),t.current.self=new g(t.current),navigator.mediaDevices.enumerateDevices().then(e=>n({devices:e.filter(({kind:e})=>"videoinput"===e).map(e=>e.deviceId)}))},[]);const{self:r}=t.current;return i.devices.length?l.createElement(l.Fragment,null,l.createElement("div",{style:{position:"absolute"}},i.err_msg),l.createElement(d.default,{audio:!1,forceScreenshotSourceSize:!0,height:r.settings.height/r.settings.pixelRatio,mirrored:r.settings.mirrored,onUserMedia:e=>{null===i.deviceId&&n({deviceId:e.getVideoTracks()[0].getSettings().deviceId})},onUserMediaError:e=>{null===i.err_msg&&n({err_msg:"Please allow camera access to take a photo."})},ref:t.current.webcamRef,screenshotFormat:"image/jpeg",videoConstraints:r.mediaTrackConstraints,width:r.settings.width/r.settings.pixelRatio}),l.createElement("div",{style:{position:"absolute",bottom:"40px",left:"50%",transform:"translate(-50%, 0)"}},l.createElement(m,{CC:r}))):null},t.LinoWebCam.propTypes={height:c.default.number.isRequired,width:c.default.number.isRequired,captureDone:c.default.func.isRequired},f.propTypes={preprocessedStack:c.default.object.isRequired,src:c.default.string.isRequired}}}]);
//# sourceMappingURL=main.LinoWebCam_LinoDialog.1d06dd5c23f9a8d26e64.js.map