<!DOCTYPE html>
<html lang="en" class="{THEME_CLASS}">
    <head>
        <title>Tesla Energy - Setup</title>
        <link href="favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/>
        <link href="favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/>
        <meta charset="utf-8"/>
        <meta content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" name="viewport"/>
        <style>
            /* Critical CSS - apply immediately before JavaScript */
            html, body, .app, .core-layout, .core-layout__viewport, 
            .power-flow-grid, .power-flow-grid.active {
                overflow: hidden !important;
            }
            
            body {
                margin: 0 !important;
                padding: 0 !important;
            }
            
            /* Theme backgrounds - must be here for Safari */
            .pypowerwall-theme-clear,
            .pypowerwall-theme-clear body,
            .pypowerwall-theme-clear .app,
            .pypowerwall-theme-clear .core-layout,
            .pypowerwall-theme-clear .core-layout__viewport,
            .pypowerwall-theme-clear .power-flow-grid,
            .pypowerwall-theme-clear .power-flow-grid.active {
                background: transparent !important;
                background-color: transparent !important;
            }
            
            .pypowerwall-theme-grafana,
            .pypowerwall-theme-grafana body,
            .pypowerwall-theme-grafana .app,
            .pypowerwall-theme-grafana .core-layout,
            .pypowerwall-theme-grafana .core-layout__viewport,
            .pypowerwall-theme-grafana .power-flow-grid,
            .pypowerwall-theme-grafana .power-flow-grid.active,
            .pypowerwall-theme-grafana-dark,
            .pypowerwall-theme-grafana-dark body,
            .pypowerwall-theme-grafana-dark .app,
            .pypowerwall-theme-grafana-dark .core-layout,
            .pypowerwall-theme-grafana-dark .core-layout__viewport,
            .pypowerwall-theme-grafana-dark .power-flow-grid,
            .pypowerwall-theme-grafana-dark .power-flow-grid.active {
                background: #111217 !important;
                background-color: #111217 !important;
            }
            
            .pypowerwall-theme-white,
            .pypowerwall-theme-white body,
            .pypowerwall-theme-white .app,
            .pypowerwall-theme-white .core-layout,
            .pypowerwall-theme-white .core-layout__viewport,
            .pypowerwall-theme-white .power-flow-grid,
            .pypowerwall-theme-white .power-flow-grid.active,
            .pypowerwall-theme-solar,
            .pypowerwall-theme-solar body,
            .pypowerwall-theme-solar .app,
            .pypowerwall-theme-solar .core-layout,
            .pypowerwall-theme-solar .core-layout__viewport,
            .pypowerwall-theme-solar .power-flow-grid,
            .pypowerwall-theme-solar .power-flow-grid.active {
                background: #ffffff !important;
                background-color: #ffffff !important;
            }
            
            .pypowerwall-theme-black,
            .pypowerwall-theme-black body,
            .pypowerwall-theme-black .app,
            .pypowerwall-theme-black .core-layout,
            .pypowerwall-theme-black .core-layout__viewport,
            .pypowerwall-theme-black .power-flow-grid,
            .pypowerwall-theme-black .power-flow-grid.active {
                background: #000000 !important;
                background-color: #000000 !important;
            }
            
            .pypowerwall-theme-dakboard,
            .pypowerwall-theme-dakboard body,
            .pypowerwall-theme-dakboard .app,
            .pypowerwall-theme-dakboard .core-layout,
            .pypowerwall-theme-dakboard .core-layout__viewport,
            .pypowerwall-theme-dakboard .power-flow-grid,
            .pypowerwall-theme-dakboard .power-flow-grid.active {
                background: transparent !important;
                background-color: transparent !important;
            }
            
            /* Hide unwanted elements */
            .overview-menu,
            #logout,
            .footer,
            .compact-btn-row,
            .toast-list,
            .power-flow-header,
            .btn:not(.button-continue) {
                display: none !important;
                visibility: hidden !important;
            }
            
            /* Layout adjustments */
            .core-layout__viewport {
                padding: 0 !important;
                margin: 0 !important;
            }
            
            .power-flow-grid {
                width: 100% !important;
                left: 0 !important;
                right: 0 !important;
                margin: 0 !important;
                padding-top: 0 !important;
                position: fixed !important;
            }
        </style>
        <script>
            // Redirect to /console if not in an iframe
            if (window.self === window.top) {
                window.location.href = '/console';
            }
        </script>
        <script lang="javascript">
            window.appPrefix = "{ASSET_PREFIX}"
            window.apiBaseUrl = "{API_BASE_URL}"
        </script>
        <script>
            window.__INITIAL_STATE__ = {
                "configuration": {
                    "isNew": false,
                    "version": "{VERSION}",
                    "hash": "{HASH}",
                    "deviceType": "teg",
                    "isSolarPowerwall": false,
                    "bootstrapped": true,
                    "commissioned": true
                },
                "sitemaster": {
                    "running": true,
                    "connectedToTesla": true,
                    "power": 0
                },
                "system": {
                    "isFirmwareUpdating": false,
                    "Version": "",
                    "updating": false
                },
                "authentication": {
                    "loginType": "customer",
                    "selectedLoginType": "customer",
                    "username": "{EMAIL}",
                    "lastLoginAt": 1700501180000,
                    "toggle_auth_supported": true,
                    "authorized": true,
                    "isLoggedIn": true,
                    "token": "mock_token_bypass"
                }
            }
            // Set auth cookie to bypass login
            document.cookie = "AuthCookie=mock_auth_token; path=/; max-age=86400";
            document.cookie = "UserRecord={\"email\":\"{EMAIL}\",\"kind\":\"customer\"}; path=/; max-age=86400";
        </script>
        <link href="{ASSET_PREFIX}app.css" rel="stylesheet"/>
    </head>
    <body>
        <div id="root" style="height:100%"></div>
        <script src="{STYLE}" type="text/javascript"></script>
        <script src="{ASSET_PREFIX}vendor.js" type="text/javascript"></script>
        <script src="{ASSET_PREFIX}app.js" type="text/javascript"></script>
    </body>
</html>
