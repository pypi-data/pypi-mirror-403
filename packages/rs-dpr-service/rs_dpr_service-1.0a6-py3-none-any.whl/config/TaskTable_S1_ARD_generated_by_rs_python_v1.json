{
  "$schema": "./../schemas/TaskTable.schema.json",
  "tasktable": {
    "name": "s1-ard",
    "version": 1.0,
    "specification_version": "1.0_draft_E",
    "update_datetime": "2025-10-03T11:00:00Z",
    "configuration_path": {}
  },
  "external_variables": [
    "start_datetime",
    "end_datetime"
  ],
  "units": [
    {
      "name": "calibration",
      "module": "s1_l12_rp.computing.ard_processing_units",
      "resources_min": {
        "dask": {
          "worker_cpu": 4,
          "worker_ram": "58GB",
          "worker_thread_count": 1,
          "worker_count": 1
        },
        "disk": {
          "size_per_worker": "50GB"
        }
      },
      "input_products": [
        {
          "name": "cal_input",
          "mode": "always",
          "mandatory": false
        }
      ],
      "input_adfs": [
        {
          "name": "CONFIG",
          "mode": "always",
          "mandatory": false
        },
        {
          "name": "ETAD",
          "mode": "always",
          "mandatory": false
        }
      ],
      "output_products": [
        {
          "name": "cal_slcs",
          "mode": "always",
          "mandatory": true
        }
      ]
    },
    {
      "name": "reference_dem",
      "module": "s1_l12_rp.computing.ard_processing_units",
      "resources_min": {
        "dask": {
          "worker_cpu": 4,
          "worker_ram": "58GB",
          "worker_thread_count": 1,
          "worker_count": 1
        },
        "disk": {
          "size_per_worker": "50GB"
        }
      },
      "input_products": [
        {
          "name": "cal_slcs",
          "mode": "always",
          "mandatory": false
        }
      ],
      "input_adfs": [
        {
          "name": "CONFIG",
          "mode": "always",
          "mandatory": false
        },
        {
          "name": "DEM",
          "mode": "always",
          "mandatory": false
        }
      ],
      "output_products": [
        {
          "name": "reference_dem",
          "mode": "always",
          "mandatory": true
        }
      ]
    },
    {
      "name": "reference_geometry",
      "module": "s1_l12_rp.computing.ard_processing_units",
      "resources_min": {
        "dask": {
          "worker_cpu": 4,
          "worker_ram": "58GB",
          "worker_thread_count": 1,
          "worker_count": 1
        },
        "disk": {
          "size_per_worker": "50GB"
        }
      },
      "input_products": [
        {
          "name": "cal_slcs",
          "mode": "always",
          "mandatory": false
        },
        {
          "name": "reference_dem",
          "mode": "always",
          "mandatory": false
        }
      ],
      "input_adfs": [
        {
          "name": "CONFIG",
          "mode": "always",
          "mandatory": false
        }
      ],
      "output_products": [
        {
          "name": "simulation_ref",
          "mode": "always",
          "mandatory": true
        }
      ]
    },
    {
      "name": "coregistration",
      "module": "s1_l12_rp.computing.ard_processing_units",
      "resources_min": {
        "dask": {
          "worker_cpu": 4,
          "worker_ram": "58GB",
          "worker_thread_count": 1,
          "worker_count": 1
        },
        "disk": {
          "size_per_worker": "50GB"
        }
      },
      "input_products": [
        {
          "name": "cal_slcs",
          "mode": "always",
          "mandatory": false
        },
        {
          "name": "reference_dem",
          "mode": "always",
          "mandatory": false
        },
        {
          "name": "simulation_ref",
          "mode": "always",
          "mandatory": false
        }
      ],
      "input_adfs": [
        {
          "name": "CONFIG",
          "mode": "always",
          "mandatory": false
        }
      ],
      "output_products": [
        {
          "name": "cslcs",
          "mode": "always",
          "mandatory": true
        }
      ]
    },
    {
      "name": "geocoding",
      "module": "s1_l12_rp.computing.ard_processing_units",
      "resources_min": {
        "dask": {
          "worker_cpu": 4,
          "worker_ram": "58GB",
          "worker_thread_count": 1,
          "worker_count": 1
        },
        "disk": {
          "size_per_worker": "50GB"
        }
      },
      "input_products": [
        {
          "name": "cslcs",
          "mode": "always",
          "mandatory": false
        },
        {
          "name": "simulation_ref",
          "mode": "always",
          "mandatory": false
        }
      ],
      "input_adfs": [
        {
          "name": "CONFIG",
          "mode": "always",
          "mandatory": false
        }
      ],
      "output_products": [
        {
          "name": "gslcs",
          "mode": "always",
          "mandatory": true
        }
      ]
    },
    {
      "name": "mosaicking",
      "module": "s1_l12_rp.computing.ard_processing_units",
      "resources_min": {
        "dask": {
          "worker_cpu": 4,
          "worker_ram": "58GB",
          "worker_thread_count": 1,
          "worker_count": 1
        },
        "disk": {
          "size_per_worker": "50GB"
        }
      },
      "input_products": [
        {
          "name": "gslcs",
          "mode": "always",
          "mandatory": false
        }
      ],
      "input_adfs": [
        {
          "name": "S2_TILES",
          "mode": "always",
          "mandatory": false
        }
      ],
      "output_products": [
        {
          "name": "nrb",
          "mode": "always",
          "mandatory": true
        }
      ]
    }
  ],
  "io": [
    {
      "name": "cal_input",
      "type": "folder",
      "store_type": "safe"
    },
    {
      "name": "CONFIG",
      "type": "filename"
    },
    {
      "name": "ETAD",
      "type": "folder"
    },
    {
      "name": "DEM",
      "type": "folder"
    },
    {
      "name": "cal_slcs",
      "type": "folder",
      "store_type": "safe",
      "opening_mode": "CREATE_OVERWRITE"
    },
    {
      "name": "reference_dem",
      "type": "folder"
    },
    {
      "name": "simulation_ref",
      "type": "folder"
    },
    {
      "name": "cslcs",
      "type": "filename",
      "store_type": "zarr",
      "store_params": {
        "consolidate": true
      }
    },
    {
      "name": "gslcs",
      "type": "filename",
      "store_type": "zarr",
      "store_params": {
        "consolidate": true
      }
    },
    {
      "name": "S2_TILES",
      "type": "filename"
    },
    {
      "name": "nrb",
      "type": "filename",
      "store_type": "zarr",
      "store_params": {
        "consolidate": true
      }
    }
  ],
  "queries": [
    {
      "name": "LatestValCover",
      "parameters": [
        "product_type",
        "start_datetime",
        "end_datetime",
        "dTa",
        "dTb"
      ],
      "stac": {
        "filter": {
          "op": "and",
          "args": [
            {
              "op": "=",
              "args": [
                {
                  "property": "product:type"
                },
                "{product_type}"
              ]
            },
            {
              "op": "t_contains",
              "args": [
                {
                  "interval": [
                    {
                      "property": "start_datetime"
                    },
                    {
                      "property": "end_datetime"
                    }
                  ]
                },
                {
                  "interval": [
                    {
                      "op": "-",
                      "args": [
                        "{start_datetime}",
                        "{dTa}"
                      ]
                    },
                    {
                      "op": "+",
                      "args": [
                        "{end_datetime}",
                        "{dTb}"
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        "sortby": [
          {
            "field": "created",
            "direction": "desc"
          }
        ],
        "limit": 1
      }
    }
  ],
  "pipelines": [
    {
      "name": "s1_ard_full",
      "description": "Full pipeline for S1 ARD",
      "steps": [
        {
          "unit_name": "calibration",
          "order": 1,
          "input_products": {
            "cal_input": "pipeline_input"
          },
          "output_products": {
            "cal_slcs": "pipeline_internal"
          }
        },
        {
          "unit_name": "reference_dem",
          "order": 1,
          "input_products": {
            "cal_slcs": "calibration.cal_slcs"
          },
          "output_products": {
            "reference_dem": "pipeline_internal"
          }
        },
        {
          "unit_name": "reference_geometry",
          "order": 1,
          "input_products": {
            "cal_slcs": "calibration.cal_slcs",
            "reference_dem": "reference_dem.reference_dem"
          },
          "output_products": {
            "simulation_ref": "pipeline_internal"
          }
        },
        {
          "unit_name": "coregistration",
          "order": 1,
          "input_products": {
            "cal_slcs": "calibration.cal_slcs",
            "reference_dem": "reference_dem.reference_dem",
            "simulation_ref": "reference_geometry.simulation_ref"
          },
          "output_products": {
            "cslcs": "pipeline_internal"
          }
        },
        {
          "unit_name": "geocoding",
          "order": 1,
          "input_products": {
            "cslcs": "coregistration.cslcs",
            "simulation_ref": "reference_geometry.simulation_ref"
          },
          "output_products": {
            "gslcs": "pipeline_internal"
          }
        },
        {
          "unit_name": "mosaicking",
          "order": 1,
          "input_products": {
            "gslcs": "geocoding.gslcs"
          },
          "output_products": {
            "nrb": "pipeline_output"
          }
        }
      ]
    }
  ]
}
