# -*- coding: utf-8 -*-
"""
é…ç½®æ¨¡å— - LLM é¢„è®¾å’Œ System Prompt

åŒ…å«:
- LLM_PRESETS: å„ LLM æä¾›å•†çš„é…ç½®
- SYSTEM_PROMPT: Agent çš„ç³»ç»Ÿæç¤ºè¯
- TOOL_DESCRIPTIONS: å·¥å…·çš„ä¸­æ–‡æè¿°ï¼ˆç”¨äºç¡®è®¤æ¶ˆæ¯ï¼‰
- ERROR_SUGGESTIONS: é”™è¯¯æ¢å¤å»ºè®®æ˜ å°„
"""

from typing import Dict

# =============================================================================
# LLM é¢„è®¾é…ç½®
# =============================================================================

LLM_PRESETS = {
    "qwen": {
        "base_url": "https://dashscope.aliyuncs.com/compatible-mode/v1",
        "env_key": "DASHSCOPE_API_KEY",
        "default_model": "qwen-plus"
    },
    "deepseek": {
        "base_url": "https://api.deepseek.com/v1",
        "env_key": "DEEPSEEK_API_KEY",
        "default_model": "deepseek-chat"
    },
    "zhipu": {
        "base_url": "https://open.bigmodel.cn/api/paas/v4",
        "env_key": "ZHIPU_API_KEY",
        "default_model": "glm-4-flash"
    },
    "openai": {
        "base_url": "https://api.openai.com/v1",
        "env_key": "OPENAI_API_KEY",
        "default_model": "gpt-4o-mini"
    }
}


# =============================================================================
# System Prompt
# =============================================================================

SYSTEM_PROMPT = """ä½ æ˜¯ä¸€ä¸ª SAP2000 ç»“æ„åˆ†æè½¯ä»¶çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œä¸“é—¨å¸®åŠ©ç»“æ„å·¥ç¨‹å¸ˆé«˜æ•ˆä½¿ç”¨ SAP2000ã€‚

## æ ¸å¿ƒèƒ½åŠ›

### 1. æ¨¡å‹æŸ¥è¯¢
- æŸ¥è¯¢èŠ‚ç‚¹ã€æ†ä»¶ã€é¢å•å…ƒã€ç´¢å•å…ƒã€è¿æ¥å•å…ƒä¿¡æ¯
- æŸ¥è¯¢ç»„ã€æˆªé¢ã€ææ–™ã€è·è½½æ¨¡å¼ã€è·è½½å·¥å†µã€ç»„åˆ
- è·å–é€‰ä¸­å¯¹è±¡ã€æ•°æ®åº“è¡¨æ ¼

### 2. æ¨¡å‹åˆ›å»ºä¸ä¿®æ”¹
- åˆ›å»º/åˆ é™¤/ä¿®æ”¹èŠ‚ç‚¹ã€æ†ä»¶ã€é¢å•å…ƒã€ç´¢å•å…ƒã€è¿æ¥å•å…ƒ
- è®¾ç½®èŠ‚ç‚¹çº¦æŸã€æ†ä»¶ç«¯éƒ¨é‡Šæ”¾ã€é¢å•å…ƒæˆªé¢
- åˆ›å»ºç»„å¹¶æ·»åŠ å¯¹è±¡åˆ°ç»„
- åˆ›å»ºåˆšæ€§éš”æ¿çº¦æŸ

### 3. è·è½½æ“ä½œ
- æ·»åŠ /åˆ é™¤èŠ‚ç‚¹è·è½½ï¼ˆåŠ›ã€åŠ›çŸ©ï¼‰
- æ·»åŠ /åˆ é™¤æ†ä»¶å‡å¸ƒè·è½½ã€é›†ä¸­è·è½½
- æ·»åŠ /åˆ é™¤é¢å•å…ƒå‡å¸ƒè·è½½
- åˆ›å»º/åˆ é™¤è·è½½æ¨¡å¼

### 4. åˆ†æä¸è®¾è®¡
- è¿è¡Œç»“æ„åˆ†æ
- è¿è¡Œé’¢ç»“æ„è®¾è®¡ã€æ··å‡åœŸè®¾è®¡
- æŸ¥çœ‹åº”åŠ›æ¯”ã€éªŒç®—ç»“æœ

### 5. ç»“æœæŸ¥è¯¢
- èŠ‚ç‚¹ä½ç§»ã€ååŠ›
- æ†ä»¶å†…åŠ›ï¼ˆè½´åŠ›ã€å‰ªåŠ›ã€å¼¯çŸ©ï¼‰
- æ¨¡æ€å‘¨æœŸã€æŒ¯å‹ã€è´¨é‡å‚ä¸ç³»æ•°
- åŸºåº•ååŠ›

### 6. ç»Ÿè®¡ä¸ç»˜å›¾
- ç»Ÿè®¡ç”¨é’¢é‡ï¼ˆæŒ‰æˆªé¢ã€ç»„åˆ†ç±»ï¼‰
- ç»Ÿè®¡ç”¨ç´¢é‡
- ç»‘åˆ¶æŸ±çŠ¶å›¾ã€é¥¼å›¾ã€æŠ˜çº¿å›¾

### 7. ç¼–è¾‘æ“ä½œ
- ç§»åŠ¨ã€çº¿æ€§å¤åˆ¶ã€é•œåƒå¤åˆ¶ã€ç¯å½¢å¤åˆ¶
- åˆ†å‰²æ†ä»¶ã€åˆå¹¶èŠ‚ç‚¹

### 8. æ‰¹é‡æ“ä½œ
- batch_set_section: æ‰¹é‡ä¿®æ”¹æˆªé¢
- batch_add_distributed_load: æ‰¹é‡æ·»åŠ å‡å¸ƒè·è½½
- batch_set_restraint: æ‰¹é‡è®¾ç½®èŠ‚ç‚¹çº¦æŸ

### 9. æ–‡ä»¶æ“ä½œ
- new_model: æ–°å»ºç©ºç™½æ¨¡å‹
- open_model: æ‰“å¼€æ¨¡å‹æ–‡ä»¶
- save_model: ä¿å­˜æ¨¡å‹
- unlock_model: è§£é”æ¨¡å‹

### 10. é€‰æ‹©æ“ä½œ
- select_all: é€‰æ‹©æ‰€æœ‰å¯¹è±¡
- select_group: æŒ‰ç»„é€‰æ‹©
- select_by_property: æŒ‰æˆªé¢/ææ–™é€‰æ‹©
- clear_selection: æ¸…é™¤é€‰æ‹©

### 11. çŸ¥è¯†åº“æœç´¢
- search_sap_docs: æœç´¢ SAP2000 API æ–‡æ¡£ï¼Œè·å–è¯¦ç»†ç”¨æ³•

## å·¥ä½œæµç¨‹å»ºè®®

### æŸ¥çœ‹ç»“æœçš„æ­£ç¡®é¡ºåº
1. å…ˆè¿è¡Œåˆ†æ (run_analysis)
2. å†è¿è¡Œè®¾è®¡ (run_steel_design)
3. æœ€åæŸ¥çœ‹åº”åŠ›æ¯” (get_stress_ratios)

### å¸¸è§ä»»åŠ¡æµç¨‹
- **æŸ¥è¯¢æ¨¡å‹æ¦‚å†µ**: get_model_info â†’ get_section_list â†’ get_material_list
- **æ£€æŸ¥è®¾è®¡ç»“æœ**: run_analysis â†’ run_steel_design â†’ get_stress_ratios
- **ç»Ÿè®¡ç”¨é’¢é‡**: get_steel_usage â†’ draw_chart (ç»˜åˆ¶é¥¼å›¾æˆ–æŸ±çŠ¶å›¾)
- **æ‰¹é‡ä¿®æ”¹æˆªé¢**: get_section_list â†’ batch_set_section

## å›å¤è§„èŒƒ

1. **è¯­è¨€**: ä½¿ç”¨ä¸­æ–‡å›å¤
2. **æ ¼å¼**: ä½¿ç”¨ Markdown æ ¼å¼ï¼ˆè¡¨æ ¼ã€åˆ—è¡¨ã€ä»£ç å—ï¼‰
3. **æ•°æ®å±•ç¤º**: æ•°æ®è¾ƒå¤šæ—¶ç”¨è¡¨æ ¼ï¼Œç®€æ´æ˜äº†
4. **å›¾ç‰‡å¤„ç†**: å·¥å…·è¿”å›çš„ "__image__" å­—æ®µä¸è¦è¾“å‡ºï¼Œå›¾ç‰‡ä¼šè‡ªåŠ¨æ˜¾ç¤º
5. **é”™è¯¯å¤„ç†**: é‡åˆ°é”™è¯¯æ—¶ç»™å‡ºæ˜ç¡®çš„è§£å†³å»ºè®®

## æ³¨æ„äº‹é¡¹

1. ä¿®æ”¹æ¨¡å‹çš„æ“ä½œä¼šå…ˆè¯¢é—®ç”¨æˆ·ç¡®è®¤
2. æ¨¡å‹é”å®šæ—¶éœ€è¦å…ˆè§£é” (unlock_model)
3. ä¸ç¡®å®š API ç”¨æ³•æ—¶ï¼Œä½¿ç”¨ search_sap_docs æœç´¢æ–‡æ¡£
4. æ‰¹é‡æ“ä½œæ¯”é€ä¸ªæ“ä½œæ›´é«˜æ•ˆï¼Œä¼˜å…ˆä½¿ç”¨æ‰¹é‡å·¥å…·

## ç¤ºä¾‹å¯¹è¯

### ç¤ºä¾‹1ï¼šæ‰¹é‡ä¿®æ”¹æˆªé¢
ç”¨æˆ·: æŠŠ"ä¸Šå¼¦æ†"ç»„çš„æˆªé¢æ”¹æˆ H400x200x8x12
åŠ©æ‰‹: æˆ‘å°†æ‰¹é‡ä¿®æ”¹"ä¸Šå¼¦æ†"ç»„çš„æ†ä»¶æˆªé¢ã€‚
â†’ è°ƒç”¨ batch_set_section(group_name="ä¸Šå¼¦æ†", section_name="H400x200x8x12")
ç»“æœ: å·²æˆåŠŸä¿®æ”¹ X æ ¹æ†ä»¶çš„æˆªé¢ã€‚

### ç¤ºä¾‹2ï¼šè®¾è®¡éªŒç®—æµç¨‹
ç”¨æˆ·: å¸®æˆ‘åšä¸€ä¸‹é’¢ç»“æ„è®¾è®¡éªŒç®—
åŠ©æ‰‹: å¥½çš„ï¼Œæˆ‘å°†æŒ‰ä»¥ä¸‹æ­¥éª¤æ‰§è¡Œè®¾è®¡éªŒç®—ï¼š
1. è¿è¡Œç»“æ„åˆ†æ
2. è¿è¡Œé’¢ç»“æ„è®¾è®¡
3. è·å–åº”åŠ›æ¯”ç»“æœ
â†’ è°ƒç”¨ run_analysis()
â†’ è°ƒç”¨ run_steel_design()
â†’ è°ƒç”¨ get_stress_ratios()
ç»“æœ: [å±•ç¤ºåº”åŠ›æ¯”è¡¨æ ¼]

### ç¤ºä¾‹3ï¼šæŸ¥è¯¢å†…åŠ›
ç”¨æˆ·: 1å·æ†ä»¶åœ¨æ’è½½ä¸‹çš„æœ€å¤§å¼¯çŸ©æ˜¯å¤šå°‘
åŠ©æ‰‹: æˆ‘æ¥æŸ¥è¯¢1å·æ†ä»¶åœ¨æ’è½½å·¥å†µä¸‹çš„å†…åŠ›ã€‚
â†’ è°ƒç”¨ get_frame_forces(frame_name="1", load_case="DEAD")
ç»“æœ: 1å·æ†ä»¶æœ€å¤§å¼¯çŸ© M3 = XXX kNÂ·mï¼Œä½äºç›¸å¯¹ä½ç½® 0.5 å¤„ã€‚

### ç¤ºä¾‹4ï¼šç»Ÿè®¡ç”¨é’¢é‡å¹¶ç»˜å›¾
ç”¨æˆ·: ç»Ÿè®¡ä¸€ä¸‹ç”¨é’¢é‡ï¼ŒæŒ‰æˆªé¢åˆ†ç±»ç”»ä¸ªé¥¼å›¾
åŠ©æ‰‹: æˆ‘å°†ç»Ÿè®¡ç”¨é’¢é‡å¹¶ç»‘åˆ¶é¥¼å›¾ã€‚
â†’ è°ƒç”¨ get_steel_usage(group_by="section")
â†’ è°ƒç”¨ draw_chart(chart_type="pie", ...)
ç»“æœ: [å±•ç¤ºé¥¼å›¾]

### ç¤ºä¾‹5ï¼šæ·»åŠ è·è½½
ç”¨æˆ·: ç»™"æ¥¼é¢æ¢"ç»„çš„æ‰€æœ‰æ†ä»¶åŠ ä¸Š 5kN/m çš„æ´»è½½
åŠ©æ‰‹: æˆ‘å°†ä¸º"æ¥¼é¢æ¢"ç»„æ‰¹é‡æ·»åŠ å‡å¸ƒè·è½½ã€‚
â†’ è°ƒç”¨ batch_add_distributed_load(group_name="æ¥¼é¢æ¢", load_pattern="LIVE", value=-5, direction="Gravity")
ç»“æœ: å·²ä¸º X æ ¹æ†ä»¶æ·»åŠ è·è½½ã€‚

å½“å‰å·²è¿æ¥åˆ°ç”¨æˆ·æœ¬åœ°çš„ SAP2000 è½¯ä»¶ã€‚"""


# =============================================================================
# å·¥å…·æè¿°ï¼ˆç”¨äºç¡®è®¤æ¶ˆæ¯ï¼‰
# =============================================================================

TOOL_DESCRIPTIONS = {
    # èŠ‚ç‚¹æ“ä½œ
    "create_point": "åˆ›å»ºèŠ‚ç‚¹",
    "delete_point": "åˆ é™¤èŠ‚ç‚¹",
    "set_point_restraint": "è®¾ç½®èŠ‚ç‚¹çº¦æŸ",
    "modify_joint_coordinate": "ä¿®æ”¹èŠ‚ç‚¹åæ ‡",
    "batch_modify_joints": "æ‰¹é‡ä¿®æ”¹èŠ‚ç‚¹åæ ‡",
    "merge_points": "åˆå¹¶èŠ‚ç‚¹",
    # æ†ä»¶æ“ä½œ
    "create_frame": "åˆ›å»ºæ†ä»¶",
    "delete_frame": "åˆ é™¤æ†ä»¶",
    "set_frame_section": "ä¿®æ”¹æ†ä»¶æˆªé¢",
    "set_frame_release": "è®¾ç½®æ†ä»¶ç«¯éƒ¨é‡Šæ”¾",
    "divide_frame": "åˆ†å‰²æ†ä»¶",
    # é¢å•å…ƒæ“ä½œ
    "create_area": "åˆ›å»ºé¢å•å…ƒ",
    "delete_area": "åˆ é™¤é¢å•å…ƒ",
    "set_area_section": "è®¾ç½®é¢å•å…ƒæˆªé¢",
    "add_area_to_group_tool": "æ·»åŠ é¢å•å…ƒåˆ°ç»„",
    # ç´¢/è¿æ¥å•å…ƒæ“ä½œ
    "create_cable": "åˆ›å»ºç´¢å•å…ƒ",
    "delete_cable": "åˆ é™¤ç´¢å•å…ƒ",
    "create_link": "åˆ›å»ºè¿æ¥å•å…ƒ",
    "delete_link": "åˆ é™¤è¿æ¥å•å…ƒ",
    # è·è½½æ“ä½œ
    "add_point_load": "æ·»åŠ èŠ‚ç‚¹è·è½½",
    "delete_point_load": "åˆ é™¤èŠ‚ç‚¹è·è½½",
    "add_frame_distributed_load": "æ·»åŠ æ†ä»¶å‡å¸ƒè·è½½",
    "add_frame_point_load": "æ·»åŠ æ†ä»¶é›†ä¸­è·è½½",
    "delete_frame_load": "åˆ é™¤æ†ä»¶è·è½½",
    "add_area_load": "æ·»åŠ é¢è·è½½",
    "delete_area_load": "åˆ é™¤é¢è·è½½",
    "create_load_pattern": "åˆ›å»ºè·è½½æ¨¡å¼",
    "delete_load_pattern": "åˆ é™¤è·è½½æ¨¡å¼",
    # åˆ†æè®¾è®¡
    "run_analysis": "è¿è¡Œåˆ†æ",
    "run_steel_design": "è¿è¡Œé’¢ç»“æ„è®¾è®¡",
    # ç»„æ“ä½œ
    "create_group": "åˆ›å»ºç»„",
    "add_frame_to_group": "æ·»åŠ æ†ä»¶åˆ°ç»„",
    "add_selected_to_group": "æ·»åŠ é€‰ä¸­å¯¹è±¡åˆ°ç»„",
    # æ–‡ä»¶æ“ä½œ
    "save_model": "ä¿å­˜æ¨¡å‹",
    "unlock_model": "è§£é”æ¨¡å‹",
    "new_model": "æ–°å»ºæ¨¡å‹",
    "open_model": "æ‰“å¼€æ¨¡å‹",
    # ç¼–è¾‘æ“ä½œ
    "move_selected_objects": "ç§»åŠ¨é€‰ä¸­å¯¹è±¡",
    "replicate_linear": "çº¿æ€§å¤åˆ¶",
    "replicate_mirror": "é•œåƒå¤åˆ¶",
    "replicate_radial": "ç¯å½¢å¤åˆ¶",
    # çº¦æŸæ“ä½œ
    "create_diaphragm_constraint": "åˆ›å»ºåˆšæ€§éš”æ¿çº¦æŸ",
    "assign_point_constraint": "åˆ†é…èŠ‚ç‚¹çº¦æŸ",
    # æ’¤å›æ“ä½œ
    "undo_last_operation": "æ’¤å›ä¸Šä¸€æ­¥æ“ä½œ",
    "clear_operation_history": "æ¸…ç©ºæ“ä½œå†å²",
    # æ‰¹é‡æ“ä½œ
    "batch_set_section": "æ‰¹é‡ä¿®æ”¹æˆªé¢",
    "batch_add_distributed_load": "æ‰¹é‡æ·»åŠ å‡å¸ƒè·è½½",
    "batch_set_restraint": "æ‰¹é‡è®¾ç½®èŠ‚ç‚¹çº¦æŸ",
    # é€‰æ‹©æ“ä½œ
    "select_all": "é€‰æ‹©æ‰€æœ‰å¯¹è±¡",
    "clear_selection": "æ¸…é™¤é€‰æ‹©",
    "select_group": "æŒ‰ç»„é€‰æ‹©",
    "select_by_property": "æŒ‰å±æ€§é€‰æ‹©",
}


# =============================================================================
# é”™è¯¯å»ºè®®æ˜ å°„ - æä¾›æ™ºèƒ½é”™è¯¯æ¢å¤å»ºè®®
# =============================================================================

ERROR_SUGGESTIONS: Dict[str, str] = {
    # æ¨¡å‹çŠ¶æ€é”™è¯¯
    "æ¨¡å‹å·²é”å®š": "æ¨¡å‹å¤„äºé”å®šçŠ¶æ€ï¼Œè¯·å…ˆè°ƒç”¨ unlock_model è§£é”æ¨¡å‹åå†è¯•ã€‚",
    "model is locked": "æ¨¡å‹å¤„äºé”å®šçŠ¶æ€ï¼Œè¯·å…ˆè°ƒç”¨ unlock_model è§£é”æ¨¡å‹åå†è¯•ã€‚",
    "locked": "æ¨¡å‹å¯èƒ½å·²é”å®šï¼Œå»ºè®®å…ˆè°ƒç”¨ unlock_model è§£é”ã€‚",
    
    # åˆ†æç›¸å…³é”™è¯¯
    "åˆ†ææœªè¿è¡Œ": "è¯·å…ˆè°ƒç”¨ run_analysis è¿è¡Œç»“æ„åˆ†æï¼Œç„¶åå†æŸ¥è¯¢ç»“æœã€‚",
    "no results": "æ²¡æœ‰åˆ†æç»“æœï¼Œè¯·å…ˆè°ƒç”¨ run_analysis è¿è¡Œåˆ†æã€‚",
    "analysis has not been run": "åˆ†æå°šæœªè¿è¡Œï¼Œè¯·å…ˆè°ƒç”¨ run_analysisã€‚",
    "è®¾è®¡æœªè¿è¡Œ": "è¯·å…ˆè°ƒç”¨ run_steel_design è¿è¡Œé’¢ç»“æ„è®¾è®¡ã€‚",
    
    # å¯¹è±¡ä¸å­˜åœ¨é”™è¯¯
    "æœªæ‰¾åˆ°æˆªé¢": "æŒ‡å®šçš„æˆªé¢ä¸å­˜åœ¨ï¼Œå»ºè®®å…ˆè°ƒç”¨ get_section_list æŸ¥çœ‹å¯ç”¨æˆªé¢åˆ—è¡¨ã€‚",
    "section not found": "æˆªé¢ä¸å­˜åœ¨ï¼Œè¯·è°ƒç”¨ get_section_list æŸ¥çœ‹å¯ç”¨æˆªé¢ã€‚",
    "æœªæ‰¾åˆ°ç»„": "æŒ‡å®šçš„ç»„ä¸å­˜åœ¨ï¼Œå»ºè®®å…ˆè°ƒç”¨ get_group_list æŸ¥çœ‹å¯ç”¨ç»„åˆ—è¡¨ã€‚",
    "group not found": "ç»„ä¸å­˜åœ¨ï¼Œè¯·è°ƒç”¨ get_group_list æŸ¥çœ‹å¯ç”¨ç»„ã€‚",
    "æœªæ‰¾åˆ°æ†ä»¶": "æŒ‡å®šçš„æ†ä»¶ä¸å­˜åœ¨ï¼Œå»ºè®®å…ˆè°ƒç”¨ get_frame_list æŸ¥çœ‹æ†ä»¶åˆ—è¡¨ã€‚",
    "frame not found": "æ†ä»¶ä¸å­˜åœ¨ï¼Œè¯·è°ƒç”¨ get_frame_list æŸ¥çœ‹æ†ä»¶åˆ—è¡¨ã€‚",
    "æœªæ‰¾åˆ°èŠ‚ç‚¹": "æŒ‡å®šçš„èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œå»ºè®®å…ˆè°ƒç”¨ get_point_list æŸ¥çœ‹èŠ‚ç‚¹åˆ—è¡¨ã€‚",
    "point not found": "èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œè¯·è°ƒç”¨ get_point_list æŸ¥çœ‹èŠ‚ç‚¹åˆ—è¡¨ã€‚",
    "æœªæ‰¾åˆ°è·è½½æ¨¡å¼": "æŒ‡å®šçš„è·è½½æ¨¡å¼ä¸å­˜åœ¨ï¼Œå»ºè®®å…ˆè°ƒç”¨ get_load_pattern_list æŸ¥çœ‹å¯ç”¨è·è½½æ¨¡å¼ã€‚",
    "load pattern not found": "è·è½½æ¨¡å¼ä¸å­˜åœ¨ï¼Œè¯·è°ƒç”¨ get_load_pattern_list æŸ¥çœ‹ã€‚",
    "æœªæ‰¾åˆ°å·¥å†µ": "æŒ‡å®šçš„è·è½½å·¥å†µä¸å­˜åœ¨ï¼Œå»ºè®®å…ˆè°ƒç”¨ get_load_case_list æŸ¥çœ‹å¯ç”¨å·¥å†µã€‚",
    
    # è¿æ¥é”™è¯¯
    "è¿æ¥å¤±è´¥": "ä¸ SAP2000 çš„è¿æ¥å·²æ–­å¼€ï¼Œè¯·ç¡®ä¿ SAP2000 æ­£åœ¨è¿è¡Œï¼Œç„¶åè°ƒç”¨ check_connection æ£€æŸ¥è¿æ¥ã€‚",
    "connection failed": "è¿æ¥å¤±è´¥ï¼Œè¯·ç¡®ä¿ SAP2000 æ­£åœ¨è¿è¡Œã€‚",
    "sap2000 æœªå¯åŠ¨": "SAP2000 æœªå¯åŠ¨ï¼Œè¯·å…ˆå¯åŠ¨ SAP2000 è½¯ä»¶ã€‚",
    "com error": "COM é€šä¿¡é”™è¯¯ï¼Œè¯·ç¡®ä¿ SAP2000 æ­£åœ¨è¿è¡Œä¸”æœªè¢«å…¶ä»–ç¨‹åºå ç”¨ã€‚",
    
    # å‚æ•°é”™è¯¯
    "å‚æ•°é”™è¯¯": "å‚æ•°æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥è¾“å…¥å‚æ•°ã€‚",
    "invalid parameter": "å‚æ•°æ— æ•ˆï¼Œè¯·æ£€æŸ¥å‚æ•°ç±»å‹å’Œå–å€¼èŒƒå›´ã€‚",
    "å‚æ•°ä¸èƒ½ä¸ºç©º": "å¿…å¡«å‚æ•°ç¼ºå¤±ï¼Œè¯·æä¾›å®Œæ•´çš„å‚æ•°ã€‚",
    
    # æƒé™é”™è¯¯
    "æ²¡æœ‰é€‰ä¸­å¯¹è±¡": "å½“å‰æ²¡æœ‰é€‰ä¸­ä»»ä½•å¯¹è±¡ï¼Œè¯·å…ˆä½¿ç”¨ select_group æˆ– select_by_property é€‰æ‹©å¯¹è±¡ã€‚",
    "no selection": "æ²¡æœ‰é€‰ä¸­å¯¹è±¡ï¼Œè¯·å…ˆé€‰æ‹©è¦æ“ä½œçš„å¯¹è±¡ã€‚",
}


def get_error_suggestion(error_message: str) -> str:
    """
    æ ¹æ®é”™è¯¯æ¶ˆæ¯è·å–æ¢å¤å»ºè®®
    
    Args:
        error_message: é”™è¯¯æ¶ˆæ¯
        
    Returns:
        æ¢å¤å»ºè®®ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²
    """
    error_lower = error_message.lower()
    for key, suggestion in ERROR_SUGGESTIONS.items():
        if key.lower() in error_lower:
            return suggestion
    return ""


def get_tool_description(tool_name: str) -> str:
    """è·å–å·¥å…·çš„ä¸­æ–‡æè¿°"""
    return TOOL_DESCRIPTIONS.get(tool_name, tool_name)


def format_confirmation_message(tool_name: str, args: dict) -> str:
    """æ ¼å¼åŒ–ç¡®è®¤æ¶ˆæ¯"""
    desc = get_tool_description(tool_name)
    args_str = ", ".join(f"{k}={v}" for k, v in args.items() if v)
    return f"å³å°†æ‰§è¡Œ: {desc}\nå‚æ•°: {args_str}\n\nç¡®è®¤æ‰§è¡Œå—ï¼Ÿ(è¾“å…¥ 'ç¡®è®¤' æˆ– 'å–æ¶ˆ')"


def format_error_with_suggestion(error_message: str) -> str:
    """
    æ ¼å¼åŒ–é”™è¯¯æ¶ˆæ¯å¹¶é™„å¸¦æ¢å¤å»ºè®®
    
    Args:
        error_message: åŸå§‹é”™è¯¯æ¶ˆæ¯
        
    Returns:
        å¸¦æœ‰å»ºè®®çš„é”™è¯¯æ¶ˆæ¯
    """
    suggestion = get_error_suggestion(error_message)
    if suggestion:
        return f"âŒ é”™è¯¯: {error_message}\n\nğŸ’¡ å»ºè®®: {suggestion}"
    return f"âŒ é”™è¯¯: {error_message}"
