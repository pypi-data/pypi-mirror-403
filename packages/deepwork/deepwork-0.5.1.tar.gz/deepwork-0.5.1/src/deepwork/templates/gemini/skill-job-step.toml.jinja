{#
Template: skill-job-step.toml.jinja
Purpose: Generates individual step skill files for Gemini CLI

Template Variables:
  Job Context:
    - job_name: string - Job identifier
    - job_summary: string - Short job summary
    - job_description: string|null - Full job description

  Step Metadata:
    - step_id: string - Step identifier
    - step_description: string - What this step does
    - step_number: int - Position in workflow (1-indexed)
    - total_steps: int - Total steps in job
    - is_standalone: bool - True if step can run independently
    - dependencies: list[string]|null - Required prior step IDs
    - next_step: string|null - Next step ID in workflow
    - instructions_file: string - Path to step instructions file

  Step Content:
    - instructions_content: string - Full instructions markdown
    - user_inputs: list|null - User parameters to gather:
        - name: string - Parameter name
        - description: string - What to ask for
    - file_inputs: list|null - Files from previous steps:
        - file: string - File path
        - from_step: string - Source step ID
    - outputs: list[string]|null - Output file paths

  Quality:
    - quality_criteria: list[string]|null - Criteria for completion
    - stop_hooks: list|null - Stop hook configurations (note: Gemini
      does not support automated hooks, so these are for manual verification)

Note: Gemini uses TOML format with description + prompt fields.
      Commands use colon separator (/job_name:step_id) not period.
#}
# {{ job_name }}:{{ step_id }}
#
# {{ step_description }}
#
# Generated by DeepWork - do not edit manually

description = "{{ step_description | replace('"', '\\"') }}"

prompt = """
# {{ job_name }}:{{ step_id }}

{% if is_standalone %}
**Standalone command** - can be run anytime
{% else %}
**Step {{ step_number }}/{{ total_steps }}** in **{{ job_name }}** workflow
{% endif %}

> {{ job_summary }}

{% if dependencies %}
## Prerequisites (Verify First)

Before proceeding, confirm these steps are complete:
{% for dep in dependencies %}
- `/{{ job_name }}:{{ dep }}`
{% endfor %}
{% endif %}

## Instructions

**Goal**: {{ step_description }}

{{ instructions_content }}

{% if job_description %}
### Job Context

{{ job_description }}
{% endif %}

{% if user_inputs or file_inputs %}
## Required Inputs

{% if user_inputs %}
**User Parameters** - Gather from user before starting:
{% for input in user_inputs %}
- **{{ input.name }}**: {{ input.description }}
{% endfor %}
{% endif %}

{% if file_inputs %}
**Files from Previous Steps** - Read these first:
{% for input in file_inputs %}
- `{{ input.file }}` (from `{{ input.from_step }}`)
{% endfor %}
{% endif %}
{% endif %}

## Work Branch

Use branch format: `deepwork/{{ job_name }}-[instance]-YYYYMMDD`

- If on a matching work branch: continue using it
- If on main/master: create new branch with `git checkout -b deepwork/{{ job_name }}-[instance]-$(date +%Y%m%d)`

## Outputs

{% if outputs %}
**Required outputs**:
{% for output in outputs %}
- `{{ output.file }}`{% if output.file.endswith('/') %} (directory){% endif %}

{% if output.has_doc_spec and output.doc_spec %}
  **Doc Spec**: {{ output.doc_spec.name }}
  > {{ output.doc_spec.description }}
  **Definition**: `{{ output.doc_spec.path }}`
{% if output.doc_spec.target_audience %}
  **Target Audience**: {{ output.doc_spec.target_audience }}
{% endif %}
{% if output.doc_spec.quality_criteria %}
  **Quality Criteria**:
{% for criterion in output.doc_spec.quality_criteria %}
  {{ loop.index }}. **{{ criterion.name }}**: {{ criterion.description }}
{% endfor %}
{% endif %}
{% endif %}
{% endfor %}
{% else %}
No specific file outputs required.
{% endif %}

{% if quality_criteria or stop_hooks %}
## Quality Validation (Manual)

**NOTE**: Gemini CLI does not support automated validation. Manually verify criteria before completing.

{% if quality_criteria %}
**Criteria (all must be satisfied)**:
{% for criterion in quality_criteria %}
{{ loop.index }}. {{ criterion }}
{% endfor %}
{% endif %}
{% endif %}
## On Completion

{% if is_standalone %}
1. Verify outputs are created
2. Inform user: "{{ step_id }} complete{% if outputs %}, outputs: {{ outputs | map(attribute='file') | join(', ') }}{% endif %}"

This standalone command can be re-run anytime.
{% else %}
1. Verify outputs are created
2. Inform user: "Step {{ step_number }}/{{ total_steps }} complete{% if outputs %}, outputs: {{ outputs | map(attribute='file') | join(', ') }}{% endif %}"
{% if next_step %}
3. **Tell user next command**: `/{{ job_name }}:{{ next_step }}`
{% else %}
3. **Workflow complete**: All steps finished. Consider creating a PR to merge the work branch.
{% endif %}
{% endif %}

---

**Reference files**: `.deepwork/jobs/{{ job_name }}/job.yml`, `.deepwork/jobs/{{ job_name }}/{{ instructions_file }}`
"""
