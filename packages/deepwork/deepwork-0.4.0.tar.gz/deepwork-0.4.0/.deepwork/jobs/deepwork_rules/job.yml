name: deepwork_rules
version: "0.4.0"
summary: "Creates file-change rules that enforce guidelines during AI sessions. Use when automating documentation sync or code review triggers."
description: |
  Manages rules that automatically trigger when certain files change during an AI agent session.
  Rules help ensure that code changes follow team guidelines, documentation is updated,
  and architectural decisions are respected.

  IMPORTANT: Rules are evaluated at the "Stop" hook, which fires when an agent finishes its turn.
  This includes when sub-agents complete their work. Rules are NOT evaluated immediately after
  each file edit - they batch up and run once at the end of the agent's response cycle.
  - Command action rules: Execute their command (e.g., `uv sync`) when the agent stops
  - Prompt action rules: Display instructions to the agent, blocking until addressed

  Rules are stored as individual markdown files with YAML frontmatter in the `.deepwork/rules/`
  directory. Each rule file specifies:
  - Detection mode: trigger/safety, set (bidirectional), or pair (directional)
  - Patterns: Glob patterns for matching files, with optional variable capture
  - Action type: prompt (default) to show instructions, or command to run a shell command
  - Instructions: Markdown content describing what the agent should do

  Example use cases:
  - Update installation docs when configuration files change
  - Require security review when authentication code is modified
  - Ensure API documentation stays in sync with API code
  - Enforce source/test file pairing
  - Auto-run `uv sync` when pyproject.toml changes (command action)

changelog:
  - version: "0.1.0"
    changes: "Initial version"
  - version: "0.2.0"
    changes: "Standardized on 'ask structured questions' phrasing for user input"
  - version: "0.3.0"
    changes: "Migrated to v2 format - individual markdown files in .deepwork/rules/"
  - version: "0.4.0"
    changes: "Improved skill descriptions with third-person voice and 'Use when...' triggers for better discoverability"

steps:
  - id: define
    name: "Define Rule"
    description: "Creates a rule file that triggers when specified files change. Use when setting up documentation sync, code review requirements, or automated commands."
    instructions_file: steps/define.md
    inputs:
      - name: rule_purpose
        description: "What guideline or constraint should this rule enforce?"
    outputs:
      - .deepwork/rules/{rule-name}.md
    dependencies: []
