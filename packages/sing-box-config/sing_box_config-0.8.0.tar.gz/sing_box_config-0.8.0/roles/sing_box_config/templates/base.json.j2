{%- import "includes/dns.j2" as dns_lib with context -%}
{%- import "includes/inbounds.j2" as inbounds_lib with context -%}
{%- import "includes/outbounds.j2" as outbounds_lib with context -%}
{%- import "includes/route.j2" as route_lib with context -%}
{%- import "includes/experimental.j2" as experimental_lib with context -%}

{%- set config = {
    "log": {
        "level": sing_box_log_level
    },
    "dns": dns_lib.get_dns_config() | ansible.builtin.from_json,
    "inbounds": inbounds_lib.get_inbounds_config() | ansible.builtin.from_json,
    "outbounds": outbounds_lib.get_outbounds_config() | ansible.builtin.from_json,
    "route": route_lib.get_route_config() | ansible.builtin.from_json,
    "experimental": experimental_lib.get_experimental_config() | ansible.builtin.from_json
} -%}

{{ config | ansible.builtin.to_json(indent=4, ensure_ascii=false, sort_keys=false) }}
