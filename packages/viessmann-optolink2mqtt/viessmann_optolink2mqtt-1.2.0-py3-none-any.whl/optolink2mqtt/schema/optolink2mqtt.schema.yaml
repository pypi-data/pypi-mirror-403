# Schema for the YAML config file written using Yamala syntax

logging: include('logging',required=False)
optolink: include('optolink',required=True)
mqtt: include('mqtt',required=True)
registers_poll_list: list(include('register_definition'))

---
logging:
  level: str(required=False)
  report_status_period_sec: int(required=False)
---
optolink:
  serial_port: str()
  show_received_bytes: bool(required=False)
  reconnect_period_sec: int(required=False)
---
mqtt:
  broker: include('mqtt_broker')
  clientid: str(required=False)
  qos: int(required=False)
  retain: bool(required=False)
  reconnect_period_sec: int(required=False)
  request_topic: str(required=False)
  publish_topic_prefix: str(required=False)
  ha_discovery: include('mqtt_ha_discovery',required=False)
---
mqtt_ha_discovery:
  enabled: bool(required=False)
  topic: str(required=False)
  device_name: str(required=False)
---
mqtt_broker:
  host: str()
  port: int()
  username: str(required=False)
  password: str(required=False)
---
register_definition: 
  name: str()
  sampling_period_seconds: int(min=1)
  register: int()
  length: int()
  signed: bool(required=False) # defaults to false
  writable: bool(required=False) # defaults to false
  byte_filter: str(required=False) # defaults to no byte filter
  enum: map(str,str,required=False)  # defaults to no enumeration
  scale_factor: num(min=0, required=False) # defaults to 1
  ha_discovery: include('register_ha_discovery',required=False) # no HomeAssistant discovery by default
---
register_ha_discovery:
  # name and platform are the only 2 required fields:
  name: str()
  platform: str()
  # everything else is marked as optional but it maybe required for a particular platform
  device_class: str(required=False)
  icon: str(required=False)
  unit_of_measurement: str(required=False)
  entity_category: str(required=False)
  expire_after: int(required=False)
  payload_on: str(required=False)
  payload_off: str(required=False)
  value_template: str(required=False)
  state_class: str(required=False)
  min: num(required=False)
  max: num(required=False)
  step: num(required=False)
  mode: str(required=False)
  optimistic: bool(required=False)
  
  # if you update this list, remember to update also the get_ha_discovery_payload()
  # method in optolinkvs2_register.py accordingly!