"""init

Revision ID: 7fcb7d6a5836
Revises: 
Create Date: 2025-12-11 22:49:37.368709

"""
from typing import Sequence, Union

import sqlmodel
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '7fcb7d6a5836'
down_revision: Union[str, Sequence[str], None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('datasheets',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('part_number', sqlmodel.sql.sqltypes.AutoString(length=100), nullable=False),
    sa.Column('datasheet', sqlmodel.sql.sqltypes.AutoString(length=500), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_datasheets_datasheet'), 'datasheets', ['datasheet'], unique=False)
    op.create_index(op.f('ix_datasheets_part_number'), 'datasheets', ['part_number'], unique=False)
    op.create_table('projects',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sqlmodel.sql.sqltypes.AutoString(length=45), nullable=False),
    sa.Column('index_id', sqlmodel.sql.sqltypes.AutoString(), nullable=False),
    sa.Column('repo_dir', sqlmodel.sql.sqltypes.AutoString(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_projects_index_id'), 'projects', ['index_id'], unique=True)
    op.create_index(op.f('ix_projects_name'), 'projects', ['name'], unique=True)
    op.create_index(op.f('ix_projects_repo_dir'), 'projects', ['repo_dir'], unique=True)
    op.create_table('pipeline_runs',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('project_id', sa.Integer(), nullable=True),
    sa.Column('status', sa.Integer(), server_default='0', nullable=False),
    sa.Column('errors', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['project_id'], ['projects.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_pipeline_runs_project_id'), 'pipeline_runs', ['project_id'], unique=False)
    op.create_table('files',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('pipeline_run_id', sa.Integer(), nullable=False),
    sa.Column('name', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
    sa.Column('type', sa.Integer(), nullable=False),
    sa.Column('sub_type', sa.Integer(), nullable=True),
    sa.Column('mime_type', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
    sa.Column('md5', sqlmodel.sql.sqltypes.AutoString(length=32), nullable=False),
    sa.Column('ext', sqlmodel.sql.sqltypes.AutoString(length=10), nullable=True),
    sa.Column('path', sqlmodel.sql.sqltypes.AutoString(length=600), nullable=True),
    sa.Column('gemini_file_id', sqlmodel.sql.sqltypes.AutoString(length=40), nullable=True),
    sa.Column('is_datasheet', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline_runs.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('md5', 'pipeline_run_id', name='uq_file_md5_pipeline_run')
    )
    op.create_index(op.f('ix_files_ext'), 'files', ['ext'], unique=False)
    op.create_index(op.f('ix_files_is_datasheet'), 'files', ['is_datasheet'], unique=False)
    op.create_index(op.f('ix_files_md5'), 'files', ['md5'], unique=False)
    op.create_index(op.f('ix_files_name'), 'files', ['name'], unique=False)
    op.create_index(op.f('ix_files_pipeline_run_id'), 'files', ['pipeline_run_id'], unique=False)
    op.create_index(op.f('ix_files_sub_type'), 'files', ['sub_type'], unique=False)
    op.create_index(op.f('ix_files_type'), 'files', ['type'], unique=False)
    op.create_table('netlists',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('pipeline_run_id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['pipeline_run_id'], ['pipeline_runs.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_netlists_pipeline_run_id'), 'netlists', ['pipeline_run_id'], unique=False)
    op.create_table('bom',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('file_id', sa.Integer(), nullable=False),
    sa.Column('reference', sqlmodel.sql.sqltypes.AutoString(length=100), nullable=False),
    sa.Column('value', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
    sa.Column('quantity', sa.Integer(), nullable=False),
    sa.Column('description', sqlmodel.sql.sqltypes.AutoString(length=600), nullable=False),
    sa.Column('manufacturer', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=True),
    sa.Column('mpn', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=True),
    sa.Column('lifecycle_status', sqlmodel.sql.sqltypes.AutoString(length=50), nullable=True),
    sa.Column('supplier', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=True),
    sa.Column('supplier_part', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=True),
    sa.Column('supplier_unit_price', sa.Float(), nullable=True),
    sa.Column('supplier_subtotal', sa.Float(), nullable=True),
    sa.Column('revision_id', sqlmodel.sql.sqltypes.AutoString(length=50), nullable=True),
    sa.Column('revision_state', sqlmodel.sql.sqltypes.AutoString(length=50), nullable=True),
    sa.Column('revision_status', sqlmodel.sql.sqltypes.AutoString(length=100), nullable=True),
    sa.Column('datasheet', sqlmodel.sql.sqltypes.AutoString(length=500), nullable=True),
    sa.Column('created_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.Column('updated_at', sa.TIMESTAMP(timezone=True), server_default=sa.text('(CURRENT_TIMESTAMP)'), nullable=False),
    sa.ForeignKeyConstraint(['file_id'], ['files.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_bom_file_id'), 'bom', ['file_id'], unique=False)
    op.create_table('netlist_components',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('netlist_id', sa.Integer(), nullable=False),
    sa.Column('ref_des', sqlmodel.sql.sqltypes.AutoString(length=100), nullable=False),
    sa.Column('part_number', sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
    sa.Column('bom_entry_id', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['bom_entry_id'], ['bom.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['netlist_id'], ['netlists.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_netlist_components_bom_entry_id'), 'netlist_components', ['bom_entry_id'], unique=False)
    op.create_index(op.f('ix_netlist_components_netlist_id'), 'netlist_components', ['netlist_id'], unique=False)
    op.create_index(op.f('ix_netlist_components_part_number'), 'netlist_components', ['part_number'], unique=False)
    op.create_table('netlist_pins',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('netlist_component_id', sa.Integer(), nullable=False),
    sa.Column('pin', sqlmodel.sql.sqltypes.AutoString(length=100), nullable=False),
    sa.Column('net', sqlmodel.sql.sqltypes.AutoString(length=100), nullable=False),
    sa.ForeignKeyConstraint(['netlist_component_id'], ['netlist_components.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_netlist_pins_netlist_component_id'), 'netlist_pins', ['netlist_component_id'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_netlist_pins_netlist_component_id'), table_name='netlist_pins')
    op.drop_table('netlist_pins')
    op.drop_index(op.f('ix_netlist_components_part_number'), table_name='netlist_components')
    op.drop_index(op.f('ix_netlist_components_netlist_id'), table_name='netlist_components')
    op.drop_index(op.f('ix_netlist_components_bom_entry_id'), table_name='netlist_components')
    op.drop_table('netlist_components')
    op.drop_index(op.f('ix_bom_file_id'), table_name='bom')
    op.drop_table('bom')
    op.drop_index(op.f('ix_netlists_pipeline_run_id'), table_name='netlists')
    op.drop_table('netlists')
    op.drop_index(op.f('ix_files_type'), table_name='files')
    op.drop_index(op.f('ix_files_sub_type'), table_name='files')
    op.drop_index(op.f('ix_files_pipeline_run_id'), table_name='files')
    op.drop_index(op.f('ix_files_name'), table_name='files')
    op.drop_index(op.f('ix_files_md5'), table_name='files')
    op.drop_index(op.f('ix_files_is_datasheet'), table_name='files')
    op.drop_index(op.f('ix_files_ext'), table_name='files')
    op.drop_table('files')
    op.drop_index(op.f('ix_pipeline_runs_project_id'), table_name='pipeline_runs')
    op.drop_table('pipeline_runs')
    op.drop_index(op.f('ix_projects_repo_dir'), table_name='projects')
    op.drop_index(op.f('ix_projects_name'), table_name='projects')
    op.drop_index(op.f('ix_projects_index_id'), table_name='projects')
    op.drop_table('projects')
    op.drop_index(op.f('ix_datasheets_part_number'), table_name='datasheets')
    op.drop_index(op.f('ix_datasheets_datasheet'), table_name='datasheets')
    op.drop_table('datasheets')
    # ### end Alembic commands ###
