{
  "$id": "https://dev-investor.de/pp-terminal/config.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Configuration",
  "description": "pp-terminal Configuration File",
  "type": "object",
  "properties": {
    "file": {
      "description": "The Portfolio Performance XML file location",
      "type": "string"
    },
    "precision": {
      "description": "Decimal precision for calculations",
      "type": "integer",
      "minimum": 0
    },
    "tax": {
      "description": "Tax-related configuration",
      "type": "object",
      "properties": {
        "rate": {
          "description": "Tax rate as percentage (e.g., 26.375 for 26.375%)",
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "file": {
          "description": "Path to tax calculation file",
          "type": "string"
        },
        "exemption-rate": {
          "description": "Default tax exemption rate as percentage (e.g., 30 for 30%)",
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "exemption-rate-attribute": {
          "description": "UUID of the security attribute containing per-security exemption rates",
          "$ref": "#/$defs/uuid"
        }
      },
      "additionalProperties": false
    },
    "commands": {
      "description": "Command-specific configuration",
      "type": "object",
      "properties": {
        "validate": {
          "description": "Validation rules for portfolio data",
          "type": "object",
          "properties": {
            "accounts": {
              "description": "Validation rules for deposit accounts",
              "type": "object",
              "properties": {
                "rules": {
                  "type": "array",
                  "items": {
                    "$ref": "#/$defs/accountRule"
                  }
                }
              },
              "additionalProperties": false
            },
            "securities": {
              "description": "Validation rules for securities",
              "type": "object",
              "properties": {
                "rules": {
                  "type": "array",
                  "items": {
                    "$ref": "#/$defs/securityRule"
                  }
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "view": {
          "description": "Configuration for view commands",
          "type": "object",
          "properties": {
            "accounts": {
              "description": "Configuration for view accounts command",
              "type": "object",
              "properties": {
                "columns": {
                  "description": "Default columns to display (e.g., [\"AccountId\", \"Name\", \"Balance\"])",
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "minItems": 1
                }
              },
              "additionalProperties": false
            },
            "securities": {
              "description": "Configuration for view securities command",
              "type": "object",
              "properties": {
                "columns": {
                  "description": "Default columns to display (e.g., [\"SecurityId\", \"Name\", \"Shares\"])",
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "minItems": 1
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "export": {
          "description": "Configuration for export commands",
          "type": "object",
          "properties": {
            "anonymized": {
              "description": "Configuration for export anonymized command",
              "type": "object",
              "properties": {
                "attributes": {
                  "description": "Attribute anonymization mapping. Keys are Portfolio Performance attribute UUIDs, values define how to replace them with fake data using Faker library providers.",
                  "type": "object",
                  "additionalProperties": {
                    "type": "object",
                    "required": ["provider"],
                    "properties": {
                      "provider": {
                        "description": "Faker provider method name (e.g., 'pyfloat', 'iban', 'name', 'address'). See https://faker.readthedocs.io/en/master/providers.html",
                        "type": "string"
                      },
                      "args": {
                        "description": "Arguments to pass to the Faker provider method",
                        "type": "object",
                        "additionalProperties": true
                      }
                    },
                    "additionalProperties": false
                  }
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "$defs": {
    "uuid": {
      "type": "string",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$"
    },
    "severity": {
      "type": "string",
      "enum": ["warning", "error"],
      "default": "error"
    },
    "appliesTo": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minItems": 1
    },
    "accountRule": {
      "type": "object",
      "required": ["type", "value"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["balance-limit", "balance-limit-from-attribute", "date-passed-from-attribute"]
        },
        "value": {
          "description": "For balance-limit: a number. For *-from-attribute rules: Portfolio Performance attribute UUID.",
          "oneOf": [
            {
              "type": "number",
              "minimum": 0
            },
            {
              "$ref": "#/$defs/uuid"
            }
          ]
        },
        "severity": {
          "$ref": "#/$defs/severity"
        },
        "applies-to": {
          "$ref": "#/$defs/appliesTo"
        }
      },
      "additionalProperties": false
    },
    "securityRule": {
      "type": "object",
      "required": ["type", "value"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["price-staleness", "price-limit", "price-limit-from-attribute"]
        },
        "value": {
          "description": "For price-staleness/price-limit: a number. For *-from-attribute rules: Portfolio Performance attribute UUID.",
          "oneOf": [
            {
              "type": "integer",
              "minimum": 0
            },
            {
              "$ref": "#/$defs/uuid"
            }
          ]
        },
        "severity": {
          "$ref": "#/$defs/severity"
        },
        "applies-to": {
          "$ref": "#/$defs/appliesTo"
        }
      },
      "additionalProperties": false
    }
  }
}