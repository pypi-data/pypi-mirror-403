import{r as p,t as A,j as e,L as D,C as T,D as B,B as E}from"./vendor-tanstack-BcZfOOfy.js";import{u as I,a as k}from"./use-quick-run-CPempwLh.js";import{bN as M,aN as z,aR as O,q as _,I as P,y as $,N as Q,O as V,S as G,a as W,b as H,c as L,e as j,c4 as U,c5 as Z,X as q}from"./index-m48E4KcG.js";import{D as X}from"./data-table-rlbkLcrY.js";import{D as J}from"./delete-confirmation-dialog-DHkm2p8m.js";import{S as K}from"./index-CQnWiUE5.js";import{S as Y}from"./index-CKGj5lSu.js";import{T as F}from"./tags-input-BLPMVWpZ.js";import{s as ee,U as se}from"./vendor-date-wwuDAncJ.js";import{D as ae,a as le,b as te,c as ne,d}from"./dropdown-menu-0atiOSFo.js";const ie=({row:n,onDelete:s})=>{const{id:l,parameters:o}=n.original,{onQuickRun:u,isPending:i}=I();return l?e.jsx("div",{className:"flex flex-row justify-end",children:e.jsxs(ae,{children:[e.jsx(le,{asChild:!0,children:e.jsxs(_,{variant:"outline",className:"size-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(P,{id:"MoreVertical",className:"size-4"})]})}),e.jsxs(te,{align:"end",children:[e.jsx(ne,{children:"Actions"}),e.jsx(d,{disabled:i,onClick:()=>u(l),children:"Quick Run"}),e.jsx(d,{children:e.jsx(D,{to:"/deployments/deployment/$id/run",params:{id:l},search:{parameters:o},children:"Custom Run"})}),e.jsx(d,{onClick:()=>{navigator.clipboard.writeText(l),$.success("ID copied")},children:"Copy ID"}),e.jsx(d,{children:e.jsx(D,{to:"/deployments/deployment/$id/edit",params:{id:l},children:"Edit"})}),e.jsx(d,{onClick:()=>s(n.original),children:"Delete"}),e.jsx(d,{children:e.jsx(D,{to:"/deployments/deployment/$id/duplicate",params:{id:l},children:"Duplicate"})})]})]})}):null},C=8,re=4,oe=({row:n})=>{const[s,l]=p.useState(0),o=M(s,150),u=p.useCallback(r=>{if(!r)return;const x=()=>{const v=r.getBoundingClientRect().width;l(Math.floor(v/(C+re)))};x();const g=new ResizeObserver(x);return g.observe(r),()=>{g.disconnect()}},[]),{data:i}=A(z({deployments:{operator:"and_",id:{any_:[n.original.id]}},sort:"START_TIME_DESC",limit:o||s,offset:0})),{flow:h,...y}=n.original,c=i?.map(r=>({...r,deployment:y,flow:h}))??[];return e.jsx("div",{className:"w-full",ref:u,children:e.jsx(O,{startDate:ee(new Date,se),endDate:new Date,numberOfBars:o||s,barWidth:C,enrichedFlowRuns:c,className:"h-12 w-full",chartId:n.original.id})})},m=E(),ce=({onDelete:n})=>[m.display({id:"name",header:"Deployment",cell:({row:s})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx(D,{to:"/deployments/deployment/$id",params:{id:s.original.id},children:e.jsx("span",{className:"text-sm font-medium truncate",title:s.original.name,children:s.original.name})}),s.original.flow&&e.jsx(Z,{flow:s.original.flow,className:"text-xs text-muted-foreground flex items-center gap-1",iconSize:12})]}),size:100}),m.accessor("status",{id:"status",header:"Status",cell:({row:s})=>{const l=s.original.status;return l?e.jsx("div",{className:"min-w-28",children:e.jsx(Y,{status:l})}):null},size:50}),m.display({id:"activity",header:"Activity",cell:s=>e.jsx("div",{className:"flex flex-row gap-2 items-center min-w-28",children:e.jsx(oe,{...s})}),size:300}),m.display({id:"tags",header:()=>null,cell:({row:s})=>e.jsx(q,{tags:s.original.tags??[]})}),m.display({id:"schedules",header:"Schedules",cell:({row:s})=>{const l=s.original.schedules;return!l||l.length===0?null:e.jsx(K,{schedules:l})},size:150}),m.display({id:"actions",cell:s=>e.jsx(ie,{...s,onDelete:n})})],ye=({deployments:n,currentDeploymentsCount:s,pagination:l,pageCount:o,sort:u,columnFilters:i,onPaginationChange:h,onSortChange:y,onColumnFiltersChange:c})=>{const[r,x]=k(),g=i.find(a=>a.id==="flowOrDeploymentName")?.value??"",v=i.find(a=>a.id==="tags")?.value??[],b=p.useCallback(a=>{const t=i.filter(f=>f.id!=="flowOrDeploymentName");c(a?[...t,{id:"flowOrDeploymentName",value:a}]:t)},[c,i]),S=p.useCallback(a=>{const t=Array.isArray(a)?a:a.target.value,f=i.filter(R=>R.id!=="tags");c(t.length?[...f,{id:"tags",value:t}]:f)},[c,i]),N=p.useCallback(a=>{let t=l;typeof a=="function"?t=a(l):t=a,h(t)},[l,h]),w=T({data:n,columns:ce({onDelete:a=>{const t=a.flow?.name?`${a.flow?.name}/${a.name}`:a.name;x({...a,name:t})}}),getCoreRowModel:B(),pageCount:o,manualPagination:!0,defaultColumn:{maxSize:300},state:{pagination:l},onPaginationChange:N});return e.jsxs("div",{children:[e.jsxs("div",{className:"grid sm:grid-cols-2 md:grid-cols-6 lg:grid-cols-12 gap-2 pb-4 items-center",children:[e.jsx("div",{className:"sm:col-span-2 md:col-span-6 lg:col-span-4 order-last lg:order-first",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s," ",Q(s,"Deployment")]})}),e.jsx("div",{className:"sm:col-span-2 md:col-span-2 lg:col-span-3",children:e.jsx(V,{placeholder:"Search deployments",value:g,onChange:a=>b(a.target.value)})}),e.jsx("div",{className:"xs:col-span-1 md:col-span-2 lg:col-span-3",children:e.jsx(F,{placeholder:"Filter by tags",onChange:S,value:v})}),e.jsx("div",{className:"xs:col-span-1 md:col-span-2 lg:col-span-2",children:e.jsxs(G,{value:u,onValueChange:y,children:[e.jsx(W,{"aria-label":"Deployment sort order",className:"w-full",children:e.jsx(H,{placeholder:"Sort by"})}),e.jsxs(L,{children:[e.jsx(j,{value:"CREATED_DESC",children:"Created"}),e.jsx(j,{value:"UPDATED_DESC",children:"Updated"}),e.jsx(j,{value:"NAME_ASC",children:"A to Z"}),e.jsx(j,{value:"NAME_DESC",children:"Z to A"})]})]})})]}),e.jsx(J,{...r}),e.jsx(U,{children:e.jsx(X,{table:w})})]})};export{ye as D};
//# sourceMappingURL=index-DNh9ZBy4.js.map
