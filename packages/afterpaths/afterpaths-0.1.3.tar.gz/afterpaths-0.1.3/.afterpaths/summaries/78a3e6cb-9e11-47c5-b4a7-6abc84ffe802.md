# Removing Paywall and Adding Cursor Support to Afterpaths

**Date:** 2026-01-14 | **Duration:** 6h 38m
**Files:** README.md, cli.py, licensing.py, base.py, claude_code.py, cursor.py

## Summary
Removed the Pro licensing paywall from the rules extraction feature, making it free for all users. Added a new Cursor IDE session adapter to read chat history from SQLite databases. Fixed several bugs in session filtering and improved the CLI output to show summarization status.

## Discoveries
- **Claude Code auto-deletes sessions after 30 days by default** - Users can prevent this by setting `"cleanupPeriodDays": 99999` in `~/.claude/settings.json`. This is a key value prop for afterpaths.
- **Claude Code automatically loads all `.md` files from `.claude/rules/`** - No code needed to inject rules; just write files to that directory and they're included in context at session start, same priority as `CLAUDE.md`.
- **Cursor stores chat history in SQLite databases** - Located at `~/Library/Application Support/Cursor/User/workspaceStorage/*/state.vscdb`. The chat data is in tables like `ItemTable` with keys containing "aiChat" or "composer" (Cursor 0.43+).
- **The `get_sessions_for_cwd()` function only queried Claude Code** - It was hardcoded to use `ClaudeCodeAdapter` instead of iterating through all registered adapters, so Cursor sessions were invisible without `--all`.

## Dead Ends
- **Substring matching for project filtering** - The original filter checked `if project_filter in project_name`, which caused `/Users/burnssa/Code/superjective` to match both `superjective` and `superjective-extension` directories. Changed to exact path matching with `==`.

## Decisions
- **Made rules extraction free instead of Pro-only** - User wants to understand usage patterns before deciding what to monetize. Kept the licensing infrastructure for a future "Vault" feature.
- **Used exact path matching for project filtering** - Substring matching caused cross-project pollution. Exact match is the expected behavior when scoping to a directory.
- **Removed `activate` command entirely** - No current paid features, so the command was confusing. The `licensing.py` file remains for future use.

## Gotchas & Warnings
- **Session type filtering hides most sessions by default** - `afterpaths log` only shows "main" sessions, not "agent" sessions (spawned by Task tool). A project might have 17 total sessions but only 4 main ones. Use `--type=all` to see everything.
- **Summary titles come from two sources** - Afterpaths summaries have a `# heading` that gets extracted. Claude Code also stores its own auto-generated summary in the JSONL. The CLI now shows afterpaths summary if available, otherwise falls back to Claude's.
- **Cursor workspace folders are stored as JSON in SQLite** - The `folder` key in `state.vscdb` contains a JSON string with a `path` field, not a direct path string.

## Open Questions
- **What triggers Claude Code's session cleanup?** - Is it strictly 30 days from last modification, or are there other criteria? Some users report unexpected deletions.
- **How should Cursor Composer chats be differentiated from regular chats?** - The adapter finds both but they may have different structures in Cursor 0.43+.
- **Should afterpaths proactively warn users about the 30-day retention?** - Could add a check on first run to suggest the settings.json change.

---
*Generated by anthropic/claude-opus-4-5-20251101 | Tokens: 11620 in, 862 out*