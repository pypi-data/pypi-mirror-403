[project]
name = "cifi"
version = "0.1.0"
description = "CiFi - toolkit for downstream processing of CiFi long reads."
authors = ["Mohamed Abuelanin <mabuelanin@gmail.com>"]
channels = ["conda-forge", "bioconda"]
platforms = ["linux-64"]

[tasks]
# Development tasks
install = "pip install -e '.[dev]' --no-build-isolation"
build = "pip install . --no-build-isolation"
clean = "rm -rf build/ dist/ *.egg-info src/*.egg-info __pycache__ .pytest_cache .ruff_cache"

# Testing
test = { cmd = "pytest tests/ -v --tb=short", depends-on = ["install"] }
test-cov = { cmd = "pytest tests/ -v --cov=src/cifi --cov-report=html --cov-report=term", depends-on = ["install"] }

# Linting and formatting
lint = "ruff check src/ tests/"
lint-fix = "ruff check --fix src/ tests/"
format = "ruff format src/ tests/"
format-check = "ruff format --check src/ tests/"

# Type checking (optional)
# typecheck = "mypy src/cifi"

# Documentation
docs = "echo 'Documentation not yet configured'"

# Release tasks (via GitHub Actions)
release-testpypi = "gh workflow run release.yml -f publish_to=testpypi"
release-pypi = "gh workflow run release.yml -f publish_to=pypi"

# Quick validation before commit
check = { depends-on = ["lint", "format-check", "test"] }

[dependencies]
# Build dependencies
python = ">=3.9"
pip = ">=23.0"
cmake = ">=3.15"
ninja = ">=1.10"
pkgconfig = ">=0.29"

# C++ build dependencies
gxx_linux-64 = ">=11"
htslib = ">=1.17"
zlib = ">=1.2"

# Python build dependencies  
scikit-build-core = ">=0.4.3"
nanobind = ">=1.3.2"

# Runtime dependencies
click = ">=8.0"
jinja2 = ">=3.0"

# Dev dependencies
pytest = ">=7.0"
pytest-cov = ">=4.0"
ruff = ">=0.1.0"
# Note: build and twine are installed via pip in pyproject.toml, not needed here

[feature.plots.dependencies]
matplotlib = ">=3.5"

[feature.pdf.dependencies]
weasyprint = ">=60.0"

[feature.bioconda.dependencies]
# Dependencies for bioconda recipe testing
conda-build = ">=3.20"
conda-verify = ">=3.1"

[environments]
default = { solve-group = "default" }
plots = { features = ["plots"], solve-group = "default" }
pdf = { features = ["pdf"], solve-group = "default" }
full = { features = ["plots", "pdf"], solve-group = "default" }
bioconda = { features = ["bioconda"], solve-group = "default" }
