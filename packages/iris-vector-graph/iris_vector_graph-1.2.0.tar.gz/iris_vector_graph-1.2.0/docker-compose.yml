services:
  iris:
    image: intersystemsdc/iris-community:latest-em
    container_name: iris_vector_graph
    ports:
      - "1972:1972"   # IRIS SuperServer port
      - "52773:52773" # IRIS Management Portal
    environment:
      - IRISNAMESPACE=USER
      - ISC_DEFAULT_PASSWORD=SYS
    volumes:
      - iris_data:/usr/irissys/mgr
      - ./sql:/home/irisowner/sql
    stdin_open: true
    tty: true
    healthcheck:
      test: ["CMD", "/usr/irissys/bin/iris", "session", "iris", "-U%SYS", "##class(%SYSTEM.Process).CurrentDirectory()"]
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 30s
    command: --check-caps false -a "iris session iris -U%SYS '##class(Security.Users).UnExpireUserPasswords(\"*\")'"

volumes:
  iris_data: {}
