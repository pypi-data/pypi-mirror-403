# Implementation Plan: Advanced Cypher Features

**Branch**: `010-cypher-advanced-features` | **Date**: 2026-01-25 | **Spec**: [specs/010-cypher-advanced-features/spec.md](spec.md)
**Input**: Feature specification from `/specs/010-cypher-advanced-features/spec.md`

## Summary

This feature transforms the system into a transactional graph engine by implementing Cypher write operations (`CREATE`, `DELETE`, `MERGE`, `SET`, `REMOVE`), advanced clauses (`UNWIND`, `OPTIONAL MATCH`), and path functions (`shortestPath`, `allShortestPaths`). The approach involves extending the recursive-descent parser to handle updating clauses and collection expressions, and enhancing the SQL translator to generate transactional IRIS DML (INSERT/UPDATE/DELETE) and optimized path-finding queries.

## Technical Context

**Language/Version**: Python 3.11
**Primary Dependencies**: `intersystems-irispython`, `fastapi`, `strawberry-graphql`.
**Storage**: InterSystems IRIS (NodePK schema).
**Testing**: `pytest` with live IRIS instance.
**Target Platform**: Linux (Docker).
**Project Type**: Core Library (`iris_vector_graph`) + Web API (`api/`).
**Performance Goals**: < 500ms for 10-hop paths on fraud dataset (SC-004).
**Constraints**: Read Committed isolation (FR-008), NULL for missing paths, zero rows for empty UNWIND.
**Scale/Scope**: Transactional lifecycle management for graphs with 100+ node batch creation.

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

1. **I. Library-First**: Logic resides in `iris_vector_graph/cypher/`. **PASS**
2. **II. CLI Interface**: Functionality exposed via Cypher API. **PASS**
3. **III. Test-First**: Integration tests for write operations and paths required. **PASS**
4. **IV. Integration Testing**: Must use live IRIS database for state-changing tests. **PASS**
5. **V. Observability**: Structured logging for SQL generation and transaction status. **PASS**

## Project Structure

### Documentation (this feature)

```text
specs/010-cypher-advanced-features/
├── plan.md              # This file
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output
├── quickstart.md        # Phase 1 output
├── contracts/           # Phase 1 output
└── tasks.md             # Phase 2 output (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
iris_vector_graph/
└── cypher/
    ├── parser.py        # Extend for UpdatingClause, UNWIND, FunctionCall
    ├── translator.py    # Implement Transactional DML generator
    └── algorithms/      # New: Path finding logic (shortestPath)

api/
└── routers/
    └── cypher.py        # Update for transactional execution

tests/
├── unit/
│   └── cypher/
│       ├── test_parser_advanced.py
│       └── test_translator_dml.py
└── integration/
    └── test_cypher_advanced.py
```

**Structure Decision**: Extending the existing `cypher` module structure with a new `algorithms` submodule for path finding.

## Complexity Tracking

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| None | N/A | N/A |
