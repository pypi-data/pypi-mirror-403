# Implementation Plan: Cypher Relationship Pattern Support

**Branch**: `001-cypher-relationship-patterns` | **Date**: 2026-01-25 | **Spec**: [specs/001-cypher-relationship-patterns/spec.md](spec.md)
**Input**: Feature specification from `/specs/001-cypher-relationship-patterns/spec.md`

## Summary

This feature fixes the Cypher MVP parser and translator to correctly handle relationship patterns, including single types, multiple pipe-separated types, and untyped relationships. The technical approach involves updating the regex-based parser in `iris_vector_graph/cypher/parser.py` and fixing the SQL generation logic in `iris_vector_graph/cypher/translator.py` to ensure correct JOIN operations and support for multiple relationship predicates.

## Technical Context

**Language/Version**: Python 3.11, InterSystems IRIS 2025.1+  
**Primary Dependencies**: `intersystems-irispython`, `fastapi`, `strawberry-graphql`  
**Storage**: InterSystems IRIS (NodePK schema: `nodes`, `rdf_edges`, `rdf_labels`, `rdf_props`)  
**Testing**: `pytest` with live IRIS database (mandatory per constitution)  
**Target Platform**: Linux (Docker)  
**Project Type**: Core Library (`iris_vector_graph`) + Web API (`api/`)  
**Performance Goals**: Graph queries <1ms (with HNSW/SQL optimization)  
**Constraints**: Must use IRIS-native SQL and Python integration; avoid complex Cypher features not in MVP scope.  
**Scale/Scope**: Fraud detection dataset with 150+ entities; parser must handle common traversal patterns.

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

1. **IRIS-Native Development**: Does the plan leverage IRIS SQL and embedded operations? **YES**
2. **Test-First with Live Database**: Are integration tests using a live IRIS instance planned? **YES**
3. **Performance as a Feature**: Does the translator produce optimized SQL for IRIS? **YES** (Needs verification during design)
4. **Hybrid Search by Default**: N/A for this parser fix (focused on graph traversal).
5. **Observability & Debuggability**: Will parser/translator errors be logged clearly? **YES**
6. **Modular Core Library**: Are changes isolated to the `iris_vector_graph` module? **YES**
7. **Explicit Error Handling**: Will malformed Cypher return actionable error messages? **YES**
8. **Standardized Database Interfaces**: Does it use the existing `IRISGraphEngine` or compatible SQL? **YES**

## Project Structure

### Documentation (this feature)

```text
specs/001-cypher-relationship-patterns/
├── plan.md              # This file
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output
├── quickstart.md        # Phase 1 output
├── contracts/           # Phase 1 output
└── tasks.md             # Phase 2 output (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
iris_vector_graph/
└── cypher/
    ├── parser.py        # Regex-based parser to be fixed
    └── translator.py    # SQL translator to be fixed

api/
└── routers/
    └── cypher.py        # API endpoint using the parser/translator

tests/
└── integration/
    └── test_cypher_patterns.py # New integration tests
```

**Structure Decision**: Single project structure with focus on the `iris_vector_graph/cypher` module and integration tests in `tests/integration`.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| None | N/A | N/A |
