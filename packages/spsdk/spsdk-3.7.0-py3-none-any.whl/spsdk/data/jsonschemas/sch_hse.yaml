# Copyright 2025-2026 NXP
#
# SPDX-License-Identifier: BSD-3-Clause

key_info:
  type: object
  title: HSE Key Information
  required: [output, keyType, keyBitLen]
  properties:
    output:
      type: string
      title: Output file name
      description: Output Key Info file name
      format: file_name
      template_value: key_info.bin

    keyType:
      type: string
      title: Key Type
      description: Type of the cryptographic key
      enum: [SHE, AES, HMAC, SHARED_SECRET, SIPHASH, ECC_PAIR, ECC_PUB, ECC_PUB_EXT,
             RSA_PAIR, RSA_PUB, RSA_PUB_EXT, DH_PAIR, DH_PUB]
      template_value: AES

    keyBitLen:
      type: number
      title: Key Bit Length
      description: Length of the key in bits
      format: number
      enum: [0, 64, 128, 160, 192, 224, 240, 256, 320, 384, 512, 521, 638, 1024, 2048, 3072, 4096]
      template_value: 256

    keyCounter:
      type: [number, string]
      title: Key Counter
      description: Counter value for rollback protection (0 to 0xFFFFFFFE)
      format: number
      minimum: 0
      maximum: 0xFFFFFFFE
      template_value: 0

    keyFlags:
      type: array
      title: Key Flags
      description: |
        Flags defining key properties and usage restrictions:
        - USAGE_ENCRYPT: Key is used to encrypt data (including keys if USAGE_KEY_PROVISION is set)
        - USAGE_DECRYPT: Key is used to decrypt data (including keys if USAGE_KEY_PROVISION is set)
        - USAGE_SIGN: Key is used to generate digital signatures or MACs of any data (including keys if USAGE_KEY_PROVISION is set)
        - USAGE_VERIFY: Key is used to verify digital signatures or MACs of any data (including keys if USAGE_KEY_PROVISION is set)
        - USAGE_EXCHANGE: Key may be used for key exchange operations
        - USAGE_DERIVE: Key may be used as a base key for deriving other keys
        - USAGE_KEY_PROVISION: Key used for key provisioning operation. Provision keys can only be NVM keys. This flag along with encrypt/decrypt/sign/verify flags specifies which operations can be performed on a key using this provisioning key
        - USAGE_AUTHORIZATION: Key can be used for system authorization. Can be set only for NVM keys. This key should have the verify flag set, but the sign flag NOT set
        - USAGE_SMR_DECRYPT: The key is used for SMR decryption. If this flag is set during key installation, HSE will set the USAGE_DECRYPT flag to zero
        - ACCESS_WRITE_PROT: The key is write protected and cannot change anymore. For RAM keys, this flag is forced to zero
        - ACCESS_DEBUG_PROT: The key is disabled when a debugger is attached. For RAM keys, this flag is forced to zero
        - ACCESS_EXPORTABLE: The key can be exported in any format. Ignored when used in combination with USAGE_KEY_PROVISION or USAGE_AUTHORIZATION (provision/authorization keys are NOT exportable)
        - USAGE_XTS_TWEAK: This is used as a tweak key in XTS AES encryption; no other flag shall be set
        - USAGE_OTFAD_DECRYPT: The key is used just in OTFAD decryption; no other flag shall be set
      items:
        type: string
        enum: [USAGE_ENCRYPT, USAGE_DECRYPT, USAGE_SIGN, USAGE_VERIFY, USAGE_EXCHANGE,
               USAGE_DERIVE, USAGE_KEY_PROVISION, USAGE_AUTHORIZATION, USAGE_SMR_DECRYPT,
               ACCESS_WRITE_PROT, ACCESS_DEBUG_PROT, ACCESS_EXPORTABLE, USAGE_XTS_TWEAK,
               USAGE_OTFAD_DECRYPT]
        template_value: [USAGE_ENCRYPT, USAGE_DECRYPT]
      enum_template:  [USAGE_ENCRYPT, USAGE_DECRYPT, USAGE_SIGN, USAGE_VERIFY, USAGE_EXCHANGE,
                      USAGE_DERIVE, USAGE_KEY_PROVISION, USAGE_AUTHORIZATION, USAGE_SMR_DECRYPT,
                      ACCESS_WRITE_PROT, ACCESS_DEBUG_PROT, ACCESS_EXPORTABLE, USAGE_XTS_TWEAK,
                      USAGE_OTFAD_DECRYPT]

    smrFlags:
      type: array
      title: SMR Flags
      description: Secure Memory Region flags that must be verified before key usage
      items:
        type: integer
        minimum: 0
        maximum: 31
        minItems: 1 # At least one item
        maxItems: 32 # At most 32 items (since range is 0-31)
        uniqueItems: true # No duplicates allowed
        template_value: []
      enum_template: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31]

    specificData:
      title: Key-Specific Data
      description: Additional data specific to the key type
      oneOf:
        - type: object
          title: ECC Key Specific Data
          description: Specific data for ECC keys
          required: [eccCurveId]
          properties:
            eccCurveId:
              type: string
              title: ECC Curve ID
              description: Elliptic curve to use with ECC keys
              enum: [NONE, SEC_SECP256R1, SEC_SECP384R1, SEC_SECP521R1, BRAINPOOL_P256R1,
                     BRAINPOOL_P320R1, BRAINPOOL_P384R1, BRAINPOOL_P512R1,
                     ED25519, CURVE25519, ED448, CURVE448, USER_CURVE1, USER_CURVE2, USER_CURVE3]
              template_value: SEC_SECP256R1

        - type: object
          title: RSA Key Specific Data
          description: Specific data for RSA keys
          required: [pubExponentSize]
          properties:
            pubExponentSize:
              type: [number, string]
              title: RSA Public Exponent Size
              description: Size of RSA public exponent in bytes (must be less than 16)
              format: number
              template_value: 3

        - type: object
          title: AES Key Specific Data
          description: Specific data for AES keys
          required: [aesBlockModeMask]
          properties:
            aesBlockModeMask:
              type: array
              title: AES Block Mode Mask
              description: Allowed block modes for AES keys
              items:
                type: string
                enum: [BLOCK_MODE_XTS, BLOCK_MODE_CTR, BLOCK_MODE_CBC, BLOCK_MODE_ECB,
                       BLOCK_MODE_CFB, BLOCK_MODE_OFB, BLOCK_MODE_CCM, BLOCK_MODE_GCM]
                template_value: [BLOCK_MODE_CBC, BLOCK_MODE_CTR]

key_catalog:
  type: object
  title: HSE Key Catalog Configuration
  required: [output, nvmKeyGroups, ramKeyGroups]
  properties:
    output:
      type: string
      title: Output file name
      description: Output Key Catalog Configuration file name
      format: file_name
      template_value: key_catalog.bin

    nvmKeyGroups:
      type: array
      title: NVM Key Groups
      description: Configuration for NVM key groups
      minItems: 1
      items:
        type: object
        properties:
          muMask:
            type: string
            title: MU Mask
            description: Specifies which Message Units can access this key group
            enum: [NONE, MU0, MU1, MU2, MU3, ALL]
            default: ALL
            template_value: ALL

          groupOwner:
            type: string
            title: Group Owner
            description: Specifies the owner of the key group
            enum: [ANY, CUST, OEM]
            default: ANY
            template_value: ANY

          keyType:
            type: string
            title: Key Type
            description: Type of keys in this group
            enum: [SHE, AES, HMAC, SHARED_SECRET, SIPHASH, ECC_PAIR, ECC_PUB, ECC_PUB_EXT,
                  RSA_PAIR, RSA_PUB, RSA_PUB_EXT, DH_PAIR, DH_PUB]
            template_value: AES

          numOfKeySlots:
            type: [number, string]
            title: Number of Key Slots
            description: Number of key slots in this group
            format: number
            minimum: 1
            maximum: 254
            template_value: 10

          maxKeyBitLen:
            type: [string, number]
            title: Maximum Key Bit Length
            description: Maximum bit length for keys in this group
            format: number
            enum: [0, 64, 128, 160, 192, 224, 240, 256, 320, 384, 512, 521, 638, 1024, 2048, 3072, 4096]
            template_value: 256
        required: [keyType, numOfKeySlots, maxKeyBitLen]
      template_value:
        - muMask: ALL
          groupOwner: ANY
          keyType: SHE
          numOfKeySlots: 10
          maxKeyBitLen: 256
        - muMask: ALL
          groupOwner: CUST
          keyType: AES
          numOfKeySlots: 5
          maxKeyBitLen: 256

    ramKeyGroups:
      type: array
      title: RAM Key Groups
      description: Configuration for RAM key groups
      minItems: 1
      items:
        type: object
        properties:
          muMask:
            type: string
            title: MU Mask
            description: Specifies which Message Units can access this key group
            enum: [NONE, MU0, MU1, MU2, MU3, ALL]
            default: ALL
            template_value: ALL

          groupOwner:
            type: string
            title: Group Owner
            description: Specifies the owner of the key group
            enum: [ANY, CUST, OEM]
            default: ANY
            template_value: ANY

          keyType:
            type: string
            title: Key Type
            description: Type of keys in this group
            enum: [SHE, AES, HMAC, SHARED_SECRET, SIPHASH, ECC_PAIR, ECC_PUB, ECC_PUB_EXT,
                  RSA_PAIR, RSA_PUB, RSA_PUB_EXT, DH_PAIR, DH_PUB]
            template_value: AES

          numOfKeySlots:
            type: [number, string]
            title: Number of Key Slots
            description: Number of key slots in this group
            format: number
            minimum: 1
            maximum: 254
            template_value: 10

          maxKeyBitLen:
            type: [string, number]
            title: Maximum Key Bit Length
            description: Maximum bit length for keys in this group
            format: number
            enum: [0, 64, 128, 160, 192, 224, 240, 256, 320, 384, 512, 521, 638, 1024, 2048, 3072, 4096]
            template_value: 256
        required: [keyType, numOfKeySlots, maxKeyBitLen]
      template_value:
        - muMask: ALL
          groupOwner: ANY
          keyType: SHE
          numOfKeySlots: 5
          maxKeyBitLen: 256
        - muMask: ALL
          groupOwner: ANY
          keyType: AES
          numOfKeySlots: 5
          maxKeyBitLen: 256

smr:
  type: object
  title: HSE Secure Memory Region Entry
  description: Configuration for a Secure Memory Region (SMR) entry that defines memory regions to be verified during boot or runtime
  required: [output,smrSrcAddr, smrSize, authKeyHandle, authScheme]
  properties:
    output:
      type: string
      title: Output file name
      description: Output SME entry file name
      format: file_name
      template_value: emr_entry.bin
    smrSrcAddr:
      type: [number, string]
      title: SMR Source Address
      description: Source address where the SMR needs to be loaded from. This address must be an absolute address.
      format: number
      template_value: "0x0040_0000"

    smrSize:
      type: [number, string]
      title: SMR Size
      description: The size in bytes of the SMR to be loaded/verified
      format: number
      minimum: 1
      template_value: "0x0001_0000"

    smrDest:
      type: [number, string]
      title: SMR Destination Address
      description: |
        Destination address of SMR (where to copy the SMR after authentication).
        For HSE_B, if specified (non-zero), smrDest and (smrDest + smrSize) must be aligned to 16 bytes.
        Set to 0 if no copy is needed.
      format: number
      template_value: "0x0"

    configFlags:
      type: string
      title: Configuration Flags
      description: Configuration flags of SMR entry
      enum: [QSPI_FLASH, SD_FLASH, MMC_FLASH, INSTALL_AUTH, AUTH_AAD]
      template_value: QSPI_FLASH

    checkPeriod:
      type: [number, string]
      title: Check Period
      description: |
        If non-zero, HSE verifies the SMR entry periodically (in background).
        Specifies the verification period in x100 milliseconds when HSE is running at maximum frequency.
        The value 0xFFFFFFFF is invalid; the checkPeriod max value must be [MAX_UNSIGNED32_INT - 1].
        If checkPeriod is non-zero, smrDest must be non-zero and configFlags must be zero.
        Set to 0 to disable periodic verification.
      format: number
      minimum: 0
      maximum: 0xFFFFFFFE
      template_value: "0x0"

    authKeyHandle:
      type: object
      title: Authentication Key Handle
      description: |
        The key handle used to check the authenticity of the plaintext SMR.
        If INSTALL_AUTH flag is cleared, the authKeyHandle is used only in the Installation Phase.
        The key flags must be configured with USAGE_VERIFY set and USAGE_SIGN NOT set.
      required: [catalogId, groupIdx, slotIdx]
      properties:
        catalogId:
          type: string
          title: Key Catalog ID
          description: Key catalog type (ROM, NVM, or RAM)
          enum: [ROM, NVM, RAM]
          template_value: NVM

        groupIdx:
          type: [number, string]
          title: Group Index
          description: Group index in catalog
          format: number
          minimum: 0
          maximum: 254
          template_value: 0

        slotIdx:
          type: [number, string]
          title: Slot Index
          description: Key slot index within the group
          format: number
          minimum: 0
          maximum: 254
          template_value: 0

    authScheme:
      title: Authentication Scheme
      description: |
        The authentication scheme used to verify the SMR either during the Installation Phase or Verification phase.
        If INSTALL_AUTH flag is set, the same authentication scheme (installation TAG) can be used
        to verify the authenticity of SMR during verification phase too; otherwise an internal authentication scheme is used.
      oneOf:
        - type: object
          title: ECDSA Signature Scheme
          description: ECDSA signature scheme for SMR authentication
          required: [ecdsa]
          properties:
            ecdsa:
              type: object
              title: ECDSA Parameters
              required: [hashAlgo]
              properties:
                hashAlgo:
                  type: string
                  title: Hash Algorithm
                  description: Hash algorithm for ECDSA signature
                  enum: [SHA_1, SHA224, SHA256, SHA384, SHA512, SHA512_224, SHA512_256,
                         SHA3_224, SHA3_256, SHA3_384, SHA3_512, MP]
                  template_value: SHA256

        - type: object
          title: EdDSA Signature Scheme
          description: EdDSA signature scheme for SMR authentication
          required: [eddsa]
          properties:
            eddsa:
              type: object
              title: EdDSA Parameters
              properties:
                preHashEddsa:
                  type: boolean
                  title: Pre-hash EdDSA
                  description: Use pre-hashing for EdDSA scheme
                  template_value: false

                contextLength:
                  type: [number, string]
                  title: Context Length
                  description: Length of context for EdDSA (0-255 bytes, maximum 16 bytes for SMR)
                  format: number
                  minimum: 0
                  maximum: 16
                  template_value: 0

                contextAddr:
                  type: [number, string]
                  title: Context Address
                  description: Address of context data for EdDSA (required if contextLength > 0)
                  format: number
                  template_value: 0

        - type: object
          title: RSASSA-PSS Signature Scheme
          description: RSASSA-PSS signature scheme for SMR authentication
          required: [rsassa_pss]
          properties:
            rsassa_pss:
              type: object
              title: RSASSA-PSS Parameters
              required: [hashAlgo]
              properties:
                hashAlgo:
                  type: string
                  title: Hash Algorithm
                  description: Hash algorithm for RSASSA-PSS signature
                  enum: [SHA_1, SHA224, SHA256, SHA384, SHA512, SHA512_224, SHA512_256,
                         SHA3_224, SHA3_256, SHA3_384, SHA3_512, MP]
                  template_value: SHA256

                saltLength:
                  type: [number, string]
                  title: Salt Length
                  description: Salt length for RSASSA-PSS scheme
                  format: number
                  minimum: 0
                  template_value: 32

        - type: object
          title: RSASSA-PKCS1-v1.5 Signature Scheme
          description: RSASSA-PKCS1-v1.5 signature scheme for SMR authentication
          required: [rsassa_pkcs1_v15]
          properties:
            rsassa_pkcs1_v15:
              type: object
              title: RSASSA-PKCS1-v1.5 Parameters
              required: [hashAlgo]
              properties:
                hashAlgo:
                  type: string
                  title: Hash Algorithm
                  description: Hash algorithm for RSASSA-PKCS1-v1.5 signature
                  enum: [SHA_1, SHA224, SHA256, SHA384, SHA512, SHA512_224, SHA512_256,
                         SHA3_224, SHA3_256, SHA3_384, SHA3_512, MP]
                  template_value: SHA256

        - type: object
          title: CMAC Scheme
          description: CMAC (AES-based) authentication scheme for SMR
          required: [cmac]
          properties:
            cmac:
              type: object
              title: CMAC Parameters
              properties:
                cipherAlgo:
                  type: string
                  title: Cipher Algorithm
                  description: Cipher algorithm for CMAC scheme (only AES is supported)
                  enum: [AES]
                  template_value: AES
                  default: AES

        - type: object
          title: GMAC Scheme
          description: GMAC (AES-GCM based) authentication scheme for SMR
          required: [gmac]
          properties:
            gmac:
              type: object
              title: GMAC Parameters
              required: [ivLength, ivAddr]
              properties:
                ivLength:
                  type: [number, string]
                  title: IV Length
                  description: Length of initialization vector for GMAC scheme
                  format: number
                  minimum: 1
                  template_value: 12

                ivAddr:
                  type: [number, string]
                  title: IV Address
                  description: Address of initialization vector for GMAC scheme
                  format: number
                  template_value: "0x0050_0000"

        - type: object
          title: XCBC-MAC Scheme
          description: XCBC-MAC (AES128-based) authentication scheme for SMR
          required: [xcbc_mac]
          properties:
            xcbc_mac:
              type: object
              title: XCBC-MAC Parameters
              properties: {}

        - type: object
          title: HMAC Scheme
          description: HMAC authentication scheme for SMR
          required: [hmac]
          properties:
            hmac:
              type: object
              title: HMAC Parameters
              required: [hashAlgo]
              properties:
                hashAlgo:
                  type: string
                  title: Hash Algorithm
                  description: Hash algorithm for HMAC
                  enum: [SHA_1, SHA224, SHA256, SHA384, SHA512, SHA512_224, SHA512_256,
                         SHA3_224, SHA3_256, SHA3_384, SHA3_512, MP]
                  template_value: SHA256

    instAuthTagAddrs:
      type: array
      title: Installation Authentication Tag Addresses
      description: |
        Optional - The location in external flash of the initial proof of authenticity over SMR.
        If INSTALL_AUTH flag is set, specifies the address(es) where the SMR original authentication TAG is located.
        For MAC and RSA signature, only first address is used.
        Both addresses are used for ECDSA and EDDSA signatures (r at index 0, s at index 1).
      minItems: 2
      maxItems: 2
      items:
        type: [number, string]
        format: number
        template_value: [0, 0]

    smrDecrypt:
      type: object
      title: SMR Decryption Parameters
      description: Specifies the parameters for SMR decryption (optional)
      if:
        properties:
          aadLength:
            not:
              const: 0
      then:
        required: [decryptKeyHandle, aadAddr]
      else:
        required: [decryptKeyHandle]
      properties:
        decryptKeyHandle:
          type: object
          title: Decryption Key Handle
          description: The key handle referencing the decryption key
          required: [catalogId, groupIdx, slotIdx]
          properties:
            catalogId:
              type: string
              title: Key catalog type (ROM, NVM, or RAM)
              enum: [ROM, NVM, RAM]
              template_value: NVM

            groupIdx:
              type: [number, string]
              title: Group Index
              format: number
              minimum: 0
              maximum: 254
              template_value: 0

            slotIdx:
              type: [number, string]
              title: Key slot index within the group
              format: number
              minimum: 0
              maximum: 254
              template_value: 0

        gmacTagAddr:
          type: [number, string]
          title: GMAC Tag Address
          description: Address of the Tag used for GCM. If set to 0, AES-CTR is used for decryption.
          format: number
          template_value: 0

        aadLength:
          type: [number, string]
          title: AAD Length
          description: The length in bytes of the Authenticated Additional Data (AAD). Must be 0, 64, or 128 bytes.
          format: number
          enum: [0, 64, 128]
          template_value: 0

        aadAddr:
          type: [number, string]
          title: AAD Address
          description: The address of AAD used for AEAD (required if aadLength > 0)
          format: number
          template_value: 0

    versionOffset:
      type: [number, string]
      title: Version Offset
      description: |
        Optional - The offset in SMR where the image version can be found.
        Provides anti-rollback protection for the image against attacks during update.
        Set to 0 to disable version checking.
        If used, must be a valid offset within the SMR in range [4, smrSize - 4].
        Must be aligned to 4 bytes.
        Once used, all subsequent updates must have a version GREATER than the previous one.
        Not used for SHE based secure boot.
      format: number
      minimum: 0
      template_value: 0
