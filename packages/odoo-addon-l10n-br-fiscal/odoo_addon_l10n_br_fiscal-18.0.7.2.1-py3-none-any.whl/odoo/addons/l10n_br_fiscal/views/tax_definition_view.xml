<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="tax_definition_tree" model="ir.ui.view">
        <field name="name">l10n_br_fiscal.tax.definition.tree</field>
        <field name="model">l10n_br_fiscal.tax.definition</field>
        <field name="arch" type="xml">
            <list>
                <field name="state" column_invisible="True" />
                <field name="tax_group_id" readonly="state != 'draft'" />
                <field name="is_taxed" readonly="state != 'draft'" />
                <field name="tax_id" readonly="state != 'draft'" />
                <field name="cst_code" />
            </list>
        </field>
    </record>

    <record id="tax_definition_icms_tree" model="ir.ui.view">
        <field name="name">l10n_br_fiscal.tax.definition.icms.tree</field>
        <field name="model">l10n_br_fiscal.tax.definition</field>
        <field name="arch" type="xml">
            <list
                decoration-info="state in ('draft', 'review')"
                decoration-muted="state == 'expired'"
            >
                <field name="state" column_invisible="True" />
                <field
                    name="tax_group_id"
                    column_invisible="True"
                    readonly="state != 'draft'"
                />
                <field name="state_from_id" />
                <field name="state_to_ids" />
                <field name="tax_id" readonly="state != 'draft'" />
                <field name="cst_code" />
            </list>
        </field>
    </record>

    <record id="tax_definition_form" model="ir.ui.view">
        <field name="name">l10n_br_fiscal.tax.definition.form</field>
        <field name="model">l10n_br_fiscal.tax.definition</field>
        <field name="arch" type="xml">
            <form string="Tax Definition">
                <field name="company_id" invisible="1" readonly="state != 'draft'" />
                <field name="icms_regulation_id" invisible="1" />
                <field name="tax_domain" invisible="1" readonly="state != 'draft'" />
                <header>
                    <button
                        name="action_review"
                        type="object"
                        invisible="state != 'draft'"
                        string="Review"
                        class="oe_highlight"
                        groups="l10n_br_fiscal.group_manager"
                    />
                    <button
                        name="action_approve"
                        type="object"
                        invisible="state not in ('review', 'expired')"
                        string="Approve"
                        class="oe_highlight"
                        groups="l10n_br_fiscal.group_manager"
                    />
                    <button
                        name="action_draft"
                        type="object"
                        invisible="state not in ('review', 'approved')"
                        string="Reset To Draft"
                        class="oe_highlight"
                        groups="l10n_br_fiscal.group_manager"
                    />
                    <field name="state" widget="statusbar" />
                </header>
                <sheet>
                    <group>
                        <field
                            name="tax_group_id"
                            force_save="1"
                            readonly="icms_regulation_id != False or state != 'draft'"
                            options="{'no_create': True, 'no_create_edit': True}"
                        />
                        <field name="type_in_out" invisible="1" />
                        <field name="is_taxed" readonly="state != 'draft'" />
                        <field
                            name="is_debit_credit"
                            invisible="is_taxed == False"
                            readonly="state != 'draft'"
                        />
                        <field name="custom_tax" readonly="state != 'draft'" />
                        <field
                            name="tax_id"
                            invisible="not custom_tax"
                            readonly="state != 'draft'"
                            required="custom_tax"
                        />
                        <field
                            name="cst_id"
                            force_save="1"
                            invisible="not custom_tax or tax_domain not in ('icmssn', 'icms', 'ipi', 'pis', 'pisst', 'cofins', 'cofinsst')"
                            required="custom_tax and tax_domain in ('icms', 'ipi', 'pis', 'pisst', 'cofins', 'cofinsst')"
                            options="{'no_create': True, 'no_create_edit': True}"
                            readonly="state != 'draft'"
                        />
                        <field
                            name="ipi_guideline_id"
                            invisible="tax_domain != 'ipi'"
                            options="{'no_create': True, 'no_create_edit': True}"
                            readonly="state != 'draft'"
                        />
                        <field
                            name="is_benefit"
                            invisible="tax_domain != 'icms'"
                            readonly="state != 'draft'"
                        />
                    </group>
                    <group
                        name="tax_benefit"
                        string="Tax Benefit"
                        invisible="is_benefit == False"
                    >
                        <field
                            name="code"
                            required="is_benefit != False"
                            readonly="state != 'draft'"
                        />
                        <field
                            name="description"
                            required="is_benefit != False"
                            readonly="state != 'draft'"
                        />
                        <field
                            name="benefit_type"
                            required="is_benefit != False"
                            readonly="state != 'draft'"
                        />
                    </group>
                    <group name="state" string="State">
                        <field
                            name="state_from_id"
                            options="{'no_create': True, 'no_create_edit': True}"
                            required="is_benefit"
                            readonly="state != 'draft'"
                        />
                        <field
                            name="state_to_ids"
                            options="{'no_create': True}"
                            readonly="state != 'draft'"
                        />
                    </group>
                    <notebook>
                        <page name="ncms_page" string="NCM">
                            <group name="ncms" string="NCMs">
                                <label for="ncms" />
                                <div class="o_row">
                                    <field
                                        name="ncms"
                                        force_save="1"
                                        class="oe_inline"
                                        readonly="state != 'draft'"
                                    />
                                    <button
                                        name="action_search_ncms"
                                        type="object"
                                        class="oe_inline btn-sm btn-link mb4 fa fa-search oe_edit_only"
                                        aria-label="Search NCMs"
                                        title="Search NCMs"
                                    />
                                </div>
                                <field
                                    name="ncm_ids"
                                    options="{'no_create': True}"
                                    force_save="1"
                                    nolabel="1"
                                    colspan="2"
                                    readonly="state != 'draft'"
                                />
                                <field
                                    name="ncm_exception"
                                    readonly="state != 'draft'"
                                />
                                <field name="not_in_ncms" readonly="state != 'draft'" />
                            </group>
                        </page>
                        <page name="nbm_page" string="NBM">
                            <group name="nbms" string="NBMs">
                                <label for="nbms" />
                                <div class="o_row">
                                    <field
                                        name="nbms"
                                        force_save="1"
                                        class="oe_inline"
                                        readonly="state != 'draft'"
                                    />
                                    <button
                                        name="action_search_nbms"
                                        type="object"
                                        class="oe_inline btn-sm btn-link mb4 fa fa-search oe_edit_only"
                                        aria-label="Search NBMs"
                                        title="Search NBMs"
                                    />
                                </div>
                                <field
                                    name="nbm_ids"
                                    options="{'no_create': True}"
                                    force_save="1"
                                    nolabel="1"
                                    colspan="2"
                                    readonly="state != 'draft'"
                                />
                                <field name="not_in_nbms" readonly="state != 'draft'" />
                            </group>
                        </page>
                        <page name="cests_page" string="CEST">
                            <group name="cests" string="CESTs">
                                <label for="cests" />
                                <div class="o_row">
                                    <field
                                        name="cests"
                                        force_save="1"
                                        class="oe_inline"
                                        readonly="state != 'draft'"
                                    />
                                    <button
                                        name="action_search_cests"
                                        type="object"
                                        class="oe_inline btn-sm btn-link mb4 fa fa-search oe_edit_only"
                                        aria-label="Search CESTs"
                                        title="Search CESTs"
                                    />
                                </div>
                                <field
                                    name="cest_ids"
                                    force_save="1"
                                    nolabel="1"
                                    colspan="2"
                                    options="{'no_create': True}"
                                    readonly="state != 'draft'"
                                />
                            </group>
                        </page>
                        <page
                            name="city_taxation_codes_page"
                            string="City Taxation Code"
                        >
                            <group
                                name="city_taxation_codes"
                                string="City Taxation Codes"
                            >
                                <field
                                    name="city_taxation_code_ids"
                                    force_save="1"
                                    nolabel="1"
                                    colspan="2"
                                    readonly="state != 'draft'"
                                />
                            </group>
                        </page>
                        <page name="service_types_page" string="Fiscal Service Type">
                            <group name="service_types" string="Fiscal Service Types">
                                <field
                                    name="service_type_ids"
                                    force_save="1"
                                    nolabel="1"
                                    colspan="2"
                                    readonly="state != 'draft'"
                                />
                            </group>
                        </page>
                        <page name="products_page" string="Product">
                            <group name="products" string="Products">
                                <field
                                    name="product_ids"
                                    force_save="1"
                                    nolabel="1"
                                    colspan="2"
                                    readonly="state != 'draft'"
                                />
                            </group>
                        </page>
                        <page name="fiscal_profile_page" string="Fiscal Profile">
                            <group name="fiscal_profile" string="Fiscal Profile">
                                <field name="ind_final" />
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <chatter />
            </form>
        </field>
    </record>
</odoo>
