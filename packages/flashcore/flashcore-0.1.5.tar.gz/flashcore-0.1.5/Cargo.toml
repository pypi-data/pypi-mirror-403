[workspace]
resolver = "2"
members = ["crates/flashcore_pyo3"]

[workspace.package]
version = "0.53.0"
edition = "2024"
rust-version = "1.92.0"
authors = ["Nautech Systems <info@nautechsystems.io>"]
license = "LGPL-3.0-or-later"
readme = "README.md"
description = "A high-performance algorithmic trading platform and event-driven backtester"
categories = ["finance", "simulation", "asynchronous"]
keywords = [
  "finance",
  "trading",
  "trading-platform",
  "algorithmic-trading",
  "quantitative-finance",
]
documentation = "https://nautilustrader.io/docs"
repository = "https://github.com/nautechsystems/nautilus_trader"
homepage = "https://nautilustrader.io"

[workspace.dependencies]
nautilus-common = { path = "crates/common", version = "0.53.0", default-features = false }
nautilus-core = { path = "crates/core", version = "0.53.0" }
nautilus-cryptography = { path = "crates/cryptography", version = "0.53.0" }
nautilus-model = { path = "crates/model", version = "0.53.0" }

ahash = { version = "0.8.12", features = ["serde"] }
anyhow = "1.0.100"
aws-lc-rs = { version = "1.15.4", default-features = false, features = ["non-fips"] }
base64 = "0.22.1"
chrono = { version = "0.4.43", default-features = false, features = ["serde", "std", "clock"] }
ed25519-dalek = "2.2.0"
futures = { version = "0.3.31", default-features = false, features = ["std", "async-await"] }
hex = "0.4.3"
indexmap = { version = "2.13.0", features = ["serde"] }
log = { version = "0.4.29", features = ["std", "kv_unstable", "serde", "release_max_level_debug"] }
pem = "3.0.6"
pyo3 = { version = "0.27.2", default-features = false, features = ["chrono", "hashbrown", "indexmap", "macros", "rust_decimal", "serde"] }
rand = { version = "0.9.2", default-features = false, features = ["std", "thread_rng"] }
rust_decimal = { version = "1.40.0", features = ["serde-with-float"] }
serde = { version = "1.0.228", default-features = false, features = ["derive", "std", "rc"] }
tokio = { version = "1.49.0", default-features = false, features = ["rt-multi-thread", "sync", "fs", "io-util", "net", "time", "macros", "signal"] }
ustr = { version = "1.1.0", features = ["serde"] }
uuid = { version = "1.19.0", features = ["v4", "serde"] }

# -----------------------------------------------------------------------------
# Tools (for cargo install, used by Makefile and CI)
# -----------------------------------------------------------------------------
[workspace.metadata.tools]
cargo-audit = "0.22.0"
cargo-deny = "0.19.0"
cargo-edit = "0.13.8"
cargo-llvm-cov = "0.6.24"
cargo-machete = "0.9.1"
cargo-nextest = "0.9.123"
cargo-vet = "0.10.2"
lychee = "0.22.0"

# cargo-vet supply chain security configuration
[workspace.metadata.vet]
store = { path = '.supply-chain' }

# -----------------------------------------------------------------------------
# Profiles
# -----------------------------------------------------------------------------
[profile.dev]
opt-level = 0
debug = false # Improves compile times
debug-assertions = false # Fails Cython build if true
overflow-checks = true
strip = "debuginfo" # Improves compile times
lto = false
panic = "unwind"
incremental = true
codegen-units = 256

[profile.debug-pyo3]
inherits = "dev"
debug = true # Enable debug symbols for debugging
strip = false # Keep debug symbols for debugging

[profile.test]
opt-level = 0
debug = true
debug-assertions = true
overflow-checks = true
strip = false
lto = false
incremental = true
codegen-units = 256

[profile.nextest]
inherits = "test"
debug = false # Improves compile times
strip = "debuginfo" # Improves compile times

[profile.release]
opt-level = 3
debug = false
debug-assertions = false
overflow-checks = false
lto = "fat"
strip = "symbols"
panic = "abort"
incremental = false
codegen-units = 1

[profile.release-debugging]
inherits = "release"
incremental = true
debug = "full"
strip = false
lto = false

# -----------------------------------------------------------------------------
# Benchmarks
# -----------------------------------------------------------------------------
# Criterion/iai benchmarks should retain debug symbols so that tools like
# `cargo flamegraph` or `perf` produce human-readable stack traces.  We inherit
# from the `release-debugging` profile defined above which keeps optimisation
# level 3 but preserves symbols and disables LTO for faster compile times.
# -----------------------------------------------------------------------------

[profile.bench]
inherits = "release"
debug = "full"
strip = false
lto = false
incremental = true
# Cargo ignores `panic` for bench profile (harness requires unwind to catch failures)

# -----------------------------------------------------------------------------
# Workspace lints
# -----------------------------------------------------------------------------
# Centralized lint configuration for all workspace crates.
# Individual crates inherit these with: [lints] workspace = true
#
# These lints are auto-fixable and enforced in pre-commit hooks.
# Run `make clippy-fix` to auto-fix most issues.
#
# Additional non-auto-fixable lints (todo, unwrap_used, expect_used) are
# available via the `make clippy-fix-nightly` target.
# -----------------------------------------------------------------------------

[workspace.lints.clippy]
# Debug markers
dbg_macro = "warn"

# Performance optimizations
redundant_clone = "warn"
unnecessary_to_owned = "warn"
inefficient_to_string = "warn"
needless_borrow = "warn"
cloned_instead_of_copied = "warn"

# Code simplification
redundant_closure = "warn"
# redundant_closure_for_method_calls = "warn" # Causes clippy ICE (rust-lang/rust-clippy#14756)
needless_return = "warn"
needless_bool = "warn"
needless_collect = "warn"
collapsible_if = "warn"
collapsible_else_if = "warn"
useless_conversion = "warn"
from_iter_instead_of_collect = "warn"
map_identity = "warn"
if_same_then_else = "warn"
get_first = "warn"
single_char_pattern = "warn"
identity_op = "warn"

# Iterator simplifications
manual_flatten = "warn"
iter_kv_map = "warn"
bytes_count_to_len = "warn"
unnecessary_filter_map = "warn"

# Option/Result simplifications
unnecessary_lazy_evaluations = "warn"
option_as_ref_deref = "warn"

# Manual pattern simplifications
manual_filter = "warn"
manual_find = "warn"
manual_while_let_some = "warn"
range_plus_one = "warn"
checked_conversions = "warn"
manual_strip = "warn"
manual_split_once = "warn"
manual_is_ascii_check = "warn"
manual_range_contains = "warn"
manual_string_new = "warn"
manual_instant_elapsed = "warn"

# Style/idioms
use_self = "warn"
redundant_field_names = "warn"
match_like_matches_macro = "warn"
manual_map = "warn"
bool_to_int_with_if = "warn"
explicit_iter_loop = "warn"
uninlined_format_args = "warn"

# Pedantic (explicitness and clarity)
semicolon_if_nothing_returned = "warn"
unnested_or_patterns = "warn"
filter_map_next = "warn"
flat_map_option = "warn"
map_unwrap_or = "warn"
implicit_clone = "warn"
return_self_not_must_use = "warn"
explicit_into_iter_loop = "warn"
stable_sort_primitive = "warn"
needless_for_each = "warn"
manual_is_variant_and = "warn"
equatable_if_let = "warn"
manual_assert = "warn"
items_after_statements = "warn"
ignored_unit_patterns = "warn"
if_not_else = "warn"

# Security and robustness
suspicious_doc_comments = "warn"
large_stack_arrays = "warn"
panic_in_result_fn = "warn"

# Explicitly allowed (opinionated lints we disagree with)
redundant_else = "allow" # Sometimes explicit else blocks improve readability
single_match_else = "allow" # Match can be clearer than if-let-else for some patterns
manual_let_else = "allow" # Match can be clearer than let-else for some patterns
or_fun_call = "allow" # Used consistently for display with map_or("None".to_string(), ...)
option_if_let_else = "allow" # if-let can be clearer than map_or/map_or_else

# TODO: Enable these incrementally (widespread usage in codebase)
# unwrap_used = "warn"        # Forces explicit error handling instead of panics
# expect_used = "warn"        # Forces explicit error handling instead of panics
# indexing_slicing = "warn"   # Prevents panics from out-of-bounds access
