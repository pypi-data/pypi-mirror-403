import{_ as w,D as Q,E as ee,H as ce,e as de,l as Z,aK as pe,aL as E,d as j,b as ue,a as he,p as fe,q as ge,g as me,s as ye,F as Se,aM as xe,y as ve}from"./BZ4Jxo1x.js";import{s as be}from"./CrL0xptr.js";import{p as we}from"./DU_AnIcK.js";import{p as Ce}from"./Cz2IPFl8.js";import{f as O}from"./D2nGpDRe.js";import{o as U}from"./CmKTTxBW.js";function Te(o){if(typeof o!="function")throw new Error;return o}function q(){return 0}function G(o){return function(){return o}}function Le(o){o.x0=Math.round(o.x0),o.y0=Math.round(o.y0),o.x1=Math.round(o.x1),o.y1=Math.round(o.y1)}function $e(o,l,i,s,d){for(var r=o.children,c,h=-1,v=r.length,n=o.value&&(s-l)/o.value;++h<v;)c=r[h],c.y0=i,c.y1=d,c.x0=l,c.x1=l+=c.value*n}function Fe(o,l,i,s,d){for(var r=o.children,c,h=-1,v=r.length,n=o.value&&(d-i)/o.value;++h<v;)c=r[h],c.x0=l,c.x1=s,c.y0=i,c.y1=i+=c.value*n}var Me=(1+Math.sqrt(5))/2;function Ne(o,l,i,s,d,r){for(var c=[],h=l.children,v,n,p=0,b=0,t=h.length,x,y,S=l.value,u,g,k,N,D,B,z;p<t;){x=d-i,y=r-s;do u=h[b++].value;while(!u&&b<t);for(g=k=u,B=Math.max(y/x,x/y)/(S*o),z=u*u*B,D=Math.max(k/z,z/g);b<t;++b){if(u+=n=h[b].value,n<g&&(g=n),n>k&&(k=n),z=u*u*B,N=Math.max(k/z,z/g),N>D){u-=n;break}D=N}c.push(v={value:u,dice:x<y,children:h.slice(p,b)}),v.dice?$e(v,i,s,d,S?s+=y*u/S:r):Fe(v,i,s,S?i+=x*u/S:d,r),S-=u,p=b}return c}const ke=(function o(l){function i(s,d,r,c,h){Ne(l,s,d,r,c,h)}return i.ratio=function(s){return o((s=+s)>1?s:1)},i})(Me);function ze(){var o=ke,l=!1,i=1,s=1,d=[0],r=q,c=q,h=q,v=q,n=q;function p(t){return t.x0=t.y0=0,t.x1=i,t.y1=s,t.eachBefore(b),d=[0],l&&t.eachBefore(Le),t}function b(t){var x=d[t.depth],y=t.x0+x,S=t.y0+x,u=t.x1-x,g=t.y1-x;u<y&&(y=u=(y+u)/2),g<S&&(S=g=(S+g)/2),t.x0=y,t.y0=S,t.x1=u,t.y1=g,t.children&&(x=d[t.depth+1]=r(t)/2,y+=n(t)-x,S+=c(t)-x,u-=h(t)-x,g-=v(t)-x,u<y&&(y=u=(y+u)/2),g<S&&(S=g=(S+g)/2),o(t,y,S,u,g))}return p.round=function(t){return arguments.length?(l=!!t,p):l},p.size=function(t){return arguments.length?(i=+t[0],s=+t[1],p):[i,s]},p.tile=function(t){return arguments.length?(o=Te(t),p):o},p.padding=function(t){return arguments.length?p.paddingInner(t).paddingOuter(t):p.paddingInner()},p.paddingInner=function(t){return arguments.length?(r=typeof t=="function"?t:G(+t),p):r},p.paddingOuter=function(t){return arguments.length?p.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):p.paddingTop()},p.paddingTop=function(t){return arguments.length?(c=typeof t=="function"?t:G(+t),p):c},p.paddingRight=function(t){return arguments.length?(h=typeof t=="function"?t:G(+t),p):h},p.paddingBottom=function(t){return arguments.length?(v=typeof t=="function"?t:G(+t),p):v},p.paddingLeft=function(t){return arguments.length?(n=typeof t=="function"?t:G(+t),p):n},p}var W,te=(W=class{constructor(){this.nodes=[],this.levels=new Map,this.outerNodes=[],this.classes=new Map,this.setAccTitle=ue,this.getAccTitle=he,this.setDiagramTitle=fe,this.getDiagramTitle=ge,this.getAccDescription=me,this.setAccDescription=ye}getNodes(){return this.nodes}getConfig(){const l=Se,i=ee();return Q({...l.treemap,...i.treemap??{}})}addNode(l,i){this.nodes.push(l),this.levels.set(l,i),i===0&&(this.outerNodes.push(l),this.root??(this.root=l))}getRoot(){return{name:"",children:this.outerNodes}}addClass(l,i){const s=this.classes.get(l)??{id:l,styles:[],textStyles:[]},d=i.replace(/\\,/g,"§§§").replace(/,/g,";").replace(/§§§/g,",").split(";");d&&d.forEach(r=>{xe(r)&&(s!=null&&s.textStyles?s.textStyles.push(r):s.textStyles=[r]),s!=null&&s.styles?s.styles.push(r):s.styles=[r]}),this.classes.set(l,s)}getClasses(){return this.classes}getStylesForClass(l){var i;return((i=this.classes.get(l))==null?void 0:i.styles)??[]}clear(){ve(),this.nodes=[],this.levels=new Map,this.outerNodes=[],this.classes=new Map,this.root=void 0}},w(W,"TreeMapDB"),W);function ae(o){if(!o.length)return[];const l=[],i=[];return o.forEach(s=>{const d={name:s.name,children:s.type==="Leaf"?void 0:[]};for(d.classSelector=s==null?void 0:s.classSelector,s!=null&&s.cssCompiledStyles&&(d.cssCompiledStyles=[s.cssCompiledStyles]),s.type==="Leaf"&&s.value!==void 0&&(d.value=s.value);i.length>0&&i[i.length-1].level>=s.level;)i.pop();if(i.length===0)l.push(d);else{const r=i[i.length-1].node;r.children?r.children.push(d):r.children=[d]}s.type!=="Leaf"&&i.push({node:d,level:s.level})}),l}w(ae,"buildHierarchy");var Ae=w((o,l)=>{we(o,l);const i=[];for(const r of o.TreemapRows??[])r.$type==="ClassDefStatement"&&l.addClass(r.className??"",r.styleText??"");for(const r of o.TreemapRows??[]){const c=r.item;if(!c)continue;const h=r.indent?parseInt(r.indent):0,v=Ve(c),n=c.classSelector?l.getStylesForClass(c.classSelector):[],p=n.length>0?n.join(";"):void 0,b={level:h,name:v,type:c.$type,value:c.value,classSelector:c.classSelector,cssCompiledStyles:p};i.push(b)}const s=ae(i),d=w((r,c)=>{for(const h of r)l.addNode(h,c),h.children&&h.children.length>0&&d(h.children,c+1)},"addNodesRecursively");d(s,0)},"populate"),Ve=w(o=>o.name?String(o.name):"","getItemName"),le={parser:{yy:void 0},parse:w(async o=>{var l;try{const s=await Ce("treemap",o);Z.debug("Treemap AST:",s);const d=(l=le.parser)==null?void 0:l.yy;if(!(d instanceof te))throw new Error("parser.parser?.yy was not a TreemapDB. This is due to a bug within Mermaid, please report this issue at https://github.com/mermaid-js/mermaid/issues.");Ae(s,d)}catch(i){throw Z.error("Error parsing treemap:",i),i}},"parse")},De=10,R=10,X=25,Pe=w((o,l,i,s)=>{const d=s.db,r=d.getConfig(),c=r.padding??De,h=d.getDiagramTitle(),v=d.getRoot(),{themeVariables:n}=ee();if(!v)return;const p=h?30:0,b=ce(l),t=r.nodeWidth?r.nodeWidth*R:960,x=r.nodeHeight?r.nodeHeight*R:500,y=t,S=x+p;b.attr("viewBox",`0 0 ${y} ${S}`),de(b,S,y,r.useMaxWidth);let u;try{const e=r.valueFormat||",";if(e==="$0,0")u=w(a=>"$"+O(",")(a),"valueFormat");else if(e.startsWith("$")&&e.includes(",")){const a=/\.\d+/.exec(e),f=a?a[0]:"";u=w(C=>"$"+O(","+f)(C),"valueFormat")}else if(e.startsWith("$")){const a=e.substring(1);u=w(f=>"$"+O(a||"")(f),"valueFormat")}else u=O(e)}catch(e){Z.error("Error creating format function:",e),u=O(",")}const g=U().range(["transparent",n.cScale0,n.cScale1,n.cScale2,n.cScale3,n.cScale4,n.cScale5,n.cScale6,n.cScale7,n.cScale8,n.cScale9,n.cScale10,n.cScale11]),k=U().range(["transparent",n.cScalePeer0,n.cScalePeer1,n.cScalePeer2,n.cScalePeer3,n.cScalePeer4,n.cScalePeer5,n.cScalePeer6,n.cScalePeer7,n.cScalePeer8,n.cScalePeer9,n.cScalePeer10,n.cScalePeer11]),N=U().range([n.cScaleLabel0,n.cScaleLabel1,n.cScaleLabel2,n.cScaleLabel3,n.cScaleLabel4,n.cScaleLabel5,n.cScaleLabel6,n.cScaleLabel7,n.cScaleLabel8,n.cScaleLabel9,n.cScaleLabel10,n.cScaleLabel11]);h&&b.append("text").attr("x",y/2).attr("y",p/2).attr("class","treemapTitle").attr("text-anchor","middle").attr("dominant-baseline","middle").text(h);const D=b.append("g").attr("transform",`translate(0, ${p})`).attr("class","treemapContainer"),B=pe(v).sum(e=>e.value??0).sort((e,a)=>(a.value??0)-(e.value??0)),J=ze().size([t,x]).paddingTop(e=>e.children&&e.children.length>0?X+R:0).paddingInner(c).paddingLeft(e=>e.children&&e.children.length>0?R:0).paddingRight(e=>e.children&&e.children.length>0?R:0).paddingBottom(e=>e.children&&e.children.length>0?R:0).round(!0)(B),ne=J.descendants().filter(e=>e.children&&e.children.length>0),_=D.selectAll(".treemapSection").data(ne).enter().append("g").attr("class","treemapSection").attr("transform",e=>`translate(${e.x0},${e.y0})`);_.append("rect").attr("width",e=>e.x1-e.x0).attr("height",X).attr("class","treemapSectionHeader").attr("fill","none").attr("fill-opacity",.6).attr("stroke-width",.6).attr("style",e=>e.depth===0?"display: none;":""),_.append("clipPath").attr("id",(e,a)=>`clip-section-${l}-${a}`).append("rect").attr("width",e=>Math.max(0,e.x1-e.x0-12)).attr("height",X),_.append("rect").attr("width",e=>e.x1-e.x0).attr("height",e=>e.y1-e.y0).attr("class",(e,a)=>`treemapSection section${a}`).attr("fill",e=>g(e.data.name)).attr("fill-opacity",.6).attr("stroke",e=>k(e.data.name)).attr("stroke-width",2).attr("stroke-opacity",.4).attr("style",e=>{if(e.depth===0)return"display: none;";const a=E({cssCompiledStyles:e.data.cssCompiledStyles});return a.nodeStyles+";"+a.borderStyles.join(";")}),_.append("text").attr("class","treemapSectionLabel").attr("x",6).attr("y",X/2).attr("dominant-baseline","middle").text(e=>e.depth===0?"":e.data.name).attr("font-weight","bold").attr("style",e=>{if(e.depth===0)return"display: none;";const a="dominant-baseline: middle; font-size: 12px; fill:"+N(e.data.name)+"; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",f=E({cssCompiledStyles:e.data.cssCompiledStyles});return a+f.labelStyles.replace("color:","fill:")}).each(function(e){if(e.depth===0)return;const a=j(this),f=e.data.name;a.text(f);const C=e.x1-e.x0,L=6;let $;r.showValues!==!1&&e.value?$=C-10-30-10-L:$=C-L-6;const F=Math.max(15,$),m=a.node();if(m.getComputedTextLength()>F){let T=f;for(;T.length>0;){if(T=f.substring(0,T.length-1),T.length===0){a.text("..."),m.getComputedTextLength()>F&&a.text("");break}if(a.text(T+"..."),m.getComputedTextLength()<=F)break}}}),r.showValues!==!1&&_.append("text").attr("class","treemapSectionValue").attr("x",e=>e.x1-e.x0-10).attr("y",X/2).attr("text-anchor","end").attr("dominant-baseline","middle").text(e=>e.value?u(e.value):"").attr("font-style","italic").attr("style",e=>{if(e.depth===0)return"display: none;";const a="text-anchor: end; dominant-baseline: middle; font-size: 10px; fill:"+N(e.data.name)+"; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",f=E({cssCompiledStyles:e.data.cssCompiledStyles});return a+f.labelStyles.replace("color:","fill:")});const se=J.leaves(),Y=D.selectAll(".treemapLeafGroup").data(se).enter().append("g").attr("class",(e,a)=>`treemapNode treemapLeafGroup leaf${a}${e.data.classSelector?` ${e.data.classSelector}`:""}x`).attr("transform",e=>`translate(${e.x0},${e.y0})`);Y.append("rect").attr("width",e=>e.x1-e.x0).attr("height",e=>e.y1-e.y0).attr("class","treemapLeaf").attr("fill",e=>e.parent?g(e.parent.data.name):g(e.data.name)).attr("style",e=>E({cssCompiledStyles:e.data.cssCompiledStyles}).nodeStyles).attr("fill-opacity",.3).attr("stroke",e=>e.parent?g(e.parent.data.name):g(e.data.name)).attr("stroke-width",3),Y.append("clipPath").attr("id",(e,a)=>`clip-${l}-${a}`).append("rect").attr("width",e=>Math.max(0,e.x1-e.x0-4)).attr("height",e=>Math.max(0,e.y1-e.y0-4)),Y.append("text").attr("class","treemapLabel").attr("x",e=>(e.x1-e.x0)/2).attr("y",e=>(e.y1-e.y0)/2).attr("style",e=>{const a="text-anchor: middle; dominant-baseline: middle; font-size: 38px;fill:"+N(e.data.name)+";",f=E({cssCompiledStyles:e.data.cssCompiledStyles});return a+f.labelStyles.replace("color:","fill:")}).attr("clip-path",(e,a)=>`url(#clip-${l}-${a})`).text(e=>e.data.name).each(function(e){const a=j(this),f=e.x1-e.x0,C=e.y1-e.y0,L=a.node(),$=4,P=f-2*$,F=C-2*$;if(P<10||F<10){a.style("display","none");return}let m=parseInt(a.style("font-size"),10);const A=8,M=28,T=.6,V=6,H=2;for(;L.getComputedTextLength()>P&&m>A;)m--,a.style("font-size",`${m}px`);let I=Math.max(V,Math.min(M,Math.round(m*T))),K=m+H+I;for(;K>F&&m>A&&(m--,I=Math.max(V,Math.min(M,Math.round(m*T))),!(I<V&&m===A));)a.style("font-size",`${m}px`),K=m+H+I;a.style("font-size",`${m}px`),(L.getComputedTextLength()>P||m<A||F<m)&&a.style("display","none")}),r.showValues!==!1&&Y.append("text").attr("class","treemapValue").attr("x",a=>(a.x1-a.x0)/2).attr("y",function(a){return(a.y1-a.y0)/2}).attr("style",a=>{const f="text-anchor: middle; dominant-baseline: hanging; font-size: 28px;fill:"+N(a.data.name)+";",C=E({cssCompiledStyles:a.data.cssCompiledStyles});return f+C.labelStyles.replace("color:","fill:")}).attr("clip-path",(a,f)=>`url(#clip-${l}-${f})`).text(a=>a.value?u(a.value):"").each(function(a){const f=j(this),C=this.parentNode;if(!C){f.style("display","none");return}const L=j(C).select(".treemapLabel");if(L.empty()||L.style("display")==="none"){f.style("display","none");return}const $=parseFloat(L.style("font-size")),P=28,F=.6,m=6,A=2,M=Math.max(m,Math.min(P,Math.round($*F)));f.style("font-size",`${M}px`);const V=(a.y1-a.y0)/2+$/2+A;f.attr("y",V);const H=a.x1-a.x0,oe=a.y1-a.y0-4,ie=H-8;f.node().getComputedTextLength()>ie||V+M>oe||M<m?f.style("display","none"):f.style("display",null)});const re=r.diagramPadding??8;be(b,re,"flowchart",(r==null?void 0:r.useMaxWidth)||!1)},"draw"),Ee=w(function(o,l){return l.db.getClasses()},"getClasses"),Re={draw:Pe,getClasses:Ee},We={sectionStrokeColor:"black",sectionStrokeWidth:"1",sectionFillColor:"#efefef",leafStrokeColor:"black",leafStrokeWidth:"1",leafFillColor:"#efefef",labelColor:"black",labelFontSize:"12px",valueFontSize:"10px",valueColor:"black",titleColor:"black",titleFontSize:"14px"},Be=w(({treemap:o}={})=>{const l=Q(We,o);return`
  .treemapNode.section {
    stroke: ${l.sectionStrokeColor};
    stroke-width: ${l.sectionStrokeWidth};
    fill: ${l.sectionFillColor};
  }
  .treemapNode.leaf {
    stroke: ${l.leafStrokeColor};
    stroke-width: ${l.leafStrokeWidth};
    fill: ${l.leafFillColor};
  }
  .treemapLabel {
    fill: ${l.labelColor};
    font-size: ${l.labelFontSize};
  }
  .treemapValue {
    fill: ${l.valueColor};
    font-size: ${l.valueFontSize};
  }
  .treemapTitle {
    fill: ${l.titleColor};
    font-size: ${l.titleFontSize};
  }
  `},"getStyles"),_e=Be,je={parser:le,get db(){return new te},renderer:Re,styles:_e};export{je as diagram};
