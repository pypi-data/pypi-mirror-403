[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "aws-durable-execution-sdk-python-testing"
dynamic = ["version"]
description = 'AWS Durable Execution Testing SDK for Python'
readme = "README.md"
requires-python = ">=3.11"
license = "Apache-2.0"
keywords = []
authors = [{ name = "yaythomas", email = "tgaigher@amazon.com" }]
classifiers = [
  "Development Status :: 4 - Beta",
  "Programming Language :: Python",
  "Programming Language :: Python :: 3.11",
  "Programming Language :: Python :: 3.12",
  "Programming Language :: Python :: 3.13",
  "Programming Language :: Python :: 3.14",
  "Programming Language :: Python :: Implementation :: CPython",
  "Programming Language :: Python :: Implementation :: PyPy",
]
dependencies = [
  "boto3>=1.42.1",
  "requests>=2.25.0",
  "aws_durable_execution_sdk_python>=1.0.0",
]

[project.urls]
Documentation = "https://github.com/aws/aws-durable-execution-sdk-python-testing#readme"
Issues = "https://github.com/aws/aws-durable-execution-sdk-python-testing/issues"
Source = "https://github.com/aws/aws-durable-execution-sdk-python-testing"

[project.scripts]
dex-local-runner = "aws_durable_execution_sdk_python_testing.cli:main"

[tool.hatch.build.targets.sdist]
packages = ["src/aws_durable_execution_sdk_python_testing"]

[tool.hatch.build.targets.wheel]
packages = ["src/aws_durable_execution_sdk_python_testing"]

[tool.hatch.metadata]
allow-direct-references = true

[tool.hatch.version]
path = "src/aws_durable_execution_sdk_python_testing/__about__.py"

# [tool.hatch.envs.default]
# dependencies=["pytest"]

# [tool.hatch.envs.default.scripts]
# test="pytest"

[tool.hatch.envs.test]
dependencies = [
  "coverage[toml]",
  "pytest",
  "pytest-cov",
  "ruff",
  "aws_durable_execution_sdk_python>=1.0.0",
]

[tool.hatch.envs.test.scripts]
test = "pytest tests/ -v"
examples = "pytest --runner-mode=local -m example examples/test/ -v"
examples-integration = "pytest --runner-mode=cloud -m example examples/test/ -v {args}"
cov = "pytest --cov-report=term-missing --cov-config=pyproject.toml --cov=src/aws_durable_execution_sdk_python_testing --cov-fail-under=96"

[tool.hatch.envs.examples]
dependencies = [
  "boto3",
  "PyYAML",
  "aws_durable_execution_sdk_python>=1.0.0",
]
[tool.hatch.envs.examples.scripts]
cli = "python examples/cli.py {args}"
bootstrap = "python examples/cli.py bootstrap"
generate-sam-template = "python examples/scripts/generate_sam_template.py"
build = "python examples/cli.py build"
deploy = "python examples/cli.py deploy {args}"
invoke = "python examples/cli.py invoke {args}"
get = "python examples/cli.py get {args}"
history = "python examples/cli.py history {args}"
policy = "python examples/cli.py policy {args}"
list = "python examples/cli.py list"
clean = "rm -rf examples/build examples/.aws-sam examples/*.zip"

[tool.hatch.envs.types]
extra-dependencies = ["mypy>=1.0.0", "pytest"]
[tool.hatch.envs.types.scripts]
check = "mypy --install-types --non-interactive {args:src/aws_durable_execution_sdk_python_testing tests}"

[tool.coverage.run]
source_pkgs = ["aws_durable_execution_sdk_python_testing"]
branch = true
parallel = true
omit = ["src/aws_durable_execution_sdk_python_testing/__about__.py", "tests/*"]

[tool.coverage.paths]
aws_durable_execution_sdk_python_testing = [
  "src/aws_durable_execution_sdk_python_testing",
  "*/aws-durable-execution-sdk-python-testing/src/aws_durable_execution_sdk_python_testing",
]
tests = ["tests", "*/aws-durable-execution-sdk-python-testing/tests"]

[tool.coverage.report]
exclude_lines = [
  "no cov",
  "if __name__ == .__main__.:",
  "if TYPE_CHECKING:",
  "@abstractmethod",
]

[tool.ruff]
line-length = 88
target-version = "py313"

[tool.ruff.lint]
preview = false
select = ["TID252"]  # Enforce absolute imports (ban relative imports)

[tool.ruff.lint.isort]
known-first-party = ["aws_durable_execution_sdk_python_testing"]
force-single-line = false
lines-after-imports = 2

[tool.ruff.lint.per-file-ignores]
"tests/**" = [
  "ARG001",
  "ARG002",
  "ARG005",
  "S101",
  "PLR2004",
  "SIM117",
  "TRY301",
]
"examples/test/**" = [
  "ARG001",
  "ARG002",
  "ARG005",
  "S101",
  "PLR2004",
  "SIM117",
  "TRY301",
]
"src/aws_durable_execution_sdk_python_testing/invoker.py" = [
  "A002", # Argument `input` is shadowing a Python builtin
]

[tool.pytest.ini_options]
# Declare custom markers to avoid warnings with --strict-markers
markers = [
  # Used for test selection with -m example
  "example: marks tests as example tests (deselect with '-m \"not example\"')",
  # Used for configuration - passes handler and lambda_function_name to durable_runner fixture
  "durable_execution: marks tests that use the durable_runner fixture (not used for test selection)",
]
# Default test discovery paths
testpaths = ["tests", "examples/test"]
# Default options for all test runs
addopts = "-v --strict-markers"
