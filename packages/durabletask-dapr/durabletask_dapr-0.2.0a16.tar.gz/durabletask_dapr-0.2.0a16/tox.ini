[tox]
skipsdist = True
minversion = 3.10.0
envlist =
    py{310,311,312,313,314}
    ruff,
    mypy,
# TODO: switch runner to uv (tox-uv plugin)
runner = virtualenv

[testenv]
# you can run tox with the e2e pytest marker using tox factors:
#   tox -e py310-e2e
# to use custom grpc endpoint:
#   DAPR_GRPC_ENDPOINT=localhost:12345 tox -e py310-e2e
setenv =
    PYTHONDONTWRITEBYTECODE=1
deps = .[dev]
commands =
    !e2e: pytest -m "not e2e" --verbose
    e2e: pytest -m e2e --verbose
commands_pre =
    pip3 install -e {toxinidir}/
allowlist_externals = pip3
pass_env = DAPR_GRPC_ENDPOINT,DAPR_HTTP_ENDPOINT,DAPR_RUNTIME_HOST,DAPR_GRPC_PORT,DAPR_HTTP_PORT

[testenv:ruff]
basepython = python3
usedevelop = False
commands =
    ruff check --fix
    ruff format
