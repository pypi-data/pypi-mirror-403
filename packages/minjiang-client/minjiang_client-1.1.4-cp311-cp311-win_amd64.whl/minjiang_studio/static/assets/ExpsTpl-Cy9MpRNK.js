import{G as L,u as c,P as S,d as X,e as V,f as y,h as E,K as Se,b as ke,C as Te,r as u,a6 as Fe,i as l,Z as Ce,l as e,Y as N,w as o,U as se,W as oe,aw as qe,ad as le,al as re,ab as j,av as Re,bi as Ie,t as F,aq as Le,ap as Be,ac as ue,X as ie,B as ze,s as U,F as W,bT as J,E as Pe,aG as ce,a5 as Me}from"./index-DJskbzIk.js";import{l as Ue}from"./exp-Dzc8nAzP.js";import{D as Ve}from"./DynamicForm-B5kgL0W4.js";import{P as Ae,_ as $e}from"./WaveformPane.vue_vue_type_script_setup_true_lang-CYNgzszk.js";import{E as pe}from"./ExperimentTwotone-CUUKUJME.js";function De(){return L(c.expTplGroups)}function Oe(t){return L(c.expTpls,t)}function de(t){return S(c.expTplSetup,t)}function _e(t){return S(c.createExpFromTpl,t)}function at(t){return S(c.createExpFolder,t)}function nt(t){return S(c.deleteExpFolder,t)}function st(t){return S(c.moveExpFolder,t)}function ot(t){return S(c.moveExps,t)}function lt(t){return L(c.getExpFolderTree,t)}function rt(t){return L(c.getExpsByFolder,t)}function ut(t){return S(c.toggleFavorities,t)}function it(t){return L(c.getActiveExps,t)}function ct(t){return S(c.renameFolder,t)}function pt(t){return L(c.getFavorityList,t)}const Ge={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},dt=X({name:"RecordStop24Regular",render:function(K,v){return y(),V("svg",Ge,v[0]||(v[0]=[E("g",{fill:"none"},[E("path",{d:"M12 3.5a8.5 8.5 0 1 0 0 17a8.5 8.5 0 0 0 0-17zM2 12C2 6.477 6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12zm6-2.5A1.5 1.5 0 0 1 9.5 8h5A1.5 1.5 0 0 1 16 9.5v5a1.5 1.5 0 0 1-1.5 1.5h-5A1.5 1.5 0 0 1 8 14.5v-5z",fill:"currentColor"})],-1)]))}}),Ne={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},me=X({name:"RocketLaunchOutlined",render:function(K,v){return y(),V("svg",Ne,v[0]||(v[0]=[E("path",{d:"M6 15c-.83 0-1.58.34-2.12.88C2.7 17.06 2 22 2 22s4.94-.7 6.12-1.88A2.996 2.996 0 0 0 6 15zm.71 3.71c-.28.28-2.17.76-2.17.76s.47-1.88.76-2.17c.17-.19.42-.3.7-.3a1.003 1.003 0 0 1 .71 1.71zm10.71-5.06c6.36-6.36 4.24-11.31 4.24-11.31S16.71.22 10.35 6.58l-2.49-.5a2.03 2.03 0 0 0-1.81.55L2 10.69l5 2.14L11.17 17l2.14 5l4.05-4.05c.47-.47.68-1.15.55-1.81l-.49-2.49zM7.41 10.83l-1.91-.82l1.97-1.97l1.44.29c-.57.83-1.08 1.7-1.5 2.5zm6.58 7.67l-.82-1.91c.8-.42 1.67-.93 2.49-1.5l.29 1.44l-1.96 1.97zM16 12.24c-1.32 1.32-3.38 2.4-4.04 2.73l-2.93-2.93c.32-.65 1.4-2.71 2.73-4.04c4.68-4.68 8.23-3.99 8.23-3.99s.69 3.55-3.99 8.23zM15 11c1.1 0 2-.9 2-2s-.9-2-2-2s-2 .9-2 2s.9 2 2 2z",fill:"currentColor"},null,-1)]))}}),je={class:"pl-5 h-full tpl-s-g"},We={class:"mb-5"},Ke={class:"text-xl"},Je={class:"text-sm opacity-80"},Xe={class:"h-[440px]"},Ye=X({__name:"ExpsTpl",props:{fid:{},spaceId:{}},setup(t,{expose:K}){const v=Se(),p=t,{t:x}=ke(),d=Te(),h=u(),C=u(!1),q=u(!1),k=u(!1),R=u(!1),fe=()=>{R.value=!0},A=()=>{R.value=!1,O()},_=u(),Y=u(),Z=u(),ve=async()=>{const[n,a]=await De();!n&&(a==null?void 0:a.status)===0&&(Z.value=a.data,_.value=Object.keys(a.data)[0],H(_.value))},m=u(),$=u(),H=async n=>{const[a,s]=await Oe({template_group_name:n});!a&&(s==null?void 0:s.status)===0&&(Y.value=s.data,m.value=Object.keys(s.data)[0],Q(Object.keys(s.data)[0]))},Q=async n=>{if(k.value)return;k.value=!0;const[a,s]=await de({template_group_name:_.value,template_name:n,group_name:d.query.device_group_name,space_id:p.spaceId||d.query.space_id});k.value=!1,!a&&(s==null?void 0:s.status)===0&&($.value=s.data)},ge=n=>{H(n)},xe=n=>{Q(n)},ee=async n=>{var g;if(C.value||!h.value)return;B.value||(C.value=!0);let a={};try{a=await((g=h.value[0])==null?void 0:g.submit())}catch{B.value=!1,C.value=!1,v.error(x("common.checkError"));return}const s=J(a);if(W(s))return;const{device_group_name:i,space_id:w}=d.query,[f,r]=await _e({setting:s,group_name:i,space_id:p.spaceId||w,template_group:_.value,template_name:m.value,exp_folder_id:+String(p.fid)});B.value=!1,C.value=!1,!f&&(r==null?void 0:r.status)===0&&(r.data.exp.template=r.data.exp.template||`${_.value}/${m.value}`,Pe(()=>{setTimeout(()=>{localStorage.setItem("t",JSON.stringify(r));const b=new URLSearchParams({device_group_name:d.query.device_group_name,space_id:p.spaceId||d.query.space_id,create:"1",fid:String(p.fid)});window.open(`/experiment/expSettings?${b.toString()}`,ce(n))},100),A()}))},te=async n=>{var g;if(q.value||!h.value)return;z.value||(q.value=!0);let a={};try{a=await((g=h.value[0])==null?void 0:g.submit())}catch{q.value=!1,z.value=!1,v.error(x("common.checkError"));return}const s=J(a);if(W(s))return;const{device_group_name:i,space_id:w}=d.query,[f,r]=await Ue({setting:s,group_name:i,space_id:p.spaceId||w,template_group:_.value,template_name:m.value,exp_folder_id:+String(p.fid)});q.value=!1,z.value=!1,!f&&(r==null?void 0:r.status)===0&&(setTimeout(()=>{const b=new URLSearchParams({device_group_name:d.query.device_group_name,space_id:p.spaceId||d.query.space_id,exp_id:String(r.data.exp_id)});window.open(`/experiment/plotter?${b.toString()}`,ce(n))},100),A())},D=u({}),B=u(!1),z=u(!1),ye=n=>{B.value=!0,ee(n)},he=n=>{z.value=!0,te(n)},I=u(!1),we=async()=>{var r;if(I.value||!h.value)return;I.value=!0;let n={};try{n=await((r=h.value[0])==null?void 0:r.submit())}catch{I.value=!1,v.error(x("common.checkError"));return}P.value=!0;const a=J(n);if(W(a))return;const{device_group_name:s,space_id:i}=d.query,[w,f]=await _e({setting:a,group_name:s,space_id:p.spaceId||i,template_group:_.value,template_name:m.value,exp_folder_id:+String(p.fid)});if(I.value=!1,!w&&(f==null?void 0:f.status)===0){const g=f.data||{};D.value={template_name:m.value,device_group_name:s,space_id:p.spaceId||i,experiment_json:g.exp||{}}}},P=u(!1),O=()=>{P.value=!1,D.value={}},be=n=>{n||O()};Fe(R,n=>{n&&ve()},{immediate:!0}),K({open:fe,close:A});const G=u(!1),Ee=async()=>{var i;if(!m.value||G.value)return;G.value=!0;let n={};try{n=await((i=h.value[0])==null?void 0:i.submit(!0))}catch{G.value=!1,v.error(x("common.checkError"));return}const[a,s]=await de({template_group_name:_.value,template_name:m.value,group_name:d.query.device_group_name,space_id:p.spaceId||d.query.space_id,current_setup:n||{}});G.value=!1,!a&&(s==null?void 0:s.status)===0&&($.value=s.data)};return(n,a)=>{const s=Be,i=ze,w=Le,f=Re,r=qe,g=Ie,b=Ce;return y(),V("div",null,[l(b,{show:e(R),"onUpdate:show":a[2]||(a[2]=T=>N(R)?R.value=T:null),"auto-focus":!1},{default:o(()=>[l(se,{style:{"max-height":"calc(100vh - 100px)",overflow:"hidden",width:"80vw","min-width":"600px",position:"relative"}},{default:o(()=>[l(oe,null,{default:o(()=>[l(r,{type:"card",placement:"left",animated:"",onUpdateValue:ge,value:e(_),"onUpdate:value":a[1]||(a[1]=T=>N(_)?_.value=T:null),style:{height:"calc(100vh - 155px)"}},{default:o(()=>[(y(!0),V(le,null,re(e(Z),(T,ae)=>(y(),j(f,{key:ae,name:ae,tab:T.title,disabled:e(k)},{default:o(()=>[l(g,{style:{height:"100%","padding-top":"10px","box-sizing":"border-box","padding-right":"16px"}},{default:o(()=>[l(r,{type:"line",placement:"left",value:e(m),"onUpdate:value":a[0]||(a[0]=M=>N(m)?m.value=M:null),onUpdateValue:xe,style:{height:"100%"}},{default:o(()=>[(y(!0),V(le,null,re(e(Y),(M,ne)=>(y(),j(f,{key:ne,name:ne,tab:M.title,disabled:e(k)},{default:o(()=>[E("div",je,[E("div",We,[E("div",Ke,F(M.title),1),E("div",Je,F(M.desc),1)]),l(w,{show:e(k)},{default:o(()=>[l(s,{style:{height:"calc(100vh - 320px)"}},{default:o(()=>[e($)&&!e(k)?(y(),j(Ve,{key:0,cfgs:e($),ref_for:!0,ref_key:"dynamicFormRef",ref:h,onRerender:Ee},null,8,["cfgs"])):ue("",!0)]),_:1}),l(ie,{onCancel:A},{default:o(()=>[l(i,{loading:e(I),disabled:e(I),type:"primary",onClick:we},{icon:o(()=>[l(e(Ae))]),default:o(()=>[U(" "+F(e(x)("expInfo.wavePreview")),1)]),_:1},8,["loading","disabled"]),l(i,{loading:e(q),disabled:e(C),type:"primary",onClick:te},{icon:o(()=>[l(e(me))]),default:o(()=>[U(" "+F(e(x)("groupDetail.exps.createsubmit")),1)]),_:1},8,["loading","disabled"]),l(i,{loading:e(C),disabled:e(q),type:"primary",onClick:ee},{icon:o(()=>[l(e(pe))]),default:o(()=>[U(" "+F(e(x)("groupDetail.exps.createExpBtn")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["show"])])]),_:2},1032,["name","tab","disabled"]))),128))]),_:1},8,["value"])]),_:1})]),_:2},1032,["name","tab","disabled"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["show"]),l(b,{show:e(P),"onUpdate:show":a[3]||(a[3]=T=>N(P)?P.value=T:null),onUpdateShow:be,"auto-focus":!1},{default:o(()=>[l(se,{style:{width:"85vw"}},{default:o(()=>[l(oe,null,{default:o(()=>[E("div",Xe,[e(W)(e(D))?ue("",!0):(y(),j($e,{key:0,query:e(D),cusclose:"","hide-divider":"",classes:"!h-[400px]",onClose:O},null,8,["query"]))])]),_:1}),l(ie,{onCancel:O},{default:o(()=>[l(i,{type:"primary",loading:e(z),onClick:he},{icon:o(()=>[l(e(me))]),default:o(()=>[U(" "+F(e(x)("groupDetail.exps.createsubmit")),1)]),_:1},8,["loading"]),l(i,{type:"primary",onClick:ye,loading:e(B)},{icon:o(()=>[l(e(pe))]),default:o(()=>[U(" "+F(e(x)("groupDetail.exps.createExpBtn")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["show"])])}}}),_t=Me(Ye,[["__scopeId","data-v-1eea4f6f"]]);export{_t as E,dt as R,pt as a,rt as b,at as c,st as d,lt as e,nt as f,it as g,ot as m,ct as r,ut as t};
