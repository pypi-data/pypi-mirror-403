import{d as L,e as T,f as y,h as w,bU as Q,bV as he,i as l,w as c,ad as ge,al as ke,ab as F,bs as te,s as oe,ac as H,t as K,B as O,l as o,aw as le,a5 as xe,C as re,b as ie,a9 as be,K as Ce,r as C,I as s,N as U,ag as D,bW as we,as as Re,aE as ee,aR as Me,a6 as Ie,am as ce,Y as ze,U as Oe,W as Te,Z as Be,F as ae,bX as se,bY as $e}from"./index-DJskbzIk.js";import{r as Le,a as Ve}from"./params-elF_11QE.js";import{m as qe}from"./exp-Dzc8nAzP.js";import{H as Se,_ as Ne,a as je,S as Ee,R as Fe}from"./SpaceTools-Ds6UqpWj.js";import{c as ne}from"./index-CljUi5cZ.js";import{_ as He}from"./Popconfirm-DFFNKs94.js";import{_ as Ue}from"./DataTable-BkhITQT9.js";const Pe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},P=L({name:"RefreshCircle",render:function(M,r){return y(),T("svg",Pe,r[0]||(r[0]=[w("path",{d:"M256 48C141.31 48 48 141.32 48 256c0 114.86 93.14 208 208 208c114.69 0 208-93.31 208-208c0-114.87-93.13-208-208-208zm0 313a94 94 0 0 1 0-188h4.21l-14.11-14.1a14 14 0 0 1 19.8-19.8l40 40a14 14 0 0 1 0 19.8l-40 40a14 14 0 0 1-19.8-19.8l18-18c-2.38-.1-5.1-.1-8.1-.1a66 66 0 1 0 66 66a14 14 0 0 1 28 0a94.11 94.11 0 0 1-94 94z",fill:"currentColor"},null,-1)]))}}),Ae={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 16 16"},A=L({name:"AddCircle16Filled",render:function(M,r){return y(),T("svg",Ae,r[0]||(r[0]=[w("g",{fill:"none"},[w("path",{d:"M2 8a6 6 0 1 1 12 0A6 6 0 0 1 2 8zm6-3a.5.5 0 0 0-.5.5v2h-2a.5.5 0 0 0 0 1h2v2a.5.5 0 0 0 1 0v-2h2a.5.5 0 0 0 0-1h-2v-2A.5.5 0 0 0 8 5z",fill:"currentColor"})],-1)]))}}),Ke={class:"flex justify-between items-center gap-2"},Je={key:0},We={key:0,class:"flex justify-center w-full"},Ye=L({__name:"CategoryTabs",props:Q({readOnly:{type:Boolean},tabs:{}},{modelValue:{},modelModifiers:{}}),emits:Q(["insert","refresh"],["update:modelValue"]),setup(R,{emit:M}){const r=M,h=he(R,"modelValue"),i=(m="")=>{r("insert",{full_key:m})},B=()=>{r("refresh")};return(m,p)=>{const g=O,v=te,k=le;return y(),T("div",null,[l(k,{type:"card",placement:"left",value:h.value,"onUpdate:value":p[1]||(p[1]=f=>h.value=f),class:"tabs",style:{"max-height":"calc(100vh - 340px)"}},{suffix:c(()=>[m.readOnly?H("",!0):(y(),T("div",We,[l(g,{type:"info",quaternary:"",onClick:p[0]||(p[0]=()=>i()),size:"small"},{icon:c(()=>[l(o(A))]),_:1}),l(g,{type:"info",quaternary:"",onClick:B,size:"small"},{icon:c(()=>[l(o(P))]),_:1})]))]),default:c(()=>[(y(!0),T(ge,null,ke(m.tabs,(f,I)=>(y(),F(v,{name:f.node_name,class:"!flex-1 w-full",key:I},{default:c(()=>[w("div",Ke,[oe(K(f.node_name)+" ",1),m.readOnly?H("",!0):(y(),T("div",Je,[l(g,{type:"info",quaternary:"",onClick:()=>i(f.full_key),size:"small"},{icon:c(()=>[l(o(A))]),_:2},1032,["onClick"]),l(g,{type:"info",quaternary:"",onClick:B,size:"small"},{icon:c(()=>[l(o(P))]),_:1})]))])]),_:2},1032,["name"]))),128))]),_:1},8,["value"])])}}}),Xe=xe(Ye,[["__scopeId","data-v-6fd4e427"]]),Ze={class:"flex gap-2 items-center"},Ge={class:"flex gap-5"},Qe=L({__name:"ParamsLatest",props:{spaceId:{},maxHeight:{},readOnly:{type:Boolean},version:{}},setup(R,{expose:M}){const r=R,h=re(),{t:i}=ie(),{copy:B,isSupported:m}=be({legacy:!0}),p=Ce(),g=C(),v=C(!1),k=C(),f=C(),I=C({show:!1,info:void 0}),V=C(),q=C(),de=()=>{I.value={show:!1,info:void 0}},$=C(),J=e=>{B(e),p.success(i("common.copied"))},W=e=>{var a;(a=V.value)==null||a.open(),q.value={...e,type:"add"}},ue=e=>{var a,n;(a=V.value)==null||a.open(),(n=V.value)==null||n.setFormValue({types:e.t,keys:e.node_name,values:e.v}),q.value={...e,type:"edit"}},S=(e,a,n)=>{const d=JSON.parse(JSON.stringify(f.value));let b=!1;const z=(t,N)=>{se(t,(u,j)=>{var _;if(b)return!1;if(u.full_key===e){switch(a){case"rchildren":delete u.children;break;case"rself":(_=N.children)==null||_.splice(j,1);break;case"update":n&&(u.children=n);break;case"insert":u.children=n}return b=!0,!1}u.children&&z(u.children,u)})};z(d,{children:d}),f.value=d},pe=async e=>{const[a,n]=await Le({key:e.full_key,device_group_name:h.query.device_group_name,space_id:r.spaceId});!a&&(n==null?void 0:n.status)===0&&S(e.full_key,"rself")},Y=(e,a)=>{var n;x(e,void 0,a!==void 0?a:((n=q.value)==null?void 0:n.type)==="add")},fe=e=>{I.value={show:!0,info:e}},me=()=>{x([k.value])},_e=e=>{x(e.full_key.split("/"));const a=($.value||[]).concat(e.full_key);$.value=[...new Set(a)]},X=[{title:i("groupDetail.parameterManager.key"),key:"node_name",render:e=>e.expandable?s("div",{class:"inline-flex items-center gap-1"},ne([s("span",e.node_name),r.readOnly?null:s(O,{quaternary:!0,type:"info",size:"small",onClick:()=>W(e)},{icon:()=>s(A)}),r.readOnly?null:s(O,{quaternary:!0,type:"info",size:"small",onClick:()=>_e(e)},{icon:()=>s(P)})])):s("div",{class:"inline-flex gap-2"},[s("div",e.node_name),m.value?s(U,{class:"cursor-pointer transition-transform hover:translate-y-[1px]",size:20,onClick:()=>J(e.full_key)},{default:()=>s(D)}):void 0])},{title:i("groupDetail.parameterManager.dataType"),key:"t",width:100,render:e=>{if(e.expandable)return;const a=we.find(n=>n.value===e.t);return s(Re,{size:"small",bordered:!1,color:{textColor:"#fff",color:(a==null?void 0:a.color)||"#2080f0"},class:"min-w-16 text-center inline-flex justify-center"},{default:()=>e.t})}},{title:i("groupDetail.parameterManager.value"),key:"v",render:e=>e.expandable?e.v:s("div",{class:"flex gap-2"},[s(ee,{tooltip:{show:!1}},{default:()=>e.v}),m.value?s(U,{class:"cursor-pointer transition-transform hover:translate-y-[1px]",size:20,onClick:()=>J(e.v)},{default:()=>s(D)}):void 0])},{title:i("groupDetail.parameterManager.paramsDesc"),key:"desc",render:e=>e.expandable?e.v:s("div",{class:"flex gap-2"},[s(ee,{class:"opacity-80"},{default:()=>e.desc})])}];r.readOnly||X.push({title:i("groupDetail.parameterManager.options"),key:"options",width:180,align:"center",render:e=>{if(!(e!=null&&e.isLeaf))return;const a={quaternary:!0,type:"info",size:"small"},n=s(O,{...a,onClick:()=>{ue(e)}},{default:()=>i("groupDetail.parameterManager.optionEdit")}),d=s(O,{...a,onClick:()=>fe(e)},{default:()=>i("groupDetail.parameterManager.optionHistory")}),b=s(He,{onPositiveClick:()=>pe(e)},{default:()=>i("groupDetail.parameterManager.removeConfirm"),icon:()=>s(U,{color:"#e88080",size:22},{default:()=>s(Se)}),trigger:()=>s(O,{...a,type:"error"},{default:()=>i("groupDetail.parameterManager.optionRemove")})});return s("div",{class:"flex justify-end"},[n,d,b])}});const x=async(e=[],a,n)=>{var b;if(!r.spaceId||v.value||!h.query.device_group_name)return;v.value=!0;const d=ne(e);try{const[z,t]=await Ve({device_group_name:h.query.device_group_name,space_id:r.spaceId,parent_tree:d,version:r.version});if(v.value=!1,z||(t==null?void 0:t.status)!==0)return;if(d.length===0){g.value=t.data,t.data&&t.data.length>0&&x([t.data[0].node_name]),ae(t.data)&&(f.value=[]);return}const N="/"+d.join("/"),u=t.data.map(_=>({..._,isLeaf:!_.expandable})),j=(b=u.filter(_=>_.isLeaf))==null?void 0:b.map(_=>_.full_key);if(!ae(j)){const[_,E]=await qe({full_key_list:j.join(","),language:localStorage.getItem("lang")||"en"});!_&&(E==null?void 0:E.status)===0&&se(u,Z=>{const G=E.data[Z.full_key];G&&(Z.desc=G)})}if(a)return a.resolve(),u;d.length===1?f.value=u:n?S(N,"insert",u):S(N,"update",u)}catch{a&&a.reject(),v.value=!1}},ye=e=>new Promise(async(a,n)=>{const d=await x(e.full_key.split("/"),{resolve:a,reject:n});e.children=d}),ve=e=>{const[a]=$e($.value,e);a&&S(a,"rchildren"),$.value=e};return Me(()=>{x()}),Ie(k,e=>{e&&($.value=[],f.value=[],x([e]))}),M({refresh:x,refreshCurTab:()=>x(k.value?[k.value]:void 0)}),(e,a)=>{const n=te,d=le,b=Ue,z=Be;return y(),T("div",null,[l(d,{value:"globalOverview",class:"!h-full mb-5",disabled:o(v)},{suffix:c(()=>[ce(e.$slots,"default")]),default:c(()=>[l(n,{name:"globalOverview"},{default:c(()=>[w("div",Ze,K(o(i)("groupDetail.parameterManager.globalLatest")),1)]),_:1})]),_:3},8,["disabled"]),w("div",Ge,[o(g)?(y(),F(Xe,{key:0,tabs:o(g),modelValue:o(k),"onUpdate:modelValue":a[0]||(a[0]=t=>ze(k)?k.value=t:null),onInsert:W,onRefresh:me,"read-only":e.readOnly},null,8,["tabs","modelValue","read-only"])):H("",!0),l(b,{size:"small","max-height":e.maxHeight?e.maxHeight:"calc(100vh - 265px)",columns:X,data:o(f),loading:o(v),"row-key":t=>t.full_key,"expanded-row-keys":o($),onLoad:ye,onUpdateExpandedRowKeys:ve},null,8,["max-height","data","loading","row-key","expanded-row-keys"]),e.spaceId?(y(),F(Ne,{key:1,info:o(q),ref_key:"actionInfoRef",ref:V,"space-id":e.spaceId,"onUpdate:success":Y},null,8,["info","space-id"])):H("",!0),l(z,{show:o(I).show,"onUpdate:show":a[1]||(a[1]=t=>o(I).show=t),"auto-focus":!1},{default:c(()=>[l(Oe,{style:{"min-height":"400px",overflow:"auto",width:"1300px","min-width":"500px"}},{default:c(()=>[l(Te,null,{default:c(()=>{var t;return[l(je,{"max-height":"auto","space-id":e.spaceId,hkey:(t=o(I).info)==null?void 0:t.full_key,"hide-history-option":"","onUpdate:success":Y,"onClose:modal":de,"show-footer":""},null,8,["space-id","hkey"])]}),_:1})]),_:1})]),_:1},8,["show"])])])}}}),De={class:"flex items-center flex-1 justify-between"},ea={class:"flex items-center"},ia=L({__name:"ParamsLatest",props:{canRefresh:{type:Boolean},hideInit:{type:Boolean}},setup(R,{expose:M}){const r=R,h=C(),{t:i}=ie(),B=re(),m=()=>{var p;r.canRefresh&&((p=h.value)==null||p.refreshCurTab())};return M({refreshCurTab:m}),(p,g)=>{const v=O;return y(),F(Qe,{"space-id":+(o(B).query.space_id||""),ref_key:"paramsLatestRef",ref:h},{default:c(()=>[w("div",De,[ce(p.$slots,"default"),w("div",ea,[l(Ee,{"hide-init":""}),l(v,{type:"primary",disabled:!p.canRefresh,class:"!ml-2",onClick:m},{icon:c(()=>[l(o(Fe))]),default:c(()=>[oe(" "+K(o(i)("groupDetail.parameterManager.refresh")),1)]),_:1},8,["disabled"])])])]),_:3},8,["space-id"])}}});export{ia as _,Qe as a};
