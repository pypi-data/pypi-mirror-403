import{u as re}from"./exp-fN6tgzBZ.js";import{aY as Oe,aV as Z,bH as Ve,d as Y,I as w,cg as Fe,ch as Be,ci as ze,n as le,cj as $e,ck as oe,bI as Ae,cl as Pe,cm as Ue,cn as Ne,b7 as ve,co as ge,r as z,aj as _e,b3 as ye,b8 as ee,cp as De,L as j,cq as je,cr as Me,ba as he,cs as Ee,ct as Le,bc as W,af as We,as as ae,B as X,aZ as Ke,cu as qe,cv as He,cw as Je,E as be,cx as Ye,C as Ge,b as te,bV as Qe,Q as Ze,ab as B,f as _,l as a,bW as Xe,aE as ea,A as aa,bp as ie,a6 as ta,ac as k,k as na,w as f,e as V,h as q,i as c,m as sa,s as H,t as R,aa as Q,p as oa,Y as ra,a5 as Te,aN as la,ad as de,al as ia,aF as ua,cy as pa,F as da,N as ca,j as ma,aO as fa,a3 as va,ap as ga}from"./index-DJskbzIk.js";import{V as ce}from"./index-DDdGfEJ1.js";import{c as _a}from"./params-elF_11QE.js";import{s as ya}from"./prop-NnGblK-3.js";import{N as ha}from"./InputNumber-CtZNiVVn.js";import{D as me,_ as ba}from"./ScriptTemplate.vue_vue_type_script_setup_true_lang-DwkkEma9.js";import{_ as Ta}from"./Popconfirm-DFFNKs94.js";import{A as fe}from"./Add-B9E6ooHy.js";import"./index.browser-OxPLOBIU.js";import"./exp-Dzc8nAzP.js";import"./Cascader-C4NH3za0.js";import"./Checkbox-B0NmEvB4.js";const wa=Oe([Z("auto-complete",`
 z-index: auto;
 position: relative;
 display: inline-flex;
 width: 100%;
 `),Z("auto-complete-menu",`
 margin: 4px 0;
 box-shadow: var(--n-menu-box-shadow);
 `,[Ve({originalTransition:"background-color .3s var(--n-bezier), box-shadow .3s var(--n-bezier)"})])]);function Ca(n){return n.map(we)}function we(n){var s,i;return typeof n=="string"?{label:n,value:n}:n.type==="group"?{type:"group",label:(s=n.label)!==null&&s!==void 0?s:n.name,value:(i=n.value)!==null&&i!==void 0?i:n.name,key:n.key||n.name,children:n.children.map(t=>we(t))}:n}const Ia=Object.assign(Object.assign({},ee.props),{to:oe.propTo,menuProps:Object,append:Boolean,bordered:{type:Boolean,default:void 0},clearable:{type:Boolean,default:void 0},defaultValue:{type:String,default:null},loading:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},placeholder:String,placement:{type:String,default:"bottom-start"},value:String,blurAfterSelect:Boolean,clearAfterSelect:Boolean,getShow:Function,showEmpty:Boolean,inputProps:Object,renderOption:Function,renderLabel:Function,size:String,options:{type:Array,default:()=>[]},zIndex:Number,status:String,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onSelect:[Function,Array],onBlur:[Function,Array],onFocus:[Function,Array],onInput:[Function,Array]}),xa=Y({name:"AutoComplete",props:Ia,slots:Object,setup(n){const{mergedBorderedRef:s,namespaceRef:i,mergedClsPrefixRef:d,inlineThemeDisabled:t}=ve(n),y=ge(n),{mergedSizeRef:m,mergedDisabledRef:p,mergedStatusRef:u}=y,e=z(null),r=z(null),v=z(n.defaultValue),T=_e(n,"value"),C=ye(T,v),O=z(!1),U=z(!1),o=ee("AutoComplete","-auto-complete",wa,De,n,d),x=j(()=>Ca(n.options)),$=j(()=>{const{getShow:l}=n;return l?l(C.value||""):!!C.value}),N=j(()=>$.value&&O.value&&(n.showEmpty?!0:!!x.value.length)),g=j(()=>je(x.value,Me("value","children")));function D(l){const{"onUpdate:value":b,onUpdateValue:P,onInput:K}=n,{nTriggerFormInput:G,nTriggerFormChange:Re}=y;P&&W(P,l),b&&W(b,l),K&&W(K,l),v.value=l,G(),Re()}function L(l){const{onSelect:b}=n,{nTriggerFormInput:P,nTriggerFormChange:K}=y;b&&W(b,l),P(),K()}function M(l){const{onBlur:b}=n,{nTriggerFormBlur:P}=y;b&&W(b,l),P()}function F(l){const{onFocus:b}=n,{nTriggerFormFocus:P}=y;b&&W(b,l),P()}function h(){U.value=!0}function I(){window.setTimeout(()=>{U.value=!1},0)}function S(l){var b,P,K;switch(l.key){case"Enter":if(!U.value){const G=(b=r.value)===null||b===void 0?void 0:b.getPendingTmNode();G&&(A(G.rawNode),l.preventDefault())}break;case"ArrowDown":(P=r.value)===null||P===void 0||P.next();break;case"ArrowUp":(K=r.value)===null||K===void 0||K.prev();break}}function A(l){(l==null?void 0:l.value)!==void 0&&(L(l.value),n.clearAfterSelect?D(null):l.label!==void 0&&D(n.append?`${C.value}${l.label}`:l.label),O.value=!1,n.blurAfterSelect&&ke())}function E(){D(null)}function ne(l){O.value=!0,F(l)}function Ce(l){O.value=!1,M(l)}function Ie(l){O.value=!0,D(l)}function xe(l){A(l.rawNode)}function Se(l){var b;!((b=e.value)===null||b===void 0)&&b.contains(Le(l))||(O.value=!1)}function ke(){var l,b;!((l=e.value)===null||l===void 0)&&l.contains(document.activeElement)&&((b=document.activeElement)===null||b===void 0||b.blur())}const ue=j(()=>{const{common:{cubicBezierEaseInOut:l},self:{menuBoxShadow:b}}=o.value;return{"--n-menu-box-shadow":b,"--n-bezier":l}}),J=t?he("auto-complete",void 0,ue,n):void 0,se=z(null),pe={focus:()=>{var l;(l=se.value)===null||l===void 0||l.focus()},blur:()=>{var l;(l=se.value)===null||l===void 0||l.blur()}};return{focus:pe.focus,blur:pe.blur,inputInstRef:se,uncontrolledValue:v,mergedValue:C,isMounted:Ee(),adjustedTo:oe(n),menuInstRef:r,triggerElRef:e,treeMate:g,mergedSize:m,mergedDisabled:p,active:N,mergedStatus:u,handleClear:E,handleFocus:ne,handleBlur:Ce,handleInput:Ie,handleToggle:xe,handleClickOutsideMenu:Se,handleCompositionStart:h,handleCompositionEnd:I,handleKeyDown:S,mergedTheme:o,cssVars:t?void 0:ue,themeClass:J==null?void 0:J.themeClass,onRender:J==null?void 0:J.onRender,mergedBordered:s,namespace:i,mergedClsPrefix:d}},render(){const{mergedClsPrefix:n}=this;return w("div",{class:`${n}-auto-complete`,ref:"triggerElRef",onKeydown:this.handleKeyDown,onCompositionstart:this.handleCompositionStart,onCompositionend:this.handleCompositionEnd},w(Fe,null,{default:()=>[w(Be,null,{default:()=>{const s=this.$slots.default;if(s)return ze("default",s,{handleInput:this.handleInput,handleFocus:this.handleFocus,handleBlur:this.handleBlur,value:this.mergedValue});const{mergedTheme:i}=this;return w(le,{ref:"inputInstRef",status:this.mergedStatus,theme:i.peers.Input,themeOverrides:i.peerOverrides.Input,bordered:this.mergedBordered,value:this.mergedValue,placeholder:this.placeholder,size:this.mergedSize,disabled:this.mergedDisabled,clearable:this.clearable,loading:this.loading,inputProps:this.inputProps,onClear:this.handleClear,onFocus:this.handleFocus,onUpdateValue:this.handleInput,onBlur:this.handleBlur},{suffix:()=>{var d,t;return(t=(d=this.$slots).suffix)===null||t===void 0?void 0:t.call(d)},prefix:()=>{var d,t;return(t=(d=this.$slots).prefix)===null||t===void 0?void 0:t.call(d)}})}}),w($e,{show:this.active,to:this.adjustedTo,containerClass:this.namespace,zIndex:this.zIndex,teleportDisabled:this.adjustedTo===oe.tdkey,placement:this.placement,width:"target"},{default:()=>w(Ae,{name:"fade-in-scale-up-transition",appear:this.isMounted},{default:()=>{var s;if((s=this.onRender)===null||s===void 0||s.call(this),!this.active)return null;const{menuProps:i}=this;return Pe(w(Ne,Object.assign({},i,{clsPrefix:n,ref:"menuInstRef",theme:this.mergedTheme.peers.InternalSelectMenu,themeOverrides:this.mergedTheme.peerOverrides.InternalSelectMenu,"auto-pending":!0,class:[`${n}-auto-complete-menu`,this.themeClass,i==null?void 0:i.class],style:[i==null?void 0:i.style,this.cssVars],treeMate:this.treeMate,multiple:!1,renderLabel:this.renderLabel,renderOption:this.renderOption,size:"medium",onToggle:this.handleToggle}),{empty:()=>{var d,t;return(t=(d=this.$slots).empty)===null||t===void 0?void 0:t.call(d)}}),[[Ue,this.handleClickOutsideMenu,void 0,{capture:!0}]])}})})]}))}}),Sa=Z("dynamic-tags",[Z("input",{minWidth:"var(--n-input-width)"})]),ka=Object.assign(Object.assign(Object.assign({},ee.props),Ye),{size:{type:String,default:"medium"},closable:{type:Boolean,default:!0},defaultValue:{type:Array,default:()=>[]},value:Array,inputClass:String,inputStyle:[String,Object],inputProps:Object,max:Number,tagClass:String,tagStyle:[String,Object],renderTag:Function,onCreate:{type:Function,default:n=>n},"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onChange:[Function,Array]}),Ra=Y({name:"DynamicTags",props:ka,slots:Object,setup(n){const{mergedClsPrefixRef:s,inlineThemeDisabled:i}=ve(n),{localeRef:d}=He("DynamicTags"),t=ge(n),{mergedDisabledRef:y}=t,m=z(""),p=z(!1),u=z(!0),e=z(null),r=ee("DynamicTags","-dynamic-tags",Sa,Je,n,s),v=z(n.defaultValue),T=_e(n,"value"),C=ye(T,v),O=j(()=>d.value.add),U=j(()=>ya(n.size)),o=j(()=>y.value||!!n.max&&C.value.length>=n.max);function x(h){const{onChange:I,"onUpdate:value":S,onUpdateValue:A}=n,{nTriggerFormInput:E,nTriggerFormChange:ne}=t;I&&W(I,h),A&&W(A,h),S&&W(S,h),v.value=h,E(),ne()}function $(h){const I=C.value.slice(0);I.splice(h,1),x(I)}function N(h){switch(h.key){case"Enter":g()}}function g(h){const I=h??m.value;if(I){const S=C.value.slice(0);S.push(n.onCreate(I)),x(S)}p.value=!1,u.value=!0,m.value=""}function D(){g()}function L(){p.value=!0,be(()=>{var h;(h=e.value)===null||h===void 0||h.focus(),u.value=!1})}const M=j(()=>{const{self:{inputWidth:h}}=r.value;return{"--n-input-width":h}}),F=i?he("dynamic-tags",void 0,M,n):void 0;return{mergedClsPrefix:s,inputInstRef:e,localizedAdd:O,inputSize:U,inputValue:m,showInput:p,inputForceFocused:u,mergedValue:C,mergedDisabled:y,triggerDisabled:o,handleInputKeyDown:N,handleAddClick:L,handleInputBlur:D,handleCloseClick:$,handleInputConfirm:g,mergedTheme:r,cssVars:i?void 0:M,themeClass:F==null?void 0:F.themeClass,onRender:F==null?void 0:F.onRender}},render(){const{mergedTheme:n,cssVars:s,mergedClsPrefix:i,onRender:d,renderTag:t}=this;return d==null||d(),w(We,{class:[`${i}-dynamic-tags`,this.themeClass],size:"small",style:s,theme:n.peers.Space,themeOverrides:n.peerOverrides.Space,itemStyle:"display: flex;"},{default:()=>{const{mergedTheme:y,tagClass:m,tagStyle:p,type:u,round:e,size:r,color:v,closable:T,mergedDisabled:C,showInput:O,inputValue:U,inputClass:o,inputStyle:x,inputSize:$,inputForceFocused:N,triggerDisabled:g,handleInputKeyDown:D,handleInputBlur:L,handleAddClick:M,handleCloseClick:F,handleInputConfirm:h,$slots:I}=this;return this.mergedValue.map((S,A)=>t?t(S,A):w(ae,{key:A,theme:y.peers.Tag,themeOverrides:y.peerOverrides.Tag,class:m,style:p,type:u,round:e,size:r,color:v,closable:T,disabled:C,onClose:()=>{F(A)}},{default:()=>typeof S=="string"?S:S.label})).concat(O?I.input?I.input({submit:h,deactivate:L}):w(le,Object.assign({placeholder:"",size:$,style:x,class:o,autosize:!0},this.inputProps,{ref:"inputInstRef",value:U,onUpdateValue:S=>{this.inputValue=S},theme:y.peers.Input,themeOverrides:y.peerOverrides.Input,onKeydown:D,onBlur:L,internalForceFocus:N})):I.trigger?I.trigger({activate:M,disabled:g}):w(X,{dashed:!0,disabled:g,theme:y.peers.Button,themeOverrides:y.peerOverrides.Button,size:$,onClick:M},{icon:()=>w(Ke,{clsPrefix:i},{default:()=>w(qe,null)})}))}})}}),Oa=Y({__name:"SearchInput",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(n){const s=Ge(),{t:i}=te(),d=Qe(n,"value"),t=z(),y=p=>{const u=Xe.find(e=>e.value===p.t);return w("div",{class:"flex gap-2"},[w("div",{},[w(ae,{size:"small",bordered:!1,color:{textColor:"#fff",color:(u==null?void 0:u.color)||"#2080f0"},class:"min-w-16 text-center inline-flex justify-center"},{default:()=>`${p.t}`})]),w("div",{class:"flex items-center gap-2 min-w-80"},[w("div",{class:"flex items-center gap-2"},[w("div",`${i("groupDetail.parameterManager.key")}:  `),w("div",{class:"font-bold"},p.full_key)])]),w("div",{class:"w-[600px]"},[w(ea,{style:"max-width: 700px"},{default:()=>`${i("groupDetail.parameterManager.value")}: ${p.v}`})])])},m=Ze(async p=>{var r;if(!p)return;const[u,e]=await _a({device_group_name:s.query.device_group_name,space_id:s.query.space_id,search_word:p});(u||(e==null?void 0:e.status)==0)&&(t.value=(r=e==null?void 0:e.data)==null?void 0:r.map(v=>({...v,label:v.full_key,value:v.full_key})))},100);return(p,u)=>{const e=xa;return _(),B(e,{value:d.value,"onUpdate:value":[u[0]||(u[0]=r=>d.value=r),a(m)],options:a(t),"render-label":y,class:"w-full",placeholder:a(i)("expInfo.keyTips")},null,8,["value","options","onUpdate:value","placeholder"])}}}),Va={key:0,class:"flex justify-between gap-2 script-form"},Fa={key:1,class:"flex items-baseline gap-2"},Ba=Y({__name:"ScriptForm",props:{sid:{},pid:{},formType:{}},setup(n){const s=n,i=aa(),{t:d}=te(),t=re(),{gates:y,layers:m}=ie(t),p=z(s.pid),u=j(()=>{if(!t.program)return"";const e=+t.program[s.formType][s.sid].layer;if(typeof e!="number")return"";const r=m.value[e];let v="";return r==null||r.some(T=>{const C=y.value?y.value[T]:{};if(t.program[s.formType][s.sid].entity&&(C!=null&&C.entity.includes(t.program[s.formType][s.sid].entity)))return v=C.gate_name,!0}),t.program[s.formType][s.sid].gate_name=v,v});return ta(p,e=>{if(t.program&&e){const r=t.program[s.formType][s.pid];delete t.program[s.formType][s.pid],t.program={...t.program,space_parameter_script:{...t.program.space_parameter_script||{},[e]:r}}}}),(e,r)=>{var $,N;const v=le,T=sa,C=ha,O=ae,U=oa,o=Ra,x=na;return a(t).program?(_(),B(x,{key:0,ref:"formRef",size:"small",disabled:!!((N=($=a(t))==null?void 0:$.expInfo)!=null&&N.exp_id),class:"!mb-4"},{default:f(()=>[e.formType==="waveform_script"?(_(),V("div",Va,[q("div",{class:"flex gap-2 border p-1 px-2 flex-1",style:Q({borderColor:a(i).dividerColor})},[c(T,{label:a(d)("expInfo.tEntity"),path:"entity",class:"w-16","feedback-class":"hidden"},{default:f(()=>[c(v,{value:a(t).program[e.formType][e.sid].entity,"onUpdate:value":r[0]||(r[0]=g=>a(t).program[e.formType][e.sid].entity=g)},null,8,["value"])]),_:1},8,["label"]),c(T,{label:a(d)("expInfo.tLayer"),path:"layer",class:"flex-1","feedback-class":"hidden"},{default:f(()=>[c(C,{class:"w-full",min:"0",value:a(t).program[e.formType][e.sid].layer,"onUpdate:value":r[1]||(r[1]=g=>a(t).program[e.formType][e.sid].layer=g)},null,8,["value"])]),_:1},8,["label"]),c(T,{label:a(d)("expInfo.gateName"),class:"w-20","feedback-class":"hidden"},{default:f(()=>[c(O,{type:"info",class:"w-full",bordered:!1},{default:f(()=>[H(R(a(u)),1)]),_:1})]),_:1},8,["label"])],4),q("div",{class:"flex items-center gap-2 border p-1 px-2 flex-1",style:Q({borderColor:a(i).dividerColor})},[c(T,{label:a(d)("expInfo.type"),path:"search_type",class:"w-32"},{default:f(()=>[c(U,{value:a(t).program[e.formType][e.sid].search_type,"onUpdate:value":r[2]||(r[2]=g=>a(t).program[e.formType][e.sid].search_type=g),options:[{label:"Wave Index",value:"ids"},{label:"Channel",value:"channel"},{label:"Wave Name",value:"name"}]},null,8,["value"])]),_:1},8,["label"]),a(t).program[e.formType][e.sid].search_type==="ids"?(_(),B(T,{key:0,label:a(d)("expInfo.tWaveIds"),path:"wave_ids",class:"flex-1"},{default:f(()=>[c(o,{value:a(t).program[e.formType][e.sid].wave_ids,"onUpdate:value":r[3]||(r[3]=g=>a(t).program[e.formType][e.sid].wave_ids=g)},null,8,["value"])]),_:1},8,["label"])):k("",!0),a(t).program[e.formType][e.sid].search_type==="channel"?(_(),B(T,{key:1,label:a(d)("expInfo.tChannels"),path:"channels",class:"flex-1"},{default:f(()=>[c(o,{value:a(t).program[e.formType][e.sid].channels,"onUpdate:value":r[4]||(r[4]=g=>a(t).program[e.formType][e.sid].channels=g)},null,8,["value"])]),_:1},8,["label"])):k("",!0),a(t).program[e.formType][e.sid].search_type==="name"?(_(),B(T,{key:2,label:a(d)("expInfo.waveName"),path:"wave_names",class:"flex-1"},{default:f(()=>[c(o,{value:a(t).program[e.formType][e.sid].wave_names,"onUpdate:value":r[5]||(r[5]=g=>a(t).program[e.formType][e.sid].wave_names=g)},null,8,["value"])]),_:1},8,["label"])):k("",!0)],4),q("div",{class:"flex items-center gap-2 border p-1 px-2 flex-1",style:Q({borderColor:a(i).dividerColor})},[c(T,{label:a(d)("expInfo.tParams"),path:"parameter",class:"flex-1"},{default:f(()=>[c(v,{value:a(t).program[e.formType][e.sid].parameter,"onUpdate:value":r[6]||(r[6]=g=>a(t).program[e.formType][e.sid].parameter=g)},null,8,["value"])]),_:1},8,["label"])],4)])):e.formType==="space_parameter_script"?(_(),V("div",Fa,[c(T,{label:a(d)("expInfo.spaceParamsKey"),class:"flex-1"},{default:f(()=>[c(Oa,{value:a(p),"onUpdate:value":r[7]||(r[7]=g=>ra(p)?p.value=g:null)},null,8,["value"])]),_:1},8,["label"])])):k("",!0)]),_:1},8,["disabled"])):k("",!0)}}}),za=Te(Ba,[["__scopeId","data-v-b2665375"]]),$a={class:"pr-5"},Aa={class:"flex justify-between items-center"},Pa={key:0,class:"flex item-center gap-2"},Ua={key:0},Na={key:0},Da={key:1},ja={key:2},Ma={key:1},Ea={key:1,class:"flex items-center gap-2"},La={class:"mt-2"},Wa=Y({__name:"ScriptView",props:{list:{}},setup(n){const s=re(),{program:i}=ie(s),{t:d}=te(),t=(m,p)=>{var u,e,r,v;if(!((u=s.expInfo)!=null&&u.exp_id)){if(m.type==="waveform_script")(r=(e=i.value)==null?void 0:e.waveform_script)==null||r.splice(p,1);else if(m.type==="space_parameter_script"){const T=JSON.parse(JSON.stringify((v=i.value)==null?void 0:v.space_parameter_script));delete T[m.position],i.value={...i.value,space_parameter_script:T}}}},y=(m,p,u,e)=>{p==="waveform_script"?m.script=u:p==="space_parameter_script"&&typeof e=="string"&&(m[e]=u)};return(m,p)=>{const u=ae,e=ca,r=X,v=Ta,T=ma,C=ua,O=fa,U=la;return _(),V("div",$a,[c(U,{"x-gap":12,"y-gap":12,cols:1},{default:f(()=>[(_(!0),V(de,null,ia(m.list,(o,x)=>(_(),B(O,{class:"rounded exp-program-card my-2",key:x},{default:f(()=>[c(C,{"show-icon":!1},{default:f(()=>{var $,N,g,D,L,M,F,h,I,S,A;return[q("div",Aa,[q("div",null,R(($=a(pa)[o.type])==null?void 0:$.label),1),(N=a(s).expInfo)!=null&&N.exp_id?(_(),V("div",Pa,[o.type==="waveform_script"?(_(),V("div",Ua,[c(u,{type:"success",bordered:!1,size:"small"},{default:f(()=>[H(R(o.gate_name)+" ("+R(o.entity)+" Layer"+R(o.layer)+") ",1)]),_:2},1024),p[0]||(p[0]=q("span",null," -> ",-1)),a(da)(o.wave_func_names)?(_(),B(u,{key:0,bordered:!1,color:{color:"#7816ff",textColor:"#fff"},size:"small"},{default:f(()=>[o.search_type==="channel"?(_(),V("span",Na," Channels "+R(o.channels||""),1)):k("",!0),o.search_type==="ids"?(_(),V("span",Da," Wave Index "+R(o.wave_ids||""),1)):k("",!0),o.search_type==="name"?(_(),V("span",ja," Wave Names "+R(o.wave_names||""),1)):k("",!0)]),_:2},1024)):(_(),B(u,{key:1,type:"warning",bordered:!1,size:"small"},{default:f(()=>[H(R(`${(o==null?void 0:o.wave_func_names)||""}`),1)]),_:2},1024)),p[1]||(p[1]=q("span",null," -> ",-1)),c(u,{type:"info",bordered:!1,size:"small"},{default:f(()=>[H(R(`${o.parameter}`),1)]),_:2},1024)])):o.type==="space_parameter_script"?(_(),V("div",Ma,R(o.position),1)):k("",!0),(g=a(s).expInfo)!=null&&g.exp_id?k("",!0):(_(),B(v,{key:2,onPositiveClick:()=>t(o,x)},{trigger:f(()=>[c(r,{type:"error",circle:"",size:"tiny"},{default:f(()=>[c(e,{component:a(me)},null,8,["component"])]),_:1})]),default:f(()=>[H(" "+R(a(d)("common.removeConfirm")),1)]),_:2},1032,["onPositiveClick"]))])):(_(),V("div",Ea,[c(ba,{disabled:!!((L=(D=a(s))==null?void 0:D.expInfo)!=null&&L.exp_id),classes:"min-w-24","onUpdate:value":E=>{o.type==="waveform_script"?y(a(s).program[o.type][x],o.type,E):o.type==="space_parameter_script"&&y(a(s).program[o.type],o.type,E,o.position)}},null,8,["disabled","onUpdate:value"]),(M=a(s).expInfo)!=null&&M.exp_id?k("",!0):(_(),B(v,{key:0,onPositiveClick:()=>t(o,x)},{trigger:f(()=>[c(r,{type:"error",circle:"",size:"tiny"},{default:f(()=>[c(e,{component:a(me)},null,8,["component"])]),_:1})]),default:f(()=>[H(" "+R(a(d)("common.removeConfirm")),1)]),_:2},1032,["onPositiveClick"]))]))]),c(T,{class:"!my-4"}),(F=a(s).expInfo)!=null&&F.exp_id?k("",!0):(_(),V(de,{key:0},[o.type==="waveform_script"||o.type==="space_parameter_script"&&typeof o.position=="string"?(_(),B(za,{key:0,"form-type":o.type,sid:x,pid:o.position||""},null,8,["form-type","sid","pid"])):k("",!0)],64)),q("div",La,[a(s).program[o.type]&&o.type==="waveform_script"?(_(),B(a(ce),{key:0,value:a(s).program[o.type][x].script,"onUpdate:value":E=>a(s).program[o.type][x].script=E,height:"100px",theme:"vs-dark",language:"python",options:{readOnly:!!((I=(h=a(s))==null?void 0:h.expInfo)!=null&&I.exp_id),scrollBeyondLastLine:!1,minimap:{enabled:!1}}},null,8,["value","onUpdate:value","options"])):k("",!0),(o.position||o.position==="")&&o.type==="space_parameter_script"&&a(s).program[o.type]?(_(),B(a(ce),{key:1,value:a(s).program[o.type][o.position],"onUpdate:value":E=>a(s).program[o.type][o.position]=E,height:"100px",theme:"vs-dark",language:"python",options:{readOnly:!!((A=(S=a(s))==null?void 0:S.expInfo)!=null&&A.exp_id),minimap:{enabled:!1}}},null,8,["value","onUpdate:value","options"])):k("",!0)])]}),_:2},1024)]),_:2},1024))),128))]),_:1})])}}}),Ka=Te(Wa,[["__scopeId","data-v-ba2bd56d"]]),qa={key:0,class:"flex items-center gap-2 mb-2"},rt=Y({__name:"ExpProgram",setup(n){const{t:s}=te(),i=re(),{program:d}=ie(i),t=m=>{var p;if(m==="waveform_script"){(p=i.program)==null||p.waveform_script.unshift({entity:"",layer:0,channels:[],wave_ids:[],wave_names:[],parameter:"",script:"",gate_name:"",search_type:void 0});const u=document.querySelector(".exp-program-wraper .n-scrollbar-container");u&&(u.scrollTop=0)}else if(m==="space_parameter_script"&&i.program){i.program.space_parameter_script?i.program.space_parameter_script[""]="":i.program.space_parameter_script={"":""};const u=document.querySelector(".exp-program-wraper .n-scrollbar-container");u&&be(()=>{setTimeout(()=>{var e,r,v;u.scrollTop=306.2*(((r=(e=i.program)==null?void 0:e.waveform_script)==null?void 0:r.length)||0)+Object.keys(((v=i.program)==null?void 0:v.space_parameter_script)||{}).length*297},200)})}},y=j(()=>{const{waveform_script:m,space_parameter_script:p}=d.value||{};let u=[];return m&&(u=u.concat(m==null?void 0:m.map(e=>({...e,type:"waveform_script"})))),p&&va(p,(e,r)=>{u.push({position:r,type:"space_parameter_script",script:e})}),u});return(m,p)=>{var u,e,r;return _(),V("div",null,[(e=(u=a(i))==null?void 0:u.expInfo)!=null&&e.exp_id?k("",!0):(_(),V("div",qa,[c(a(X),{type:"primary",onClick:p[0]||(p[0]=()=>t("waveform_script"))},{icon:f(()=>[c(a(fe))]),default:f(()=>[H(" "+R(a(s)("expInfo.addWaveformParameterScript")),1)]),_:1}),c(a(X),{type:"primary",onClick:p[1]||(p[1]=()=>t("space_parameter_script"))},{icon:f(()=>[c(a(fe))]),default:f(()=>[H(" "+R(a(s)("expInfo.addSpaceParameterScript")),1)]),_:1})])),c(a(ga),{"x-scrollable":"",style:Q({maxWidth:"calc(100vw - 212px)",maxHeight:`calc(100vh - ${(r=a(i).expInfo)!=null&&r.exp_id?"235":"275"}px)`}),class:"exp-program-wraper"},{default:f(()=>[c(Ka,{list:a(y)},null,8,["list"])]),_:1},8,["style"])])}}});export{rt as default};
