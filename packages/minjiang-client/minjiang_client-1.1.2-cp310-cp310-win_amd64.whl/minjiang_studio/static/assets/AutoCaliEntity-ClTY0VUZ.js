import{d as q,ab as b,ac as R,l as e,F as B,f as o,r as n,A as W,C as F,b as X,L as Z,o as ee,aR as te,aS as ae,e as C,h as T,i as c,ap as se,w as l,aN as ne,ad as U,al as M,s as oe,t as le,aa as $,S as ue,aO as ie,aw as O,Y as P,av as Y,aq as re,aM as ce,E as _e,bo as G,a6 as de,bv as pe}from"./index-DFmXBO_y.js";import{d as me,e as fe}from"./autoCali-CF4DUEBp.js";import{_ as ve,D as ge}from"./DotLoader-D-4E1ioi.js";import{u as ye}from"./autoCali-CN3COyCI.js";import{u as be}from"./groupDetail-BmkuIw6x.js";import"./Image-BVtUlqGI.js";import"./download-C2161hUv.js";const he=q({__name:"EntityLog",props:{logs:{}},setup(A){return(i,m)=>e(B)(i.logs)?R("",!0):(o(),b(ve,{key:0,logs:i.logs},null,8,["logs"]))}}),xe={class:"flex ml-5"},j=120,ke=q({__name:"EntitiesView",props:{entities:{}},setup(A){const i=n(!1),m=ye(),_=W(),f=F(),{t:w}=X(),r=n(),d=n(),a=n(0),t=n(!1),v=n(),E=A,h=Z(()=>{const u=E.entities.length;return Array(u<j?j:u).fill(0).map((s,y)=>E.entities[y])}),g=u=>{u&&(v.value||(v.value=!0,r.value=u,d.value=[],a.value=0,t.value=!0,x()))},x=async()=>{var y,L,k,I,V;if(!i.value||!r.value||!f.query.session_id)return;t.value=!0;const[u,s]=await me({session_id:+f.query.session_id,entity:r.value,last_record_id:a.value});v.value=!1,!u&&(s==null?void 0:s.status)===0&&(a.value!==((y=s.data)==null?void 0:y.last_record_id)&&((L=s.data)!=null&&L.last_record_id)&&(d.value=[...(k=s.data)==null?void 0:k.logs.reverse(),...d.value||[]]),(I=s.data)!=null&&I.last_record_id&&(a.value=(V=s.data)==null?void 0:V.last_record_id),_e(()=>{var D,z;((D=m.sessionInfo)==null?void 0:D.status)===G.RUNNING&&H(),((z=m.sessionInfo)==null?void 0:z.status)!==G.RUNNING&&(t.value=!1)}))},S=n(),H=()=>{S.value=setTimeout(()=>{x(),K()},3e3)},K=()=>{S.value&&(clearInterval(S.value),S.value=null)},N=n(0),J=u=>{N.value=u,r.value&&x()};return ee(()=>{i.value=!0,x()}),te(()=>{i.value=!0,x()}),ae(()=>{i.value=!1,K()}),(u,s)=>{const y=ie,L=ne,k=se,I=re,V=ce,D=Y,z=O;return o(),C("div",xe,[T("div",null,[c(k,{style:{height:"calc(100vh - 310px)"}},{default:l(()=>[c(L,{cols:10,style:{width:"560px"}},{default:l(()=>[(o(!0),C(U,null,M(e(h),(p,Q)=>(o(),b(y,{key:Q,class:ue(["border min-w-14 min-h-14 flex items-center justify-center p-1",[p?"cursor-pointer":""]]),style:$({borderColor:e(_).dividerColor,backgroundColor:e(r)===p&&e(r)?"#00B42A":"inherit",color:e(r)===p?"#fff":"inherit"}),onClick:()=>g(p)},{default:l(()=>[oe(le(p),1)]),_:2},1032,["style","class","onClick"]))),128))]),_:1})]),_:1})]),c(z,{animated:"",class:"!h-full flex-1 !w-auto ml-8",value:e(N),"onUpdate:value":s[0]||(s[0]=p=>P(N)?N.value=p:null),onUpdateValue:J},{suffix:l(()=>[e(t)?(o(),b(ge,{key:0})):R("",!0)]),default:l(()=>[c(D,{name:0,key:"0",tab:e(w)("groupDetail.autoCali.caliLog"),class:"!pl-0","display-directive":"show:lazy"},{default:l(()=>[c(k,{style:$({padding:"15px",height:"calc(100vh - 345px)",backgroundColor:e(_).baseColor})},{default:l(()=>[e(v)?(o(),b(I,{key:0})):(o(),C(U,{key:1},[c(he,{logs:e(d)},null,8,["logs"]),e(B)(e(d))?(o(),b(V,{key:0,class:"mt-32"})):R("",!0)],64))]),_:1},8,["style"])]),_:1},8,["tab"])]),_:1},8,["value"])])}}}),Ve=q({__name:"AutoCaliEntity",setup(A){const i=be(),m=F(),_=n(),f=n(),w=n(),r=async()=>{const[a,t]=await fe({device_group_name:m.query.device_group_name,space_id:+m.query.space_id});!a&&(t==null?void 0:t.status)===0&&(f.value=t.data,_.value=Object.keys(t.data)[0])},d=()=>{};return de(()=>{var a;return(a=i.groupInfo)==null?void 0:a.organization_id},a=>{a&&a!==w.value&&(w.value=a,r())},{immediate:!0}),(a,t)=>{const v=Y,E=O;return o(),C("div",null,[c(E,{type:"card",animated:"",size:"small",placement:"left",class:"!h-full !w-auto",value:e(_),"onUpdate:value":t[0]||(t[0]=h=>P(_)?_.value=h:null),onUpdateValue:d,"tab-class":"w-[128px]"},pe({suffix:l(()=>[t[2]||(t[2]=T("div",null,null,-1))]),default:l(()=>[(o(!0),C(U,null,M(e(f),(h,g)=>(o(),b(v,{name:g,key:g,tab:g},{default:l(()=>[c(ke,{"active-key":g,entities:h},null,8,["active-key","entities"])]),_:2},1032,["name","tab"]))),128))]),_:2},[e(B)(e(f))?void 0:{name:"prefix",fn:l(()=>[t[1]||(t[1]=T("div",null,null,-1))]),key:"0"}]),1032,["value"])])}}});export{Ve as default};
