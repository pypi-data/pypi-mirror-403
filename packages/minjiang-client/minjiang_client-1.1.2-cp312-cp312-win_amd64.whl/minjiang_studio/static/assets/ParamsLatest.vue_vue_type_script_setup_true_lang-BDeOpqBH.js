import{d as L,e as T,f as v,h as w,bU as Q,bV as ge,i as r,w as c,ad as ke,al as xe,ab as F,bs as oe,s as le,ac as H,t as K,B,l,aw as re,a5 as be,C as ie,b as ce,a9 as Ce,K as we,r as h,I as s,N as U,ag as D,bW as Re,as as Ie,aE as ee,a6 as ae,am as de,Y as Me,U as ze,W as Oe,Z as Be,F as se,bX as ne,bY as Te,o as $e,aR as Le}from"./index-DFmXBO_y.js";import{r as Ve,a as qe}from"./params-D6o1SVqb.js";import{m as Se}from"./exp-DjOP_yTH.js";import{H as Ne,_ as je,a as Ee,S as Fe,R as He}from"./SpaceTools-D6Hw2j6z.js";import{c as te}from"./index-DcQUyUKO.js";import{_ as Ue}from"./Popconfirm-CM6f1Ujm.js";import{_ as Pe}from"./DataTable-3tY_BIOA.js";const Ae={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},P=L({name:"RefreshCircle",render:function(I,t){return v(),T("svg",Ae,t[0]||(t[0]=[w("path",{d:"M256 48C141.31 48 48 141.32 48 256c0 114.86 93.14 208 208 208c114.69 0 208-93.31 208-208c0-114.87-93.13-208-208-208zm0 313a94 94 0 0 1 0-188h4.21l-14.11-14.1a14 14 0 0 1 19.8-19.8l40 40a14 14 0 0 1 0 19.8l-40 40a14 14 0 0 1-19.8-19.8l18-18c-2.38-.1-5.1-.1-8.1-.1a66 66 0 1 0 66 66a14 14 0 0 1 28 0a94.11 94.11 0 0 1-94 94z",fill:"currentColor"},null,-1)]))}}),Ke={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 16 16"},A=L({name:"AddCircle16Filled",render:function(I,t){return v(),T("svg",Ke,t[0]||(t[0]=[w("g",{fill:"none"},[w("path",{d:"M2 8a6 6 0 1 1 12 0A6 6 0 0 1 2 8zm6-3a.5.5 0 0 0-.5.5v2h-2a.5.5 0 0 0 0 1h2v2a.5.5 0 0 0 1 0v-2h2a.5.5 0 0 0 0-1h-2v-2A.5.5 0 0 0 8 5z",fill:"currentColor"})],-1)]))}}),Je={class:"flex justify-between items-center gap-2"},We={key:0},Ye={key:0,class:"flex justify-center w-full"},Xe=L({__name:"CategoryTabs",props:Q({readOnly:{type:Boolean},tabs:{}},{modelValue:{},modelModifiers:{}}),emits:Q(["insert","refresh"],["update:modelValue"]),setup(R,{emit:I}){const t=I,b=ge(R,"modelValue"),i=(m="")=>{t("insert",{full_key:m})},M=()=>{t("refresh")};return(m,C)=>{const d=B,g=oe,_=re;return v(),T("div",null,[r(_,{type:"card",placement:"left",value:b.value,"onUpdate:value":C[1]||(C[1]=f=>b.value=f),class:"tabs",style:{"max-height":"calc(100vh - 340px)"}},{suffix:c(()=>[m.readOnly?H("",!0):(v(),T("div",Ye,[r(d,{type:"info",quaternary:"",onClick:C[0]||(C[0]=()=>i()),size:"small"},{icon:c(()=>[r(l(A))]),_:1}),r(d,{type:"info",quaternary:"",onClick:M,size:"small"},{icon:c(()=>[r(l(P))]),_:1})]))]),default:c(()=>[(v(!0),T(ke,null,xe(m.tabs,(f,z)=>(v(),F(g,{name:f.node_name,class:"!flex-1 w-full",key:z},{default:c(()=>[w("div",Je,[le(K(f.node_name)+" ",1),m.readOnly?H("",!0):(v(),T("div",We,[r(d,{type:"info",quaternary:"",onClick:()=>i(f.full_key),size:"small"},{icon:c(()=>[r(l(A))]),_:2},1032,["onClick"]),r(d,{type:"info",quaternary:"",onClick:M,size:"small"},{icon:c(()=>[r(l(P))]),_:1})]))])]),_:2},1032,["name"]))),128))]),_:1},8,["value"])])}}}),Ze=be(Xe,[["__scopeId","data-v-6fd4e427"]]),Ge={class:"flex gap-2 items-center"},Qe={class:"flex gap-5"},De=L({__name:"ParamsLatest",props:{spaceId:{},maxHeight:{},readOnly:{type:Boolean},version:{}},setup(R,{expose:I}){const t=R,b=ie(),{t:i}=ce(),{copy:M,isSupported:m}=Ce({legacy:!0}),C=we(),d=h(),g=h(!1),_=h(),f=h(),z=h({show:!1,info:void 0}),V=h(),q=h(),ue=()=>{z.value={show:!1,info:void 0}},$=h(),J=e=>{M(e),C.success(i("common.copied"))},W=e=>{var a;(a=V.value)==null||a.open(),q.value={...e,type:"add"}},pe=e=>{var a,n;(a=V.value)==null||a.open(),(n=V.value)==null||n.setFormValue({types:e.t,keys:e.node_name,values:e.v}),q.value={...e,type:"edit"}},S=(e,a,n)=>{const u=JSON.parse(JSON.stringify(f.value));let x=!1;const O=(o,N)=>{ne(o,(p,j)=>{var y;if(x)return!1;if(p.full_key===e){switch(a){case"rchildren":delete p.children;break;case"rself":(y=N.children)==null||y.splice(j,1);break;case"update":n&&(p.children=n);break;case"insert":p.children=n}return x=!0,!1}p.children&&O(p.children,p)})};O(u,{children:u}),f.value=u},fe=async e=>{const[a,n]=await Ve({key:e.full_key,device_group_name:b.query.device_group_name,space_id:t.spaceId});!a&&(n==null?void 0:n.status)===0&&S(e.full_key,"rself")},Y=(e,a)=>{var n;k(e,void 0,a!==void 0?a:((n=q.value)==null?void 0:n.type)==="add")},me=e=>{z.value={show:!0,info:e}},_e=()=>{k([_.value])},ye=e=>{k(e.full_key.split("/"));const a=($.value||[]).concat(e.full_key);$.value=[...new Set(a)]},X=[{title:i("groupDetail.parameterManager.key"),key:"node_name",render:e=>e.expandable?s("div",{class:"inline-flex items-center gap-1"},te([s("span",e.node_name),t.readOnly?null:s(B,{quaternary:!0,type:"info",size:"small",onClick:()=>W(e)},{icon:()=>s(A)}),t.readOnly?null:s(B,{quaternary:!0,type:"info",size:"small",onClick:()=>ye(e)},{icon:()=>s(P)})])):s("div",{class:"inline-flex gap-2"},[s("div",e.node_name),m.value?s(U,{class:"cursor-pointer transition-transform hover:translate-y-[1px]",size:20,onClick:()=>J(e.full_key)},{default:()=>s(D)}):void 0])},{title:i("groupDetail.parameterManager.dataType"),key:"t",width:100,render:e=>{if(e.expandable)return;const a=Re.find(n=>n.value===e.t);return s(Ie,{size:"small",bordered:!1,color:{textColor:"#fff",color:(a==null?void 0:a.color)||"#2080f0"},class:"min-w-16 text-center inline-flex justify-center"},{default:()=>e.t})}},{title:i("groupDetail.parameterManager.value"),key:"v",render:e=>e.expandable?e.v:s("div",{class:"flex gap-2"},[s(ee,{tooltip:{show:!1}},{default:()=>e.v}),m.value?s(U,{class:"cursor-pointer transition-transform hover:translate-y-[1px]",size:20,onClick:()=>J(e.v)},{default:()=>s(D)}):void 0])},{title:i("groupDetail.parameterManager.paramsDesc"),key:"desc",render:e=>e.expandable?e.v:s("div",{class:"flex gap-2"},[s(ee,{class:"opacity-80"},{default:()=>e.desc})])}];t.readOnly||X.push({title:i("groupDetail.parameterManager.options"),key:"options",width:180,align:"center",render:e=>{if(!(e!=null&&e.isLeaf))return;const a={quaternary:!0,type:"info",size:"small"},n=s(B,{...a,onClick:()=>{pe(e)}},{default:()=>i("groupDetail.parameterManager.optionEdit")}),u=s(B,{...a,onClick:()=>me(e)},{default:()=>i("groupDetail.parameterManager.optionHistory")}),x=s(Ue,{onPositiveClick:()=>fe(e)},{default:()=>i("groupDetail.parameterManager.removeConfirm"),icon:()=>s(U,{color:"#e88080",size:22},{default:()=>s(Ne)}),trigger:()=>s(B,{...a,type:"error"},{default:()=>i("groupDetail.parameterManager.optionRemove")})});return s("div",{class:"flex justify-end"},[n,u,x])}});const k=async(e=[],a,n)=>{var x;if(!t.spaceId||g.value||!b.query.device_group_name)return;g.value=!0;const u=te(e);try{const[O,o]=await qe({device_group_name:b.query.device_group_name,space_id:t.spaceId,parent_tree:u,version:t.version});if(g.value=!1,O||(o==null?void 0:o.status)!==0)return;if(u.length===0){d.value=o.data,o.data&&o.data.length>0&&k([o.data[0].node_name]),se(o.data)&&(f.value=[]);return}const N="/"+u.join("/"),p=o.data.map(y=>({...y,isLeaf:!y.expandable})),j=(x=p.filter(y=>y.isLeaf))==null?void 0:x.map(y=>y.full_key);if(!se(j)){const[y,E]=await Se({full_key_list:j.join(","),language:localStorage.getItem("lang")||"en"});!y&&(E==null?void 0:E.status)===0&&ne(p,Z=>{const G=E.data[Z.full_key];G&&(Z.desc=G)})}if(a)return a.resolve(),p;u.length===1?f.value=p:n?S(N,"insert",p):S(N,"update",p)}catch{a&&a.reject(),g.value=!1}},ve=e=>new Promise(async(a,n)=>{const u=await k(e.full_key.split("/"),{resolve:a,reject:n});e.children=u}),he=e=>{const[a]=Te($.value,e);a&&S(a,"rchildren"),$.value=e};return ae(()=>t.spaceId,e=>{e&&k()},{immediate:!0}),ae(_,e=>{e&&($.value=[],f.value=[],k([e]))}),I({refresh:k,refreshCurTab:()=>k(_.value?[_.value]:void 0)}),(e,a)=>{const n=oe,u=re,x=Pe,O=Be;return v(),T("div",null,[r(u,{value:"globalOverview",class:"!h-full mb-5",disabled:l(g)},{suffix:c(()=>[de(e.$slots,"default")]),default:c(()=>[r(n,{name:"globalOverview"},{default:c(()=>[w("div",Ge,K(l(i)("groupDetail.parameterManager.globalLatest")),1)]),_:1})]),_:3},8,["disabled"]),w("div",Qe,[l(d)?(v(),F(Ze,{key:0,tabs:l(d),modelValue:l(_),"onUpdate:modelValue":a[0]||(a[0]=o=>Me(_)?_.value=o:null),onInsert:W,onRefresh:_e,"read-only":e.readOnly},null,8,["tabs","modelValue","read-only"])):H("",!0),r(x,{size:"small","max-height":e.maxHeight?e.maxHeight:"calc(100vh - 265px)",columns:X,data:l(f),loading:l(g),"row-key":o=>o.full_key,"expanded-row-keys":l($),onLoad:ve,onUpdateExpandedRowKeys:he},null,8,["max-height","data","loading","row-key","expanded-row-keys"]),e.spaceId?(v(),F(je,{key:1,info:l(q),ref_key:"actionInfoRef",ref:V,"space-id":e.spaceId,"onUpdate:success":Y},null,8,["info","space-id"])):H("",!0),r(O,{show:l(z).show,"onUpdate:show":a[1]||(a[1]=o=>l(z).show=o),"auto-focus":!1},{default:c(()=>[r(ze,{style:{"min-height":"400px",overflow:"auto",width:"1300px","min-width":"500px"}},{default:c(()=>[r(Oe,null,{default:c(()=>{var o;return[r(Ee,{"max-height":"auto","space-id":e.spaceId,hkey:(o=l(z).info)==null?void 0:o.full_key,"hide-history-option":"","onUpdate:success":Y,"onClose:modal":ue,"show-footer":""},null,8,["space-id","hkey"])]}),_:1})]),_:1})]),_:1},8,["show"])])])}}}),ea={class:"flex items-center flex-1 justify-between"},aa={class:"flex items-center"},ca=L({__name:"ParamsLatest",props:{canRefresh:{type:Boolean},hideInit:{type:Boolean}},setup(R){const I=R,t=h(),{t:b}=ce(),i=ie(),M=h(),m=()=>{M.value=i.query.space_id};$e(()=>{m()}),Le(()=>{m()});const C=()=>{var d;I.canRefresh&&((d=t.value)==null||d.refreshCurTab())};return(d,g)=>{const _=B;return v(),F(De,{"space-id":+l(M),ref_key:"paramsLatestRef",ref:t},{default:c(()=>[w("div",ea,[de(d.$slots,"default"),w("div",aa,[r(Fe,{"hide-init":""}),r(_,{type:"primary",disabled:!d.canRefresh,class:"!ml-2",onClick:C},{icon:c(()=>[r(l(He))]),default:c(()=>[le(" "+K(l(b)("groupDetail.parameterManager.refresh")),1)]),_:1},8,["disabled"])])])]),_:3},8,["space-id"])}}});export{ca as _,De as a};
