import{C as X}from"./CommingSoon-DLYSBCEt.js";import{d as O,e as m,f as r,h as y,r as i,A as Y,b as Z,C as ee,L as te,aR as ae,aS as se,a6 as oe,F as z,E as M,i as v,w as C,ad as $,al as le,l as e,ac as D,aa as K,t as R,as as re,aT as x,s as A,j as ne,N as ie,ap as ce,ab as V}from"./index-DJskbzIk.js";import{b as ue,c as de}from"./autoCali-68qq9UhF.js";import{D as _e,_ as fe}from"./DotLoader-SCL2PmPW.js";import"./Image-CjHsT37c.js";import"./download-C2161hUv.js";const ve={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},me=O({name:"ChevronDown",render:function(N,k){return r(),m("svg",ve,k[0]||(k[0]=[y("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 184l144 144l144-144"},null,-1)]))}}),pe={class:"flex p-5 pb-0"},he=["onClick"],ge={class:"flex-1 break-all"},xe={key:0,class:"flex items-center justify-between pt-2"},ye={class:"flex flex-1 items-center flex-col"},Ne={key:0,class:"flex gap-2 items-center mb-5 text-lg"},Be=O({__name:"AutoCaliProcess",setup(H){const N=i(!1),k=Y(),{t:L}=Z(),_=ee(),I=i(),l=i(),n=te(()=>{var o;return(o=I.value)==null?void 0:o.find(s=>s.node_id===l.value)}),p=i(!0),c=i(),T=i(!1),h=i(0),S=async o=>{var f,g,d,a,B,G,P,U;if(!N.value||!l.value||!_.query.session_id)return;p.value=!0;const s={node_id:l.value,session_id:+_.query.session_id,last_record_id:h.value},[u,t]=await ue(s);T.value=!1,!u&&(t==null?void 0:t.status)===0?((g=(f=t.data)==null?void 0:f.logs)==null?void 0:g.find(j=>{if(typeof j.msg=="string")return j.msg.includes("COMPLETE")}))?(F(),p.value=!1,h.value!==t.data.last_record_id&&t.data.last_record_id&&(c.value=[...(d=t.data)==null?void 0:d.logs.reverse(),...c.value||[]]),t.data.last_record_id&&(h.value=t.data.last_record_id),((a=n.value)==null?void 0:a.status)==="RUNNING"&&q()):(h.value!==t.data.last_record_id&&t.data.last_record_id&&(c.value=[...(B=t.data)==null?void 0:B.logs.reverse(),...c.value||[]]),t.data.last_record_id&&(h.value=t.data.last_record_id),((G=n.value)==null?void 0:G.status)==="RUNNING"&&(J(),p.value=!0),((P=n.value)==null?void 0:P.status)!=="RUNNING"&&!o&&w.value&&(F(),S(!0)),((U=n.value)==null?void 0:U.status)!=="RUNNING"&&(p.value=!1)):p.value=!1},q=async()=>{var u,t,f;if(!N.value||!_.query.session_id)return;const[o,s]=await de({session_id:+_.query.session_id});!o&&(s==null?void 0:s.status)===0&&(I.value=s.data,!((u=s.data)!=null&&u.find(d=>d.node_id===l.value))&&s.data&&s.data.length>0&&(l.value=(t=s.data[0])==null?void 0:t.node_id),(f=s.data)!=null&&f.find(d=>d.status==="RUNNING")||E())},w=i(),F=()=>{w.value&&(clearTimeout(w.value),w.value=null)},J=()=>{w.value=setTimeout(()=>{S()},10*1e3)},b=i(),E=()=>{b.value&&(clearInterval(b.value),b.value=null)},Q=()=>{b.value=setInterval(()=>{q()},10*1e3)};ae(()=>{_.name==="autoCaliProcess"&&(_.query.node_id&&(l.value=+_.query.node_id),N.value=!0,M(()=>{b.value||(q(),Q())}))}),se(()=>{N.value=!1,E(),F()}),oe(n,o=>{z(o)||M(()=>{S()})});const W=o=>{T.value||(T.value=!0,c.value=void 0,l.value=o,h.value=0)};return(o,s)=>{const u=re,t=ne,f=ie,g=ce,d=X;return r(),m("div",pe,[y("div",null,[v(g,{style:{height:"calc(100vh - 260px)","padding-right":"40px"}},{default:C(()=>[(r(!0),m($,null,le(e(I),(a,B)=>(r(),m("div",{key:a.node_id,class:"cursor-pointer"},[y("div",{class:"px-2 pb-2 pt-2.5 w-full max-w-96 border text-center min-w-72 flex items-center",style:K({borderTopLeftRadius:"40px",borderBottomLeftRadius:"40px",borderTopRightRadius:"100px",borderBottomRightRadius:"100px",backgroundColor:e(l)===a.node_id?"rgba(0, 180, 42, 0.15)":"inherit",borderColor:e(l)===a.node_id?"rgb(0, 180, 42)":"#999A9B",color:e(l)===a.node_id?e(k).primaryColor:"inherit"}),onClick:()=>W(a.node_id)},[y("span",ge,R(a.node_name),1),v(u,{size:"tiny",round:"",class:"!h-[22.4px] !rounded-full !w-20 !flex !items-center !justify-center",color:{color:e(x)[a.status].color}},{default:C(()=>[A(R(e(L)(e(x)[a.status].text)),1)]),_:2},1032,["color"])],12,he),B<e(I).length-1?(r(),m("div",xe,[y("div",ye,[v(t,{class:"!h-10 !bg-[#999A9B]",vertical:""}),v(f,{class:"-mt-2",color:"#999A9B",component:e(me)},null,8,["component"])]),v(u,{size:"tiny",round:"",class:"!h-[22.4px] !rounded-full invisible !w-20",color:{color:e(x)[a.status].color}},{default:C(()=>[A(R(e(L)(e(x)[a.status].text)),1)]),_:2},1032,["color"])])):D("",!0)]))),128))]),_:1})]),y("div",{class:"border-l pl-10 flex-1",style:K({borderColor:e(k).dividerColor})},[v(g,{style:{height:"calc(100vh - 260px)"}},{default:C(()=>{var a;return[e(z)(e(n))?D("",!0):(r(),m("div",Ne,[A(R((a=e(n))==null?void 0:a.node_name)+" ",1),v(u,{size:"tiny",color:{color:e(x)[e(n).status].color}},{default:C(()=>[A(R(e(L)(e(x)[e(n).status].text)),1)]),_:1},8,["color"]),e(p)?(r(),V(_e,{key:0})):D("",!0)])),Array.isArray(e(c))&&e(c).length===0?(r(),V(d,{key:1,class:"h-full"})):(r(),m($,{key:2},[e(T)?D("",!0):(r(),V(fe,{key:0,logs:e(c)},null,8,["logs"]))],64))]}),_:1})],4)])}}});export{Be as default};
