import{d as X,J as W,C as Y,A as Z,b as ee,r as f,a6 as q,E as B,L as R,I as te,e as A,f as _,ab as x,ac as D,i as v,l as a,F as ae,aw as se,Y as F,w as u,am as M,h as E,B as ne,s as P,t as T,ad as J,al as oe,bs as le,aq as re,a5 as ie,o as ue,aR as ce}from"./index-DFmXBO_y.js";import{g as pe}from"./params-D6o1SVqb.js";import{m as de,s as fe,R as K,_ as me,S as _e}from"./SpaceTools-D6Hw2j6z.js";import{_ as ve}from"./DataTable-3tY_BIOA.js";import"./exp-DjOP_yTH.js";import"./groupDetail-BmkuIw6x.js";import"./json-editor-vue-jX9aR6ea.js";import"./index-DcQUyUKO.js";import"./PaginationView.vue_vue_type_script_setup_true_lang-Dpz9kG-N.js";import"./Pagination-CEcbaPkb.js";import"./prop-NnGblK-3.js";import"./Popconfirm-CM6f1Ujm.js";import"./Switch-CQ9ZKs-S.js";import"./DynamicForm-DoNpBqAS.js";import"./index-B6_I1O0p.js";import"./InputNumber-DfgLr1Gf.js";import"./Checkbox-1HN6lbh2.js";import"./RadioGroup-CoMSa7Uc.js";import"./FileSaver.min-Srb1YCdv.js";import"./download-C2161hUv.js";const ye={class:"flex justify-end w-full ml-2"},ge={class:"flex justify-end w-full ml-2"},he={class:"flex gap-2 items-center"},be=X({__name:"ParamsOverview",props:{spaceId:{}},setup(N,{expose:k}){W(e=>({ded81f12:a(O).primaryColor}));const h=N,I=Y(),O=Z(),{t:w}=ee(),y=f(!1),r=f(),U=()=>{},V=f(!1),d=f(),g=async e=>{if(y.value)return;y.value=!0;const[t,s]=await pe({device_group_name:I.query.device_group_name,space_id:h.spaceId,entity_type:r.value});y.value=!1,!t&&(s==null?void 0:s.status)===0&&(d.value=s.data,r.value||(V.value=!0,r.value=s.data.entity_types[0]),e&&B(()=>{setTimeout(()=>{C.value&&L(C.value[b.value.rowIdx],b.value.key)},300)}))};q(()=>h.spaceId,e=>{e&&g()},{immediate:!0}),q(r,e=>{if(V.value){V.value=!1;return}e&&B(()=>{g()})});const S=f(),j=f(),b=f(),z=e=>{const t=e.lastIndexOf("/");return t<0?e:e.slice(t+1)},L=(e,t)=>{var c,p,o;const s=(c=d.value)==null?void 0:c.key_map[t].replace(/\%entity\%/g,e.entities);(p=S.value)==null||p.open();const n=e[t];let i="";typeof n=="number"?i=Number.isInteger(n)?"int":"float":typeof n=="boolean"&&(i="bool"),(o=S.value)==null||o.setFormValue({types:i,keys:z(s),values:String(e[t])}),j.value={full_key:s,type:"edit"}},G=(e,t,s)=>{b.value={row:e,key:t,rowIdx:s},B(()=>{L(b.value.row,b.value.key)})},$=R(()=>{var t,s;const e=((s=(t=d.value)==null?void 0:t.titles)==null?void 0:s.map((n,i)=>{var p;const c=de(Object.keys(((p=d.value)==null?void 0:p.data)||{}).map(o=>{var l;return(l=d.value)==null?void 0:l.data[o][i]}).concat(n),o=>String(o).length);return{title:n,key:n,width:String(c).length*9+35,render(o,l){const m=o[n];return typeof m=="number"?te("div",{onClick:()=>G(o,n,l),class:"cursor-pointer"},m):String(m)}}}))||[];return e&&e.unshift({title:"Entities",key:"entities",width:100,fixed:"left"}),e}),H=R(()=>fe($.value.map(e=>e.width))),C=R(()=>{const{entities:e,titles:t=[],data:s={}}=d.value||{};return e==null?void 0:e.map(n=>{var c;const i={entities:n};return(c=s[n])==null||c.forEach((p,o)=>{const l=t[o];l&&(i[l]=p)}),i})}),Q=()=>{g()};return k({refresh:g}),(e,t)=>{var o;const s=ne,n=se,i=le,c=ve,p=re;return _(),A(J,null,[a(ae)((o=a(d))==null?void 0:o.entity_types)?(_(),x(n,{key:0,onUpdateValue:U,value:a(r),"onUpdate:value":t[1]||(t[1]=l=>F(r)?r.value=l:null),class:"!h-full",disabled:a(y)},{suffix:u(()=>[M(e.$slots,"default",{},void 0,!0),E("div",ye,[v(s,{type:"primary",onClick:t[0]||(t[0]=()=>g())},{icon:u(()=>[v(a(K))]),default:u(()=>[P(" "+T(a(w)("groupDetail.parameterManager.refresh")),1)]),_:1})])]),_:3},8,["value","disabled"])):a(r)?(_(),x(n,{key:1,onUpdateValue:U,value:a(r),"onUpdate:value":t[3]||(t[3]=l=>F(r)?r.value=l:null),class:"!h-full",disabled:a(y)},{suffix:u(()=>[M(e.$slots,"default",{},void 0,!0),E("div",ge,[v(s,{type:"primary",onClick:t[2]||(t[2]=()=>g())},{icon:u(()=>[v(a(K))]),default:u(()=>[P(" "+T(a(w)("groupDetail.parameterManager.refresh")),1)]),_:1})])]),default:u(()=>{var l;return[(_(!0),A(J,null,oe((l=a(d))==null?void 0:l.entity_types,m=>(_(),x(i,{name:m,key:m},{default:u(()=>[E("div",he,T(m),1)]),_:2},1032,["name"]))),128))]}),_:3},8,["value","disabled"])):D("",!0),v(p,{show:a(y)},{default:u(()=>[v(c,{bordered:"","max-height":"calc(100vh - 400px)","scroll-x":a(H),"single-line":!1,columns:a($),data:a(C),class:"mt-5"},null,8,["scroll-x","columns","data"])]),_:1},8,["show"]),e.spaceId?(_(),x(me,{key:2,info:a(j),"space-id":e.spaceId,"show-history-entry":"",ref_key:"actionInfoRef",ref:S,"onUpdate:success":Q},null,8,["info","space-id"])):D("",!0)],64)}}}),xe=ie(be,[["__scopeId","data-v-4635c6c3"]]),Me=X({__name:"ParamsOverview",setup(N){const k=Y(),h=f(),I=()=>{h.value=k.query.space_id};return ue(()=>{I()}),ce(()=>{I()}),(O,w)=>(_(),x(xe,{"space-id":+a(h)},{default:u(()=>[v(_e)]),_:1},8,["space-id"]))}});export{Me as default};
