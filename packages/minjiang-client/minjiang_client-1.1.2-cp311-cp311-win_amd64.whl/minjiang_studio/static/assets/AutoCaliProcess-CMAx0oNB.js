import{C as W}from"./CommingSoon-iAldXEWC.js";import{d as K,e as m,f as l,h as y,r as i,A as X,b as Y,C as Z,L as ee,o as te,E as q,aR as ae,aS as se,a6 as oe,F as M,i as p,w as C,ad as P,al as re,l as e,ac as A,aa as $,t as R,as as le,aT as x,s as L,j as ne,N as ie,ap as ce,ab as V}from"./index-DFmXBO_y.js";import{b as de,c as ue}from"./autoCali-CF4DUEBp.js";import{D as _e,_ as fe}from"./DotLoader-D-4E1ioi.js";import"./Image-BVtUlqGI.js";import"./download-C2161hUv.js";const ve={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},pe=K({name:"ChevronDown",render:function(N,k){return l(),m("svg",ve,k[0]||(k[0]=[y("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 184l144 144l144-144"},null,-1)]))}}),me={class:"flex p-5 pb-0"},he=["onClick"],ge={class:"flex-1 break-all"},xe={key:0,class:"flex items-center justify-between pt-2"},ye={class:"flex flex-1 items-center flex-col"},Ne={key:0,class:"flex gap-2 items-center mb-5 text-lg"},Be=K({__name:"AutoCaliProcess",setup(O){const N=i(!1),k=X(),{t:S}=Y(),c=Z(),I=i(),o=i(),n=ee(()=>{var r;return(r=I.value)==null?void 0:r.find(s=>s.node_id===o.value)}),w=i(!0),d=i(),T=i(!1),h=i(0),b=async()=>{var f,v,g,u,a,D,U,j;if(!N.value||!o.value||!c.query.session_id)return;w.value=!0;const r={node_id:o.value,session_id:+c.query.session_id,last_record_id:h.value},[s,t]=await de(r);T.value=!1,!s&&(t==null?void 0:t.status)===0&&(((v=(f=t.data)==null?void 0:f.logs)==null?void 0:v.find(z=>{if(typeof z.msg=="string")return z.msg.includes("COMPLETE")}))?(stop(),w.value=!1,h.value!==t.data.last_record_id&&t.data.last_record_id&&(d.value=[...(g=t.data)==null?void 0:g.logs.reverse(),...d.value||[]]),t.data.last_record_id&&(h.value=t.data.last_record_id),((u=n.value)==null?void 0:u.status)==="RUNNING"&&B()):(h.value!==t.data.last_record_id&&t.data.last_record_id&&(d.value=[...(a=t.data)==null?void 0:a.logs.reverse(),...d.value||[]]),t.data.last_record_id&&(h.value=t.data.last_record_id),((D=n.value)==null?void 0:D.status)==="RUNNING"&&(J(),w.value=!0),((U=n.value)==null?void 0:U.status)!=="RUNNING"&&(stop(),b()),((j=n.value)==null?void 0:j.status)!=="RUNNING"&&(w.value=!1)))},B=async()=>{var t,f,v;if(!N.value||!c.query.session_id)return;const[r,s]=await ue({session_id:+c.query.session_id});!r&&(s==null?void 0:s.status)===0&&(I.value=s.data,(t=s.data)!=null&&t.find(u=>u.node_id===o.value)||(o.value=(f=s.data[0])==null?void 0:f.node_id,q(()=>{b()})),(v=s.data)!=null&&v.find(u=>u.status=="RUNNING")||E())},F=i(),H=()=>{F.value&&(clearInterval(F.value),_.value=null)},J=()=>{F.value=setTimeout(()=>{b()},10*1e3)},_=i(),E=()=>{_.value&&(clearInterval(_.value),_.value=null)},G=()=>{_.value=setInterval(()=>{B()},10*1e3)};te(()=>{c.query.node_id&&(o.value=+c.query.node_id),N.value=!0,q(()=>{_.value||(B(),G())})}),ae(()=>{c.query.node_id&&(o.value=+c.query.node_id),N.value=!0,q(()=>{_.value||(B(),G())})}),se(()=>{E(),H()}),oe(n,r=>{M(r)||q(()=>{b()})});const Q=r=>{T.value||(T.value=!0,d.value=void 0,o.value=r,h.value=0,b())};return(r,s)=>{const t=le,f=ne,v=ie,g=ce,u=W;return l(),m("div",me,[y("div",null,[p(g,{style:{height:"calc(100vh - 260px)","padding-right":"40px"}},{default:C(()=>[(l(!0),m(P,null,re(e(I),(a,D)=>(l(),m("div",{key:a.node_id,class:"cursor-pointer"},[y("div",{class:"px-2 pb-2 pt-2.5 w-full max-w-96 border text-center min-w-72 flex items-center",style:$({borderTopLeftRadius:"40px",borderBottomLeftRadius:"40px",borderTopRightRadius:"100px",borderBottomRightRadius:"100px",backgroundColor:e(o)===a.node_id?"rgba(0, 180, 42, 0.15)":"inherit",borderColor:e(o)===a.node_id?"rgb(0, 180, 42)":"#999A9B",color:e(o)===a.node_id?e(k).primaryColor:"inherit"}),onClick:()=>Q(a.node_id)},[y("span",ge,R(a.node_name),1),p(t,{size:"tiny",round:"",class:"!h-[22.4px] !rounded-full !w-20 !flex !items-center !justify-center",color:{color:e(x)[a.status].color}},{default:C(()=>[L(R(e(S)(e(x)[a.status].text)),1)]),_:2},1032,["color"])],12,he),D<e(I).length-1?(l(),m("div",xe,[y("div",ye,[p(f,{class:"!h-10 !bg-[#999A9B]",vertical:""}),p(v,{class:"-mt-2",color:"#999A9B",component:e(pe)},null,8,["component"])]),p(t,{size:"tiny",round:"",class:"!h-[22.4px] !rounded-full invisible !w-20",color:{color:e(x)[a.status].color}},{default:C(()=>[L(R(e(S)(e(x)[a.status].text)),1)]),_:2},1032,["color"])])):A("",!0)]))),128))]),_:1})]),y("div",{class:"border-l pl-10 flex-1",style:$({borderColor:e(k).dividerColor})},[p(g,{style:{height:"calc(100vh - 260px)"}},{default:C(()=>{var a;return[e(M)(e(n))?A("",!0):(l(),m("div",Ne,[L(R((a=e(n))==null?void 0:a.node_name)+" ",1),p(t,{size:"tiny",color:{color:e(x)[e(n).status].color}},{default:C(()=>[L(R(e(S)(e(x)[e(n).status].text)),1)]),_:1},8,["color"]),e(w)?(l(),V(_e,{key:0})):A("",!0)])),Array.isArray(e(d))&&e(d).length===0?(l(),V(u,{key:1,class:"h-full"})):(l(),m(P,{key:2},[e(T)?A("",!0):(l(),V(fe,{key:0,logs:e(d)},null,8,["logs"]))],64))]}),_:1})],4)])}}});export{Be as default};
