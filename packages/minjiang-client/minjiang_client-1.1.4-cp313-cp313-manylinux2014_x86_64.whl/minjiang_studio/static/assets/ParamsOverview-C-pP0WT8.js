import{d as J,J as Q,C as K,A as W,b as Z,r as m,aR as ee,a6 as te,E as x,L as V,I as ae,e as L,f as _,ab as b,ac as $,i as v,l as a,F as se,aw as ne,Y as q,w as u,am as A,h as C,B as oe,s as D,t as S,ad as P,al as re,bs as le,aq as ie,a5 as ue}from"./index-DJskbzIk.js";import{g as ce}from"./params-elF_11QE.js";import{m as pe,s as de,R as M,_ as fe,S as me}from"./SpaceTools-Ds6UqpWj.js";import{_ as _e}from"./DataTable-BkhITQT9.js";import"./exp-Dzc8nAzP.js";import"./groupDetail-grzpJhg1.js";import"./json-editor-vue-cMpGPz9p.js";import"./index-CljUi5cZ.js";import"./PaginationView.vue_vue_type_script_setup_true_lang-C5I4MAUI.js";import"./Pagination-MzAc_u8k.js";import"./prop-NnGblK-3.js";import"./Popconfirm-DFFNKs94.js";import"./Switch-BTGJkP8J.js";import"./DynamicForm-B5kgL0W4.js";import"./index-DDdGfEJ1.js";import"./InputNumber-CtZNiVVn.js";import"./Checkbox-B0NmEvB4.js";import"./RadioGroup-DFjU_ho_.js";import"./FileSaver.min-CWr_Rv27.js";import"./download-C2161hUv.js";const ve={class:"flex justify-end w-full ml-2"},ye={class:"flex justify-end w-full ml-2"},ge={class:"flex gap-2 items-center"},he=J({__name:"ParamsOverview",props:{spaceId:{}},setup(B,{expose:k}){Q(e=>({"5802d586":a(X).primaryColor}));const R=B,E=K(),X=W(),{t:T}=Z(),y=m(!1),l=m(),N=()=>{},d=m(),g=async e=>{if(y.value)return;y.value=!0;const[t,s]=await ce({device_group_name:E.query.device_group_name,space_id:R.spaceId,entity_type:l.value});y.value=!1,!t&&(s==null?void 0:s.status)===0&&(d.value=s.data,l.value||(l.value=s.data.entity_types[0],x(()=>{O.value=!1})),e&&x(()=>{setTimeout(()=>{w.value&&j(w.value[h.value.rowIdx],h.value.key)},300)}))},O=m(!0);ee(()=>{g()}),te(l,e=>{O.value||e&&x(()=>{g()})});const I=m(),U=m(),h=m(),Y=e=>{const t=e.lastIndexOf("/");return t<0?e:e.slice(t+1)},j=(e,t)=>{var c,p,o;const s=(c=d.value)==null?void 0:c.key_map[t].replace(/\%entity\%/g,e.entities);(p=I.value)==null||p.open();const n=e[t];let i="";typeof n=="number"?i=Number.isInteger(n)?"int":"float":typeof n=="boolean"&&(i="bool"),(o=I.value)==null||o.setFormValue({types:i,keys:Y(s),values:String(e[t])}),U.value={full_key:s,type:"edit"}},z=(e,t,s)=>{h.value={row:e,key:t,rowIdx:s},x(()=>{j(h.value.row,h.value.key)})},F=V(()=>{var t,s;const e=((s=(t=d.value)==null?void 0:t.titles)==null?void 0:s.map((n,i)=>{var p;const c=pe(Object.keys(((p=d.value)==null?void 0:p.data)||{}).map(o=>{var r;return(r=d.value)==null?void 0:r.data[o][i]}).concat(n),o=>String(o).length);return{title:n,key:n,width:String(c).length*9+35,render(o,r){const f=o[n];return typeof f=="number"?ae("div",{onClick:()=>z(o,n,r),class:"cursor-pointer"},f):String(f)}}}))||[];return e&&e.unshift({title:"Entities",key:"entities",width:100,fixed:"left"}),e}),G=V(()=>de(F.value.map(e=>e.width))),w=V(()=>{const{entities:e,titles:t=[],data:s={}}=d.value||{};return e==null?void 0:e.map(n=>{var c;const i={entities:n};return(c=s[n])==null||c.forEach((p,o)=>{const r=t[o];r&&(i[r]=p)}),i})}),H=()=>{g()};return k({refresh:g}),(e,t)=>{var o;const s=oe,n=ne,i=le,c=_e,p=ie;return _(),L(P,null,[a(se)((o=a(d))==null?void 0:o.entity_types)?(_(),b(n,{key:0,onUpdateValue:N,value:a(l),"onUpdate:value":t[1]||(t[1]=r=>q(l)?l.value=r:null),class:"!h-full",disabled:a(y)},{suffix:u(()=>[A(e.$slots,"default",{},void 0,!0),C("div",ve,[v(s,{type:"primary",onClick:t[0]||(t[0]=()=>g())},{icon:u(()=>[v(a(M))]),default:u(()=>[D(" "+S(a(T)("groupDetail.parameterManager.refresh")),1)]),_:1})])]),_:3},8,["value","disabled"])):a(l)?(_(),b(n,{key:1,onUpdateValue:N,value:a(l),"onUpdate:value":t[3]||(t[3]=r=>q(l)?l.value=r:null),class:"!h-full",disabled:a(y)},{suffix:u(()=>[A(e.$slots,"default",{},void 0,!0),C("div",ye,[v(s,{type:"primary",onClick:t[2]||(t[2]=()=>g())},{icon:u(()=>[v(a(M))]),default:u(()=>[D(" "+S(a(T)("groupDetail.parameterManager.refresh")),1)]),_:1})])]),default:u(()=>{var r;return[(_(!0),L(P,null,re((r=a(d))==null?void 0:r.entity_types,f=>(_(),b(i,{name:f,key:f},{default:u(()=>[C("div",ge,S(f),1)]),_:2},1032,["name"]))),128))]}),_:3},8,["value","disabled"])):$("",!0),v(p,{show:a(y)},{default:u(()=>[v(c,{bordered:"","max-height":"calc(100vh - 400px)","scroll-x":a(G),"single-line":!1,columns:a(F),data:a(w),class:"mt-5"},null,8,["scroll-x","columns","data"])]),_:1},8,["show"]),e.spaceId?(_(),b(fe,{key:2,info:a(U),"space-id":e.spaceId,"show-history-entry":"",ref_key:"actionInfoRef",ref:I,"onUpdate:success":H},null,8,["info","space-id"])):$("",!0)],64)}}}),be=ue(he,[["__scopeId","data-v-1ff62318"]]),De=J({__name:"ParamsOverview",setup(B){const k=K();return(R,E)=>(_(),b(be,{"space-id":+(a(k).query.space_id||"")},{default:u(()=>[v(me)]),_:1},8,["space-id"]))}});export{De as default};
