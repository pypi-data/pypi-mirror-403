import{d as B,ab as h,ac as R,l as t,F as D,f as u,r as l,A as X,C as F,b as Z,L as ee,o as te,aR as G,aS as ae,e as C,h as T,i as p,ap as se,w as i,aN as ne,ad as z,al as M,s as oe,t as le,aa as $,S as ue,aO as ie,aw as O,Y as P,av as Y,aq as re,aM as ce,E as _e,bo as K,a6 as de,bv as pe}from"./index-DJskbzIk.js";import{d as fe,e as ve}from"./autoCali-68qq9UhF.js";import{_ as me,D as ge}from"./DotLoader-SCL2PmPW.js";import{u as ye}from"./autoCali-DBOEf96G.js";import"./Image-CjHsT37c.js";import"./download-C2161hUv.js";const be=B({__name:"EntityLog",props:{logs:{}},setup(A){return(s,c)=>t(D)(s.logs)?R("",!0):(u(),h(me,{key:0,logs:s.logs},null,8,["logs"]))}}),he={class:"flex ml-5"},j=120,ke=B({__name:"EntitiesView",props:{entities:{}},setup(A){const s=l(!1),c=ye(),f=X(),_=F(),{t:w}=Z(),o=l(),e=l(),a=l(0),d=l(!1),m=l(),g=A,y=ee(()=>{const r=g.entities.length;return Array(r<j?j:r).fill(0).map((n,b)=>g.entities[b])}),H=r=>{r&&(m.value||(m.value=!0,o.value=r,e.value=[],a.value=0,d.value=!0,k()))},k=async()=>{var b,N,x,L,I;if(!s.value||!o.value||!_.query.session_id)return;d.value=!0;const[r,n]=await fe({session_id:+_.query.session_id,entity:o.value,last_record_id:a.value});m.value=!1,!r&&(n==null?void 0:n.status)===0&&(a.value!==((b=n.data)==null?void 0:b.last_record_id)&&((N=n.data)!=null&&N.last_record_id)&&(e.value=[...(x=n.data)==null?void 0:x.logs.reverse(),...e.value||[]]),(L=n.data)!=null&&L.last_record_id&&(a.value=(I=n.data)==null?void 0:I.last_record_id),_e(()=>{var V,q;((V=c.sessionInfo)==null?void 0:V.status)===K.RUNNING&&J(),((q=c.sessionInfo)==null?void 0:q.status)!==K.RUNNING&&(d.value=!1)}))},E=l(),J=()=>{E.value=setTimeout(()=>{k(),U()},3e3)},U=()=>{E.value&&(clearInterval(E.value),E.value=null)},S=l(0),Q=r=>{S.value=r,o.value&&k()};return te(()=>{s.value=!0,k()}),G(()=>{s.value=!0,k()}),ae(()=>{s.value=!1,U()}),(r,n)=>{const b=ie,N=ne,x=se,L=re,I=ce,V=Y,q=O;return u(),C("div",he,[T("div",null,[p(x,{style:{height:"calc(100vh - 310px)"}},{default:i(()=>[p(N,{cols:10,style:{width:"560px"}},{default:i(()=>[(u(!0),C(z,null,M(t(y),(v,W)=>(u(),h(b,{key:W,class:ue(["border min-w-14 min-h-14 flex items-center justify-center p-1",[v?"cursor-pointer":""]]),style:$({borderColor:t(f).dividerColor,backgroundColor:t(o)===v&&t(o)?"#00B42A":"inherit",color:t(o)===v?"#fff":"inherit"}),onClick:()=>H(v)},{default:i(()=>[oe(le(v),1)]),_:2},1032,["style","class","onClick"]))),128))]),_:1})]),_:1})]),p(q,{animated:"",class:"!h-full flex-1 !w-auto ml-8",value:t(S),"onUpdate:value":n[0]||(n[0]=v=>P(S)?S.value=v:null),onUpdateValue:Q},{suffix:i(()=>[t(d)?(u(),h(ge,{key:0})):R("",!0)]),default:i(()=>[p(V,{name:0,key:"0",tab:t(w)("groupDetail.autoCali.caliLog"),class:"!pl-0","display-directive":"show:lazy"},{default:i(()=>[p(x,{style:$({padding:"15px",height:"calc(100vh - 345px)",backgroundColor:t(f).baseColor})},{default:i(()=>[t(m)?(u(),h(L,{key:0})):(u(),C(z,{key:1},[p(be,{logs:t(e)},null,8,["logs"]),t(D)(t(e))?(u(),h(I,{key:0,class:"mt-32"})):R("",!0)],64))]),_:1},8,["style"])]),_:1},8,["tab"])]),_:1},8,["value"])])}}}),Le=B({__name:"AutoCaliEntity",setup(A){const s=F(),c=l(),f=l(),_=l(),w=()=>{f.value=void 0,c.value=void 0},o=async()=>{const[e,a]=await ve({device_group_name:s.query.device_group_name,space_id:+s.query.space_id});if(!e&&(a==null?void 0:a.status)===0){f.value=a.data;const d=Object.keys(a.data||{});d.length>0&&(c.value=d[0])}};return G(()=>{const e=s.query.space_id;e&&e!==_.value?(_.value=e,w(),o()):!_.value&&e&&(_.value=e,o())}),de(()=>s.query.space_id,e=>{e&&e!==_.value&&(_.value=e,w(),o())}),(e,a)=>{const d=Y,m=O;return u(),C("div",null,[p(m,{type:"card",animated:"",size:"small",placement:"left",class:"!h-full !w-auto",value:t(c),"onUpdate:value":a[0]||(a[0]=g=>P(c)?c.value=g:null),"tab-class":"w-[128px]"},pe({suffix:i(()=>[a[2]||(a[2]=T("div",null,null,-1))]),default:i(()=>[(u(!0),C(z,null,M(t(f),(g,y)=>(u(),h(d,{name:y,key:y,tab:y},{default:i(()=>[p(ke,{"active-key":y,entities:g},null,8,["active-key","entities"])]),_:2},1032,["name","tab"]))),128))]),_:2},[t(D)(t(f))?void 0:{name:"prefix",fn:i(()=>[a[1]||(a[1]=T("div",null,null,-1))]),key:"0"}]),1032,["value"])])}}});export{Le as default};
