# yaml-language-server: $schema=../../../schemas/model_config_schema.json

variables:
  client_id: &client_id                          # Service principal client ID
    options:
      - scope: retail_consumer_goods
        secret: RETAIL_AI_DATABRICKS_CLIENT_ID
      - env: RETAIL_AI_DATABRICKS_CLIENT_ID
  client_secret: &client_secret                  # Service principal secret
    options:
      - scope: retail_consumer_goods
        secret: RETAIL_AI_DATABRICKS_CLIENT_SECRET
      - env: RETAIL_AI_DATABRICKS_CLIENT_SECRET
  workspace_host: &workspace_host                # Databricks workspace URL
    options:
      - scope: retail_consumer_goods
        secret: RETAIL_AI_DATABRICKS_HOST
      - env: RETAIL_AI_DATABRICKS_HOST

schemas:
  retail_schema: &retail_schema                  # Unity Catalog schema configuration
    catalog_name: retail_consumer_goods                       # Unity Catalog name
    schema_name: hardware_store                       # Schema within the catalog

resources:
  llms:
    default_llm: &default_llm                    # Default LLM configuration
      name: databricks-claude-3-7-sonnet        # Databricks serving endpoint name

  genie_rooms:
    retail_genie_room: &retail_genie_room        # Genie room configuration
      name: "Retail AI Genie Room"               # Human-readable name
      description: "Genie room for retail queries"
      space_id:
        env: RETAIL_AI_GENIE_SPACE_ID
        default_value: 01f01c91f1f414d59daaefd2b7ec82ea

  tables:
    product_table: &product_table                # Table configuration for vector store
      schema: *retail_schema
      name: products

  vector_stores:
    retail_vector_store: &retail_vector_store    # Vector store configuration
      source_table: *product_table               # Source table for vector search
      embedding_source_column: description       # Column containing embeddings
      endpoint: 
        name: dbdemos_vs_endpoint
      index:
        schema: *retail_schema                   # Schema for vector search index
        name: products_index                      # Vector search index name

tools:


  # Example 2: Using convenience object (recommended - automatic URL generation)
  vector_search_mcp: &vector_search_mcp          # Vector search MCP tool configuration
    name: vector_search_mcp                                  
    function:
      type: mcp                                  # MCP function type
      vector_search: *retail_vector_store        # Use vector search convenience object
      client_id: *client_id
      client_secret: *client_secret
      workspace_host: *workspace_host

  sql_mcp: &sql_mcp                              # DBSQL MCP tool configuration
    name: sql_mcp
    function:
      type: mcp                                  # MCP function type
      sql: true                                  # Use serverless DBSQL MCP server (no warehouse needed)
      client_id: *client_id
      client_secret: *client_secret
      workspace_host: *workspace_host

  functions_mcp: &functions_mcp                  # Unity Catalog Functions MCP tool configuration
    name: functions_mcp                                  
    function:
      type: mcp                                  # MCP function type
      functions: *retail_schema                  # Use functions (UC Functions) convenience object
      client_id: *client_id
      client_secret: *client_secret
      workspace_host: *workspace_host

  genie_mcp: &genie_mcp                          # Genie MCP tool configuration
    name: genie_mcp                                  
    function:
      type: mcp                                  # MCP function type
      genie_room: *retail_genie_room             # Use genie_room convenience object
      client_id: *client_id
      client_secret: *client_secret
      workspace_host: *workspace_host

agents:
  mcp_agent: &mcp_agent                          # MCP agent configuration
    name: mcp_agent                              # Agent identifier
    model: *default_llm                          # Reference to LLM configuration
    tools:                                       # Tools available to this agent
      # Note: generic_mcp and vector_search_mcp both point to vector search
      # Only one should be used in practice (shown here for demonstration)
      - *vector_search_mcp                       # Example: Convenience object approach
      - *sql_mcp
      - *functions_mcp
      - *genie_mcp
    prompt: |                                    # System prompt defining agent behavior
      You are a multi-purpose agent that can perform vector search, execute SQL queries via DBSQL,
      call Unity Catalog functions, and interact with Genie rooms. Use the tools provided to answer
      questions and perform tasks. You may need to use the tools in combination to achieve complex tasks.
      
app:
  name: managed_mcp_dao                                # Application name  
  log_level: TRACE                               # Logging level for the application
  registered_model:                              # MLflow registered model configuration
    schema: *retail_schema                       # Schema where model will be registered
    name: mcp_agent                              # Model name in MLflow registry
  environment_vars:
    RETAIL_AI_DATABRICKS_CLIENT_ID: *client_id
    RETAIL_AI_DATABRICKS_CLIENT_SECRET: *client_secret
    RETAIL_AI_DATABRICKS_HOST: *workspace_host
  agents:                                        # List of agents included in the system
    - *mcp_agent                                 # MCP agent
  orchestration:                                 # Agent orchestration configuration
    swarm:                                       # Supervisor orchestration pattern
      default_agent: *mcp_agent                  # Default agent for routing
