[build-system]
requires = [
    "setuptools>=61.0",
]
build-backend = "setuptools.build_meta"

[project]
name = "b24pysdk"
version = "0.4.0"
authors = [
  { name = "Bitrix24", email = "pypi@bitrixsoft.com" }
]
description = "An official Python library for the Bitrix24 REST API"
license = { file = "LICENSE" }
readme = { file = "README.md", content-type = "text/markdown" }
requires-python = ">=3.9"
keywords = ["bitrix24", "rest", "api"]
classifiers = []

dependencies = [
    "psygnal>=0.14.1,<1.0",
    "requests>=2.32.4,<3",
    "uuid6>=2025.0.0,<2026.0.0",
]

[project.urls]
Homepage = "https://github.com/bitrix24/b24pysdk"

[project.optional-dependencies]
dev = [
    "pre-commit",
    "ruff==0.12.1",
]
test = [
    "environs>=11.0.0",
    "fastapi[standard]",
    "pytest>=7",
    "pytest-cov>=4",
    "pytest-dependency>=0.5.1",
    "pytest-mock>=3",
    "python-multipart",
    "uvicorn",
]

[tool.setuptools.packages.find]
exclude = ["tests*"]

[tool.ruff]
line-length = 300
target-version = "py39"
exclude = ["build", "dist", ".venv", "__pycache__"]

[tool.ruff.lint]
select = [
    "ARG",   # https://docs.astral.sh/ruff/rules/#flake8-unused-arguments-arg
    "B",     # https://docs.astral.sh/ruff/rules/#flake8-bugbear-b
    "BLE",   # https://docs.astral.sh/ruff/rules/#flake8-blind-except-ble
    "C",     # https://docs.astral.sh/ruff/rules/#mccabe-c
    "C4",    # https://docs.astral.sh/ruff/rules/#flake8-comprehensions-c4
    "C90",   # https://docs.astral.sh/ruff/rules/#mccabe-c90
    "COM",   # https://docs.astral.sh/ruff/rules/#flake8-commas-com
    "DTZ",   # https://docs.astral.sh/ruff/rules/#flake8-datetimez-dtz
    "E",     # https://docs.astral.sh/ruff/rules/#pycodestyle-e
    "F",     # https://docs.astral.sh/ruff/rules/#pyflakes-f
    "FLY",   # https://docs.astral.sh/ruff/rules/#flynt-fly
    "G",     # https://docs.astral.sh/ruff/rules/#flake8-logging-format-g
    "I",     # https://docs.astral.sh/ruff/rules/#isort-i
    "INP",   # https://docs.astral.sh/ruff/rules/#flake8-no-pep420-inp
    "INT",   # https://docs.astral.sh/ruff/rules/#flake8-gettext-int
    "ISC",   # https://docs.astral.sh/ruff/rules/#flake8-implicit-str-concat-isc
    "LOG",   # https://docs.astral.sh/ruff/rules/#flake8-logging-log
    "N",     # https://docs.astral.sh/ruff/rules/#pep8-naming-n
    "Q",     # https://docs.astral.sh/ruff/rules/#flake8-quotes-q
    "PERF",  # https://docs.astral.sh/ruff/rules/#perflint-perf
    "PIE",   # https://docs.astral.sh/ruff/rules/#flake8-pie-pie
    "PGH",   # https://docs.astral.sh/ruff/rules/#pygrep-hooks-pgh
    "PL",    # https://docs.astral.sh/ruff/rules/#pylint-pl
    "PT",    # https://docs.astral.sh/ruff/rules/#flake8-pytest-style-pt
    "PTH",   # https://docs.astral.sh/ruff/rules/#flake8-use-pathlib-pth
    "PYI",   # https://docs.astral.sh/ruff/rules/#flake8-pyi-pyi
    "RET",   # https://docs.astral.sh/ruff/rules/#flake8-return-ret
    "RSE",   # https://docs.astral.sh/ruff/rules/#flake8-raise-rse
    "RUF",   # https://docs.astral.sh/ruff/rules/#ruff-specific-ruf
    "S",     # https://docs.astral.sh/ruff/rules/#flake8-bandit-s
    "SIM",   # https://docs.astral.sh/ruff/rules/#flake8-simplify-sim
    "SLOT",  # https://docs.astral.sh/ruff/rules/#flake8-slots-slot
    "T",     # https://docs.astral.sh/ruff/rules/#flake8-debugger-t
    "TD",    # https://docs.astral.sh/ruff/rules/#flake8-todos-td
    "TID",   # https://docs.astral.sh/ruff/rules/#flake8-tidy-imports-tid
    "TRY",   # https://docs.astral.sh/ruff/rules/#tryceratops-try
    "YTT",   # https://docs.astral.sh/ruff/rules/#flake8-2020-ytt
]

ignore = [
    "B009",     # https://docs.astral.sh/ruff/rules/get-and-set-attribute-on-class
    "C408",     # https://docs.astral.sh/ruff/rules/unnecessary-collection-call
    "E501",     # https://docs.astral.sh/ruff/rules/line-too-long
    "N805",     # https://docs.astral.sh/ruff/rules/invalid-first-argument-name-for-method
    "N818",     # https://docs.astral.sh/ruff/rules/error-suffix-on-exception-name
    "PLC0415",  # https://docs.astral.sh/ruff/rules/import-outside-toplevel
    "PLR0913",  # https://docs.astral.sh/ruff/rules/too-many-arguments
    "RET505",   # https://docs.astral.sh/ruff/rules/superfluous-else-return
    "SIM108",   # https://docs.astral.sh/ruff/rules/if-else-block-instead-of-if-exp
    "T201",     # https://docs.astral.sh/ruff/rules/print-found
    "TID252",   # https://docs.astral.sh/ruff/rules/relative-imports
    "TRY003",   # https://docs.astral.sh/ruff/rules/raise-vanilla-args
]

[tool.ruff.lint.per-file-ignores]
"tests/*" = ["S101"]

[tool.ruff.format]
quote-style = "double"

[tool.pytest.ini_options]
addopts = "-q"
markers = [
    "access: mark a test as related to access operations",
    "activity",
    "app",
    "app_option",
    "crm_automatedsolution",
    "bitrix_api_batch",
    "b24_api_batch_result",
    "bitrix_api_batch_response",
    "bitrix_api_list",
    "bitrix_api_list_response",
    "bitrix_api_list_fast_response",
    "bitrix_app_info",
    "b24_app_info_result",
    "b24_app_info_install_result",
    "bitrix_app_info_response",
    "bitrix_api_response",
    "bitrix_api_time_response",
    "bitrix_api_request",
    "bitrix_api_list_request",
    "bitrix_api_list_fast_request",
    "bitrix_api_batch_request",
    "bitrix_api_batches_request",
    "bitrix_api_requester",
    "bitrix_oauth_requester",
    "bizproc",
    "crm: mark a test as related to crm operations",
    "crm_activity",
    "crm_activity_badge",
    "crm_activity_binding",
    "crm_activity_communication",
    "crm_activity_configurable",
    "crm_activity_layout_blocks",
    "crm_activity_only", # for running crm.activity only
    "crm_activity_type",
    "crm_address",
    "crm_calllist: mark a test as related to crm.calllist operations",
    "crm_calllist_items: mark a test as related to crm.calllist.items operations",
    "crm_category",
    "crm_company: mark a test as related to crm.company operations",
    "crm_contact",
    "crm_currency: mark a test as related to crm.currency operations",
    "crm_currency_base: mark a test as related to crm.currency.base operations",
    "crm_currency_localizations: mark a test as related to crm.currency.localizations operations",
    "crm_deal: mark a test as related to crm.deal operations",
    "crm_documentgenerator",
    "crm_documentgenerator_document",
    "crm_lead",
    "crm_multifield",
    "crm_quote",
    "crm_stagehistory",
    "crm_type",
    "department: mark a test as related to department operations",
    "disk",
    "entity: mark a test as related to entity operations",
    "entity_section: mark a test as related to entity section operations",
    "event: mark a test as related to event operations",
    "events: mark a test as related to events operations",
    "feature: mark a test as related to feature operations",
    "folder",
    "integration: marks tests that hit real Bitrix24 API (deselect with -m 'not integration')",
    "method",
    "oauth_only: mark test to run only if OAuth credentials are available",
    "webhook_only: mark test to run only if Webhook credentials are available",
    "placement: mark a test as related to placement operations",
    "profile: mark a test as related to profile operations",
    "requests",
    "requesters",
    "responses",
    "robot",
    "server: mark a test as related to server operations",
    "scope",
    "storage",
    "unit",
    "user: mark a test as related to user operations",
    "user_option: mark a test as related to user option operations",
    "user_userfield: mark a test as related to user userfield operations",
]
testpaths = [
    "tests",
]
python_files = ["test_*.py", "*_test.py"]
