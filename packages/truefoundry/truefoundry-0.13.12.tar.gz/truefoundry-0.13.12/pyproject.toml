[project]
name = "truefoundry"
version = "0.13.12"  # This is a placeholder version, it will be replaced when releasing
requires-python = ">=3.8.1,<3.15"
description = "TrueFoundry CLI"
authors = [{ name = "TrueFoundry Team", email = "abhishek@truefoundry.com" }]
readme = "README.md"
dependencies = [
  "aenum>=3.0.0,<4.0.0",
  "click>=7.0.0,<9.0.0",
  "coolname>=1.1.0,<2.0.0",
  "docker>=6.1.2,<8.0.0",
  "filelock>=3.8.0,<4.0.0",
  "gitignorefile>=1.1.2,<2.0.0",
  "GitPython>=3.1.43,<4.0.0",
  "importlib-metadata>=4.11.3,<9.0.0",
  "importlib-resources>=5.2.0,<7.0.0",
  "Mako>=1.1.6,<2.0.0",
  "openai>=1.16.2,<2.0.0",
  "packaging>=20.0,<26.0",
  "pydantic>=1.8.2,<3.0.0",
  "pygments>=2.12.0,<3.0.0",
  "PyJWT>=2.0.0,<3.0.0",
  "python-dateutil>=2.8.2,<3.0.0",
  "python-dotenv>=1.0.1,<2.0.0",
  "python-socketio[client]>=5.5.2,<6.0.0",
  "PyYAML>=6.0.0,<7.0.0",
  "questionary>=1.10.0,<2.0.0",
  "requests>=2.18.0,<3.0.0",
  "requirements-parser>=0.11.0,<0.12.0",
  "rich-click>=1.2.1,<2.0.0",
  "rich>=13.7.1,<14.0.0",
  "tqdm>=4.0.0,<5.0.0",
  "truefoundry-sdk>=0.1.19,<0.2.0",
  "typing-extensions>=4.0",
  "urllib3>=1.26.18,<3",
  "yq>=3.1.0,<4.0.0",
  # Check and try to eliminate libs below this comment
  "numpy>=1.23.0,<3.0.0",
  "Jinja2>=3.1.6,<4.0.0"
]

[project.optional-dependencies]
workflow = [
  "flytekit==1.15.3; python_version >= '3.9' and python_version <= '3.12'",
]
spark = [
  "flytekit==1.15.3; python_version >= '3.9' and python_version <= '3.12'",
  "flytekitplugins-spark==1.15.3; python_version >= '3.9' and python_version <= '3.12'",
]

[project.scripts]
tfy = "truefoundry.cli.__main__:main"
truefoundry = "truefoundry.cli.__main__:main"

[dependency-groups]
dev = [
  "datasets>=3.0.0,<5.0.0",
  "ipykernel>=6.16.0",
  "ipython>=7.10.0",
  "ipywidgets>=8.0.0",
  "matplotlib>=3.0.0,<4.0.0",
  "mypy>=1.14.1",
  "omegaconf==2.3",
  "pandas>=1.0.0,<3.0.0; python_version < '3.10'",
  "pandas>=1.4.0,<3.0.0; python_version >= '3.10'",
  "Pillow>=9.1.1,<11.0.0",
  "plotly>=5.8.2,<6.0.0",
  "pre-commit>=3.5.0,<4.0.0",
  "pytest-env>=1.1.5,<2.0.0",
  "pytest>=8.2.2,<9.0.0",
  "ruff>=0.9.4",
  "scikit-learn>=1.3.0,<2.0.0",
  "seaborn>=0.13.0,<0.14.0",
  "transformers>=4.0.0,<5.0.0",
  "xgboost>=2.1.3,<3.0.0",

  # typing stubs
  "pandas-stubs",
  "types-beautifulsoup4",
  "types-cffi",
  "types-colorama",
  "types-decorator",
  "types-defusedxml",
  "types-docutils",
  "types-html5lib",
  "types-networkx",
  "types-openpyxl",
  "types-paramiko",
  "types-pexpect",
  "types-protobuf",
  "types-psutil",
  "types-Pygments",
  "types-python-dateutil",
  "types-pytz",
  "types-pywin32",
  "types-PyYAML",
  "types-regex",
  "types-requests",
  "types-simplejson",
  "types-tabulate",
  "types-tensorflow",
  "types-tqdm",
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"
[tool.hatch.build.targets.sdist]
include = [
  "truefoundry/"
]
[tool.hatch.metadata]
allow-direct-references = true

[tool.ruff]
target-version = "py38"
exclude = [
  ".venv",
  "venv",
  "repos",
]

[tool.ruff.lint]
select = [
  "E",     # pycodestyle errors
  "W",     # pycodestyle warnings
  "F",     # pyflakes
  "C",     # flake8-comprehensions
  "B",     # flake8-bugbear
  "Q",     # flake8-quotes
  "I",
  "T10",
  "ASYNC",
  "NPY201",
]
ignore = ["E501"]

[tool.ruff.lint.flake8-quotes]
docstring-quotes = "double"
inline-quotes = "double"

[tool.ruff.lint.per-file-ignores]
"__init__.py" = ["F401"]
"truefoundry/ml/_autogen/client/*" = ["B028", "B904", "C901", "C409", "F841"]
"truefoundry/ml/_autogen/models/*" = ["E721"]
"truefoundry/ml/_autogen/client/models/*" = ["F821"]
"truefoundry/ml/_autogen/client/api_client.py" = ["E721"]

[tool.ruff.format]
quote-style = "double"

[tool.mypy]
plugins = ["pydantic.v1.mypy"]
install_types = true
non_interactive = true

allow_redefinition = false
allow_untyped_globals = false
check_untyped_defs = true
disallow_any_generics = true
disallow_incomplete_defs = true
disallow_subclassing_any = true
disallow_untyped_calls = true
disallow_untyped_decorators = true
disallow_untyped_defs = true
follow_imports = "silent"
force_uppercase_builtins = true
no_implicit_optional = true
no_implicit_reexport = true
strict_equality = true
strict_optional = true
warn_no_return = true
warn_redundant_casts = true
warn_return_any = true
warn_unreachable = true
warn_unused_ignores = true

packages = ["truefoundry"]
exclude = [
  "^truefoundry/ml/_autogen",
  "^truefoundry/deploy/_autogen",
  "^truefoundry/pydantic_v1.py$",
  "^truefoundry/autodeploy/",
]
disable_error_code = ["import-untyped", "method-assign"]

[tool.pydantic-mypy]
init_forbid_extra = true
init_typed = true
warn_required_dynamic_aliases = true

[tool.pytest.ini_options]
env = [
  "TFY_PYTHONBUILD_PYTHON_IMAGE_REPO=docker.io/truefoundrycloud/test/python",
  "TFY_SPARK_BUILD_SPARK_IMAGE_REPO=public.ecr.aws/bitnami/spark",
]

[tool.uv]
default-groups = ["dev"]
