(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[6184],{26184:(e,t,r)=>{"use strict";r.r(t),r.d(t,{DataModelLoadingError:()=>R,QueryError:()=>K,QueryTimeoutError:()=>B,addMissingTotalRows:()=>he,atotiClientReducer:()=>N,clientInitialState:()=>E,createAtotiClient:()=>W,forEachCell:()=>te,forceRefreshQuery:()=>pe,getAxisLength:()=>J,getCellSetMetaData:()=>X,getHierarchyIndicesInCellSet:()=>Z,getMembersByHierarchy:()=>re,getMissingTotals:()=>le,getSortedTupleKey:()=>ie,getTuple:()=>ee,getTupleCaption:()=>ae,getTupleKey:()=>ne,getVisibleCubeDrillthroughColumns:()=>H,hasQueryChanged:()=>x,isCellSet:()=>C,isCellSetEmpty:()=>me,isErrorInQueryResultOfType:()=>F,isTotal:()=>G,isTupleExpanded:()=>ue,multiAtotiClientReducer:()=>ge,trimTrailingTotals:()=>ce});var s=r(31529),n=r(80652),i=r(73201),a=r(6707),o=r(27964);class c extends a.d{_unsafeWebSocket;pingPeriod;pingIntervalId;webSocketUrl;constructor({url:e,serverVersion:t,serviceVersion:r,requestInit:s,pingPeriod:n}){super({url:e,serverVersion:t,serviceVersion:r,requestInit:s}),this.pingPeriod=n||6e4,this.webSocketUrl=((e,t)=>{const[r,s]=e.split("://"),{wsPath:n}=t;return"https"===r?`wss://${s}${n}`:`ws://${s}${n}`})(e,r)}get webSocket(){if(!this._unsafeWebSocket)throw new Error("The WebSocket connection has not been established yet.");return this._unsafeWebSocket}async ping(e){await(0,o.h)(this.url,this.serviceVersion,{...this.requestInit,...e})}async openWebSocket(){this._unsafeWebSocket||(await this.ping({credentials:"include"}),this.pingIntervalId=window.setInterval((()=>{this.ping({credentials:"include"})}),this.pingPeriod),this._unsafeWebSocket=new WebSocket(this.webSocketUrl))}closeWebSocket(){this._unsafeWebSocket&&(this._unsafeWebSocket.readyState!==WebSocket.CLOSED&&this._unsafeWebSocket.close(),this._unsafeWebSocket=void 0),this.pingIntervalId&&clearInterval(this.pingIntervalId)}}var u=r(90354),d=r(7481),l=r(74121),h=r(20298),m=r(29213),p=r(24201),g=r(56768),f=r(90147),y=r(45123);class v extends Error{queryId;constructor(e){super(`No query exists for id: "${e}".`),this.queryId=e}}function b(e,t,r){const s=e._map[t];if(!s&&!1!==r?.throwIfMissing)throw new v(t);return s}function S(e,t){return e.mdx!==t.mdx}function w(e,t){return!(0,s.isEqual)(e.context,t.context)}function I(e,t){return!(0,s.isEqual)(e.ranges,t.ranges)}function x(e,t){return S(e,t)||w(e,t)||I(e,t)}function q(e){return"realTime"===e.query.updateMode||e.queryResult.isLoading}function C(e){return"cells"in e}function M(e){return"success"===e.status}const E={connectionStatus:"disconnected",isDataModelLoading:!1,calculatedMembers:{},namedSets:{},drillthroughColumns:{},nextQueryId:0,_map:{}};function N(e=E,t){const r=(0,f.produce)(e,(r=>{switch(t.type){case"querySet":{const{id:s,query:n,initialHeaders:i}=t,a={...n};delete a.isCanceled;const o=b(r,s,{throwIfMissing:!1});if(!o||o.query.isCanceled)return void(r._map[s]={queryVersion:String(r.nextQueryId++),isRegistered:"connected"===e.connectionStatus,queryResult:{isLoading:!0},query:a,...i&&{headers:i}});const c=o.query;return o.query=a,o.queryForCurrentData&&o.queryVersionForCurrentData&&!x(a,o.queryForCurrentData)?(o.queryResult.isLoading=!1,void(o.queryVersion=o.queryVersionForCurrentData)):void(x(a,c)&&(o.queryVersion=String(r.nextQueryId++),o.queryResult.isLoading=!0))}case"queryRefreshed":return void(b(r,t.id).queryResult.isLoading=!0);case"queryUnregistered":{const e=b(r,t.id);return void(e.query.isCanceled?(e.queryResult.isLoading=!1,e.isRegistered=!1):Reflect.deleteProperty(r._map,t.id))}case"queryCanceled":{const e=t.id,s=b(r,e);return void(s.query.isCanceled||(t.numberOfQueryResultSubscribers>0?(s.query.isCanceled=!0,s.queryResult.isLoading=!1,s.isRegistered=!1):Reflect.deleteProperty(r._map,e)))}case"webSocketOpening":return void(r.connectionStatus="connecting");case"webSocketOpened":r.connectionStatus="connected";for(const e of Object.values(r._map))q(e)&&(e.isRegistered=!0);return;case"webSocketClosed":r.connectionStatus="disconnected";for(const e of Object.values(r._map))e.isRegistered=!1;return;case"webSocketErrored":return void(r.connectionStatus="disconnected");case"webSocketMessageReceived":{const{message:e}=t,n=b(r,e.streamId,{throwIfMissing:!1});if(void 0===n||e.queryId!==n.queryVersion)return;n.queryForCurrentData=n.query,n.queryVersionForCurrentData=n.queryVersion;const i={isLoading:!1};return M(e)?(i.data=function(e,t){if(M(t))switch(t.type){case"cellData":if(void 0===e)throw new Error("Should have existing data to update.");if(!C(e))throw new Error("Received a Cellset update from Atoti Server about a query whose last result was a DrillthroughResult. This is not supported.");return(0,f.produce)(e,(e=>{e.epoch=t.data.epoch;const r=new Map;e.cells.forEach((({ordinal:e},t)=>{r.set(e,t)}));let n=!1;t.data.cells.forEach((t=>{const s=r.get(t.ordinal);void 0===s?(e.cells.push(t),n=!0):e.cells[s]=t})),n&&(e.cells=(0,s.sortBy)(e.cells,"ordinal"))}));case"drillthroughUpdateData":if(void 0===e)throw new Error("Received a Drillthrough update from Atoti Server about a query without a prior full drillthrough result. This is not supported.");if(C(e))throw new Error("Received a Drillthrough update from Atoti Server about a query whose last result was a Cellset. This is not supported.");return(0,f.produce)(e,(e=>{e.epoch=t.data.epoch;const{addedOrUpdatedRows:r,removedRows:s}=t.data;if(r&&(0,y.u)(r).forEach((t=>{e.result.rows[t]=r[t]})),s){s.sort();for(let t=s.length-1;t>=0;t--)e.result.rows.splice(s[t],1)}}));case"cellSetData":return{...t.data,cells:(0,s.sortBy)(t.data.cells,"ordinal")};case"drillthroughData":return t.data;default:throw new Error(`Unexpected Atoti Server client message type: "${t.type}". Valid types are ["cellData", "drillthroughUpdateData", "cellSetData", "drillthroughData"]`)}}(n.queryResult.data,e),i.error=void 0):i.error=e.error,void(n.queryResult=i)}case"dataModelLoadingStarted":r.isDataModelLoading=!0;break;case"dataModelLoadingErrored":r.isDataModelLoading=!1,r.dataModelLoadingError=t.error,r.dataModel=void 0;break;case"dataModelLoaded":r.isDataModelLoading=!1,r.dataModel=t.dataModel,r.dataModelLoadingError=void 0;break;case"drillthroughColumnsLoading":(0,s.set)(r,["drillthroughColumns",t.cubeName,"isLoading"],!0);break;case"drillthroughColumnsLoaded":r.drillthroughColumns[t.cubeName]={isLoading:!1,drillthroughColumns:t.drillthroughColumns,error:t.error};break;case"calculatedMembersLoading":(0,s.set)(r,["calculatedMembers",t.cubeName,"isLoading"],!0);break;case"calculatedMembersLoaded":r.calculatedMembers[t.cubeName]={isLoading:!1,calculatedMembers:t.calculatedMembers,error:t.error};break;case"namedSetsLoading":(0,s.set)(r,["namedSets",t.cubeName,"isLoading"],!0);break;case"namedSetsLoaded":r.namedSets[t.cubeName]={isLoading:!1,namedSets:t.namedSets,error:t.error}}}));return r}class R extends Error{serverUrl;constructor(e,t){super(`Could not load the data model from ${e}`,t),this.serverUrl=e}}var L=r(33807);async function k({url:e,pivotServiceVersion:t,requestInit:r,mdxDefinitionStatement:s,owners:n,readers:i}){await(0,L.K)(`${e}${t.restPath}/cube/configuration/execute`,(0,p._)(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({statement:s,owners:n,readers:i})}))}var V=r(23991);async function D({cubeName:e,serverUrl:t,pivotServiceVersion:r,options:s}){const{restPath:n}=r;return(await(0,L.K)(`${t}${n}/cube/configuration/calculatedMembers/${e}`,s)).json()}async function P({serverUrl:e,pivotServiceVersion:t,options:r}){const{restPath:s}=t;return(await(0,L.K)(`${e}${s}/cube/discovery`,r)).json()}async function T({url:e,pivotServiceVersion:t,cubeName:r,requestInit:s}){const{restPath:n}=t;return(await(0,L.K)(`${e}${n}/cube/query/mdx/drillthroughheaders`,(0,p._)(s,{method:"POST",headers:{"Content-Type":"application/json"},body:`{"mdx": "DRILLTHROUGH SELECT FROM [${r}]"}`}))).json()}var $=r(30152),U=r.n($),_=r(57257),O=r.n(_);function A(e){const t=U()(e);if(null===t)throw new Error(`${e} could not be interpreted as a semver version. Make sure that you have configured the server versions properly in your env.js`);return O()(t,"6.1.0")?"x-activeui-version":"x-atoti-ui-version"}function j({formula:e,cubeName:t,operation:r}){const s=function(e,t){const r=e.name.identifiers[0];return r.value===t?e:(0,f.produce)(e,(e=>{e.name.identifiers.unshift({elementType:"Identifier",quoting:r.quoting,value:t})}))}(e,t);return`${r} ${(0,m.stringify)(s)}`}class Q extends c{store;get state(){return this.store.getState()??E}queryResultSubscribersCounter={};constructor({url:e,serverVersion:t,serviceVersion:r,requestInit:s,pingPeriod:a,store:o}){super({url:e,serverVersion:t,serviceVersion:r,requestInit:(0,p._)(s,{headers:{[A(t)]:i.atotiUIVersion}}),pingPeriod:a}),this.store=o??(0,n.y$)(N)}static create(e){const t=new Q(e);return t.connect(),t}async connect(){if("connected"===this.connectionStatus)return;const e=new Promise((e=>{const t=this.subscribeToConnectionStatus((()=>{e(),t()}))}));if("disconnected"===this.connectionStatus){this.dispatch({type:"webSocketOpening"});try{await this.openWebSocket(),this.webSocket.addEventListener("open",(()=>{this.dispatch({type:"webSocketOpened"});for(const[e,t]of Object.entries(this.state._map))q(t)&&this.sendRegisterMessage(e)})),this.webSocket.addEventListener("message",(e=>{const t=JSON.parse(e.data);this.dispatch({type:"webSocketMessageReceived",message:t})})),this.webSocket.addEventListener("close",(()=>{this.disconnect()})),this.webSocket.addEventListener("error",(()=>{this.dispatch({type:"webSocketErrored"})}))}catch(e){if(this.disconnect(),e instanceof u.h)return;throw e}}return e}disconnect(){"disconnected"!==this.connectionStatus&&(this.closeWebSocket(),this.dispatch({type:"webSocketClosed"}))}dispatch(e){this.store.dispatch(e)}sendMessageIfConnected(e){"connected"===this.connectionStatus&&this.webSocket.send(JSON.stringify(e))}sendRegisterMessage(e){const{queryVersion:t,query:r,headers:s}=b(this.state,e),{mdx:n,context:i,updateMode:a,ranges:o}=r;this.sendMessageIfConnected({action:"REGISTER",data:{initialState:"realTime"===a?"STARTED":"PAUSED",streamId:e,queryId:t,mdxQuery:{mdx:n,context:i},ranges:o},...s&&{headers:s}})}sendUpdateMessage(e,t){const r=b(this.state,e),{query:s,queryVersion:n}=t,{query:i,queryVersion:a,queryVersionForCurrentData:o,headers:c}=r,{mdx:u,context:d,ranges:l,updateMode:h}=i;if(function(e,t){return(e.updateMode??"once")!==(t.updateMode??"once")}(i,s)){const t="realTime"===h;this.sendMessageIfConnected({action:t?"RESUME":"PAUSE",data:e})}a!==o&&a!==n&&(S(i,s)||w(i,s)?this.sendMessageIfConnected({action:"UPDATE",data:{streamId:e,queryId:a,mdxQuery:{mdx:u,context:d},ranges:l},...c&&{headers:c}}):I(i,s)&&this.sendMessageIfConnected({action:"RANGE_UPDATE",data:{streamId:e,queryId:a,ranges:l}}))}cancelQuery(e){const t=b(this.state,e,{throwIfMissing:!1});t&&!t.query.isCanceled&&(this.dispatch({type:"queryCanceled",id:e,numberOfQueryResultSubscribers:this.queryResultSubscribersCounter[e]??0}),this.sendMessageIfConnected({action:"UNREGISTER",data:e}))}setQuery(e,t,r){const s=b(this.state,e,{throwIfMissing:!1});this.dispatch({type:"querySet",id:e,query:t,initialHeaders:r}),"connected"===this.connectionStatus&&(s?.isRegistered?this.sendUpdateMessage(e,s):this.sendRegisterMessage(e))}get connectionStatus(){return this.state.connectionStatus}subscribeToConnectionStatus(e){return(0,d.Y)(this.store,(()=>this.connectionStatus),e)}getQuery(e){return b(this.state,e,{throwIfMissing:!1})?.query}subscribeToQuery(e,t){return(0,d.Y)(this.store,(()=>this.getQuery(e)),t)}getQueryResult(e){return b(this.state,e,{throwIfMissing:!1})?.queryResult}subscribeToQueryResult(e,t){void 0===this.queryResultSubscribersCounter[e]&&(this.queryResultSubscribersCounter[e]=0),this.queryResultSubscribersCounter[e]++;const r=(0,d.Y)(this.store,(()=>this.getQueryResult(e)),t);return()=>{if(r(),this.queryResultSubscribersCounter[e]--,0===this.queryResultSubscribersCounter[e]){if(!b(this.state,e,{throwIfMissing:!1}))return;this.dispatch({type:"queryUnregistered",id:e}),this.sendMessageIfConnected({action:"UNREGISTER",data:e})}}}refreshQuery(e){this.dispatch({type:"queryRefreshed",id:e}),b(this.state,e),this.sendMessageIfConnected({action:"REFRESH",data:e})}async loadDataModel({signal:e}={}){this.dispatch({type:"dataModelLoadingStarted"});try{const t=await async function(e){switch((0,V.W)(e.pivotServiceVersion.id)){case 4:case 5:case 6:return async function(e){return(await P(e)).data}(e);default:return P(e)}}({serverUrl:this.url,pivotServiceVersion:this.serviceVersion,options:{...this.requestInit,signal:e}}),r=(0,l.v)(t);this.__UNSAFE_setDataModel__(r)}catch(e){this.__UNSAFE_setDataModel__(void 0,new R(this.url,{cause:e}))}}get dataModel(){return this.state.dataModel}get isDataModelLoading(){return this.state.isDataModelLoading}get dataModelLoadingError(){return this.state.dataModelLoadingError}get drillthroughColumns(){return this.state.drillthroughColumns}get calculatedMembers(){return this.state.calculatedMembers}get namedSets(){return this.state.namedSets}__UNSAFE_setDataModel__(e,t){e?this.dispatch({type:"dataModelLoaded",dataModel:e}):t&&this.dispatch({type:"dataModelLoadingErrored",error:t})}subscribeToDataModel(e){return(0,d.Y)(this.store,(()=>(0,s.pick)(this.state,["dataModel","isDataModelLoading","dataModelError"])),e)}async loadDrillthroughColumns(e,{signal:t}={}){const r=this.state.drillthroughColumns[e];if(r&&r.isLoading)return;let s,n;this.dispatch({type:"drillthroughColumnsLoading",cubeName:e});try{n=await async function(e){switch((0,V.W)(e.pivotServiceVersion.id)){case 4:case 5:case 6:return async function(e){return(await T(e)).data}(e);default:return T(e)}}({url:this.url,pivotServiceVersion:this.serviceVersion,cubeName:e,requestInit:{...this.requestInit,signal:t}})}catch(e){s=(0,g.$)(e),console.error(s)}this.dispatch({type:"drillthroughColumnsLoaded",cubeName:e,drillthroughColumns:n,error:s})}subscribeToDrillthroughColumns(e,t){return(0,d.Y)(this.store,(()=>this.state.drillthroughColumns[e]),t)}async loadCalculatedMembers(e,{signal:t}={}){const r=this.state.calculatedMembers[e];if(r&&r.isLoading)return;let s,n;this.dispatch({type:"calculatedMembersLoading",cubeName:e});try{n=await async function(e){switch((0,V.W)(e.pivotServiceVersion.id)){case 4:case 5:case 6:return async function(e){return(await D(e)).data}(e);default:return D(e)}}({cubeName:e,serverUrl:this.url,pivotServiceVersion:this.serviceVersion,options:{...this.requestInit,signal:t}})}catch(e){s=(0,g.$)(e),console.error(s)}this.dispatch({type:"calculatedMembersLoaded",cubeName:e,calculatedMembers:n,error:s})}subscribeToCalculatedMembers(e,t){return(0,d.Y)(this.store,(()=>this.state.calculatedMembers[e]),t)}async createCalculatedMember({formula:e,cubeName:t,owners:r,readers:s}){const n=j({formula:e,cubeName:t,operation:"CREATE"});await k({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:n,owners:r,readers:s}),await this.loadCalculatedMembers(t)}async deleteCalculatedMember({memberUniqueName:e,cubeName:t}){const r=(0,m.unquote)(e),s=`DROP MEMBER ${r[0]===t?e:(0,m.quote)(t,...r)}`;await k({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:s}),await this.loadCalculatedMembers(t)}async updateCalculatedMember({formula:e,cubeName:t,owners:r,readers:s}){const n=j({formula:e,cubeName:t,operation:"UPDATE"});await k({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:n,owners:r,readers:s}),await this.loadCalculatedMembers(t)}async createKpi({kpi:e,cubeName:t,owners:r,readers:s}){let n=`CREATE KPI ${(0,m.quote)(t,e.name)} AS ${e.value}`;h.S.map((e=>e.slice(3))).forEach((t=>{const r=t;e[r]&&(n=`${n}, ${r.toUpperCase()}=${e[r]}`)})),await k({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:n,owners:r,readers:s})}async deleteKpi({kpiName:e,cubeName:t}){const r=`DROP KPI ${(0,m.quote)(t,e)}`;await k({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:r})}async loadNamedSets(e,{signal:t}={}){const r=this.state.namedSets[e]?.isLoading;if(r)return;let s,n;this.dispatch({type:"namedSetsLoading",cubeName:e});try{n=await async function(e){return 10===(0,V.W)(e.pivotServiceVersion.id)?async function({cubeName:e,serverUrl:t,pivotServiceVersion:r,options:s}){const{restPath:n}=r;return(await(0,L.K)(`${t}${n}/cube/configuration/namedSets/${e}`,s)).json()}(e):Promise.resolve({})}({cubeName:e,serverUrl:this.url,pivotServiceVersion:this.serviceVersion,options:{...this.requestInit,signal:t}})}catch(e){s=(0,g.$)(e),console.error(s)}this.dispatch({type:"namedSetsLoaded",cubeName:e,namedSets:n,error:s})}subscribeToNamedSets(e,t){return(0,d.Y)(this.store,(()=>this.state.namedSets[e]),t)}async createNamedSet({formula:e,cubeName:t,owners:r,readers:s}){const n=j({formula:e,cubeName:t,operation:"CREATE"});await k({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:n,owners:r,readers:s}),await this.loadNamedSets(t)}async deleteNamedSet({setName:e,cubeName:t}){await k({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:`DROP SET ${(0,m.quote)(t,e)}`}),await this.loadNamedSets(t)}}function W(e){return Q.create(e)}class K extends Error{errorChain;stackTrace;constructor({errorChain:e,stackTrace:t}){const r=`${(0,s.map)(e,"message").join("\n")}\n${t}`;super(e[0].message,{cause:r}),this.errorChain=e,this.stackTrace=t}}class B extends K{}function F(e,t){return e.errorChain.some((e=>e.type===t))}function H(e,t,{signal:r}={}){const{drillthroughColumns:s,isLoading:n}=e.drillthroughColumns[t]??{};return!n&&s?Promise.resolve(s.filter((e=>e.visible))):new Promise(((s,n)=>{const i=e.subscribeToDrillthroughColumns(t,(()=>{const{drillthroughColumns:r,error:a,isLoading:o}=e.drillthroughColumns[t];o||(i(),a?n(a):s(r?.filter((e=>e.visible))))}));e.loadDrillthroughColumns(t,{signal:r}),r&&(r.onabort=()=>{i(),n(r.reason)})}))}function G(e,t){return!e.slicing&&1===t.namePath.length}var Y=r(86189),z=r(50466);const J=e=>{const{range:t}=e;return t&&!t.entireAxis?t.axisLength:e.positions.length};function X(e,t){const r=[],s={};let n,i=0;for(const s of e.axes){const e=[],a=Object.values(s.hierarchies);for(let r=0;r<a.length;r++){const{dimension:o,hierarchy:c}=a[r];if((0,Y.t)(a[r]))n=s,i=r;else{const n=(0,z.q)({dimensionName:o,hierarchyName:c},t),i=Object.values(n.levels).slice(n.slicing?0:1,s.maxLevelPerHierarchy[r]).map((({name:e,index:t})=>({dimensionName:o,hierarchyName:c,levelName:e,hierarchyIndex:r,levelIndex:t})));e.push(...i)}}for(const{hierarchyIndex:t,levelIndex:n,...i}of e){const e=s.positions.every((e=>{if(n<e[t].namePath.length){const r=e[t].namePath[n];return!isNaN(r)}return!0}));r.push({...i,isNumeric:e})}}const a=e.axes.find((({id:e})=>e===m.axisIds.columns));if(n&&a&&[m.axisIds.rows,m.axisIds.columns].includes(n.id)){const t=J(a);for(const r of e.cells){const e=Math.floor(r.ordinal/t),a=r.ordinal%t,o=(n.id===m.axisIds.columns?a:e)-(n.range?.from??0),c=n.positions[o][i].namePath[0],u=!1!==s[c]?.isNumeric&&!isNaN(r.value);s[c]={isNumeric:u}}}return{levels:r,measures:Object.entries(s).map((([e,{isNumeric:t}])=>({measureName:e,isNumeric:t})))}}const Z=(e,t)=>{const r={};return e.axes.forEach(((e,s)=>{[0,1].includes(e.id)&&(t&&!t.axisNames.map(m.getAxisId).includes(e.id)||e.hierarchies.forEach((({dimension:e,hierarchy:t},n)=>{r[(0,m.quote)(e,t)]={dimensionName:e,hierarchyName:t,axisIndex:s,hierarchyIndex:n}})))})),r},ee=({columnIndex:e,data:t,hierarchyIndicesInCellSet:r,rowIndex:s})=>{if(!t.axes.some((e=>0===e.id||1===e.id))&&0===e&&0===s)return[];const n=[];let i=!1;return Object.values(r).forEach((({dimensionName:r,hierarchyName:a,axisIndex:o,hierarchyIndex:c})=>{const u=t.axes[o],d=u.range?.from||0,l=(0===u.id?e:s)-d;u.positions[l]&&(i=!0,void 0!==u.positions[l][c]&&n.push({dimensionName:r,hierarchyName:a,...u.positions[l][c]}))})),i?n:null},te=(e,t,r)=>{const[s,n]=[m.axisIds.columns,m.axisIds.rows].map((t=>{const r=e.axes.find((({id:e})=>e===t));return r?.positions.length??1}));let i=0;for(let a=0;a<n;a++)for(let n=0;n<s;n++){let o=null;const c=e.cells[i],u=a*s+n;c?.ordinal===u&&(i+=1,o=c),r({cell:o,cellIndex:o?i-1:null,columnIndex:n,tuple:ee({columnIndex:n,data:e,hierarchyIndicesInCellSet:t,rowIndex:a}),rowIndex:a})}},re=e=>(0,s.zipWith)(...e.positions,((...e)=>(0,s.uniqBy)(e,(e=>(0,m.quote)(...e.namePath))))).map(((t,r)=>({axisId:e.id,hierarchy:e.hierarchies[r],members:t}))),se=e=>e.map((({dimensionName:e,hierarchyName:t,namePath:r})=>e===t&&(0,Y.t)({dimensionName:e})?(0,m.quote)("Measures",r[0]):(0,m.quote)(e,t,...r))),ne=e=>se(e).join(",")||"Total",ie=e=>se(e.map((({dimensionName:e,hierarchyName:t,member:r})=>({dimensionName:e,hierarchyName:t,...r})))).sort().join(",")||"Total";function ae(e,{cube:t,captionForTotals:r,separator:n=" ",hasOnlyCaptionForLeafLevels:i=!1}){if(0===e.length)return r;let a=!1;const o=(0,s.flatten)(e.map((({dimensionName:e,hierarchyName:r,...s})=>{if(void 0===s)return"";const n=s.namePath??s.path,o=s.captionPath;if((0,Y.t)({dimensionName:e}))return o;const c=(0,z.q)({dimensionName:e,hierarchyName:r},t);return c.slicing||1!==n.length?i?o.at(-1):c.slicing?o:o.slice(1):(a=!0,[])})));return(a?[...o,r]:o).join(n)}var oe=r(5553);function ce(e,t,r){const n=(0,s.findLastIndex)(e,(e=>(0,Y.t)(e)?!r?.doesConsiderMeasuresAsTotals:!G((0,z.q)(e,t),e)));return e.slice(0,n+1)}function ue(e,{cube:t,expandedTuples:r}){if(0===e.length||0===r.length)return!1;const s=ce(e,t);return r.some((e=>(0,oe.w)(s,e.tupleCoordinates)))}function de(e,{rowIndexOnScreen:t,rowIndexInData:r,numberOfMissingTotalRowsAbove:s}){if(e)for(let n=0;n<=s;n++)e[t+n]=r}const le=(e,t,{hierarchies:r,maxLevelPerHierarchy:s,cube:n})=>{const i=[];let[a,o]=((e,t,r)=>{if(!e)return[0,0];for(let s=0;s<r.length;s++)for(let n=0;n<r[s];n++){const r=e[s];if(t[s].namePath[n]!==r.namePath[n])return[s,n]}return[r.length-1,r.at(-1)??0]})(e,t,s);const c=((e,t)=>ce(e,t).length)(t,n);for(;a<c;){const e=t[a];for(;o<e.namePath.length&&(a!==c-1||o!==e.namePath.length-1);){const r=[...t.slice(0,a),{...e,namePath:e.namePath.slice(0,o+1),captionPath:e.captionPath.slice(0,o+1)}],s=(0,Y.t)(e)?null:(0,z.q)(e,n);s&&r.every((e=>G(s,e)))||i.push(r),o++}if(a++,a<r.length){const e=r[a];o=null===e||e.slicing?0:1}}return i};function he(e,{cube:t,rowIndexMapping:r}){return t?(0,f.produce)(e,(n=>{const i=n.axes.find((({id:e})=>e===m.axisIds.rows));if(!i)return;const a=i.range?.from??0,o=function(e,t){if(!t||0===e)return 0;let r=t.length-1,s=t[r];const n=e;for(;r>=0&&(s=t[r])&&s>n;)r-=s-n;return r+(e-s)}(a,r);let c=o-a;i.range&&o>0&&(i.range.from+=c,r&&r.length<i.range.from-1&&function(e,t){const r=e.length-1,s=r-e[r];let n=e.length-s;for(;e.length<t+s;)e.push(n),n++}(r,i.range.from));const u=i.hierarchies.map((({dimension:e,hierarchy:r})=>(0,Y.t)({dimension:e})?null:(0,z.q)({dimensionName:e,hierarchyName:r},t))),d=[];let l=0,h=0;for(;l<i.positions.length;){const[e,n]=[l-1,l].map((e=>{if(-1!==e)return i.positions[e].map(((e,t)=>{const{dimension:r,hierarchy:s}=i.hierarchies[t];return{dimensionName:r,hierarchyName:s,...e}}))})),c=i.range&&i.range.from>0&&0===l?[]:le(e,n,{cube:t,hierarchies:u,maxLevelPerHierarchy:i.maxLevelPerHierarchy});if(i.positions.splice(l,0,...c),de(r,{rowIndexInData:a+h,rowIndexOnScreen:o+l,numberOfMissingTotalRowsAbove:c.length}),c.length>0){const e=i.range?i.range.from:0;d.push(...(0,s.range)(e+l,e+l+c.length))}l+=c.length+1,h+=1}!function(e,t){if(!e||t>=e.length-1)return;let r=t;for(;e[r+1]>e[r]+1;)e.splice(r+1,0,e[r]+1),r++}(r,o+l-1);const p=e.axes.find((({id:e})=>e===m.axisIds.columns)),g=p?p.positions.length:1;n.cells.forEach((e=>{const t=Math.floor(e.ordinal/g);for(;d.length>0&&t+c>=d[0];)c+=1,d.shift();e.ordinal+=c*g})),i.range&&(i.range.to+=c,i.range.axisLength+=c)})):e}function me(e){return void 0===e||0===e.cells.length&&e.axes.every((e=>0===e.positions.length))}function pe({atotiClient:e,queryId:t}){const r=e.getQuery(t);if(!r)return;const s={...r,mdx:`${r.mdx} `};e.setQuery(t,s)}const ge=(e,{serverKey:t,...r})=>t?{...e,[t]:N(e?.[t],r)}:{...e}},6707:(e,t,r)=>{"use strict";r.d(t,{d:()=>s});class s{url;serverVersion;serviceVersion;requestInit;constructor({url:e,serverVersion:t,serviceVersion:r,requestInit:s}){this.url=e,this.serviceVersion=r,this.serverVersion=t,this.requestInit=s}}},59254:(e,t,r)=>{"use strict";r.d(t,{v:()=>s});class s extends Error{static status=400;response;constructor(e){const{url:t}=e;super(`400: Bad request error on: ${t||"unspecified URL"}.`),this.name="BadRequestError",this.response=e}}},69988:(e,t,r)=>{"use strict";r.d(t,{f:()=>s});class s extends Error{static status=409;response;constructor(e){const{url:t}=e;super(`409: Conflict error on: ${t}.`),this.name="ConflictError",this.response=e}}},12378:(e,t,r)=>{"use strict";r.d(t,{H:()=>s});class s extends Error{static status=403;expirationDate;constructor(e){super(`Your license expired on ${e.toLocaleDateString()}. Please contact ActiveViam.`),this.name="ExpiredLicenseError",this.expirationDate=e}}},69267:(e,t,r)=>{"use strict";r.d(t,{q:()=>s});class s extends Error{static status=403;response;constructor(e){const{url:t}=e;super(`403: Access to: ${t||"unspecified URL"} is forbidden.`),this.name="ForbiddenError",this.response=e}}},82952:(e,t,r)=>{"use strict";r.d(t,{P:()=>s});class s extends Error{static status=500;response;constructor(e){const{url:t}=e;super(`500: Internal server error on: ${t||"unspecified URL"}.`),this.name="InternalServerError",this.response=e}}},90354:(e,t,r)=>{"use strict";r.d(t,{h:()=>s});class s extends Error{url;constructor(e,t){super(`No response received from: ${e||"unspecified URL"}.`,t),this.name="NoResponseError",this.url=e}}},43135:(e,t,r)=>{"use strict";r.d(t,{C:()=>s});class s extends Error{static status=404;response;constructor(e){const{url:t}=e;super(`404: The resource at ${t||"unspecified URL"} was not found.`),this.name="ResourceNotFoundError",this.response=e}}},25528:(e,t,r)=>{"use strict";r.d(t,{D:()=>s});class s extends Error{static status=401;response;constructor(e){const{url:t}=e;super(`401: Not authorized to access: ${t||"unspecified URL"}.`),this.name="UnauthorizedError",this.response=e}}},33807:(e,t,r)=>{"use strict";r.d(t,{K:()=>h});var s=r(56768),n=r(59254),i=r(69988),a=r(12378),o=r(69267),c=r(82952),u=r(90354),d=r(43135),l=r(25528);async function h(e,t){try{const r=await fetch(e,t);switch(r.status){case 400:throw new n.v(r);case 401:throw new l.D(r);case 403:{let e;try{const t=await r.json(),s=(t.error?.errorChain??t.errorChain)[0];"ForbiddenAccessException"===s.type&&s.message.includes("license has expired")&&(e=new Date(s.message.slice(s.message.lastIndexOf("(")+1,s.message.lastIndexOf(")"))))}catch{}if(e)throw new a.H(e);throw new o.q(r)}case 404:throw new d.C(r);case 409:throw new i.f(r);case 500:throw new c.P(r)}return r}catch(t){const r=(0,s.$)(t);throw"Failed to fetch"===r.message||"NetworkError when attempting to fetch resource."===r.message||"Load failed"===r.message?new u.h(e,{cause:r}):r}}},7481:(e,t,r)=>{"use strict";r.d(t,{Y:()=>i});var s=r(60162),n=r.n(s);function i(e,t,r){let s=t(e.getState());return e.subscribe((function(){const i=t(e.getState());n()(s,i)||(s=i,r())}))}},27964:(e,t,r)=>{"use strict";r.d(t,{h:()=>n});var s=r(33807);async function n(e,t,r){const{restPath:n}=t;await(0,s.K)(`${e}${n}/ping`,r)}},23397:(e,t,r)=>{"use strict";r.d(t,{L:()=>s});const s=["KPIValue","KPIGoal","KPIStatus","KPITrend","KPIStart","KPIExpiry"]},20298:(e,t,r)=>{"use strict";r.d(t,{S:()=>s});const s=r(23397).L.map((e=>e.toLowerCase()))},53230:(e,t,r)=>{"use strict";function s(e,t){return e.length===t.length&&e.every(((e,r)=>e===t[r]))}r.d(t,{U:()=>s})},5553:(e,t,r)=>{"use strict";r.d(t,{w:()=>i});var s=r(66318),n=r(53230);function i(e,t){return!(!e||!t)&&e.length===t.length&&e.every(((e,r)=>{return a=t[r],!(!(i=e)||!a)&&(0,s.q)(i,a)&&(0,n.U)(i.namePath,a.namePath);var i,a}))}},74121:(e,t,r)=>{"use strict";r.d(t,{v:()=>n});var s=r(31529);const n=e=>{const t=e.catalogs.map((e=>{const t=e.cubes.map((e=>(e=>{const t=e.dimensions.map((e=>{const t=e.hierarchies.map((e=>{const t=(0,s.keyBy)(e.levels.map(((e,t)=>({...e,index:t}))),"name");return{...e,levels:t}})),r=(0,s.keyBy)(t,"name");return{...e,hierarchies:r}})),{measures:r,kpis:n,sets:i,contextValues:a,measureGroups:o}=e;return{...e,dimensions:(0,s.keyBy)(t,"name"),measures:(0,s.keyBy)(r,"name"),kpis:(0,s.keyBy)(n,"name"),sets:(0,s.keyBy)(i,"name"),contextValues:(0,s.keyBy)(a,"name"),measureGroups:(0,s.keyBy)(o,"name")}})(e)));return{...e,cubes:(0,s.keyBy)(t,"name")}})),{contextValues:r}=e;return{catalogs:(0,s.keyBy)(t,"name"),contextValues:(0,s.keyBy)(r,"name")}}},56768:(e,t,r)=>{"use strict";r.d(t,{$:()=>n});class s extends Error{constructor(e){super(`Unexpected exception type: \`${typeof e}\`.`,{cause:e})}}function n(e){return e instanceof Error?e:new s(e)}},24201:(e,t,r)=>{"use strict";function s(e,t){const r=new Headers(e?.headers);return new Headers(t?.headers).forEach(((e,t)=>{r.set(t,e)})),{...e,...t,headers:r}}r.d(t,{_:()=>s})},45123:(e,t,r)=>{"use strict";function s(e){return Object.keys(e)}r.d(t,{u:()=>s})},38687:(e,t,r)=>{"use strict";r.d(t,{G:()=>s});class s extends Error{id;constructor(e){super(`Invalid service version id: ${e}`),this.id=e}}},23991:(e,t,r)=>{"use strict";r.d(t,{W:()=>n});var s=r(38687);function n(e){const[,t]=/^(\d+)(.*)/.exec(e)??[],r=Number.parseInt(t);if(isNaN(r))throw new s.G(e);return r}},60162:e=>{e.exports=function(e,t,r,s){var n=r?r.call(s,e,t):void 0;if(void 0!==n)return!!n;if(e===t)return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;var i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(var o=Object.prototype.hasOwnProperty.bind(t),c=0;c<i.length;c++){var u=i[c];if(!o(u))return!1;var d=e[u],l=t[u];if(!1===(n=r?r.call(s,d,l,u):void 0)||void 0===n&&d!==l)return!1}return!0}}}]);