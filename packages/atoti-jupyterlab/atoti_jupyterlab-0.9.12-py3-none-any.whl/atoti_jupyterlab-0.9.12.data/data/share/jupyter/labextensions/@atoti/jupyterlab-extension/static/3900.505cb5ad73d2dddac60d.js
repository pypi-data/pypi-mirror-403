"use strict";(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[3900],{71491:(e,t,i)=>{i.d(t,{P:()=>a});var n=i(1947),r=i(36442);function a(e,t){const i=e.settings[t];return void 0!==i?i:(0,r.Y)(t)?n.L[t]:void 0}},25079:(e,t,i)=>{i.d(t,{w:()=>a});var n=i(29213),r=i(67161);function a(e){if((0,r.S)(e)){const t=(0,n.parse)(e.mdx);return{...e,mdx:t}}return"dateRange"===e.type?{...e,startDate:e.startDate?new Date(e.startDate):void 0,endDate:e.endDate?new Date(e.endDate):void 0}:e}},23397:(e,t,i)=>{i.d(t,{L:()=>n});const n=["KPIValue","KPIGoal","KPIStatus","KPITrend","KPIStart","KPIExpiry"]},20298:(e,t,i)=>{i.d(t,{S:()=>n});const n=i(23397).L.map((e=>e.toLowerCase()))},66318:(e,t,i)=>{function n(e,t){return!(!e||!t)&&e.dimensionName===t.dimensionName&&e.hierarchyName===t.hierarchyName}i.d(t,{q:()=>n})},37154:(e,t,i)=>{function n(e,t){return!(!e||!t)&&e.dimensionName===t.dimensionName&&e.hierarchyName===t.hierarchyName&&e.levelName===t.levelName}i.d(t,{M:()=>n})},3065:(e,t,i)=>{i.d(t,{F:()=>n});class n extends Error{serverKey;constructor(e){super(`The server: "${e}" does not contain any cube.`),this.serverKey=e}}},45123:(e,t,i)=>{function n(e){return Object.keys(e)}i.d(t,{u:()=>n})},93900:(e,t,i)=>{i.r(t),i.d(t,{actionCreators:()=>Ke,addHierarchyToExpansionChainInMapping:()=>Q,assignFieldsToCorrespondingAttribute:()=>h,assignFieldsToFirstAvailableAttribute:()=>l,canAddHierarchyToAttribute:()=>Me,canAddMeasureToAttribute:()=>ae,canAddMoreFieldsToAttribute:()=>D,canAddNamedSetToAttribute:()=>we,dataVisualizationActionTypes:()=>He,dataVisualizationWidgetReducer:()=>ke,deriveMappingFromMdx:()=>mt,deserializeWidgetState:()=>Ve,doCoordinatesExistInCube:()=>qe,doesWidgetUseNamedSet:()=>je,driveFiltersFromState:()=>Re,ensureValidHiddenSubTotalsQueryContextEntry:()=>Z,findMappingFieldForHierarchy:()=>We,findServerKey:()=>W,getAttributeType:()=>u,getAxisNameForAttributeRole:()=>ee,getCoordinatesOfLevelBeforeInExpansionChain:()=>$,getFirstAttributeName:()=>L,getGenericMapping:()=>x,getHiddenSubtotalsLevelCoordinatesFromQueryContext:()=>_,getIndexOfAddedFieldOnMdxAxis:()=>ie,getMappingOfSwitchedDataVisualizationWidget:()=>f,getMeasureIndex:()=>oe,getNumericAttributes:()=>se,getQueryAndMappingAfterNamedSetAdded:()=>Ie,getQueryTotalsMetaData:()=>J,getSpecificMapping:()=>y,getSwitchAvailability:()=>g,getTargetCube:()=>E,getUpdatedWidgetStateAfterNamedSetAdded:()=>Ce,getWidgetStateWithUpdatedQueryAndMapping:()=>G,groupAttributes:()=>m,hideAllQueryTotals:()=>ht,hideQueryGrandTotal:()=>xt,hideQuerySubTotals:()=>gt,isAllMeasuresInMapping:()=>c,isCompositeHierarchyInMapping:()=>j,isDataVisualizationWidgetPlugin:()=>N,isDataVisualizationWidgetState:()=>M,isExpansionChain:()=>z,isHierarchyInMapping:()=>R,isKpiPropertyInMapping:()=>he,isMeasureInMapping:()=>re,isNamedSetInMapping:()=>ye,isWidgetStateWithStyle:()=>Qe,isWidgetWithQueryState:()=>v,moveFieldInMapping:()=>le,moveFieldInMdx:()=>ge,removeHierarchyFromExpansionChainInMapping:()=>me,showAllQueryTotals:()=>lt,showQueryGrandTotal:()=>yt,showQuerySubTotals:()=>ft,updateHiddenGrandTotalsQueryContextEntry:()=>_e,updateHiddenSubTotalsQueryContextEntry:()=>X,updateQueryContextEntry:()=>Y,useCube:()=>K,useIsQueryLazyLoaded:()=>Ze,useSwitchedWidgetState:()=>et,widgetActionTypes:()=>Pe,widgetReducer:()=>Le});var n=i(90147),r=i(29213),a=i(61858);class s extends Error{constructor(e){super(`Expected a data visualization plugin key, but got: ${e}`)}}var o=i(31529);const d={primaryNumeric:"numeric",primaryOrdinal:"ordinal",secondaryNumeric:"numeric",secondaryOrdinal:"ordinal",subplot:"ordinal"};function u(e){return d[e]}const c=e=>"allMeasures"===e.type;function m(e){const t=Object.entries(e).map((([e,t])=>({...t,name:e}))),i=(0,o.groupBy)(t,(e=>u(e.role)));return(0,o.mapValues)(i,(e=>(0,o.groupBy)(e,"role")))}const l=(e,t,i)=>{for(let n=0;n<t.length&&0!==i.length;n++){const r=t[n],a=r.maxNumberOfFields||1/0;for(;e[r.name].length<a&&i.length>0;){const t=i.shift();t&&e[r.name].push(t)}}};function p(e,t){return t.doesSupportMeasuresRedirection?e:e.filter((e=>!c(e)))}function h({mapping:e,attributes:t,fields:i,unmappedFields:n,widgetPlugin:r}){i.forEach(((i,a)=>{const s=p(i,r),o=t[a];if(o){const t=o.maxNumberOfFields||1/0;s.forEach((i=>{e[o.name].length<t?e[o.name].push(i):n.push(i)}))}else n.push(...s)}))}function y(e,t){const i=t.attributes??{},n=(0,o.mapValues)(i,(()=>[])),r=m(i);return Object.entries(e).forEach((([e,i])=>{const a=[],s=r?.[e]||[];if(Object.entries(i).forEach((([e,i])=>{const r=[],o=s?.[e]||[];h({mapping:n,attributes:o,fields:i,unmappedFields:r,widgetPlugin:t}),r.length>0&&l(n,o,a),a.push(...r)})),a.length>0&&l(n,(0,o.flatten)(Object.values(s)),a),a.length>0)throw new Error(`The chosen widget type does not support the current mapping: too many chosen ${e} fields.`)})),n}function x(e,t){const i={};return Object.entries(t).forEach((([t,n])=>{const r=u(n.role);(0,o.defaultsDeep)(i,{[r]:{[n.role]:[]}}),i[r][n.role].push(e[t]||[])})),i}function f(e,t,i){const n=e.mapping,a=t.attributes||{},s=i.attributes||{},d=t.doesSupportMeasuresRedirection,u=i.doesSupportMeasuresRedirection,m=y(x(n,a),i);if(d&&!u){const e=(0,o.findKey)(m,(e=>e.some(c)));e&&(m[e]=m[e].filter((e=>!c(e))))}else if(!d&&u){const t=e.query.mdx,i="ROWS"===(t&&(0,r.getMeasuresAxisName)(t))?"primaryOrdinal":"secondaryOrdinal",n=(0,o.findKey)(s,(e=>e.role===i));n&&m[n].push({type:"allMeasures"})}return m}function g(e,t,i){const n=Object.entries(e).reduce(((e,[n,r])=>{const a=u(t[n].role),s=p(r,i);return{...e,[a]:e[a]+s.length}}),{numeric:0,ordinal:0}),r=i.attributes||{},a=Object.values(r).reduce(((e,t)=>{const i=u(t.role);return{...e,[i]:e[i]+(t.maxNumberOfFields||1/0)}}),{numeric:0,ordinal:0});return n.numeric>a.numeric?{status:"tooManyNumeric",maxNumberOfFields:a.numeric}:n.ordinal>a.ordinal?{status:"tooManyOrdinal",maxNumberOfFields:a.ordinal}:{status:"ok"}}function b(e,{widgetPlugin:t,switchedWidgetPlugin:i,isQueryLazyLoaded:r}){if(r&&void 0===i?.lazyLoading)return e;const a=f(e,t,i);return(0,n.produce)(e,(e=>{e.widgetKey=i.key,Reflect.deleteProperty(e,"switchedTo"),e.mapping=a}))}const N=e=>"dataVisualization"===e.category;function v(e){return"query"in e}const M=e=>v(e)&&"mapping"in e;var w=i(96531);function I(e){return!(!e?.data||!(0,w.isCellSet)(e.data))&&e.data.axes.some((({range:e})=>e&&!e.entireAxis))}var C=i(86351),S=i(5029),T=i(11250),A=i(3065),O=i(80456),q=i(31793);function W({cubeName:e,dataModels:t}){const i=[];for(const n in t)for(const r of Object.values(t[n].catalogs))for(const t in r.cubes){if(t===e)return n;i.push(t)}throw new q.N(e,i)}function E({dataModels:e,serverKey:t,cubeName:i,lastUsedCube:n}){const r=Object.keys(e);if(0===r.length)throw new T.d({existingServerKeys:r});if(t&&!r.includes(t))throw new T.d({serverKey:t,existingServerKeys:r});if(t&&i){const n=e[t];return{cube:(0,O.W)(n,i),dataModel:n,serverKey:t}}if(t&&!i){const i=e[t],n=function({serverKey:e,dataModel:t}){const i=Object.values(t.catalogs).find((({cubes:e})=>Object.values(e).length>0));if(void 0===i)throw new A.F(e);return Object.values(i.cubes)[0]}({serverKey:t,dataModel:i});return{serverKey:t,dataModel:i,cube:n}}if(!t&&i)return E({dataModels:e,serverKey:W({cubeName:i,dataModels:e}),cubeName:i});if(n)try{return E({dataModels:e,serverKey:n.serverKey,cubeName:n.cubeName})}catch(e){if(!(e instanceof T.d||e instanceof q.N))throw e}return E({dataModels:e,serverKey:r[0]})}function F({initialCubeName:e,serverKey:t,...i},{dataModels:n,lastUsedCube:a}){return E({cubeName:v(i)&&i.query.mdx?(0,r.getCubeName)(i.query.mdx):e,serverKey:t,dataModels:n,lastUsedCube:a})}function K(e){return F(e,{dataModels:(0,C.W)(),lastUsedCube:(0,S.A)()})}const H=({widgetPlugins:e,contentClientState:t,atotiClientsState:i,queryId:n},r)=>{const o=r.widgetKey,d=(0,a.s)("widget",o,e);if(!M(r)||!N(d))throw new s(o);const{cube:u,serverKey:c}=((e,{contentClientState:t,atotiClientsState:i})=>{const n=t.activity?.lastUsedCube;return F(e,{dataModels:Object.fromEntries(Object.entries(i).filter((([,e])=>e.dataModel)).map((([e,t])=>[e,t.dataModel]))),lastUsedCube:n})})(r,{contentClientState:t,atotiClientsState:i}),m=r.switchedTo;if(!m)return{cube:u,serverKey:c,switchedWidgetState:r,switchedWidgetPlugin:d};const l=(0,a.s)("widget",m,e);if(!N(l))throw new s(m);const p=i[c]._map[n]?.queryResult,h=b(r,{widgetPlugin:d,switchedWidgetPlugin:l,isQueryLazyLoaded:I(p)});return{cube:u,serverKey:c,switchedWidgetState:h,switchedWidgetPlugin:h===r?d:l}},P=(e,{name:t,expression:i,properties:a,cube:s})=>{const o=e.query.mdx??(0,r.getDefaultMdxSelect)(s.name),d=(0,r.getSpecificCompoundIdentifier)(t,{cube:s});if("member"!==d.type&&"measure"!==d.type)throw new Error(`Calculated member's name must be a member or measure compound identifier. Got: ${d.type}`);const u=(0,r.addCalculatedMemberExpressionToWithClause)(o,{name:d,expression:i,properties:a});return(0,n.produce)(e,(e=>{e.query.mdx=u}))},D=({mapping:e,attributeName:t,attributes:i})=>(i[t].maxNumberOfFields||1/0)>e[t].length;function L(e,t,i){return Object.keys(t).find((n=>u(t[n].role)===i&&D({mapping:e,attributeName:n,attributes:t})))}var k=i(50466);const j=e=>"compositeHierarchy"===e.type,R=e=>"hierarchy"===e.type,Q=({cube:e,mapping:t,targetAttributeName:i,hierarchyCoordinates:r,indexOfExpansionChainInMappedFields:a,indexOfHierarchyInExpansionChain:s})=>(0,n.produce)(t,(t=>{const n=t[i][a],o=(0,k.q)(r,e),d=Object.keys(o.levels)[o.slicing?0:1];R(n)?t[i][a]={type:"compositeHierarchy",hierarchies:[{dimensionName:n.dimensionName,hierarchyName:n.hierarchyName,levelName:n.levelName,expandedDownTo:n.expandedDownTo},{dimensionName:r.dimensionName,hierarchyName:r.hierarchyName,levelName:d}]}:j(n)&&n.hierarchies.splice(s,0,{dimensionName:r.dimensionName,hierarchyName:r.hierarchyName,levelName:d})})),$=({mapping:e,attributeName:t,indexOfExpansionChainInMappedFields:i,indexOfHierarchyInExpansionChain:n})=>{const r=e[t][i];if(!j(r)&&!R(r))throw new Error(`The field: ${JSON.stringify(r,null,2)}, is neither a composite hierarchy nor a hierarchy.`);const a=R(r)?r:r.hierarchies[n-1];return{...a,levelName:a.expandedDownTo??a.levelName}};function G(e,{mapping:t,mdx:i,queryContext:r,serverKey:a}){return(0,n.produce)(e,(e=>{e.mapping=t,e.query.mdx=i,e.serverKey=a,e.queryContext=r,e.switchedTo&&(e.widgetKey=e.switchedTo,delete e.switchedTo)}))}function z(e){return R(e)&&Boolean(e.expandedDownTo)||j(e)}const B=(e,{dimensionName:t,hierarchyName:i,cube:n,serverKey:a,widgetAttributes:s,indexOfExpansionChainInMappedFields:o,indexOfHierarchyInExpansionChain:d,attributeName:u})=>{const{mapping:c,queryContext:m}=e,l=e.query.mdx??(0,r.getDefaultMdxSelect)(n.name),p=s??{},h=u??L(c,p,"ordinal");if(!h)return e;const y=L(c,p,"ordinal");if(!y)return e;const x=o??c[y].length-1,f=c[y].at(-1);if(!f||!z(f)&&!R(f))return e;const g=d??(R(f)?1:f.hierarchies.length),[b,N]=function({cube:e,mapping:t,mdx:i,hierarchyCoordinates:n,targetAttributeName:a,indexOfExpansionChainInMappedFields:s,indexOfHierarchyInExpansionChain:o}){const d=$({mapping:t,attributeName:a,indexOfExpansionChainInMappedFields:s,indexOfHierarchyInExpansionChain:o});return[Q({cube:e,mapping:t,targetAttributeName:a,hierarchyCoordinates:n,indexOfExpansionChainInMappedFields:s,indexOfHierarchyInExpansionChain:o}),(0,r.addHierarchyToExpansionChain)(i,{cube:e,hierarchyCoordinates:n,coordinatesOfLevelBefore:d})]}({cube:n,mapping:c,mdx:l,hierarchyCoordinates:{dimensionName:t,hierarchyName:i},targetAttributeName:h,indexOfExpansionChainInMappedFields:x,indexOfHierarchyInExpansionChain:g});return G(e,{mapping:b,mdx:N,serverKey:a,queryContext:m})};var U=i(71491),V=i(37154);function _(e){const t=e?.find((({key:e})=>"mdx.hiddensubtotals"===e))?.value;return(t?t.split(","):[]).map((e=>{const[t,i,n]=(0,r.unquote)(e);return{dimensionName:t,hierarchyName:i,levelName:n}}))}function J(e,{cube:t,queryContext:i}){const n={},a=function(e){const t=e?.find((({key:e})=>"mdx.hiddengrandtotals"===e))?.value;return t?t.split(","):[]}(i),s=_(i);for(const i of e.axes)n[i.name]=(0,r.getAxisTotalsMetaData)(i,{cube:t,hiddenGrandTotalsInQueryContext:a,hiddenSubTotalsInQueryContext:s});return n}function Y(e,{key:t,value:i}){const n=e.findIndex((({key:e})=>e===t));if(i)-1===n?e.push({key:t,value:i}):e[n]={key:t,value:i};else{if(-1===n)return;e.splice(n,1)}}function X(e,{levelsWithHiddenTotals:t}){const i=(0,o.uniqWith)(t,V.M).map(r.getLevelUniqueName).join(",");Y(e,{value:0===i.length?void 0:i,key:"mdx.hiddensubtotals"})}function Z(e,{mdx:t,cube:i}){if(!e)return;const n=_(e),r=J(t,{cube:i,queryContext:e}),a=Object.values(r).flatMap((e=>e.levelsWithToggleableTotals));X(e,{levelsWithHiddenTotals:(0,o.intersectionWith)(n,a,V.M)})}function ee(e,t){if("numeric"===u(e))return(0,r.getMeasuresAxisName)(t);switch(e){case"primaryOrdinal":return"ROWS";case"secondaryOrdinal":case"subplot":return"COLUMNS";default:throw new Error(`Unknown ordinal attribute role: "${e}". Supported ordinal roles are ["primaryOrdinal", "secondaryOrdinal", "subplot"]`)}}const te=(e,t)=>{switch(e.type){case"hierarchy":case"namedSet":return 1;case"allMeasures":return t?1:0;case"compositeHierarchy":return e.hierarchies.length;default:return 0}},ie=({targetAttributeName:e,indexInMappedFields:t,mapping:i,attributes:n,mdx:r})=>{const a=ee(n[e].role,r);let s=0;const d=(0,o.some)(n,((e,t)=>"numeric"===u(e.role)&&i[t].length>0));e:for(const o in n){const c=n[o],m=i[o];if("ordinal"===u(c.role)&&ee(c.role,r)===a)for(let i=0;i<m.length;i++){if(o===e&&i===t)break e;const n=m[i];s+=te(n,d)}}return s},ne=(e,{dimensionName:t,hierarchyName:i,levelName:a,cube:s,serverKey:o,widgetAttributes:d,doesIncludeCalculatedMembers:u,doesIncludeTotals:c,attributeName:m,indexInMappedFields:l})=>{const{mapping:p,queryContext:h}=e,y=e.query.mdx??(0,r.getDefaultMdxSelect)(s.name),x=d??{},f=m??L(p,x,"ordinal");if(!f)return e;const g=p[f].length,[b,N,v]=function({attributes:e,cube:t,mapping:i,mdx:a,queryContext:s,indexInMappedFields:o,targetAttributeName:d,dimensionName:u,hierarchyName:c,levelName:m,doesIncludeCalculatedMembers:l,doesIncludeTotals:p}){const h=(0,n.produce)(i,(e=>{const t={type:"hierarchy",dimensionName:u,hierarchyName:c,levelName:m};e[d].splice(o,0,t)})),{role:y}=e[d],x=ee(y,a),f=ie({targetAttributeName:d,indexInMappedFields:o,mapping:h,attributes:e,mdx:a}),g=(0,r.addLevel)(a,{axisName:x,cube:t,dimensionName:u,hierarchyName:c,levelName:m,indexOnAxis:f,doesIncludeCalculatedMembers:l});if(p)return[h,g,s];const b=(0,k.q)({dimensionName:u,hierarchyName:c},t),N=b.levels[m].index,v=Object.values(b.levels).filter((e=>{const t=b.slicing?0:1;return e.index>=t&&e.index<=N})).map((e=>({hierarchyName:c,dimensionName:u,levelName:e.name}))),M=o===h[d].length-1;if(0!==o&&M){const e=h[d][o-1];e&&R(e)&&v.push({hierarchyName:e.hierarchyName,dimensionName:e.dimensionName,levelName:e.levelName})}const w=_(s);if(0===v.length)return[h,g,s];const I=(0,n.produce)(s??[],(e=>{X(e,{levelsWithHiddenTotals:[...w,...v]}),Z(e,{mdx:g,cube:t})}));return[h,g,I]}({attributes:x,cube:s,mapping:p,mdx:y,queryContext:h,targetAttributeName:f,dimensionName:t,hierarchyName:i,levelName:a,indexInMappedFields:l??g,doesIncludeCalculatedMembers:u,doesIncludeTotals:c});return G(e,{mapping:b,mdx:N,queryContext:v,serverKey:o})},re=e=>"measure"===e.type,ae=({measureName:e,mapping:t,attributeName:i,attributes:n})=>!!D({mapping:t,attributeName:i,attributes:n})&&("numeric"===u(n[i].role)&&!t[i].some((t=>re(t)&&t.measureName===e))),se=e=>(0,o.pickBy)(e,(e=>"numeric"===u(e.role))),oe=({attributeName:e,indexInMappedFields:t,mapping:i,attributes:n})=>{let r=t;const a=Object.keys(se(n));return a.slice(0,a.indexOf(e)).forEach((e=>{r+=i[e].length})),r};const de=(e,{cube:t,measureName:i,serverKey:a,widgetAttributes:s,doesSupportMeasuresRedirection:d,attributeName:u,indexInMappedFields:m})=>{const{mapping:l}=e,p=s??{},h=u??L(l,p,"numeric"),y=e.query.mdx??(0,r.getDefaultMdxSelect)(t.name);if(h&&ae({measureName:i,mapping:l,attributeName:h,attributes:p})){const u=l[h].length,[p,x]=function({attributeName:e,cube:t,mapping:i,mdx:a,measureName:s,indexInMappedFields:d,widgetAttributes:u,doesSupportMeasuresRedirection:m}){const l=u??{},p=function(e){const{mapping:t,attributes:i,attributeName:r,indexInMappedFields:a,measureName:s,doesSupportMeasuresRedirection:d}=e;return(0,n.produce)(t,(e=>{const n={type:"measure",measureName:s};if(e[r].splice(a,0,n),d&&!(0,o.findKey)(t,(e=>e.find((e=>c(e)))))){const t=(0,o.findKey)(i,(e=>"secondaryOrdinal"===e.role));t&&e[t].push({type:"allMeasures"})}}))}({mapping:i,attributes:l,attributeName:e,measureName:s,indexInMappedFields:d,doesSupportMeasuresRedirection:m});return[p,(0,r.addMeasure)(a,{cube:t,measureName:s,measureIndex:oe({attributeName:e,indexInMappedFields:d,mapping:p,attributes:l})})]}({cube:t,mapping:l,mdx:y,attributeName:h,measureName:i,indexInMappedFields:m??u,widgetAttributes:s,doesSupportMeasuresRedirection:d});return G(e,{mapping:p,mdx:x,serverKey:a,queryContext:e.queryContext})}return e};function ue(e,t){return"kpiProperty"===e.type&&e.underlyingMeasureName===t||"measure"===e.type&&e.measureName===t}const ce=(e,{measureName:t,attributeName:i,indexInMappedFields:n})=>{if(i&&void 0!==n)return e[i][n]&&ue(e[i][n],t)?{indexInMappedFields:n,attributeName:i}:void 0;if(i){const n=e[i].findIndex((e=>ue(e,t)));return-1===n?void 0:{indexInMappedFields:n,attributeName:i}}for(const i in e){const r=ce(e,{measureName:t,attributeName:i,indexInMappedFields:n});if(r)return r}},me=({mapping:e,attributeName:t,indexOfExpansionChainInMappedFields:i,indexOfHierarchyInExpansionChain:r})=>{if(0===r)throw new Error("The first hierarchy of an expansion chain cannot be removed.");return(0,n.produce)(e,(e=>{const n=e[t][i];if(!j(n))throw new Error("There is no expansion chain to remove a hierarchy from.");2===n.hierarchies.length?e[t][i]={type:"hierarchy",...n.hierarchies[0]}:n.hierarchies.splice(r,1)}))},le=({mapping:e,cube:t,fromPosition:i,toPosition:r})=>{const a=e[i.sectionName][i.tileIndex];let s=e;if(e[i.sectionName]&&(s="subtileIndex"in i?me({mapping:s,attributeName:i.sectionName,indexOfExpansionChainInMappedFields:i.tileIndex,indexOfHierarchyInExpansionChain:i.subtileIndex+1}):(0,n.produce)(s,(e=>{e[i.sectionName].splice(i.tileIndex,1)}))),"subtileIndex"in r){if(!(R(a)||j(a)&&"subtileIndex"in i))throw new Error(`Cannot move field ${JSON.stringify(a,null,2)} to an expansion chain, as it does not represent a hierarchy.`);const e="subtileIndex"in i?i.subtileIndex:void 0,{dimensionName:n,hierarchyName:o}=j(a)?a.hierarchies[e+1]:a;s=Q({cube:t,mapping:s,targetAttributeName:r.sectionName,hierarchyCoordinates:{dimensionName:n,hierarchyName:o},indexOfExpansionChainInMappedFields:r.tileIndex,indexOfHierarchyInExpansionChain:r.subtileIndex+1})}else s=(0,n.produce)(s,(e=>{e[r.sectionName].splice(r.tileIndex,0,j(a)&&"subtileIndex"in i?{...a.hierarchies[i.subtileIndex+1],type:"hierarchy",expandedDownTo:void 0}:a)}));return s};var pe=i(82224);function he(e){return"kpiProperty"===e.type}const ye=e=>"namedSet"===e.type;function xe({mdx:e,cube:t,field:i}){if(j(i))throw new Error("Nested composite hierarchies are not supported.");return(0,r.removeHierarchyFromExpansionChain)(e,{cube:t,hierarchyCoordinates:{hierarchyName:i.hierarchyName,dimensionName:i.dimensionName}})}function fe({cube:e,hierarchyCoordinates:t,fromPosition:i,mapping:n,mdx:a,toPosition:s}){const o=$({mapping:n,attributeName:i.sectionName,indexOfExpansionChainInMappedFields:i.tileIndex,indexOfHierarchyInExpansionChain:s.subtileIndex+1});return(0,r.addHierarchyToExpansionChain)(a,{cube:e,hierarchyCoordinates:t,coordinatesOfLevelBefore:o})}function ge({attributes:e,cube:t,fromPosition:i,toPosition:n,mapping:a,mdx:s,updatedMapping:o}){const d=function({fromPosition:e,mapping:t}){const i=t[e.sectionName][e.tileIndex];if((0,pe.o)(e)){if(!j(i))throw new Error(`The field mapped to attribute ${e.sectionName} at index ${e.tileIndex} is not a composite hierarchy: ${JSON.stringify(t[e.sectionName],null,2)} `);return{type:"hierarchy",...i.hierarchies[e.subtileIndex+1]}}return i}({fromPosition:i,mapping:a}),u=re(d)||he(d),[m,l]=[{position:i,mapping:a},{position:n,mapping:o}].map((({position:t,mapping:i})=>ie({targetAttributeName:t.sectionName,attributes:e,indexInMappedFields:t.tileIndex,mapping:i,mdx:s}))),{role:p}=e[i.sectionName],{role:h}=e[n.sectionName],y=ee(p,s),x=ee(h,s),f=i.sectionName===n.sectionName&&i.tileIndex===n.tileIndex&&(0,pe.o)(i)&&(0,pe.o)(n),g=x===y&&m===l,b=((0,pe.o)(i)||(0,pe.o)(n))&&i.tileIndex===n.tileIndex;let N=s;if(R(d)&&f){const e=xe({cube:t,field:d,mdx:s});return fe({cube:t,hierarchyCoordinates:{dimensionName:d.dimensionName,hierarchyName:d.hierarchyName},fromPosition:i,toPosition:n,mapping:a,mdx:e})}if(g&&!u&&!b)return s;if(c(d))return(0,r.moveAllMeasures)(s,{axisName:x,cube:t,indexOnAxis:l});if(u){const u=oe({attributeName:i.sectionName,indexInMappedFields:i.tileIndex,mapping:a,attributes:e}),c=oe({attributeName:n.sectionName,indexInMappedFields:n.tileIndex,mapping:o,attributes:e});if(u!==c){if(re(d)){const{measureName:e}=d;return(0,r.moveMeasure)(s,{cube:t,measureName:e,measureIndex:c})}if(he(d)){const{underlyingMeasureName:e}=d;return(0,r.moveMeasure)(s,{cube:t,measureName:e,measureIndex:c})}}}if(R(d)||j(d)){const{dimensionName:e,hierarchyName:o,levelName:u}=R(d)?d:d.hierarchies[0],c=(0,r.findLevelExpression)(s,{cube:t,dimensionName:e,hierarchyName:o,levelName:u});N=(0,pe.o)(i)?xe({mdx:s,cube:t,field:d}):(0,r.removeHierarchy)(N,{cube:t,dimensionName:e,hierarchyName:o}),N=(0,pe.o)(n)?fe({cube:t,mapping:a,mdx:N,toPosition:n,fromPosition:i,hierarchyCoordinates:{dimensionName:e,hierarchyName:o}}):c?(0,r.addExpressionToAxis)(N,{cube:t,addedExpression:c,indexOnAxis:l,axisName:x}):(0,r.addLevel)(N,{dimensionName:e,hierarchyName:o,levelName:u,cube:t,indexOnAxis:l,axisName:x})}return ye(d)?(0,r.moveNamedSet)(N,{cube:t,setName:d.name,indexOnAxis:l,axisName:x}):N}const be=(e,{measureName:t,cube:i,serverKey:n,widgetAttributes:a,from:s,to:d})=>{const{mapping:u,queryContext:c}=e,m=e.query.mdx??(0,r.getDefaultMdxSelect)(i.name),l=a??{},p=ce(u,{measureName:t,...s});if(!p)return e;const h={sectionName:p.attributeName,tileIndex:p.indexInMappedFields},y={sectionName:d.attributeName,tileIndex:d.indexInMappedFields??u[d.attributeName].length};if((0,o.isEqual)(h,y))return e;const x=le({mapping:u,cube:i,fromPosition:h,toPosition:y});return G(e,{mapping:x,mdx:ge({attributes:l,cube:i,fromPosition:h,toPosition:y,mapping:u,mdx:m,updatedMapping:x}),queryContext:c,serverKey:n})};var Ne=i(66318);const ve=({dimensionName:e,hierarchyName:t,attributeName:i,mapping:n,cube:a})=>n[i].some((i=>(({dimensionName:e,hierarchyName:t,field:i,cube:n})=>R(i)?i.dimensionName===e&&i.hierarchyName===t:j(i)?i.hierarchies.some((i=>i.dimensionName===e&&i.hierarchyName===t)):!!ye(i)&&(0,r.getCubeNamedSetHierarchies)(i.name,{cube:n}).some((i=>(0,Ne.q)(i,{hierarchyName:t,dimensionName:e}))))({field:i,dimensionName:e,hierarchyName:t,cube:a}))),Me=({dimensionName:e,hierarchyName:t,mapping:i,attributeName:n,indexInMappedFields:r,indexOfHierarchyInExpansionChain:a,attributes:s,mdx:o,cube:d})=>{const c=void 0!==a;if(!c&&!D({mapping:i,attributeName:n,attributes:s}))return!1;if("numeric"===u(s[n].role))return!1;if(ve({dimensionName:e,hierarchyName:t,attributeName:n,mapping:i,cube:d}))return!1;const m=ee(s[n].role,o);if(Object.entries(s).some((([r,a])=>r!==n&&(!(ee(a.role,o)===m)&&ve({dimensionName:e,hierarchyName:t,attributeName:r,mapping:i,cube:d})))))return!1;const l=i[n].findIndex(z);if(c){const e=i[n].at(-1);return!!e&&(-1===l&&r===i[n].length-1&&!ye(e)||l===r)}return!(-1!==l&&r>l)},we=({setName:e,mapping:t,attributeName:i,indexInMappedFields:n,indexOfHierarchyInExpansionChain:a,attributes:s,mdx:o,cube:d})=>!(void 0!==a)&&(0,r.getCubeNamedSetHierarchies)(e,{cube:d}).every((({dimensionName:e,hierarchyName:r})=>Me({dimensionName:e,hierarchyName:r,mapping:t,attributeName:i,indexInMappedFields:n,attributes:s,mdx:o,cube:d})));function Ie({attributes:e,attributeName:t,cube:i,mapping:a,mdx:s,indexInMappedFields:o,setName:d}){const u=(0,n.produce)(a,(e=>{const i={type:"namedSet",name:d};e[t].splice(o,0,i)})),{role:c}=e[t],m=ee(c,s);return[u,(0,r.addNamedSet)(s,{axisName:m,cube:i,setName:d,indexOnAxis:ie({targetAttributeName:t,indexInMappedFields:o,mapping:u,attributes:e,mdx:s})})]}const Ce=(e,{attributes:t,setName:i,cube:n,serverKey:a,attributeName:s,indexInMappedFields:o})=>{const{mapping:d}=e,u=t??{},c=L(d,u,"ordinal");if(!c)return e;const m=e.query.mdx??(0,r.getDefaultMdxSelect)(n.name),l=d[c],p=s??c,h=o??l.length;if(!we({setName:i,mapping:d,attributeName:p,attributes:u,indexInMappedFields:h,mdx:m,cube:n}))return e;const[y,x]=Ie({attributeName:p,attributes:u,cube:n,mapping:d,mdx:m,setName:i,indexInMappedFields:h});return G(e,{mapping:y,mdx:x,serverKey:a,queryContext:e.queryContext})};var Se=i(57019),Te=i(90506),Ae=i(69275),Oe=i(46116);const qe=(e,t)=>{try{"levelName"in e?(0,Se.r)(e,t):(0,k.q)(e,t)}catch(e){if(e instanceof Te.O||e instanceof Ae.h||e instanceof Oe.W)return!1;throw e}return!0};function We(e,{dimensionName:t,hierarchyName:i}){for(const n in e)for(let r=0;r<e[n].length;r++){const a=e[n][r];if(R(a)&&(0,Ne.q)(a,{dimensionName:t,hierarchyName:i}))return{attributeName:n,fieldIndex:r,type:"hierarchy"};if(j(a))for(let e=0;e<a.hierarchies.length;e++){const s=a.hierarchies[e];if((0,Ne.q)(s,{dimensionName:t,hierarchyName:i}))return{attributeName:n,fieldIndex:r,hierarchyIndex:e,type:"compositeHierarchy"}}}}const Ee=(e,{dimensionName:t,hierarchyName:i,cube:a,attributeName:s,indexInMappedFields:o})=>{const{mapping:d,query:u}=e;return(0,n.produce)(e,(e=>{if(u.mdx){const n=!qe({dimensionName:t,hierarchyName:i},a);e.query.mdx=n?(0,r.unsafeRemoveHierarchy)(u.mdx,{dimensionName:t,hierarchyName:i},a):(0,r.removeHierarchy)(u.mdx,{cube:a,dimensionName:t,hierarchyName:i}),Z(e.queryContext,{mdx:e.query.mdx,cube:a})}if(s&&o)e.mapping[s].splice(o,1);else{const n=We(d,{dimensionName:t,hierarchyName:i});if(!n)return;e.mapping[s??n.attributeName].splice(o??n.fieldIndex,1)}}))},Fe=(e,{measureName:t,cube:i,attributeName:a,indexInMappedFields:s})=>{const{mapping:d,query:u}=e,m=ce(d,{measureName:t,attributeName:a,indexInMappedFields:s});return m?(0,n.produce)(e,(e=>{u.mdx&&(e.query.mdx=(0,r.removeMeasure)(u.mdx,{cube:i,measureName:t})),e.mapping=function(e,{attributeName:t,indexInMappedFields:i}){return(0,n.produce)(e,(e=>{if(e[t].splice(i,1),!(0,o.findKey)(e,(e=>e.find((e=>re(e)))))){const t=(0,o.findKey)(e,(e=>e.find((e=>c(e)))));t&&(0,o.remove)(e[t],(e=>c(e)))}}))}(d,{attributeName:m.attributeName,indexInMappedFields:m.indexInMappedFields})})):e},Ke={measureAdded:(e,t,i)=>{const{cube:n,serverKey:r,switchedWidgetState:a,switchedWidgetPlugin:s}=H(i,t);return{...e,switchedWidgetState:a,cube:n,serverKey:r,doesSupportMeasuresRedirection:s.doesSupportMeasuresRedirection,widgetAttributes:s.attributes}},measureMoved:(e,t,i)=>{const{cube:n,serverKey:r,switchedWidgetState:a,switchedWidgetPlugin:s}=H(i,t);return{...e,switchedWidgetState:a,cube:n,serverKey:r,widgetAttributes:s.attributes}},measureRemoved:(e,t,i)=>{const{cube:n,switchedWidgetState:r}=H(i,t);return{...e,switchedWidgetState:r,cube:n}},levelAdded:(e,t,i)=>{const{cube:n,serverKey:r,switchedWidgetState:a,switchedWidgetPlugin:s}=H(i,t),o=(0,U.P)(i.contentClientState,"mdx.doesIncludeCalculatedMembers"),d=(0,U.P)(i.contentClientState,"totals.areAddedByDefault");return{...e,switchedWidgetState:a,cube:n,serverKey:r,widgetAttributes:s.attributes,doesIncludeCalculatedMembers:o,doesIncludeTotals:d}},hierarchyAddedToExpansionChain:(e,t,i)=>{const{cube:n,serverKey:r,switchedWidgetState:a,switchedWidgetPlugin:s}=H(i,t);return{...e,switchedWidgetState:a,cube:n,serverKey:r,widgetAttributes:s.attributes}},hierarchyRemoved:(e,t,i)=>{const{cube:n,switchedWidgetState:r}=H(i,t);return{...e,switchedWidgetState:r,cube:n}},namedSetAdded:(e,t,i)=>{const{cube:n,serverKey:r,switchedWidgetState:a,switchedWidgetPlugin:s}=H(i,t);return{...e,switchedWidgetState:a,cube:n,serverKey:r,attributes:s.attributes}},calculatedMemberDefined:(e,t,i)=>{const{cube:n,switchedWidgetState:r}=H(i,t);return{...e,switchedWidgetState:r,cube:n}}},He=["measureAdded","measureMoved","measureRemoved","levelAdded","hierarchyAddedToExpansionChain","hierarchyRemoved","namedSetAdded","calculatedMemberDefined","widgetSwitched"],Pe=He,De=(e,{targetWidgetKey:t})=>(0,n.produce)(e,(e=>{t===e.widgetKey?delete e.switchedTo:e.switchedTo=t}));function Le(e,t){switch(t.type){case"measureAdded":case"measureMoved":case"measureRemoved":case"levelAdded":case"hierarchyAddedToExpansionChain":case"namedSetAdded":case"hierarchyRemoved":case"widgetSwitched":case"calculatedMemberDefined":return M(e)&&function(e){return He.includes(e.type)}(t)?ke(e,t):e}}function ke(e,t){switch(t.type){case"measureAdded":return de(e,t);case"measureMoved":return be(e,t);case"measureRemoved":return Fe(e,t);case"levelAdded":return ne(e,t);case"hierarchyAddedToExpansionChain":return B(e,t);case"namedSetAdded":return Ce(e,t);case"hierarchyRemoved":return Ee(e,t);case"widgetSwitched":return De(e,t);case"calculatedMemberDefined":return P(e,t)}}function je({widgetState:e,setName:t,cube:i}){if(!v(e))return!1;const n=e.query.mdx;return!!n&&Boolean((0,r.findDescendant)(n,(e=>(0,r.isMdxNamedSetCompoundIdentifier)(e,{setName:t,cube:i}))))}function Re(e){v(e)&&(delete e.areFiltersDrivenByMdx,e.query?.mdx&&(e.query.mdx=(0,r.removeAllFilters)(e.query.mdx)))}function Qe(e){return"style"in e}var $e=i(23397),Ge=i(20298);class ze extends Error{attributeName;serializedMappingField;constructor(e,t){super(`Can not deserialize the "${t}" field with stringified value "${e}" in mapping.`),this.attributeName=t,this.serializedMappingField=e}}const Be=/^\[.*\]$/;var Ue=i(25079);function Ve(e){const t=function(e){return M(e)?(0,n.produce)(e,(e=>{const t=e.mapping;return Object.entries(t).forEach((([t,i])=>{const n=i.map((e=>{if("ALL_MEASURES"===e)return{type:"allMeasures"};if(e.startsWith("[Measures]."))return{type:"measure",measureName:(0,r.unquote)(e)[1]};if(e.startsWith("KPI")){const t=function(e){const t=new Error(`Unable to parse string "${e}" as a KPI property.`),i=e.indexOf("(");let n=1,r=i+1;for(;n>0&&r<e.length;)"("===e[r]&&n++,")"===e[r]&&n--,r++;if(n>0)throw t;const a=r-1,s=e.slice(0,i),o=e.slice(i+1,a),d=e.slice(a+3),u=$e.L.find(((e,t)=>Ge.S[t]===s.toLowerCase()));if(!u)throw t;return{kpiName:o,kpiPropertyName:u,underlyingMeasureName:d}}(e);return{type:"kpiProperty",propertyName:t.kpiPropertyName,kpiName:t.kpiName,underlyingMeasureName:t.underlyingMeasureName}}if(e.indexOf(" => ")>-1){const t=e.split(" => "),i=[];for(let e=0;e<t.length;e++){const[n,a,s]=(0,r.unquote)(t[e]),o=i.at(-1);(0,Ne.q)({dimensionName:n,hierarchyName:a},o)?o.expandedDownTo=s:i.push({dimensionName:n,hierarchyName:a,levelName:s})}return 1===i.length?{type:"hierarchy",...i[0]}:{type:"compositeHierarchy",hierarchies:i}}if(Be.test(e)){const t=(0,r.unquote)(e);if(1===t.length)return{type:"namedSet",name:t[0]};const[i,n,a]=t;return{levelName:a,dimensionName:i,hierarchyName:n,type:"hierarchy"}}throw new ze(e,t)}));e.mapping[t]=n})),e})):e}(function(e){const t={...e,filters:e.filters?.map(Ue.w)};return void 0===t.filters&&delete t.filters,v(e)&&v(t)&&e.query.mdx&&(t.query={...e.query,mdx:(0,r.parse)(e.query.mdx)}),t}(function(e){if(!Qe(e))return e;const t=e.style?.tupleImpactingRowStyle;if(!t)return e;const i={...e.style,tupleImpactingRowStyle:t.map((e=>{const t=(0,r.unquote)(e);return 2===t.length&&"Measures"===t[0]?{dimensionName:"Measures",hierarchyName:"Measures",namePath:[t[1]]}:{dimensionName:t[0],hierarchyName:t[1],namePath:t.slice(2)}}))};return{...e,style:i}}(e)));return t}function _e(e,{axesWithHiddenGrandTotal:t}){const i=t.map(r.getAxisId),n=(0,o.uniq)(i).join(",");Y(e,{value:0===n.length?void 0:n,key:"mdx.hiddengrandtotals"})}var Je=i(93345),Ye=i(29549),Xe=i(152);function Ze({queryId:e,widgetState:t}){return I((0,Xe.J)({queryId:e,serverKey:t&&v(t)?t.serverKey:void 0}))}function et(e,t){const i=(0,Ye.useWidgetPlugin)(e.widgetKey),n=M(e)&&N(i)?e.switchedTo:void 0,r=Ze({queryId:t,widgetState:e}),a=(0,Ye.useWidgetPlugin)(n);return(0,Je.useMemo)((()=>n&&M(e)&&N(i)&&a&&N(a)?b(e,{widgetPlugin:i,switchedWidgetPlugin:a,isQueryLazyLoaded:r}):e),[e,i,n,a,r])}var tt=i(13029);class it extends Error{}const nt=({dimensionName:e,hierarchyName:t,levelName:i})=>(0,r.quote)(e,t,i),rt=({levels:e,expansionChains:t,cube:i})=>{const n=[],r=e.slice(),a=t.slice();for(;r.length>0;){const t=r.shift(),s=(0,o.remove)(a,(([e])=>(0,V.M)(e,t)));if(s.length>1)throw new it(`The level ${nt(t)} belongs to several expansion chains: ${JSON.stringify(s.map((e=>e.map(nt))),null,2)}`);if(0===s.length)n.push({type:"hierarchy",...t});else{const a=[t];s[0].slice(1).forEach((t=>{if(!(0,o.remove)(r,(e=>(0,V.M)(e,t)))[0]){const i=nt(t),n=JSON.stringify(e.map(nt));throw new it(`The level ${i} is in an expansion chain, but does not contribute to the axis dimensionality: ${n}.`)}const n=a.at(-1);if((0,Ne.q)(n,t)){const e=(0,Se.r)(t,i).name;n.expandedDownTo=e}else a.push(t)})),n.push(a.length>1?{type:"compositeHierarchy",hierarchies:a}:{type:"hierarchy",...a[0]})}}if(a.length>0)throw new it(`Some expansion chains are incompatible with the levels used on the axis:\n      Incompatible expansion chains: ${JSON.stringify(a.map((e=>e.map(nt))))}\n      Levels used on axis: ${JSON.stringify(e.map(nt))}\n      `);return n},at=(e,t)=>(0,V.M)(e.at(-1),t.fromLevel)?"right":!!(0,V.M)((0,o.first)(e),t.toLevel)&&"left";function st(e,t=[]){if(0===e.length)return t;if(0===t.length){const i=e.pop();t.push([i.fromLevel,i.toLevel])}for(let i=0;i<e.length;i++){const n=e[i];for(const r of t){const a=at(r,n);if(a)return e.splice(i,1),"right"===a?r.push(n.toLevel):r.unshift(n.fromLevel),st(e,t)}}return[...t,...st(e)]}function ot(e){return st(e.slice())}var dt=i(86189);const ut=(e,t)=>(0,o.uniqWith)(e.map((({tupleCoordinates:e,toLevel:i})=>{const n=e.at(-1);if((0,dt.t)(n))throw new it("'Expand by' under a measure is not supported.");const{dimensionName:r,hierarchyName:a,namePath:s}=n,o=(0,k.q)({dimensionName:r,hierarchyName:a},t),d=s.length-1;return{fromLevel:{dimensionName:r,hierarchyName:a,levelName:Object.keys(o.levels)[d]},toLevel:i}})),o.isEqual),ct=["value","goal","start","expiry","status","trend"];function mt({mdx:e,cube:t,widgetPlugin:i}){const{attributes:n,doesSupportMeasuresRedirection:a}=i;if(!n)throw new Error("Cannot derive a mapping from Mdx for a widget plugin which does not define attributes.");if(!e)return i.initialState.mapping;const s=function({mdx:e,cube:t,shouldIncludeAllMeasures:i=!0}){const[n,a]=[r.axisIds.rows,r.axisIds.columns].map((i=>{const n=(e?.axes||[]).find((({name:e})=>(0,r.getAxisId)(e)===i));if(void 0===n)return[];const a=(0,r.getLevels)(n,{cube:t}).filter((e=>(0,k.q)(e,t).slicing||"ALL"!==e.levelName));try{const e=(0,r.getExpandedTuples)(n,t),i=ot(ut(e,t));return rt({levels:a,expansionChains:i,cube:t})}catch(e){if(e instanceof it)return a.map((e=>({...e,type:"hierarchy"})));throw e}})),s=(0,r.getMeasureNames)(e),d=(0,r.getCalculatedMeasures)(e),u=s.map((e=>{const i=(0,r.quote)("Measures",e),n=!1===(0,tt.D)(e,t)?.visible;let a;const s=d[e]?.properties.find((({name:e})=>"MEMBER_CAPTION"===e||"CAPTION"===e))?.expression;if(void 0!==s&&(0,r.isMdxLiteral)(s)&&(a=s.value),n)for(const n of Object.values(t.kpis))for(const t of ct)if(n[t]===i)return[{type:"kpiProperty",kpiName:n.name,propertyName:`KPI${(0,o.capitalize)(t)}`,underlyingMeasureName:e}];return a?[{measureName:e,type:"measure",caption:a}]:[{measureName:e,type:"measure"}]}));if(i)if(0===s.length)a.unshift({type:"allMeasures"});else{const t=(0,r.getMeasuresAxisName)(e),i=(0,r.getMeasuresPositionOnAxis)((0,r.getAxisByName)(e,t));((0,r.getAxisId)(t)===r.axisIds.rows?n:a).splice(i,0,{type:"allMeasures"})}return{numeric:{primaryNumeric:u},ordinal:{primaryOrdinal:[n],secondaryOrdinal:[a]}}}({mdx:e,cube:t,shouldIncludeAllMeasures:a});return y(s,i)}const lt=(e,{cube:t,queryTotalsMetaData:i})=>(0,n.produce)(e,(e=>{e.queryContext??=[],Object.entries(i).forEach((([i,{deepLevelsExpressedWithMembers:n}])=>{n.length>0&&n.forEach((({pathWithinAxis:n,...a})=>{const s=(0,r.getAxisByName)(e.query.mdx,i);s&&(0,r.replaceWithDescendantsFunction)({mdx:s,path:n,levelCoordinates:a,cube:t})}))})),X(e.queryContext,{levelsWithHiddenTotals:[]}),_e(e.queryContext,{axesWithHiddenGrandTotal:[]})}));var pt=i(45123);const ht=(e,{queryTotalsMetaData:t})=>(0,n.produce)(e,(e=>{e.queryContext??=[],_e(e.queryContext,{axesWithHiddenGrandTotal:(0,pt.u)(t)});const i=Object.values(t).flatMap((e=>e.levelsWithToggleableTotals));X(e.queryContext,{levelsWithHiddenTotals:i})})),yt=(e,{axisName:t,cube:i,queryTotalsMetaData:a})=>{const s=a[t];if(!s)return e;if(!s.isGrandTotalHidden)return e;const{deepLevelsExpressedWithMembers:d,levelsWithHiddenTotals:u}=s,c=(0,n.produce)(e,(e=>{e.queryContext??=[];const n=(0,r.getAxisByName)(e.query.mdx,t);if(d.length>0&&n){for(const{pathWithinAxis:e,...t}of d)(0,r.replaceWithDescendantsFunction)({mdx:n,path:e,levelCoordinates:t,cube:i});const s=(0,o.omit)(a,t),c=Object.values(s).flatMap((e=>e.levelsWithHiddenTotalsThroughQueryContext));X(e.queryContext,{levelsWithHiddenTotals:[...c,...u]})}const s=(0,pt.u)(a).filter((e=>a[e]?.isGrandTotalHiddenThroughQueryContext)),c=s.filter((e=>e!==t));_e(e.queryContext,{axesWithHiddenGrandTotal:c})}));return c},xt=(e,{axisName:t,queryTotalsMetaData:i})=>{const r=i[t];return r?r.isGrandTotalHidden?e:(0,n.produce)(e,(e=>{e.queryContext??=[];const n=(0,pt.u)(i).filter((e=>i[e]?.isGrandTotalHiddenThroughQueryContext));_e(e.queryContext,{axesWithHiddenGrandTotal:[...n,t]})})):e};function ft(e,{cube:t,axisName:i,levelCoordinates:a,queryTotalsMetaData:s}){const d=s[i];if(!d)return e;const u=d.levelsWithHiddenTotals.findIndex((e=>(0,V.M)(a,e)));return-1===u?e:(0,n.produce)(e,(e=>{e.queryContext??=[];const{levelsWithHiddenTotals:n,deepLevelsExpressedWithMembers:a}=d,c=(0,r.getAxisByName)(e.query.mdx,i);if(a.length>0&&c){for(const{pathWithinAxis:e,...i}of a)(0,r.replaceWithDescendantsFunction)({mdx:c,path:e,levelCoordinates:i,cube:t});const n=(0,pt.u)(s).filter((e=>s[e]?.isGrandTotalHiddenThroughQueryContext));_e(e.queryContext,{axesWithHiddenGrandTotal:[...n,i]})}const m=n.filter(((e,t)=>t!==u)),l=(0,o.omit)(s,i),p=Object.values(l).flatMap((e=>e.levelsWithHiddenTotalsThroughQueryContext));X(e.queryContext,{levelsWithHiddenTotals:[...p,...m]})}))}function gt(e,{axisName:t,levelCoordinates:i,queryTotalsMetaData:r}){const a=r[t];return a?a.levelsWithHiddenTotals.some((e=>(0,V.M)(e,i)))?e:(0,n.produce)(e,(e=>{e.queryContext??=[];const n=(0,o.omit)(r,t),s=Object.values(n).flatMap((e=>e.levelsWithHiddenTotalsThroughQueryContext)),d=[...a.levelsWithHiddenTotalsThroughQueryContext,i];X(e.queryContext,{levelsWithHiddenTotals:[...s,...d]})})):e}}}]);