"use strict";(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[1028],{54685:(t,e,a)=>{var o=a(36070),i=a(42311).u,r=a(73628),n=a(6792),l=a(52745).rb,s=a(52745).ay,c=a(4214).extendFlat,p=a(41231).k,d=r({editType:"plot",arrayOk:!0,colorEditType:"plot",description:"Sets the font used for `textinfo`."});t.exports={labels:{valType:"data_array",editType:"calc",description:["Sets the sector labels.","If `labels` entries are duplicated, we sum associated `values`","or simply count occurrences if `values` is not provided.","For other array attributes (including color) we use the first","non-empty entry among all occurrences of the label."].join(" ")},label0:{valType:"number",dflt:0,editType:"calc",description:["Alternate to `labels`.","Builds a numeric set of labels.","Use with `dlabel`","where `label0` is the starting label and `dlabel` the step."].join(" ")},dlabel:{valType:"number",dflt:1,editType:"calc",description:"Sets the label step. See `label0` for more info."},values:{valType:"data_array",editType:"calc",description:["Sets the values of the sectors.","If omitted, we count occurrences of each label."].join(" ")},marker:{colors:{valType:"data_array",editType:"calc",description:["Sets the color of each sector.","If not specified, the default trace color set is used","to pick the sector colors."].join(" ")},line:{color:{valType:"color",dflt:n.defaultLine,arrayOk:!0,editType:"style",description:["Sets the color of the line enclosing each sector."].join(" ")},width:{valType:"number",min:0,dflt:0,arrayOk:!0,editType:"style",description:["Sets the width (in px) of the line enclosing each sector."].join(" ")},editType:"calc"},pattern:p,editType:"calc"},text:{valType:"data_array",editType:"plot",description:["Sets text elements associated with each sector.","If trace `textinfo` contains a *text* flag, these elements will be seen","on the chart.","If trace `hoverinfo` contains a *text* flag and *hovertext* is not set,","these elements will be seen in the hover labels."].join(" ")},hovertext:{valType:"string",dflt:"",arrayOk:!0,editType:"style",description:["Sets hover text elements associated with each sector.","If a single string, the same string appears for","all data points.","If an array of string, the items are mapped in order of","this trace's sectors.","To be seen, trace `hoverinfo` must contain a *text* flag."].join(" ")},scalegroup:{valType:"string",dflt:"",editType:"calc",description:["If there are multiple pie charts that should be sized according to","their totals, link them by providing a non-empty group id here","shared by every trace in the same group."].join(" ")},textinfo:{valType:"flaglist",flags:["label","text","value","percent"],extras:["none"],editType:"calc",description:["Determines which trace information appear on the graph."].join(" ")},hoverinfo:c({},o.hoverinfo,{flags:["label","text","value","percent","name"]}),hovertemplate:l({},{keys:["label","color","value","percent","text"]}),texttemplate:s({editType:"plot"},{keys:["label","color","value","percent","text"]}),textposition:{valType:"enumerated",values:["inside","outside","auto","none"],dflt:"auto",arrayOk:!0,editType:"plot",description:["Specifies the location of the `textinfo`."].join(" ")},textfont:c({},d,{description:"Sets the font used for `textinfo`."}),insidetextorientation:{valType:"enumerated",values:["horizontal","radial","tangential","auto"],dflt:"auto",editType:"plot",description:["Controls the orientation of the text inside chart sectors.","When set to *auto*, text may be oriented in any direction in order","to be as big as possible in the middle of a sector.","The *horizontal* option orients text to be parallel with the bottom","of the chart, and may make text smaller in order to achieve that goal.","The *radial* option orients text along the radius of the sector.","The *tangential* option orients text perpendicular to the radius of the sector."].join(" ")},insidetextfont:c({},d,{description:"Sets the font used for `textinfo` lying inside the sector."}),outsidetextfont:c({},d,{description:"Sets the font used for `textinfo` lying outside the sector."}),automargin:{valType:"boolean",dflt:!1,editType:"plot",description:["Determines whether outside text labels can push the margins."].join(" ")},title:{text:{valType:"string",dflt:"",editType:"plot",description:["Sets the title of the chart.","If it is empty, no title is displayed.","Note that before the existence of `title.text`, the title's","contents used to be defined as the `title` attribute itself.","This behavior has been deprecated."].join(" ")},font:c({},d,{description:["Sets the font used for `title`.","Note that the title's font used to be set","by the now deprecated `titlefont` attribute."].join(" ")}),position:{valType:"enumerated",values:["top left","top center","top right","middle center","bottom left","bottom center","bottom right"],editType:"plot",description:["Specifies the location of the `title`.","Note that the title's position used to be set","by the now deprecated `titleposition` attribute."].join(" ")},editType:"plot"},domain:i({name:"pie",trace:!0,editType:"calc"}),hole:{valType:"number",min:0,max:1,dflt:0,editType:"calc",description:["Sets the fraction of the radius to cut out of the pie.","Use this to make a donut chart."].join(" ")},sort:{valType:"boolean",dflt:!0,editType:"calc",description:["Determines whether or not the sectors are reordered","from largest to smallest."].join(" ")},direction:{valType:"enumerated",values:["clockwise","counterclockwise"],dflt:"counterclockwise",editType:"calc",description:["Specifies the direction at which succeeding sectors follow","one another."].join(" ")},rotation:{valType:"angle",dflt:0,editType:"calc",description:["Instead of the first slice starting at 12 o'clock,","rotate to some other angle."].join(" ")},pull:{valType:"number",min:0,max:1,dflt:0,arrayOk:!0,editType:"calc",description:["Sets the fraction of larger radius to pull the sectors","out from the center. This can be a constant","to pull all slices apart from each other equally","or an array to highlight one or more slices."].join(" ")},_deprecated:{title:{valType:"string",dflt:"",editType:"calc",description:["Deprecated in favor of `title.text`.","Note that value of `title` is no longer a simple","*string* but a set of sub-attributes."].join(" ")},titlefont:c({},d,{description:"Deprecated in favor of `title.font`."}),titleposition:{valType:"enumerated",values:["top left","top center","top right","middle center","bottom left","bottom center","bottom right"],editType:"calc",description:"Deprecated in favor of `title.position`."}}}},29329:(t,e,a)=>{var o=a(35646),i=a(1915),r=a(95893),n={};function l(t){return function(e,a){return!!e&&!!(e=i(e)).isValid()&&(e=r.addOpacity(e,e.getAlpha()),t[a]||(t[a]=e),e)}}function s(t,e){var a,o=JSON.stringify(t),r=e[o];if(!r){for(r=t.slice(),a=0;a<t.length;a++)r.push(i(t[a]).lighten(20).toHexString());for(a=0;a<t.length;a++)r.push(i(t[a]).darken(20).toHexString());e[o]=r}return r}t.exports={calc:function(t,e){var a,i,r=[],n=t._fullLayout,s=n.hiddenlabels||[],c=e.labels,p=e.marker.colors||[],d=e.values,h=e._length,f=e._hasValues&&h;if(e.dlabel)for(c=new Array(h),a=0;a<h;a++)c[a]=String(e.label0+a*e.dlabel);var x={},u=l(n["_"+e.type+"colormap"]),v=0,m=!1;for(a=0;a<h;a++){var y,g,b;if(f){if(y=d[a],!o(y))continue;y=+y}else y=1;void 0!==(g=c[a])&&""!==g||(g=a);var T=x[g=String(g)];void 0===T?(x[g]=r.length,(b=-1!==s.indexOf(g))||(v+=y),r.push({v:y,label:g,color:u(p[a],g),i:a,pts:[a],hidden:b})):(m=!0,(i=r[T]).v+=y,i.pts.push(a),i.hidden||(v+=y),!1===i.color&&p[a]&&(i.color=u(p[a],g)))}return r=r.filter((function(t){return t.v>=0})),("funnelarea"===e.type?m:e.sort)&&r.sort((function(t,e){return e.v-t.v})),r[0]&&(r[0].vTotal=v),r},crossTraceCalc:function(t,e){var a=(e||{}).type;a||(a="pie");var o=t._fullLayout,i=t.calcdata,r=o[a+"colorway"],l=o["_"+a+"colormap"];o["extend"+a+"colors"]&&(r=s(r,n));for(var c=0,p=0;p<i.length;p++){var d=i[p];if(d[0].trace.type===a)for(var h=0;h<d.length;h++){var f=d[h];!1===f.color&&(l[f.label]?f.color=l[f.label]:(l[f.label]=f.color=r[c%r.length],c++))}}},makePullColorFn:l,generateExtendedColors:s}},61226:(t,e,a)=>{var o=a(35646),i=a(14228),r=a(54685),n=a(42311).N,l=a(48967).handleText,s=a(14228).coercePattern;function c(t,e){var a=i.isArrayOrTypedArray(t),r=i.isArrayOrTypedArray(e),n=Math.min(a?t.length:1/0,r?e.length:1/0);if(isFinite(n)||(n=0),n&&r){for(var l,s=0;s<n;s++){var c=e[s];if(o(c)&&c>0){l=!0;break}}l||(n=0)}return{hasLabels:a,hasValues:r,len:n}}function p(t,e,a,o,i){o("marker.line.width")&&o("marker.line.color",i?void 0:a.paper_bgcolor);var r=o("marker.colors");s(o,"marker.pattern",r),t.marker&&!e.marker.pattern.fgcolor&&(e.marker.pattern.fgcolor=t.marker.colors),e.marker.pattern.bgcolor||(e.marker.pattern.bgcolor=a.paper_bgcolor)}t.exports={handleLabelsAndValues:c,handleMarkerDefaults:p,supplyDefaults:function(t,e,a,o){function s(a,o){return i.coerce(t,e,r,a,o)}var d=c(s("labels"),s("values")),h=d.len;if(e._hasLabels=d.hasLabels,e._hasValues=d.hasValues,!e._hasLabels&&e._hasValues&&(s("label0"),s("dlabel")),h){e._length=h,p(t,e,o,s,!0),s("scalegroup");var f,x=s("text"),u=s("texttemplate");if(u||(f=s("textinfo",i.isArrayOrTypedArray(x)?"text+percent":"percent")),s("hovertext"),s("hovertemplate"),u||f&&"none"!==f){var v=s("textposition");l(t,e,o,s,v,{moduleHasSelected:!1,moduleHasUnselected:!1,moduleHasConstrain:!1,moduleHasCliponaxis:!1,moduleHasTextangle:!1,moduleHasInsideanchor:!1}),(Array.isArray(v)||"auto"===v||"outside"===v)&&s("automargin"),("inside"===v||"auto"===v||Array.isArray(v))&&s("insidetextorientation")}else"none"===f&&s("textposition","none");n(e,o,s);var m=s("hole");if(s("title.text")){var y=s("title.position",m?"middle center":"top center");m||"middle center"!==y||(e.title.position="top center"),i.coerceFont(s,"title.font",o.font)}s("sort"),s("direction"),s("rotation"),s("pull")}else e.visible=!1}}},97457:(t,e,a)=>{var o=a(33921).appendArrayMultiPointValues;t.exports=function(t,e){var a={curveNumber:e.index,pointNumbers:t.pts,data:e._input,fullData:e,label:t.label,color:t.color,value:t.v,percent:t.percent,text:t.text,bbox:t.bbox,v:t.v};return 1===t.pts.length&&(a.pointNumber=a.i=t.pts[0]),o(a,e,t.pts),"funnelarea"===e.type&&(delete a.v,delete a.i),a}},51687:(t,e,a)=>{var o=a(21132),i=a(2751),r=a(39732),n=a(95893),l=a(26788),s=a(14228),c=s.strScale,p=s.strTranslate,d=a(68104),h=a(66791),f=h.recordMinTextSize,x=h.clearMinTextSize,u=a(26948).TEXTPAD,v=a(90199),m=a(97457),y=a(14228).isValidTextValue;function g(t,e,a){var i=a[0],n=i.cx,l=i.cy,c=i.trace,p="funnelarea"===c.type;"_hasHoverLabel"in c||(c._hasHoverLabel=!1),"_hasHoverEvent"in c||(c._hasHoverEvent=!1),t.on("mouseover",(function(t){var a=e._fullLayout,d=e._fullData[c.index];if(!e._dragging&&!1!==a.hovermode){var h=d.hoverinfo;if(Array.isArray(h)&&(h=r.castHoverinfo({hoverinfo:[v.castOption(h,t.pts)],_module:c._module},a,0)),"all"===h&&(h="label+text+value+percent+name"),d.hovertemplate||"none"!==h&&"skip"!==h&&h){var f=t.rInscribed||0,x=n+t.pxmid[0]*(1-f),u=l+t.pxmid[1]*(1-f),y=a.separators,g=[];if(h&&-1!==h.indexOf("label")&&g.push(t.label),t.text=v.castOption(d.hovertext||d.text,t.pts),h&&-1!==h.indexOf("text")){var b=t.text;s.isValidTextValue(b)&&g.push(b)}t.value=t.v,t.valueLabel=v.formatPieValue(t.v,y),h&&-1!==h.indexOf("value")&&g.push(t.valueLabel),t.percent=t.v/i.vTotal,t.percentLabel=v.formatPiePercent(t.percent,y),h&&-1!==h.indexOf("percent")&&g.push(t.percentLabel);var T=d.hoverlabel,O=T.font,M=[];r.loneHover({trace:c,x0:x-f*i.r,x1:x+f*i.r,y:u,_x0:p?n+t.TL[0]:x-f*i.r,_x1:p?n+t.TR[0]:x+f*i.r,_y0:p?l+t.TL[1]:u-f*i.r,_y1:p?l+t.BL[1]:u+f*i.r,text:g.join("<br>"),name:d.hovertemplate||-1!==h.indexOf("name")?d.name:void 0,idealAlign:t.pxmid[0]<0?"left":"right",color:v.castOption(T.bgcolor,t.pts)||t.color,borderColor:v.castOption(T.bordercolor,t.pts),fontFamily:v.castOption(O.family,t.pts),fontSize:v.castOption(O.size,t.pts),fontColor:v.castOption(O.color,t.pts),nameLength:v.castOption(T.namelength,t.pts),textAlign:v.castOption(T.align,t.pts),hovertemplate:v.castOption(d.hovertemplate,t.pts),hovertemplateLabels:t,eventData:[m(t,d)]},{container:a._hoverlayer.node(),outerContainer:a._paper.node(),gd:e,inOut_bbox:M}),t.bbox=M[0],c._hasHoverLabel=!0}c._hasHoverEvent=!0,e.emit("plotly_hover",{points:[m(t,d)],event:o.event})}})),t.on("mouseout",(function(t){var a=e._fullLayout,i=e._fullData[c.index],n=o.select(this).datum();c._hasHoverEvent&&(t.originalEvent=o.event,e.emit("plotly_unhover",{points:[m(n,i)],event:o.event}),c._hasHoverEvent=!1),c._hasHoverLabel&&(r.loneUnhover(a._hoverlayer.node()),c._hasHoverLabel=!1)})),t.on("click",(function(t){var a=e._fullLayout,i=e._fullData[c.index];e._dragging||!1===a.hovermode||(e._hoverdata=[m(t,i)],r.click(e,o.event))}))}function b(t,e,a){var o=v.castOption(t.insidetextfont.color,e.pts);!o&&t._input.textfont&&(o=v.castOption(t._input.textfont.color,e.pts));var i=v.castOption(t.insidetextfont.family,e.pts)||v.castOption(t.textfont.family,e.pts)||a.family,r=v.castOption(t.insidetextfont.size,e.pts)||v.castOption(t.textfont.size,e.pts)||a.size,l=v.castOption(t.insidetextfont.weight,e.pts)||v.castOption(t.textfont.weight,e.pts)||a.weight,s=v.castOption(t.insidetextfont.style,e.pts)||v.castOption(t.textfont.style,e.pts)||a.style,c=v.castOption(t.insidetextfont.variant,e.pts)||v.castOption(t.textfont.variant,e.pts)||a.variant,p=v.castOption(t.insidetextfont.textcase,e.pts)||v.castOption(t.textfont.textcase,e.pts)||a.textcase,d=v.castOption(t.insidetextfont.lineposition,e.pts)||v.castOption(t.textfont.lineposition,e.pts)||a.lineposition,h=v.castOption(t.insidetextfont.shadow,e.pts)||v.castOption(t.textfont.shadow,e.pts)||a.shadow;return{color:o||n.contrast(e.color),family:i,size:r,weight:l,style:s,variant:c,textcase:p,lineposition:d,shadow:h}}function T(t,e){for(var a,o,i=0;i<t.length;i++)if((o=(a=t[i][0]).trace).title.text){var r=o.title.text;o._meta&&(r=s.templateString(r,o._meta));var n=l.tester.append("text").attr("data-notex",1).text(r).call(l.font,o.title.font).call(d.convertToTspans,e),c=l.bBox(n.node(),!0);a.titleBox={width:c.width,height:c.height},n.remove()}}function O(t,e,a){var o=a.r||e.rpx1,i=e.rInscribed;if(e.startangle===e.stopangle)return{rCenter:1-i,scale:0,rotate:0,textPosAngle:0};var r,n=e.ring,l=1===n&&Math.abs(e.startangle-e.stopangle)===2*Math.PI,s=e.halfangle,c=e.midangle,p=a.trace.insidetextorientation,d="horizontal"===p,h="tangential"===p,f="radial"===p,x="auto"===p,u=[];if(!x){var v,m=function(a,i){if(function(t,e){var a=t.startangle,o=t.stopangle;return a>e&&e>o||a<e&&e<o}(e,a)){var l=Math.abs(a-e.startangle),s=Math.abs(a-e.stopangle),c=l<s?l:s;(r="tan"===i?_(t,o,n,c,0):M(t,o,n,c,Math.PI/2)).textPosAngle=a,u.push(r)}};if(d||h){for(v=4;v>=-4;v-=2)m(Math.PI*v,"tan");for(v=4;v>=-4;v-=2)m(Math.PI*(v+1),"tan")}if(d||f){for(v=4;v>=-4;v-=2)m(Math.PI*(v+1.5),"rad");for(v=4;v>=-4;v-=2)m(Math.PI*(v+.5),"rad")}}if(l||x||d){var y=Math.sqrt(t.width*t.width+t.height*t.height);if((r={scale:i*o*2/y,rCenter:1-i,rotate:0}).textPosAngle=(e.startangle+e.stopangle)/2,r.scale>=1)return r;u.push(r)}(x||f)&&((r=M(t,o,n,s,c)).textPosAngle=(e.startangle+e.stopangle)/2,u.push(r)),(x||h)&&((r=_(t,o,n,s,c)).textPosAngle=(e.startangle+e.stopangle)/2,u.push(r));for(var g=0,b=0,T=0;T<u.length;T++){var O=u[T].scale;if(b<O&&(b=O,g=T),!x&&b>=1)break}return u[g]}function M(t,e,a,o,i){e=Math.max(0,e-2*u);var r=t.width/t.height,n=L(r,o,e,a);return{scale:2*n/t.height,rCenter:w(r,n/e),rotate:k(i)}}function _(t,e,a,o,i){e=Math.max(0,e-2*u);var r=t.height/t.width,n=L(r,o,e,a);return{scale:2*n/t.width,rCenter:w(r,n/e),rotate:k(i+Math.PI/2)}}function w(t,e){return Math.cos(e)-t*e}function k(t){return(180/Math.PI*t+720)%180-90}function L(t,e,a,o){var i=t+1/(2*Math.tan(e));return a*Math.min(1/(Math.sqrt(i*i+.5)+i),o/(Math.sqrt(t*t+o/2)+t))}function A(t,e){return t.v!==e.vTotal||e.trace.hole?Math.min(1/(1+1/Math.sin(t.halfangle)),t.ring/2):1}function S(t,e){var a=e.pxmid[0],o=e.pxmid[1],i=t.width/2,r=t.height/2;return a<0&&(i*=-1),o<0&&(r*=-1),{scale:1,rCenter:1,rotate:0,x:i+Math.abs(r)*(i>0?1:-1)/2,y:r/(1+a*a/(o*o)),outside:!0}}function P(t,e){var a,o,i,r=t.trace,n={x:t.cx,y:t.cy},l={tx:0,ty:0};l.ty+=r.title.font.size,i=j(r),-1!==r.title.position.indexOf("top")?(n.y-=(1+i)*t.r,l.ty-=t.titleBox.height):-1!==r.title.position.indexOf("bottom")&&(n.y+=(1+i)*t.r);var s,c=t.r/(void 0===(s=t.trace.aspectratio)?1:s),p=e.w*(r.domain.x[1]-r.domain.x[0])/2;return-1!==r.title.position.indexOf("left")?(p+=c,n.x-=(1+i)*c,l.tx+=t.titleBox.width/2):-1!==r.title.position.indexOf("center")?p*=2:-1!==r.title.position.indexOf("right")&&(p+=c,n.x+=(1+i)*c,l.tx-=t.titleBox.width/2),a=p/t.titleBox.width,o=E(t,e)/t.titleBox.height,{x:n.x,y:n.y,scale:Math.min(a,o),tx:l.tx,ty:l.ty}}function E(t,e){var a=t.trace,o=e.h*(a.domain.y[1]-a.domain.y[0]);return Math.min(t.titleBox.height,o/2)}function j(t){var e,a=t.pull;if(!a)return 0;if(s.isArrayOrTypedArray(a))for(a=0,e=0;e<t.pull.length;e++)t.pull[e]>a&&(a=t.pull[e]);return a}function I(t,e){for(var a=[],o=0;o<t.length;o++){var i=t[o][0],r=i.trace,n=r.domain,l=e.w*(n.x[1]-n.x[0]),s=e.h*(n.y[1]-n.y[0]);r.title.text&&"middle center"!==r.title.position&&(s-=E(i,e));var c=l/2,p=s/2;"funnelarea"!==r.type||r.scalegroup||(p/=r.aspectratio),i.r=Math.min(c,p)/(1+j(r)),i.cx=e.l+e.w*(r.domain.x[1]+r.domain.x[0])/2,i.cy=e.t+e.h*(1-r.domain.y[0])-s/2,r.title.text&&-1!==r.title.position.indexOf("bottom")&&(i.cy-=E(i,e)),r.scalegroup&&-1===a.indexOf(r.scalegroup)&&a.push(r.scalegroup)}!function(t,e){for(var a,o,i,r=0;r<e.length;r++){var n=1/0,l=e[r];for(o=0;o<t.length;o++)if((i=(a=t[o][0]).trace).scalegroup===l){var s;if("pie"===i.type)s=a.r*a.r;else if("funnelarea"===i.type){var c,p;i.aspectratio>1?p=(c=a.r)/i.aspectratio:c=(p=a.r)*i.aspectratio,s=(c*=(1+i.baseratio)/2)*p}n=Math.min(n,s/a.vTotal)}for(o=0;o<t.length;o++)if((i=(a=t[o][0]).trace).scalegroup===l){var d=n*a.vTotal;"funnelarea"===i.type&&(d/=(1+i.baseratio)/2,d/=i.aspectratio),a.r=Math.sqrt(d)}}}(t,a)}function z(t,e){return[t*Math.sin(e),-t*Math.cos(e)]}function F(t,e,a){var o=t._fullLayout,i=a.trace,r=i.texttemplate,n=i.textinfo;if(!r&&n&&"none"!==n){var l,c=n.split("+"),p=function(t){return-1!==c.indexOf(t)},d=p("label"),h=p("text"),f=p("value"),x=p("percent"),u=o.separators;if(l=d?[e.label]:[],h){var m=v.getFirstFilled(i.text,e.pts);y(m)&&l.push(m)}f&&l.push(v.formatPieValue(e.v,u)),x&&l.push(v.formatPiePercent(e.v/a.vTotal,u)),e.text=l.join("<br>")}if(r){var g=s.castOption(i,e.i,"texttemplate");if(g){var b=function(t){return{label:t.label,value:t.v,valueLabel:v.formatPieValue(t.v,o.separators),percent:t.v/a.vTotal,percentLabel:v.formatPiePercent(t.v/a.vTotal,o.separators),color:t.color,text:t.text,customdata:s.castOption(i,t.i,"customdata")}}(e),T=v.getFirstFilled(i.text,e.pts);(y(T)||""===T)&&(b.text=T),e.text=s.texttemplateString(g,b,t._fullLayout._d3locale,b,i._meta||{})}else e.text=""}}function H(t,e){var a=t.rotate*Math.PI/180,o=Math.cos(a),i=Math.sin(a),r=(e.left+e.right)/2,n=(e.top+e.bottom)/2;t.textX=r*o-n*i,t.textY=r*i+n*o,t.noCenter=!0}t.exports={plot:function(t,e){var a=t._context.staticPlot,r=t._fullLayout,h=r._size;x("pie",r),T(e,t),I(e,h);var u=s.makeTraceGroups(r._pielayer,e,"trace").each((function(e){var x=o.select(this),u=e[0],m=u.trace;!function(t){var e,a,o,i=t[0],r=i.r,n=i.trace,l=v.getRotationAngle(n.rotation),s=2*Math.PI/i.vTotal,c="px0",p="px1";if("counterclockwise"===n.direction){for(e=0;e<t.length&&t[e].hidden;e++);if(e===t.length)return;l+=s*t[e].v,s*=-1,c="px1",p="px0"}for(o=z(r,l),e=0;e<t.length;e++)(a=t[e]).hidden||(a[c]=o,a.startangle=l,l+=s*a.v/2,a.pxmid=z(r,l),a.midangle=l,o=z(r,l+=s*a.v/2),a.stopangle=l,a[p]=o,a.largeArc=a.v>i.vTotal/2?1:0,a.halfangle=Math.PI*Math.min(a.v/i.vTotal,.5),a.ring=1-n.hole,a.rInscribed=A(a,i))}(e),x.attr("stroke-linejoin","round"),x.each((function(){var y=o.select(this).selectAll("g.slice").data(e);y.enter().append("g").classed("slice",!0),y.exit().remove();var T=[[[],[]],[[],[]]],M=!1;y.each((function(i,n){if(i.hidden)o.select(this).selectAll("path,g").remove();else{i.pointNumber=i.i,i.curveNumber=m.index,T[i.pxmid[1]<0?0:1][i.pxmid[0]<0?0:1].push(i);var c=u.cx,p=u.cy,h=o.select(this),x=h.selectAll("path.surface").data([i]);if(x.enter().append("path").classed("surface",!0).style({"pointer-events":a?"none":"all"}),h.call(g,t,e),m.pull){var y=+v.castOption(m.pull,i.pts)||0;y>0&&(c+=y*i.pxmid[0],p+=y*i.pxmid[1])}i.cxFinal=c,i.cyFinal=p;var _=m.hole;if(i.v===u.vTotal){var w="M"+(c+i.px0[0])+","+(p+i.px0[1])+E(i.px0,i.pxmid,!0,1)+E(i.pxmid,i.px0,!0,1)+"Z";_?x.attr("d","M"+(c+_*i.px0[0])+","+(p+_*i.px0[1])+E(i.px0,i.pxmid,!1,_)+E(i.pxmid,i.px0,!1,_)+"Z"+w):x.attr("d",w)}else{var k=E(i.px0,i.px1,!0,1);if(_){var L=1-_;x.attr("d","M"+(c+_*i.px1[0])+","+(p+_*i.px1[1])+E(i.px1,i.px0,!1,_)+"l"+L*i.px0[0]+","+L*i.px0[1]+k+"Z")}else x.attr("d","M"+c+","+p+"l"+i.px0[0]+","+i.px0[1]+k+"Z")}F(t,i,u);var A=v.castOption(m.textposition,i.pts),P=h.selectAll("g.slicetext").data(i.text&&"none"!==A?[0]:[]);P.enter().append("g").classed("slicetext",!0),P.exit().remove(),P.each((function(){var a=s.ensureSingle(o.select(this),"text","",(function(t){t.attr("data-notex",1)})),h=s.ensureUniformFontSize(t,"outside"===A?function(t,e,a){return{color:v.castOption(t.outsidetextfont.color,e.pts)||v.castOption(t.textfont.color,e.pts)||a.color,family:v.castOption(t.outsidetextfont.family,e.pts)||v.castOption(t.textfont.family,e.pts)||a.family,size:v.castOption(t.outsidetextfont.size,e.pts)||v.castOption(t.textfont.size,e.pts)||a.size,weight:v.castOption(t.outsidetextfont.weight,e.pts)||v.castOption(t.textfont.weight,e.pts)||a.weight,style:v.castOption(t.outsidetextfont.style,e.pts)||v.castOption(t.textfont.style,e.pts)||a.style,variant:v.castOption(t.outsidetextfont.variant,e.pts)||v.castOption(t.textfont.variant,e.pts)||a.variant,textcase:v.castOption(t.outsidetextfont.textcase,e.pts)||v.castOption(t.textfont.textcase,e.pts)||a.textcase,lineposition:v.castOption(t.outsidetextfont.lineposition,e.pts)||v.castOption(t.textfont.lineposition,e.pts)||a.lineposition,shadow:v.castOption(t.outsidetextfont.shadow,e.pts)||v.castOption(t.textfont.shadow,e.pts)||a.shadow}}(m,i,r.font):b(m,i,r.font));a.text(i.text).attr({class:"slicetext",transform:"","text-anchor":"middle"}).call(l.font,h).call(d.convertToTspans,t);var x,y=l.bBox(a.node());if("outside"===A)x=S(y,i);else if(x=O(y,i,u),"auto"===A&&x.scale<1){var g=s.ensureUniformFontSize(t,m.outsidetextfont);a.call(l.font,g),x=S(y=l.bBox(a.node()),i)}var T=x.textPosAngle,_=void 0===T?i.pxmid:z(u.r,T);if(x.targetX=c+_[0]*x.rCenter+(x.x||0),x.targetY=p+_[1]*x.rCenter+(x.y||0),H(x,y),x.outside){var w=x.targetY;i.yLabelMin=w-y.height/2,i.yLabelMid=w,i.yLabelMax=w+y.height/2,i.labelExtraX=0,i.labelExtraY=0,M=!0}x.fontSize=h.size,f(m.type,x,r),e[n].transform=x,s.setTransormAndDisplay(a,x)}))}function E(t,e,a,o){var r=o*(e[0]-t[0]),n=o*(e[1]-t[1]);return"a"+o*u.r+","+o*u.r+" 0 "+i.largeArc+(a?" 1 ":" 0 ")+r+","+n}}));var _=o.select(this).selectAll("g.titletext").data(m.title.text?[0]:[]);if(_.enter().append("g").classed("titletext",!0),_.exit().remove(),_.each((function(){var e,a=s.ensureSingle(o.select(this),"text","",(function(t){t.attr("data-notex",1)})),i=m.title.text;m._meta&&(i=s.templateString(i,m._meta)),a.text(i).attr({class:"titletext",transform:"","text-anchor":"middle"}).call(l.font,m.title.font).call(d.convertToTspans,t),e="middle center"===m.title.position?function(t){var e=Math.sqrt(t.titleBox.width*t.titleBox.width+t.titleBox.height*t.titleBox.height);return{x:t.cx,y:t.cy,scale:t.trace.hole*t.r*2/e,tx:0,ty:-t.titleBox.height/2+t.trace.title.font.size}}(u):P(u,h),a.attr("transform",p(e.x,e.y)+c(Math.min(1,e.scale))+p(e.tx,e.ty))})),M&&function(t,e){var a,o,i,r,n,l,c,p,d,h,f,x,u;function m(t,e){return t.pxmid[1]-e.pxmid[1]}function y(t,e){return e.pxmid[1]-t.pxmid[1]}function g(t,a){a||(a={});var i,p,d,f,x=a.labelExtraY+(o?a.yLabelMax:a.yLabelMin),u=o?t.yLabelMin:t.yLabelMax,m=o?t.yLabelMax:t.yLabelMin,y=t.cyFinal+n(t.px0[1],t.px1[1]),g=x-u;if(g*c>0&&(t.labelExtraY=g),s.isArrayOrTypedArray(e.pull))for(p=0;p<h.length;p++)(d=h[p])===t||(v.castOption(e.pull,t.pts)||0)>=(v.castOption(e.pull,d.pts)||0)||((t.pxmid[1]-d.pxmid[1])*c>0?(g=d.cyFinal+n(d.px0[1],d.px1[1])-u-t.labelExtraY)*c>0&&(t.labelExtraY+=g):(m+t.labelExtraY-y)*c>0&&(i=3*l*Math.abs(p-h.indexOf(t)),(f=d.cxFinal+r(d.px0[0],d.px1[0])+i-(t.cxFinal+t.pxmid[0])-t.labelExtraX)*l>0&&(t.labelExtraX+=f)))}for(o=0;o<2;o++)for(i=o?m:y,n=o?Math.max:Math.min,c=o?1:-1,a=0;a<2;a++){for(r=a?Math.max:Math.min,l=a?1:-1,(p=t[o][a]).sort(i),d=t[1-o][a],h=d.concat(p),x=[],f=0;f<p.length;f++)void 0!==p[f].yLabelMid&&x.push(p[f]);for(u=!1,f=0;o&&f<d.length;f++)if(void 0!==d[f].yLabelMid){u=d[f];break}for(f=0;f<x.length;f++){var b=f&&x[f-1];u&&!f&&(b=u),g(x[f],b)}}}(T,m),function(t,e){t.each((function(t){var a=o.select(this);if(t.labelExtraX||t.labelExtraY){var i=a.select("g.slicetext text");t.transform.targetX+=t.labelExtraX,t.transform.targetY+=t.labelExtraY,s.setTransormAndDisplay(i,t.transform);var r=t.cxFinal+t.pxmid[0],l="M"+r+","+(t.cyFinal+t.pxmid[1]),c=(t.yLabelMax-t.yLabelMin)*(t.pxmid[0]<0?-1:1)/4;if(t.labelExtraX){var p=t.labelExtraX*t.pxmid[1]/t.pxmid[0],d=t.yLabelMid+t.labelExtraY-(t.cyFinal+t.pxmid[1]);Math.abs(p)>Math.abs(d)?l+="l"+d*t.pxmid[0]/t.pxmid[1]+","+d+"H"+(r+t.labelExtraX+c):l+="l"+t.labelExtraX+","+p+"v"+(d-p)+"h"+c}else l+="V"+(t.yLabelMid+t.labelExtraY)+"h"+c;s.ensureSingle(a,"path","textline").call(n.stroke,e.outsidetextfont.color).attr({"stroke-width":Math.min(2,e.outsidetextfont.size/8),d:l,fill:"none"})}else a.select("path.textline").remove()}))}(y,m),M&&m.automargin){var w=l.bBox(x.node()),k=m.domain,L=h.w*(k.x[1]-k.x[0]),A=h.h*(k.y[1]-k.y[0]),E=(.5*L-u.r)/h.w,j=(.5*A-u.r)/h.h;i.autoMargin(t,"pie."+m.uid+".automargin",{xl:k.x[0]-E,xr:k.x[1]+E,yb:k.y[0]-j,yt:k.y[1]+j,l:Math.max(u.cx-u.r-w.left,0),r:Math.max(w.right-(u.cx+u.r),0),b:Math.max(w.bottom-(u.cy+u.r),0),t:Math.max(u.cy-u.r-w.top,0),pad:5})}}))}));setTimeout((function(){u.selectAll("tspan").each((function(){var t=o.select(this);t.attr("dy")&&t.attr("dy",t.attr("dy"))}))}),0)},formatSliceLabel:F,transformInsideText:O,determineInsideTextFont:b,positionTitleOutside:P,prerenderTitles:T,layoutAreas:I,attachFxHandlers:g,computeTransform:H}}}]);