"""View mode toggle, sort controls, and filter controls for the file browser."""

# AUTOGENERATED! DO NOT EDIT! File to edit: ../../nbs/components/toolbar.ipynb.

# %% auto #0
__all__ = ['render_view_toggle', 'render_sort_controls', 'render_toolbar']

# %% ../../nbs/components/toolbar.ipynb #c3d4e5f6
from typing import Any, Optional

from fasthtml.common import Div, Span, Button, Select, Option, Label

# DaisyUI components
from cjm_fasthtml_daisyui.components.actions.button import btn, btn_colors, btn_sizes, btn_styles
from cjm_fasthtml_daisyui.components.data_input.select import select as dui_select, select_sizes
from cjm_fasthtml_daisyui.components.layout.join import join
from cjm_fasthtml_daisyui.utilities.semantic_colors import bg_dui, text_dui, border_dui

# Tailwind utilities
from cjm_fasthtml_tailwind.utilities.spacing import p, m
from cjm_fasthtml_tailwind.utilities.sizing import w, h
from cjm_fasthtml_tailwind.utilities.typography import font_size, font_weight
from cjm_fasthtml_tailwind.utilities.borders import border, rounded
from cjm_fasthtml_tailwind.utilities.flexbox_and_grid import (
    flex_display, justify, items, gap, grow
)
from cjm_fasthtml_tailwind.core.base import combine_classes

# Lucide icons
from cjm_fasthtml_lucide_icons.factory import lucide_icon

# Local imports
from ..core.config import FileBrowserConfig, ViewMode, FileColumn
from ..core.models import BrowserState
from .item import BROWSER_ICONS

# %% ../../nbs/components/toolbar.ipynb #e5f6a7b8
def render_view_toggle(
    current_mode: ViewMode,                 # Current view mode
    toggle_url: str,                        # URL for toggling view mode
    hx_target: Optional[str] = None,        # HTMX target for swaps
) -> Any:  # View toggle component
    """Render view mode toggle buttons (list/grid)."""
    def make_button(mode: ViewMode, icon_name: str, title: str):
        is_active = current_mode == mode
        btn_cls = combine_classes(
            btn, btn_sizes.sm,
            btn_colors.primary if is_active else btn_styles.ghost
        )
        
        attrs = {
            "cls": btn_cls,
            "title": title,
            "hx_post": toggle_url,
            "hx_vals": f'{{"view_mode": "{mode.value}"}}',
            "hx_swap": "outerHTML",
        }
        if hx_target:
            attrs["hx_target"] = hx_target
        
        icon_cls = str(text_dui.primary_content) if is_active else str(text_dui.base_content)
        return Button(
            lucide_icon(icon_name, size=4, cls=icon_cls),
            **attrs
        )
    
    return Div(
        make_button(ViewMode.LIST, BROWSER_ICONS["list_view"], "List view"),
        make_button(ViewMode.GRID, BROWSER_ICONS["grid_view"], "Grid view"),
        cls=combine_classes(join, rounded.lg)
    )

# %% ../../nbs/components/toolbar.ipynb #h8c9d0e1
def render_sort_controls(
    current_sort: str,                      # Current sort field
    descending: bool,                       # Current sort direction
    config: FileBrowserConfig,              # Browser configuration
    sort_url: str,                          # URL for changing sort
    hx_target: Optional[str] = None,        # HTMX target for swaps
) -> Any:  # Sort controls component
    """Render sort dropdown and direction toggle."""
    # Sort options based on configured columns
    sort_options = [
        ("name", "Name"),
        ("size", "Size"),
        ("modified", "Modified"),
        ("type", "Type"),
    ]
    
    # Build select options
    options = []
    for value, label in sort_options:
        options.append(Option(
            label,
            value=value,
            selected=(value == current_sort)
        ))
    
    # Sort select
    select_attrs = {
        "name": "sort_by",
        "cls": combine_classes(dui_select, select_sizes.sm, w(32)),
        "hx_post": sort_url,
        "hx_swap": "outerHTML",
        "hx_trigger": "change",
        "hx_include": "[name='sort_descending']",  # Include direction
    }
    if hx_target:
        select_attrs["hx_target"] = hx_target
    
    sort_select = Select(*options, **select_attrs)
    
    # Direction toggle button
    icon_name = BROWSER_ICONS["sort_desc"] if descending else BROWSER_ICONS["sort_asc"]
    dir_title = "Sort descending" if descending else "Sort ascending"
    
    dir_attrs = {
        "cls": combine_classes(btn, btn_styles.ghost, btn_sizes.sm),
        "title": dir_title,
        "hx_post": sort_url,
        "hx_vals": f'{{"sort_by": "{current_sort}", "sort_descending": "{str(not descending).lower()}"}}',
        "hx_swap": "outerHTML",
    }
    if hx_target:
        dir_attrs["hx_target"] = hx_target
    
    dir_button = Button(
        lucide_icon(icon_name, size=4),
        **dir_attrs
    )
    
    # Hidden input for current direction (for select hx_include)
    hidden_dir = Div(
        f'<input type="hidden" name="sort_descending" value="{str(descending).lower()}" />',
        style="display:none"
    )
    
    return Div(
        Label("Sort:", cls=combine_classes(font_size.sm, text_dui.base_content.opacity(70), m.r(2))),
        sort_select,
        dir_button,
        hidden_dir,
        cls=combine_classes(flex_display, items.center, gap(1))
    )

# %% ../../nbs/components/toolbar.ipynb #k1f2g3h4
def render_toolbar(
    state: BrowserState,                    # Current browser state
    config: FileBrowserConfig,              # Browser configuration
    toggle_url: str,                        # URL for view toggle
    sort_url: str,                          # URL for sort changes
    hx_target: Optional[str] = None,        # HTMX target for swaps
    toolbar_id: Optional[str] = None,       # HTML ID for toolbar
) -> Any:  # Toolbar component
    """Render the complete toolbar."""
    children = []
    
    # View toggle (if allowed)
    if config.view.allow_mode_toggle:
        children.append(render_view_toggle(
            ViewMode(state.view_mode),
            toggle_url,
            hx_target
        ))
    
    # Spacer
    children.append(Div(cls=str(grow())))
    
    # Sort controls (if allowed)
    if config.view.allow_sort_toggle:
        children.append(render_sort_controls(
            state.sort_by,
            state.sort_descending,
            config,
            sort_url,
            hx_target
        ))
    
    # Active filter indicator (if extensions filtered)
    if state.filter_extensions:
        ext_list = ", ".join(state.filter_extensions)
        children.append(Div(
            Span(f"Filtered: {ext_list}", cls=combine_classes(
                font_size.xs, text_dui.base_content.opacity(60)
            )),
            cls=str(m.l(4))
        ))
    
    # Build toolbar
    toolbar_attrs = {
        "cls": combine_classes(
            flex_display, items.center, gap(2),
            p.x(2), p.y(1),
            border_dui.base_300, border.b()
        )
    }
    if toolbar_id:
        toolbar_attrs["id"] = toolbar_id
    
    return Div(*children, **toolbar_attrs)
