"""Configuration dataclasses and enums for the file browser."""

# AUTOGENERATED! DO NOT EDIT! File to edit: ../../nbs/core/config.ipynb.

# %% auto #0
__all__ = ['SelectionMode', 'ViewMode', 'FileColumn', 'ViewConfig', 'FilterConfig', 'FileBrowserCallbacks', 'FileBrowserConfig']

# %% ../../nbs/core/config.ipynb #c3d4e5f6
from dataclasses import dataclass, field
from enum import Enum
from typing import Any, Callable, List, Literal, Optional, Tuple

from cjm_file_discovery.core.models import FileInfo

# %% ../../nbs/core/config.ipynb #e5f6a7b8
class SelectionMode(str, Enum):
    """File selection modes."""
    NONE = "none"           # Browse only, no selection
    SINGLE = "single"       # Select one file
    MULTIPLE = "multiple"   # Select multiple files

# %% ../../nbs/core/config.ipynb #f6a7b8c9
class ViewMode(str, Enum):
    """Display modes for directory listing."""
    LIST = "list"   # Table/list view
    GRID = "grid"   # Grid/icon view

# %% ../../nbs/core/config.ipynb #g7b8c9d0
class FileColumn(str, Enum):
    """Available columns for list view."""
    NAME = "name"
    SIZE = "size"
    MODIFIED = "modified"
    TYPE = "type"
    EXTENSION = "extension"
    PATH = "path"

# %% ../../nbs/core/config.ipynb #j0e1f2g3
@dataclass
class ViewConfig:
    """View display configuration."""
    default_mode: ViewMode = ViewMode.LIST       # Default view mode
    allow_mode_toggle: bool = True               # Allow user to toggle view mode
    
    # List view columns
    columns: List[FileColumn] = field(default_factory=lambda: [
        FileColumn.NAME, FileColumn.SIZE, FileColumn.MODIFIED
    ])
    
    # Grid view
    grid_columns: int = 4                        # Number of columns in grid
    show_thumbnails: bool = False                # Show image thumbnails in grid
    
    # Sorting
    default_sort: FileColumn = FileColumn.NAME   # Default sort column
    sort_folders_first: bool = True              # Sort folders before files
    allow_sort_toggle: bool = True               # Allow user to change sort

# %% ../../nbs/core/config.ipynb #m3h4i5j6
@dataclass
class FilterConfig:
    """Filtering configuration."""
    allowed_extensions: Optional[List[str]] = None   # Include only these extensions (None = all)
    show_directories: bool = True                    # Show directories
    show_hidden: bool = False                        # Show hidden files/directories
    show_system_files: bool = False                  # Show system files
    custom_filter: Optional[Callable[[FileInfo], bool]] = None  # Custom filter function
    
    def matches(
        self,
        file_info: FileInfo  # File to check against filter
    ) -> bool:  # True if file passes filter
        """Check if a file matches the filter criteria."""
        # Check directory visibility
        if file_info.is_directory and not self.show_directories:
            return False
        
        # Check hidden files
        if not self.show_hidden and file_info.name.startswith('.'):
            return False
        
        # Check extension filter (only for files)
        if not file_info.is_directory and self.allowed_extensions is not None:
            ext = file_info.extension or ''
            # Normalize extensions (handle with/without dot)
            allowed = [e.lstrip('.').lower() for e in self.allowed_extensions]
            if ext.lower() not in allowed:
                return False
        
        # Check custom filter
        if self.custom_filter is not None:
            return self.custom_filter(file_info)
        
        return True

# %% ../../nbs/core/config.ipynb #p6k7l8m9
@dataclass
class FileBrowserCallbacks:
    """Event callbacks for customization."""
    on_navigate: Optional[Callable[[str], None]] = None          # Called when directory changes
    on_select: Optional[Callable[[str], None]] = None            # Called when file selected
    on_selection_change: Optional[Callable[[List[str]], None]] = None  # Called when selection changes
    on_open: Optional[Callable[[str], None]] = None              # Called on file double-click/enter
    validate_selection: Optional[Callable[[str], Tuple[bool, str]]] = None  # Validate before select
    validate_navigation: Optional[Callable[[str], Tuple[bool, str]]] = None  # Validate before navigate

# %% ../../nbs/core/config.ipynb #s9n0o1p2
@dataclass
class FileBrowserConfig:
    """Main configuration for file browser."""
    # Provider
    provider: Optional[Any] = None     # FileSystemProvider, defaults to local
    start_path: Optional[str] = None   # Initial path (defaults to home)
    
    # Selection
    selection_mode: SelectionMode = SelectionMode.SINGLE
    selectable_types: Literal["files", "directories", "both"] = "files"
    max_selections: Optional[int] = None  # For MULTIPLE mode
    
    # Display
    view: ViewConfig = field(default_factory=ViewConfig)
    filter: FilterConfig = field(default_factory=FilterConfig)
    
    # Path bar
    show_path_bar: bool = True
    show_path_input: bool = False      # Direct path entry field
    show_breadcrumbs: bool = True
    
    # Features
    show_parent_navigation: bool = True
    show_toolbar: bool = True          # Show view/sort controls
    
    # Bookmarks
    bookmarks: Optional[List[Tuple[str, str]]] = None  # [(label, path), ...]
    show_bookmarks: bool = False
    
    # HTML IDs (for HTMX targeting)
    container_id: str = "file-browser"
    content_id: str = "file-browser-content"
    path_bar_id: str = "file-browser-path"
    listing_id: str = "file-browser-listing"
    
    # Keyboard (placeholder for future integration)
    keyboard_config: Optional[Any] = None
    
    def can_select(
        self,
        file_info: FileInfo  # File to check
    ) -> bool:  # True if file can be selected
        """Check if a file/directory can be selected based on config."""
        if self.selection_mode == SelectionMode.NONE:
            return False
        
        if self.selectable_types == "files" and file_info.is_directory:
            return False
        if self.selectable_types == "directories" and not file_info.is_directory:
            return False
        
        return True
