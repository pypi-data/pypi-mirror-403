"""Core data models for the file browser including DirectoryListing, BrowserSelection, and BrowserState."""

# AUTOGENERATED! DO NOT EDIT! File to edit: ../../nbs/core/models.ipynb.

# %% auto #0
__all__ = ['DirectoryListing', 'BrowserSelection', 'BrowserState']

# %% ../../nbs/core/models.ipynb #c3d4e5f6
from dataclasses import dataclass, field
from typing import Any, Dict, List, Optional

from cjm_file_discovery.core.models import FileInfo

# %% ../../nbs/core/models.ipynb #e5f6a7b8
@dataclass
class DirectoryListing:
    """Result of listing a directory."""
    path: str                              # Current directory path
    items: List[FileInfo]                  # Directory contents
    parent_path: Optional[str] = None      # Parent directory (None if at root)
    provider_name: str = "local"           # Source provider
    total_items: int = 0                   # Total count (for pagination)
    error: Optional[str] = None            # Error message if listing failed
    
    def __post_init__(self):
        """Set total_items from items length if not provided."""
        if self.total_items == 0 and self.items:
            self.total_items = len(self.items)

# %% ../../nbs/core/models.ipynb #h8c9d0e1
@dataclass
class BrowserSelection:
    """Current selection state."""
    selected_paths: List[str] = field(default_factory=list)  # Selected file paths
    last_selected: Optional[str] = None    # Most recently selected (for shift-click)

    def add(
        self,
        path: str  # Path to add to selection
    ) -> None:  # Modifies selection in place
        """Add a path to the selection."""
        if path not in self.selected_paths:
            self.selected_paths.append(path)
        self.last_selected = path

    def remove(
        self,
        path: str  # Path to remove from selection
    ) -> None:  # Modifies selection in place
        """Remove a path from the selection."""
        if path in self.selected_paths:
            self.selected_paths.remove(path)
        if self.last_selected == path:
            self.last_selected = self.selected_paths[-1] if self.selected_paths else None

    def clear(self) -> None:  # Modifies selection in place
        """Clear all selections."""
        self.selected_paths.clear()
        self.last_selected = None

    def toggle(
        self,
        path: str  # Path to toggle
    ) -> None:  # Modifies selection in place
        """Toggle selection of a path."""
        if path in self.selected_paths:
            self.remove(path)
        else:
            self.add(path)

    def is_selected(
        self,
        path: str  # Path to check
    ) -> bool:  # True if path is selected
        """Check if a path is selected."""
        return path in self.selected_paths
    
    def set_single(
        self,
        path: str  # Path to set as single selection
    ) -> None:  # Modifies selection in place
        """Set a single path as the only selection (for single-select mode)."""
        self.selected_paths = [path]
        self.last_selected = path

# %% ../../nbs/core/models.ipynb #k1f2g3h4
@dataclass
class BrowserState:
    """Complete browser state for persistence/restore."""
    current_path: str                                          # Current directory path
    selection: BrowserSelection = field(default_factory=BrowserSelection)  # Selection state
    view_mode: str = "list"                                    # "list" or "grid"
    sort_by: str = "name"                                      # Sort field
    sort_descending: bool = False                              # Sort direction
    filter_extensions: Optional[List[str]] = None              # Active extension filter
    
    def to_dict(self) -> Dict[str, Any]:  # Serializable dictionary
        """Convert state to a serializable dictionary."""
        return {
            "current_path": self.current_path,
            "selected_paths": self.selection.selected_paths,
            "last_selected": self.selection.last_selected,
            "view_mode": self.view_mode,
            "sort_by": self.sort_by,
            "sort_descending": self.sort_descending,
            "filter_extensions": self.filter_extensions,
        }
    
    @classmethod
    def from_dict(
        cls,
        data: Dict[str, Any]  # Dictionary with state data
    ) -> "BrowserState":  # Restored BrowserState instance
        """Create a BrowserState from a dictionary."""
        selection = BrowserSelection(
            selected_paths=data.get("selected_paths", []),
            last_selected=data.get("last_selected")
        )
        return cls(
            current_path=data["current_path"],
            selection=selection,
            view_mode=data.get("view_mode", "list"),
            sort_by=data.get("sort_by", "name"),
            sort_descending=data.get("sort_descending", False),
            filter_extensions=data.get("filter_extensions"),
        )
