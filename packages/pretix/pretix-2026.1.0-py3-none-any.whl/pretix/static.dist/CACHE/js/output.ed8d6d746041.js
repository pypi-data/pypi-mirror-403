function convert_to_dnf(rules){if(typeof rules!=="object"||Array.isArray(rules)||rules===null){return rules}
function _distribute_or_over_and(r){var operator=Object.keys(r)[0]
var values=r[operator]
if(operator==="and"){var arg_to_distribute=null
var other_args=[]
for(var arg of values){if(typeof arg==="object"&&!Array.isArray(arg)&&typeof arg["or"]!=="undefined"&&arg_to_distribute===null){arg_to_distribute=arg}else{other_args.push(arg)}}
if(arg_to_distribute===null){return r}
var or_operands=[]
for(var dval of arg_to_distribute["or"]){or_operands.push({"and":other_args.concat([dval])})}
return{"or":or_operands}}else if(!operator){return r}else if(operator==="!"||operator==="!!"||operator==="?:"||operator==="if"){console.warn("Operator "+operator+" currently unsupported by convert_to_dnf")
return r}else{return r}}
function _simplify_chained_operators(r){if(typeof r!=="object"||Array.isArray(r)){return r}
var operator=Object.keys(r)[0]
var values=r[operator]
if(operator!=="or"&&operator!=="and"){return r}
var new_values=[]
for(var v of values){if(typeof v!=="object"||Array.isArray(v)||typeof v[operator]==="undefined"){new_values.push(v)}else{new_values.push(...v[operator])}}
var result={}
result[operator]=new_values
return result}
var old_rules=rules
while(true){rules=_distribute_or_over_and(rules)
var operator=Object.keys(rules)[0]
var values=rules[operator]
var no_list=false
if(!Array.isArray(values)){values=[values]
no_list=true}
rules={}
if(!no_list){rules[operator]=[]
for(var v of values){rules[operator].push(convert_to_dnf(v))}}else{rules[operator]=convert_to_dnf(values[0])}
if(JSON.stringify(old_rules)===JSON.stringify(rules)){break}
old_rules=rules}
rules=_simplify_chained_operators(rules)
return rules};var Datetimefield=function(exports){'use strict';var script={props:["required","value"],template:'',mounted:function mounted(){var vm=this;this.multiple;$(this.$el).datetimepicker(this.opts()).trigger("change").on("dp.change",function(e){vm.$emit("input",$(this).data('DateTimePicker').date().toISOString());});if(!vm.value){$(this.$el).data("DateTimePicker").viewDate(moment().hour(0).minute(0).second(0).millisecond(0));}else{$(this.$el).data("DateTimePicker").date(moment(vm.value));}},methods:{opts:function opts(){return{format:$("body").attr("data-datetimeformat"),locale:$("body").attr("data-datetimelocale"),useCurrent:false,showClear:this.required,icons:{time:'fa fa-clock-o',date:'fa fa-calendar',up:'fa fa-chevron-up',down:'fa fa-chevron-down',previous:'fa fa-chevron-left',next:'fa fa-chevron-right',today:'fa fa-screenshot',clear:'fa fa-trash',close:'fa fa-remove'}};}},watch:{value:function value(val){$(this.$el).data('DateTimePicker').date(moment(val));}},destroyed:function destroyed(){$(this.$el).off().datetimepicker("destroy");}};function normalizeComponent(template,style,script,scopeId,isFunctionalTemplate,moduleIdentifier,shadowMode,createInjector,createInjectorSSR,createInjectorShadow){if(typeof shadowMode!=='boolean'){createInjectorSSR=createInjector;createInjector=shadowMode;shadowMode=false;}
var options=typeof script==='function'?script.options:script;if(template&&template.render){options.render=template.render;options.staticRenderFns=template.staticRenderFns;options._compiled=true;if(isFunctionalTemplate){options.functional=true;}}
if(scopeId){options._scopeId=scopeId;}
var hook;if(moduleIdentifier){hook=function hook(context){context=context||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext;if(!context&&typeof __VUE_SSR_CONTEXT__!=='undefined'){context=__VUE_SSR_CONTEXT__;}
if(style){style.call(this,createInjectorSSR(context));}
if(context&&context._registeredComponents){context._registeredComponents.add(moduleIdentifier);}};options._ssrRegister=hook;}else if(style){hook=shadowMode?function(context){style.call(this,createInjectorShadow(context,this.$root.$options.shadowRoot));}:function(context){style.call(this,createInjector(context));};}
if(hook){if(options.functional){var originalRender=options.render;options.render=function renderWithStyleInjection(h,context){hook.call(context);return originalRender(h,context);};}else{var existing=options.beforeCreate;options.beforeCreate=existing?[].concat(existing,hook):[hook];}}
return script;}
var __vue_script__=script;var __vue_render__=function __vue_render__(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("input",{staticClass:"form-control"});};var __vue_staticRenderFns__=[];__vue_render__._withStripped=true;var __vue_inject_styles__=undefined;var __vue_scope_id__=undefined;var __vue_module_identifier__=undefined;var __vue_is_functional_template__=false;var __vue_component__=normalizeComponent({render:__vue_render__,staticRenderFns:__vue_staticRenderFns__},__vue_inject_styles__,__vue_script__,__vue_scope_id__,__vue_is_functional_template__,__vue_module_identifier__,false,undefined,undefined,undefined);exports["default"]=__vue_component__;Object.defineProperty(exports,'__esModule',{value:true});return exports;}({});;var Timefield=function(exports){'use strict';var script={props:["required","value"],template:'',mounted:function mounted(){var vm=this;this.multiple;$(this.$el).datetimepicker(this.opts()).trigger("change").on("dp.change",function(e){vm.$emit("input",$(this).data('DateTimePicker').date().format("HH:mm:ss"));});if(!vm.value){$(this.$el).data("DateTimePicker").viewDate(moment().hour(0).minute(0).second(0).millisecond(0));}else{$(this.$el).data("DateTimePicker").date(vm.value);}},methods:{opts:function opts(){return{format:$("body").attr("data-timeformat"),locale:$("body").attr("data-datetimelocale"),useCurrent:false,showClear:this.required,icons:{time:'fa fa-clock-o',date:'fa fa-calendar',up:'fa fa-chevron-up',down:'fa fa-chevron-down',previous:'fa fa-chevron-left',next:'fa fa-chevron-right',today:'fa fa-screenshot',clear:'fa fa-trash',close:'fa fa-remove'}};}},watch:{value:function value(val){$(this.$el).data('DateTimePicker').date(val);}},destroyed:function destroyed(){$(this.$el).off().datetimepicker("destroy");}};function normalizeComponent(template,style,script,scopeId,isFunctionalTemplate,moduleIdentifier,shadowMode,createInjector,createInjectorSSR,createInjectorShadow){if(typeof shadowMode!=='boolean'){createInjectorSSR=createInjector;createInjector=shadowMode;shadowMode=false;}
var options=typeof script==='function'?script.options:script;if(template&&template.render){options.render=template.render;options.staticRenderFns=template.staticRenderFns;options._compiled=true;if(isFunctionalTemplate){options.functional=true;}}
if(scopeId){options._scopeId=scopeId;}
var hook;if(moduleIdentifier){hook=function hook(context){context=context||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext;if(!context&&typeof __VUE_SSR_CONTEXT__!=='undefined'){context=__VUE_SSR_CONTEXT__;}
if(style){style.call(this,createInjectorSSR(context));}
if(context&&context._registeredComponents){context._registeredComponents.add(moduleIdentifier);}};options._ssrRegister=hook;}else if(style){hook=shadowMode?function(context){style.call(this,createInjectorShadow(context,this.$root.$options.shadowRoot));}:function(context){style.call(this,createInjector(context));};}
if(hook){if(options.functional){var originalRender=options.render;options.render=function renderWithStyleInjection(h,context){hook.call(context);return originalRender(h,context);};}else{var existing=options.beforeCreate;options.beforeCreate=existing?[].concat(existing,hook):[hook];}}
return script;}
var __vue_script__=script;var __vue_render__=function __vue_render__(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("input",{staticClass:"form-control"});};var __vue_staticRenderFns__=[];__vue_render__._withStripped=true;var __vue_inject_styles__=undefined;var __vue_scope_id__=undefined;var __vue_module_identifier__=undefined;var __vue_is_functional_template__=false;var __vue_component__=normalizeComponent({render:__vue_render__,staticRenderFns:__vue_staticRenderFns__},__vue_inject_styles__,__vue_script__,__vue_scope_id__,__vue_is_functional_template__,__vue_module_identifier__,false,undefined,undefined,undefined);exports["default"]=__vue_component__;Object.defineProperty(exports,'__esModule',{value:true});return exports;}({});;var LookupSelect2=function(exports){'use strict';var script={props:["required","value","placeholder","url","multiple"],template:'<select>\n'+'        <slot></slot>\n'+'      </select>',mounted:function mounted(){this.build();},methods:{build:function build(){var vm=this;this.multiple;$(this.$el).empty().select2(this.opts()).val(this.value||"").trigger("change").on("change",function(e){vm.$emit("input",$(this).select2('data'));});if(vm.value){for(var i=0;i<vm.value["objectList"].length;i++){var option=new Option(vm.value["objectList"][i]["lookup"][2],vm.value["objectList"][i]["lookup"][1],true,true);$(vm.$el).append(option);}}
$(vm.$el).trigger("change");},opts:function opts(){return{theme:"bootstrap",delay:100,width:'100%',multiple:true,allowClear:this.required,language:$("body").attr("data-select2-locale"),ajax:{url:this.url,data:function data(params){return{query:params.term,page:params.page||1};}},templateResult:function templateResult(res){if(!res.id){return res.text;}
var $ret=$("<span>").append($("<span>").addClass("primary").append($("<div>").text(res.text).html()));return $ret;}};}},watch:{placeholder:function placeholder(val){$(this.$el).select2("destroy");this.build();},required:function required(val){$(this.$el).select2("destroy");this.build();},url:function url(val){$(this.$el).select2("destroy");this.build();},value:function value(newval,oldval){if(JSON.stringify(newval)!==JSON.stringify(oldval)){$(this.$el).empty();if(newval){for(var i=0;i<newval["objectList"].length;i++){var option=new Option(newval["objectList"][i]["lookup"][2],newval["objectList"][i]["lookup"][1],true,true);$(this.$el).append(option);}}
$(this.$el).trigger("change");}}},destroyed:function destroyed(){$(this.$el).off().select2("destroy");}};function normalizeComponent(template,style,script,scopeId,isFunctionalTemplate,moduleIdentifier,shadowMode,createInjector,createInjectorSSR,createInjectorShadow){if(typeof shadowMode!=='boolean'){createInjectorSSR=createInjector;createInjector=shadowMode;shadowMode=false;}
var options=typeof script==='function'?script.options:script;if(template&&template.render){options.render=template.render;options.staticRenderFns=template.staticRenderFns;options._compiled=true;if(isFunctionalTemplate){options.functional=true;}}
if(scopeId){options._scopeId=scopeId;}
var hook;if(moduleIdentifier){hook=function hook(context){context=context||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext;if(!context&&typeof __VUE_SSR_CONTEXT__!=='undefined'){context=__VUE_SSR_CONTEXT__;}
if(style){style.call(this,createInjectorSSR(context));}
if(context&&context._registeredComponents){context._registeredComponents.add(moduleIdentifier);}};options._ssrRegister=hook;}else if(style){hook=shadowMode?function(context){style.call(this,createInjectorShadow(context,this.$root.$options.shadowRoot));}:function(context){style.call(this,createInjector(context));};}
if(hook){if(options.functional){var originalRender=options.render;options.render=function renderWithStyleInjection(h,context){hook.call(context);return originalRender(h,context);};}else{var existing=options.beforeCreate;options.beforeCreate=existing?[].concat(existing,hook):[hook];}}
return script;}
var __vue_script__=script;var __vue_render__=function __vue_render__(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("select",[_vm._t("default")],2);};var __vue_staticRenderFns__=[];__vue_render__._withStripped=true;var __vue_inject_styles__=undefined;var __vue_scope_id__=undefined;var __vue_module_identifier__=undefined;var __vue_is_functional_template__=false;var __vue_component__=normalizeComponent({render:__vue_render__,staticRenderFns:__vue_staticRenderFns__},__vue_inject_styles__,__vue_script__,__vue_scope_id__,__vue_is_functional_template__,__vue_module_identifier__,false,undefined,undefined,undefined);exports["default"]=__vue_component__;Object.defineProperty(exports,'__esModule',{value:true});return exports;}({});;function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o;}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o;},_typeof(o);}
var CheckinRule=function(exports){'use strict';var script={components:{LookupSelect2:LookupSelect2["default"],Datetimefield:Datetimefield["default"],Timefield:Timefield["default"]},props:{rule:Object,level:Number,index:Number},computed:{texts:function texts(){return this.$root.texts;},variable:function variable(){var op=this.operator;if(op==="and"||op==="or"){return op;}else if(this.rule[op]&&this.rule[op][0]){if(this.rule[op][0]["entries_since"]){return"entries_since";}
if(this.rule[op][0]["entries_before"]){return"entries_before";}
if(this.rule[op][0]["entries_days_since"]){return"entries_days_since";}
if(this.rule[op][0]["entries_days_before"]){return"entries_days_before";}
return this.rule[op][0]["var"];}else{return null;}},rightoperand:function rightoperand(){var op=this.operator;if(op==="and"||op==="or"){return null;}else if(this.rule[op]&&typeof this.rule[op][1]!=="undefined"){return this.rule[op][1];}else{return null;}},operator:function operator(){return Object.keys(this.rule)[0];},operands:function operands(){return this.rule[this.operator];},classObject:function classObject(){var c={'checkin-rule':true};c['checkin-rule-'+this.variable]=true;return c;},vartype:function vartype(){if(this.variable&&this.$root.VARS[this.variable]){return this.$root.VARS[this.variable]['type'];}},timeType:function timeType(){if(this.vartype==='int_by_datetime'){if(this.rule[this.operator][0][this.variable]&&this.rule[this.operator][0][this.variable][0]['buildTime']){return this.rule[this.operator][0][this.variable][0]['buildTime'][0];}}else if(this.rightoperand&&this.rightoperand['buildTime']){return this.rightoperand['buildTime'][0];}},timeTolerance:function timeTolerance(){var op=this.operator;if((op==="isBefore"||op==="isAfter")&&this.rule[op]&&typeof this.rule[op][2]!=="undefined"){return this.rule[op][2];}else{return null;}},timeValue:function timeValue(){if(this.vartype==='int_by_datetime'){if(this.rule[this.operator][0][this.variable][0]['buildTime']){return this.rule[this.operator][0][this.variable][0]['buildTime'][1];}}else if(this.rightoperand&&this.rightoperand['buildTime']){return this.rightoperand['buildTime'][1];}},cardinality:function cardinality(){if(this.vartype&&this.$root.TYPEOPS[this.vartype]&&this.$root.TYPEOPS[this.vartype][this.operator]){return this.$root.TYPEOPS[this.vartype][this.operator]['cardinality'];}},operators:function operators(){return this.$root.TYPEOPS[this.vartype];},productSelectURL:function productSelectURL(){return $("#product-select2").text();},variationSelectURL:function variationSelectURL(){return $("#variations-select2").text();},gateSelectURL:function gateSelectURL(){return $("#gates-select2").text();},vars:function vars(){return this.$root.VARS;}},methods:{setVariable:function setVariable(event){var current_op=Object.keys(this.rule)[0];var current_val=this.rule[current_op];if(event.target.value==="and"||event.target.value==="or"){if(current_val[0]&&current_val[0]["var"]){current_val=[];}
this.$set(this.rule,event.target.value,current_val);this.$delete(this.rule,current_op);}else{if(current_val!=="and"&&current_val!=="or"&&current_val[0]&&this.$root.VARS[event.target.value]['type']===this.vartype){if(this.vartype==="int_by_datetime"){var current_data=this.rule[current_op][0][this.variable];var new_lhs={};new_lhs[event.target.value]=JSON.parse(JSON.stringify(current_data));this.$set(this.rule[current_op],0,new_lhs);}else{this.$set(this.rule[current_op][0],"var",event.target.value);}}else if(this.$root.VARS[event.target.value]['type']==='int_by_datetime'){this.$delete(this.rule,current_op);var o={};o[event.target.value]=[{"buildTime":[null,null]}];this.$set(this.rule,"!!",[o]);}else{this.$delete(this.rule,current_op);this.$set(this.rule,"!!",[{"var":event.target.value}]);}}},setOperator:function setOperator(event){var current_op=Object.keys(this.rule)[0];var current_val=this.rule[current_op];this.$delete(this.rule,current_op);this.$set(this.rule,event.target.value,current_val);},setRightOperandNumber:function setRightOperandNumber(event){if(this.rule[this.operator].length===1){this.rule[this.operator].push(parseInt(event.target.value));}else{this.$set(this.rule[this.operator],1,parseInt(event.target.value));}},setTimeTolerance:function setTimeTolerance(event){if(this.rule[this.operator].length===2){this.rule[this.operator].push(parseInt(event.target.value));}else{this.$set(this.rule[this.operator],2,parseInt(event.target.value));}},setTimeType:function setTimeType(event){var time={"buildTime":[event.target.value]};if(this.vartype==="int_by_datetime"){this.$set(this.rule[this.operator][0][this.variable],0,time);}else{if(this.rule[this.operator].length===1){this.rule[this.operator].push(time);}else{this.$set(this.rule[this.operator],1,time);}
if(event.target.value==="custom"){this.$set(this.rule[this.operator],2,0);}}},setTimeValue:function setTimeValue(val){if(this.vartype==="int_by_datetime"){this.$set(this.rule[this.operator][0][this.variable][0]["buildTime"],1,val);}else{this.$set(this.rule[this.operator][1]["buildTime"],1,val);}},setRightOperandProductList:function setRightOperandProductList(val){var products={"objectList":[]};for(var i=0;i<val.length;i++){products["objectList"].push({"lookup":["product",val[i].id,val[i].text]});}
if(this.rule[this.operator].length===1){this.rule[this.operator].push(products);}else{this.$set(this.rule[this.operator],1,products);}},setRightOperandVariationList:function setRightOperandVariationList(val){var products={"objectList":[]};for(var i=0;i<val.length;i++){products["objectList"].push({"lookup":["variation",val[i].id,val[i].text]});}
if(this.rule[this.operator].length===1){this.rule[this.operator].push(products);}else{this.$set(this.rule[this.operator],1,products);}},setRightOperandGateList:function setRightOperandGateList(val){var products={"objectList":[]};for(var i=0;i<val.length;i++){products["objectList"].push({"lookup":["gate",val[i].id,val[i].text]});}
if(this.rule[this.operator].length===1){this.rule[this.operator].push(products);}else{this.$set(this.rule[this.operator],1,products);}},setRightOperandEnum:function setRightOperandEnum(event){if(this.rule[this.operator].length===1){this.rule[this.operator].push(event.target.value);}else{this.$set(this.rule[this.operator],1,event.target.value);}},addOperand:function addOperand(){this.rule[this.operator].push({"":[]});},wrapWithOR:function wrapWithOR(){var r=JSON.parse(JSON.stringify(this.rule));this.$delete(this.rule,this.operator);this.$set(this.rule,"or",[r]);},wrapWithAND:function wrapWithAND(){var r=JSON.parse(JSON.stringify(this.rule));this.$delete(this.rule,this.operator);this.$set(this.rule,"and",[r]);},cutOut:function cutOut(){var cop=Object.keys(this.operands[0])[0];var r=this.operands[0][cop];this.$delete(this.rule,this.operator);this.$set(this.rule,cop,r);},remove:function remove(){this.$parent.rule[this.$parent.operator].splice(this.index,1);},duplicate:function duplicate(){var r=JSON.parse(JSON.stringify(this.rule));this.$parent.rule[this.$parent.operator].splice(this.index,0,r);}}};function normalizeComponent(template,style,script,scopeId,isFunctionalTemplate,moduleIdentifier,shadowMode,createInjector,createInjectorSSR,createInjectorShadow){if(typeof shadowMode!=='boolean'){createInjectorSSR=createInjector;createInjector=shadowMode;shadowMode=false;}
var options=typeof script==='function'?script.options:script;if(template&&template.render){options.render=template.render;options.staticRenderFns=template.staticRenderFns;options._compiled=true;if(isFunctionalTemplate){options.functional=true;}}
if(scopeId){options._scopeId=scopeId;}
var hook;if(moduleIdentifier){hook=function hook(context){context=context||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext;if(!context&&typeof __VUE_SSR_CONTEXT__!=='undefined'){context=__VUE_SSR_CONTEXT__;}
if(style){style.call(this,createInjectorSSR(context));}
if(context&&context._registeredComponents){context._registeredComponents.add(moduleIdentifier);}};options._ssrRegister=hook;}else if(style){hook=shadowMode?function(context){style.call(this,createInjectorShadow(context,this.$root.$options.shadowRoot));}:function(context){style.call(this,createInjector(context));};}
if(hook){if(options.functional){var originalRender=options.render;options.render=function renderWithStyleInjection(h,context){hook.call(context);return originalRender(h,context);};}else{var existing=options.beforeCreate;options.beforeCreate=existing?[].concat(existing,hook):[hook];}}
return script;}
var __vue_script__=script;var __vue_render__=function __vue_render__(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("div",{"class":_vm.classObject},[_c("div",{staticClass:"btn-group pull-right"},[_vm.level>0?_c("button",{staticClass:"checkin-rule-remove btn btn-xs btn-default",attrs:{type:"button","data-toggle":"tooltip",title:_vm.texts.duplicate},on:{click:function click($event){$event.preventDefault();return _vm.duplicate.apply(null,arguments);}}},[_c("span",{staticClass:"fa fa-copy"})]):_vm._e(),_vm._v(" "),_c("button",{staticClass:"checkin-rule-remove btn btn-xs btn-default",attrs:{type:"button"},on:{click:function click($event){$event.preventDefault();return _vm.wrapWithOR.apply(null,arguments);}}},[_vm._v("OR\n        ")]),_vm._v(" "),_c("button",{staticClass:"checkin-rule-remove btn btn-xs btn-default",attrs:{type:"button"},on:{click:function click($event){$event.preventDefault();return _vm.wrapWithAND.apply(null,arguments);}}},[_vm._v("AND\n        ")]),_vm._v(" "),_vm.operands&&_vm.operands.length===1&&(_vm.operator==="or"||_vm.operator==="and")?_c("button",{staticClass:"checkin-rule-remove btn btn-xs btn-default",attrs:{type:"button"},on:{click:function click($event){$event.preventDefault();return _vm.cutOut.apply(null,arguments);}}},[_c("span",{staticClass:"fa fa-cut"})]):_vm._e(),_vm._v(" "),_vm.level>0?_c("button",{staticClass:"checkin-rule-remove btn btn-xs btn-default",attrs:{type:"button"},on:{click:function click($event){$event.preventDefault();return _vm.remove.apply(null,arguments);}}},[_c("span",{staticClass:"fa fa-trash"})]):_vm._e()]),_vm._v(" "),_c("select",{staticClass:"form-control",attrs:{required:""},domProps:{value:_vm.variable},on:{input:_vm.setVariable}},[_c("option",{attrs:{value:"and"}},[_vm._v(_vm._s(_vm.texts.and))]),_vm._v(" "),_c("option",{attrs:{value:"or"}},[_vm._v(_vm._s(_vm.texts.or))]),_vm._v(" "),_vm._l(_vm.vars,function(v,name){return _c("option",{domProps:{value:name}},[_vm._v(_vm._s(v.label))]);})],2),_vm._v(" "),_vm.operator!=="or"&&_vm.operator!=="and"&&_vm.vartype!=="int_by_datetime"?_c("select",{staticClass:"form-control",attrs:{required:""},domProps:{value:_vm.operator},on:{input:_vm.setOperator}},[_c("option"),_vm._v(" "),_vm._l(_vm.operators,function(v,name){return _c("option",{domProps:{value:name}},[_vm._v(_vm._s(v.label))]);})],2):_vm._e(),_vm._v(" "),_vm.vartype==="datetime"||_vm.vartype==="int_by_datetime"?_c("select",{staticClass:"form-control",attrs:{required:""},domProps:{value:_vm.timeType},on:{input:_vm.setTimeType}},[_c("option",{attrs:{value:"date_from"}},[_vm._v(_vm._s(_vm.texts.date_from))]),_vm._v(" "),_c("option",{attrs:{value:"date_to"}},[_vm._v(_vm._s(_vm.texts.date_to))]),_vm._v(" "),_c("option",{attrs:{value:"date_admission"}},[_vm._v(_vm._s(_vm.texts.date_admission))]),_vm._v(" "),_c("option",{attrs:{value:"custom"}},[_vm._v(_vm._s(_vm.texts.date_custom))]),_vm._v(" "),_c("option",{attrs:{value:"customtime"}},[_vm._v(_vm._s(_vm.texts.date_customtime))])]):_vm._e(),_vm._v(" "),(_vm.vartype==="datetime"||_vm.vartype==="int_by_datetime")&&_vm.timeType==="custom"?_c("datetimefield",{attrs:{value:_vm.timeValue},on:{input:_vm.setTimeValue}}):_vm._e(),_vm._v(" "),(_vm.vartype==="datetime"||_vm.vartype==="int_by_datetime")&&_vm.timeType==="customtime"?_c("timefield",{attrs:{value:_vm.timeValue},on:{input:_vm.setTimeValue}}):_vm._e(),_vm._v(" "),_vm.vartype==="datetime"&&_vm.timeType&&_vm.timeType!=="customtime"&&_vm.timeType!=="custom"?_c("input",{staticClass:"form-control",attrs:{required:"",type:"number",placeholder:_vm.texts.date_tolerance},domProps:{value:_vm.timeTolerance},on:{input:_vm.setTimeTolerance}}):_vm._e(),_vm._v(" "),_vm.vartype==="int_by_datetime"?_c("select",{staticClass:"form-control",attrs:{required:""},domProps:{value:_vm.operator},on:{input:_vm.setOperator}},[_c("option"),_vm._v(" "),_vm._l(_vm.operators,function(v,name){return _c("option",{domProps:{value:name}},[_vm._v(_vm._s(v.label))]);})],2):_vm._e(),_vm._v(" "),(_vm.vartype==="int"||_vm.vartype==="int_by_datetime")&&_vm.cardinality>1?_c("input",{staticClass:"form-control",attrs:{required:"",type:"number"},domProps:{value:_vm.rightoperand},on:{input:_vm.setRightOperandNumber}}):_vm._e(),_vm._v(" "),_vm.vartype==="product"&&_vm.operator==="inList"?_c("lookup-select2",{attrs:{required:"",multiple:true,value:_vm.rightoperand,url:_vm.productSelectURL},on:{input:_vm.setRightOperandProductList}}):_vm._e(),_vm._v(" "),_vm.vartype==="variation"&&_vm.operator==="inList"?_c("lookup-select2",{attrs:{required:"",multiple:true,value:_vm.rightoperand,url:_vm.variationSelectURL},on:{input:_vm.setRightOperandVariationList}}):_vm._e(),_vm._v(" "),_vm.vartype==="gate"&&_vm.operator==="inList"?_c("lookup-select2",{attrs:{required:"",multiple:true,value:_vm.rightoperand,url:_vm.gateSelectURL},on:{input:_vm.setRightOperandGateList}}):_vm._e(),_vm._v(" "),_vm.vartype==="enum_entry_status"&&_vm.operator==="=="?_c("select",{staticClass:"form-control",attrs:{required:""},domProps:{value:_vm.rightoperand},on:{input:_vm.setRightOperandEnum}},[_c("option",{attrs:{value:"absent"}},[_vm._v(_vm._s(_vm.texts.status_absent))]),_vm._v(" "),_c("option",{attrs:{value:"present"}},[_vm._v(_vm._s(_vm.texts.status_present))])]):_vm._e(),_vm._v(" "),_vm.operator==="or"||_vm.operator==="and"?_c("div",{staticClass:"checkin-rule-childrules"},[_vm._l(_vm.operands,function(op,opi){return _c("div",[_typeof(op)==="object"?_c("checkin-rule",{attrs:{rule:op,index:opi,level:_vm.level+1}}):_vm._e()],1);}),_vm._v(" "),_c("button",{staticClass:"checkin-rule-addchild btn btn-xs btn-default",attrs:{type:"button"},on:{click:function click($event){$event.preventDefault();return _vm.addOperand.apply(null,arguments);}}},[_c("span",{staticClass:"fa fa-plus-circle"}),_vm._v(" "+_vm._s(_vm.texts.condition_add)+"\n        ")])],2):_vm._e()],1);};var __vue_staticRenderFns__=[];__vue_render__._withStripped=true;var __vue_inject_styles__=undefined;var __vue_scope_id__=undefined;var __vue_module_identifier__=undefined;var __vue_is_functional_template__=false;var __vue_component__=normalizeComponent({render:__vue_render__,staticRenderFns:__vue_staticRenderFns__},__vue_inject_styles__,__vue_script__,__vue_scope_id__,__vue_is_functional_template__,__vue_module_identifier__,false,undefined,undefined,undefined);exports["default"]=__vue_component__;Object.defineProperty(exports,'__esModule',{value:true});return exports;}({});;var CheckinRulesEditor=function(exports){'use strict';var script={components:{CheckinRule:CheckinRule["default"]},computed:{hasRules:function hasRules(){return!!Object.keys(this.$root.rules).length;}},methods:{addRule:function addRule(){this.$set(this.$root.rules,"and",[]);}}};function normalizeComponent(template,style,script,scopeId,isFunctionalTemplate,moduleIdentifier,shadowMode,createInjector,createInjectorSSR,createInjectorShadow){if(typeof shadowMode!=='boolean'){createInjectorSSR=createInjector;createInjector=shadowMode;shadowMode=false;}
var options=typeof script==='function'?script.options:script;if(template&&template.render){options.render=template.render;options.staticRenderFns=template.staticRenderFns;options._compiled=true;if(isFunctionalTemplate){options.functional=true;}}
if(scopeId){options._scopeId=scopeId;}
var hook;if(moduleIdentifier){hook=function hook(context){context=context||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext;if(!context&&typeof __VUE_SSR_CONTEXT__!=='undefined'){context=__VUE_SSR_CONTEXT__;}
if(style){style.call(this,createInjectorSSR(context));}
if(context&&context._registeredComponents){context._registeredComponents.add(moduleIdentifier);}};options._ssrRegister=hook;}else if(style){hook=shadowMode?function(context){style.call(this,createInjectorShadow(context,this.$root.$options.shadowRoot));}:function(context){style.call(this,createInjector(context));};}
if(hook){if(options.functional){var originalRender=options.render;options.render=function renderWithStyleInjection(h,context){hook.call(context);return originalRender(h,context);};}else{var existing=options.beforeCreate;options.beforeCreate=existing?[].concat(existing,hook):[hook];}}
return script;}
var __vue_script__=script;var __vue_render__=function __vue_render__(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("div",{staticClass:"checkin-rules-editor"},[_vm.hasRules?_c("checkin-rule",{attrs:{rule:this.$root.rules,level:0,index:0}}):_vm._e(),_vm._v(" "),!_vm.hasRules?_c("button",{staticClass:"checkin-rule-addchild btn btn-xs btn-default",attrs:{type:"button"},on:{click:function click($event){$event.preventDefault();return _vm.addRule.apply(null,arguments);}}},[_c("span",{staticClass:"fa fa-plus-circle"}),_vm._v(" "+_vm._s(this.$root.texts.condition_add)+"\n    ")]):_vm._e()],1);};var __vue_staticRenderFns__=[];__vue_render__._withStripped=true;var __vue_inject_styles__=undefined;var __vue_scope_id__=undefined;var __vue_module_identifier__=undefined;var __vue_is_functional_template__=false;var __vue_component__=normalizeComponent({render:__vue_render__,staticRenderFns:__vue_staticRenderFns__},__vue_inject_styles__,__vue_script__,__vue_scope_id__,__vue_is_functional_template__,__vue_module_identifier__,false,undefined,undefined,undefined);exports["default"]=__vue_component__;Object.defineProperty(exports,'__esModule',{value:true});return exports;}({});;var VizNode=function(exports){'use strict';var script={props:{node:Object,nodeid:String,children:Array,boxWidth:Number,boxHeight:Number,marginX:Number,marginY:Number,paddingX:Number},computed:{x:function x(){return this.node.column*(this.boxWidth+this.marginX)+this.marginX/2+this.paddingX;},y:function y(){return this.node.y*(this.boxHeight+this.marginY)+this.marginY/2;},edges:function edges(){var _this=this;var startX=this.x+this.boxWidth+1;var startY=this.y+this.boxHeight/2;return this.children.map(function(c){var endX=c.column*(_this.boxWidth+_this.marginX)+_this.marginX/2+_this.paddingX-1;var endY=c.y*(_this.boxHeight+_this.marginY)+_this.marginY/2+_this.boxHeight/2;return"\n            M ".concat(startX," ").concat(startY,"\n            L ").concat(endX-50," ").concat(startY,"\n            C ").concat(endX-25," ").concat(startY," ").concat(endX-25," ").concat(startY," ").concat(endX-25," ").concat(startY+25*Math.sign(endY-startY),"\n            L ").concat(endX-25," ").concat(endY-25*Math.sign(endY-startY),"\n            C ").concat(endX-25," ").concat(endY," ").concat(endX-25," ").concat(endY," ").concat(endX," ").concat(endY,"\n          ");});},checkEdge:function checkEdge(){var startX=this.x+this.boxWidth+1;var startY=this.y+this.boxHeight/2;return"M ".concat(startX," ").concat(startY," L ").concat(startX+25," ").concat(startY);},rootEdge:function rootEdge(){if(this.node.column>0){return;}
var startX=0;var startY=this.boxHeight/2+this.marginY/2;var endX=this.x-1;var endY=this.y+this.boxHeight/2;return"\n            M ".concat(startX," ").concat(startY,"\n            L ").concat(endX-50," ").concat(startY,"\n            C ").concat(endX-25," ").concat(startY," ").concat(endX-25," ").concat(startY," ").concat(endX-25," ").concat(startY+25*Math.sign(endY-startY),"\n            L ").concat(endX-25," ").concat(endY-25*Math.sign(endY-startY),"\n            C ").concat(endX-25," ").concat(endY," ").concat(endX-25," ").concat(endY," ").concat(endX," ").concat(endY,"\n        ");},variable:function variable(){var op=this.operator;if(this.node.rule[op]&&this.node.rule[op][0]){if(this.node.rule[op][0]["entries_since"]){return"entries_since";}
if(this.node.rule[op][0]["entries_before"]){return"entries_before";}
if(this.node.rule[op][0]["entries_days_since"]){return"entries_days_since";}
if(this.node.rule[op][0]["entries_days_before"]){return"entries_days_before";}
return this.node.rule[op][0]["var"];}else{return"";}},vardata:function vardata(){return this.$root.VARS[this.variable];},varresult:function varresult(){var op=this.operator;if(this.node.rule[op]&&this.node.rule[op][0]){if(typeof this.node.rule[op][0]["__result"]==="undefined")return null;return this.node.rule[op][0]["__result"];}else{return"";}},rightoperand:function rightoperand(){var op=this.operator;if(this.node.rule[op]&&typeof this.node.rule[op][1]!=="undefined"){return this.node.rule[op][1];}else{return null;}},op:function op(){return this.$root.TYPEOPS[this.vardata.type][this.operator];},operands:function operands(){return this.node.rule[this.operator];},operator:function operator(){return Object.keys(this.node.rule).filter(function(k){return!k.startsWith("__");})[0];},result:function result(){return typeof this.node.rule.__result=="undefined"?null:!!this.node.rule.__result;},resultInclParents:function resultInclParents(){if(typeof this.node.rule.__result=="undefined")return null;function _p(node){if(node.parent){return node.rule.__result&&_p(node.parent);}
return node.rule.__result;}
return _p(this.node);},nodeClass:function nodeClass(){return{"node":true,"node-true":this.result===true,"node-false":this.result===false};}},methods:{df:function df(val){var format=$("body").attr("data-datetimeformat");return moment(val).format(format);},tf:function tf(val){var format=$("body").attr("data-timeformat");return moment(val,"HH:mm:ss").format(format);}}};function normalizeComponent(template,style,script,scopeId,isFunctionalTemplate,moduleIdentifier,shadowMode,createInjector,createInjectorSSR,createInjectorShadow){if(typeof shadowMode!=='boolean'){createInjectorSSR=createInjector;createInjector=shadowMode;shadowMode=false;}
var options=typeof script==='function'?script.options:script;if(template&&template.render){options.render=template.render;options.staticRenderFns=template.staticRenderFns;options._compiled=true;if(isFunctionalTemplate){options.functional=true;}}
if(scopeId){options._scopeId=scopeId;}
var hook;if(moduleIdentifier){hook=function hook(context){context=context||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext;if(!context&&typeof __VUE_SSR_CONTEXT__!=='undefined'){context=__VUE_SSR_CONTEXT__;}
if(style){style.call(this,createInjectorSSR(context));}
if(context&&context._registeredComponents){context._registeredComponents.add(moduleIdentifier);}};options._ssrRegister=hook;}else if(style){hook=shadowMode?function(context){style.call(this,createInjectorShadow(context,this.$root.$options.shadowRoot));}:function(context){style.call(this,createInjector(context));};}
if(hook){if(options.functional){var originalRender=options.render;options.render=function renderWithStyleInjection(h,context){hook.call(context);return originalRender(h,context);};}else{var existing=options.beforeCreate;options.beforeCreate=existing?[].concat(existing,hook):[hook];}}
return script;}
var __vue_script__=script;var __vue_render__=function __vue_render__(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("g",[_vm._l(_vm.edges,function(e){return _c("path",{staticClass:"edge",attrs:{d:e}});}),_vm._v(" "),_vm.rootEdge?_c("path",{staticClass:"edge",attrs:{d:_vm.rootEdge}}):_vm._e(),_vm._v(" "),!_vm.node.children.length?_c("path",{staticClass:"edge",attrs:{d:_vm.checkEdge}}):_vm._e(),_vm._v(" "),_c("rect",{"class":_vm.nodeClass,attrs:{width:_vm.boxWidth,height:_vm.boxHeight,x:_vm.x,y:_vm.y,rx:"5"}}),_vm._v(" "),_c("foreignObject",{attrs:{width:_vm.boxWidth-10,height:_vm.boxHeight-10,x:_vm.x+5,y:_vm.y+5}},[_c("div",{staticClass:"text",attrs:{xmlns:"http://www.w3.org/1999/xhtml"}},[_vm.vardata&&_vm.vardata.type==="int"?_c("span",[_vm.variable.startsWith("entries_")?_c("span",{staticClass:"fa fa-sign-in"}):_vm._e(),_vm._v("\n                "+_vm._s(_vm.vardata.label)+"\n                "),_c("br"),_vm._v(" "),_vm.varresult!==null?_c("span",[_vm._v("\n                  "+_vm._s(_vm.varresult)+"\n                ")]):_vm._e(),_vm._v(" "),_c("strong",[_vm._v("\n                  "+_vm._s(_vm.op.label)+" "+_vm._s(_vm.rightoperand)+"\n                ")])]):_vm.vardata&&_vm.vardata.type==="int_by_datetime"?_c("span",[_vm.variable.startsWith("entries_")?_c("span",{staticClass:"fa fa-sign-in"}):_vm._e(),_vm._v("\n                "+_vm._s(_vm.vardata.label)+"\n                "),_vm.node.rule[_vm.operator][0][_vm.variable][0].buildTime[0]==="custom"?_c("span",[_vm._v("\n                  "+_vm._s(_vm.df(_vm.node.rule[_vm.operator][0][_vm.variable][0].buildTime[1]))+"\n                ")]):_vm.node.rule[_vm.operator][0][_vm.variable][0].buildTime[0]==="customtime"?_c("span",[_vm._v("\n                  "+_vm._s(_vm.tf(_vm.node.rule[_vm.operator][0][_vm.variable][0].buildTime[1]))+"\n                ")]):_c("span",[_vm._v("\n                  "+_vm._s(this.$root.texts[_vm.node.rule[_vm.operator][0][_vm.variable][0].buildTime[0]])+"\n                ")]),_vm._v(" "),_c("br"),_vm._v(" "),_vm.varresult!==null?_c("span",[_vm._v("\n                  "+_vm._s(_vm.varresult)+"\n                ")]):_vm._e(),_vm._v(" "),_c("strong",[_vm._v("\n                  "+_vm._s(_vm.op.label)+" "+_vm._s(_vm.rightoperand)+"\n                ")])]):_vm.vardata&&_vm.variable==="now"?_c("span",[_c("span",{staticClass:"fa fa-clock-o"}),_vm._v(" "+_vm._s(_vm.vardata.label)),_c("br"),_vm._v(" "),_vm.varresult!==null?_c("span",[_vm._v("\n                  "+_vm._s(_vm.varresult)+"\n                ")]):_vm._e(),_vm._v(" "),_c("strong",[_vm._v("\n                    "+_vm._s(_vm.op.label)),_c("br"),_vm._v(" "),_vm.rightoperand.buildTime[0]==="custom"?_c("span",[_vm._v("\n                        "+_vm._s(_vm.df(_vm.rightoperand.buildTime[1]))+"\n                    ")]):_vm.rightoperand.buildTime[0]==="customtime"?_c("span",[_vm._v("\n                        "+_vm._s(_vm.tf(_vm.rightoperand.buildTime[1]))+"\n                    ")]):_c("span",[_vm._v("\n                        "+_vm._s(this.$root.texts[_vm.rightoperand.buildTime[0]])+"\n                    ")]),_vm._v(" "),_vm.operands[2]?_c("span",[_vm.operator==="isBefore"?_c("span",[_vm._v("+")]):_c("span",[_vm._v("-")]),_vm._v("\n                        "+_vm._s(_vm.operands[2])+"\n                        "+_vm._s(this.$root.texts.minutes)+"\n                    ")]):_vm._e()])]):_vm.vardata&&_vm.operator==="inList"?_c("span",[_vm.variable==="gate"?_c("span",{staticClass:"fa fa-sign-in"}):_c("span",{staticClass:"fa fa-ticket"}),_vm._v("\n                "+_vm._s(_vm.vardata.label)+"\n                "),_vm.varresult!==null?_c("span",[_vm._v("\n                  ("+_vm._s(_vm.varresult)+")\n                ")]):_vm._e(),_vm._v(" "),_c("br"),_vm._v(" "),_c("strong",[_vm._v("\n                    "+_vm._s(_vm.rightoperand.objectList.map(function(o){return o.lookup[2];}).join(", "))+"\n                ")])]):_vm.vardata&&_vm.vardata.type==="enum_entry_status"?_c("span",[_c("span",{staticClass:"fa fa-check-circle-o"}),_vm._v("\n                "+_vm._s(_vm.vardata.label)+"\n                "),_vm.varresult!==null?_c("span",[_vm._v("\n                  ("+_vm._s(_vm.varresult)+")\n                ")]):_vm._e(),_vm._v(" "),_c("br"),_vm._v(" "),_c("strong",[_vm._v("\n                    "+_vm._s(_vm.op.label)+" "+_vm._s(_vm.rightoperand)+"\n                ")])]):_vm._e()])]),_vm._v(" "),_vm.result===false?_c("g",{attrs:{transform:"translate("+(_vm.x+_vm.boxWidth-15)+", "+(_vm.y-10)+")"}},[_c("ellipse",{attrs:{fill:"#fff",cx:"14.685823",cy:"14.318233",rx:"12.140151",ry:"11.55523"}}),_vm._v(" "),_c("path",{staticClass:"error",attrs:{d:"M 15,0 C 23.28125,0 30,6.71875 30,15 30,23.28125 23.28125,30 15,30 6.71875,30 0,23.28125 0,15 0,6.71875 6.71875,0 15,0 Z m 2.5,24.35547 V 20.64453 C 17.5,20.29297 17.22656,20 16.89453,20 h -3.75 C 12.79297,20 12.5,20.29297 12.5,20.64453 v 3.71094 C 12.5,24.70703 12.79297,25 13.14453,25 h 3.75 C 17.22656,25 17.5,24.70703 17.5,24.35547 Z M 17.4609,17.63672 17.81246,5.50781 c 0,-0.13672 -0.0586,-0.27343 -0.19531,-0.35156 C 17.49996,5.05855 17.32418,5 17.1484,5 h -4.29688 c -0.17578,0 -0.35156,0.0586 -0.46875,0.15625 -0.13672,0.0781 -0.19531,0.21484 -0.19531,0.35156 l 0.33203,12.12891 c 0,0.27344 0.29297,0.48828 0.66406,0.48828 h 3.61329 c 0.35156,0 0.64453,-0.21484 0.66406,-0.48828 z"}})]):_vm._e(),_vm._v(" "),_vm.result===true?_c("g",{attrs:{transform:"translate("+(_vm.x+_vm.boxWidth-15)+", "+(_vm.y-10)+")"}},[_c("ellipse",{attrs:{fill:"#fff",cx:"14.685823",cy:"14.318233",rx:"12.140151",ry:"11.55523"}}),_vm._v(" "),_c("path",{staticClass:"check",attrs:{d:"m 25.078125,11.835938 c 0,-0.332032 -0.117188,-0.664063 -0.351563,-0.898438 L 22.949219,9.1796875 c -0.234375,-0.234375 -0.546875,-0.3710937 -0.878907,-0.3710937 -0.332031,0 -0.644531,0.1367187 -0.878906,0.3710937 L 13.222656,17.128906 8.8085938,12.714844 C 8.5742188,12.480469 8.2617188,12.34375 7.9296875,12.34375 c -0.3320313,0 -0.6445313,0.136719 -0.8789063,0.371094 l -1.7773437,1.757812 c -0.234375,0.234375 -0.3515625,0.566407 -0.3515625,0.898438 0,0.332031 0.1171875,0.644531 0.3515625,0.878906 l 7.0703125,7.070312 c 0.234375,0.234375 0.566406,0.371094 0.878906,0.371094 0.332032,0 0.664063,-0.136719 0.898438,-0.371094 L 24.726562,12.714844 c 0.234375,-0.234375 0.351563,-0.546875 0.351563,-0.878906 z M 30,15 C 30,23.28125 23.28125,30 15,30 6.71875,30 0,23.28125 0,15 0,6.71875 6.71875,0 15,0 23.28125,0 30,6.71875 30,15 Z"}})]):_vm._e(),_vm._v(" "),!_vm.node.children.length&&(_vm.resultInclParents===null||_vm.resultInclParents===true)?_c("g",{attrs:{transform:"translate("+(_vm.x+_vm.boxWidth+25)+", "+(_vm.y+_vm.boxHeight/2-15)+")"}},[_c("path",{staticClass:"check",attrs:{d:"m 25.078125,11.835938 c 0,-0.332032 -0.117188,-0.664063 -0.351563,-0.898438 L 22.949219,9.1796875 c -0.234375,-0.234375 -0.546875,-0.3710937 -0.878907,-0.3710937 -0.332031,0 -0.644531,0.1367187 -0.878906,0.3710937 L 13.222656,17.128906 8.8085938,12.714844 C 8.5742188,12.480469 8.2617188,12.34375 7.9296875,12.34375 c -0.3320313,0 -0.6445313,0.136719 -0.8789063,0.371094 l -1.7773437,1.757812 c -0.234375,0.234375 -0.3515625,0.566407 -0.3515625,0.898438 0,0.332031 0.1171875,0.644531 0.3515625,0.878906 l 7.0703125,7.070312 c 0.234375,0.234375 0.566406,0.371094 0.878906,0.371094 0.332032,0 0.664063,-0.136719 0.898438,-0.371094 L 24.726562,12.714844 c 0.234375,-0.234375 0.351563,-0.546875 0.351563,-0.878906 z M 30,15 C 30,23.28125 23.28125,30 15,30 6.71875,30 0,23.28125 0,15 0,6.71875 6.71875,0 15,0 23.28125,0 30,6.71875 30,15 Z"}})]):_vm._e(),_vm._v(" "),!_vm.node.children.length&&_vm.resultInclParents===false?_c("g",{attrs:{transform:"translate("+(_vm.x+_vm.boxWidth+25)+", "+(_vm.y+_vm.boxHeight/2-15)+")"}},[_c("path",{staticClass:"error",attrs:{d:"M 15,0 C 23.28125,0 30,6.71875 30,15 30,23.28125 23.28125,30 15,30 6.71875,30 0,23.28125 0,15 0,6.71875 6.71875,0 15,0 Z m 2.5,24.35547 V 20.64453 C 17.5,20.29297 17.22656,20 16.89453,20 h -3.75 C 12.79297,20 12.5,20.29297 12.5,20.64453 v 3.71094 C 12.5,24.70703 12.79297,25 13.14453,25 h 3.75 C 17.22656,25 17.5,24.70703 17.5,24.35547 Z M 17.4609,17.63672 17.81246,5.50781 c 0,-0.13672 -0.0586,-0.27343 -0.19531,-0.35156 C 17.49996,5.05855 17.32418,5 17.1484,5 h -4.29688 c -0.17578,0 -0.35156,0.0586 -0.46875,0.15625 -0.13672,0.0781 -0.19531,0.21484 -0.19531,0.35156 l 0.33203,12.12891 c 0,0.27344 0.29297,0.48828 0.66406,0.48828 h 3.61329 c 0.35156,0 0.64453,-0.21484 0.66406,-0.48828 z"}})]):_vm._e()],2);};var __vue_staticRenderFns__=[];__vue_render__._withStripped=true;var __vue_inject_styles__=undefined;var __vue_scope_id__=undefined;var __vue_module_identifier__=undefined;var __vue_is_functional_template__=false;var __vue_component__=normalizeComponent({render:__vue_render__,staticRenderFns:__vue_staticRenderFns__},__vue_inject_styles__,__vue_script__,__vue_scope_id__,__vue_is_functional_template__,__vue_module_identifier__,false,undefined,undefined,undefined);exports["default"]=__vue_component__;Object.defineProperty(exports,'__esModule',{value:true});return exports;}({});;function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread();}
function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}
function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r);}
function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r);}
function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_unsupportedIterableToArray(r,e)||_nonIterableRest();}
function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}
function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1;}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r;}finally{try{if(!f&&null!=t["return"]&&(u=t["return"](),Object(u)!==u))return;}finally{if(o)throw n;}}return a;}}
function _arrayWithHoles(r){if(Array.isArray(r))return r;}
function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]};},e:function e(r){throw r;},f:F};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var o,a=!0,u=!1;return{s:function s(){t=t.call(r);},n:function n(){var r=t.next();return a=r.done,r;},e:function e(r){u=!0,o=r;},f:function f(){try{a||null==t["return"]||t["return"]();}finally{if(u)throw o;}}};}
function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0;}}
function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n;}
function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o;}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o;},_typeof(o);}
var CheckinRulesVisualization=function(exports){'use strict';var script={components:{VizNode:VizNode["default"]},computed:{boxWidth:function boxWidth(){return 300;},boxHeight:function boxHeight(){return 62;},paddingX:function paddingX(){return 50;},marginX:function marginX(){return 50;},marginY:function marginY(){return 20;},contentWidth:function contentWidth(){return this.graph.columns*(this.boxWidth+this.marginX)+2*this.paddingX;},contentHeight:function contentHeight(){return this.graph.height*(this.boxHeight+this.marginY);},viewBox:function viewBox(){return"0 0 ".concat(this.contentWidth," ").concat(this.contentHeight);},graph:function graph(){var graph={nodes_by_id:{},children:[],columns:-1};var counter=0;var _add_to_graph6=function _add_to_graph(rule){if(_typeof(rule)!=='object'||rule===null){var node_id=(counter++).toString();graph.nodes_by_id[node_id]={rule:rule,column:-1,children:[]};return[[node_id],[node_id]];}
var operator=Object.keys(rule)[0];var operands=rule[operator];if(operator==="and"){var children=[];var tails=null;operands.reverse();var _iterator=_createForOfIteratorHelper(operands),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var operand=_step.value;var _add_to_graph2=_add_to_graph6(operand),_add_to_graph3=_slicedToArray(_add_to_graph2,2),new_children=_add_to_graph3[0],new_tails=_add_to_graph3[1];var _iterator2=_createForOfIteratorHelper(new_tails),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _graph$nodes_by_id$ne;var new_child=_step2.value;(_graph$nodes_by_id$ne=graph.nodes_by_id[new_child].children).push.apply(_graph$nodes_by_id$ne,_toConsumableArray(children));var _iterator3=_createForOfIteratorHelper(children),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var c=_step3.value;graph.nodes_by_id[c].parent=graph.nodes_by_id[new_child];}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}
if(tails===null){tails=new_tails;}
children=new_children;}}catch(err){_iterator.e(err);}finally{_iterator.f();}
return[children,tails];}else if(operator==="or"){var _children=[];var _tails=[];var _iterator4=_createForOfIteratorHelper(operands),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var _operand=_step4.value;var _add_to_graph4=_add_to_graph6(_operand),_add_to_graph5=_slicedToArray(_add_to_graph4,2),_new_children=_add_to_graph5[0],_new_tails=_add_to_graph5[1];_children.push.apply(_children,_toConsumableArray(_new_children));_tails.push.apply(_tails,_toConsumableArray(_new_tails));}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}
return[_children,_tails];}else{var _node_id=(counter++).toString();graph.nodes_by_id[_node_id]={rule:rule,column:-1,children:[]};return[[_node_id],[_node_id]];}};graph.children=_add_to_graph6(JSON.parse(JSON.stringify(this.$root.rules)))[0];var _set_column_to_min2=function _set_column_to_min(nodes,mincol){var _iterator5=_createForOfIteratorHelper(nodes),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var node=_step5.value;if(mincol>node.column){node.column=mincol;graph.columns=Math.max(mincol+1,graph.columns);_set_column_to_min2(node.children.map(function(nid){return graph.nodes_by_id[nid];}),mincol+1);}}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}};_set_column_to_min2(graph.children.map(function(nid){return graph.nodes_by_id[nid];}),0);var _set_y2=function _set_y(node,offset){if(typeof node.y==="undefined"){node.y=offset;}
var used=0;var _iterator6=_createForOfIteratorHelper(node.children),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var cid=_step6.value;used+=Math.max(0,_set_y2(graph.nodes_by_id[cid],offset+used)-1);used++;}}catch(err){_iterator6.e(err);}finally{_iterator6.f();}
return used;};_set_y2(graph,0);graph.height=1;for(var _i=0,_arr=_toConsumableArray(Object.values(graph.nodes_by_id));_i<_arr.length;_i++){var node=_arr[_i];graph.height=Math.max(graph.height,node.y+1);}
return graph;}},mounted:function mounted(){this.createZoom();},created:function created(){window.addEventListener('resize',this.createZoom);},destroyed:function destroyed(){window.removeEventListener('resize',this.createZoom);},watch:{maximized:function maximized(){var _this=this;this.$nextTick(function(){_this.createZoom();});}},methods:{createZoom:function createZoom(){var _this2=this;if(!this.$refs.svg)return;var viewportHeight=this.$refs.svg.clientHeight;var viewportWidth=this.$refs.svg.clientWidth;this.defaultScale=1;this.zoom=d3.zoom().scaleExtent([Math.min(this.defaultScale*0.5,1),Math.max(5,this.contentHeight/viewportHeight,this.contentWidth/viewportWidth)]).extent([[0,0],[viewportWidth,viewportHeight]]).filter(function(event){var wheeled=event.type==='wheel';var mouseDrag=event.type==='mousedown'||event.type==='mouseup'||event.type==='mousemove';var touch=event.type==='touchstart'||event.type==='touchmove'||event.type==='touchstop';return(wheeled||mouseDrag||touch)&&_this2.maximized;}).wheelDelta(function(event){return-event.deltaY*(event.deltaMode===1?0.05:event.deltaMode?1:0.002);}).on('zoom',function(event){_this2.zoomTransform=event.transform;});var initTransform=d3.zoomIdentity.scale(this.defaultScale).translate(0,0);this.zoomTransform=initTransform;d3.select(this.$refs.svg).call(this.zoom.transform,initTransform);var svg=d3.select(this.$refs.svg).call(this.zoom);svg.on('touchmove.zoom',null);}},data:function data(){return{maximized:false,zoom:null,defaultScale:1,zoomTransform:d3.zoomTransform({k:1,x:0,y:0})};}};function normalizeComponent(template,style,script,scopeId,isFunctionalTemplate,moduleIdentifier,shadowMode,createInjector,createInjectorSSR,createInjectorShadow){if(typeof shadowMode!=='boolean'){createInjectorSSR=createInjector;createInjector=shadowMode;shadowMode=false;}
var options=typeof script==='function'?script.options:script;if(template&&template.render){options.render=template.render;options.staticRenderFns=template.staticRenderFns;options._compiled=true;if(isFunctionalTemplate){options.functional=true;}}
if(scopeId){options._scopeId=scopeId;}
var hook;if(moduleIdentifier){hook=function hook(context){context=context||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext;if(!context&&typeof __VUE_SSR_CONTEXT__!=='undefined'){context=__VUE_SSR_CONTEXT__;}
if(style){style.call(this,createInjectorSSR(context));}
if(context&&context._registeredComponents){context._registeredComponents.add(moduleIdentifier);}};options._ssrRegister=hook;}else if(style){hook=shadowMode?function(context){style.call(this,createInjectorShadow(context,this.$root.$options.shadowRoot));}:function(context){style.call(this,createInjector(context));};}
if(hook){if(options.functional){var originalRender=options.render;options.render=function renderWithStyleInjection(h,context){hook.call(context);return originalRender(h,context);};}else{var existing=options.beforeCreate;options.beforeCreate=existing?[].concat(existing,hook):[hook];}}
return script;}
var __vue_script__=script;var __vue_render__=function __vue_render__(){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c("div",{"class":"checkin-rules-visualization "+(_vm.maximized?"maximized":"")},[_c("div",{staticClass:"tools"},[_vm.maximized?_c("button",{staticClass:"btn btn-default",attrs:{type:"button"},on:{click:function click($event){$event.preventDefault();_vm.maximized=false;}}},[_c("span",{staticClass:"fa fa-window-close"})]):_vm._e(),_vm._v(" "),!_vm.maximized?_c("button",{staticClass:"btn btn-default",attrs:{type:"button"},on:{click:function click($event){$event.preventDefault();_vm.maximized=true;}}},[_c("span",{staticClass:"fa fa-window-maximize"})]):_vm._e()]),_vm._v(" "),_c("svg",{ref:"svg",attrs:{width:_vm.graph.columns*(_vm.boxWidth+_vm.marginX)+2*_vm.paddingX,height:_vm.graph.height*(_vm.boxHeight+_vm.marginY),viewBox:_vm.viewBox}},[_c("g",{attrs:{transform:_vm.zoomTransform.toString()}},_vm._l(_vm.graph.nodes_by_id,function(node,nodeid){return _c("viz-node",{key:nodeid,attrs:{node:node,children:node.children.map(function(n){return _vm.graph.nodes_by_id[n];}),nodeid:nodeid,boxWidth:_vm.boxWidth,boxHeight:_vm.boxHeight,marginX:_vm.marginX,marginY:_vm.marginY,paddingX:_vm.paddingX}});}),1)])]);};var __vue_staticRenderFns__=[];__vue_render__._withStripped=true;var __vue_inject_styles__=undefined;var __vue_scope_id__=undefined;var __vue_module_identifier__=undefined;var __vue_is_functional_template__=false;var __vue_component__=normalizeComponent({render:__vue_render__,staticRenderFns:__vue_staticRenderFns__},__vue_inject_styles__,__vue_script__,__vue_scope_id__,__vue_is_functional_template__,__vue_module_identifier__,false,undefined,undefined,undefined);exports["default"]=__vue_component__;Object.defineProperty(exports,'__esModule',{value:true});return exports;}({});;$(function(){var TYPEOPS={'product':{'inList':{'label':gettext('is one of'),'cardinality':2,}},'variation':{'inList':{'label':gettext('is one of'),'cardinality':2,}},'gate':{'inList':{'label':gettext('is one of'),'cardinality':2,}},'datetime':{'isBefore':{'label':gettext('is before'),'cardinality':2,},'isAfter':{'label':gettext('is after'),'cardinality':2,},},'enum_entry_status':{'==':{'label':gettext('='),'cardinality':2,},},'int_by_datetime':{'<':{'label':'<','cardinality':2,},'<=':{'label':'','cardinality':2,},'>':{'label':'>','cardinality':2,},'>=':{'label':'','cardinality':2,},'==':{'label':'=','cardinality':2,},'!=':{'label':'','cardinality':2,},},'int':{'<':{'label':'<','cardinality':2,},'<=':{'label':'','cardinality':2,},'>':{'label':'>','cardinality':2,},'>=':{'label':'','cardinality':2,},'==':{'label':'=','cardinality':2,},'!=':{'label':'','cardinality':2,},},};var VARS={'product':{'label':gettext('Product'),'type':'product',},'variation':{'label':gettext('Product variation'),'type':'variation',},'gate':{'label':gettext('Gate'),'type':'gate',},'now':{'label':gettext('Current date and time'),'type':'datetime',},'now_isoweekday':{'label':gettext('Current day of the week (1 = Monday, 7 = Sunday)'),'type':'int',},'entry_status':{'label':gettext('Current entry status'),'type':'enum_entry_status',},'entries_number':{'label':gettext('Number of previous entries'),'type':'int',},'entries_today':{'label':gettext('Number of previous entries since midnight'),'type':'int',},'entries_since':{'label':gettext('Number of previous entries since'),'type':'int_by_datetime',},'entries_before':{'label':gettext('Number of previous entries before'),'type':'int_by_datetime',},'entries_days':{'label':gettext('Number of days with a previous entry'),'type':'int',},'entries_days_since':{'label':gettext('Number of days with a previous entry since'),'type':'int_by_datetime',},'entries_days_before':{'label':gettext('Number of days with a previous entry before'),'type':'int_by_datetime',},'minutes_since_last_entry':{'label':gettext('Minutes since last entry (-1 on first entry)'),'type':'int',},'minutes_since_first_entry':{'label':gettext('Minutes since first entry (-1 on first entry)'),'type':'int',},};var components={CheckinRulesVisualization:CheckinRulesVisualization.default,}
if(typeof CheckinRule!=="undefined"){Vue.component('checkin-rule',CheckinRule.default);components={CheckinRulesEditor:CheckinRulesEditor.default,CheckinRulesVisualization:CheckinRulesVisualization.default,}}
var app=new Vue({el:'#rules-editor',components:components,data:function(){return{rules:{},items:[],all_products:false,limit_products:[],TYPEOPS:TYPEOPS,VARS:VARS,texts:{and:gettext('All of the conditions below (AND)'),or:gettext('At least one of the conditions below (OR)'),date_from:gettext('Event start'),date_to:gettext('Event end'),date_admission:gettext('Event admission'),date_custom:gettext('custom date and time'),date_customtime:gettext('custom time'),date_tolerance:gettext('Tolerance (minutes)'),condition_add:gettext('Add condition'),minutes:gettext('minutes'),duplicate:gettext('Duplicate'),status_present:pgettext('entry_status','present'),status_absent:pgettext('entry_status','absent'),},hasRules:false,};},computed:{missingItems:function(){var products_seen={};var variations_seen={};var rules=convert_to_dnf(this.rules);var branch_without_product_filter=false;if(!rules["or"]){rules={"or":[rules]}}
for(var part of rules["or"]){if(!part["and"]){part={"and":[part]}}
var this_branch_without_product_filter=true;for(var subpart of part["and"]){if(subpart["inList"]){if(subpart["inList"][0]["var"]==="product"&&subpart["inList"][1]){this_branch_without_product_filter=false;for(var listentry of subpart["inList"][1]["objectList"]){products_seen[parseInt(listentry["lookup"][1])]=true}}else if(subpart["inList"][0]["var"]==="variation"&&subpart["inList"][1]){this_branch_without_product_filter=false;for(var listentry_ of subpart["inList"][1]["objectList"]){variations_seen[parseInt(listentry_["lookup"][1])]=true}}}}
if(this_branch_without_product_filter){branch_without_product_filter=true;break;}}
if(branch_without_product_filter||(!Object.keys(products_seen).length&&!Object.keys(variations_seen).length)){return[];}
var missing=[];for(var item of this.items){if(products_seen[item.id])continue;if(!this.all_products&&!this.limit_products.includes(item.id))continue;if(item.variations.length>0){for(var variation of item.variations){if(variations_seen[variation.id])continue;missing.push(item.name+"  "+variation.name)}}else{missing.push(item.name)}}
return missing;}},created:function(){this.rules=JSON.parse($("#id_rules").val());if($("#items").length){this.items=JSON.parse($("#items").html());var root=this.$root
function _update(){root.all_products=$("#id_all_products").prop("checked")
root.limit_products=$("input[name=limit_products]:checked").map(function(){return parseInt($(this).val())}).toArray()}
$("#id_all_products, input[name=limit_products]").on("change",function(){_update();})
_update()
function check_for_invalid_ids(valid_products,valid_variations,rule){if(rule["and"]){for(const child of rule["and"])
check_for_invalid_ids(valid_products,valid_variations,child);}else if(rule["or"]){for(const child of rule["or"])
check_for_invalid_ids(valid_products,valid_variations,child);}else if(rule["inList"]&&rule["inList"][0]["var"]==="product"){for(const item of rule["inList"][1]["objectList"]){if(!valid_products[item["lookup"][1]])
item["lookup"][2]="["+gettext('Error: Product not found!')+"]";else
item["lookup"][2]=valid_products[item["lookup"][1]];}}else if(rule["inList"]&&rule["inList"][0]["var"]==="variation"){for(const item of rule["inList"][1]["objectList"]){if(!valid_variations[item["lookup"][1]])
item["lookup"][2]="["+gettext('Error: Variation not found!')+"]";else
item["lookup"][2]=valid_variations[item["lookup"][1]];}}}
check_for_invalid_ids(Object.fromEntries(this.items.map(p=>[p.id,p.name])),Object.fromEntries(this.items.flatMap(p=>p.variations?.map(v=>[v.id,p.name+'  '+v.name]))),this.rules);}},watch:{rules:{deep:true,handler:function(newval){$("#id_rules").val(JSON.stringify(newval));}},}})});;