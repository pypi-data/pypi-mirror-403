# =============================================================================
# PIPELINE CONFIGURATION
# =============================================================================
#
# Pipeline parameters:
# - name (str, required): human-readable pipeline name
# - description (str, required): detailed description of pipeline purpose
#
# =============================================================================

name: "Deal Closer"
description: "Deal Closer is an end-to-end agentic workflow that generates a comprehensive one-page 'Meeting Cheat Sheet' for any company. The pipeline extracts company name and optional subject from natural language input, performs parallel research on company news (subject-focused if provided), leadership, and competitors, then synthesizes the findings into actionable insights before compiling a polished markdown document ready for business meetings."

# =============================================================================
# PIPELINE PATTERN CONFIGURATION
# =============================================================================
#
# Define the execution flow explicitly using one of three constructs:
#   - sequential: run children in order
#   - parallel: run children concurrently (wait_all)
#   - loop: repeat body up to max_iterations
#
# NODES REGISTRY (REQUIRED)
# - nodes (list[object], required)
#   - nodes[].id (str, required): agent identifier
#   - nodes[].config_file (str, required): path to agent configuration file (relative to config/)
#
# PATTERN (REQUIRED)
# - pattern (object, required): one of sequential | parallel | loop
#
# STEP (LEAF)
# - node (str, required): "agent_id"
#
# SEQUENTIAL
# - type: sequential (required)
# - steps: list of (step | pattern) (required, >=1)
#
# PARALLEL
# - type: parallel (required)
# - steps: list of (step | pattern) (required, >=1)
# - semantics: wait_all; first error fails the group (MVP defaults)
#
# LOOP
# - type: loop (required)
# - body: (step | sequential | parallel) (required)
# - max_iterations: int (required, >=1)
#
# NOTES
# - Context model unchanged: each node writes to context.upstream[node_id]
# - Gates and outputs are configured in their respective sections below
#
# =============================================================================

nodes:
  - id: deal_closer_parser
    config_file: "agents/deal_closer_parser.yml"
  - id: deal_closer_news_researcher
    config_file: "agents/deal_closer_news_researcher.yml"
  - id: deal_closer_leadership_researcher
    config_file: "agents/deal_closer_leadership_researcher.yml"
  - id: deal_closer_competitors_researcher
    config_file: "agents/deal_closer_competitors_researcher.yml"
  - id: deal_closer_analyst
    config_file: "agents/deal_closer_analyst.yml"
  - id: deal_closer_compiler
    config_file: "agents/deal_closer_compiler.yml"

pattern:
  type: sequential
  name: "Deal Closer Research and Compilation Flow"
  description: |
    ## Deal Closer Research and Compilation Flow
    
    This sequential pattern orchestrates the complete deal closer workflow:
    1. **Parser** extracts company name and optional subject from natural language input
    2. **Parallel Research** runs news, leadership, and competitors research concurrently
    3. **Analyst** synthesizes findings into actionable insights
    4. **Compiler** creates a polished one-page meeting cheat sheet
    
    The workflow efficiently gathers comprehensive company intelligence through parallel research, then synthesizes it into a concise, actionable document.
  steps:
    - node: deal_closer_parser
    - type: parallel
      name: "Parallel Company Research"
      description: |
        ## Concurrent Research Execution
        
        This parallel pattern conducts comprehensive company research concurrently:
        - **News Researcher** gathers recent news and developments (subject-focused if provided)
        - **Leadership Researcher** researches company leadership and key executives
        - **Competitors Researcher** identifies and analyzes competitors
        
        All three research streams run simultaneously to maximize efficiency and provide comprehensive intelligence.
      steps:
        - node: deal_closer_news_researcher
        - node: deal_closer_leadership_researcher
        - node: deal_closer_competitors_researcher
    - node: deal_closer_analyst
    - node: deal_closer_compiler
# =============================================================================
# HITL SECTION - Human-in-the-loop gates
# =============================================================================
#
# Human-in-the-Loop gates configuration (optional)
# Parameters:
# - gates (list[object], optional): human-in-the-loop pause points
#   - gates[].id (str, required): unique gate id
#   - gates[].type (str, required): "approval" | "input" | "selection"
#   - gates[].title (str, optional): UI title
#   - gates[].description (str, optional): UI description
#   - gates[].fields (list[object], optional): form fields for input gates
#   - gates[].options (list[object], optional): selection options for selection gates
#   - gates[].target_agents (list[str], optional): which agents receive this data
#   - gates[].context_key (str, optional): key to store data in context
#   - gates[].timeout_ms (int, optional): wait timeout; default 300000
#   - gates[].on_timeout (str, optional): "approve" | "reject" | "skip" | "default"
#
# =============================================================================

# No HITL gates required for this pipeline

# =============================================================================
# OUTPUTS SECTION - Intermediate and Final Outputs
# =============================================================================
#
# Output configuration for pipeline results
# Parameters:
# - intermediate (list[object], optional): intermediate outputs during execution
#   - intermediate[].id (str, required): unique output identifier
#   - intermediate[].node (str, required): which node's output to capture
#   - intermediate[].selectors (list[str], required): JSON keys/paths to extract
#   - intermediate[].transform (str, optional): Jinja2 expression for transformation
# - final (object, required): final pipeline output
#   - final.node (str, required): which node's output to use as final result
#   - final.selectors (list[str], required): JSON keys/paths to extract
#   - final.transform (str, optional): Jinja2 expression for transformation
#
# =============================================================================

outputs:
  final:
    node: deal_closer_compiler
    selectors:
      - cheat_sheet_md
      - error
    transform: "{{ value }}"

