[tool.poetry]
name        = "cubexpress"
version     = "0.1.33"
description = "Efficient processing of cubic Earth-observation (EO) data."
authors     = [
  "Julio Contreras <contrerasnetk@gmail.com>",
]

repository   = "https://github.com/andesdatacube/cubexpress"
documentation = "https://andesdatacube.github.io/cubexpress"
readme       = "README.md"
keywords     = ["earth-engine", "sentinel-2", "geospatial", "eo", "cube"]
classifiers  = [
  "Programming Language :: Python :: 3 :: Only",
  "Programming Language :: Python :: 3.10",
  "Programming Language :: Python :: 3.11",
  "Programming Language :: Python :: 3.12",
  "License :: OSI Approved :: MIT License",
  "Topic :: Scientific/Engineering :: GIS",
]
packages = [{ include = "cubexpress" }]

include = [
    "cubexpress/*.py"
]

[tool.poetry.dependencies]
python            = "^3.10"
numpy             = ">=1.26.0, <2.1.0"
pandas            = ">=2.0.0"
utm               = ">=0.7.0"
pygeohash         = ">=1.2.0"       
rasterio          = ">=1.3.9"      
earthengine-api   = ">=1.5.12"    
pyarrow           = ">=14.0.0"      
pyproj            = ">=3.6.0"
pydantic          = ">=2.0.0"
tqdm              = ">=4.65.0"


[tool.poetry.group.dev.dependencies]
pytest      = "^7.2.0"
pytest-cov  = "^4.0.0"
pytest-mock = "^3.10.0"  
mypy        = "^1.5.1"
pre-commit  = "^3.4.0"
tox         = "^4.11.1"
ruff        = "^0.1.0" 

[tool.poetry.group.docs.dependencies]
mkdocs          = "^1.4.2"
mkdocs-material = "^9.2.7"
mkdocstrings    = { extras = ["python"], version = "^0.26.1" }

[build-system]
requires = ["poetry-core>=1.0.0"]
build-backend = "poetry.core.masonry.api"

# ══════════════════════════════════════════════════════════════════════════════
# Code Quality Tools Configuration
# ══════════════════════════════════════════════════════════════════════════════

[tool.black]
line-length = 120
target-version = ["py310", "py311", "py312"]

[tool.isort]
profile                = "black"
line_length            = 120
multi_line_output      = 3
include_trailing_comma = true
force_grid_wrap        = 0
use_parentheses        = true
ensure_newline_before_comments = true
skip_gitignore         = true

[tool.ruff]
line-length = 120
target-version = "py310"

[tool.ruff.lint]
select = [
  "F",      # Pyflakes
  "E",      # pycodestyle errors
  "W",      # pycodestyle warnings
  "I",      # isort
  "UP",     # pyupgrade
  "B",      # flake8-bugbear
  "SIM",    # flake8-simplify
  "C4",     # flake8-comprehensions
  "RUF",    # Ruff-specific
  "PTH",    # flake8-use-pathlib
  "PERF",   # Perflint
]

ignore = [
  "E501",    # Line too long (black handles this)
  "E731",    # Lambda assignment
  "E722",    # Bare except - usado intencionalmente para fallback robusto
  "B028",    # stacklevel en warnings - no crítico para este proyecto
  "SIM108",  # Ternary operator - preferencia de legibilidad
  "PERF203", # try-except in loop - necesario para manejo de errores GEE
  "RUF001",  # Ambiguous unicode - emojis intencionales para UX
]

[tool.ruff.lint.per-file-ignores]
"tests/*" = ["S101", "ARG", "PLR2004", "B007", "F841"]
"cubexpress/test/*" = ["S101", "ARG", "PLR2004", "B007", "F841"]
"__init__.py" = ["F401", "F403"]
# Permitir print() para feedback de progreso al usuario
"cubexpress/animation.py" = ["T201"]
"cubexpress/cloud_utils.py" = ["T201"]
"cubexpress/cube.py" = ["T201"]
"cubexpress/mss_table.py" = ["T201"]
"cubexpress/request.py" = ["T201"]

[tool.ruff.lint.mccabe]
max-complexity = 10

[tool.mypy]
python_version = "3.10"
files = ["cubexpress"]
warn_return_any = true
warn_unused_configs = true
warn_unused_ignores = true
disallow_untyped_defs = false
no_implicit_optional = true
check_untyped_defs = true
show_error_codes = true
ignore_missing_imports = true
strict_optional = true
warn_redundant_casts = true
warn_no_return = true

[[tool.mypy.overrides]]
module = [
  "rasterio.*",
  "utm.*",
  "pygeohash.*",
  "ee.*",
]
ignore_missing_imports = true


[tool.pytest.ini_options]
python_files = ["test_*.py"]
python_functions = ["test_*"]
addopts = [
    "-v",
    "--tb=short",
    "--strict-markers",
]
markers = [
    "slow: marks tests as slow (deselect with '-m \"not slow\"')",
    "integration: marks tests that require GEE connection",
]
filterwarnings = [
    "ignore::DeprecationWarning:httplib2.*:",
]

[tool.coverage.run]
source = ["cubexpress"]
omit = ["tests/*", "cubexpress/test/*"]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "if TYPE_CHECKING:",
    "raise NotImplementedError",
]