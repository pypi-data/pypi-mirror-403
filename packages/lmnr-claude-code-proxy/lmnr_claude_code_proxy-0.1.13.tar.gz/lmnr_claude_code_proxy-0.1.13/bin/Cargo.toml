[package]
edition = "2024"
name = "cc-proxy"
version = "0.1.13"

[lib]
crate-type = ["cdylib", "lib"]
name = "lmnr_claude_code_proxy"

[features]
default = []
python = ["dep:pyo3", "pyo3-build-config"]
typescript = ["dep:napi", "dep:napi-derive", "napi-build"]

[dependencies]
dashmap = "6.1"
futures-util = "0.3"
http-body-util = "0.1"
hyper = {version = "1.8.1", features = ["client", "http1", "http2", "server"]}
hyper-rustls = {version = "0.27", default-features = false, features = ["http1", "http2", "tls12", "webpki-roots", "ring"]}
hyper-util = {version = "0.1", features = ["server", "client-legacy", "http1", "http2", "tokio"]}
napi = {version = "3.7.0", optional = true}
napi-derive = {version = "3.4.0", optional = true}
prost = "0.14.1"
pyo3 = {version = "0.27", features = ["extension-module", "generate-import-lib"], optional = true}
rand = "0.9.2"
rustls = {version = "0.23", default-features = false, features = ["ring"]}
serde = {version = "1", features = ["derive"]}
serde_json = "1"
tokio = {version = "1.48.0", features = ["rt", "net", "io-util", "macros", "fs", "sync"]}
tokio-rustls = "0.26"

[profile.release]
codegen-units = 1 # Better optimization
lto = true # Link-time optimization
opt-level = "z" # Optimize for size
panic = "abort" # Smaller panic handler
strip = true # Strip symbols

[build-dependencies]
napi-build = {version = "2.3", optional = true}
pyo3-build-config = {version = "0.27", optional = true}
