/** Health controller for the {{ module_title }} NestJS integration. */

import {
  Controller,
  Get,
  HttpCode,
  HttpStatus,
  Logger,
  ServiceUnavailableException,
} from "@nestjs/common";

import { OauthService } from "./oauth.service";

@Controller("api/health/module")
export class OauthHealthController {
  private readonly logger = new Logger(OauthHealthController.name);

  constructor(private readonly service: OauthService) {}

  @Get("oauth")
  @HttpCode(HttpStatus.OK)
  getModuleHealth(): Record<string, unknown> {
    try {
      const payload = this.service.health();
      this.logger.debug(`oauth health payload=${JSON.stringify(payload)}`);
      return payload;
    } catch (error) {
      const detail =
        error instanceof Error && error.message ? error.message : "oauth health check failed";
      this.logger.error(`oauth health check failed: ${detail}`);
      throw new ServiceUnavailableException({
        status: "error",
        module: "oauth",
        detail,
      });
    }
  }
}
