# 2. Layer Specification (Ğ¡Ğ¿ĞµÑ†Ğ¸Ñ„Ñ–ĞºĞ°Ñ†Ñ–Ñ ÑˆĞ°Ñ€Ñ–Ğ²)

## ğŸ“‘ Ğ—Ğ¼Ñ–ÑÑ‚

1. [API Layer](#api-layer)
2. [Application Layer](#application-layer)
3. [Domain Layer](#domain-layer)
4. [Infrastructure Layer](#infrastructure-layer)
5. [Extensions Layer](#extensions-layer)

---

## API Layer

### ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ
ĞŸÑƒĞ±Ğ»Ñ–Ñ‡Ğ½Ğ¸Ğ¹ Ñ–Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ±Ñ–Ğ±Ğ»Ñ–Ğ¾Ñ‚ĞµĞºĞ¸ - Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ñƒ Ğ´Ğ»Ñ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–Ğ².

### ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¸

| Ğ¤Ğ°Ğ¹Ğ» | ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¸ | ĞĞ¿Ğ¸Ñ |
|------|------------|------|
| `api/__init__.py` | `crawl`, `async_crawl`, `Crawler`, `AsyncCrawler`, `crawl_sitemap` | Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ñ– Ñ„ÑƒĞ½ĞºÑ†Ñ–Ñ— API |
| `api/sync.py` | `crawl()`, `Crawler` | Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğµ API |
| `api/async_.py` | `async_crawl()`, `AsyncCrawler` | ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğµ API |
| `api/client/client.py` | `GraphCrawlerClient` | HTTP ĞºĞ»Ñ–Ñ”Ğ½Ñ‚ Ğ´Ğ»Ñ REST API |
| `api/rest_api.py` | FastAPI endpoints | REST API ÑĞµÑ€Ğ²ĞµÑ€ |
| `api/websocket_manager.py` | WebSocket Manager | Real-time Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ |

### ĞšĞ°Ğ½Ğ°Ğ»Ğ¸ ĞºĞ¾Ğ¼ÑƒĞ½Ñ–ĞºĞ°Ñ†Ñ–Ñ—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        API LAYER                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚   USER CODE â”€â”€â”€â”€â”€â–¶ crawl() â”€â”€â”€â”€â”€â–¶ Spider â”€â”€â”€â”€â”€â–¶ Graph             â”‚
â”‚                        â”‚                                           â”‚
â”‚                        â”‚ (creates internally)                      â”‚
â”‚                        â–¼                                           â”‚
â”‚               ApplicationContainer                                 â”‚
â”‚               (DI: driver, storage, plugins, event_bus)           â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ†Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ¸ Ñ‚Ğ° ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ğ¸

**Ğ’Ñ…Ñ–Ğ´Ğ½Ñ– (Ğ¾Ñ‡Ñ–ĞºÑƒÑ” Ğ²Ñ–Ğ´ Ñ–Ğ½ÑˆĞ¸Ñ… ÑˆĞ°Ñ€Ñ–Ğ²):**
- `Spider` - Ğ· Application Layer
- `Graph`, `Node`, `Edge` - Ğ· Domain Layer
- `IDriver`, `IStorage` - Ğ· Infrastructure Layer

**Ğ’Ğ¸Ñ…Ñ–Ğ´Ğ½Ñ– (Ğ½Ğ°Ğ´Ğ°Ñ” Ñ–Ğ½ÑˆĞ¸Ğ¼):**
- `crawl(url, **config) -> Graph`
- `async_crawl(url, **config) -> Graph`
- `Crawler` context manager
- `AsyncCrawler` async context manager

### Ğ’Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚Ğ¸ Ñ€Ğ¾Ğ·ÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ

```python
# 1. ĞšĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ğ¸Ğ¹ Ğ´Ñ€Ğ°Ğ¹Ğ²ĞµÑ€
graph = crawl("https://example.com", driver=MyCustomDriver())

# 2. ĞšĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ğ¸Ğ¹ storage
graph = crawl("https://example.com", storage=MyCustomStorage())

# 3. URL Rules
rules = [URLRule(pattern=r"/admin/", should_scan=False)]
graph = crawl("https://example.com", url_rules=rules)

# 4. ĞŸĞ»Ğ°Ğ³Ñ–Ğ½Ğ¸
graph = crawl("https://example.com", plugins=[MyPlugin()])
```

---

## Application Layer

### ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ
Ğ‘Ñ–Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ñ–ĞºĞ° ĞºÑ€Ğ°ÑƒĞ»Ñ–Ğ½Ğ³Ñƒ, Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ†Ñ–Ñ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑƒ, use cases.

### ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¸

| Ğ”Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ñ–Ñ | ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¸ | ĞĞ¿Ğ¸Ñ |
|------------|------------|------|
| `application/use_cases/crawling/` | Spider, Scheduler, LinkProcessor | ĞÑĞ½Ğ¾Ğ²Ğ½Ğ° Ğ»Ğ¾Ğ³Ñ–ĞºĞ° ĞºÑ€Ğ°ÑƒĞ»Ñ–Ğ½Ğ³Ñƒ |
| `application/services/` | DriverFactory, StorageFactory | Ğ¤Ğ°Ğ±Ñ€Ğ¸ĞºĞ¸ (OCP) |
| `application/context/` | ApplicationContainer, MergeContext | DI ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¸ |
| `application/dto/` | NodeDTO, EdgeDTO, GraphDTO | Data Transfer Objects |

### ĞšĞ»ÑÑ‡Ğ¾Ğ²Ñ– ĞºĞ»Ğ°ÑĞ¸

#### Spider (ĞÑ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€)

```python
class Spider:
    """
    ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¸Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ ĞºÑ€Ğ°ÑƒĞ»Ñ–Ğ½Ğ³Ñƒ.
    
    Ğ’Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ°Ğ»ÑŒĞ½Ñ–ÑÑ‚ÑŒ:
    - ĞÑ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ†Ñ–Ñ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑƒ ÑĞºĞ°Ğ½ÑƒĞ²Ğ°Ğ½Ğ½Ñ
    - ĞšĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ñ–Ñ Scheduler, Driver, Storage
    - ĞŸÑƒĞ±Ğ»Ñ–ĞºĞ°Ñ†Ñ–Ñ Ğ¿Ğ¾Ğ´Ñ–Ğ¹ Ğ² EventBus
    """
    
    async def crawl(self, start_url: str) -> Graph:
        """Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğ¸Ğ¹ Ğ¼ĞµÑ‚Ğ¾Ğ´ ĞºÑ€Ğ°ÑƒĞ»Ñ–Ğ½Ğ³Ñƒ."""
        pass
```

#### Scheduler (ĞŸĞ»Ğ°Ğ½ÑƒĞ²Ğ°Ğ»ÑŒĞ½Ğ¸Ğº)

```python
class Scheduler:
    """
    Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ Ñ‡ĞµÑ€Ğ³Ğ¾Ñ URL.
    
    Ğ’Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ°Ğ»ÑŒĞ½Ñ–ÑÑ‚ÑŒ:
    - Ğ§ĞµÑ€Ğ³Ğ° URL Ğ· Ğ¿Ñ€Ñ–Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ°Ğ¼Ğ¸ (PriorityQueue)
    - Ğ—Ğ°ÑÑ‚Ğ¾ÑÑƒĞ²Ğ°Ğ½Ğ½Ñ URLRule
    - Ğ¤Ñ–Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ñ–Ñ Ğ´ÑƒĞ±Ğ»Ñ–ĞºĞ°Ñ‚Ñ–Ğ² (Bloom Filter)
    - Domain/Path Ñ„Ñ–Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ñ–Ñ
    """
    
    def add_url(self, url: str, depth: int) -> bool:
        """Ğ”Ğ¾Ğ´Ğ°Ñ” URL Ğ² Ñ‡ĞµÑ€Ğ³Ñƒ Ğ· ÑƒÑ€Ğ°Ñ…ÑƒĞ²Ğ°Ğ½Ğ½ÑĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»."""
        pass
    
    def get_next_url(self) -> Optional[Tuple[str, int]]:
        """ĞŸĞ¾Ğ²ĞµÑ€Ñ‚Ğ°Ñ” Ğ½Ğ°ÑÑ‚ÑƒĞ¿Ğ½Ğ¸Ğ¹ URL Ğ´Ğ»Ñ ÑĞºĞ°Ğ½ÑƒĞ²Ğ°Ğ½Ğ½Ñ."""
        pass
```

#### LinkProcessor

```python
class LinkProcessor:
    """
    ĞĞ±Ñ€Ğ¾Ğ±ĞºĞ° Ğ¿Ğ¾ÑĞ¸Ğ»Ğ°Ğ½ÑŒ.
    
    Ğ’Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ°Ğ»ÑŒĞ½Ñ–ÑÑ‚ÑŒ:
    - ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ URL
    - Ğ’Ğ°Ğ»Ñ–Ğ´Ğ°Ñ†Ñ–Ñ Ğ¿Ğ¾ÑĞ¸Ğ»Ğ°Ğ½ÑŒ
    - Ğ’Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ Ñ‚Ğ¸Ğ¿Ñƒ (internal/external)
    """
```

### ĞšĞ°Ğ½Ğ°Ğ»Ğ¸ ĞºĞ¾Ğ¼ÑƒĞ½Ñ–ĞºĞ°Ñ†Ñ–Ñ—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     APPLICATION LAYER                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  Spider â—€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Scheduler                                       â”‚
â”‚    â”‚                   â”‚                                           â”‚
â”‚    â”‚  fetch()          â”‚ add_url(), get_next_url()                â”‚
â”‚    â–¼                   â”‚                                           â”‚
â”‚  IDriver               â”‚                                           â”‚
â”‚  (Infrastructure)      â”‚                                           â”‚
â”‚    â”‚                   â”‚                                           â”‚
â”‚    â”‚  FetchResponse    â”‚                                           â”‚
â”‚    â–¼                   â”‚                                           â”‚
â”‚  NodeScanner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                           â”‚
â”‚    â”‚                   â”‚                                           â”‚
â”‚    â”‚ process_html()    â”‚                                           â”‚
â”‚    â–¼                   â”‚                                           â”‚
â”‚  LinkProcessor â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚    â”‚                                                               â”‚
â”‚    â”‚ extracted_links                                               â”‚
â”‚    â–¼                                                               â”‚
â”‚  Graph (Domain)                                                    â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Factories (OCP Pattern)

```python
# Ğ ĞµÑ”ÑÑ‚Ñ€Ğ°Ñ†Ñ–Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ´Ñ€Ğ°Ğ¹Ğ²ĞµÑ€Ğ° Ğ±ĞµĞ· Ğ·Ğ¼Ñ–Ğ½Ğ¸ ĞºĞ¾Ğ´Ñƒ Ñ„Ğ°Ğ±Ñ€Ğ¸ĞºĞ¸
from graph_crawler.application.services import register_driver

register_driver("selenium", lambda cfg: SeleniumDriver(**cfg))
driver = create_driver("selenium", {"headless": True})
```

---

## Domain Layer

### ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ
Ğ‘Ñ–Ğ·Ğ½ĞµÑ-ÑÑƒÑ‚Ğ½Ğ¾ÑÑ‚Ñ– Ñ‚Ğ° Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ´Ğ¾Ğ¼ĞµĞ½Ñƒ. **Ğ§Ğ¸ÑÑ‚Ğ° Ğ±Ñ–Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ñ–ĞºĞ° Ğ±ĞµĞ· Ğ·Ğ°Ğ»ĞµĞ¶Ğ½Ğ¾ÑÑ‚ĞµĞ¹ Ğ²Ñ–Ğ´ Ñ–Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸.**

### ĞŸÑ–Ğ´ÑˆĞ°Ñ€Ğ¸

#### 1. Entities (Ğ¡ÑƒÑ‚Ğ½Ğ¾ÑÑ‚Ñ–)

| ĞšĞ»Ğ°Ñ | Ğ¤Ğ°Ğ¹Ğ» | ĞĞ¿Ğ¸Ñ |
|------|------|------|
| `Node` | `domain/entities/node.py` | Ğ’ÑƒĞ·Ğ¾Ğ» Ğ³Ñ€Ğ°Ñ„Ñƒ (Ğ²ĞµĞ±-ÑÑ‚Ğ¾Ñ€Ñ–Ğ½ĞºĞ°) |
| `Edge` | `domain/entities/edge.py` | Ğ ĞµĞ±Ñ€Ğ¾ Ğ³Ñ€Ğ°Ñ„Ñƒ (Ğ¿Ğ¾ÑĞ¸Ğ»Ğ°Ğ½Ğ½Ñ) |
| `Graph` | `domain/entities/graph.py` | ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ³Ñ€Ğ°Ñ„Ñƒ |
| `GraphOperations` | `domain/entities/graph_operations.py` | ĞÑ€Ğ¸Ñ„Ğ¼ĞµÑ‚Ğ¸Ñ‡Ğ½Ñ– Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ñ–Ñ— (+, -, &, \|) |
| `GraphStatistics` | `domain/entities/graph_statistics.py` | Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ³Ñ€Ğ°Ñ„Ñƒ |

#### 2. Value Objects (ĞĞ±'Ñ”ĞºÑ‚Ğ¸-Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ)

| ĞšĞ»Ğ°Ñ | Ğ¤Ğ°Ğ¹Ğ» | ĞĞ¿Ğ¸Ñ |
|------|------|------|
| `URLRule` | `domain/value_objects/models.py` | ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ñ„Ñ–Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ñ–Ñ— URL |
| `FetchResponse` | `domain/value_objects/models.py` | Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ HTTP Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñƒ |
|| `ContentType` | `domain/value_objects/models.py` | Ğ¢Ğ¸Ğ¿ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ñƒ ÑÑ‚Ğ¾Ñ€Ñ–Ğ½ĞºĞ¸ (HTML, JSON, image, empty Ñ‚Ğ¾Ñ‰Ğ¾) |
| `NodeLifecycle` | `domain/value_objects/lifecycle.py` | Ğ•Ñ‚Ğ°Ğ¿Ğ¸ Ğ¶Ğ¸Ñ‚Ñ‚Ñ”Ğ²Ğ¾Ğ³Ğ¾ Ñ†Ğ¸ĞºĞ»Ñƒ Node |
| `CrawlerConfig` | `domain/value_objects/configs.py` | ĞšĞ¾Ğ½Ñ„Ñ–Ğ³ÑƒÑ€Ğ°Ñ†Ñ–Ñ ĞºÑ€Ğ°ÑƒĞ»ĞµÑ€Ğ° |

#### 3. Interfaces (Protocols)

| Protocol | Ğ¤Ğ°Ğ¹Ğ» | ĞœĞµÑ‚Ğ¾Ğ´Ğ¸ |
|----------|------|--------|
| `IDriver` | `domain/interfaces/driver.py` | `fetch()`, `fetch_many()`, `close()` |
| `IStorage` | `domain/interfaces/storage.py` | `save_graph()`, `load_graph()`, `close()` |
| `IFilter` | `domain/interfaces/filter.py` | `should_scan()`, `apply()` |
| `IEventBus` | `domain/interfaces/event_bus.py` | `subscribe()`, `publish()` |

#### 4. Events (Event-Driven)

| ĞšĞ»Ğ°Ñ | Ğ¤Ğ°Ğ¹Ğ» | ĞĞ¿Ğ¸Ñ |
|------|------|------|
| `EventType` | `domain/events/events.py` | Enum Ğ· 50+ Ñ‚Ğ¸Ğ¿Ğ°Ğ¼Ğ¸ Ğ¿Ğ¾Ğ´Ñ–Ğ¹ |
| `CrawlerEvent` | `domain/events/events.py` | ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ¿Ğ¾Ğ´Ñ–Ñ— |
| `EventBus` | `domain/events/event_bus.py` | Observer Pattern Ñ€ĞµĞ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ |

### Node Lifecycle (Ğ–Ğ¸Ñ‚Ñ‚Ñ”Ğ²Ğ¸Ğ¹ Ñ†Ğ¸ĞºĞ»)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      NODE LIFECYCLE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  Ğ•Ğ¢ĞĞŸ 1: URL_STAGE (Ğ¡Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Node(url="...")                                               â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚ Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾:                                                     â”‚   â”‚
â”‚  â”‚  â€¢ url, depth, should_scan, can_create_edges                  â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚ Plugins: ON_NODE_CREATED                                      â”‚   â”‚
â”‚  â”‚  â€¢ ĞĞ½Ğ°Ğ»Ñ–Ğ· URL                                                 â”‚   â”‚
â”‚  â”‚  â€¢ Ğ’ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ should_scan                                   â”‚   â”‚
â”‚  â”‚  â€¢ Ğ’Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ Ğ¿Ñ€Ñ–Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ñƒ                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                   â”‚                                  â”‚
â”‚                                   â”‚ fetch HTML                       â”‚
â”‚                                   â–¼                                  â”‚
â”‚  Ğ•Ğ¢ĞĞŸ 2: HTML_STAGE (ĞĞ±Ñ€Ğ¾Ğ±ĞºĞ° HTML)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ await node.process_html(html)                                 â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚ INPUT:                                                        â”‚   â”‚
â”‚  â”‚  â€¢ html - HTML ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚                                        â”‚   â”‚
â”‚  â”‚  â€¢ html_tree - DOM Ğ´ĞµÑ€ĞµĞ²Ğ¾                                     â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚ Plugins: ON_BEFORE_SCAN â†’ ON_HTML_PARSED â†’ ON_AFTER_SCAN     â”‚   â”‚
â”‚  â”‚  â€¢ MetadataExtractor: title, h1, description                  â”‚   â”‚
â”‚  â”‚  â€¢ LinkExtractor: extracted_links                             â”‚   â”‚
â”‚  â”‚  â€¢ Custom plugins: user_data                                  â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚ OUTPUT:                                                       â”‚   â”‚
â”‚  â”‚  â€¢ metadata - Ğ·Ğ°Ğ¿Ğ¾Ğ²Ğ½ĞµĞ½Ñ– Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ñ–                              â”‚   â”‚
â”‚  â”‚  â€¢ user_data - Ğ´Ğ°Ğ½Ñ– Ğ²Ñ–Ğ´ Ğ¿Ğ»Ğ°Ğ³Ñ–Ğ½Ñ–Ğ²                              â”‚   â”‚
â”‚  â”‚  â€¢ extracted_links - ÑĞ¿Ğ¸ÑĞ¾Ğº URL                               â”‚   â”‚
â”‚  â”‚  â€¢ HTML Ğ’Ğ˜Ğ”ĞĞ›Ğ•ĞĞ Ğ· Ğ¿Ğ°Ğ¼'ÑÑ‚Ñ–!                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞšĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ğ¸ Ñ–Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑ–Ğ²

#### IDriver Protocol

```python
@runtime_checkable
class IDriver(Protocol):
    """Async-First Ñ–Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ Ğ´Ñ€Ğ°Ğ¹Ğ²ĞµÑ€Ğ°."""
    
    async def fetch(self, url: str) -> FetchResponse:
        """Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ÑƒÑ” ÑÑ‚Ğ¾Ñ€Ñ–Ğ½ĞºÑƒ Ğ·Ğ° URL."""
        ...
    
    async def fetch_many(self, urls: List[str]) -> List[FetchResponse]:
        """Batch Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ¼Ğ½Ğ¾Ğ¶Ğ¸Ğ½Ğ¸ URL."""
        ...
    
    async def close(self) -> None:
        """Ğ—Ğ°ĞºÑ€Ğ¸Ğ²Ğ°Ñ” Ğ´Ñ€Ğ°Ğ¹Ğ²ĞµÑ€."""
        ...
```

#### IStorage Protocol

```python
@runtime_checkable
class IStorage(IStorageReader, IStorageWriter, IStorageLifecycle, Protocol):
    """ĞŸĞ¾Ğ²Ğ½Ğ¸Ğ¹ Async-First Ñ–Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ Ğ·Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ğ½Ğ½Ñ."""
    pass

class IStorageReader(Protocol):
    async def load_graph(self): ...
    async def exists(self) -> bool: ...

class IStorageWriter(Protocol):
    async def save_graph(self, graph) -> bool: ...
    async def save_partial(self, nodes, edges) -> bool: ...
    async def clear(self) -> bool: ...

class IStorageLifecycle(Protocol):
    async def close(self) -> None: ...
    async def __aenter__(self) -> "IStorageLifecycle": ...
    async def __aexit__(self, ...): ...
```

---

## Infrastructure Layer

### ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ
Ğ¢ĞµÑ…Ğ½Ñ–Ñ‡Ğ½Ñ– Ğ´ĞµÑ‚Ğ°Ğ»Ñ– Ñ€ĞµĞ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ— - Ğ´Ñ€Ğ°Ğ¹Ğ²ĞµÑ€Ğ¸, ÑÑ…Ğ¾Ğ²Ğ¸Ñ‰Ğ°, Ğ°Ğ´Ğ°Ğ¿Ñ‚ĞµÑ€Ğ¸.

### ĞŸÑ–Ğ´ÑˆĞ°Ñ€Ğ¸

#### 1. Transport (Ğ”Ñ€Ğ°Ğ¹Ğ²ĞµÑ€Ğ¸)

| ĞšĞ»Ğ°Ñ | Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ñ–Ñ | Use Case |
|------|------------|----------|
| `HTTPDriver` | aiohttp | Ğ¡Ñ‚Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ñ– ÑĞ°Ğ¹Ñ‚Ğ¸ (default) |
| `AsyncDriver` | aiohttp + concurrency | Ğ’Ğ¸ÑĞ¾ĞºĞ¾Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ğ¹ ĞºÑ€Ğ°ÑƒĞ»Ñ–Ğ½Ğ³ |
| `PlaywrightDriver` | Playwright | JavaScript ÑĞ°Ğ¹Ñ‚Ğ¸, SPA |
| `StealthDriver` | Playwright + stealth | Anti-bot bypass |

#### 2. Persistence (Ğ¡Ñ…Ğ¾Ğ²Ğ¸Ñ‰Ğ°)

| ĞšĞ»Ğ°Ñ | Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ñ–Ñ | Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ´Ğ»Ñ |
|------|------------|-------------------|
| `MemoryStorage` | In-memory | < 1,000 nodes |
| `JSONStorage` | aiofiles | 1,000 - 10,000 nodes |
| `SQLiteStorage` | aiosqlite | 10,000 - 100,000 nodes |
| `PostgreSQLStorage` | asyncpg | 100,000+ nodes |
| `MongoDBStorage` | motor | 100,000+ nodes |

#### 3. Adapters (HTML ĞŸĞ°Ñ€ÑĞµÑ€Ğ¸)

| ĞšĞ»Ğ°Ñ | Ğ‘Ñ–Ğ±Ğ»Ñ–Ğ¾Ñ‚ĞµĞºĞ° | Ğ¨Ğ²Ğ¸Ğ´ĞºÑ–ÑÑ‚ÑŒ |
|------|------------|----------|
| `BeautifulSoupAdapter` | BeautifulSoup4 | Ğ¡ĞµÑ€ĞµĞ´Ğ½Ñ (default) |
| `lxmlAdapter` | lxml | Ğ’Ğ¸ÑĞ¾ĞºĞ° |
| `ScrapyAdapter` | Scrapy | Ğ’Ğ¸ÑĞ¾ĞºĞ° |

#### 4. Messaging (Distributed)

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ |
|-----------|-------------|
| `celery_app.py` | Celery application config |
| `celery_spider.py` | Distributed Spider |
| `easy_crawler.py` | EasyDistributedCrawler |

### ĞšĞ°Ğ½Ğ°Ğ»Ğ¸ ĞºĞ¾Ğ¼ÑƒĞ½Ñ–ĞºĞ°Ñ†Ñ–Ñ— Ğ· Ñ–Ğ½ÑˆĞ¸Ğ¼Ğ¸ ÑˆĞ°Ñ€Ğ°Ğ¼Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INFRASTRUCTURE LAYER                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  Application Layer                                                 â”‚
â”‚       â”‚                                                            â”‚
â”‚       â”‚ IDriver (Protocol)                                         â”‚
â”‚       â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚ HTTPDriver  â”‚ â—€â”€â”€â”€â”€â”€ implements IDriver                        â”‚
â”‚  â”‚ Playwright  â”‚                                                   â”‚
â”‚  â”‚ Stealth     â”‚                                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚         â”‚                                                          â”‚
â”‚         â”‚ FetchResponse                                            â”‚
â”‚         â–¼                                                          â”‚
â”‚  Application Layer                                                 â”‚
â”‚                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                    â”‚
â”‚  Application Layer                                                 â”‚
â”‚       â”‚                                                            â”‚
â”‚       â”‚ IStorage (Protocol)                                        â”‚
â”‚       â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚MemoryStorageâ”‚ â—€â”€â”€â”€â”€â”€ implements IStorage                       â”‚
â”‚  â”‚ JSONStorage â”‚                                                   â”‚
â”‚  â”‚SQLiteStorageâ”‚                                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚         â”‚                                                          â”‚
â”‚         â”‚ Graph (serialized)                                       â”‚
â”‚         â–¼                                                          â”‚
â”‚  File System / Database                                            â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Extensions Layer

### ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ
Ğ Ğ¾Ğ·ÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ñ— Ñ„ÑƒĞ½ĞºÑ†Ñ–Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ñ– Ñ‡ĞµÑ€ĞµĞ· Ğ¿Ğ»Ğ°Ğ³Ñ–Ğ½Ğ¸ Ñ‚Ğ° middleware.

### 1. Plugins (Node Processing)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PLUGIN TYPES                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  ON_NODE_CREATED â”€â–¶ ON_BEFORE_SCAN â”€â–¶ ON_HTML_PARSED â”€â–¶ ON_AFTER_SCAN
â”‚        â”‚                  â”‚                 â”‚                â”‚     â”‚
â”‚        â–¼                  â–¼                 â–¼                â–¼     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚URL-based â”‚      â”‚ Pre-HTML â”‚      â”‚Extractorsâ”‚      â”‚ Post-    â”‚â”‚
â”‚  â”‚ analysis â”‚      â”‚ setup    â”‚      â”‚          â”‚      â”‚ process  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Ğ’Ğ±ÑƒĞ´Ğ¾Ğ²Ğ°Ğ½Ñ– Ğ¿Ğ»Ğ°Ğ³Ñ–Ğ½Ğ¸

| ĞŸĞ»Ğ°Ğ³Ñ–Ğ½ | Ğ¢Ğ¸Ğ¿ | ĞĞ¿Ğ¸Ñ |
|--------|-----|------|
| `MetadataExtractorPlugin` | ON_HTML_PARSED | title, h1, description, keywords |
| `LinkExtractorPlugin` | ON_HTML_PARSED | Ğ’Ğ¸Ñ‚ÑĞ³ÑƒÑ” <a href> Ğ¿Ğ¾ÑĞ¸Ğ»Ğ°Ğ½Ğ½Ñ |
| `TextExtractorPlugin` | ON_HTML_PARSED | Ğ§Ğ¸ÑÑ‚Ğ¸Ğ¹ Ñ‚ĞµĞºÑÑ‚ ÑÑ‚Ğ¾Ñ€Ñ–Ğ½ĞºĞ¸ |
| `PhoneExtractorPlugin` | ON_HTML_PARSED | Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ½Ñ– Ğ½Ğ¾Ğ¼ĞµÑ€Ğ¸ |
| `EmailExtractorPlugin` | ON_HTML_PARSED | Email Ğ°Ğ´Ñ€ĞµÑĞ¸ |
| `PriceExtractorPlugin` | ON_HTML_PARSED | Ğ¦Ñ–Ğ½Ğ¸ Ñ‚Ğ° Ğ·Ğ°Ñ€Ğ¿Ğ»Ğ°Ñ‚Ğ¸ |
| `RealTimeVectorizerPlugin` | ON_AFTER_SCAN | Ğ’ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ñ–Ñ Ñ‚ĞµĞºÑÑ‚Ñƒ |

### 2. Middleware (Request/Response)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MIDDLEWARE CHAIN                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  Request â”€â–¶ RateLimit â”€â–¶ Proxy â”€â–¶ UserAgent â”€â–¶ Driver â”€â–¶ Response â”‚
â”‚                                                       â”‚            â”‚
â”‚            â—€â”€â”€ Retry â—€â”€â”€ ErrorRecovery â—€â”€â”€ Cache â—€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Ğ’Ğ±ÑƒĞ´Ğ¾Ğ²Ğ°Ğ½Ñ– middleware

| Middleware | Ğ¢Ğ¸Ğ¿ | ĞĞ¿Ğ¸Ñ |
|------------|-----|------|
| `RateLimitMiddleware` | PRE_REQUEST | ĞĞ±Ğ¼ĞµĞ¶ĞµĞ½Ğ½Ñ Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚Ğ¸ Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñ–Ğ² |
| `ProxyMiddleware` | PRE_REQUEST | Proxy rotation |
| `UserAgentMiddleware` | PRE_REQUEST | User-Agent rotation |
| `RetryMiddleware` | POST_REQUEST | Retry Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ°Ñ… |
| `CacheMiddleware` | PRE_REQUEST | HTTP ĞºĞµÑˆÑƒĞ²Ğ°Ğ½Ğ½Ñ |
| `RobotsMiddleware` | PRE_REQUEST | robots.txt compliance |
| `ErrorRecoveryMiddleware` | POST_REQUEST | Ğ’Ñ–Ğ´Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ Ğ¿Ñ–ÑĞ»Ñ Ğ¿Ğ¾Ğ¼Ğ¸Ğ»Ğ¾Ğº |

### Ğ’Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚Ğ¸ Ñ€Ğ¾Ğ·ÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ

```python
# ĞšĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ğ¸Ğ¹ Ğ¿Ğ»Ğ°Ğ³Ñ–Ğ½
class MyPlugin(BaseNodePlugin):
    @property
    def name(self):
        return "my_plugin"
    
    @property
    def plugin_type(self):
        return NodePluginType.ON_HTML_PARSED
    
    def execute(self, context):
        context.user_data['custom'] = "value"
        return context

# ĞšĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ğ¸Ğ¹ middleware
class MyMiddleware(BaseMiddleware):
    @property
    def name(self):
        return "my_middleware"
    
    @property
    def middleware_type(self):
        return MiddlewareType.PRE_REQUEST
    
    def process(self, context):
        context.headers['X-Custom'] = 'value'
        return context
```

---

## ğŸ“Š Ğ—Ğ°Ğ»ĞµĞ¶Ğ½Ğ¾ÑÑ‚Ñ– Ğ¼Ñ–Ğ¶ ÑˆĞ°Ñ€Ğ°Ğ¼Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DEPENDENCY FLOW                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚                     API Layer                                      â”‚
â”‚                        â”‚                                           â”‚
â”‚                        â”‚ uses                                      â”‚
â”‚                        â–¼                                           â”‚
â”‚  Extensions Layer â—€â”€â”€ Application Layer â”€â”€â–¶ Infrastructure Layer  â”‚
â”‚  (Plugins,Middleware)  â”‚                    (Drivers, Storage)     â”‚
â”‚                        â”‚ uses                                      â”‚
â”‚                        â–¼                                           â”‚
â”‚                    Domain Layer                                    â”‚
â”‚                  (Entities, Events)                                â”‚
â”‚                                                                    â”‚
â”‚  ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ: Ğ—Ğ°Ğ»ĞµĞ¶Ğ½Ğ¾ÑÑ‚Ñ– Ğ¹Ğ´ÑƒÑ‚ÑŒ Ğ’ĞĞ˜Ğ—. Domain Layer Ğ½Ğµ Ğ·Ğ°Ğ»ĞµĞ¶Ğ¸Ñ‚ÑŒ Ğ²Ñ–Ğ´     â”‚
â”‚           Ğ¶Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ–Ğ½ÑˆĞ¾Ğ³Ğ¾ ÑˆĞ°Ñ€Ñƒ.                                     â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
