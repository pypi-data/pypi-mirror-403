# generated by datamodel-codegen:
#   filename:  configuration/authenticationConfiguration.json
#   timestamp: 2026-01-30T06:35:57+00:00

from __future__ import annotations

from enum import Enum
from typing import List, Optional

from pydantic import ConfigDict, Field, RootModel
from typing_extensions import Annotated

from metadata.ingestion.models.custom_pydantic import BaseModel

from ..entity.services.connections.metadata import openMetadataConnection
from ..security.client import oidcClientConfig, samlSSOClientConfig
from . import ldapConfiguration


class ClientType(Enum):
    public = 'public'
    confidential = 'confidential'


class TokenValidationAlgorithm(Enum):
    RS256 = 'RS256'
    RS384 = 'RS384'
    RS512 = 'RS512'


class JwtPrincipalClaimsMappingItem(RootModel[str]):
    root: Annotated[str, Field(pattern='^(username|email):[a-zA-Z0-9_-]+$')]


class ResponseType(Enum):
    id_token = 'id_token'
    code = 'code'


class AuthenticationConfiguration(BaseModel):
    model_config = ConfigDict(
        extra='forbid',
    )
    clientType: Annotated[
        Optional[ClientType],
        Field(ClientType.public, description='Client Type', title='Client Type'),
    ]
    provider: Annotated[openMetadataConnection.AuthProvider, Field(title='Provider')]
    responseType: Annotated[
        Optional[ResponseType],
        Field(
            ResponseType.id_token,
            description='This is used by auth provider provide response as either id_token or code.',
            title='Response Type',
        ),
    ]
    providerName: Annotated[
        str,
        Field(
            description='Custom OIDC Authentication Provider Name',
            title='Provider Name',
        ),
    ]
    publicKeyUrls: Annotated[
        List[str], Field(description='List of Public Key URLs', title='Public Key URLs')
    ]
    tokenValidationAlgorithm: Annotated[
        Optional[TokenValidationAlgorithm],
        Field(
            TokenValidationAlgorithm.RS256,
            description='Token Validation Algorithm to use.',
            title='Token Validation Algorithm',
        ),
    ]
    authority: Annotated[
        str, Field(description='Authentication Authority', title='Authority')
    ]
    clientId: Annotated[str, Field(description='Client ID', title='Client ID')]
    callbackUrl: Annotated[str, Field(description='Callback URL', title='Callback URL')]
    jwtPrincipalClaims: Annotated[
        List[str],
        Field(description='Jwt Principal Claim', title='Jwt Principal Claims'),
    ]
    jwtPrincipalClaimsMapping: Annotated[
        Optional[List[JwtPrincipalClaimsMappingItem]],
        Field(
            None,
            description="Jwt Principal Claim Mapping. Format: 'key:claim_name' where key must be 'username' or 'email'. Both username and email mappings are required.",
            title='Jwt Principal Claims Mapping',
        ),
    ]
    jwtTeamClaimMapping: Annotated[
        Optional[str],
        Field(
            None,
            description="JWT claim name that contains team/department information. For SAML SSO, this is the attribute name (e.g., 'department') from the SAML assertion. For JWT, this is the claim name in the JWT token. The value from this claim will be used to automatically assign users to matching teams in OpenMetadata during login.",
            title='Jwt Team Claim Mapping',
        ),
    ]
    enableSelfSignup: Annotated[
        Optional[bool],
        Field(False, description='Enable Self Sign Up', title='Enable Self Sign Up'),
    ]
    ldapConfiguration: Annotated[
        Optional[ldapConfiguration.LdapConfiguration],
        Field(
            None,
            description='LDAP Configuration in case the Provider is LDAP',
            title='LDAP Configuration',
        ),
    ]
    samlConfiguration: Annotated[
        Optional[samlSSOClientConfig.SamlSSOClientConfig],
        Field(
            None,
            description='Saml Configuration that is applicable only when the provider is Saml',
            title='Saml Configuration',
        ),
    ]
    oidcConfiguration: Annotated[
        Optional[oidcClientConfig.OidcClientConfig],
        Field(
            None,
            description='Oidc Configuration for Confidential Client Type',
            title='Oidc Configuration',
        ),
    ]
    forceSecureSessionCookie: Annotated[
        Optional[bool],
        Field(
            False,
            description='Force secure flag on session cookies even when not using HTTPS directly. Enable this when running behind a proxy/load balancer that handles SSL termination.',
        ),
    ]
    enableAutoRedirect: Annotated[
        Optional[bool],
        Field(
            False,
            description='Enable automatic redirect from the sign-in page to the configured SSO provider.',
            title='Enable Auto Redirect',
        ),
    ]
