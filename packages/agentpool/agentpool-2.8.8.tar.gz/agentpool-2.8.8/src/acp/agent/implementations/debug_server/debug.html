<!doctype html>
<html>
    <head>
        <title>ACP Debug Server</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 20px;
            }
            .container {
                max-width: 1200px;
                margin: 0 auto;
            }
            .section {
                margin: 20px 0;
                padding: 15px;
                border: 1px solid #ddd;
                border-radius: 5px;
            }
            .form-group {
                margin: 10px 0;
            }
            label {
                display: block;
                margin-bottom: 5px;
            }
            input,
            select,
            textarea {
                width: 100%;
                padding: 5px;
            }
            button {
                padding: 10px 20px;
                margin: 5px;
                cursor: pointer;
            }
            .status {
                background: #f0f8ff;
            }
            .notifications {
                background: #f8f8f0;
            }
            .response {
                background: #f0f0f0;
                margin-top: 10px;
                padding: 10px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>üêõ ACP Debug Server</h1>

            <div class="section status">
                <h2>Status</h2>
                <div id="status">Loading...</div>
                <button onclick="refreshStatus()">Refresh Status</button>
            </div>

            <div class="section notifications">
                <h2>Send Notifications</h2>
                <div class="form-group">
                    <label>Session ID:</label>
                    <input type="text" id="sessionId" placeholder="Enter session ID" />
                </div>

                <div class="form-group">
                    <label>Notification Type:</label>
                    <select id="notificationType" onchange="updateForm()">
                        <option value="agent_message">Agent Message</option>
                        <option value="user_message">User Message</option>
                        <option value="agent_thought">Agent Thought</option>
                        <option value="tool_call_start">Tool Call Start</option>
                        <option value="tool_call_progress">Tool Call Progress</option>
                        <option value="plan_update">Plan Update</option>
                        <option value="commands_update">Commands Update</option>
                        <option value="mode_update">Mode Update</option>
                    </select>
                </div>

                <div id="dynamicForm"></div>

                <button onclick="sendNotification()">Send Notification</button>
                <div id="response" class="response" style="display: none"></div>
            </div>
        </div>

        <script>
            async function refreshStatus() {
                try {
                    const response = await fetch("/status");
                    const status = await response.json();
                    document.getElementById("status").innerHTML = `
                    <strong>Sessions:</strong> ${status.active_sessions.join(", ") || "None"}<br>
                    <strong>Current Session:</strong> ${status.current_session || "None"}<br>
                    <strong>Notifications Sent:</strong> ${status.notifications_sent}<br>
                    <strong>ACP Connected:</strong> ${status.acp_connected ? "Yes" : "No"}
                `;

                    // Auto-fill session ID if available
                    if (
                        status.current_session &&
                        !document.getElementById("sessionId").value
                    ) {
                        document.getElementById("sessionId").value =
                            status.current_session;
                    }
                } catch (e) {
                    document.getElementById("status").innerHTML = "Error loading status";
                }
            }

            function updateForm() {
                const type = document.getElementById("notificationType").value;
                const form = document.getElementById("dynamicForm");

                switch (type) {
                    case "agent_message":
                    case "user_message":
                    case "agent_thought":
                        form.innerHTML = `
                        <div class="form-group">
                            <label>Text Content:</label>
                            <textarea id="text" rows="3" placeholder="Enter message text"></textarea>
                        </div>
                    `;
                        break;
                    case "tool_call_start":
                        form.innerHTML = `
                        <div class="form-group">
                            <label>Tool Call ID:</label>
                            <input type="text" id="toolCallId" placeholder="tool-call-123">
                        </div>
                        <div class="form-group">
                            <label>Title:</label>
                            <input type="text" id="title" placeholder="Tool call title">
                        </div>
                        <div class="form-group">
                            <label>Kind:</label>
                            <select id="kind">
                                <option value="other">Other</option>
                                <option value="read">Read</option>
                                <option value="edit">Edit</option>
                                <option value="execute">Execute</option>
                            </select>
                        </div>
                    `;
                        break;
                    case "tool_call_progress":
                        form.innerHTML = `
                        <div class="form-group">
                            <label>Tool Call ID:</label>
                            <input type="text" id="toolCallId" placeholder="tool-call-123">
                        </div>
                        <div class="form-group">
                            <label>Status:</label>
                            <select id="status">
                                <option value="in_progress">In Progress</option>
                                <option value="completed">Completed</option>
                                <option value="failed">Failed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Output:</label>
                            <textarea id="output" rows="3" placeholder="Tool output"></textarea>
                        </div>
                    `;
                        break;
                    default:
                        form.innerHTML = "";
                }
            }

            async function sendNotification() {
                const sessionId = document.getElementById("sessionId").value;
                const type = document.getElementById("notificationType").value;

                if (!sessionId) {
                    alert("Please enter a session ID");
                    return;
                }

                let data = {};

                // Collect form data based on type
                switch (type) {
                    case "agent_message":
                    case "user_message":
                    case "agent_thought":
                        data.text = document.getElementById("text").value;
                        break;
                    case "tool_call_start":
                        data.tool_call_id = document.getElementById("toolCallId").value;
                        data.title = document.getElementById("title").value;
                        data.kind = document.getElementById("kind").value;
                        break;
                    case "tool_call_progress":
                        data.tool_call_id = document.getElementById("toolCallId").value;
                        data.status = document.getElementById("status").value;
                        data.output = document.getElementById("output").value;
                        break;
                }

                try {
                    const response = await fetch("/send-notification", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            session_id: sessionId,
                            notification_type: type,
                            data: data,
                        }),
                    });

                    const result = await response.text();
                    document.getElementById("response").style.display = "block";
                    document.getElementById("response").innerHTML = response.ok
                        ? "‚úÖ Notification sent successfully!"
                        : "‚ùå Error: " + result;
                } catch (e) {
                    document.getElementById("response").style.display = "block";
                    document.getElementById("response").innerHTML =
                        "‚ùå Error: " + e.message;
                }
            }

            // Initialize
            updateForm();
            refreshStatus();
            setInterval(refreshStatus, 5000); // Auto-refresh every 5 seconds
        </script>
    </body>
</html>
