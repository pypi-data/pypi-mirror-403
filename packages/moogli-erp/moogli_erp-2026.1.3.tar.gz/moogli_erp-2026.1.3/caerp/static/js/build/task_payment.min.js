(()=>{"use strict";var e,t,n,r={8789:(e,t,n)=>{var r=n(750),a=n(5458),o=n(641),i=n(953),u=n(296),l=n(467),c=n(4756),s=n.n(c),d=n(33),f=n(810),v=n(294),m=(0,n(3454).A)("payment"),p=(0,f.nY)("payment",function(){var e=(0,i.KR)(null),t=(0,i.KR)(null),n=(0,i.KR)(null),r=(0,i.KR)(null);function a(){return(a=(0,l.A)(s().mark(function a(o){var i,u;return s().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(i=o.paymentId,u=o.invoiceId,t.value=i,r.value=u,v.A.taskPayments.setInvoiceId(r.value),!i){a.next=2;break}return a.next=1,v.A.taskPayments.load(i);case 1:e.value=a.sent;case 2:return a.next=3,v.A.invoices.load(r.value);case 3:n.value=a.sent;case 4:case"end":return a.stop()}},a)}))).apply(this,arguments)}function o(){return(o=(0,l.A)(s().mark(function e(n){return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Saving payment ... ",t.value),console.log(n),null==t.value){e.next=2;break}return console.log("Updating payment ... ",t.value),e.next=1,v.A.taskPayments.update(n,t.value);case 1:e.next=3;break;case 2:return console.log("Creating payment ... "),console.log(v.A.payments),e.next=3,v.A.taskPayments.create(n);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function u(){return(u=(0,l.A)(s().mark(function e(n){return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Checking remittanceId ... ",n),e.next=1,v.A.taskPayments.checkRemittanceId(n,t.value);case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}return{currentPayment:e,currentPaymentId:t,currentInvoice:n,currentInvoiceId:r,setInitialValues:function(e){return a.apply(this,arguments)},savePayment:function(e){return o.apply(this,arguments)},checkRemittanceId:function(e){return u.apply(this,arguments)}}}),b=n(7437),y=n(1268),k=n(2323),_=n(920),g=n(7431),h=n(8483),w=n(4611),R={class:"deformFormFieldset"},A={class:"row form-row"},C={class:"row form-row"},x={key:0,class:"row form-row"},O={class:"col-md-12 text-center"},E={key:1,class:"row form-row"},P={key:2,class:"row form-row"},I={key:3,class:"row form-row"},S={class:"row form-row"},W={ref:"remittance-confirm-message",class:"alert alert-warning"},j=["disabled"],F=["disabled"];const X={__name:"PaymentForm",props:{invoice:{type:Object,required:!0},item:{type:[Object,null,void 0],required:!1},layout:{type:Object}},emits:["saved","cancel","error"],setup:function(e,t){var n=t.emit,a=e,u=n,c=m(),f=p(),v=(0,o.EW)(function(){var e=c.getSchema("default");return console.log("Json Schema"),console.log(e),(0,_.cp)(e)}),b=(0,o.EW)(function(){var e=(0,_.rV)(v.value);return Object.assign(e,a.item),console.log("InitialValues"),console.log(e),e}),X=(0,i.KR)(!1),L=(0,i.KR)(!1),Q=(0,o.EW)(function(){return c.getOptions("payment_modes")}),K=(0,o.EW)(function(){return c.getOptions("bank_accounts")}),M=(0,o.EW)(function(){return c.getOptions("customer_bank_accounts")}),N=(0,o.EW)(function(){return c.getOptions("max_amount")}),V=(0,y.mN)({validationSchema:v,initialValues:b}),q=V.values,T=V.handleSubmit,U=V.isSubmitting,D=(0,_.FP)(u,f.savePayment),Y=function(){var e=(0,l.A)(s().mark(function e(t,n){var a,o;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.bank_remittance_id&&t.bank_remittance_id.trim().length>0)||t.new_remittance_confirm){e.next=6;break}return e.prev=1,e.next=2,f.checkRemittanceId(t);case 2:a=e.sent,e.next=4;break;case 3:e.prev=3,o=e.catch(1),a=o;case 4:if(console.log(a),!(a.errors&&a.errors.length>0)){e.next=5;break}return n.setErrors(a.errors),e.abrupt("return");case 5:if("confirmation"!=a.status){e.next=6;break}if("bank_remittance_id"!=a.data.field){e.next=6;break}return L.value=!0,(0,r.cs)(),e.abrupt("return");case 6:return e.abrupt("return",D(t,n));case 7:case"end":return e.stop()}},e,null,[[1,3]])}));return function(t,n){return e.apply(this,arguments)}}(),$=T(Y,(0,_.WS)(u)),z=function(){return u("cancel")},B=(0,o.EW)(function(){return function(e){return(0,_.Nw)(v.value,e)}}),J=function(e){var t=(0,r.F)(e);Math.abs(t)>Math.abs(N.value)?X.value=!0:X.value=!1},G=a.layout;return function(t,n){return(0,o.uX)(),(0,o.Wv)((0,i.R1)(G),{onSubmitForm:(0,i.R1)($),onClose:z},{title:(0,o.k6)(function(){return[e.item.id?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.eW)(" Modifier un encaissement ")],64)):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.eW)(" Ajouter un encaissement ")],64))]}),fields:(0,o.k6)(function(){return[(0,o.Lk)("div",null,[(0,o.Lk)("fieldset",R,[(0,o.Lk)("div",A,[(0,o.bF)(g.A,(0,o.v6)(B.value("date"),{class:"col-md-6",autofocus:!0}),null,16)]),(0,o.Lk)("div",C,[v.value.fields.mode?((0,o.uX)(),(0,o.Wv)(h.A,(0,o.v6)({key:0,class:"col-md-6"},B.value("mode"),{"add-default":!1,options:Q.value}),null,16,["options"])):(0,o.Q3)("v-if",!0),(0,o.bF)(g.A,(0,o.v6)(B.value("amount"),{class:"col-md-6",onChangeValue:J}),null,16)]),X.value?((0,o.uX)(),(0,o.CE)("div",x,[(0,o.Lk)("div",O,[n[0]||(n[0]=(0,o.Lk)("div",{class:"alert alert-warning"}," Le montant est supérieur au montant attendu pour le règlement de cette facture. Cochez la case ci-dessous pour confirmer la saisie. ",-1)),(0,o.bF)(w.A,(0,o.v6)(B.value("confirm_amount"),{class:"col-md-6"}),null,16)])])):(0,o.Q3)("v-if",!0),v.value.fields.bank_remittance_id||v.value.fields.bank_id?((0,o.uX)(),(0,o.CE)("div",E,[v.value.fields.bank_remittance_id?((0,o.uX)(),(0,o.Wv)(g.A,(0,o.v6)({key:0,class:"col-md-6"},B.value("bank_remittance_id")),null,16)):(0,o.Q3)("v-if",!0),v.value.fields.bank_id?((0,o.uX)(),(0,o.Wv)(h.A,(0,o.v6)({key:1,class:"col-md-6"},B.value("bank_id"),{"add-default":!1,options:K.value}),null,16,["options"])):(0,o.Q3)("v-if",!0)])):(0,o.Q3)("v-if",!0),v.value.fields.check_number?((0,o.uX)(),(0,o.CE)("div",P,[(0,o.bF)(g.A,(0,o.v6)(B.value("check_number"),{class:"col-md-6"}),null,16)])):(0,o.Q3)("v-if",!0),v.value.fields.customer_bank_id||v.value.fields.issuer?((0,o.uX)(),(0,o.CE)("div",I,[v.value.fields.customer_bank_id?((0,o.uX)(),(0,o.Wv)(h.A,(0,o.v6)({key:0,class:"col-md-6"},B.value("customer_bank_id"),{"add-default":!1,options:M.value}),null,16,["options"])):(0,o.Q3)("v-if",!0),v.value.fields.issuer?((0,o.uX)(),(0,o.Wv)(g.A,(0,o.v6)({key:1},B.value("issuer"),{class:"col-md-6"}),null,16)):(0,o.Q3)("v-if",!0)])):(0,o.Q3)("v-if",!0),(0,o.Lk)("div",S,[(0,o.bF)(w.A,(0,o.v6)(B.value("resulted"),{class:"col-md-6"}),null,16)])])])]}),buttons:(0,o.k6)(function(){return[L.value?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.Lk)("div",W,[n[1]||(n[1]=(0,o.eW)(" Vous vous apprêtez à créer une nouvelle remise en banque ",-1)),(0,o.Lk)("strong",null,(0,d.v_)((0,i.R1)(q).bank_remittance_id),1),n[2]||(n[2]=(0,o.eW)(". ",-1))],512),(0,o.bF)(g.A,(0,o.v6)(B.value("new_remittance_confirm"),{type:"hidden",value:"true",class:"col-md-6"}),null,16),(0,o.Lk)("button",{id:"deformsubmit",name:"submit",type:"submit",class:"btn btn-primary",value:"submit",disabled:(0,i.R1)(U)}," Confirmer ",8,j)],64)):((0,o.uX)(),(0,o.CE)("button",{key:1,id:"deformsubmit",name:"submit",type:"submit",class:"btn btn-primary",value:"submit",disabled:(0,i.R1)(U)}," Enregistrer ",8,F)),(0,o.Lk)("button",{id:"deformcancel",name:"cancel",type:"button",class:"btn btn-default",onClick:z}," Annuler "),(0,i.R1)(!1)?((0,o.uX)(),(0,o.Wv)(k.A,{key:2,debug:(0,i.R1)(q)},null,8,["debug"])):(0,o.Q3)("v-if",!0)]}),_:1},8,["onSubmitForm"])}}};var L=n(3683),Q=n(5979),K={key:0},M={key:1},N={key:0,class:"alert alert-info"},V={key:1,class:"alert alert-info"},q={key:2,class:"alert alert-warning"};const T={__name:"PaymentFormComponent",props:{invoiceId:{type:[String,Number],required:!0},url:{type:String,required:!0},formConfigUrl:{type:String,required:!0},itemId:{type:[String,Number,null,void 0],default:null},layout:{type:Object,default:b.A}},emits:["saved","cancel"],setup:function(e,t){return(0,l.A)(s().mark(function n(){var r,a,c,v,b,y,k,_,g,h,w,R,A,C,x,O,E;return s().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return E=function(){console.log("Cancel Payment add/edit"),k("cancel")},O=function(e){console.log("Payment saved"),k("saved",e)},R=function(){return(R=(0,l.A)(s().mark(function e(){var t;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[g.loadConfig(),h.setInitialValues({paymentId:y.itemId,invoiceId:y.invoiceId})],Promise.all(t).then(function(){return _.value=!1});case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)},w=function(){return R.apply(this,arguments)},c=t.emit,y=e,k=c,_=(0,i.KR)(!0),(g=m()).setUrl(y.formConfigUrl),y.itemId,h=p(),A=(0,f.bP)(h),C=A.currentPayment,x=A.currentInvoice,r=(0,o.E)(function(){return w()}),a=(0,u.A)(r,2),v=a[0],b=a[1],n.next=1,v;case 1:return b(),n.abrupt("return",function(t,n){return _.value?((0,o.uX)(),(0,o.CE)("div",K,"Chargement des informations")):((0,o.uX)(),(0,o.CE)("div",M,[(0,i.R1)(C)?((0,o.uX)(),(0,o.CE)("div",N," Modification de l'encaissement de "+(0,d.v_)((0,i.R1)(C).amount)+" € saisi le "+(0,d.v_)((0,i.R1)(L.Rt)((0,i.R1)(C).created_at)),1)):(0,o.Q3)("v-if",!0),(0,i.R1)(C)?(0,o.Q3)("v-if",!0):((0,o.uX)(),(0,o.CE)("div",V,[(0,o.eW)(" Enregistrer un paiement pour la facture "+(0,d.v_)((0,i.R1)(x).official_number)+" ",1),"resulted"!=(0,i.R1)(x).paid_status?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.eW)("dont le montant ttc restant à payer est de "+(0,d.v_)((0,i.R1)(x).topay_amount)+" €",1)],64)):(0,o.Q3)("v-if",!0)])),0===(0,i.R1)(x).topay_amount?((0,o.uX)(),(0,o.CE)("div",q,[(0,o.bF)(Q.A,{name:"warning"}),(0,o.eW)(" La facture "+(0,d.v_)((0,i.R1)(x).official_number)+" est déjà soldée ",1)])):(0,o.Q3)("v-if",!0),(0,o.bF)(X,{item:(0,i.R1)(C),invoice:(0,i.R1)(x),onSaved:O,onCancel:E,layout:e.layout},null,8,["item","invoice","layout"])]))});case 2:case"end":return n.stop()}},n)}))()}};var U=n(136),D={class:"limited_width width60"};const Y={__name:"App",setup:function(e){var t=(0,U.Dn)(),n=function(e){console.log("Redirectonsave"),opener?opener.dismissPopup(window,{force_reload:!0}):t.redirect_url?window.location.href=t.redirect_url:window.location.href=t.context_url.replace("/api/v1/","/")},r=function(){console.log("Redirectoncancel"),opener?opener.dismissPopup(window,{force_reload:!0}):t.cancel_url?window.location.href=t.cancel_url:window.location.href=t.context_url.replace("/api/v1/","/")};return function(e,u){return(0,o.uX)(),(0,o.Wv)(o.tY,null,{fallback:(0,o.k6)(function(){return(0,a.A)(u[0]||(u[0]=[(0,o.eW)(" Chargement... ",-1)]))}),default:(0,o.k6)(function(){return[(0,o.Lk)("div",D,[(0,o.bF)(T,{"item-id":(0,i.R1)(t).payment_id,"invoice-id":(0,i.R1)(t).invoice_id,url:(0,i.R1)(t).context_url,"form-config-url":(0,i.R1)(t).form_config_url,onSaved:n,onCancel:r},null,8,["item-id","invoice-id","url","form-config-url"])])]}),_:1})}}};(0,r.Yk)(Y)}},a={};function o(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={id:e,loaded:!1,exports:{}};return r[e].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}o.m=r,e=[],o.O=(t,n,r,a)=>{if(!n){var i=1/0;for(s=0;s<e.length;s++){for(var[n,r,a]=e[s],u=!0,l=0;l<n.length;l++)(!1&a||i>=a)&&Object.keys(o.O).every(e=>o.O[e](n[l]))?n.splice(l--,1):(u=!1,a<i&&(i=a));if(u){e.splice(s--,1);var c=r();void 0!==c&&(t=c)}}return t}a=a||0;for(var s=e.length;s>0&&e[s-1][2]>a;s--)e[s]=e[s-1];e[s]=[n,r,a]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var a=Object.create(null);o.r(a);var i={};t=t||[null,n({}),n([]),n(n)];for(var u=2&r&&e;"object"==typeof u&&!~t.indexOf(u);u=n(u))Object.getOwnPropertyNames(u).forEach(t=>i[t]=()=>e[t]);return i.default=()=>e,o.d(a,i),a},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.e=()=>Promise.resolve(),o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.j=455,(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{var e={455:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var r,a,[i,u,l]=n,c=0;if(i.some(t=>0!==e[t])){for(r in u)o.o(u,r)&&(o.m[r]=u[r]);if(l)var s=l(o)}for(t&&t(n);c<i.length;c++)a=i[c],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(s)},n=self.webpackChunkenDI=self.webpackChunkenDI||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),o.nc=void 0;var i=o.O(void 0,[534],()=>o(8789));i=o.O(i)})();