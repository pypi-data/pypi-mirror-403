Metadata-Version: 2.2
Name: moogli_erp
Version: 2026.1.3
Summary: Progiciel de gestion pour CAE
Home-page: https://framagit.org/caerp/caerp
Author: Majerti/Kilya
Author-email: contact@moogli.coop
Keywords: pyramid,business,web
Classifier: License :: OSI Approved :: GNU General Public License v3 (GPLv3)
Classifier: Programming Language :: Python
Classifier: Framework :: Pyramid
Classifier: Topic :: Internet :: WWW/HTTP
Classifier: Topic :: Internet :: WWW/HTTP :: WSGI :: Application
Requires-Python: >=3.7
Description-Content-Type: text/x-rst
License-File: LICENSE.txt
Requires-Dist: alembic==1.13.1
Requires-Dist: Beaker==1.13.0
Requires-Dist: Chameleon==3.9.0
Requires-Dist: colander==2.0
Requires-Dist: ColanderAlchemy
Requires-Dist: Cython
Requires-Dist: deform==2.0.14
Requires-Dist: deform_extensions==0.9
Requires-Dist: docopt==0.5.0
Requires-Dist: caerp_payment==2024.0.11
Requires-Dist: caerp_sign_pdf==2024.2.2
Requires-Dist: factur-x==2.3
Requires-Dist: fanstatic==1.1
Requires-Dist: filedepot==0.10.0
Requires-Dist: httpagentparser==1.9.5
Requires-Dist: nh3==0.2.14
Requires-Dist: html5lib==1.1
Requires-Dist: setuptools==75.8.2
Requires-Dist: ipython
Requires-Dist: js.bootstrap==3.3.1
Requires-Dist: js.chosen==0.9.14
Requires-Dist: js.deform==2.0.14
Requires-Dist: js.jquery==1.9.1
Requires-Dist: js.jquery-form==3.09
Requires-Dist: js.jquery-maskedinput==1.3.1
Requires-Dist: js.jquery-maskmoney==3.0.2
Requires-Dist: js.jquery_sortable==0.9.12
Requires-Dist: js.jquery-timepicker-addon==1.3-1
Requires-Dist: js.jqueryui==1.10.3
Requires-Dist: js.tinymce==4.1.5
Requires-Dist: Mako==1.3.0
Requires-Dist: mysqlclient==2.2.7
Requires-Dist: openpyxl==3.1.2
Requires-Dist: PasteDeploy==3.1.0
Requires-Dist: peppercorn==0.6
Requires-Dist: pillow==11.3.0
Requires-Dist: pi-heif==1.1.1
Requires-Dist: plaster-pastedeploy==1.0.1
Requires-Dist: paginate==0.5.6
Requires-Dist: paginate-sqlalchemy==0.3.1
Requires-Dist: py3o.template==0.10.0
Requires-Dist: pyjwkest==1.3.6
Requires-Dist: pyparsing==3.0.9
Requires-Dist: pyramid==2.0.2
Requires-Dist: pyramid-beaker==0.8
Requires-Dist: pyramid-chameleon==0.3
Requires-Dist: pyramid-deform==0.2
Requires-Dist: pyramid_exclog==1.0
Requires-Dist: pyramid_ipython
Requires-Dist: pyramid-layout==1.0
Requires-Dist: pyramid-mailer==0.15.1
Requires-Dist: pyramid-mako==1.1.0
Requires-Dist: pyramid-methodrewrite==0.2.3
Requires-Dist: pyramid_services==2.2
Requires-Dist: pyramid-tm==2.5
Requires-Dist: pyramid_retry==2.1.1
Requires-Dist: pyramid_session_redis
Requires-Dist: requests==2.32.3
Requires-Dist: pydyf==0.11.0
Requires-Dist: reportlab==4.0.8
Requires-Dist: repoze.lru==0.6
Requires-Dist: requests==2.32.3
Requires-Dist: simplejson==3.3.1
Requires-Dist: sqla_inspect==0.9.1
Requires-Dist: SQLAlchemy==1.4.50
Requires-Dist: transaction==4.0
Requires-Dist: translationstring==1.2
Requires-Dist: typing_extensions
Requires-Dist: Unidecode==0.04.17
Requires-Dist: venusian==3.1.0
Requires-Dist: waitress==2.1.2
Requires-Dist: WebHelpers2==2.1
Requires-Dist: WebOb==1.8.9
Requires-Dist: zope.component==7.0
Requires-Dist: zope.deprecation==5.0
Requires-Dist: zope.event==6.0
Requires-Dist: zope.interface==8.0.1
Requires-Dist: zope.sqlalchemy==4.0
Requires-Dist: odfpy==1.4.1
Requires-Dist: pyexcel-io==0.6.6
Requires-Dist: WeasyPrint==66.0
Requires-Dist: pyvat==1.3.17
Requires-Dist: schwifty==2025.1.0
Requires-Dist: python-stdnum==2.1
Requires-Dist: pyramid-celery==4.0.0
Requires-Dist: redis
Requires-Dist: sylk_parser==0.5
Requires-Dist: celery==5.4.0
Provides-Extra: dev
Requires-Dist: ipdb==0.13.4; extra == "dev"
Requires-Dist: libsass==0.20.1; extra == "dev"
Requires-Dist: pyramid_debugtoolbar; extra == "dev"
Requires-Dist: black==22.3.0; extra == "dev"
Requires-Dist: flake8; extra == "dev"
Requires-Dist: boussole==2.0; extra == "dev"
Requires-Dist: pytest<7.0,>=6.0.2; extra == "dev"
Requires-Dist: freezegun<1.1,>=1.0.0; extra == "dev"
Requires-Dist: Faker<5.0,>=4.1.3; extra == "dev"
Requires-Dist: WebTest<2.1,>=2.0.35; extra == "dev"
Requires-Dist: pre-commit; extra == "dev"
Dynamic: author
Dynamic: author-email
Dynamic: classifier
Dynamic: description
Dynamic: description-content-type
Dynamic: home-page
Dynamic: keywords
Dynamic: provides-extra
Dynamic: requires-dist
Dynamic: requires-python
Dynamic: summary

==========
CAERP
==========

Un progiciel de gestion pour les CAE (Coop√©rative d'activit√© et d'emploi),
les collectifs d'entrepreneurs ind√©pendants.

Licence
-------

Ceci est un logiciel libre, pour les conditions d'acc√®s, d'utilisation,
de copie et d'exploitation, voir LICENSE.txt

Nouvelles fonctionnalit√©s/Anomalies
-----------------------------------

Site officiel : http://endi.coop

L'essentiel du d√©veloppement est r√©alis√© sur financement de Coop√©rer pour
entreprendre. Si vous souhaitez plus d'information, une offre d'h√©bergement,
vous pouvez les contacter info@cooperer.coop

Si vous rencontrez un bogue, ou avez une id√©e de fonctionnalit√©, il est possible
de signaler cela aux d√©veloppeurs directement ou en utilisant le syst√®me de
tickets de GitLab (framagit).
Exception : pour les bogues de s√©curit√©, merci d'√©crire un courriel √† votre administrateur.

Instructions pour l'installation du logiciel (en environnement de prod)
-----------------------------------------------------------------------

Installation des paquets (n√©cessaire pour l'installation dans un environnement virtuel):

Sous Debian/Ubuntu:


NB : Il est possible soit d'utiliser le d√©p√¥t nodesource pour avoir une version adapt√©e de nodejs. Soit de faire les
builds JS avec docker-compose pour compiler le javascript
(voir : https://caerp.readthedocs.io/fr/latest/javascript/build_docker.html)

.. code-block:: console

    apt install virtualenvwrapper libmariadb-dev libmariadb-dev-compat npm build-essential libjpeg-dev libfreetype6 libfreetype6-dev libssl-dev libxml2-dev zlib1g-dev python3-mysqldb redis-server libxslt1-dev python3-pip fonts-open-sans libcairo2 libglib2.0-dev libpango1.0-0 libgdk-pixbuf-2.0-0

Il faudra, en plus, si vous n'utilisez ***pas*** docker-compose installer npm de la mani√®re suivante :

.. code-block:: console

    curl -fsSL https://deb.nodesource.com/setup_22.x | bash - &&\

    apt install npm

Sous Fedora:

.. code-block:: console

    dnf install virtualenvwrapper mardiadb-devel python-devel libxslt-devel libxml2-devel libtiff-devel libjpeg-devel libzip-devel freetype-devel lcms2-devel libwebp-devel tcl-devel tk-devel gcc redis-server open-sans-fonts

T√©l√©chargement de l'application

.. code-block:: console

    git clone https://framagit.org/caerp/caerp.git
    cd caerp

T√©l√©chargement des d√©pendances JS (requiert nodejs >= 16.x)

.. code-block:: console

    npm --prefix js_sources install
    npm --prefix vue_sources install

Compilation du code JS

.. code-block:: console

    make prodjs devjs
    make prodjs2 devjs2

Cr√©ation d'un environnement virtuel Python.

.. code-block:: console

    cd caerp
    mkvirtualenv caerp -p python3 -r requirements.txt


Installation de l'application

.. code-block:: console

    python setup.py install
    cp development.ini.sample development.ini


√âditer le fichier development.ini et configurer votre logiciel (Acc√®s √† la base
de donn√©es, diff√©rents r√©pertoires de ressources statiques ...).

Initialiser la base de donn√©es

.. code-block:: console

    caerp-admin development.ini syncdb

Si vous utilisez un paquet tiers utilisant d'autres base de donn√©es (comme
caerp_payment en mode production)

.. code-block:: console

    caerp-migrate app.ini syncdb --pkg=caerp_payment

.. note::

    L'application synchronise alors automatiquement les mod√®les de donn√©es.

Puis cr√©er un compte administrateur

.. code-block:: console

    caerp-admin development.ini useradd [--user=<user>] [--pwd=<password>] [--firstname=<firstname>] [--lastname=<lastname>] [--group=<group>] [--email=<email>]

N.B : pour un administrateur, pr√©ciser

.. code-block:: console

    --group=admin


Installation (en environnement de dev)
--------------------------------------

Docker-compose permet de faciliter le d√©ploiement d'un environnement de d√©v complet. Le tableau suivant r√©capitule les
 diff√©rentes options possibles.

======================== ======================================================= =======================================
Composant                Fonctionnement recommand√©                               Fonctionnement alternatif (d√©conseill√©)
======================== ======================================================= =======================================
serveur MariaDB          natif ou docker-compose (make dev_db_serve)
serveur Redis            natif ou docker-compose (make dev_db_serve)
serveur web de d√©v       natif/bare-metal (make dev_serve)  True   False
build JS (Marionette/BB) docker-compose (make prodjs_dc devjs_dc)                 natif (make prodjs devjs)
build JS (VueJS)         docker-compose (make prodjs2_dc devjs2_dc)               natif (make prodjs2 devjs2)
build CSS                natif (make css_watch)
build JS (legacy)        natif (make js)
Postupgrade              docker-compose (make postupgrade_dev)                   natif (make postupgrade_dev_legacy)
======================== ======================================================= =======================================


.. warning::
    La suite de la doc ne couvre que les cas recommand√©s.

Installer les d√©pendendances syst√®me (cf ligne ``apt`` ou ``dnf``, selon votre
OS, dans la partie concernant l'installation en prod).

Ensuite, installez votre CAERP de d√©v avec les commandes suivantes :

.. code-block:: console

    sudo apt/dnf install [‚Ä¶] (idem √† la section concernant la prod)
    git clone https://framagit.org/caerp/caerp.git
    cd caerp
    cp development.ini.sample development.ini

..warning::
    Assurez-vous ensuite d'utiliser une verison de Python compatible avec CAERP ; √† d√©faut, suivez la section
    ¬´ Pour les distribution poss√©dant des versions de python incompatibles ¬ª avant de passer √† la suite.

..note::
    Si vous utilisez docker-compose pour le serveur mariadb, d√©commentez les lignes concernant docker-compose afin de
    bien viser le serveur mariadb dans docker-compose.

Installez les d√©pendances hors syst√®me :

    make postupgrade_dev

Il est possible de charger une base de donn√©es de d√©monstration compl√®te
(√©crase votre BDD caerp si elle existe) avec :

.. code-block::

   caerp-load-demo-data development.ini
   caerp-migrate development.ini upgrade

Pour les distribution poss√©dant des versions de python incompatibles
--------------------------------------------------------------------

Pour le moment, CAErp ne supporte pas les versions de pythons > 3.10,
on peut donc passer par pyenv pour installer une version de python
support√©e par le projet via `pyenv` :

.. code-block:: console

    $ curl https://pyenv.run | bash

Apr√®s avoir suivi les instructions, il est possible d'initialiser un
environement (en utilisant python 3.9 par exemple) :

.. code-block:: console

    $ sudo apt install liblzma-dev  # dnf install xz-devel sous RH
    $ cd workspace/caerp            # votre dossier dans lequel est clon√© caerp
    $ pyenv install 3.9
    $ pyenv virtualenv 3.9 caerp
    $ pyenv activate caerp
    (caerp) $ pip install -e .[dev]


Ex√©cution des t√¢ches asynchrones
---------------------------------

Un service de t√¢ches asynchrones bas√© sur celery et redis est en charge de
l'ex√©cution des t√¢ches les plus longues.

Voir :
https://caerp.readthedocs.io/fr/latest/celery.html

pour plus d'informations.

Mise √† jour (en environnement de prod)
--------------------------------------

La mise √† jour d'CAERP en prod s'effectue en plusieurs temps (il est pr√©f√©rable de
sauvegarder vos donn√©es avant de lancer les commandes suivantes)

Mise √† jour des d√©pendances python et du num√©ro de version

.. code-block:: console

    pip install .


Mise √† jour de la structure de donn√©es

.. code-block:: console

    caerp-migrate app.ini upgrade

Si vous utilisez un paquet tiers utilisant d'autres base de donn√©es (comme
caerp_payment en mode production)

.. code-block:: console

    caerp-migrate app.ini upgrade --pkg=caerp_payment

Configuration des donn√©es par d√©faut dans la base de donn√©es

.. code-block:: console

    caerp-admin app.ini syncdb

Met √† jour les d√©pendances JS

.. code-block:: console

    npm --prefix js_sources install

Compile le JavaScript :

    make prodjs

Puis lancer l'application web

.. code-block:: console

    pserve --reload development.ini

.. warning::

    Il est possible, sous Linux, que vous obteniez l'erreur suivante au lancement de pserve :

        [ERROR] watchdog error: [Errno 24] inotify instance limit reached

    La solution est la suivante :

        sudo bash -c 'echo "fs.inotify.max_user_instances = 1100000" >> /etc/sysctl.d/40-max-user-watches.conf'
        sudo sysctl -p

    De m√™me, si jamais pserve ne recharge pas tout le temps et/ou semble impossible √† arr√™ter avec Ctrl+C, il faut changer un autre param√®tre :

        sudo bash -c 'echo "fs.inotify.max_user_watches = 1100000" >> /etc/sysctl.d/40-max-user-watches.conf'
        sudo sysctl -p

    (il peut √™tre n√©cessaire de relancer la session utilisateur)



.. warning::

    Si ``pserve --reload`` dysfonctionne sans message d'erreur : changements non d√©tect√©s + impossible √† stopper avec Ctrl+C.

    Vous pouvez essayer d'installer watchman (``apt install watchman`` sous Debian/Ubuntu). √áa changera de backend de surveillance pour passer de **watchdog** √† **watchman**. Il n'y a rien √† configurer, si les deux sont install√©s, watchman sera pr√©f√©r √† watchdog.


Mise √† jour/changement de branche (environnement de d√©v)
---------------------------------------------------------
Ces instructions sont √† suivre une fois √† jour sur la branche git
souhait√©e. Elles sont sans risque : au pire elles ne feront rien si tout est
d√©j√† √† jour.

La commande suivante devrait s'occuper de tout

.. code-block:: console

    make postupgrade_dev


.. note::

    Le fichier Makefile est comment√© si besoin de plus d'infos/d√©tails sur ce
    que fait cette commande.


Standards de codage Python
^^^^^^^^^^^^^^^^^^^^^^^^^^

Le code CAERP doit √™tre formatt√© en respectant la pep8_.

√Ä cette fin il est recommand√© d'utiliser un analyseur de code comme flake8_.

En compl√©ment, afin d'assurer une uniformisation dans la mise en forme du code,
l'outil de formattage de code black_ doit √™tre utilis√© pour le d√©veloppement.

Il peut √™tre configur√© `au niveau de votre √©diteur`_ (le plus confortable) et/ou en
pre-commit.

.. _pep8: https://www.python.org/dev/peps/pep-0008/
.. _flake8: https://flake8.pycqa.org/en/latest/
.. _black: https://black.readthedocs.io/en/stable/index.html
.. _au niveau de votre √©diteur: https://black.readthedocs.io/en/stable/integrations/editors.html

.. note::

   Pour activer le pre-commit hook (une fois pour toutes) : depuis le venv :

   ``pre-commit install``

   Ensuite, √† chaque commit, lorsque votre code n'est pas formatt√© correctement
   selon black le reformatera au moment du commit **et fera √©chouer
   le commit**. Il faudra alors ajouter (``git add``) les modifications
   apport√©es par black et commiter √† nouveau.

Il est √©galement possible de lancer black manuellement sur l'ensemble du projet :

.. code-block:: console

   make black

(si vous n'utilisez pas black en local, l'int√©gration continue vous le rappelera üòÅ)


Standards de codage Javascript Marionette
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Le code javascript Backbone/Marionette de CAERP (dans js_sources/src) doit √™tre
formatt√© √† l'aide de prettier.

.. code-block:: console

    cd js_sources/
    npm install -D
    npm prettier --config=./.prettierrc --write src/

Id√©alement le code doit √™tre v√©rifi√© √† l'aide de eslint.

.. code-block:: console

    cd js_sources/
    npm install -D
    npm eslint -c ./.eslintrc src/

Ces deux outils peuvent √™tre int√©gr√©s dans la majorit√© des √©diteurs de code.


Base de donn√©es avec docker-compose (MariaDB + redis)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Pour h√©berger sur un conteneur docker jettable et reproductible sans toucher √†
la machine h√¥te, une configuration docker-compose est disponible.

Pour installer l'environnement (la premi√®re fois) :

.. code-block:: console

   sudo apt install docker-compose
   sudo usermod -a -G docker $USER


Pour l'utiliser, plusieurs raccourcis sont offerts :

.. code-block:: console

    # Faire tourner une BDD que l'on stoppera avec ctrl+c
    make dev_db_serve
    # D√©marrer une BDD
    make dev_db_start
    # Ar√™tter une BDD d√©marr√©e avec la commande pr√©c√©dente
    make dev_db_stop
    # Effacer les donn√©es de la BDD de d√©v
    make dev_db_clear

Des configurations adapt√©es √† docker-compose sont comment√©es dans ``test.ini.sample`` et
``developement.ini.sample``.

Compilation dynamique des assets (JS/CSS) avec docker compose
-----------------------------------------------------------------

Pour compiler uniquement les fichiers js

.. code-block:: console

    docker compose -f js-docker-compose.yaml up

Pour compiler les fichiers css

.. code-block:: console

    docker compose -f css-docker-compose.yaml up


Tests
------

Copier et personnaliser le fichier de configuration

.. code-block:: console

    cp test.ini.sample test.ini

Lancer les tests

.. code-block:: console

   py.test caerp/tests

Documentation utilisateur
--------------------------

Le guide d'utilisation se trouve √† cette adresse :
https://doc.endi.coop

*****


:Ce projet est test√© avec: `BrowserStack <https://www.browserstack.com/>`_
