"""
================================================================================
pyvale: the python validation engine
License: MIT
Copyright (C) 2024 The Computer Aided Validation Team
================================================================================
"""
import pytest
import numpy.testing as npt
import numpy as np
from scipy.spatial.transform import Rotation
import yaml


# Pyvale imports
import pyvale.sensorsim as sens
import pyvale.dataset as dataset
import pyvale.mooseherder as mh
import pyvale.blender as blender

# NOTE: These test may fail if you are not running bpy 4.4.0
# It is a known issue that the render outputs between bpy 4.2.0 and 4.4.0 slightly
# differ. If you are running bpy 4.2.0, the following tests will fail:
# - test_camera_from_resolution
# - test_render_engine[Eeeve render engine]
# - test_stereo_convenience_cameras[Symmetric convenience function]
# - test_stereo_deformation
# These tests simply fail due to the version difference of bpy and the consequential
# difference in rendering.

@pytest.fixture
def sample_scene_no_cam():
    data_path = dataset.mechanical_2d_path()
    sim_data = mh.ExodusLoader(data_path).load_all_sim_data()
    disp_comps = ("disp_x","disp_y")
    sim_data = sens.scale_length_units(1000.0,sim_data,disp_comps)
    render_mesh = sens.create_render_mesh(sim_data,
                                        ("disp_y","disp_x"),
                                        sim_spat_dim=sens.EDim.TWOD,
                                        field_disp_keys=disp_comps)

    scene = blender.Scene()
    part = scene.add_part(render_mesh, sim_spat_dim=3)
    light_data = blender.LightData(type=blender.LightType.POINT,
                                         pos_world=(0, 0, 400),
                                         rot_world=Rotation.from_euler("xyz",
                                                                       [0, 0, 0]),
                                         energy=1)
    light = scene.add_light(light_data)
    cam_data_0 = sens.CameraData(pixels_num=np.array([20, 20]),
                                 pixels_size=np.array([0.00345, 0.00345]),
                                 pos_world=np.array([0, 0, 500]),
                                 rot_world=Rotation.from_euler("xyz", [0, 0, 0]),
                                 roi_cent_world=(0, 0, 0),
                                 focal_length=15)
    material_data = blender.MaterialData()
    speckle_path = dataset.dic_pattern_5mpx_path()
    mm_px_resolution = sens.CameraTools.calculate_mm_px_resolution(cam_data_0)
    scene.add_speckle(part=part,
                                    speckle_path=speckle_path,
                                    mat_data=material_data,
                                    mm_px_resolution=mm_px_resolution)
    return cam_data_0, part, render_mesh, scene

@pytest.fixture
def sample_stereo_scene(sample_scene_no_cam):
    cam_data_0, part, render_mesh, scene = sample_scene_no_cam
    stereo_system = sens.CameraTools.faceon_stereo_cameras(cam_data_0=cam_data_0,
                                                  stereo_angle=15.0)
    cam0, cam1 = scene.add_stereo_system(stereo_system)
    return (stereo_system, part, render_mesh, scene)

@pytest.mark.parametrize(
    "placement, output",
    [
        pytest.param("symmetric", "stereo_symmetric", id="Symmetric convenience function"),
        pytest.param("faceon", "stereo_faceon", id="Face-on convenience function")
    ]
)
def test_stereo_convenience_cameras(placement, output, request, sample_scene_no_cam, tmp_path):
    (cam_data_0, _, _, scene) = sample_scene_no_cam
    if placement == "symmetric":
        stereo_system = sens.CameraTools.symmetric_stereo_cameras(
            cam_data_0=cam_data_0,
            stereo_angle=15.0)
    elif placement == "faceon":
        stereo_system = sens.CameraTools.faceon_stereo_cameras(
            cam_data_0=cam_data_0,
            stereo_angle=15.0)
    cam0, cam1 = scene.add_stereo_system(stereo_system)
    render_data = blender.RenderData(cam_data=(stereo_system.cam_data_0,
                                              stereo_system.cam_data_1),
                                    base_dir=tmp_path)
    image_array = scene.render_single_image(stage_image=True,
                                            render_data=render_data)
    output = request.getfixturevalue(output)

    npt.assert_allclose(image_array, output, atol=2, rtol=0)

def test_stereo_deformation(sample_stereo_scene, deformed_images, tmp_path):
    (stereo_system, part, render_mesh, scene) = sample_stereo_scene
    render_data = blender.RenderData(cam_data=(stereo_system.cam_data_0,
                                              stereo_system.cam_data_1),
                                    base_dir=tmp_path)
    image_arrays = scene.render_deformed_images(render_mesh=render_mesh,
                                              sim_spat_dim=3,
                                              render_data=render_data,
                                              part=part,
                                              stage_image=True)
    image_array = image_arrays[:, :, 120:]
    npt.assert_allclose(image_array, deformed_images, atol=2, rtol=0)

def test_cal_images():
    calibration_data = blender.CalibrationData(angle_lims=(-10, 10),
                                              angle_step=5,
                                              plunge_lims=(-5, 5),
                                              plunge_step=5)
    number_cal_images = blender.Tools.number_calibration_images(calibration_data)

    assert number_cal_images == 675

def test_calib_file(tmp_path, sample_stereo_scene, calib_dict):
    (stereo_system, _, _, _) = sample_stereo_scene

    stereo_system.save_calibration(base_dir=tmp_path)

    output = tmp_path / "calibration/calibration.yaml"
    output_dict = yaml.safe_load(output.read_text())

    assert calib_dict == output_dict

def test_cameras_from_calib(tmp_path, sample_stereo_scene):
    (stereo_system, _, _, _) = sample_stereo_scene
    stereo_system.save_calibration(base_dir=tmp_path)

    output = tmp_path / "calibration/calibration.yaml"

    params = yaml.safe_load(output.read_text())

    camerastereo = sens.CameraStereo.from_calibration(calib_path=output,
                                                        pos_world_0=np.array([0, 0, 500]),
                                                        rot_world_0=Rotation.from_euler(
                                                            "xyz", [0, 0, 0]),
                                                        focal_length=15.0)

    npt.assert_array_almost_equal(camerastereo.stereo_dist, stereo_system.stereo_dist)
    assert camerastereo.stereo_rotation.approx_equal(stereo_system.stereo_rotation)


@pytest.fixture
def stereo_symmetric():
    return np.array([[[82, 71],
        [80, 63],
        [62, 65],
        [57, 68],
        [76, 71],
        [79, 75],
        [67, 72],
        [61, 70],
        [60, 67],
        [61, 64],
        [60, 66],
        [55, 69],
        [46, 68],
        [47, 64],
        [60, 60],
        [63, 59],
        [56, 55],
        [55, 63],
        [63, 64],
        [60, 62]],

       [[61, 65],
        [71, 62],
        [48, 54],
        [43, 52],
        [51, 51],
        [57, 51],
        [56, 55],
        [52, 56],
        [56, 55],
        [61, 60],
        [63, 69],
        [61, 70],
        [54, 68],
        [49, 65],
        [50, 62],
        [57, 62],
        [59, 59],
        [58, 62],
        [64, 65],
        [63, 66]],

       [[59, 61],
        [75, 58],
        [45, 54],
        [33, 54],
        [40, 56],
        [45, 51],
        [46, 48],
        [46, 43],
        [48, 39],
        [52, 43],
        [57, 50],
        [64, 56],
        [65, 60],
        [65, 64],
        [60, 63],
        [62, 65],
        [67, 69],
        [71, 70],
        [69, 72],
        [64, 70]],

       [[46, 59],
        [74, 49],
        [53, 51],
        [35, 60],
        [47, 61],
        [41, 51],
        [28, 36],
        [21, 16],
        [15,  4],
        [14,  4],
        [17,  5],
        [28, 10],
        [42, 19],
        [54, 34],
        [63, 49],
        [69, 65],
        [71, 70],
        [68, 70],
        [66, 71],
        [59, 71]],

       [[33, 56],
        [66, 46],
        [52, 57],
        [41, 60],
        [43, 52],
        [21, 30],
        [ 2,  5],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 1,  0],
        [23,  0],
        [51, 11],
        [65, 45],
        [69, 60],
        [68, 67],
        [64, 68],
        [57, 68]],

       [[35, 55],
        [59, 50],
        [52, 63],
        [38, 60],
        [12, 36],
        [ 0,  3],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [18,  1],
        [52,  6],
        [63, 36],
        [63, 55],
        [67, 57],
        [65, 59]],

       [[44, 58],
        [54, 56],
        [52, 69],
        [22, 55],
        [ 0, 13],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [17,  0],
        [56,  6],
        [68, 42],
        [65, 53],
        [66, 50]],

       [[60, 61],
        [60, 65],
        [48, 75],
        [ 5, 46],
        [ 1,  2],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 2,  1],
        [32,  0],
        [64, 19],
        [61, 44],
        [66, 50]],

       [[66, 59],
        [62, 68],
        [34, 73],
        [ 0, 34],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [14,  0],
        [56,  8],
        [62, 43],
        [56, 55]],

       [[63, 56],
        [66, 69],
        [24, 70],
        [ 0, 23],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [11,  0],
        [53,  7],
        [64, 48],
        [51, 60]],

       [[53, 51],
        [69, 69],
        [24, 68],
        [ 0, 21],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [16,  0],
        [56, 11],
        [66, 52],
        [46, 66]],

       [[50, 58],
        [64, 72],
        [29, 68],
        [ 0, 24],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [24,  0],
        [60, 22],
        [66, 57],
        [45, 70]],

       [[51, 75],
        [61, 78],
        [36, 68],
        [ 1, 30],
        [ 1,  2],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 3,  1],
        [38,  2],
        [64, 41],
        [64, 61],
        [45, 68]],

       [[48, 81],
        [58, 76],
        [41, 72],
        [10, 42],
        [ 0,  9],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [18,  1],
        [52, 20],
        [64, 56],
        [58, 60],
        [49, 64]],

       [[51, 78],
        [60, 73],
        [48, 68],
        [29, 50],
        [ 4, 26],
        [ 0,  3],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 4,  0],
        [35,  6],
        [58, 43],
        [63, 55],
        [55, 51],
        [53, 57]],

       [[48, 76],
        [54, 72],
        [54, 67],
        [43, 57],
        [24, 42],
        [ 4, 26],
        [ 0,  6],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 2,  0],
        [24,  4],
        [49, 31],
        [62, 52],
        [60, 47],
        [58, 52],
        [55, 58]],

       [[63, 77],
        [67, 76],
        [73, 78],
        [60, 72],
        [48, 64],
        [45, 56],
        [33, 47],
        [12, 25],
        [ 7,  8],
        [ 8,  4],
        [ 7,  2],
        [11,  3],
        [15,  3],
        [28, 11],
        [46, 27],
        [58, 48],
        [63, 54],
        [60, 49],
        [64, 58],
        [60, 63]],

       [[73, 78],
        [70, 79],
        [76, 80],
        [62, 76],
        [60, 72],
        [66, 69],
        [71, 67],
        [59, 63],
        [54, 55],
        [63, 48],
        [59, 44],
        [54, 39],
        [52, 34],
        [55, 37],
        [61, 48],
        [66, 56],
        [61, 55],
        [60, 52],
        [62, 58],
        [63, 63]],

       [[80, 65],
        [71, 71],
        [70, 74],
        [58, 70],
        [69, 70],
        [70, 70],
        [75, 71],
        [69, 68],
        [69, 66],
        [70, 64],
        [77, 62],
        [70, 61],
        [55, 57],
        [55, 56],
        [62, 61],
        [58, 61],
        [60, 56],
        [58, 55],
        [55, 55],
        [65, 58]],

       [[68, 48],
        [77, 59],
        [65, 66],
        [63, 64],
        [75, 66],
        [80, 68],
        [84, 71],
        [74, 73],
        [70, 70],
        [65, 66],
        [62, 59],
        [52, 53],
        [37, 50],
        [47, 57],
        [58, 62],
        [61, 60],
        [63, 56],
        [60, 56],
        [64, 62],
        [66, 55]]])

@pytest.fixture
def stereo_faceon():
    return np.array([[[52, 45],
        [62, 52],
        [54, 54],
        [57, 82],
        [65, 92],
        [71, 85],
        [72, 77],
        [72, 68],
        [70, 59],
        [75, 57],
        [79, 65],
        [78, 65],
        [77, 59],
        [78, 52],
        [78, 47],
        [69, 44],
        [70, 32],
        [82, 34],
        [87, 60],
        [71, 64]],

       [[57, 44],
        [67, 41],
        [50, 37],
        [58, 63],
        [62, 72],
        [62, 68],
        [64, 70],
        [63, 68],
        [62, 66],
        [66, 58],
        [67, 59],
        [68, 60],
        [69, 59],
        [73, 59],
        [74, 56],
        [66, 46],
        [63, 36],
        [72, 44],
        [73, 72],
        [64, 69]],

       [[57, 63],
        [62, 52],
        [47, 36],
        [63, 53],
        [67, 68],
        [65, 56],
        [65, 53],
        [59, 54],
        [53, 52],
        [50, 47],
        [49, 40],
        [51, 40],
        [54, 46],
        [61, 62],
        [62, 69],
        [57, 61],
        [60, 50],
        [71, 53],
        [72, 72],
        [66, 69]],

       [[57, 67],
        [54, 48],
        [45, 35],
        [60, 57],
        [55, 76],
        [43, 56],
        [33, 34],
        [24, 21],
        [13, 13],
        [ 7,  8],
        [ 7,  4],
        [ 8,  4],
        [13, 12],
        [26, 37],
        [39, 57],
        [45, 63],
        [57, 62],
        [70, 60],
        [71, 71],
        [65, 70]],

       [[65, 65],
        [54, 51],
        [46, 39],
        [53, 62],
        [32, 76],
        [ 6, 44],
        [ 0,  7],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  1],
        [ 8, 21],
        [32, 48],
        [52, 61],
        [69, 65],
        [72, 75],
        [66, 69]],

       [[69, 59],
        [58, 54],
        [56, 41],
        [52, 70],
        [10, 74],
        [ 0, 29],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 7, 17],
        [41, 48],
        [69, 62],
        [73, 72],
        [67, 69]],

       [[69, 59],
        [58, 53],
        [63, 42],
        [47, 74],
        [ 2, 63],
        [ 0,  6],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [28, 28],
        [65, 58],
        [71, 67],
        [62, 62]],

       [[69, 66],
        [58, 50],
        [60, 50],
        [37, 78],
        [ 1, 39],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [20, 11],
        [62, 52],
        [70, 67],
        [58, 59]],

       [[71, 74],
        [60, 52],
        [57, 52],
        [29, 73],
        [ 1, 24],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [17,  4],
        [63, 46],
        [71, 67],
        [54, 53]],

       [[70, 74],
        [61, 52],
        [59, 56],
        [21, 65],
        [ 0, 14],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [15,  2],
        [64, 42],
        [73, 66],
        [51, 52]],

       [[65, 65],
        [63, 56],
        [63, 53],
        [19, 53],
        [ 1,  5],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [18,  5],
        [65, 44],
        [71, 64],
        [49, 51]],

       [[56, 63],
        [67, 65],
        [70, 62],
        [22, 46],
        [ 0,  3],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [21, 17],
        [64, 53],
        [68, 61],
        [52, 52]],

       [[53, 62],
        [68, 67],
        [73, 61],
        [29, 55],
        [ 1, 11],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [27, 35],
        [65, 60],
        [69, 60],
        [56, 53]],

       [[56, 64],
        [62, 70],
        [69, 58],
        [42, 63],
        [ 1, 29],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1, 11],
        [36, 50],
        [66, 61],
        [71, 59],
        [56, 54]],

       [[59, 62],
        [62, 73],
        [64, 61],
        [52, 54],
        [14, 45],
        [ 0, 16],
        [ 0,  2],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 0,  2],
        [12, 40],
        [50, 60],
        [70, 63],
        [74, 62],
        [56, 60]],

       [[60, 57],
        [64, 69],
        [63, 67],
        [61, 58],
        [29, 56],
        [ 0, 49],
        [ 0, 42],
        [ 0, 19],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [10, 27],
        [42, 60],
        [60, 64],
        [71, 66],
        [74, 64],
        [52, 63]],

       [[58, 58],
        [62, 67],
        [57, 77],
        [68, 77],
        [39, 66],
        [ 9, 68],
        [ 2, 81],
        [ 1, 73],
        [ 2, 49],
        [ 2, 28],
        [ 2, 20],
        [ 6, 14],
        [11, 16],
        [28, 32],
        [50, 61],
        [57, 69],
        [63, 68],
        [69, 68],
        [72, 64],
        [47, 65]],

       [[69, 59],
        [62, 67],
        [47, 76],
        [69, 70],
        [50, 57],
        [41, 65],
        [43, 80],
        [40, 84],
        [40, 75],
        [48, 68],
        [52, 65],
        [53, 60],
        [55, 54],
        [64, 59],
        [67, 68],
        [65, 70],
        [59, 70],
        [62, 68],
        [74, 61],
        [48, 70]],

       [[70, 60],
        [55, 58],
        [46, 60],
        [72, 54],
        [66, 48],
        [66, 48],
        [74, 61],
        [74, 66],
        [68, 71],
        [71, 73],
        [72, 69],
        [71, 68],
        [72, 66],
        [73, 55],
        [69, 55],
        [57, 64],
        [49, 70],
        [55, 66],
        [74, 53],
        [54, 64]],

       [[57, 49],
        [43, 58],
        [40, 46],
        [57, 50],
        [56, 45],
        [52, 52],
        [61, 51],
        [73, 42],
        [73, 50],
        [57, 55],
        [54, 57],
        [57, 60],
        [56, 58],
        [53, 43],
        [59, 35],
        [41, 45],
        [33, 59],
        [41, 59],
        [64, 53],
        [49, 54]]])

@pytest.fixture
def deformed_images():
    return np.array([[[61, 64],
        [51, 61],
        [60, 57],
        [59, 57],
        [58, 72],
        [60, 75],
        [62, 68],
        [59, 61],
        [63, 54],
        [67, 52],
        [73, 56],
        [73, 56],
        [75, 50],
        [77, 45],
        [80, 36],
        [77, 32],
        [74, 36],
        [69, 38],
        [76, 41],
        [70, 44]],

       [[61, 68],
        [57, 75],
        [63, 66],
        [69, 60],
        [68, 64],
        [65, 62],
        [57, 62],
        [55, 58],
        [58, 45],
        [60, 41],
        [61, 51],
        [64, 55],
        [68, 57],
        [72, 55],
        [74, 44],
        [75, 47],
        [75, 59],
        [68, 62],
        [75, 66],
        [67, 65]],

       [[65, 73],
        [63, 67],
        [64, 55],
        [68, 53],
        [64, 53],
        [56, 46],
        [43, 47],
        [36, 42],
        [35, 26],
        [33, 14],
        [29, 15],
        [34, 24],
        [43, 34],
        [56, 44],
        [64, 43],
        [70, 52],
        [73, 60],
        [74, 61],
        [77, 64],
        [71, 65]],

       [[69, 82],
        [66, 64],
        [60, 48],
        [55, 52],
        [46, 51],
        [27, 29],
        [ 6, 17],
        [ 1,  8],
        [ 0,  1],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [10,  7],
        [32, 28],
        [52, 53],
        [62, 61],
        [69, 63],
        [68, 63],
        [70, 62]],

       [[70, 81],
        [71, 65],
        [66, 45],
        [51, 60],
        [21, 55],
        [ 1, 20],
        [ 0,  1],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 3,  6],
        [30, 43],
        [52, 59],
        [62, 65],
        [63, 65],
        [64, 50]],

       [[67, 74],
        [69, 63],
        [52, 46],
        [27, 64],
        [ 1, 54],
        [ 0,  9],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 8, 13],
        [40, 46],
        [54, 57],
        [53, 56],
        [50, 40]],

       [[69, 73],
        [67, 64],
        [45, 53],
        [11, 61],
        [ 0, 44],
        [ 0,  1],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [24, 19],
        [50, 46],
        [54, 54],
        [40, 40]],

       [[76, 61],
        [67, 63],
        [51, 61],
        [19, 58],
        [ 1, 29],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [12,  4],
        [45, 39],
        [52, 51],
        [41, 41]],

       [[74, 66],
        [61, 60],
        [50, 63],
        [23, 52],
        [ 1, 18],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 9,  2],
        [48, 39],
        [51, 49],
        [45, 45]],

       [[70, 60],
        [66, 48],
        [52, 57],
        [18, 45],
        [ 0, 10],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 7,  2],
        [49, 37],
        [51, 49],
        [53, 53]],

       [[55, 43],
        [65, 36],
        [52, 46],
        [12, 43],
        [ 1,  7],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 7,  4],
        [48, 36],
        [53, 49],
        [59, 57]],

       [[49, 27],
        [63, 32],
        [56, 44],
        [18, 48],
        [ 0, 13],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 7,  8],
        [46, 40],
        [57, 49],
        [64, 60]],

       [[50, 31],
        [62, 42],
        [63, 50],
        [40, 55],
        [ 2, 34],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [14, 23],
        [50, 50],
        [63, 57],
        [68, 65]],

       [[46, 42],
        [58, 52],
        [64, 57],
        [57, 58],
        [15, 51],
        [ 1, 11],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 1,  1],
        [ 0,  0],
        [ 3,  7],
        [25, 43],
        [54, 59],
        [68, 65],
        [69, 63]],

       [[44, 50],
        [58, 58],
        [65, 62],
        [63, 60],
        [40, 59],
        [ 1, 35],
        [ 0,  3],
        [ 1,  1],
        [ 0,  0],
        [ 0,  0],
        [ 0,  0],
        [ 1,  1],
        [ 1,  1],
        [ 0,  0],
        [ 1,  6],
        [17, 38],
        [33, 57],
        [45, 61],
        [56, 66],
        [59, 59]],

       [[45, 60],
        [57, 65],
        [66, 69],
        [61, 64],
        [51, 57],
        [25, 48],
        [ 1, 25],
        [ 0,  2],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 1,  1],
        [ 4, 13],
        [28, 42],
        [41, 53],
        [43, 54],
        [44, 57],
        [51, 61],
        [53, 55]],

       [[50, 59],
        [60, 70],
        [67, 71],
        [61, 64],
        [57, 59],
        [54, 57],
        [39, 44],
        [15, 24],
        [ 4, 12],
        [ 2,  7],
        [ 3,  6],
        [12, 17],
        [25, 32],
        [44, 48],
        [58, 52],
        [57, 54],
        [58, 53],
        [62, 54],
        [65, 57],
        [63, 53]],

       [[55, 62],
        [63, 67],
        [66, 66],
        [54, 63],
        [59, 65],
        [67, 61],
        [70, 47],
        [63, 43],
        [52, 43],
        [50, 43],
        [51, 47],
        [52, 54],
        [56, 59],
        [60, 58],
        [63, 60],
        [64, 57],
        [67, 55],
        [71, 54],
        [62, 56],
        [71, 51]],

       [[63, 73],
        [63, 69],
        [64, 68],
        [46, 65],
        [55, 63],
        [74, 62],
        [79, 55],
        [78, 59],
        [76, 59],
        [77, 63],
        [70, 65],
        [66, 62],
        [65, 60],
        [64, 64],
        [69, 65],
        [70, 52],
        [70, 49],
        [68, 55],
        [53, 54],
        [64, 49]],

       [[64, 74],
        [67, 71],
        [61, 71],
        [42, 62],
        [52, 63],
        [73, 68],
        [82, 63],
        [83, 67],
        [73, 68],
        [64, 72],
        [60, 71],
        [59, 66],
        [58, 63],
        [63, 63],
        [70, 61],
        [73, 48],
        [73, 45],
        [70, 52],
        [66, 53],
        [53, 34]]])

@pytest.fixture
def calib_dict():
    return {
            "Cam0_Fx [pixels]": 4347.826086956522,
            "Cam0_Fy [pixels]": 4347.826086956522,
            "Cam0_Fs [pixels]": 0,
            "Cam0_Kappa 1": 0.0,
            "Cam0_Kappa 2": 0.0,
            "Cam0_Kappa 3": 0.0,
            "Cam0_P1": 0.0,
            "Cam0_P2": 0.0,
            "Cam0_Cx [pixels]": 10.0,
            "Cam0_Cy [pixels]": 10.0,
            "Cam1_Fx [pixels]": 4347.826086956522,
            "Cam1_Fy [pixels]": 4347.826086956522,
            "Cam1_Fs [pixels]": 0,
            "Cam1_Kappa 1": 0.0,
            "Cam1_Kappa 2": 0.0,
            "Cam1_Kappa 3": 0.0,
            "Cam1_P1": 0.0,
            "Cam1_P2": 0.0,
            "Cam1_Cx [pixels]": 10.0,
            "Cam1_Cy [pixels]": 10.0,
            "Tx [mm]": -128.46813489644606,
            "Ty [mm]": 0.0,
            "Tz [mm]": 34.42293299863527,
            "Theta [deg]": 0.0,
            "Phi [deg]": 15.000000000000009,
            "Psi [deg]": 0.0
        }


