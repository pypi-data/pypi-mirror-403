# Remote Devices Schema
# Currently supported: mqtt
# Planned for future: loxone, esphome_udp, esphome_api, can

type: list
required: False
meta:
  label: "Remote devices that can be controlled from this boneIO."
schema:
  type: dict
  schema:
    id:
      type: string
      required: True
      coerce: str
      meta:
        label: Device ID
        description: |
          Unique identifier for this remote device (used in actions).
          Example: "salon_boneio", "garage_esp"
    name:
      type: string
      required: True
      meta:
        label: Device Name
        description: |
          Friendly name for this device shown in UI.
          Example: "Salon boneIO", "ESP Garage"
    protocol:
      type: string
      required: True
      # Supported: mqtt, esphome_api, wled
      # Future: 'loxone', 'esphome_udp', 'can'
      allowed: ['mqtt', 'esphome_api', 'wled']
      meta:
        label: Protocol
        description: |
          Communication protocol to use:
          - mqtt: Standard MQTT (boneIO Black, ESPHome, other MQTT devices)
    device_type:
      type: string
      required: False
      default: "boneio_black"
      allowed: ['boneio_black', 'esphome', 'wled', 'generic']
      meta:
        label: Device Type
        description: |
          Type of remote device. Affects how commands are formatted:
          - boneio_black: Another boneIO Black device
          - esphome: ESPHome device
          - generic: Generic device (custom topic format)
    
    # MQTT Protocol Parameters
    mqtt:
      type: dict
      required: False
      dependencies:
        protocol: ['mqtt']
      meta:
        label: MQTT Protocol Settings
        description: |
          For boneIO Black devices, outputs and covers will be auto-discovered.
          The device_id should match the remote device's serial (e.g., "blk_abc123").
      schema:
        outputs:
          type: list
          required: False
          meta:
            label: Available Outputs
            description: "Optional list of outputs for dropdown selection in actions"
          schema:
            type: dict
            schema:
              id:
                type: string
                required: True
                meta:
                  label: Output ID
              name:
                type: string
                required: False
                meta:
                  label: Output Name (for UI)
        covers:
          type: list
          required: False
          meta:
            label: Available Covers
            description: "Optional list of covers for dropdown selection in actions"
          schema:
            type: dict
            schema:
              id:
                type: string
                required: True
                meta:
                  label: Cover ID
              name:
                type: string
                required: False
                meta:
                  label: Cover Name (for UI)
    
    # =========================================================================
    # FUTURE PROTOCOLS - NOT YET IMPLEMENTED
    # Below are planned protocol configurations for future implementation.
    # Uncomment and add to 'allowed' list in 'protocol' field when ready.
    # =========================================================================
    
    # # CAN Protocol Parameters (future)
    # can:
    #   type: dict
    #   required: False
    #   dependencies:
    #     protocol: ['can']
    #   meta:
    #     label: CAN Protocol Settings
    #   schema:
    #     node_id:
    #       type: integer
    #       required: True
    #       meta:
    #         label: CAN Node ID
    #         description: "CAN bus node identifier of the remote device"
    #     outputs:
    #       type: list
    #       required: False
    #       meta:
    #         label: Available Outputs
    #       schema:
    #         type: dict
    #         schema:
    #           id:
    #             type: string
    #             required: True
    #           name:
    #             type: string
    #             required: False
    #     covers:
    #       type: list
    #       required: False
    #       meta:
    #         label: Available Covers
    #       schema:
    #         type: dict
    #         schema:
    #           id:
    #             type: string
    #             required: True
    #           name:
    #             type: string
    #             required: False
    
    # # ESPHome UDP Parameters (future)
    # esphome_udp:
    #   type: dict
    #   required: False
    #   dependencies:
    #     protocol: ['esphome_udp']
    #   meta:
    #     label: ESPHome UDP Settings
    #   schema:
    #     host:
    #       type: string
    #       required: True
    #       meta:
    #         label: Host
    #         description: "IP address or hostname of ESPHome device"
    #     port:
    #       type: integer
    #       required: False
    #       default: 6053
    #       meta:
    #         label: Port
    
    # ESPHome API Parameters
    esphome_api:
      type: dict
      required: False
      dependencies:
        protocol: ['esphome_api']
      meta:
        label: ESPHome API Settings
        description: |
          Native ESPHome API connection settings.
          Entities (switches, lights, covers) can be auto-discovered.
      schema:
        host:
          type: string
          required: True
          meta:
            label: Host
            description: "IP address or hostname of ESPHome device"
        port:
          type: integer
          required: False
          default: 6053
          meta:
            label: Port
        password:
          type: string
          required: False
          meta:
            label: API Password
            description: "Optional API password (if configured on ESPHome device)"
        encryption_key:
          type: string
          required: False
          meta:
            label: Encryption Key
            description: "Optional noise encryption key (base64 encoded)"
        switches:
          type: list
          required: False
          meta:
            label: Available Switches
            description: "List of switches discovered or manually configured"
          schema:
            type: dict
            schema:
              id:
                type: string
                required: True
                meta:
                  label: Switch ID (object_id)
              name:
                type: string
                required: False
                meta:
                  label: Switch Name
              key:
                type: integer
                required: False
                meta:
                  label: Entity Key (from discovery)
        lights:
          type: list
          required: False
          meta:
            label: Available Lights
            description: "List of lights discovered or manually configured"
          schema:
            type: dict
            schema:
              id:
                type: string
                required: True
                meta:
                  label: Light ID (object_id)
              name:
                type: string
                required: False
                meta:
                  label: Light Name
              key:
                type: integer
                required: False
                meta:
                  label: Entity Key (from discovery)
              supports_brightness:
                type: boolean
                required: False
                default: false
                meta:
                  label: Supports Brightness
              supports_color_temp:
                type: boolean
                required: False
                default: false
                meta:
                  label: Supports Color Temperature
              supports_rgb:
                type: boolean
                required: False
                default: false
                meta:
                  label: Supports RGB Color
              supports_rgbw:
                type: boolean
                required: False
                default: false
                meta:
                  label: Supports RGBW Color
              min_mireds:
                type: float
                required: False
                meta:
                  label: Min Color Temp (mireds)
              max_mireds:
                type: float
                required: False
                meta:
                  label: Max Color Temp (mireds)
        covers:
          type: list
          required: False
          meta:
            label: Available Covers
            description: "List of covers discovered or manually configured"
          schema:
            type: dict
            schema:
              id:
                type: string
                required: True
                meta:
                  label: Cover ID (object_id)
              name:
                type: string
                required: False
                meta:
                  label: Cover Name
              key:
                type: integer
                required: False
                meta:
                  label: Entity Key (from discovery)
              supports_position:
                type: boolean
                required: False
                default: false
                meta:
                  label: Supports Position
              supports_tilt:
                type: boolean
                required: False
                default: false
                meta:
                  label: Supports Tilt
    
    # WLED Protocol Parameters
    wled:
      type: dict
      required: False
      dependencies:
        protocol: ['wled']
      meta:
        label: WLED Settings
        description: |
          WLED HTTP JSON API connection settings.
          Segments can be auto-discovered from the device.
      schema:
        host:
          type: string
          required: True
          meta:
            label: Host
            description: "IP address or hostname of WLED device (e.g. wled-salon.local)"
        port:
          type: integer
          required: False
          default: 80
          meta:
            label: Port
        segments:
          type: list
          required: False
          meta:
            label: Available Segments
            description: "List of LED segments discovered or manually configured"
          schema:
            type: dict
            schema:
              id:
                type: integer
                required: True
                meta:
                  label: Segment ID
              name:
                type: string
                required: False
                meta:
                  label: Segment Name
              start:
                type: integer
                required: False
                meta:
                  label: Start LED
              stop:
                type: integer
                required: False
                meta:
                  label: Stop LED
              len:
                type: integer
                required: False
                meta:
                  label: LED Count
              supports_rgb:
                type: boolean
                required: False
                default: true
                meta:
                  label: Supports RGB Color
        effects:
          type: list
          required: False
          meta:
            label: Available Effects
            description: "List of WLED effects discovered from the device"
          schema:
            type: dict
            schema:
              id:
                type: integer
                required: True
                meta:
                  label: Effect ID
              name:
                type: string
                required: True
                meta:
                  label: Effect Name
        palettes:
          type: list
          required: False
          meta:
            label: Available Palettes
            description: "List of WLED color palettes discovered from the device"
          schema:
            type: dict
            schema:
              id:
                type: integer
                required: True
                meta:
                  label: Palette ID
              name:
                type: string
                required: True
                meta:
                  label: Palette Name
    
    # # Loxone Parameters (future)
    # loxone:
    #   type: dict
    #   required: False
    #   dependencies:
    #     protocol: ['loxone']
    #   meta:
    #     label: Loxone Settings
    #   schema:
    #     host:
    #       type: string
    #       required: True
    #       meta:
    #         label: Miniserver Host
    #         description: "IP address or hostname of Loxone Miniserver"
    #     port:
    #       type: integer
    #       required: False
    #       default: 80
    #       meta:
    #         label: Port
    #     username:
    #       type: string
    #       required: False
    #       meta:
    #         label: Username
    #     password:
    #       type: string
    #       required: False
    #       meta:
    #         label: Password
