# ================================================================
# THEUS AUDIT RECIPE (specs/audit_recipe.yaml)
# ================================================================
# This file defines RULES for validating process Inputs/Outputs.
# The Audit Layer acts as an Industrial QA Gate.
#
# --- SEVERITY LEVELS ---
# S (Shutdown)  : Critical. Process halts immediately. System may restart.
# A (Alert)     : Severe. Process fails, workflow stops. Human review needed.
# B (Block)     : Moderate. Transaction rolls back, but workflow can continue.
# C (Caution)   : Minor. Logged as warning. No interruption.
# I (Info)      : Purely informational. For monitoring/metrics.
#
# --- SUPPORTED CONDITIONS (Rust Core) ---
# min      : Value >= limit (numeric)
# max      : Value <= limit (numeric)
# eq       : Value == string (string comparison)
# neq      : Value != string (string comparison)
# min_len  : len(value) >= limit (for list/string)
# max_len  : len(value) <= limit (for list/string)
#
# --- DUAL THRESHOLD MECHANISM ---
# min_threshold : Counter value to START issuing warnings (Yellow Zone).
# max_threshold : Counter value to TRIGGER the action per Level (Red Zone).
# reset_on_success: If true, counter resets to 0 after a successful check.
#
# Example: min_threshold: 2, max_threshold: 5
#   - 0-1 violations: Silent.
#   - 2-4 violations: Warning logged.
#   - 5+  violations: Action triggered (e.g., Block for Level B).
# ================================================================

process_recipes:

  # --- BASIC EXAMPLE (Active) ---
  p_process:
    inputs:
      - field: "domain.status"
        eq: "READY"               # Must be exactly "READY" to proceed
        level: "B"                # Block if status is wrong
        message: "Process requires status to be READY."
    outputs:
      - field: "domain.processed_count"
        min: 0                    # Output must be non-negative
        level: "C"                # Just a warning

  p_unsafe_write:
    # No audit rules needed here. ContextGuard catches illegal writes first.
    # This placeholder exists purely for documentation purposes.
    inputs: []
    outputs: []

  # --- ADVANCED EXAMPLES (Commented) ---

  # Example 1: Dual Threshold with Accumulating Counter
  # -------------------------------------------------------
  # p_login_attempt:
  #   inputs:
  #     - field: "domain.user_id"
  #       min_len: 3              # User ID must be at least 3 chars
  #       level: "B"
  #   outputs:
  #     - field: "domain.failed_attempts"
  #       max: 5                  # Max 5 failed attempts
  #       level: "A"              # ALERT severity
  #       min_threshold: 3        # Start warning at 3 failures
  #       max_threshold: 5        # Trigger Alert at 5 failures
  #       reset_on_success: false # DO NOT reset on success (accumulate!)
  #       message: "Too many failed login attempts. Account locked."

  # Example 2: Inheritance (Reuse common rules)
  # -------------------------------------------------------
  # _base_financial:             # Prefix '_' for abstract/base template
  #   inputs:
  #     - field: "domain.amount"
  #       min: 0.01
  #       level: "B"
  #   outputs:
  #     - field: "domain.balance"
  #       min: 0
  #       level: "A"
  #       message: "Balance cannot go negative!"
  #
  # p_transfer:
  #   inherits: "_base_financial"  # Inherits all input/output rules
  #   side_effects: ["database", "notification"]
  #   errors: ["InsufficientFundsError", "TransferLimitExceeded"]

  # Example 3: Multiple Conditions on Same Field (Range Check)
  # -------------------------------------------------------
  # p_set_age:
  #   inputs:
  #     - field: "domain.age"
  #       min: 0                  # Rule 1: Must be >= 0
  #       max: 120                # Rule 2: Must be <= 120
  #       level: "B"              # Both share Level B
  #       message: "Age must be between 0 and 120."

  # Example 4: String Length Validation
  # -------------------------------------------------------
  # p_set_username:
  #   inputs:
  #     - field: "domain.username"
  #       min_len: 3              # At least 3 characters
  #       max_len: 20             # At most 20 characters
  #       level: "B"
  #       message: "Username must be 3-20 characters."

  # Example 5: Not Equal Check (Blacklist)
  # -------------------------------------------------------
  # p_set_status:
  #   inputs:
  #     - field: "domain.status"
  #       neq: "LOCKED"           # Status must NOT be "LOCKED"
  #       level: "A"
  #       message: "Cannot proceed while status is LOCKED."
