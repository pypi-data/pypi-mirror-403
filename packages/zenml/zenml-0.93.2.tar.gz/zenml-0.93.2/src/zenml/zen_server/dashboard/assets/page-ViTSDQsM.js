import{j as e}from"./@radix-Da0HZyg8.js";import{P as z,a as g,b as P}from"./react-resizable-panels.browser-BzyjP_NZ.js";import{S as R,a as L,L as I,h as T,b as V,g as k}from"./run-dag-BbRcfWXE.js";import{c as C,B as E,b5 as H,ad as _,b6 as F,e as p,an as B,aT as D,a4 as f,b4 as b,aW as A,aw as M,av as O,b7 as U,b8 as Z,b9 as G,ba as Q,bb as $}from"./index-5CE1yoTL.js";import{f as W,a as h,u as Y,L as N}from"./@react-router-BEwS6i40.js";import{z as q}from"./@zod-yP6IINRw.js";import{a as d}from"./@monaco-editor-xs6rrDBC.js";import{j as J}from"./@tanstack-BRZ8pkCt.js";import"./@elkjs-D2DP-mPJ.js";import"./Error-BhJ3dxQV.js";import"./expand-full-BzNS_BcJ.js";import"./download-01-DVCWPSnn.js";import"./SearchField-iVWx0Oy7.js";import"./alert-triangle-C7ryTF32.js";import"./check-DSoixTtU.js";import"./@reactflow-CEST3EX2.js";const K=q.string().uuid();function j(){const[t]=W(),r=t.get("step");if(!r)return null;const s=K.safeParse(r);return s.success?s.data:null}function X({className:t,children:r,...s}){return e.jsx("section",{className:C("flex items-center gap-1 border-b border-theme-border-moderate bg-theme-surface-primary p-5",t),...s,children:r})}const ee=t=>d.createElement("svg",{viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("path",{d:"M20 7.79981C20 6.94342 19.9997 6.36117 19.9629 5.91113C19.9271 5.47272 19.8619 5.2482 19.7822 5.0918C19.5905 4.71554 19.2845 4.40951 18.9082 4.21778C18.7518 4.13809 18.5273 4.07293 18.0889 4.03711C17.6388 4.00035 17.0566 4 16.2002 4H10V20H16.2002C17.0566 20 17.6388 19.9997 18.0889 19.9629C18.5273 19.9271 18.7518 19.8619 18.9082 19.7822C19.2845 19.5905 19.5905 19.2845 19.7822 18.9082C19.8619 18.7518 19.9271 18.5273 19.9629 18.0889C19.9997 17.6388 20 17.0566 20 16.2002V7.79981ZM4 16.2002C4 17.0566 4.00035 17.6388 4.03711 18.0889C4.07293 18.5273 4.13809 18.7518 4.21778 18.9082C4.40951 19.2845 4.71554 19.5905 5.0918 19.7822C5.2482 19.8619 5.47272 19.9271 5.91113 19.9629C6.36117 19.9997 6.94342 20 7.79981 20H8V4H7.79981C6.94342 4 6.36117 4.00035 5.91113 4.03711C5.47272 4.07293 5.2482 4.13809 5.0918 4.21778C4.71555 4.40951 4.40951 4.71555 4.21778 5.0918C4.13809 5.2482 4.07293 5.47272 4.03711 5.91113C4.00035 6.36117 4 6.94342 4 7.79981V16.2002ZM22 16.2002C22 17.0237 22.001 17.7016 21.9561 18.252C21.9101 18.814 21.8117 19.3311 21.5645 19.8164C21.181 20.5689 20.5689 21.181 19.8164 21.5645C19.3311 21.8117 18.814 21.9101 18.252 21.9561C17.7016 22.001 17.0237 22 16.2002 22H7.79981C6.97632 22 6.29843 22.001 5.74805 21.9561C5.18599 21.9101 4.6689 21.8117 4.1836 21.5645C3.43109 21.181 2.81902 20.5689 2.43555 19.8164C2.18827 19.3311 2.08988 18.814 2.04395 18.252C1.99898 17.7016 2 17.0237 2 16.2002V7.79981C2 6.97632 1.99898 6.29843 2.04395 5.74805C2.08988 5.18599 2.18827 4.6689 2.43555 4.1836C2.81902 3.43109 3.43109 2.81902 4.1836 2.43555C4.6689 2.18827 5.18599 2.08988 5.74805 2.04395C6.29843 1.99898 6.97632 2 7.79981 2H16.2002C17.0237 2 17.7016 1.99898 18.252 2.04395C18.814 2.08988 19.3311 2.18827 19.8164 2.43555C20.5689 2.81902 21.181 3.43109 21.5645 4.1836C21.8117 4.6689 21.9101 5.18599 21.9561 5.74805C22.001 6.29843 22 6.97632 22 7.79981V16.2002Z"}));function S({toggleSidebar:t}){return e.jsx(E,{intent:"secondary",emphasis:"minimal",className:"flex size-6 shrink-0 items-center justify-center p-0",onClick:t,children:e.jsx(ee,{className:"h-5 w-5 shrink-0 fill-theme-text-secondary"})})}function te({toggleSidebar:t}){const r=h(),{runId:s}=r,n=j();return e.jsxs(e.Fragment,{children:[e.jsx(X,{children:n?e.jsxs(e.Fragment,{children:[e.jsx(S,{toggleSidebar:t}),e.jsx(R,{stepId:n})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{toggleSidebar:t}),e.jsx(H,{runId:s})]})}),e.jsx("div",{className:"flex flex-1 flex-col p-5",children:n?e.jsx(L,{stepId:n}):e.jsx(I,{runId:s})})]})}function y({duration:t,icon:r,title:s,tooltip:n=typeof s=="string"?s:void 0,isActive:a}){return e.jsxs("div",{className:C("flex items-center gap-1 rounded-md border p-1 transition-colors duration-200 hover:bg-theme-surface-secondary",{"border-theme-border-moderate bg-theme-surface-secondary":a,"border-transparent":!a}),children:[r,e.jsx("span",{title:n,className:"truncate text-text-sm text-theme-text-primary",children:s}),t!==null&&e.jsx("span",{className:"ml-auto whitespace-nowrap text-text-xs text-theme-text-secondary",children:t})]})}function v({message:t}){return e.jsx("div",{className:"flex flex-1 px-3 pb-5",children:e.jsx("div",{className:"flex w-full flex-1 flex-col items-center justify-center gap-2 rounded-md border border-dashed border-theme-border-moderate text-center",children:e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:t})})})}function se(){const t=h(),{runId:r}=t,s=j(),n=Y().pathname,a=_({runId:r}),c=d.useMemo(()=>a.data?F(a.data.name,a.data.body?.index):"",[a.data]);if(a.isPending)return e.jsx(p,{className:"h-6 w-full"});if(a.isError)return e.jsx("div",{className:"px-3 py-2 text-text-xs text-theme-text-error",children:"Error loading run"});const l=a.data,m=l.metadata?.start_time&&l.metadata?.end_time?B(l.metadata.start_time,l.metadata.end_time):null;return e.jsx(N,{to:n,children:e.jsx(y,{duration:m,tooltip:c,icon:e.jsx(f,{status:l.body?.status,className:"size-4 flex-shrink-0"}),title:e.jsx(D,{name:l.name,index:l.body?.index}),isActive:s===null})})}function ae(t,r,s=52,n=5){const a=J({count:t.length,getScrollElement:()=>r.current,estimateSize:()=>s,overscan:n}),c=a.getVirtualItems();return{virtualizer:a,virtualItems:c,totalSize:a.getTotalSize(),startOffset:c[0]?.start??0}}function re({searchTerm:t,statusFilter:r}){const s=h(),{runId:n}=s,a=T({runId:n},{refetchInterval:i=>i.state.data?.status==="running"||i.state.data?.status==="initializing"||i.state.data?.status==="provisioning"?3e3:!1});if(a.isPending)return e.jsxs("div",{className:"space-y-2 px-3",children:[e.jsx(p,{className:"h-6 w-full"}),e.jsx(p,{className:"h-6 w-full"}),e.jsx(p,{className:"h-6 w-full"}),e.jsx(p,{className:"h-6 w-full"})]});if(a.isError)return e.jsx("div",{children:"Error loading DAG"});const c=a.data,l=V(c.nodes).sort((i,o)=>{const u=i.metadata.start_time?b(i.metadata.start_time):void 0,x=o.metadata.start_time?b(o.metadata.start_time):void 0;return!u&&!x?0:u?x?u.getTime()-x.getTime():-1:1});if(l.length===0)return e.jsx(v,{message:"No steps found."});const m=l.filter(i=>i.name.toLowerCase().includes(t.toLowerCase())).filter(i=>r==="all"||i.metadata.status===r);return m.length===0?e.jsx(v,{message:"No steps match your filters."}):e.jsx(ne,{steps:m,runStatus:c.status})}function ne({steps:t,runStatus:r}){const s=j(),n=d.useRef(null),{virtualizer:a,virtualItems:c,totalSize:l,startOffset:m}=ae(t,n);return e.jsx("div",{ref:n,className:"flex-1 overflow-auto",children:e.jsx("div",{style:{height:l,width:"100%",position:"relative"},children:e.jsx("div",{className:"space-y-1 px-3 pb-5",style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${m}px)`},children:c.map(i=>{const o=t[i.index],u=s===o.id,x=k(o.metadata.status,r),w=o.metadata.duration!==void 0&&o.metadata.duration!==null?A(o.metadata.duration):null;return e.jsx("div",{"data-index":i.index,ref:a.measureElement,children:e.jsx(N,{to:`?step=${o.id}`,children:e.jsx(y,{duration:w,icon:e.jsx(f,{className:"size-4 shrink-0",status:x?"unknown":o.metadata.status}),title:o.name,isActive:u})})},i.key)})})})})}const ie=[{value:"all",label:"All"},{value:"completed",label:"Completed"},{value:"failed",label:"Failed"},{value:"running",label:"Running"},{value:"cached",label:"Cached"},{value:"stopped",label:"Stopped"},{value:"retried",label:"Retried"},{value:"initializing",label:"Initializing"}];function le({searchTerm:t,setSearchTerm:r,statusFilter:s,setStatusFilter:n}){return e.jsxs("section",{className:"flex items-center gap-1",children:[e.jsxs("div",{className:"relative w-3/5",children:[e.jsx(M,{inputSize:"sm",value:t,onChange:r,placeholder:"Find step",className:"w-full pl-[36px]"}),e.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-1",children:e.jsx(O,{className:"size-4 fill-neutral-400"})})]}),e.jsxs(U,{value:s,onValueChange:a=>n(a),children:[e.jsx(Z,{className:"h-6 flex-1 truncate border border-theme-border-moderate text-text-sm",children:e.jsx("span",{className:"truncate",children:e.jsx(G,{placeholder:"All"})})}),e.jsx(Q,{children:ie.map(a=>e.jsx($,{value:a.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[a.value!=="all"&&e.jsx(f,{className:"size-4 shrink-0 animate-none",status:a.value}),e.jsx("span",{className:"truncate",children:a.label})]})},a.value))})]})]})}function oe(){const[t,r]=d.useState(""),[s,n]=d.useState("all");return e.jsxs("div",{className:"flex h-full flex-col bg-theme-surface-primary pt-5",children:[e.jsx("div",{className:"mb-3 px-3",children:e.jsx(le,{searchTerm:t,setSearchTerm:r,statusFilter:s,setStatusFilter:n})}),e.jsxs("div",{className:"px-3",children:[e.jsx("h3",{className:"mb-2 text-text-xs font-semibold text-theme-text-tertiary",children:"RUN"}),e.jsx(se,{})]}),e.jsxs("div",{className:"flex min-h-0 flex-1 flex-col",children:[e.jsx("div",{className:"px-4 py-3",children:e.jsx("h3",{className:"text-text-xs font-semibold text-theme-text-tertiary",children:"STEPS"})}),e.jsx(re,{statusFilter:s,searchTerm:t})]})]})}function we(){const t=d.useRef(null);function r(){const s=t.current;s&&(s.isCollapsed()?s.expand():s.collapse())}return e.jsx(e.Fragment,{children:e.jsxs(z,{direction:"horizontal",className:"relative flex w-full",children:[e.jsx(g,{collapsible:!0,ref:t,className:"bg-theme-surface-primary",minSize:10,maxSize:40,defaultSize:20,children:e.jsx(oe,{})}),e.jsx(P,{className:"w-[1px] bg-theme-border-moderate transition-colors duration-200 data-[resize-handle-state=drag]:bg-theme-border-bold data-[resize-handle-state=hover]:bg-theme-border-bold"}),e.jsx(g,{collapsible:!0,className:"flex flex-col !overflow-y-auto",minSize:25,defaultSize:80,children:e.jsx(te,{toggleSidebar:r})})]})})}export{we as default};
