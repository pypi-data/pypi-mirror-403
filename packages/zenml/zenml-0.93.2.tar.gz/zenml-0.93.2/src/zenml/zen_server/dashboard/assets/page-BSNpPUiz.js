import{j as t}from"./@radix-Da0HZyg8.js";import{u as N,W as We,L as $e}from"./LeftSideMenu-DjShBhjG.js";import{a as p}from"./@monaco-editor-xs6rrDBC.js";import{W as A,H as I,B as O}from"./Wizard-BgzMaaqV.js";import{z as y,a as v,C as P,u as V,t as q,F as W}from"./@zod-yP6IINRw.js";import{e as G,s as He,I as ye,B as D,bO as ze,b7 as Ze,b8 as Ue,b9 as Ke,ba as Qe,bc as Ge,bb as Ye,bv as Je,bx as Xe,D as et,bL as tt,c0 as rt,aI as st,F as nt,G as ot,H as it,J as at,x as Ae,y as ct,A as lt,h as ut,aj as dt,r as ft}from"./index-5CE1yoTL.js";import{S as E}from"./WizardFooter-DTOvO-Xx.js";import{C as ge}from"./ComponentIcon-B7M5n_Xi.js";import{R as H,a as Z,s as mt}from"./common-BrpKozbR.js";import{f as ht}from"./index-p-TDI5a2.js";import{b as Y,c as xt,l as Ie,e as pt}from"./@tanstack-BRZ8pkCt.js";import{g as yt,S as gt,C as ne,P as oe}from"./ProviderRadio-x4Ed2OfG.js";import{S as jt}from"./transform-pqykL0RU.js";import{C as R}from"./ProviderIcon-CIghFWTD.js";import{g as _t,a as vt,D as St,b as bt,z as Ct}from"./form-BPcAENG-.js";import{s as wt}from"./sharedSchema-g4P6EjKg.js";import{S as Nt}from"./Lock-BrNKO9KL.js";import{T as je}from"./Tick-hfrBQLs_.js";import{s as Oe}from"./index-DBB4a7BM.js";import{u as Pt}from"./create-stack-CF3lJBA7.js";import{C as Ft}from"./ComponentBadge-2JXtTfNH.js";import{e as kt}from"./components-Br2ezRib.js";import{L as zt}from"./@react-router-BEwS6i40.js";import"./@elkjs-D2DP-mPJ.js";import"./@reactflow-CEST3EX2.js";import"./bar-chart-square-check-DzUJ9YmH.js";import"./layout-2GM5rzX8.js";import"./persist-BaCE040n.js";import"./index.es-BLCCg0nE.js";import"./check-DSoixTtU.js";import"./stack-detail-query-D9Y3CiUb.js";const De=p.createContext(null);function At({children:e}){const[r,s]=p.useState({stackName:null,createdStackId:null,connectorConfig:null,fullstackResources:null,artifactStoreConfig:null,registryConfig:null,orchestratorConfig:null});return t.jsx(De.Provider,{value:{data:r,setData:s},children:e})}function S(){const e=p.useContext(De);if(e===null)throw new Error("useExistingInfraContext must be used within an ExistingInfraProvider");return e}const Ee=p.createContext(null);function Se({children:e,initialSchema:r}){const[s,n]=p.useState(r),[o,c]=p.useState({});return t.jsx(Ee.Provider,{value:{schema:s,setSchema:n,defaultValues:o,setDefaultValues:c},children:e})}function J(){const e=p.useContext(Ee);if(!e)throw new Error("useSchemaContext must be used within a SchemaProvider");return e}const It=y.object({resourceId:y.string().min(1),flavor:y.string()});function Ot(){return t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{className:"flex items-center gap-1 text-text-lg font-semibold",children:[t.jsx(ge,{type:"artifact_store",className:"h-5 w-5 fill-primary-400"}),"Select your Artifact Store"]}),t.jsx("p",{className:"text-theme-text-secondary",children:"Choose one of the storages for the new Artifact Store."})]})}var Me=Symbol.for("immer-nothing"),be=Symbol.for("immer-draftable"),g=Symbol.for("immer-state");function _(e,...r){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var F=Object.getPrototypeOf;function k(e){return!!e&&!!e[g]}function C(e){return e?Re(e)||Array.isArray(e)||!!e[be]||!!e.constructor?.[be]||ee(e)||te(e):!1}var Dt=Object.prototype.constructor.toString();function Re(e){if(!e||typeof e!="object")return!1;const r=F(e);if(r===null)return!0;const s=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return s===Object?!0:typeof s=="function"&&Function.toString.call(s)===Dt}function U(e,r){X(e)===0?Reflect.ownKeys(e).forEach(s=>{r(s,e[s],e)}):e.forEach((s,n)=>r(n,s,e))}function X(e){const r=e[g];return r?r.type_:Array.isArray(e)?1:ee(e)?2:te(e)?3:0}function ue(e,r){return X(e)===2?e.has(r):Object.prototype.hasOwnProperty.call(e,r)}function Le(e,r,s){const n=X(e);n===2?e.set(r,s):n===3?e.add(s):e[r]=s}function Et(e,r){return e===r?e!==0||1/e===1/r:e!==e&&r!==r}function ee(e){return e instanceof Map}function te(e){return e instanceof Set}function b(e){return e.copy_||e.base_}function de(e,r){if(ee(e))return new Map(e);if(te(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const s=Re(e);if(r===!0||r==="class_only"&&!s){const n=Object.getOwnPropertyDescriptors(e);delete n[g];let o=Reflect.ownKeys(n);for(let c=0;c<o.length;c++){const l=o[c],u=n[l];u.writable===!1&&(u.writable=!0,u.configurable=!0),(u.get||u.set)&&(n[l]={configurable:!0,writable:!0,enumerable:u.enumerable,value:e[l]})}return Object.create(F(e),n)}else{const n=F(e);if(n!==null&&s)return{...e};const o=Object.create(n);return Object.assign(o,e)}}function _e(e,r=!1){return re(e)||k(e)||!C(e)||(X(e)>1&&(e.set=e.add=e.clear=e.delete=Mt),Object.freeze(e),r&&Object.entries(e).forEach(([s,n])=>_e(n,!0))),e}function Mt(){_(2)}function re(e){return Object.isFrozen(e)}var Rt={};function w(e){const r=Rt[e];return r||_(0,e),r}var L;function Te(){return L}function Lt(e,r){return{drafts_:[],parent_:e,immer_:r,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Ce(e,r){r&&(w("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=r)}function fe(e){me(e),e.drafts_.forEach(Tt),e.drafts_=null}function me(e){e===L&&(L=e.parent_)}function we(e){return L=Lt(L,e)}function Tt(e){const r=e[g];r.type_===0||r.type_===1?r.revoke_():r.revoked_=!0}function Ne(e,r){r.unfinalizedDrafts_=r.drafts_.length;const s=r.drafts_[0];return e!==void 0&&e!==s?(s[g].modified_&&(fe(r),_(4)),C(e)&&(e=K(r,e),r.parent_||Q(r,e)),r.patches_&&w("Patches").generateReplacementPatches_(s[g].base_,e,r.patches_,r.inversePatches_)):e=K(r,s,[]),fe(r),r.patches_&&r.patchListener_(r.patches_,r.inversePatches_),e!==Me?e:void 0}function K(e,r,s){if(re(r))return r;const n=r[g];if(!n)return U(r,(o,c)=>Pe(e,n,r,o,c,s)),r;if(n.scope_!==e)return r;if(!n.modified_)return Q(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const o=n.copy_;let c=o,l=!1;n.type_===3&&(c=new Set(o),o.clear(),l=!0),U(c,(u,m)=>Pe(e,n,o,u,m,s,l)),Q(e,o,!1),s&&e.patches_&&w("Patches").generatePatches_(n,s,e.patches_,e.inversePatches_)}return n.copy_}function Pe(e,r,s,n,o,c,l){if(k(o)){const u=c&&r&&r.type_!==3&&!ue(r.assigned_,n)?c.concat(n):void 0,m=K(e,o,u);if(Le(s,n,m),k(m))e.canAutoFreeze_=!1;else return}else l&&s.add(o);if(C(o)&&!re(o)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;K(e,o),(!r||!r.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(s,n)&&Q(e,o)}}function Q(e,r,s=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&_e(r,s)}function Bt(e,r){const s=Array.isArray(e),n={type_:s?1:0,scope_:r?r.scope_:Te(),modified_:!1,finalized_:!1,assigned_:{},parent_:r,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let o=n,c=ve;s&&(o=[n],c=T);const{revoke:l,proxy:u}=Proxy.revocable(o,c);return n.draft_=u,n.revoke_=l,u}var ve={get(e,r){if(r===g)return e;const s=b(e);if(!ue(s,r))return Vt(e,s,r);const n=s[r];return e.finalized_||!C(n)?n:n===ie(e.base_,r)?(ae(e),e.copy_[r]=xe(n,e)):n},has(e,r){return r in b(e)},ownKeys(e){return Reflect.ownKeys(b(e))},set(e,r,s){const n=Be(b(e),r);if(n?.set)return n.set.call(e.draft_,s),!0;if(!e.modified_){const o=ie(b(e),r),c=o?.[g];if(c&&c.base_===s)return e.copy_[r]=s,e.assigned_[r]=!1,!0;if(Et(s,o)&&(s!==void 0||ue(e.base_,r)))return!0;ae(e),he(e)}return e.copy_[r]===s&&(s!==void 0||r in e.copy_)||Number.isNaN(s)&&Number.isNaN(e.copy_[r])||(e.copy_[r]=s,e.assigned_[r]=!0),!0},deleteProperty(e,r){return ie(e.base_,r)!==void 0||r in e.base_?(e.assigned_[r]=!1,ae(e),he(e)):delete e.assigned_[r],e.copy_&&delete e.copy_[r],!0},getOwnPropertyDescriptor(e,r){const s=b(e),n=Reflect.getOwnPropertyDescriptor(s,r);return n&&{writable:!0,configurable:e.type_!==1||r!=="length",enumerable:n.enumerable,value:s[r]}},defineProperty(){_(11)},getPrototypeOf(e){return F(e.base_)},setPrototypeOf(){_(12)}},T={};U(ve,(e,r)=>{T[e]=function(){return arguments[0]=arguments[0][0],r.apply(this,arguments)}});T.deleteProperty=function(e,r){return T.set.call(this,e,r,void 0)};T.set=function(e,r,s){return ve.set.call(this,e[0],r,s,e[0])};function ie(e,r){const s=e[g];return(s?b(s):e)[r]}function Vt(e,r,s){const n=Be(r,s);return n?"value"in n?n.value:n.get?.call(e.draft_):void 0}function Be(e,r){if(!(r in e))return;let s=F(e);for(;s;){const n=Object.getOwnPropertyDescriptor(s,r);if(n)return n;s=F(s)}}function he(e){e.modified_||(e.modified_=!0,e.parent_&&he(e.parent_))}function ae(e){e.copy_||(e.copy_=de(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var qt=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(r,s,n)=>{if(typeof r=="function"&&typeof s!="function"){const c=s;s=r;const l=this;return function(m=c,...d){return l.produce(m,i=>s.call(this,i,...d))}}typeof s!="function"&&_(6),n!==void 0&&typeof n!="function"&&_(7);let o;if(C(r)){const c=we(this),l=xe(r,void 0);let u=!0;try{o=s(l),u=!1}finally{u?fe(c):me(c)}return Ce(c,n),Ne(o,c)}else if(!r||typeof r!="object"){if(o=s(r),o===void 0&&(o=r),o===Me&&(o=void 0),this.autoFreeze_&&_e(o,!0),n){const c=[],l=[];w("Patches").generateReplacementPatches_(r,o,c,l),n(c,l)}return o}else _(1,r)},this.produceWithPatches=(r,s)=>{if(typeof r=="function")return(l,...u)=>this.produceWithPatches(l,m=>r(m,...u));let n,o;return[this.produce(r,s,(l,u)=>{n=l,o=u}),n,o]},typeof e?.autoFreeze=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof e?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){C(e)||_(8),k(e)&&(e=Wt(e));const r=we(this),s=xe(e,void 0);return s[g].isManual_=!0,me(r),s}finishDraft(e,r){const s=e&&e[g];(!s||!s.isManual_)&&_(9);const{scope_:n}=s;return Ce(n,r),Ne(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,r){let s;for(s=r.length-1;s>=0;s--){const o=r[s];if(o.path.length===0&&o.op==="replace"){e=o.value;break}}s>-1&&(r=r.slice(s+1));const n=w("Patches").applyPatches_;return k(e)?n(e,r):this.produce(e,o=>n(o,r))}};function xe(e,r){const s=ee(e)?w("MapSet").proxyMap_(e,r):te(e)?w("MapSet").proxySet_(e,r):Bt(e,r);return(r?r.scope_:Te()).drafts_.push(s),s}function Wt(e){return k(e)||_(10,e),Ve(e)}function Ve(e){if(!C(e)||re(e))return e;const r=e[g];let s;if(r){if(!r.modified_)return r.base_;r.finalized_=!0,s=de(e,r.scope_.immer_.useStrictShallowCopy_)}else s=de(e,!0);return U(s,(n,o)=>{Le(s,n,Ve(o))}),r&&(r.finalized_=!1),s}var j=new qt,z=j.produce;j.produceWithPatches.bind(j);j.setAutoFreeze.bind(j);j.setUseStrictShallowCopy.bind(j);j.applyPatches.bind(j);j.createDraft.bind(j);j.finishDraft.bind(j);function $t(){const{data:e,setData:r}=S(),{setCurrentStep:s}=N();if(!e.fullstackResources)return s(2),{handleFormSubmit:()=>{},flattenedInstances:[]};const n=e.fullstackResources.components_resources_info.artifact_store,o=n.flatMap(l=>l.accessible_by_service_connector.map(u=>({...l,value:u})));function c({flavor:l,resourceId:u}){const m=n.find(d=>d.flavor===l);m&&(r(d=>z(d,i=>{i.artifactStoreConfig={flavor:l,configuration:Object.fromEntries(Object.keys(m.required_configuration||{}).map(f=>[f,u])),service_connector_resource_id:u}})),s(d=>d+1))}return{handleFormSubmit:c,flattenedInstances:o}}function B({flavor:e,type:r,width:s=32,height:n=32,...o}){const c=Y({...ht.flavorList({name:e,type:r})});return c.isError?null:c.isPending?t.jsx(G,{style:{height:`${n}px`,width:`${s}px`}}):t.jsx("img",{width:s,height:n,alt:`${e} logo`,...o,src:He(c.data.items[0].body?.logo_url??"")})}const Ht="artifact_store";function Zt(){const[e,r]=p.useState(""),{control:s,setValue:n,handleSubmit:o,register:c,watch:l,trigger:u,reset:m}=v(),{flattenedInstances:d,handleFormSubmit:i}=$t(),f=d.filter(a=>a.value.toLocaleLowerCase().includes(e.toLocaleLowerCase()));return t.jsxs(t.Fragment,{children:[t.jsx(ye,{placeholder:"Search...",onChange:a=>{m(),r(a.target.value)}}),t.jsxs("form",{onSubmit:o(i),id:"artifact-store-form",children:[t.jsx("input",{type:"hidden",...c("flavor")}),t.jsx("ul",{className:"space-y-1",children:f.map(a=>t.jsx("li",{children:t.jsx(P,{name:"resourceId",control:s,render:({field:{onChange:h,...x}})=>t.jsxs(H,{"data-state":l("resourceId")===a.value?"selected":"unselected",htmlFor:a.value,children:[t.jsx(Z,{id:a.value,type:"radio",...x,onChange:M=>{n("flavor",a.flavor,{shouldValidate:!0,shouldDirty:!0,shouldTouch:!0}),h(M.target.value),u()},value:a.value,name:"connector-radio"}),t.jsx(B,{type:Ht,width:24,height:24,flavor:a.flavor})," ",t.jsx("span",{children:a.value})]})})},a.value))})]})]})}function Ut(){const e=V({resolver:q(It),shouldUnregister:!0});return t.jsx(W,{...e,children:t.jsxs(A,{children:[t.jsx(I,{children:"Artifact Store"}),t.jsx(O,{children:t.jsxs("section",{className:"space-y-5 py-5 first:pt-0 last:pb-0",children:[t.jsx(Ot,{}),t.jsx(Zt,{})]})}),t.jsx(E,{children:t.jsx(Kt,{})})]})})}function Kt(){const e=v();return t.jsx(D,{disabled:!e.formState.isValid,form:"artifact-store-form",size:"md",children:"Next"})}const qe=y.object({authMethod:y.string().min(1),stackName:wt()});function Qt(){const{data:e}=S(),{setCurrentStep:r}=N(),{control:s,watch:n,resetField:o}=v(),{setSchema:c,setDefaultValues:l}=J(),u=Y({...ze.serviceConnectorTypeDetail(e.connectorConfig?.type||"")});if(u.isError)return null;if(u.isPending)return t.jsx(G,{className:"h-[40px] w-[100px]"});const m=u.data.auth_methods.filter(f=>f.auth_method!=="implicit").map(f=>({name:f.name,auth_method:f.auth_method}));if(!e.connectorConfig?.type){r(1);return}function d(){const f=n("authMethod"),a=u.data?.auth_methods.find(se=>se.auth_method===f);if(!a)return;const h=a.config_schema,x=_t(h),M=vt(h);c(qe.merge(x)),l(M),Object.keys(x.shape).forEach(se=>o(se))}const i=e.connectorConfig.type||"";return t.jsx(P,{control:s,name:"authMethod",render:({field:{onChange:f,ref:a,...h}})=>t.jsxs(Ze,{...h,onValueChange:x=>{f(x),d()},children:[t.jsx(Ue,{className:"w-fit border border-neutral-300 text-left text-text-md",children:t.jsx(Ke,{className:"flex items-center gap-2",placeholder:"Select your Auth Method"})}),t.jsx(Qe,{children:t.jsx(Ge,{viewportClassName:"max-h-[300px]",children:m.map(x=>t.jsx(Ye,{className:"space-x-2",value:x.auth_method,children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(R,{provider:i}),t.jsx("div",{children:x.name})]})},x.auth_method))})})]})})}function Gt(){return t.jsxs("section",{className:"space-y-5 py-5 first:pt-0 last:pb-0",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{className:"flex items-center gap-1 text-text-lg font-semibold",children:[t.jsx(jt,{className:"h-5 w-5 fill-primary-400"}),"Select an Authentication Method"]}),t.jsx("p",{className:"text-theme-text-secondary",children:"Connect ZenML to your resources for seamless integration of cloud services into your ML pipelines."})]}),t.jsx(Qt,{})]})}function Yt(){return t.jsxs("section",{className:"space-y-5 py-5 first:pt-0 last:pb-0",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{className:"flex items-center gap-1 text-text-lg font-semibold",children:[t.jsx(Nt,{className:"h-5 w-5 fill-primary-400"}),"Add your Configuration"]}),t.jsx("p",{className:"text-theme-text-secondary",children:"Your credentials are securely stored and encrypted. ZenML uses these credentials to interact with your resources."})]}),t.jsx(Jt,{})]})}function Jt(){const{data:e}=S(),{watch:r}=v(),s=Y({...ze.serviceConnectorTypeDetail(e.connectorConfig?.type||"")}),n=r("authMethod"),o=s.data?.auth_methods.find(i=>i.auth_method===n);if(s.isError)return null;if(s.isPending)return t.jsx(G,{className:"h-[200px] w-full"});if(!o)return null;const c=o.config_schema,l=c.properties||{},u=c.required||[],m=c.$defs,d=Object.entries(l).sort(([i],[f])=>u.includes(i)&&!u.includes(f)?-1:!u.includes(i)&&u.includes(f)?1:0);return t.jsx("div",{className:"space-y-5",children:d.map(([i,f])=>t.jsx(St,{definitions:m,isOptional:bt(i,u),name:i,schema:f},i))})}function Xt({open:e,loadingComponents:r}){const{data:s}=S();return s.connectorConfig?.type?t.jsx(Je,{open:e,children:t.jsxs(Xe,{onPointerDownOutside:n=>n.preventDefault(),onEscapeKeyDown:n=>n.preventDefault(),className:"max-w-[600px]",children:[t.jsx("div",{className:"flex items-center justify-between border-b border-theme-border-moderate py-2 pl-5 pr-3",children:t.jsx(et,{className:"text-text-lg",children:"Connecting and loading your components..."})}),t.jsxs("div",{className:"flex h-[200px] items-center justify-center gap-5 bg-primary-50",children:[t.jsx(tt,{className:"h-[60px] w-[60px]"}),t.jsx("div",{className:"flex h-[60px] w-[60px] items-center justify-center",children:t.jsx(rt,{className:"h-5 w-5 fill-theme-text-tertiary"})}),t.jsx(R,{className:"h-[60px] w-[60px]",provider:s.connectorConfig.type})]}),t.jsxs("div",{className:"flex flex-col gap-1 px-7 pb-6 pt-5",children:[t.jsxs("p",{className:"text-theme-text-secondary",children:["We're securely connecting to ",yt(s.connectorConfig?.type||"aws")," ","and retrieving your custom components. This process typically takes about 30-60 seconds."]}),t.jsx(er,{loadingComponents:r})]})]})}):null}function er({loadingComponents:e}){const[r,s]=p.useState(!0),[n,o]=p.useState(!0);return p.useEffect(()=>{const c=setTimeout(()=>{s(!1)},Math.floor(Math.random()*1e3)+500),l=setTimeout(()=>{o(!1)},1500);return()=>{clearTimeout(c),clearTimeout(l)}},[]),t.jsxs("ul",{className:"mt-3 space-y-3 text-theme-text-secondary",children:[t.jsxs(le,{children:[t.jsx(ce,{loading:r}),"Establishing a secure connection"]}),t.jsxs(le,{children:[t.jsx(ce,{loading:n}),"Authenticating your account"]}),t.jsxs(le,{children:[t.jsx(ce,{loading:e}),"Fetching your existing components"]})]})}function ce({loading:e}){return e?t.jsx(st,{className:"h-5 w-5 border-2"}):t.jsx(je,{className:"h-5 w-5",tickClasses:"w-3 h-3"})}function le({children:e}){return t.jsx("li",{className:"flex items-center gap-1",children:e})}async function tr({payload:e}){const r=ot(at.serviceConnectors.fullStackResources),s=await nt(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const n=await s.json().then(o=>Array.isArray(o.detail)?o.detail[1]:o.detail).catch(()=>"Error while fetching service connector type");throw new it({status:s.status,statusText:s.statusText,message:n})}return s.json()}function rr(e){return xt({...e,mutationFn:async({payload:r})=>tr({payload:r})})}function sr(){const{setCurrentStep:e}=N(),[r,s]=p.useState(!0),{toast:n}=Ae(),{setData:o,data:c}=S(),l=rr({onSuccess:async m=>{o(d=>z(d,i=>{i.fullstackResources=m})),s(!1),await mt(200),e(d=>d+1)},onError:m=>{n({status:"error",emphasis:"subtle",description:m.message,rounded:!0})}});return{handleFormSubmit:({authMethod:m,stackName:d,...i})=>{Object.keys(i).forEach(a=>{(i[a]===""||i[a]===null||i[a]===void 0||Array.isArray(i[a])&&i[a].length===0)&&delete i[a]});const f=z(c,a=>{a.stackName=d,a.connectorConfig&&(a.connectorConfig.auth_method=m,a.connectorConfig.configuration={...i})});o(f),f.connectorConfig&&l.mutate({payload:f.connectorConfig})},fullStackResources:l,loadingComponents:r}}function nr(){const{handleSubmit:e,formState:{isSubmitting:r}}=v(),{handleFormSubmit:s,fullStackResources:n,loadingComponents:o}=sr();return t.jsxs("form",{onSubmit:e(s),id:"connect-form",children:[t.jsx(Xt,{loadingComponents:o,open:r||n.isPending}),t.jsx(Gt,{}),t.jsx(gt,{}),t.jsx(Yt,{})]})}function or(){const{schema:e,defaultValues:r}=J(),s=V({shouldUnregister:!0,mode:"onChange",resolver:q(e),defaultValues:{stackName:"",authMethod:"",...r}});return t.jsx(W,{...s,children:t.jsxs(A,{children:[t.jsx(I,{children:"Connect to your Cloud"}),t.jsx(O,{children:t.jsx(nr,{})}),t.jsx(E,{children:t.jsx(ir,{})})]})})}function ir(){const{formState:{isValid:e,isSubmitting:r}}=v(),s=!!Ie();return t.jsx(D,{className:"justify-center gap-2",disabled:!e||s||r,form:"connect-form",size:"md",children:s||r?"Loading...":"Next"})}function ar(){const{data:e,setData:r}=S(),s=pt(),{toast:n}=Ae(),{setCurrentStep:o}=N(),{mutate:c}=Pt({onError:d=>{d instanceof Error&&n({status:"error",emphasis:"subtle",icon:t.jsx(ct,{className:"h-5 w-5 shrink-0 fill-error-700"}),description:d.message,rounded:!0})},onSuccess:async d=>{r(i=>z(i,f=>{f.createdStackId=d.id})),o(i=>i+1),s.invalidateQueries({queryKey:Oe.all})}});if(!e.fullstackResources)return o(2),{handleFormSubmit:()=>{},flattenedInstances:[]};const l=e.fullstackResources.components_resources_info.container_registry,u=l.flatMap(d=>d.accessible_by_service_connector.map(i=>({...d,value:i})));function m({flavor:d,resourceId:i}){const f=l.find(h=>h.flavor===d);if(!f)return;const a=z(e,h=>{h.registryConfig={flavor:d,configuration:Object.fromEntries(Object.keys(f.required_configuration||{}).map(x=>[x,i])),service_connector_resource_id:i}});r(a),c({payload:{name:a.stackName||Math.random().toString(36).substring(7),service_connectors:a.connectorConfig?[a.connectorConfig]:[],components:{orchestrator:[{...a.orchestratorConfig,service_connector_index:0}],artifact_store:[{...a.artifactStoreConfig,service_connector_index:0}],container_registry:[{...a.registryConfig,service_connector_index:0}]}}})}return{handleFormSubmit:m,flattenedInstances:u}}const cr="container_registry";function lr(){const[e,r]=p.useState(""),{control:s,setValue:n,handleSubmit:o,register:c,watch:l,trigger:u,reset:m}=v(),{flattenedInstances:d,handleFormSubmit:i}=ar(),f=d.filter(a=>a.value.toLocaleLowerCase().includes(e.toLocaleLowerCase()));return t.jsxs(t.Fragment,{children:[t.jsx(ye,{placeholder:"Search...",onChange:a=>{m(),r(a.target.value)}}),t.jsxs("form",{onSubmit:o(i),id:"artifact-store-form",children:[t.jsx("input",{type:"hidden",...c("flavor")}),t.jsx("ul",{className:"space-y-1",children:f.map(a=>t.jsx("li",{children:t.jsx(P,{name:"resourceId",control:s,render:({field:{onChange:h,...x}})=>t.jsxs(H,{"data-state":l("resourceId")===a.value?"selected":"unselected",htmlFor:a.value,children:[t.jsx(Z,{id:a.value,type:"radio",...x,onChange:M=>{n("flavor",a.flavor,{shouldValidate:!0,shouldDirty:!0,shouldTouch:!0}),h(M.target.value),u()},value:a.value,name:"connector-radio"}),t.jsx(B,{width:24,height:24,type:cr,flavor:a.flavor})," ",t.jsx("span",{children:a.value})]})})},a.value))})]})]})}function ur(){return t.jsx("section",{className:"space-y-5 py-5 first:pt-0 last:pb-0",children:t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{className:"flex items-center gap-1 text-text-lg font-semibold",children:[t.jsx(ge,{type:"container_registry",className:"h-5 w-5 fill-primary-400"}),"Select your Container Registry"]}),t.jsx("p",{className:"text-theme-text-secondary",children:"Select one of the Container Registries for your new stack"})]})})}const dr=y.object({flavor:y.string().min(1),resourceId:y.string().min(1)});function fr(){const e=V({resolver:q(dr),shouldUnregister:!0});return t.jsx(W,{...e,children:t.jsxs(A,{children:[t.jsx(I,{children:"Container Registry"}),t.jsx(O,{children:t.jsxs("section",{className:"space-y-5 py-5 first:pt-0 last:pb-0",children:[t.jsx(ur,{}),t.jsx(lr,{})]})}),t.jsx(E,{children:t.jsx(mr,{})})]})})}function mr(){const e=v(),r=!!Ie();return t.jsxs(D,{className:"justify-center gap-2",disabled:!e.formState.isValid||r,form:"artifact-store-form",size:"md",children:[r&&t.jsx("div",{role:"alert","aria-busy":"true",className:"full h-[20px] w-[20px] animate-spin rounded-rounded border-2 border-theme-text-negative border-b-theme-text-brand"}),r?"Loading...":"Next"]})}function hr(){const{data:e,setData:r}=S(),{setCurrentStep:s}=N();if(!e.fullstackResources)return s(2),{orchestrators:[],handleFormSubmit:()=>{}};const n=e.fullstackResources.components_resources_info?.orchestrator||[];function o({flavor:c,resourceId:l,...u}){const m=n.find(d=>d.flavor===c);m&&(r(d=>{const i=m?.use_resource_value_as_fixed_config?Object.fromEntries(Object.keys(m.required_configuration||{}).map(f=>[f,l])):{...u};return z(d,f=>{f.orchestratorConfig={flavor:c,configuration:i,service_connector_resource_id:l}})}),s(d=>d+1))}return{orchestrators:n,handleFormSubmit:o}}const pe=y.object({flavor:y.string().min(1),resourceId:y.string().min(1)}),$="kubernetes",Fe="orchestrator";function xr(){const{orchestrators:e,handleFormSubmit:r}=hr(),{setSchema:s}=J(),{control:n,watch:o,setValue:c,register:l,reset:u,handleSubmit:m}=v(),d=o("flavor");return t.jsxs("form",{onSubmit:m(r),id:"artifact-store-form",children:[d!==$&&t.jsx("input",{...l("resourceId"),type:"hidden"}),t.jsx("ul",{className:"space-y-1",children:e.map((i,f)=>t.jsxs("li",{children:[t.jsx(P,{control:n,name:"flavor",render:({field:{onChange:a,...h}})=>t.jsxs(H,{"data-state":d===i.flavor?"selected":"unselected",htmlFor:i.flavor,children:[t.jsx(Z,{onChange:x=>{u({flavor:i.flavor}),i.use_resource_value_as_fixed_config===!0&&s(pe),i.use_resource_value_as_fixed_config===!1&&i.required_configuration&&s(pe.merge(Ct(i.required_configuration))),i.flavor!==$&&i.accessible_by_service_connector.length>0&&c("resourceId",i.accessible_by_service_connector[0]),a(x)},...h,id:i.flavor,type:"radio",value:i.flavor,name:"orchestrator-flavor-radio"}),t.jsx(B,{width:24,height:24,type:Fe,flavor:i.flavor}),t.jsx("span",{children:i.flavor_display_name})]})}),d===i.flavor&&(i.flavor===$||i.use_resource_value_as_fixed_config===!1)&&t.jsxs("div",{className:"space-y-3 py-5 pl-8",children:[i.flavor===$&&t.jsx("ul",{className:"space-y-1",children:i.accessible_by_service_connector.map(a=>t.jsx("li",{children:t.jsx(P,{control:n,name:"resourceId",render:({field:h})=>t.jsxs(H,{"data-state":o("resourceId")===a?"selected":"unselected",htmlFor:a,children:[t.jsx(Z,{...h,id:a,type:"radio",value:a,name:"instance-radio"}),t.jsx(B,{type:Fe,width:24,height:24,flavor:i.flavor}),t.jsx("span",{children:a})]})})},a))}),i.use_resource_value_as_fixed_config===!1&&i.required_configuration&&Object.keys(i.required_configuration).length>=1&&t.jsx("div",{children:Object.entries(i.required_configuration).map(([a,h])=>t.jsx("div",{children:t.jsx(P,{defaultValue:"",name:a,control:n,render:({field:x})=>t.jsxs("div",{children:[t.jsx("label",{htmlFor:a,className:"text-text-sm",children:h}),t.jsx(ye,{...x,inputSize:"md",required:!0,className:"w-full",id:a})]})})},a))})]})]},f))})]})}function pr(){return t.jsx("section",{className:"space-y-5 py-5 first:pt-0 last:pb-0",children:t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{className:"flex items-center gap-1 text-text-lg font-semibold",children:[t.jsx(ge,{type:"orchestrator",className:"h-5 w-5 fill-primary-400"}),"Select your Orchestrator"]}),t.jsx("p",{className:"text-theme-text-secondary",children:"Select one of the connected orchestrators for your new stack"})]})})}function yr(){const{schema:e}=J(),r=V({resolver:q(e),shouldUnregister:!0,defaultValues:{resourceId:""}});return t.jsx(W,{...r,children:t.jsxs(A,{children:[t.jsx(I,{children:"Orchestrator"}),t.jsxs(O,{children:[t.jsx(pr,{}),t.jsx(xr,{})]}),t.jsx(E,{children:t.jsx(gr,{})})]})})}function gr(){const e=v();return t.jsx(D,{disabled:!e.formState.isValid,form:"artifact-store-form",size:"md",children:"Next"})}const jr=y.object({provider:y.string().min(1)});function _r(){const{setData:e,data:r}=S(),{setCurrentStep:s}=N(),n=V({resolver:q(jr),defaultValues:{provider:r.connectorConfig?.type||""}});function o(c){e(l=>({...l,connectorConfig:{type:c.provider,auth_method:""}})),s(l=>l+1)}return t.jsx(W,{...n,children:t.jsxs(A,{children:[t.jsx(I,{children:"Select Your Existing Cloud Infrastructure"}),t.jsx(O,{children:t.jsxs("div",{className:"space-y-5",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("p",{className:"text-text-lg font-semibold",children:"Select a Cloud Provider"}),t.jsx("p",{className:"text-theme-text-secondary",children:"Select the cloud provider where you have existing infrastructure to connect with ZenML. This will allow you to integrate your current cloud resources with ZenML for model deployment and management."})]}),t.jsxs("form",{id:"provider-form",onSubmit:n.handleSubmit(o),className:"grid grid-cols-1 gap-3 xl:grid-cols-3",children:[t.jsx(ne,{id:"aws-provider",...n.register("provider"),value:"aws",children:t.jsx(oe,{icon:t.jsx(R,{provider:"aws",className:"h-6 w-6 shrink-0"}),title:"AWS",subtitle:"Connect your existing S3, ECR, and Sagemaker components to ZenML"})}),t.jsx(ne,{id:"gcp-provider",...n.register("provider"),value:"gcp",children:t.jsx(oe,{icon:t.jsx(R,{provider:"gcp",className:"h-6 w-6 shrink-0"}),title:"GCP",subtitle:"Link your GCS, Artifact Registry, and Vertex AI components to ZenML"})}),t.jsx(ne,{id:"azure-provider",...n.register("provider"),value:"azure",children:t.jsx(oe,{icon:t.jsx(R,{provider:"azure",className:"h-6 w-6 shrink-0"}),title:"Azure",subtitle:"Integrate ZenML with your Blob Storage, Container Registry, and Azure ML"})})]})]})}),t.jsx(E,{children:t.jsx(vr,{})})]})})}function vr(){const{formState:{isValid:e}}=v();return t.jsx(D,{form:"provider-form",disabled:!e,size:"md",children:"Next"})}function Sr(){const{data:e}=S(),r=Y({...Oe.stackDetail(e.createdStackId||""),throwOnError:!0});if(r.isError)return null;if(r.isPending)return t.jsx(G,{className:"h-[200px] w-full"});const s=r.data,n=kt(r.data.metadata?.components);return t.jsxs(A,{children:[t.jsx(I,{children:"Your stack"}),t.jsx(O,{children:t.jsxs("div",{className:"space-y-5",children:[t.jsx("p",{className:"text-theme-text-secondary",children:"Here you can review the created stack and stack components. Now you can start running pipelines using this new configuration."}),t.jsxs("div",{className:"divide-y divide-theme-border-moderate overflow-hidden rounded-md border border-theme-border-moderate",children:[t.jsx(Cr,{stack:s}),n.map(o=>t.jsx(wr,{component:o},o.id))]})]})}),t.jsx(E,{displayCancel:!1,children:t.jsx(br,{})})]})}function br(){return t.jsx(D,{size:"md",asChild:!0,children:t.jsx(zt,{to:ft.stacks.overview,children:"Finish"})})}function Cr({stack:e}){return t.jsxs("div",{className:"flex items-center gap-3 bg-theme-surface-secondary p-5 font-semibold",children:[t.jsx(je,{className:"h-5 w-5",tickClasses:"w-3 h-3"}),t.jsx(lt,{type:"square",size:"lg",children:t.jsx(ut,{size:"lg",children:e.name[0]})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-text-lg",children:e.name}),t.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.id.split("-")[0]})]})]})}function wr({component:e}){return t.jsxs("div",{className:"flex items-center justify-between py-3 pl-9 pr-5",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(je,{className:"h-5 w-5",tickClasses:"w-3 h-3"}),t.jsx(B,{width:24,height:24,flavor:e.resources?.flavor.name||"",type:e.body?.type||"orchestrator"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-text-lg font-semibold",children:e.name}),t.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.id.split("-")[0]})]})]}),t.jsx(Ft,{type:e.body?.type||"alerter",children:dt(e.body?.type)})]},e.id)}function Nr(){const{currentStep:e}=N();if(e===1)return t.jsx(_r,{});if(e===2)return t.jsx(Se,{initialSchema:qe,children:t.jsx(or,{})});if(e===3)return t.jsx(Ut,{});if(e===4)return t.jsx(Se,{initialSchema:pe,children:t.jsx(yr,{})});if(e===5)return t.jsx(fr,{});if(e===6)return t.jsx(Sr,{})}const ke=["Infrastructure Type","Cloud Provider","Connect your Cloud","Artifact Store","Orchestrator","Container Registry"];function os(){return t.jsx(We,{maxSteps:ke.length+1,initialStep:1,children:t.jsx(At,{children:t.jsxs("section",{className:"layout-container flex flex-col gap-5 py-5 xl:flex-row",children:[t.jsx($e,{entries:ke}),t.jsx("div",{className:"w-full",children:t.jsx(Nr,{})})]})})})}export{os as default};
