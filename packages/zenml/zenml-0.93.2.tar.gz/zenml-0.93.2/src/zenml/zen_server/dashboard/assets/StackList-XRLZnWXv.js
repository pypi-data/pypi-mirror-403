import{j as e}from"./@radix-Da0HZyg8.js";import{i as D,j as A,e as d,A as b,h as k,a6 as h,B as f,r as o,ci as P,k as E,s as T,aj as O,L as z,Q as F,U as L,G as I,H as _,J as B,x as M,y as q,V as Q,W as R,X as U,Y as H,Z as g,bF as $,O as G,am as J,al as K,a9 as V,ax as W,aa as X}from"./index-5CE1yoTL.js";import{P as Y}from"./Pagination-CbsJYd8L.js";import{S as Z}from"./SearchField-iVWx0Oy7.js";import{s as x}from"./index-DBB4a7BM.js";import{b as p,c as ee,e as se}from"./@tanstack-BRZ8pkCt.js";import{f as te,L as m,c as ae}from"./@react-router-BEwS6i40.js";import{z as u}from"./@zod-yP6IINRw.js";import{C as y}from"./CodeSnippet-BTWWMvCC.js";import{C as re}from"./CollapsibleCard-BSAO4yQQ.js";import{R as ne,S as ie}from"./resizable-sheet-9BWc3wg3.js";import{e as N}from"./components-Br2ezRib.js";import{a as l}from"./@monaco-editor-xs6rrDBC.js";import{N as v}from"./NumberBox-B22H4TMO.js";import{C as ce}from"./ComponentBadge-2JXtTfNH.js";import{N as le}from"./NestedCollapsible-yH1p4rx9.js";import{A as oe}from"./action-cell-BKewukfe.js";const j=1,de=u.object({page:u.coerce.number().min(j).optional().default(j).catch(j),name:u.string().optional(),operator:u.enum(["and","or"]).optional()});function me(){const[s]=te(),{page:t,name:a,operator:r}=de.parse({page:s.get("page")||void 0,name:s.get("name")||void 0});return{page:t,name:a,logical_operator:r}}const S=l.createContext(null);function xe({children:s}){const[t,a]=l.useState([]);return e.jsx(S.Provider,{value:{integrations:t,setIntegrations:a},children:s})}function w(){const s=l.useContext(S);if(s===null)throw new Error("useIntegrationsContext must be used within an AuthProvider");return s}function ue({children:s,stackId:t,stackName:a}){const[r,n]=l.useState(!1);return e.jsxs(D,{open:r,onOpenChange:n,children:[e.jsx(A,{children:s}),e.jsx(ne,{className:"overflow-y-auto",children:e.jsxs(xe,{children:[e.jsx(ie,{}),e.jsx(he,{stackId:t}),e.jsx(fe,{name:a}),e.jsx(pe,{stackId:t}),e.jsx(ge,{stackId:t})]})})]})}function he({stackId:s}){const t=p({...x.stackDetail(s)});return t.isError?null:t.isPending?e.jsx("div",{className:"p-5",children:e.jsx(d,{className:"h-6 w-full"})}):e.jsxs("div",{className:"flex min-w-[10rem] items-center justify-between border-b border-theme-border-moderate bg-theme-surface-primary p-5",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{type:"square",size:"lg",className:"shrink-0",children:e.jsx(k,{size:"lg",children:t.data.name[0]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"group/copybutton grid grid-cols-1 items-center gap-0.5",children:[e.jsx("p",{className:"mb-0.5 truncate text-text-sm text-theme-text-secondary",children:t.data.id}),e.jsx(h,{copyText:t.data.id})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("h2",{className:"text-display-xs font-semibold",children:t.data.name})})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(f,{asChild:!0,type:"button",size:"sm",intent:"primary",emphasis:"subtle",children:e.jsx(m,{to:o.stacks.edit(s),children:e.jsx(P,{})})})})]})}function pe({stackId:s}){const{setIntegrations:t}=w(),a=p({...x.stackDetail(s)});if(l.useEffect(()=>{if(!a.data)return;const i=N(a.data.metadata?.components).map(c=>c.body?.integration).filter(c=>!!c&&c!=="built-in"&&c!=="custom");i.length>=1&&t(c=>Array.from(new Set([...c,...i])))},[a.data,t]),a.isError)return null;if(a.isPending)return e.jsx("div",{className:"p-5",children:e.jsx(d,{className:"h-[300px] w-full"})});const r=N(a.data.metadata?.components);return e.jsx("ul",{className:"space-y-5 p-5",children:r.map(n=>e.jsx("li",{children:e.jsx(je,{component:n})},n.id))})}function je({component:s}){return e.jsxs(E,{className:"flex items-center justify-between p-5",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{width:32,height:32,alt:`${s.resources?.flavor?.body?.display_name} logo`,src:T(s.body?.logo_url||"")}),e.jsxs("div",{children:[e.jsx(m,{to:o.components.detail(s.id),className:"text-text-xl",children:s.name}),e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:s.id.split("-")[0]}),e.jsx(h,{copyText:s.id})]})]})]}),e.jsx(m,{to:o.components.overview,children:e.jsx(ce,{type:s.body?.type||"orchestrator",children:O(s.body?.type||"")})})]})}function fe({name:s}){const{integrations:t}=w();return e.jsx("section",{className:"px-5 pt-5",children:e.jsx(re,{title:"Set this stack",initialOpen:!0,children:e.jsxs("ul",{className:"space-y-5",children:[e.jsxs("li",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{children:"1"}),e.jsx("p",{className:"font-semibold",children:"Set your stack"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Set the stack as active on your client"}),e.jsx(y,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml stack set ${s}`})]})]}),t.length>=1&&e.jsxs("li",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{children:"2"}),e.jsx("p",{className:"font-semibold",children:"Install the integrations"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Install the required integrations to run pipelines in your stack"}),e.jsx(y,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml integration install ${t.join(" ")}`})]})]})]})})})}function ge({stackId:s}){const t=p({...x.stackDetail(s)});if(t.isError)return null;if(t.isPending)return e.jsx("section",{className:"px-5",children:e.jsx(d,{className:"h-[150px] w-full"})});const a=t.data.metadata?.labels;return!a||Object.keys(a).length===0?null:e.jsx("section",{className:"px-5",children:e.jsx(le,{intent:"primary",isInitialOpen:!0,title:"Labels",data:a})})}function ye({deleteHandler:s,open:t,setOpen:a}){return e.jsx(z,{open:t,onOpenChange:a,children:e.jsx(F,{title:"Delete Stack",handleDelete:s,children:e.jsxs(L,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})})}async function Ne({stackId:s},t){const a=I(B.stacks.detail(s)),r=await fetch(a,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!r.ok){const n=await r.json().then(i=>Array.isArray(i.detail)?i.detail[1]:i.detail).catch(()=>`Error while deleting stack ${s}`);throw new _({status:r.status,statusText:r.statusText,message:n})}return r.json()}function ve(s){return ee({...s,mutationFn:async({stackId:t})=>Ne({stackId:t})})}function be(s,t){const{toast:a}=M(),r=se(),n=ae(),i=ve({onSuccess:async()=>{r.invalidateQueries({queryKey:x.all}),n(o.stacks.overview),t?.()},onError:C=>{a({status:"error",emphasis:"subtle",icon:e.jsx(q,{className:"h-5 w-5 shrink-0 fill-error-700"}),description:C.message,rounded:!0})}});function c(){i.mutate({stackId:s})}return{handleDelete:c,deleteStack:i}}function ke({id:s}){const[t,a]=l.useState(!1),{handleDelete:r,deleteStack:n}=be(s,()=>a(!1));return e.jsxs(e.Fragment,{children:[e.jsx(ye,{deleteHandler:r,open:t,setOpen:a}),e.jsxs(Q,{children:[e.jsx(R,{asChild:!0,children:e.jsx(U,{children:e.jsx("span",{className:"sr-only",children:"Open stack actions"})})}),e.jsxs(H,{className:"z-10",align:"end",sideOffset:1,children:[e.jsx(g,{asChild:!0,className:"cursor-pointer space-x-2",children:e.jsxs(m,{to:o.stacks.edit(s),children:[e.jsx($,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Edit"})]})}),e.jsxs(g,{disabled:n.isPending,onClick:()=>a(!0),className:"cursor-pointer space-x-2",children:[e.jsx(G,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Delete"})]})]})]})]})}function Se(){return l.useMemo(()=>[{id:"name",header:"Stack",accessorFn:s=>({name:s.name,id:s.id}),cell:({getValue:s})=>{const{name:t,id:a}=s();return e.jsxs("div",{className:"group/copybutton flex min-w-[10rem] items-center gap-2",children:[e.jsx(b,{type:"square",size:"md",className:"shrink-0",children:e.jsx(k,{size:"md",children:t[0]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{stackName:t,stackId:a,children:e.jsx("h2",{className:"grid grid-cols-1 text-text-md font-semibold",children:e.jsx("span",{className:"truncate",children:t})})}),e.jsx(h,{copyText:t})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:a.split("-")[0]}),e.jsx(h,{copyText:a})]})]})]})}},{id:"created",header:"Created at",accessorFn:s=>s.body?.created,cell:({getValue:s})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(J,{dateString:s()})})},{id:"author",header:"Author",accessorFn:s=>s.resources?.user?.name,cell:({row:s})=>{const t=s.original.resources?.user;return t?e.jsx(K,{avatarUrl:t.body?.avatar_url??void 0,username:t.name,isServiceAccount:!!t.body?.is_service_account}):null}},{id:"actions",header:"",accessorFn:s=>({id:s.id}),cell:({getValue:s})=>{const{id:t}=s();return e.jsx(oe,{children:e.jsx(ke,{id:t})})}}],[])}function Re({fixedQueryParams:s={}}){const t=me(),a=Se(),{refetch:r,data:n}=p({...x.stackList({...t,sort_by:"desc:updated",...s}),throwOnError:!0});return e.jsx("section",{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-4",children:[e.jsx(Z,{searchParams:t}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs(f,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>r(),children:[e.jsx(V,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]}),e.jsx(f,{size:"md",asChild:!0,children:e.jsxs(m,{to:o.stacks.create.index,children:[e.jsx(W,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"New Stack"})]})})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:n?e.jsx(X,{columns:a,data:n.items}):e.jsx(d,{className:"h-[500px] w-full"})}),n?n.total_pages>1&&e.jsx(Y,{searchParams:t,paginate:n}):e.jsx(d,{className:"h-[36px] w-[300px]"})]})]})})}export{Re as S};
