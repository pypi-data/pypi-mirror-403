import{j as e}from"./@radix-Da0HZyg8.js";import{F as P,G as T,H as E,J as O,bv as J,bx as K,by as V,D as $,bO as H,e as A,aJ as G,aK as Y,aU as Z,aL as W,aM as X,aN as ee,I as k,aO as se,aP as te,aQ as F,aR as y,c as re,ck as ae,ax as ne,k as oe,s as ie,B as N,az as ce,b as le,u as me,x as de,bc as ue,aA as pe}from"./index-5CE1yoTL.js";import{c as D,k as xe,b as he,e as fe}from"./@tanstack-BRZ8pkCt.js";import{f as je}from"./index-p-TDI5a2.js";import{g as ge,a as ye,D as Ne,b as Ce}from"./form-BPcAENG-.js";import{a as ve,C as be,z as C,u as we,t as Se,F as Fe}from"./@zod-yP6IINRw.js";import{S as _e}from"./transform-pqykL0RU.js";import{S as ze}from"./check-DSoixTtU.js";import{a as _}from"./@monaco-editor-xs6rrDBC.js";import{C as Pe}from"./CodeSnippet-BTWWMvCC.js";import{S as Te}from"./file-text-B3rACLpg.js";import{C as Ee}from"./ComponentIcon-B7M5n_Xi.js";async function Oe({payload:s}){const t=T(O.components.all),r=await P(t,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(s)});if(!r.ok){const o=await r.json().then(m=>Array.isArray(m.detail)?m.detail[1]:m.detail).catch(()=>"Error while creating new stack");throw new E({status:r.status,statusText:r.statusText,message:o})}return r.json()}function Ae(s){return D({...s,mutationFn:async({payload:t})=>Oe({payload:t})})}async function ke({componentId:s,payload:t}){const r=T(O.components.detail(s)),o=await P(r,{headers:{"Content-Type":"application/json"},method:"PUT",body:JSON.stringify(t)});if(!o.ok){const m=await o.json().then(u=>Array.isArray(u.detail)?u.detail[1]:u.detail).catch(()=>"Error while creating new stack");throw new E({status:o.status,statusText:o.statusText,message:m})}return o.json()}function De(s){return D({...s,mutationFn:async({payload:t,componentId:r})=>ke({payload:t,componentId:r})})}function Ie({open:s,setOpen:t}){return e.jsx(J,{open:s,onOpenChange:t,children:e.jsxs(K,{className:"max-w-[600px]",children:[e.jsx(V,{children:e.jsx($,{children:"Create Service Connector"})}),e.jsx("div",{className:"min-w-0 p-5",children:e.jsxs("div",{className:"min-w-0 max-w-full space-y-1",children:[e.jsx("p",{children:"Create a new service connector"}),e.jsx(Pe,{wrap:!0,code:"zenml service-connector register <NAME> --type=<TYPE> --interactive"})]})})]})})}function qe({connectorResourceType:s}){const t=ve(),[r,o]=_.useState(!1),[m,u]=_.useState(!1),p=xe(H.serviceConnectorListInfinite({resource_type:s,sort_by:"desc:created"}));if(p.isPending)return e.jsx(A,{className:"h-[60px] w-full"});if(p.isError)return e.jsx("div",{children:"Error"});const c=p.data?.pages.flatMap(l=>l.items);return e.jsxs(e.Fragment,{children:[e.jsx(be,{control:t.control,name:"connector",render:({field:l})=>e.jsxs(G,{modal:!0,open:r,onOpenChange:o,children:[e.jsx(Y,{asChild:!0,children:e.jsx("button",{className:Z("w-full flex-1 truncate rounded-md border border-primary-400 bg-theme-surface-secondary px-2",{"h-7":!l.value,"py-2 pl-2 pr-3 text-left":l.value}),children:l.value?(()=>{const n=c.find(x=>x.id===l.value);return n?e.jsx(z,{connector:n}):"Select Connector"})():"Select Connector"})}),e.jsx(W,{className:"p-0",style:{width:"var(--radix-popover-trigger-width)"},align:"start",children:e.jsxs(X,{filter:(n,x)=>n.toLowerCase().includes(x.toLowerCase())||n.includes("doNotFilter-")?1:0,children:[c.length>0&&e.jsx(ee,{placeholder:"Search connectors...",children:e.jsx(k,{className:"w-full",inputSize:"sm"})}),e.jsx(se,{className:"space-y-1 p-2",children:e.jsxs("div",{className:"space-y-1",children:[c.length>0?e.jsxs(e.Fragment,{children:[e.jsx(te,{children:"No results"}),e.jsx(F,{className:"max-h-[300px] overflow-y-auto",children:c.map(n=>e.jsxs(y,{value:`${n.id}:${n.name}`,onSelect:x=>{const[f]=x.split(":");t.setValue("connector",l.value===f?"":f),o(!1)},children:[e.jsx(z,{connector:n}),e.jsx(ze,{className:re("fill-brand-500 ml-auto size-4 shrink-0",l.value===n.id?"opacity-100":"opacity-0")})]},n.id))})]}):e.jsx("div",{className:"p-2 text-center text-theme-text-secondary",children:"No connectors found"}),e.jsx(ae,{className:"-mx-1"}),e.jsxs(F,{children:[p.hasNextPage&&e.jsx(y,{value:"doNotFilter-fetch-more",className:"flex items-center font-semibold",onSelect:()=>{p.fetchNextPage()},children:"Load more"}),e.jsxs(y,{value:"doNotFilter-create-new",className:"flex items-center gap-2 font-semibold",onSelect:()=>{o(!1),u(!0)},children:[e.jsx(ne,{className:"size-3 shrink-0 fill-neutral-400"}),"Create new Service Connector"]})]})]})})]})})]})}),e.jsx(Ie,{open:m,setOpen:u})]})}function z({connector:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[typeof s.body?.connector_type=="object"&&s.body?.connector_type.logo_url&&e.jsx("img",{src:s.body.connector_type.logo_url,alt:s.name,className:"size-5 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsx("div",{className:"text-theme-text-secondary",children:s.id.split("-")[0]})]})]})}function Le({connectorResourceType:s}){return e.jsxs("section",{className:"w-full max-w-full space-y-3 overflow-x-hidden rounded-md border border-warning-50 bg-[#FFF6EA] p-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_e,{className:"size-5 shrink-0 fill-warning-400"}),e.jsx("p",{className:"text-text-lg font-semibold",children:"Connect to resource"})]}),e.jsx("p",{className:"text-theme-text-secondary",children:"You can select a Service Connector to connect ZenML to external resources"})]}),e.jsx(qe,{connectorResourceType:s})]})}function Qe({sdkDocsUrl:s,name:t,logoUrl:r,type:o}){return e.jsxs(oe,{className:"space-y-5 overflow-hidden pb-5",children:[e.jsx("div",{className:"flex h-[120px] w-full items-center justify-center bg-teal-25",children:r?e.jsx("img",{width:60,height:60,className:"aspect-square object-contain",src:ie(r),alt:`Logo of ${t}`}):e.jsx(Ee,{className:"aspect-square h-[60px] w-[60px] fill-primary-400 object-contain",type:o})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"px-5",children:[e.jsx("p",{className:"text-text-lg font-semibold",children:"Need Help?"}),e.jsx("p",{className:"text-theme-text-secondary",children:"Follow our extensive documentation to get started."})]}),e.jsxs("ul",{className:"space-y-0.5 px-5",children:[!!s&&e.jsx("li",{children:e.jsx(N,{asChild:!0,emphasis:"minimal",intent:"primary",size:"md",children:e.jsxs("a",{className:"flex items-center gap-1",target:"_blank",rel:"noopener noreferrer",href:s,children:[e.jsx(Te,{className:"size-5 shrink-0 fill-primary-600"}),"Api Reference"]})})}),e.jsx("li",{children:e.jsx(N,{asChild:!0,emphasis:"minimal",intent:"primary",size:"md",children:e.jsxs("a",{className:"flex items-center gap-1",target:"_blank",rel:"noopener noreferrer",href:"https://github.com/zenml-io/zenml/tree/main/examples",children:[e.jsx(ce,{className:"size-5 shrink-0 fill-primary-600"}),"Navigate our examples"]})})}),e.jsx("li",{children:e.jsx(N,{asChild:!0,emphasis:"minimal",intent:"primary",size:"md",children:e.jsxs("a",{className:"flex items-center gap-1",target:"_blank",rel:"noopener noreferrer",href:"https://www.zenml.io/blog",children:[e.jsx(le,{className:"size-5 shrink-0 fill-primary-600"}),"Read our blog"]})})})]})]})]})}const Re=C.object({componentName:C.string().min(1,"Component name is required"),connector:C.string()});function es({flavorId:s,formId:t,successHandler:r,FooterComponent:o,useMaxHeight:m=!1,component:u,isCreate:p=!0}){const c=he(je.flavorDetail(s)),l=me();return c.isPending||l.isPending?e.jsx("div",{className:"px-8 py-5",children:e.jsx(A,{className:"h-[250px] w-full"})}):c.isError||l.isError?e.jsx("p",{className:"px-8 py-5",children:"Failed to fetch flavor"}):e.jsx(Be,{isCreate:p,component:u,useMaxHeight:m,infoTile:e.jsx(Qe,{type:c.data.body?.type||"orchestrator",name:c.data.name,sdkDocsUrl:c.data.metadata?.sdk_docs_url??void 0,logoUrl:c.data.body?.logo_url??void 0}),FooterComponent:o,successHandler:r,flavor:c.data,userId:l.data.id,formId:t,schema:c.data.metadata?.config_schema})}function Be({formId:s,schema:t,flavor:r,userId:o,successHandler:m,infoTile:u,FooterComponent:p,useMaxHeight:c,isCreate:l,component:n}){const{toast:x}=de(),f=pe.all,v=fe(),b=Ae({onSuccess:({id:a})=>{v.invalidateQueries({queryKey:f}),m?.(a)},onError:a=>{x({emphasis:"subtle",status:"error",rounded:!0,description:a.message})}}),I=De({onSuccess:({id:a})=>{v.invalidateQueries({queryKey:f}),m?.(a)},onError:a=>{x({emphasis:"subtle",status:"error",rounded:!0,description:a.message})}}),q=t.properties||{},j=t.required||[],L=t.$defs;function Q({componentName:a,...i}){if(Object.keys(i).forEach(d=>{(i[d]===""||i[d]===null||i[d]===void 0||Array.isArray(i[d])&&i[d].length===0||typeof i[d]=="object"&&!Array.isArray(i[d])&&Object.keys(i[d]).length===0)&&delete i[d]}),!r.body)return;const{connector:g,...S}=i;if(l)b.mutate({payload:{name:a,configuration:S,flavor:r.name,type:r.body.type,user:o,connector:g||null}});else{if(!n)return;const d=n.metadata?.connector?.id!==g,U=n.metadata?.connector_resource_id;I.mutate({componentId:n.id,payload:{...!d&&{connector_resource_id:U},name:a,configuration:S,connector:g||null}})}}const R=Re.merge(ge(t)),B=ye(t,n?.metadata?.configuration),h=we({resolver:Se(R),defaultValues:{componentName:n?.name??"",connector:n?.metadata?.connector?.id??"",...B}}),{handleSubmit:M}=h,w=Object.entries(q).sort(([a],[i])=>j.includes(a)&&!j.includes(i)?-1:!j.includes(a)&&j.includes(i)?1:0);return e.jsx(Fe,{...h,children:e.jsxs("form",{onSubmit:a=>(a.stopPropagation(),M(Q)(a)),id:s,children:[e.jsx(ue,{viewportClassName:c?"max-h-[70vh]":"",children:e.jsxs("div",{className:"space-y-4 p-8",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{className:"text-text-lg font-semibold",children:"Component Name"}),e.jsx(k,{...h.register("componentName"),"data-error":h.formState.errors.componentName?"true":"false",className:"w-full data-[error=true]:border-error-500",inputSize:"lg"}),h.formState.errors.componentName&&e.jsx("p",{className:"text-text-sm text-error-500",children:h.formState.errors.componentName.message?.toString()})]}),e.jsxs("div",{className:"flex flex-col-reverse gap-5 xl:flex-row",children:[e.jsxs("div",{className:"flex-1 space-y-5",children:[r.metadata?.connector_resource_type?e.jsx(Le,{connectorResourceType:r.metadata.connector_resource_type}):null,w.length>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-text-lg font-semibold",children:"Attributes"}),w.map(([a,i])=>e.jsx(Ne,{definitions:L,isOptional:Ce(a,j),name:a,schema:i},a))]}):null]}),e.jsx("div",{className:"w-full xl:w-1/3",children:u})]})]})}),e.jsx(p,{formId:s,isPending:b.isPending})]})})}export{es as C};
