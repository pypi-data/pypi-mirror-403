import{j as e}from"./@radix-Da0HZyg8.js";import{ac as p,B as m,a9 as C,r as o,ax as y,e as h,aa as w,L as D,Q as v,U as N,V as b,W as P,X as k,Y as A,Z as T,O as R,_ as x,bf as _,a6 as f,bg as B,T as I,a7 as F,az as L,bh as E,al as O,am as U}from"./index-5CE1yoTL.js";import{S as Q}from"./SearchField-iVWx0Oy7.js";import{b as g}from"./@tanstack-BRZ8pkCt.js";import{L as i,f as z}from"./@react-router-BEwS6i40.js";import{B as M}from"./button-group-basic-Bk-90YSv.js";import{P as G}from"./Pagination-CbsJYd8L.js";import{z as l}from"./@zod-yP6IINRw.js";import{D as q}from"./deployment-status-tag-DLuEOChP.js";import{P as H}from"./pipeline-link-CCg7j5YZ.js";import{A as K}from"./action-cell-BKewukfe.js";import{c as V}from"./helper-BkxAcFl_.js";import{u as W}from"./update-snapshot-CrGUCICc.js";import{u as X}from"./bulk-delete-VX49K4z6.js";import{a as Y}from"./@monaco-editor-xs6rrDBC.js";const{ContextProvider:ge,useContext:c}=V();function j(){const{setRowSelection:t}=c(),{mutateAsync:s}=W();async function n(a){await s({snapshotId:a,payload:{name:!1}})}return X({deleteFn:n,queryKeyToInvalidate:p.all,setRowSelection:t})}function Z(){const{selectedRowCount:t,selectedRowIDs:s}=c(),{bulkDelete:n}=j();async function a(){await n(s)}return e.jsx(M,{itemName:"Pipeline Snapshot",selectedItemCount:t,onDeleteSelected:a})}function je({params:t,displayCreateButton:s=!1}){const{refetch:n}=g({...p.list(t),throwOnError:!0}),{selectedRowCount:a}=c();return e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-1",children:[a?e.jsx(Z,{}):e.jsx(Q,{searchParams:t}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(m,{className:"bg-theme-surface-primary",intent:"primary",emphasis:"subtle",size:"md",onClick:()=>n(),children:[e.jsx(C,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]}),s&&e.jsx(m,{className:"whitespace-nowrap",asChild:!0,size:"md",children:e.jsxs(i,{to:o.projects.snapshots.create,children:[e.jsx(y,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"Create Snapshot"})]})})]})]})}function Se({params:t,columns:s}){const{rowSelection:n,setRowSelection:a}=c(),r=g({...p.list(t),throwOnError:!0});if(r.isPending)return e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:e.jsx(h,{className:"h-[500px] w-full"})}),e.jsx(h,{className:"h-[36px] w-[300px]"})]});if(r.isError)return e.jsx("p",{children:"Error fetching snapshots"});const d=r.data;return e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:e.jsx(w,{columns:s,data:d.items,rowSelection:n,onRowSelectionChange:a,getRowId:S=>S.id})}),d.total_pages>1&&e.jsx(G,{searchParams:t,paginate:d})]})}const u=1,$=l.object({page:l.coerce.number().min(u).optional().default(u).catch(u),name:l.string().optional(),operator:l.enum(["and","or"]).optional()});function Ce(){const[t]=z(),{page:s,name:n,operator:a}=$.parse({page:t.get("page")||void 0,name:t.get("name")||void 0});return{page:s,name:n,logical_operator:a}}function J({deleteHandler:t}){return e.jsx(v,{title:"Delete Pipeline Snapshots",handleDelete:t,children:e.jsxs(N,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})}function ee({deleteHandler:t,open:s,setOpen:n}){return e.jsx(D,{open:s,onOpenChange:n,children:e.jsx(J,{deleteHandler:t})})}function te({snapshotId:t}){const[s,n]=Y.useState(!1),{bulkDelete:a}=j();async function r(){await a([t]),n(!1)}return e.jsxs(e.Fragment,{children:[e.jsx(ee,{deleteHandler:r,open:s,setOpen:n}),e.jsxs(b,{children:[e.jsx(P,{asChild:!0,children:e.jsx(k,{children:e.jsx("span",{className:"sr-only",children:"Open pipeline snapshot actions"})})}),e.jsx(A,{align:"end",sideOffset:7,children:e.jsxs(T,{onClick:()=>n(!0),className:"cursor-pointer space-x-2",children:[e.jsx(R,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Delete"})]})})]})]})}function ye(){return{id:"check",header:({table:t})=>e.jsx(x,{id:"check-all",checked:t.getIsAllRowsSelected(),onCheckedChange:s=>t.toggleAllRowsSelected(s==="indeterminate"?!0:s)}),meta:{width:"1%"},cell:({row:t})=>e.jsx(x,{id:t.id,checked:t.getIsSelected(),onCheckedChange:t.getToggleSelectedHandler(),className:"h-3 w-3"})}}function we(){return{id:"name",header:"Snapshot",accessorFn:t=>t.name,cell:({row:t})=>{const s=t.original.name,n=t.original.id;return e.jsxs("div",{className:"group/copybutton flex min-w-[10rem] items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5 shrink-0 fill-primary-400"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(i,{to:o.projects.snapshots.detail.overview(n),className:"grid grid-cols-1 items-center gap-1",children:e.jsx("span",{className:"truncate text-text-md font-semibold text-theme-text-primary",children:s??"Unnamed"})}),e.jsx(f,{copyText:s??""})]}),e.jsxs(i,{to:o.projects.snapshots.detail.overview(n),className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:B(n)}),e.jsx(f,{copyText:n})]})]})]})}}}function De(){return{id:"deployment",header:"Deployment",accessorFn:t=>t.resources?.deployment?.id,cell:({row:t})=>{const s=t.original.resources?.deployment,n=s?.body?.status,a=s?.id;return!n||!a?null:e.jsx(i,{to:o.projects.deployments.detail.overview(a),children:e.jsx(q,{status:n})})}}}function ve(){return{id:"pipeline",header:"Pipeline",accessorFn:t=>t.resources?.pipeline?.name,cell:({row:t})=>{const s=t.original.resources?.pipeline;return s?e.jsx(H,{pipelineId:s.id,pipelineName:s.name}):null}}}function Ne(){return{id:"latest-run",header:"Latest Run",accessorFn:t=>t.resources?.latest_triggered_run_id,cell:({row:t})=>{const s=t.original.resources?.latest_run_id,n=t.original.resources?.latest_run_status;return!s||!n?e.jsx("div",{children:"No run"}):e.jsx(i,{to:o.projects.runs.detail(s),children:e.jsxs(I,{emphasis:"subtle",rounded:!1,className:"inline-flex items-center gap-0.5",color:F(n),children:[e.jsx(L,{className:`h-3 w-3 ${E(n)}`}),s?.split("-")[0]]})})}}}function be(){return{id:"latest-run-author",header:"Latest Run Author",accessorFn:t=>t.resources?.latest_run_author,cell:({row:t})=>{const s=t.original.resources?.user;return s?e.jsx(O,{username:s.name,isServiceAccount:!!s.body?.is_service_account,avatarUrl:s.body?.avatar_url??void 0}):null}}}function Pe(){return{id:"created",header:"Created at",accessorFn:t=>({date:t.body?.created}),cell:({getValue:t})=>{const{date:s}=t();return e.jsx(U,{dateString:s})}}}function ke(){return{id:"admin_actions",header:void 0,accessorFn:t=>t.id,cell:({row:t})=>{const s=t.original.id;return e.jsx(K,{children:e.jsx(te,{snapshotId:s})})}}}export{Se as P,je as S,we as a,De as b,ye as c,Ne as d,be as e,Pe as f,ke as g,ge as h,ve as i,Ce as u};
