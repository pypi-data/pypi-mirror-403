import{j as e}from"./@radix-Da0HZyg8.js";import{F as w,G as D,H as C,J as K,bv as E,bw as ie,B as p,bx as _,by as q,D as z,x as S,I as A,bB as V,bC as H,bD as k,L as T,N as oe,O as Q,Q as $,R as G,U as L,ay as Y,bA as U,a1 as ce,a2 as le,a3 as de,ak as ue,a5 as me,e as y,V as xe,W as he,X as pe,Y as ye,Z as O,a9 as je,aY as fe,aZ as ge,a_ as be,b0 as ve,b1 as Ae,_ as M,am as B,b4 as Ne,cc as we,cd as De,k as J,aa as Ce,ab as Ke,ce as Se,r as ke,cb as Te,aS as Pe}from"./index-5CE1yoTL.js";import{c as Fe}from"./helper-BkxAcFl_.js";import{s as j,A as Z,d as Re,u as Ie,b as P,a as W}from"./service-fAAen_4L.js";import{c as F,e as g,b as R}from"./@tanstack-BRZ8pkCt.js";import{u as Oe}from"./bulk-delete-VX49K4z6.js";import{P as Me}from"./Pagination-CbsJYd8L.js";import{S as Be}from"./SearchField-iVWx0Oy7.js";import{a as x}from"./@monaco-editor-xs6rrDBC.js";import{u as X,t as ee,C as N,z as v}from"./@zod-yP6IINRw.js";import{S as te}from"./key-icon-C_9A6E6k.js";import{A as Ee}from"./action-cell-BKewukfe.js";import{I as _e}from"./Infobox-DQUJxLQz.js";import{a as I}from"./@react-router-BEwS6i40.js";import"./@elkjs-D2DP-mPJ.js";import"./@reactflow-CEST3EX2.js";import"./CodeSnippet-BTWWMvCC.js";import"./Tick-hfrBQLs_.js";import"./check-DSoixTtU.js";import"./chevron-right-double-QOmxbkYg.js";import"./alert-triangle-C7ryTF32.js";async function qe(t,s){const a=D(K.serviceAccounts.apiKeys.detail(t,s)),r=await w(a,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!r.ok){const n=await r.json().then(i=>Array.isArray(i.detail)?i.detail[1]:i.detail).catch(()=>`Failed to delete api key ${s}`);throw new C({status:r.status,statusText:r.statusText,message:n})}return r.json()}function ze(t){return F({...t,mutationFn:async({serviceAccountId:s,apiKeyId:a})=>{await qe(s,a)}})}const{ContextProvider:Ve,useContext:f}=Fe();function se(t){const{setRowSelection:s}=f(),{mutateAsync:a}=ze();async function r(n){await a({serviceAccountId:t,apiKeyId:n})}return Oe({deleteFn:r,queryKeyToInvalidate:j.serviceAccountsKey(),setRowSelection:s})}function ae({serviceAccountId:t,isFallback:s}){const a=g(),[r,n]=x.useState(!1),[i,o]=x.useState(""),l=!!i;function m(){return l?e.jsx(Z,{value:i}):e.jsx(He,{isFallback:s,serviceAccountId:t,setApikeyValue:o})}return e.jsx(e.Fragment,{children:e.jsxs(E,{open:r,onOpenChange:u=>{s&&!u&&a.invalidateQueries({queryKey:j.apiKeysKey(t)}),n(u),o("")},children:[e.jsx(ie,{asChild:!0,children:e.jsx(p,{className:"shrink-0",intent:"primary",size:"sm",children:"Generate API Key"})}),e.jsxs(_,{"data-success":l,className:"mx-auto overflow-x-auto transition-none data-[success=true]:max-w-[800px]",children:[e.jsx(q,{children:e.jsx(z,{children:l?"API Key Created Successfully":"Generate API Key"})}),m()]})]})})}function He({serviceAccountId:t,setApikeyValue:s,isFallback:a}){const{toast:r}=S(),n=g(),{handleSubmit:i,control:o,formState:{isValid:l},reset:m}=X({resolver:ee(Re),defaultValues:{name:"",description:""}}),{mutate:u}=Ie({onError(c){k(c)&&r({status:"error",emphasis:"subtle",description:c.message,rounded:!0})},onSuccess(c){a||n.invalidateQueries({queryKey:j.apiKeysKey(t)}),s(c.body?.key||""),m()}});function d(c){u({serviceAccountId:t,body:{name:c.name,description:c.description}})}return e.jsxs(e.Fragment,{children:[e.jsxs("form",{id:"create-secret-form",className:"space-y-5 p-7",onSubmit:i(d),children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{className:"font-inter text-sm text-left font-medium leading-5",children:"Name:"}),e.jsx(N,{name:"name",control:o,render:({field:c})=>e.jsx(A,{...c,className:"w-full",required:!0,placeholder:"Add name"})})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{className:"font-inter text-sm text-left font-medium leading-5",children:"Description:"}),e.jsx(N,{name:"description",control:o,render:({field:c})=>e.jsx(A,{...c,className:"w-full",placeholder:"Add description"})})]})]}),e.jsxs(V,{className:"gap-[10px]",children:[e.jsx(H,{asChild:!0,children:e.jsx(p,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(p,{intent:"primary",disabled:!l,type:"submit",form:"create-secret-form",children:"Generate Key"})]})]})}function Qe({serviceAccountId:t}){const[s,a]=x.useState(!1),{bulkDelete:r}=se(t),{selectedRowIDs:n,selectedRowCount:i}=f();async function o(){await r(n),a(!1)}return e.jsxs(T,{open:s,onOpenChange:a,children:[e.jsx(oe,{asChild:!0,children:e.jsxs(p,{className:"rounded-sharp border-y-0 bg-white",size:"md",emphasis:"subtle",intent:"secondary",children:[e.jsx(Q,{className:"h-5 w-5 shrink-0 gap-1 fill-neutral-400"}),"Delete"]})}),e.jsx($,{title:`Delete ${G(i,"Api Key")}`,handleDelete:o,children:e.jsxs(L,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})]})}function $e({serviceAccountId:t}){const{selectedRowCount:s}=f();return e.jsxs("div",{className:"flex items-center divide-x divide-theme-border-moderate overflow-hidden rounded-md border border-theme-border-moderate",children:[e.jsx("div",{className:"bg-primary-25 px-2 py-1 font-semibold text-theme-text-brand",children:`${s} ${G(s,"Api Key")} selected`}),e.jsx(Qe,{serviceAccountId:t})]})}async function Ge({apiKeyId:t,body:s,serviceAccountId:a}){const r=D(K.serviceAccounts.apiKeys.rotate(a,t)),n=await w(r,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(n.status===404&&Y(),!n.ok){const i=await n.json().then(o=>Array.isArray(o.detail)?o.detail[1]:o.detail).catch(()=>`Failed to rotate key ${t}`);throw new C({status:n.status,statusText:n.statusText,message:i})}return n.json()}function Le(t){return F({...t,mutationFn:async({serviceAccountId:s,apiKeyId:a,body:r})=>Ge({serviceAccountId:s,apiKeyId:a,body:r})})}const Ye=v.object({enableRetention:v.boolean(),rotateMinutes:v.coerce.number().int().min(1).optional()}).refine(t=>!(t.enableRetention&&!t.rotateMinutes));function Ue({serviceAccountId:t,apiKeyId:s,open:a,setOpen:r}){const[n,i]=x.useState(""),o=!!n;function l(){return o?e.jsx(Z,{value:n}):e.jsx(Je,{setApiKeyValue:i,apiKeyId:s,serviceAccountId:t})}return e.jsx(E,{open:a,onOpenChange:m=>{r(m),i("")},children:e.jsxs(_,{className:"mx-auto max-w-[800px] overflow-x-auto",children:[e.jsx(q,{children:e.jsx(z,{children:"Rotate API Key"})}),l()]})})}function Je({apiKeyId:t,serviceAccountId:s,setApiKeyValue:a}){const{toast:r}=S(),n=g(),{control:i,watch:o,register:l,handleSubmit:m,formState:{errors:u,isValid:d}}=X({resolver:ee(Ye),defaultValues:{enableRetention:!1,rotateMinutes:void 0}});function c(h){const b={retain_period_minutes:h.rotateMinutes};ne({serviceAccountId:s,apiKeyId:t,body:b})}const{mutate:ne}=Le({onError(h){k(h)&&r({status:"error",emphasis:"subtle",description:h.message,rounded:!0})},onSuccess(h){r({description:"The API key has been rotated successfully.",status:"success",emphasis:"subtle",rounded:!0}),a(h.body?.key||""),n.invalidateQueries({queryKey:[...j.apiKeysKey(s)]})}});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-5 p-7",children:[e.jsx(Ze,{apiKeyId:t,serviceAccountId:s}),e.jsx(We,{}),e.jsxs("form",{onSubmit:m(c),id:"retention-form",children:[e.jsxs("div",{className:"flex items-center gap-1 rounded-t-md border bg-theme-surface-secondary p-1",children:[e.jsx(N,{control:i,name:"enableRetention",render:({field:{onChange:h,value:b}})=>e.jsx(U,{className:"data-[state=unchecked]:bg-neutral-200",checked:b,id:"enable-retention",onCheckedChange:re=>h(!!re)})}),"Include Retention Period",e.jsx(ce,{children:e.jsxs(le,{children:[e.jsx(de,{asChild:!0,children:e.jsxs("button",{type:"button",children:[e.jsx(ue,{className:"h-4 w-4 shrink-0 fill-theme-text-tertiary"}),e.jsx("div",{className:"sr-only",children:"Info tooltip"})]})}),e.jsx(me,{className:"z-50 flex max-w-[480px] bg-black",children:e.jsx("p",{className:"text-text-xs text-white",children:"To minimize disruption, you can set a retention period for your current key. Enter the duration(in minutes) you'd like the old key to remain active alongside the new one."})})]})})]}),e.jsxs("fieldset",{disabled:!o("enableRetention"),className:"space-y-5 rounded-b-md border-x border-b p-5 text-text-md text-theme-text-primary",children:[e.jsx("p",{className:"text-text-md text-theme-text-primary",children:"Keep the current key working for the next"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-text-sm text-theme-text-primary",htmlFor:"retention-minutes",children:"Minutes"}),e.jsx(A,{id:"retention-minutes",...l("rotateMinutes"),disabled:!o("enableRetention"),placeholder:"0"}),u.rotateMinutes&&e.jsx("p",{className:"text-text-sm text-theme-text-error",children:u.rotateMinutes.message})]})]})]})]}),e.jsxs(V,{className:"gap-[10px]",children:[e.jsx(H,{asChild:!0,children:e.jsx(p,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(p,{intent:"primary",disabled:!d,size:"sm",form:"retention-form",children:"Rotate Key"})]})]})}function Ze({apiKeyId:t,serviceAccountId:s}){const{data:a,isPending:r,isError:n}=R({...P.ApiKeysDetail(s,t),throwOnError:!0});return r?e.jsx(y,{className:"h-8 w-full"}):n?null:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{className:"h-5 w-5 flex-shrink-0 fill-primary-400"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{children:a&&a.name}),e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:a&&a.metadata?.description})]})]})}function We(){return e.jsxs(_e,{children:[e.jsx("strong",{children:"Your current API Key will be deactivated."})," This means any processes or integrations using the old key will no longer function once the new key is generated."]})}function Xe({serviceAccountId:t,apiKeyId:s}){const[a,r]=x.useState(!1),[n,i]=x.useState(!1),{bulkDelete:o}=se(t);async function l(){await o([s]),r(!1)}return e.jsxs(e.Fragment,{children:[e.jsx(Ue,{setOpen:i,open:n,serviceAccountId:t,apiKeyId:s}),e.jsx(T,{open:a,onOpenChange:r,children:e.jsx($,{title:"Delete API Key",handleDelete:l,children:e.jsxs(L,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})}),e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(pe,{children:e.jsx("span",{className:"sr-only",children:"Open API key actions"})})}),e.jsxs(ye,{align:"end",sideOffset:7,children:[e.jsx(O,{className:"px-3",onClick:()=>i(!0),icon:e.jsx(je,{}),children:e.jsx("span",{children:"Rotate"})}),e.jsx(O,{onClick:()=>r(!0),className:"px-3",icon:e.jsx(Q,{}),children:e.jsx("p",{children:"Delete"})})]})]})]})}async function et({apiKeyId:t,body:s,serviceAccountId:a}){const r=D(K.serviceAccounts.apiKeys.detail(a,t)),n=await w(r,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(n.status===404&&Y(),!n.ok){const i=await n.json().then(o=>Array.isArray(o.detail)?o.detail[0]:o.detail||"An error occurred").catch(()=>`Failed to update key ${t}`);throw new C({status:n.status,statusText:n.statusText,message:i})}return n.json()}function tt(t){return F({...t,mutationFn:async({serviceAccountId:s,apiKeyId:a,body:r})=>{await et({serviceAccountId:s,apiKeyId:a,body:r})}})}function st({isActive:t,serviceAccountId:s,apiKeyId:a}){const{toast:r}=S(),n=g(),[i,o]=x.useState(!1),{mutate:l}=tt({onError(d){k(d)&&r({status:"error",emphasis:"subtle",description:d.message,rounded:!0})},onSuccess(){n.invalidateQueries({queryKey:j.apiKeysKey(s)})}});function m(d){d?u(d):o(!0)}async function u(d){l({serviceAccountId:s,apiKeyId:a,body:{active:d}})}return e.jsxs(e.Fragment,{children:[e.jsx(T,{open:i,onOpenChange:o,children:e.jsxs(fe,{children:[e.jsx(ge,{children:e.jsx(be,{children:"Deactivate API Key"})}),e.jsxs("div",{className:"p-5 text-text-md text-theme-text-secondary",children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"You won't be able to use this API Key to authenticate with the server anymore."})]}),e.jsxs(ve,{className:"gap-[10px]",children:[e.jsx(Ae,{asChild:!0,children:e.jsx(p,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(p,{onClick:()=>u(!1).then(d=>o(!1)),intent:"primary",type:"button",children:"Deactivate"})]})]})}),e.jsx(U,{checked:t,onCheckedChange:m})]})}function at(){return[{id:"select",meta:{width:"1%"},header:({table:t})=>e.jsx(M,{id:"check-all",checked:t.getIsAllRowsSelected(),onCheckedChange:s=>t.toggleAllRowsSelected(s==="indeterminate"?!0:s)}),cell:({row:t})=>e.jsx(M,{id:`check-${t.id}`,checked:t.getIsSelected(),onCheckedChange:t.getToggleSelectedHandler()})},{id:"name",header:"Name",accessorFn:t=>({name:t.name}),cell:({row:t})=>e.jsxs("div",{className:"flex min-w-[10rem] items-center space-x-2",children:[e.jsx(te,{className:"h-5 w-5 shrink-0 fill-primary-400"}),e.jsxs("div",{className:"group/copybutton flex flex-col",children:[e.jsx("div",{className:"grid grid-cols-1 items-center space-x-1",children:e.jsx("div",{className:"truncate text-text-md font-semibold text-theme-text-primary",children:t.original.name})}),e.jsx("div",{className:"flex items-center gap-1 text-text-sm text-theme-text-secondary",children:t.original.metadata?.description})]})]})},{id:"last-login",header:"Last Login",accessorFn:t=>t.metadata?.last_login,cell:({row:t})=>t.original.metadata?.last_login?e.jsx("p",{children:e.jsx(B,{short:!0,dateString:t.original.metadata?.last_login})}):e.jsx("p",{children:"Never"})},{id:"last-rotated",header:"Last Rotated",accessorFn:t=>t.metadata?.last_rotated,cell:({row:t})=>{const s=t.original.metadata?.last_rotated;if(!s)return e.jsx("p",{children:"Never"});const a=Ne(s),r=we(a),n=De(a);return e.jsxs("div",{children:[e.jsx("p",{children:e.jsx(B,{short:!0,dateString:s})}),(r||n)&&e.jsx("p",{className:`${n?"text-theme-text-error":"text-theme-text-warning"} text-text-xs`,children:n?"More than 1 year old":"More than 6 months old"})]})}},{id:"active",header:"Active",accessorFn:t=>t.body?.active,cell:({row:t})=>e.jsx(st,{isActive:!!t.original.body?.active,serviceAccountId:t.original.body?.service_account.id||"",apiKeyId:t.original.id})},{id:"actions",header:"",meta:{width:"5%"},cell:({row:t})=>{const s=t.original.body?.service_account.id;return s?e.jsx(Ee,{children:e.jsx(Xe,{serviceAccountId:s,apiKeyId:t.original.id})}):null}}]}function nt(){const{serviceAccountId:t}=I();return e.jsxs(J,{className:"flex flex-col items-center justify-center space-y-4 p-9",children:[e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold text-theme-text-primary",children:"This service account doesn't have any API Keys yet"}),e.jsx("p",{className:"text-theme-text-secondary",children:"Generate your first API Key to enable secure interactions with the ZenML Server."})]}),e.jsx(ae,{isFallback:!0,serviceAccountId:t})]})}function rt(){const{serviceAccountId:t}=I(),s=W(),{rowSelection:a,setRowSelection:r}=f(),n=x.useMemo(()=>at(),[]),{data:i}=R({...P.serviceAccountApiKeys(t,{...s,sort_by:"desc:created",hydrate:!0})});return i&&i?.items.length<1&&!s.name?e.jsx(nt,{}):e.jsxs(e.Fragment,{children:[e.jsx(it,{serviceAccountId:t}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:i?e.jsx(Ce,{getRowId:o=>o.id,rowSelection:a,onRowSelectionChange:r,columns:n,data:i.items}):e.jsx(y,{className:"h-[500px] w-full"})}),i?i.total_pages>1&&e.jsx(Me,{searchParams:s,paginate:i}):e.jsx(y,{className:"h-[36px] w-[300px]"})]})]})}function it({serviceAccountId:t}){const s=W(),{selectedRowCount:a}=f();return e.jsxs("div",{className:"mb-4 flex flex-wrap items-center justify-between gap-2",children:[a?e.jsx($e,{serviceAccountId:t}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Be,{searchParams:s})}),e.jsx(ae,{isFallback:!1,serviceAccountId:t})]})}function ot(t){const{setBreadcrumbs:s}=Ke();x.useEffect(()=>{t&&s([...Se,{label:t.name,href:ke.settings.service_accounts.detail(t.id)}])},[s,t])}function ct(){const{serviceAccountId:t}=I(),s=R({...P.serviceAccountDetail(t),throwOnError:!0});if(ot(s.data),s.isPending)return e.jsx(lt,{});if(s.isError)return null;const a=s.data;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Te,{size:"xl",serviceAccountName:a.name,serviceAccountAvatar:a.body?.avatar_url??void 0}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-text-xl font-semibold",children:a.name}),e.jsx(Pe,{size:"sm",color:a.body?.active?"light-purple":"light-grey",className:"text-text-xs font-semibold uppercase",children:a.body?.active?"active":"inactive"})]}),e.jsx("p",{className:"text-text-md text-theme-text-secondary",children:a.metadata?.description})]})]})}function lt(){return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{className:"h-9 w-9"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(y,{className:"h-6 w-[100px]"}),e.jsx(y,{className:"h-5 w-[50px]"})]}),e.jsx(y,{className:"h-5 w-[150px]"})]})]})}function Pt(){return e.jsxs(J,{className:"space-y-5 p-5",children:[e.jsxs("div",{children:[e.jsx(ct,{}),e.jsx("h1",{className:"my-5 text-text-lg font-semibold",children:"API Keys"})]}),e.jsx(Ve,{children:e.jsx(rt,{})})]})}export{Pt as default};
