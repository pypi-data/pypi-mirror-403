import{j as e}from"./@radix-Da0HZyg8.js";import{B as m,r as d,ax as b,F as D,G as S,H as T,J as k,bO as x,Q as R,U as A,L as f,R as B,N as P,O as g,a9 as _,V as E,W as L,X as F,Y as O,Z as I,_ as h,a6 as p,al as M,e as j,aa as z,k as H}from"./index-5CE1yoTL.js";import{S as Q}from"./SearchField-iVWx0Oy7.js";import{c as $,b as C}from"./@tanstack-BRZ8pkCt.js";import{L as u,f as G}from"./@react-router-BEwS6i40.js";import{c as U}from"./helper-BkxAcFl_.js";import{u as K}from"./bulk-delete-VX49K4z6.js";import{z as c}from"./@zod-yP6IINRw.js";import{P as J}from"./Pagination-CbsJYd8L.js";import{C as V,R as W}from"./resource-type-tooltip-15d1ytN4.js";import{e as X,R as Y,E as Z}from"./service-connectors-Cmmube7E.js";import{A as q}from"./action-cell-BKewukfe.js";import{a as y}from"./@monaco-editor-xs6rrDBC.js";import"./@elkjs-D2DP-mPJ.js";import"./@reactflow-CEST3EX2.js";import"./chevron-right-double-QOmxbkYg.js";function ee(){return e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-text-xl font-semibold",children:"Service Connectors"}),e.jsxs("p",{className:"text-text-sm text-theme-text-secondary",children:["Configure and manage your service connectors."," ",e.jsx("a",{target:"_blank",rel:"noreferrer noopener",href:"https://docs.zenml.io/how-to/infrastructure-deployment/auth-management",className:"link text-text-sm text-primary-400",children:"Learn More"})]})]})}function te(){return e.jsx(m,{size:"md",asChild:!0,children:e.jsxs(u,{to:d.settings.connectors.create,children:[e.jsx(b,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"New Connector"})]})})}async function se({connectorId:t}){const s=S(k.serviceConnectors.detail(t)),n=await D(s,{method:"DELETE"});if(!n.ok){const r=await n.json().then(o=>Array.isArray(o.detail)?o.detail[1]:o.detail).catch(()=>`Error while deleting connector ${t}`);throw new T({status:n.status,statusText:n.statusText,message:r})}return n.json()}function ne(t){return $({...t,mutationFn:async({connectorId:s})=>se({connectorId:s})})}const{ContextProvider:re,useContext:i}=U();function v(){const{setRowSelection:t}=i(),{mutateAsync:s}=ne();async function n(r){await s({connectorId:r})}return K({deleteFn:n,queryKeyToInvalidate:[...x.connectors],setRowSelection:t})}function w({deleteHandler:t}){return e.jsx(R,{title:"Delete Connectors",handleDelete:t,children:e.jsxs(A,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})}function oe({deleteHandler:t,open:s,setOpen:n}){return e.jsx(f,{open:s,onOpenChange:n,children:e.jsx(w,{deleteHandler:t})})}function ae(){const{selectedRowCount:t,selectedRowIDs:s}=i(),{bulkDelete:n}=v();async function r(){await n(s)}const o=B(t,"Service connector"),a=`${t} ${o} selected`;return e.jsxs("div",{className:"flex h-7 items-center divide-x divide-theme-border-moderate overflow-hidden rounded-md border border-theme-border-moderate",children:[e.jsx("div",{className:"bg-primary-25 px-2 py-1 font-semibold text-theme-text-brand",children:a}),e.jsxs(f,{children:[e.jsx(P,{asChild:!0,children:e.jsxs(m,{className:"rounded-sharp border-y-0 bg-white",size:"md",emphasis:"subtle",intent:"secondary",children:[e.jsx(g,{className:"h-5 w-5 shrink-0 gap-1 fill-neutral-400"}),"Delete"]})}),e.jsx(w,{deleteHandler:r})]})]})}function ce({queryParams:t}){const{selectedRowCount:s}=i();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[s>0?e.jsx(ae,{}):e.jsx(Q,{searchParams:t}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{queryParams:t}),e.jsx(te,{})]})]})})}function ie({queryParams:t}){const{refetch:s}=C(x.serviceConnectorList(t));return e.jsxs(m,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>s(),children:[e.jsx(_,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]})}const l=1,le=c.object({page:c.coerce.number().min(l).optional().default(l).catch(l),name:c.string().optional(),operator:c.enum(["and","or"]).optional()});function de(){const[t]=G(),{page:s,name:n,operator:r}=le.parse({page:t.get("page")||void 0,name:t.get("name")||void 0,sortBy:t.get("sort_by")||void 0});return{page:s,name:n,logical_operator:r}}function ue({id:t}){const[s,n]=y.useState(!1),{bulkDelete:r}=v();async function o(){await r([t]),n(!1)}return e.jsxs(e.Fragment,{children:[e.jsx(oe,{deleteHandler:o,open:s,setOpen:n}),e.jsxs(E,{children:[e.jsx(L,{asChild:!0,children:e.jsx(F,{children:e.jsx("span",{className:"sr-only",children:"Open connector actions"})})}),e.jsx(O,{align:"end",sideOffset:7,children:e.jsxs(I,{onSelect:()=>n(!0),className:"cursor-pointer space-x-2",children:[e.jsx(g,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Delete"})]})})]})]})}function me(){return y.useMemo(()=>[{id:"select",meta:{width:"1%"},header:({table:t})=>e.jsx(h,{id:"check-all",checked:t.getIsAllRowsSelected(),onCheckedChange:s=>t.toggleAllRowsSelected(s==="indeterminate"?!0:s)}),cell:({row:t})=>e.jsx(h,{id:`check-${t.id}`,checked:t.getIsSelected(),onCheckedChange:t.getToggleSelectedHandler()})},{id:"name",header:"Service Connector",accessorKey:"name",cell:({row:t})=>{const s=t.original.id,n=t.original.name,r=t.original.body?.connector_type;return e.jsxs("div",{className:"group/copybutton flex min-w-[10rem] items-center gap-2",children:[!!r&&typeof r!="string"&&e.jsx(V,{connectorType:r}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{to:d.settings.connectors.detail.configuration(s),className:"block grid max-w-[200px] grid-cols-1 text-text-md font-semibold",children:e.jsx("span",{className:"truncate",children:n})}),e.jsx(p,{copyText:n})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{to:d.settings.connectors.detail.configuration(s),children:s.split("-")[0]}),e.jsx(p,{copyText:s})]})]})]})}},{id:"resource_types",header(){return e.jsx("p",{className:"whitespace-nowrap",children:"Resource Types"})},cell:({row:t})=>{const s=X(t.original);return e.jsx("div",{className:"flex items-center gap-0.5",children:s.map((n,r)=>e.jsx(W,{resourceType:n},r))})}},{id:"resource-name",header(){return e.jsx("p",{className:"whitespace-nowrap",children:"Resource Name"})},cell:({row:t})=>e.jsx("div",{className:"max-w-[100px]",children:e.jsx(Y,{connector:t.original})})},{id:"user",header:"Author",accessorFn:t=>t.resources?.user?.name,cell:({row:t})=>{const s=t.original.resources?.user;return s?e.jsx(M,{className:"max-w-[200px] truncate",avatarUrl:s.body?.avatar_url??void 0,username:s.name,isServiceAccount:!!s.body?.is_service_account}):null}},{id:"expires",header(){return e.jsx("p",{className:"whitespace-nowrap",children:"Expires in"})},accessorFn:t=>t.body?.expires_at,cell:({row:t})=>{const s=t.original.body?.expires_at;return s?e.jsx(Z,{expires:s}):e.jsx("p",{children:"Never"})}},{id:"admin_actions",header:"",cell:({row:t})=>e.jsx(q,{children:e.jsx(ue,{id:t.original.id})})}],[])}function xe({queryParams:t}){const{rowSelection:s,setRowSelection:n}=i(),r=C({...x.serviceConnectorList(t)}),o=me();if(r.isPending)return e.jsxs("div",{className:"space-y-5",children:[e.jsx(j,{className:"h-[300px] w-full"}),e.jsx(j,{className:"mx-auto h-[36px] w-[300px]"})]});if(r.isError)return null;const a=r.data;return e.jsx("section",{className:"flex flex-col gap-5",children:e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:e.jsx(z,{columns:o,data:a.items,rowSelection:s,getRowId:N=>N.id,onRowSelectionChange:n})}),a.total_pages>1&&e.jsx(J,{searchParams:t,paginate:a})]})})}function he(){const s={...de(),sort_by:"desc:updated"};return e.jsxs(e.Fragment,{children:[e.jsx(ce,{queryParams:s}),e.jsx(xe,{queryParams:s})]})}function Be(){return e.jsxs(H,{className:"space-y-4 p-5",children:[e.jsx(ee,{}),e.jsx(re,{children:e.jsx(he,{})})]})}export{Be as default};
