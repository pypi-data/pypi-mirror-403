import{j as e}from"./@radix-Da0HZyg8.js";import{u as j,W as E,L as W}from"./LeftSideMenu-DjShBhjG.js";import{u as l,R as M,a as _,E as A,D as N,G as F,A as T,C as b,b as Z,N as O}from"./Partials-WzcXp3lX.js";import{e as w,k as C,c5 as V,B as Y,r as S}from"./index-5CE1yoTL.js";import{f as G,c as H}from"./@react-router-BEwS6i40.js";import{S as Q,C as f,P as h,a as q}from"./ProviderRadio-x4Ed2OfG.js";import{I as P}from"./Infobox-DQUJxLQz.js";import{u as D,t as I,F as J}from"./@zod-yP6IINRw.js";import{a as u}from"./@monaco-editor-xs6rrDBC.js";import{b as K,c as B,d as U,p as X}from"./persist-BaCE040n.js";import{C as p}from"./ProviderIcon-CIghFWTD.js";import{s as z}from"./index-DBB4a7BM.js";import{b as L}from"./@tanstack-BRZ8pkCt.js";import"./@elkjs-D2DP-mPJ.js";import"./Tick-hfrBQLs_.js";import"./check-DSoixTtU.js";import"./package-D71LpP3E.js";import"./credit-card-DPSBSlxw.js";import"./ComponentBadge-2JXtTfNH.js";import"./ComponentIcon-B7M5n_Xi.js";import"./bar-chart-square-check-DzUJ9YmH.js";import"./layout-2GM5rzX8.js";import"./transform-pqykL0RU.js";import"./CodeSnippet-BTWWMvCC.js";import"./NumberBox-B22H4TMO.js";import"./@reactflow-CEST3EX2.js";import"./alert-triangle-C7ryTF32.js";import"./sharedSchema-g4P6EjKg.js";import"./index.es-BLCCg0nE.js";import"./stack-detail-query-D9Y3CiUb.js";function $(){const{formRef:t,setIsNextButtonDisabled:s,setData:a,data:o}=l(),i=D({resolver:I(K),mode:"onChange",defaultValues:{region:o.location,stackName:o.stackName||""}});u.useEffect(()=>{s(!i.formState.isValid)},[i.formState.isValid,s]);function c(r){a(d=>({...d,location:r.region,stackName:r.stackName}))}return e.jsx(x,{title:"Review Stack Configuration",children:e.jsx(J,{...i,children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs(P,{className:"text-text-sm",children:[e.jsx("p",{className:"font-semibold",children:"Important"}),e.jsx("p",{children:"This will create new resources in your account. Ensure you have the necessary permissions and are aware of any potential costs."})]}),e.jsxs("form",{onSubmit:i.handleSubmit(c),ref:t,className:"space-y-5",children:[e.jsx(M,{provider:o.provider||"aws"}),e.jsx(Q,{})]}),e.jsx(_,{provider:o.provider||"aws"}),e.jsx(A,{provider:o.provider||"aws"})]})})})}function ee(){const{data:t,timestamp:s,setIsNextButtonDisabled:a}=l(),{setCurrentStep:o}=j(),{isPending:i,isError:c,data:r}=L({...z.stackDeploymentStack({provider:t.provider,stack_name:t.stackName,date_start:s}),refetchInterval:5e3,throwOnError:!0});return u.useEffect(()=>{r&&(B(),o(d=>d+1),a(!1))},[r]),i?e.jsx(w,{className:"h-[200px] w-full"}):c?null:e.jsxs("div",{className:"space-y-5",children:[e.jsx(te,{}),e.jsx(se,{stack:r})]})}function te(){const{data:t}=l();return e.jsxs("section",{className:"space-y-5 border-b border-theme-border-moderate pb-5",children:[e.jsxs(C,{className:"flex items-center justify-between gap-4 px-6 py-5",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(p,{provider:t.provider,className:"h-6 w-6 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-text-lg font-semibold",children:"Deploying the Stack..."}),e.jsx("p",{className:"text-theme-text-secondary",children:"Follow the steps in your Cloud console to finish the setup. You can come back to check once your components are deployed."})]})]}),t.provider==="azure"?e.jsx(N,{children:e.jsx("span",{children:"Deploy in Azure"})}):e.jsx(N,{})]}),t.provider==="gcp"&&e.jsx(F,{}),t.provider==="azure"&&e.jsx(T,{})]})}function se({stack:t}){const s=!!t;return e.jsxs("div",{className:"space-y-5",children:[!s&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-1 text-text-lg font-semibold",children:[e.jsx(V,{className:"h-5 w-5 fill-primary-400"}),"Creating your stack and components..."]}),e.jsx("p",{className:"text-theme-text-secondary",children:"We are creating your stack and stack components based on your configuration. Once you finish the setup, come back to check your brand new stack and components ready."})]}),e.jsx(ae,{isReady:s}),e.jsx(re,{stack:t})]})}function re({stack:t}){const s=!!t,{data:a}=l();return e.jsxs("div",{className:"relative overflow-hidden rounded-md",children:[!s&&e.jsx("div",{className:"absolute z-50 h-full w-full bg-neutral-50/50"}),e.jsx(b,{type:a.provider,componentProps:{isLoading:!s,isSuccess:s,stackName:a.stackName}})]})}function ae({isReady:t}){const[s,a]=u.useState(!1);return u.useEffect(()=>{const o=setTimeout(()=>{a(!0)},3e5);return()=>clearTimeout(o)},[]),!s||t?null:e.jsx(P,{children:"Your stack is taking longer than usual to deploy. Please check your Cloud console, or the stacks list in ZenML."})}function oe(){return e.jsx(x,{title:"Deploy ZenML Stack",children:e.jsx(ie,{})})}function ie(){const{setIsNextButtonDisabled:t,isLoading:s}=l();return u.useEffect(()=>{t(!0)},[]),s?e.jsx(ee,{}):e.jsx(Z,{})}function ne(){const{formRef:t,setIsNextButtonDisabled:s,setData:a,data:o}=l(),{register:i,handleSubmit:c,formState:{isValid:r}}=D({resolver:I(U),defaultValues:{provider:o.provider}});u.useEffect(()=>{s(!r)},[r,s]);function d(m){a(n=>({...n,provider:m.provider}))}return e.jsx(x,{title:"New Cloud Infrastructure",children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-lg font-semibold",children:"Select a Cloud Provider"}),e.jsx("p",{className:"text-theme-text-secondary",children:"Select the cloud provider where your want to create your infrastructure and deploy your ZenML models. You will be able to remove the ZenML stack at any time."})]}),e.jsxs("form",{id:"provider-form",onSubmit:c(d),className:"grid grid-cols-1 gap-3 xl:grid-cols-3",ref:t,children:[e.jsx(f,{id:"aws-provider",...i("provider"),value:"aws",children:e.jsx(h,{icon:e.jsx(p,{provider:"aws",className:"h-6 w-6 shrink-0"}),title:"AWS",subtitle:"ZenML stack with S3, ECR, and SageMaker integration"})}),e.jsx(f,{id:"gcp-provider",...i("provider"),value:"gcp",children:e.jsx(h,{icon:e.jsx(p,{provider:"gcp",className:"h-6 w-6 shrink-0"}),title:"GCP",subtitle:"Create ZenML infrastructure using GCS, Artifact Registry, and Vertex AI"})}),e.jsx(f,{id:"azure-provider",...i("provider"),value:"azure",children:e.jsx(h,{icon:e.jsx(p,{provider:"azure",className:"h-6 w-6 shrink-0"}),title:"Azure",subtitle:"Set up ZenML with Azure Storage, Container Registry, and ML services"})})]})]})})}function ce({provider:t,stackName:s,timestamp:a,isTerraform:o}){const{isPending:i,isError:c,data:r}=L({...z.stackDeploymentStack({provider:t,stack_name:s,date_start:a,terraform:o}),throwOnError:!0});if(i)return e.jsx(w,{className:"h-[200px] w-full"});if(c)return null;const d=r.stack.name,m=r.stack.metadata?.components.orchestrator,n=r.stack.metadata?.components.artifact_store,v=r.stack.metadata?.components.container_registry,g=r.stack.metadata?.components.image_builder,y=r.stack.metadata?.components.step_operator,R={orchestrator:{name:m?.[0]?.name??"Orchestrator",id:m?.[0]?.id.split("-")[0]??""},artifactStore:{name:n?.[0]?.name??"Artifact Store",id:n?.[0]?.id.split("-")[0]??""},registry:{name:v?.[0]?.name??"Container Registry",id:v?.[0]?.id.split("-")[0]??""},connector:{name:r.service_connector?.name,id:r.service_connector?.id?.split("-")[0]??""},imageBuilder:{name:g?.[0]?.name??"Image Builder",id:g?.[0]?.id.split("-")[0]??""},operator:{name:y?.[0]?.name??"Step Operator",id:y?.[0]?.id.split("-")[0]??""}};return e.jsx(b,{type:t,componentProps:{components:R,isSuccess:!0,stackName:d}})}function de(){const{setIsNextButtonDisabled:t,data:s,timestamp:a}=l();return t(!1),e.jsx(x,{title:"Your Stack",children:e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-theme-text-secondary",children:"Here you can review the created stack and stack components. Now you can start running pipelines using this new configuration."}),e.jsx(ce,{provider:s.provider||"aws",stackName:s.stackName||"",timestamp:a})]})})}function le(){const{currentStep:t}=j();if(t===1)return e.jsx(ne,{});if(t===2)return e.jsx($,{});if(t===3)return e.jsx(oe,{});if(t===4)return e.jsx(de,{})}function me(){const[s]=G(),{setCurrentStep:a,currentStep:o}=j(),{formRef:i,isNextButtonDisabled:c}=l(),r=H(),d=s.get("origin")==="onboarding";async function m(){i.current&&(i.current.requestSubmit(),await new Promise(n=>setTimeout(n,20))),a(n=>n<4?n+1:n),o===4&&(B(),r(d?S.onboarding:S.stacks.overview))}return e.jsx(Y,{form:i.current?.id,disabled:c,onClick:()=>m(),size:"md",children:o===4?"Finish":"Next"})}function x({children:t,title:s}){return e.jsxs(C,{className:"w-full",children:[e.jsx("div",{className:"border-b border-theme-border-moderate px-5 py-3 text-display-xs font-semibold",children:s}),e.jsx("div",{className:"p-5",children:t}),e.jsxs("div",{className:"flex items-center justify-end gap-2 border-t border-theme-border-moderate p-5",children:[e.jsx(q,{}),e.jsx(me,{})]})]})}const k=["Infrastructure Type","Cloud Provider","Review Configuration","Deploy Stack"];function Oe(){const{success:t}=X();return e.jsx(E,{maxSteps:k.length,initialStep:t?3:1,children:e.jsx(O,{children:e.jsxs("section",{className:"layout-container flex flex-col gap-5 p-5 xl:flex-row",children:[e.jsx(W,{entries:k}),e.jsx("div",{className:"w-full overflow-y-hidden",children:e.jsx(le,{})})]})})})}export{Oe as default};
