import{j as e}from"./@radix-Da0HZyg8.js";import{F as v,G as w,ay as Q,H as b,J as D,L as I,Q as $,U as z,bv as k,V as K,W as U,X as R,Y as G,Z as g,bF as H,O as C,r as y,a6 as N,al as J,am as W,u as X,e as f,bw as Y,B as o,ax as E,bx as Z,by as ee,D as se,x as te,I as x,bc as ae,bB as re,bC as ne,bD as le,aa as ie,k as ce}from"./index-5CE1yoTL.js";import{P as oe}from"./Pagination-CbsJYd8L.js";import{S as de}from"./SearchField-iVWx0Oy7.js";import{E as me,S as ue,s as xe,a as he}from"./SecretTooltip-N-SM9kc5.js";import{c as T,e as F,b as pe}from"./@tanstack-BRZ8pkCt.js";import{S as fe}from"./Lock-BrNKO9KL.js";import{A as je}from"./action-cell-BKewukfe.js";import{c as ge}from"./code-snippets-Cro2ORGr.js";import{L as S,f as ye}from"./@react-router-BEwS6i40.js";import{a as j}from"./@monaco-editor-xs6rrDBC.js";import{z as d,u as Ne,t as Se,b as ve,C as h}from"./@zod-yP6IINRw.js";import{S as we}from"./eye-eI-BtIGe.js";import"./@elkjs-D2DP-mPJ.js";import"./@reactflow-CEST3EX2.js";import"./chevron-right-double-QOmxbkYg.js";import"./CodeSnippet-BTWWMvCC.js";async function be(s){const t=w(D.secrets.detail(s)),a=await v(t,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(a.status===404&&Q(),!a.ok)throw new b({message:"Error deleting secret",status:a.status,statusText:a.statusText});return a.json()}function De(s){return T({mutationFn:async t=>be(t),...s})}function ke({secretId:s,open:t,setOpen:a}){const r=F(),{mutate:c}=De({onSuccess(){r.invalidateQueries({queryKey:["secrets"]})}});function m(){c(s)}return e.jsx(I,{open:t,onOpenChange:a,children:e.jsx($,{title:"Delete Secret",handleDelete:m,children:e.jsxs(z,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})})}function Ce({secretId:s}){const[t,a]=j.useState(!1),[r,c]=j.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(ke,{secretId:s,open:t,setOpen:a}),e.jsx(k,{open:r,onOpenChange:c,children:e.jsx(me,{secretId:s,isSecretNameEditable:!0,dialogTitle:"Edit secret"})}),e.jsxs(K,{children:[e.jsx(U,{asChild:!0,children:e.jsx(R,{children:e.jsx("span",{className:"sr-only",children:"Open secret actions"})})}),e.jsxs(G,{align:"end",sideOffset:7,children:[e.jsxs(g,{onSelect:()=>c(!0),className:"cursor-pointer space-x-2",children:[e.jsx(H,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Edit"})]}),e.jsxs(g,{onSelect:()=>a(!0),className:"cursor-pointer space-x-2",children:[e.jsx(C,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Delete"})]})]})]})]})}const Ee=[{id:"secret",header:"Secret",accessorFn:s=>s.name,cell:({getValue:s,row:t})=>{const a=ge(t.original.name);return e.jsxs("div",{className:"flex min-w-[10rem] items-center space-x-2",children:[e.jsx(fe,{className:"h-5 w-5 shrink-0 fill-primary-400"}),e.jsxs("div",{className:"group/copybutton flex flex-col",children:[e.jsxs("div",{className:"flex flex-row items-center space-x-1",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(S,{className:"grid grid-cols-1 text-text-md font-semibold text-theme-text-primary",to:y.settings.secrets.detail(t.original.id),children:e.jsx("span",{className:"truncate",children:t.original.name})}),e.jsx(ue,{code:a})]}),e.jsx(N,{copyText:s()})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{to:y.settings.secrets.detail(t.original.id),className:"flex items-center gap-1 text-text-sm text-theme-text-secondary",children:t.original.id.slice(0,8)}),e.jsx(N,{copyText:t.original.id})]})]})]})}},{id:"author",header:"Author",accessorFn:s=>s.resources?.user?.name,cell:({row:s})=>{const t=s.original.resources?.user;return t?e.jsx(J,{avatarUrl:t.body?.avatar_url??void 0,username:t.name,isServiceAccount:!!t.body?.is_service_account}):null}},{id:"created_at",header:"Created At",accessorFn:s=>s.body?.created,cell:({getValue:s})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(W,{dateString:s()})})},{id:"admin_actions",header:"",accessorFn:s=>String(s.id),cell:({row:s,getValue:t})=>{const a=t();return e.jsx(je,{children:s.original.resources?.user?.body?.is_admin?e.jsx(Ce,{secretId:a}):e.jsx("p",{className:"text-sm text-theme-text-secondary",children:"No Actions"})})}}],p=1,Te=d.object({page:d.coerce.number().min(p).optional().default(p).catch(p),name:d.string().optional(),operator:d.enum(["and","or"]).optional()});function Fe(){const[s]=ye(),{page:t,name:a,operator:r}=Te.parse({page:s.get("page")||void 0,name:s.get("name")||void 0,operator:s.get("operator")||void 0});return{page:t,name:a,logical_operator:r}}async function Pe(s){const t=w(D.secrets.all),a=await v(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok){const r=await a.json().then(c=>c.detail).catch(()=>"Failed to create Secret");throw new b({status:a.status,statusText:a.statusText,message:r})}return a.json()}function Ae(s){return T({mutationFn:async t=>Pe(t),...s})}function Oe(){const[s,t]=j.useState(!1),a=X();if(a.isPending)return e.jsx(f,{className:"h-7 w-full"});if(a.isError)return e.jsx("div",{children:"Error loading user"});const r=a.data.id;return e.jsxs(k,{open:s,onOpenChange:t,children:[e.jsx(Y,{asChild:!0,children:e.jsxs(o,{size:"md",className:"shrink-0",intent:"primary",children:[e.jsx(E,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"New Secret"})]})}),e.jsxs(Z,{className:"mx-auto w-[90vw] max-w-[744px]",children:[e.jsx(ee,{children:e.jsx(se,{children:"Register New Secret"})}),e.jsx(Ve,{userId:r,setOpen:t})]})]})}function Ve({userId:s,setOpen:t}){const{handleSubmit:a,control:r,watch:c,setValue:m,formState:{isValid:P},reset:A}=Ne({resolver:Se(xe),defaultValues:{secretName:"",keysValues:[{key:"",value:""}]}}),{fields:u,append:O,remove:V}=ve({control:r,name:"keysValues"}),{toast:_}=te(),q=F(),{mutate:L}=Ae({onError(n){le(n)&&_({status:"error",emphasis:"subtle",description:n.message,rounded:!0})},onSuccess(){q.invalidateQueries({queryKey:["secrets"]}),t(!1),A()}}),B=n=>{L({user:s,name:n.secretName,values:n.keysValues.reduce((l,i)=>(i.key&&i.value&&(l[i.key]=i.value),l),{})})},M=n=>{B(n)};return e.jsxs(e.Fragment,{children:[e.jsx("form",{id:"create-secret-form",className:"gap-5 p-5",onSubmit:a(M),children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("label",{className:"font-inter text-sm text-left font-medium leading-5",children:["Secret Name",e.jsx("span",{className:"ml-1 text-theme-text-error",children:"*"})]}),e.jsx(h,{name:"secretName",control:r,render:({field:n})=>e.jsx(x,{...n,className:"mb-3 w-full",required:!0})})]}),e.jsxs("div",{className:"mt-10",children:[e.jsx("div",{children:e.jsx("h1",{className:"font-inter text-lg text-left font-semibold",children:"Keys"})}),e.jsxs("div",{className:"mt-5 flex flex-row",children:[e.jsx("div",{className:"flex-grow",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Key"})}),e.jsx("div",{className:"flex-grow pr-12",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Value"})})]})]}),e.jsx(ae,{viewportClassName:"max-h-[35vh]",children:u.map((n,l)=>e.jsxs("div",{className:"flex flex-row items-center space-x-1",children:[e.jsx("div",{className:"relative flex-grow",children:e.jsx(h,{name:`keysValues.${l}.key`,control:r,render:({field:i})=>e.jsx(x,{...i,className:"mb-2 w-full",required:!0,placeholder:"key"})})}),e.jsx("div",{className:"relative flex-grow",children:e.jsxs("div",{className:"relative",children:[e.jsx(h,{name:`keysValues.${l}.value`,control:r,render:({field:i})=>e.jsx(x,{...i,className:"mb-2 w-full pr-10",required:!0,placeholder:"•••••••••",type:c(`keysValues.${l}.showPassword`)?"text":"password"})}),e.jsx("button",{type:"button",onClick:()=>{const i=c(`keysValues.${l}.showPassword`);m(`keysValues.${l}.showPassword`,!i)},className:"absolute inset-y-1 right-0 flex items-center pb-1 pr-3",children:e.jsx(we,{className:"h-4 w-4 flex-shrink-0"})})]})}),e.jsxs("div",{className:"flex items-center",children:[l===u.length-1&&e.jsx(o,{intent:"primary",emphasis:"subtle",onClick:()=>O({key:"",value:""}),className:"mb-2 flex h-7 w-7 items-center justify-center",children:e.jsx(E,{className:"flex-shrink-0 fill-primary-600"})}),l!==u.length-1&&e.jsx(o,{intent:"secondary",emphasis:"minimal",onClick:()=>V(l),className:"mb-2 h-7 w-7 items-center justify-center",children:e.jsx(C,{className:"flex-shrink-0 fill-theme-text-secondary"})})]})]},n.id))})]})}),e.jsxs(re,{className:"gap-[10px]",children:[e.jsx(ne,{asChild:!0,children:e.jsx(o,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(o,{intent:"primary",disabled:!P,type:"submit",form:"create-secret-form",children:"Register Secret"})]})]})}function _e(){const s=Fe(),{data:t}=pe({...he.secretList({...s,sort_by:"desc:created"}),throwOnError:!0});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(de,{searchParams:s}),e.jsx(Oe,{})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:t?e.jsx(ie,{columns:Ee,data:t.items}):e.jsx(f,{className:"h-[250px] w-full"})}),t?t.total_pages>1&&e.jsx(oe,{searchParams:s,paginate:t}):e.jsx(f,{className:"h-[36px] w-[300px]"})]})]})}function Ze(){return e.jsxs(ce,{className:"space-y-4 p-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-text-xl font-semibold",children:"Secrets"}),e.jsxs("p",{className:"text-text-sm text-theme-text-secondary",children:["Configure and manage your pipeline secrets and configurations."," ",e.jsx("a",{target:"_blank",rel:"noreferrer noopener",href:"https://docs.zenml.io/how-to/interact-with-secrets",className:"link text-primary-400",children:"Learn More"})]})]}),e.jsx(_e,{})]})}export{Ze as default};
