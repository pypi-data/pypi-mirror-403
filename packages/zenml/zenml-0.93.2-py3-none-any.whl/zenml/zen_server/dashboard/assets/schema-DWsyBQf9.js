import{j as e,aC as V,aD as Z,aG as y}from"./@radix-Da0HZyg8.js";import{C as $}from"./ComponentIcon-B7M5n_Xi.js";import{aj as p,S as q,B as x,I as O,a1 as Q,a2 as G,a3 as K,ak as J,a5 as W,by as B,D as E,bc as X,ap as Y,bB as ee,bC as te,bv as se,bw as ne,bx as re,cp as ae,bU as ie,aA as oe,aI as ce,s as le,al as de,am as me}from"./index-5CE1yoTL.js";import{a as h,C as pe,z as u}from"./@zod-yP6IINRw.js";import{s as b}from"./constants-Dj_C1ZPH.js";import{s as he}from"./index-DBB4a7BM.js";import{l as ue,k as xe}from"./@tanstack-BRZ8pkCt.js";import{L as fe}from"./@react-router-BEwS6i40.js";import{a as d}from"./@monaco-editor-xs6rrDBC.js";import{s as ge,R as ke,a as je}from"./common-BrpKozbR.js";import{S as be}from"./flavor-select-CiCagRUR.js";import{C as ye}from"./configuration-form-BwRgv-aT.js";import{s as ve}from"./sharedSchema-g4P6EjKg.js";function Ne({type:t}){const{watch:s,formState:{errors:n}}=h(),r=s(`components.${t}`),i=r&&r.id;return e.jsx("div",{"data-error":!i&&n.components&&n.components[t]?"true":"false","data-filled":i?"true":"false",className:"flex h-[110px] flex-col items-center justify-center space-y-2 truncate whitespace-nowrap rounded-md border border-theme-border-moderate bg-theme-surface-secondary py-5 text-center text-text-sm text-theme-text-secondary transition-all duration-150 hover:bg-theme-surface-primary hover:shadow-sm data-[error=true]:border-theme-text-error data-[filled=true]:border-success-400 data-[filled=true]:bg-theme-surface-primary data-[state=active]:bg-theme-surface-primary group-data-[state=active]/trigger:bg-theme-surface-primary group-data-[state=active]/trigger:shadow-md data-[error=false]:data-[filled=false]:group-data-[state=active]/trigger:border-theme-border-bold",children:i?e.jsx(Se,{type:t}):e.jsx(we,{type:t})})}function Se({type:t}){const{watch:s}=h(),n=s(`components.${t}`);return n&&n.id?e.jsxs("div",{className:"flex flex-col items-center gap-2 text-text-sm",children:[e.jsx("img",{width:24,height:24,src:n.logoUrl,alt:`Icon of ${n.name}`}),e.jsxs("div",{className:"space-y-0.25",children:[e.jsx("div",{className:"text-theme-text-primary",children:n.name}),e.jsx("div",{className:"text-text-xs text-theme-text-tertiary",children:p(t)})]})]}):null}function we({type:t}){return e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-5 w-5 shrink-0 fill-theme-text-tertiary group-data-[state=active]/trigger:fill-theme-surface-strong",type:t}),e.jsx("span",{children:p(t)})]})}function Je(){const{watch:t,setValue:s}=h();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-text-lg font-semibold",children:"Add Components"}),e.jsxs("p",{className:"text-theme-text-secondary",children:["All stacks have at minimum an orchestrator and an artifact store."," ",e.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:"https://docs.zenml.io/stacks#stack-components-guide",className:"link text-primary-400",children:"Learn more"})]})]}),e.jsx(V,{children:e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-4",children:b.map(n=>e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"group/trigger w-full",value:n,children:e.jsx(Ne,{type:n})}),t(`components.${n}.id`)&&e.jsx("button",{type:"button",onClick:r=>{r.preventDefault(),s(`components.${n}`,null)},className:"absolute right-[-12px] top-[-12px] flex aspect-square h-[28px] w-[28px] items-center justify-center rounded-rounded bg-theme-surface-primary",children:e.jsx(q,{className:"h-5 w-5 shrink-0 fill-success-400"})})]},n))})})]})}function We({cancelRoute:t,submitLabel:s,isLoading:n=!1}){const{formState:{isSubmitting:r}}=h(),i=!!ue({mutationKey:he.all}),c=r||i||n;return e.jsxs("div",{className:"flex items-center justify-end space-x-2 border-t border-theme-border-moderate p-5",children:[e.jsx(x,{asChild:!0,intent:"secondary",size:"md",children:e.jsx(fe,{to:t,children:"Cancel"})}),e.jsxs(x,{type:"submit",className:"flex items-center gap-1",disabled:c,size:"md",children:[c&&e.jsx("div",{role:"alert","aria-busy":"true",className:"full h-[20px] w-[20px] animate-spin rounded-rounded border-2 border-theme-text-negative border-b-theme-text-brand"}),s]})]})}function Xe(){const{register:t,formState:{errors:s}}=h();return e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-text-sm",htmlFor:"stack-name",children:"Stack Name"}),e.jsx(O,{id:"stack-name",className:`${s.stackName?"border-red-500":""} w-full`,placeholder:"zenml-stack",...t("stackName")}),e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:"The stack name must be unique and cannot match an existing stack."}),s.stackName&&e.jsx("p",{className:"text-text-xs text-red-500",children:s.stackName.message?.toString()})]})}const v={helpLink:"https://docs.zenml.io/stacks/stack-components/orchestrators",description:"An orchestrator is a special kind of backend that manages the running of each step of the pipeline. Orchestrators administer the actual pipeline runs. By default, ZenML initializes your repository with an orchestrator that runs everything on your local machine."},N={helpLink:"https://docs.zenml.io/stacks/stack-components/artifact-stores",description:"The Artifact Store is a central component in any MLOps stack. As the name suggests, it acts as a data persistence layer where artifacts (e.g. datasets, models) ingested or generated by the machine learning pipelines are stored."},S={helpLink:"https://docs.zenml.io/stacks/stack-components/container-registries",description:"Container registry is used to store container images that are built to run machine learning pipelines in remote environments. Containerization of the pipeline code creates a portable environment that allows code to run in an isolated manner."},w={description:"Step operators allow you to run individual steps in a custom environment different from the default one used by your active orchestrator.",helpLink:"https://docs.zenml.io/stacks/stack-components/step-operators"},C={description:"Model deployers are stack components responsible for online model serving. They are responsible for deploying models to a remote server. Model deployers also act as a registry for models that are served with ZenML.",helpLink:"https://docs.zenml.io/stacks/stack-components/model-deployers"},L={description:"ZenML supports connecting to a Redis-backed Feast feature store as a stack component integration.",helpLink:"https://docs.zenml.io/stacks/stack-components/feature-stores"},z={description:"Experiment trackers let you track your ML experiments by logging the parameters and allowing you to compare between different runs.",helpLink:"https://docs.zenml.io/stacks/stack-components/experiment-trackers"},T={description:"Alerters allow you to send messages to chat services (like Slack, Discord, Mattermost, etc.) from within your pipelines. This is useful to immediately get notified when failures happen, for general monitoring/reporting, and also for building human-in-the-loop ML.",helpLink:"https://docs.zenml.io/stacks/stack-components/alerters"},F={description:"Annotators are a stack component that enables the use of data annotation as part of your ZenML stack and pipelines.",helpLink:"https://docs.zenml.io/stacks/stack-components/annotators"},I={description:"Data Validators used in ZenML pipelines usually generate data profiles and data quality check reports that are versioned and stored in the Artifact Store and can be retrieved and visualized later.",helpLink:"https://docs.zenml.io/stacks/stack-components/data-validators"},D={description:"The image builder is an essential part of most remote MLOps stacks. It is used to build container images such that your machine-learning pipelines and steps can be executed in remote environments.",helpLink:"https://docs.zenml.io/stacks/stack-components/image-builders"},M={description:"Model registries are centralized storage solutions for managing and tracking machine learning models across various stages of development and deployment.",helpLink:"https://docs.zenml.io/stacks/stack-components/model-registries"},A={description:"Deployers transform ML pipelines into long-running HTTP services for real-time, on-demand execution through API endpoints.",helpLink:"https://docs.zenml.io/stacks/stack-components/deployers"},_={description:"Log stores are responsible for storing the logs of the pipeline runs.",helpLink:"https://docs.zenml.io/stacks/stack-components/log-stores"};function Ce({type:t}){const{description:s,link:n}=Le(t);return e.jsx(Q,{children:e.jsxs(G,{delayDuration:200,children:[e.jsxs(K,{children:[e.jsx(J,{className:"h-4 w-4 shrink-0 fill-theme-text-tertiary"}),e.jsxs("div",{className:"sr-only",children:["Info for ",t]})]}),e.jsxs(W,{align:"start",side:"bottom",className:"flex max-w-xl flex-col gap-2 bg-theme-surface-primary p-5 text-text-sm text-theme-text-primary",children:[e.jsx("p",{children:s}),e.jsx("a",{className:"link mt-2 text-primary-400",target:"_blank",href:n,children:"Learn more"})]})]})})}function Le(t){switch(t){case"orchestrator":return{description:v.description,link:v.helpLink};case"alerter":return{description:T.description,link:T.helpLink};case"annotator":return{description:F.description,link:F.helpLink};case"artifact_store":return{description:N.description,link:N.helpLink};case"container_registry":return{description:S.description,link:S.helpLink};case"data_validator":return{description:I.description,link:I.helpLink};case"experiment_tracker":return{description:z.description,link:z.helpLink};case"feature_store":return{description:L.description,link:L.helpLink};case"image_builder":return{description:D.description,link:D.helpLink};case"model_deployer":return{description:C.description,link:C.helpLink};case"model_registry":return{description:M.description,link:M.helpLink};case"step_operator":return{description:w.description,link:w.helpLink};case"deployer":return{description:A.description,link:A.helpLink};case"log_store":return{description:_.description,link:_.helpLink}}}function ze({type:t,setSelectedFlavor:s}){return e.jsxs(e.Fragment,{children:[e.jsx(B,{children:e.jsxs(E,{children:["Select ",p(t)," Flavor"]})}),e.jsx(X,{viewportClassName:"max-h-[70vh]",children:e.jsx("div",{className:"p-5",children:e.jsx(be,{setSelectedFlavor:s,type:t})})})]})}function Te({name:t,id:s,backHandler:n,type:r,successHandler:i}){const c=d.useId();return e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-full",children:e.jsxs("div",{className:"flex w-0 flex-1 items-center gap-2",children:[e.jsxs(x,{intent:"secondary",emphasis:"subtle",className:"flex aspect-square size-6 items-center justify-center",onClick:()=>n(),children:[e.jsx(Y,{className:"size-5 shrink-0"}),e.jsx("span",{className:"sr-only",children:"Go step back"})]}),e.jsxs(E,{className:"truncate",children:["Configure your ",p(t)," ",p(r)]})]})}),e.jsx(ye,{useMaxHeight:!0,flavorId:s,formId:c,successHandler:i,FooterComponent:Fe})]})}function Fe({formId:t,isPending:s}){return e.jsx(ee,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{asChild:!0,children:e.jsx(x,{size:"md",intent:"secondary",children:"Cancel"})}),e.jsxs(x,{size:"md",disabled:s,type:"submit",form:t,children:[s&&e.jsx("div",{role:"alert","aria-busy":"true",className:"full h-[20px] w-[20px] animate-spin rounded-rounded border-2 border-theme-text-negative border-b-theme-text-brand"}),"Register Component"]})]})})}function Ie({type:t}){const[s,n]=d.useState(!1),[r,i]=d.useState(0),[c,o]=d.useState(null);async function m(l){n(l),await ge(100),l||(i(0),o(null))}function g(l){o({id:l.id,name:l.name,logoUrl:l.body?.logo_url??void 0}),i(a=>a+1)}function k(){i(0),o(null)}return e.jsxs(se,{open:s,onOpenChange:l=>m(l),children:[e.jsx(ne,{asChild:!0,children:e.jsxs("button",{className:"w-full rounded-md border border-dashed border-neutral-300 bg-theme-surface-tertiary py-5 text-theme-text-secondary",children:["New ",p(t)]})}),e.jsxs(re,{className:"w-full sm:max-w-[640px] md:max-w-3xl xl:max-w-[1080px]",children:[r===0&&e.jsx(ze,{setSelectedFlavor:g,type:t}),r===1&&!!c&&e.jsx(Te,{successHandler:()=>m(!1),backHandler:k,...c,type:t})]})]})}function Ye({initialComponents:t}){return e.jsxs(e.Fragment,{children:[b.map(s=>e.jsx(y,{className:"space-y-5 p-5",value:s,children:e.jsx(Ae,{type:s,initialComponents:t})},s)),e.jsx(y,{className:"h-full",value:"",children:e.jsx("div",{className:"flex h-full w-full items-center justify-center text-theme-text-tertiary",children:"Select a category to add a new component"})})]})}function De({type:t,search:s,initialComponent:n}){const r=xe({...oe.componentListInfinite({sort_by:"desc:updated",type:t,...s?{name:`contains:${s}`}:{}})}),{control:i,watch:c,setValue:o}=h();if(r.isError)return e.jsx("p",{children:"Error while fetching Components"});if(r.isPending)return e.jsx("div",{className:"flex w-full flex-1 items-center justify-center",children:e.jsx(ce,{})});const m=new Set(r.data.pages.flatMap(a=>a.items.map(f=>f.id))),g=n?.id&&!m.has(n.id)&&!s,k=c(`components.${t}.id`),l=[...g&&n?[n]:[],...r.data.pages.flatMap(a=>a.items)];return e.jsxs("div",{className:"space-y-1 pb-3",children:[e.jsx("ul",{className:"space-y-1",children:l.map(a=>{const f=k===a.id,R=m.has(a.id);return e.jsx("li",{children:e.jsx(pe,{name:`components.${t}.id`,control:i,render:({field:{onChange:U,...H}})=>e.jsxs(ke,{className:"justify-between bg-theme-surface-primary font-medium","data-state":f?"selected":"unselected",htmlFor:a.id,children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-2",children:[e.jsx(je,{...H,id:a.id,type:"radio",value:a.id,onChange:P=>{o(`components.${t}.name`,a.name),o(`components.${t}.logoUrl`,a.body?.logo_url||""),U(P)},checked:f,name:t}),e.jsx("img",{alt:"flavor icon",src:le(a.body?.logo_url||""),width:24,height:24}),e.jsxs("div",{className:"min-w-0 truncate",children:[e.jsx("div",{className:"truncate font-semibold",children:a.name}),e.jsx("div",{className:"truncate text-text-xs text-theme-text-secondary",children:a.id.split("-")[0]})]})]}),R&&e.jsxs("div",{className:"flex items-center gap-2 text-text-sm",children:[a.resources?.user&&e.jsx(de,{avatarUrl:a.resources.user.body?.avatar_url??void 0,username:a.resources.user.name,isServiceAccount:!!a.resources.user.body?.is_service_account}),a.body?.updated&&e.jsx("div",{className:"whitespace-nowrap text-theme-text-secondary",children:e.jsx(me,{short:!0,dateString:a.body.updated})})]})]})})},a.id)})}),e.jsx(Ie,{type:t}),r.hasNextPage&&e.jsx(x,{onClick:()=>r.fetchNextPage(),type:"button",size:"md",intent:"secondary",emphasis:"subtle",className:"flex w-full items-center justify-center bg-theme-surface-primary",children:e.jsxs("div",{className:"flex items-center gap-1",children:[r.isFetchingNextPage&&e.jsx("div",{role:"alert","aria-busy":"true",className:"full h-[20px] w-[20px] animate-spin rounded-rounded border-2 border-theme-text-negative border-b-theme-text-brand"}),"Load more"]})})]})}function Me({type:t}){return e.jsxs("section",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{className:"h-5 w-5 fill-primary-400",type:t}),e.jsx("h2",{className:"text-text-lg font-semibold",children:p(t)}),e.jsx(Ce,{type:t})]}),e.jsxs("p",{className:"text-theme-text-secondary",children:["Select a existing ",ae(t)," from your server:"]})]})}function Ae({type:t,initialComponents:s}){const[n,r]=d.useState(""),{watch:i,setValue:c}=h(),o=i(`components.${t}`),m=s?.[t]?.[0];return d.useEffect(()=>{o&&!o.id&&c(`components.${t}`,null)},[o,c,t]),e.jsxs(e.Fragment,{children:[e.jsx(Me,{type:t}),e.jsx(_e,{search:n,setSearch:r}),e.jsx(De,{initialComponent:m,search:n,type:t})]})}function _e({setSearch:t,search:s}){const[n,r]=d.useState(s),i=d.useCallback(ie(t,500),[]);d.useEffect(()=>()=>{i.cancel()},[i]);function c(o){r(o),i(o)}return e.jsx(O,{value:n,onChange:o=>c(o.target.value),placeholder:"Search..."})}const j=u.object({id:u.string().trim().min(1),name:u.string().trim().min(1),logoUrl:u.string().trim().min(1)}),$e=b.reduce((t,s)=>(t[s]=j.nullable(),t),{}),et=t=>u.object({stackName:ve(t),components:u.object({...$e,orchestrator:j,artifact_store:j})});export{Je as A,Ye as C,Xe as S,We as a,et as f};
