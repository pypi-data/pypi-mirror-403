import{j as e}from"./@radix-Da0HZyg8.js";import{F as L,G as I,H,J as M,aA as T,a8 as O,a0 as Q,r as x,aT as $,a1 as U,a2 as q,a3 as G,a4 as K,a5 as J,a6 as h,am as g,B as d,a9 as y,aa as v,e as m,A as V,h as W,al as A,i as X,j as Y,c3 as Z,Q as ee,U as se,L as P,V as te,W as ae,X as ne,Y as re,Z as w,bF as ie,O as F,_ as S,s as k,aj as le,T as ce,R as oe,N as de,ax as me}from"./index-5CE1yoTL.js";import{P as N}from"./Pagination-CbsJYd8L.js";import{S as b}from"./SearchField-iVWx0Oy7.js";import{c as xe,b as _}from"./@tanstack-BRZ8pkCt.js";import{L as j,c as he,f as ue}from"./@react-router-BEwS6i40.js";import{S as pe}from"./expand-full-BzNS_BcJ.js";import{R as je,S as fe}from"./resizable-sheet-9BWc3wg3.js";import{S as ge}from"./Tabs-CGZUCcrK.js";import{u as ye}from"./all-pipeline-runs-query-DNuzZZgC.js";import{a as u}from"./@monaco-editor-xs6rrDBC.js";import{s as ve}from"./index-DBB4a7BM.js";import{C as Ne}from"./ComponentBadge-2JXtTfNH.js";import{A as be}from"./action-cell-BKewukfe.js";import{I as Ce}from"./Infobox-DQUJxLQz.js";import{c as we}from"./helper-BkxAcFl_.js";import{u as Se}from"./bulk-delete-VX49K4z6.js";import{z as p}from"./@zod-yP6IINRw.js";async function ke({componentId:s}){const t=I(M.components.detail(s)),a=await L(t,{method:"DELETE"});if(!a.ok){const n=await a.json().then(r=>Array.isArray(r.detail)?r.detail[1]:r.detail).catch(()=>`Error while deleting component ${s}`);throw new H({status:a.status,statusText:a.statusText,message:n})}return a.json()}function De(s){return xe({...s,mutationFn:async({componentId:t})=>ke({componentId:t})})}const{ContextProvider:ts,useContext:C}=we();function R(){const{setRowSelection:s}=C(),{mutateAsync:t}=De();async function a(n){await t({componentId:n})}return Se({deleteFn:a,queryKeyToInvalidate:T.all,setRowSelection:s})}const Te=[{id:"name",header:"Run",accessorFn:s=>({id:s.id,name:s.name,status:s.body?.status,index:s.body?.index}),cell:({getValue:s})=>{const{name:t,status:a,id:n,index:r}=s();return e.jsxs("div",{className:"group/copybutton flex min-w-[10rem] items-center gap-2",children:[e.jsx(O,{className:`h-5 w-5 shrink-0 ${Q(a)}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{to:x.projects.runs.detail(n),className:"grid grid-cols-1 items-center gap-1",children:e.jsx("span",{className:"truncate text-text-md font-semibold text-theme-text-primary",children:e.jsx($,{name:t,index:r})})}),e.jsx(U,{children:e.jsxs(q,{children:[e.jsx(G,{className:"hover:text-theme-text-brand hover:underline",children:e.jsx(K,{status:a})}),e.jsx(J,{className:"z-20 capitalize",children:a})]})}),e.jsx(h,{copyText:t})]}),e.jsxs(j,{to:x.projects.runs.detail(n),className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:n.split("-")[0]}),e.jsx(h,{copyText:n})]})]})]})}},{id:"created-at",header:"Created at",accessorFn:s=>({date:s.body?.created}),cell:({getValue:s})=>{const{date:t}=s();return e.jsx("div",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(g,{dateString:t})})}}];function Ae({componentId:s}){const[t,a]=u.useState(void 0),[n,r]=u.useState(1),c={name:t,page:n},{data:l,refetch:o}=ye({params:{...c,stack_component:s,sort_by:"desc:updated"}});return e.jsx("section",{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(b,{inMemoryHandler:i=>{r(1),i||a(void 0),a(`contains:${i}`)},searchParams:{}})}),e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs(d,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>o(),children:[e.jsx(y,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:l?e.jsx(v,{columns:Te,data:l.items}):e.jsx(m,{className:"h-[500px] w-full"})}),l?l.total_pages>1&&e.jsx(N,{inMemoryHandler:r,searchParams:{},paginate:l}):e.jsx(m,{className:"h-[36px] w-[300px]"})]})]})})}function Pe(){return[{id:"name",header:"Stack",accessorFn:s=>s.name,cell:({row:s})=>{const{name:t,id:a}=s.original;return e.jsxs("div",{className:"group/copybutton flex min-w-[10rem] items-center gap-2",children:[e.jsx(V,{type:"square",size:"md",className:"shrink-0",children:e.jsx(W,{size:"md",children:t[0]})}),e.jsxs("div",{children:[e.jsx("div",{className:"grid grid-cols-1 items-center gap-1",children:e.jsx("h2",{className:"truncate text-text-md font-semibold",children:t})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:a.split("-")[0]}),e.jsx(h,{copyText:a})]})]})]})}},{id:"author",header:"Author",accessorFn:s=>({author:s.resources?.user}),cell:({getValue:s})=>{const{author:t}=s();return t?e.jsx(A,{avatarUrl:t.body?.avatar_url??void 0,username:t.name,isServiceAccount:!!t.body?.is_service_account}):null}},{id:"created",header:"Created at",accessorFn:s=>s.body?.created,cell:({getValue:s})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(g,{dateString:s()})})}]}function Fe({componentId:s}){const[t,a]=u.useState(void 0),[n,r]=u.useState(1),c={name:t,page:n},{refetch:l,data:o}=_(ve.stackList({...c,component_id:s,sort_by:"desc:updated"}));return e.jsx("section",{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(b,{inMemoryHandler:i=>{r(1),i||a(void 0),a(`contains:${i}`)},searchParams:{}})}),e.jsx("div",{className:"flex items-center justify-between gap-2",children:e.jsxs(d,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>l(),children:[e.jsx(y,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:o?e.jsx(v,{columns:Pe(),data:o.items}):e.jsx(m,{className:"h-[500px] w-full"})}),o?o.total_pages>1&&e.jsx(N,{inMemoryHandler:r,searchParams:{},paginate:o}):e.jsx(m,{className:"h-[36px] w-[300px]"})]})]})})}function D({children:s,onOpenChange:t,componentId:a}){return e.jsxs(X,{onOpenChange:t,children:[e.jsx(Y,{asChild:!0,children:s}),e.jsxs(je,{className:"overflow-y-auto",children:[e.jsx(fe,{className:"gap-0.5",children:e.jsx(d,{className:"flex aspect-square items-center justify-center p-0",intent:"secondary",asChild:!0,emphasis:"minimal",children:e.jsxs(j,{to:x.components.detail(a),children:[e.jsx(pe,{className:"h-5 w-5 shrink-0 fill-neutral-500"}),e.jsx("span",{className:"sr-only",children:"Expand component detail to page"})]})})}),e.jsxs("div",{className:"@container",children:[e.jsx(Z,{isPanel:!0,componentId:a}),e.jsx(ge,{isPanel:!0,runsTabContent:e.jsx(Ae,{componentId:a}),stacksTabContent:e.jsx(Fe,{componentId:a}),componentId:a})]})]})]})}function E({deleteHandler:s}){return e.jsx(ee,{title:"Delete Components",handleDelete:s,children:e.jsxs(se,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."}),e.jsx(Ce,{className:"mt-4 text-theme-text-primary",children:"If a component is still part of a stack, it will not be deleted."})]})})}function _e({deleteHandler:s,open:t,setOpen:a}){return e.jsx(P,{open:t,onOpenChange:a,children:e.jsx(E,{deleteHandler:s})})}function Re({id:s}){const[t,a]=u.useState(!1),n=he(),{bulkDelete:r}=R();async function c(){await r([s]),a(!1)}return e.jsxs(e.Fragment,{children:[e.jsx(_e,{deleteHandler:c,open:t,setOpen:a}),e.jsxs(te,{children:[e.jsx(ae,{asChild:!0,children:e.jsx(ne,{children:e.jsx("span",{className:"sr-only",children:"Open component actions"})})}),e.jsxs(re,{align:"end",sideOffset:7,children:[e.jsxs(w,{onSelect:()=>n(x.components.edit(s)),className:"cursor-pointer space-x-2",children:[e.jsx(ie,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Edit"})]}),e.jsxs(w,{onClick:()=>a(!0),className:"cursor-pointer space-x-2",children:[e.jsx(F,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Delete"})]})]})]})]})}function Ee(){return[{id:"select",meta:{width:"1%"},header:({table:s})=>e.jsx(S,{id:"check-all",checked:s.getIsAllRowsSelected(),onCheckedChange:t=>s.toggleAllRowsSelected(t==="indeterminate"?!0:t)}),cell:({row:s})=>e.jsx(S,{id:`check-${s.id}`,checked:s.getIsSelected(),onCheckedChange:s.getToggleSelectedHandler()})},{id:"name",header:"Component",accessorKey:"name",cell:({row:s})=>{const t=s.original.id,a=s.original.name;return e.jsxs("div",{className:"group/copybutton flex min-w-[10rem] items-center gap-2",children:[e.jsx("img",{width:32,height:32,src:k(s.original.body?.logo_url||""),alt:"Flavor Icon",className:"shrink-0"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{componentId:t,children:e.jsx("button",{className:"grid grid-cols-1 items-center",children:e.jsx("h2",{className:"truncate text-text-md font-semibold",children:a})})}),e.jsx(h,{copyText:a})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{componentId:t,children:e.jsx("button",{className:"text-text-xs text-theme-text-secondary",children:t.split("-")[0]})}),e.jsx(h,{copyText:t})]})]})]})}},{id:"type",header:"Component Type",accessorFn:s=>s.body?.type,cell:({row:s})=>{const t=s.original.body?.type||"orchestrator";return e.jsx(Ne,{type:t,children:le(t)})}},{id:"flavor",header:"Flavor",accessorFn:s=>s.resources?.flavor?.body?.display_name,cell:({row:s})=>{const t=s.original.resources?.flavor?.body?.display_name;return e.jsxs(ce,{rounded:!1,className:"w-fit gap-1 text-theme-text-primary",color:"grey",emphasis:"minimal",children:[e.jsx("img",{width:20,height:20,src:k(s.original.body?.logo_url||""),alt:"Flavor Icon of Component"}),e.jsx("p",{children:t})]})}},{id:"author",header:"Author",accessorFn:s=>s.resources?.user?.name,cell:({row:s})=>{const t=s.original.resources?.user;return t?e.jsx(A,{avatarUrl:t.body?.avatar_url??void 0,username:t.name,isServiceAccount:!!t.body?.is_service_account}):null}},{id:"created",header:"Created at",accessorFn:s=>s.body?.created,cell:({row:s})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(g,{dateString:s.original.body?.created||""})})},{id:"admin_actions",header:"",cell:({row:s})=>e.jsx(be,{children:e.jsx(Re,{id:s.original.id})})}]}const f=1,ze=p.object({page:p.coerce.number().min(f).optional().default(f).catch(f),name:p.string().optional(),operator:p.enum(["and","or"]).optional()});function Be(){const[s]=ue(),{page:t,name:a,operator:n}=ze.parse({page:s.get("page")||void 0,name:s.get("name")||void 0});return{page:t,name:a,logical_operator:n}}function Le(){const{bulkDelete:s}=R(),{selectedRowCount:t,selectedRowIDs:a}=C();async function n(){await s(a)}const r=oe(t,"Component"),c=`${t} ${r} selected`;return e.jsxs("div",{className:"flex items-center divide-x divide-theme-border-moderate overflow-hidden rounded-md border border-theme-border-moderate",children:[e.jsx("div",{className:"bg-primary-25 px-2 py-1 font-semibold text-theme-text-brand",children:c}),e.jsxs(P,{children:[e.jsx(de,{asChild:!0,children:e.jsxs(d,{className:"rounded-sharp border-y-0 bg-white",size:"md",emphasis:"subtle",intent:"secondary",children:[e.jsx(F,{className:"h-5 w-5 shrink-0 gap-1 fill-neutral-400"}),"Delete"]})}),e.jsx(E,{deleteHandler:n})]})]})}function as({fixedQueryParams:s,displayCreateComponent:t=!0}){const a=Be(),{rowSelection:n,setRowSelection:r,selectedRowCount:c}=C(),l=_({...T.componentList({...a,...s,sort_by:"desc:updated"}),throwOnError:!0}),o=Ee();if(l.isError)return null;const{data:i,refetch:z}=l;return e.jsx("section",{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:c>=1?e.jsx(Le,{}):e.jsx(b,{searchParams:a})}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs(d,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>z(),children:[e.jsx(y,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]}),t&&e.jsx(d,{size:"md",asChild:!0,children:e.jsxs(j,{to:x.components.create,children:[e.jsx(me,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"New Component"})]})})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:i?e.jsx(v,{getRowId:B=>B.id,rowSelection:n,onRowSelectionChange:r,columns:o,data:i.items}):e.jsx(m,{className:"h-[500px] w-full"})}),i?i.total_pages>1&&e.jsx(N,{searchParams:a,paginate:i}):e.jsx(m,{className:"h-[36px] w-[300px]"})]})]})})}export{ts as C,as as S};
