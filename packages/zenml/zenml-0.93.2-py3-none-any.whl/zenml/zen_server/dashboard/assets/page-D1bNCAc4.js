import{j as e}from"./@radix-Da0HZyg8.js";import{c as C}from"./helper-BkxAcFl_.js";import{G as S,H as T,J as k,p as g,L as j,N as _,B as f,O as w,Q as v,R as P,U as y,V as A,W as R,X as E,Y as O,Z as I,_ as h,$ as B,a0 as F,r as d,a1 as L,a2 as $,a3 as z,a4 as M,a5 as G,a6 as m,T as Q,a7 as q,a8 as H,a9 as U,aa as J,e as x}from"./index-5CE1yoTL.js";import{c as K,b as V}from"./@tanstack-BRZ8pkCt.js";import{u as W}from"./bulk-delete-VX49K4z6.js";import{P as X}from"./Pagination-CbsJYd8L.js";import{S as Y}from"./SearchField-iVWx0Oy7.js";import{S as Z}from"./alert-triangle-C7ryTF32.js";import{a as D}from"./@monaco-editor-xs6rrDBC.js";import{A as ee}from"./action-cell-BKewukfe.js";import{L as u,f as se}from"./@react-router-BEwS6i40.js";import{z as l}from"./@zod-yP6IINRw.js";import"./@elkjs-D2DP-mPJ.js";import"./@reactflow-CEST3EX2.js";import"./chevron-right-double-QOmxbkYg.js";async function te({pipelineId:s}){const t=S(k.pipelines.detail(s)),n=await fetch(t,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!n.ok){const a=await n.json().then(i=>i.detail).catch(()=>`Failed to delete pipeline ${s}`);throw new T({status:n.status,statusText:n.statusText,message:a})}return n.json()}function ne(s){return K({mutationFn:te,...s})}const{ContextProvider:ae,useContext:o}=C();function b(){const{setRowSelection:s}=o(),{mutateAsync:t}=ne();async function n(a){await t({pipelineId:a})}return W({deleteFn:n,queryKeyToInvalidate:g.all,setRowSelection:s})}function ie(){const[s,t]=D.useState(!1),{selectedRowCount:n,selectedRowIDs:a}=o(),{bulkDelete:i}=b();async function c(){await i(a),t(!1)}const r=P(n,"Pipeline"),N=`Delete ${r}`;return e.jsxs(j,{open:s,onOpenChange:t,children:[e.jsx(_,{asChild:!0,children:e.jsxs(f,{className:"rounded-sharp border-y-0 bg-white",size:"md",emphasis:"subtle",intent:"secondary",children:[e.jsx(w,{className:"h-5 w-5 shrink-0 gap-1 fill-neutral-400"}),"Delete"]})}),e.jsx(v,{title:N,handleDelete:c,children:e.jsxs(y,{className:"space-y-1",children:[e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]}),e.jsx("div",{className:"space-y-3 rounded-md border border-warning-300 bg-warning-50 px-2 py-1 text-warning-900",children:e.jsxs("div",{className:"flex items-center gap-2 text-text-sm",children:[e.jsx(Z,{width:24,height:24,className:"shrink-0 fill-warning-700"}),e.jsxs("p",{children:["This will also delete all runs and snapshots associated with the ",r,"."]})]})})]})})]})}function re(){const{selectedRowCount:s}=o(),t=P(s,"Pipeline");return e.jsxs("div",{className:"flex items-center divide-x divide-theme-border-moderate overflow-hidden rounded-md border border-theme-border-moderate",children:[e.jsx("div",{className:"bg-primary-25 px-2 py-1 font-semibold text-theme-text-brand",children:`${s} ${t} selected`}),e.jsx(ie,{})]})}function le({id:s}){const[t,n]=D.useState(!1),{bulkDelete:a}=b();async function i(){await a([s]),n(!1)}return e.jsxs(e.Fragment,{children:[e.jsx(j,{open:t,onOpenChange:n,children:e.jsx(v,{title:"Delete Pipeline",handleDelete:i,children:e.jsxs(y,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})}),e.jsxs(A,{children:[e.jsx(R,{asChild:!0,children:e.jsx(E,{children:e.jsx("span",{className:"sr-only",children:"Open pipeline actions"})})}),e.jsx(O,{align:"end",sideOffset:7,children:e.jsx(I,{onSelect:()=>n(!0),icon:e.jsx(w,{}),children:"Delete"})})]})]})}function oe(){return[{id:"select",meta:{width:"1%"},header:({table:s})=>e.jsx(h,{id:"check-all",checked:s.getIsAllRowsSelected(),onCheckedChange:t=>s.toggleAllRowsSelected(t==="indeterminate"?!0:t)}),cell:({row:s})=>e.jsx(h,{id:`check-${s.id}`,checked:s.getIsSelected(),onCheckedChange:s.getToggleSelectedHandler()})},{id:"name",header:"Pipeline",cell:({row:s})=>e.jsxs("div",{className:"group/copybutton flex min-w-[10rem] items-center gap-2",children:[e.jsx(B,{className:`h-5 w-5 shrink-0 ${F(s.original.resources?.latest_run_status)}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{to:d.projects.pipelines.detail.runs(s.original.id),className:"grid grid-cols-1 items-center gap-1",children:e.jsx("span",{className:"truncate text-text-md font-semibold text-theme-text-primary",children:s.original.name})}),e.jsx(L,{children:e.jsxs($,{children:[e.jsx(z,{className:"hover:text-theme-text-brand hover:underline",children:e.jsx(M,{status:s.original.resources?.latest_run_status})}),e.jsx(G,{className:"z-20 capitalize",children:s.original.resources?.latest_run_status})]})}),e.jsx(m,{copyText:s.original.name})]}),e.jsxs(u,{to:d.projects.pipelines.detail.runs(s.original.id),className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:s.original.id.split("-")[0]}),e.jsx(m,{copyText:s.original.id})]})]})]})},{id:"latest-run",header:"Latest Run",accessorFn:s=>({status:s.resources?.latest_run_status,runId:s.resources?.latest_run_id}),cell:({getValue:s})=>{const{runId:t,status:n}=s();return!t||!n?e.jsx("div",{children:"No run"}):e.jsx(u,{to:d.projects.runs.detail(t),children:e.jsxs(Q,{emphasis:"subtle",rounded:!1,className:"inline-flex items-center gap-0.5",color:q(n),children:[e.jsx(H,{className:"h-3 w-3 fill-current"}),t?.split("-")[0]]})})}},{id:"admin_actions",header:"",meta:{width:"5%"},cell:({row:s})=>e.jsx(ee,{children:e.jsx(le,{id:s.original.id})})}]}const p=1,ce=l.object({page:l.coerce.number().min(p).optional().default(p).catch(p),name:l.string().optional(),operator:l.enum(["and","or"]).optional()});function de(){const[s]=se(),{page:t,name:n,operator:a}=ce.parse({page:s.get("page")||void 0,name:s.get("name")||void 0,operator:s.get("operator")||void 0});return{page:t,name:n,logical_operator:a}}function ue(){const s=de(),{selectedRowCount:t,rowSelection:n,setRowSelection:a}=o(),{data:i,refetch:c}=V({...g.pipelineList({...s,sort_by:"desc:latest_run"}),throwOnError:!0});return e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[t?e.jsx(re,{}):e.jsx(Y,{searchParams:s}),e.jsx("div",{className:"flex justify-between",children:e.jsxs(f,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>c(),children:[e.jsx(U,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:i?e.jsx(J,{rowSelection:n,onRowSelectionChange:a,getRowId:r=>r.id,columns:oe(),data:i.items}):e.jsx(x,{className:"h-[500px] w-full"})}),i?i.total_pages>1&&e.jsx(X,{searchParams:s,paginate:i}):e.jsx(x,{className:"h-[36px] w-[300px]"})]})]})}function Se(){return e.jsx(ae,{children:e.jsx(ue,{})})}export{Se as default};
