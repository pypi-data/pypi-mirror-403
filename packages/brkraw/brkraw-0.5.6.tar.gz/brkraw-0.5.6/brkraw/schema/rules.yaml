---
$schema: "https://json-schema.org/draft/2020-12/schema"
title: "BrkRaw Rules"
type: object
properties:
  info_spec:
    $ref: "#/$defs/rule_list"
  metadata_spec:
    $ref: "#/$defs/rule_list"
  converter_hook:
    $ref: "#/$defs/rule_list"
additionalProperties: false
$defs:
  rule_list:
    type: array
    items:
      $ref: "#/$defs/rule"
  rule:
    type: object
    properties:
      name:
        type: string
        minLength: 1
      description:
        type: string
      version:
        type: string
      when:
        $ref: "#/$defs/when"
      if:
        $ref: "#/$defs/expr"
      use:
        type: string
        minLength: 1
    required:
      - name
      - use
    additionalProperties: false
  when:
    type: object
    minProperties: 1
    additionalProperties:
      $ref: "#/$defs/when_binding"
  when_binding:
    type: object
    properties:
      sources:
        type: array
        items:
          $ref: "#/$defs/source"
        minItems: 1
      transform:
        type: string
    required:
      - sources
    additionalProperties: false
  source:
    type: object
    properties:
      file:
        type: string
        enum:
          - method
          - acqp
          - visu_pars
          - reco
          - subject
      key:
        type: string
        minLength: 1
      reco_id:
        type: integer
        minimum: 1
    required:
      - file
      - key
    additionalProperties: false
  expr:
    oneOf:
      - $ref: "#/$defs/expr_any"
      - $ref: "#/$defs/expr_all"
      - $ref: "#/$defs/expr_not"
      - $ref: "#/$defs/expr_op"
  expr_any:
    type: object
    properties:
      any:
        type: array
        items:
          $ref: "#/$defs/expr"
        minItems: 1
    required:
      - any
    additionalProperties: false
  expr_all:
    type: object
    properties:
      all:
        type: array
        items:
          $ref: "#/$defs/expr"
        minItems: 1
    required:
      - all
    additionalProperties: false
  expr_not:
    type: object
    properties:
      not:
        $ref: "#/$defs/expr"
    required:
      - not
    additionalProperties: false
  expr_op:
    type: object
    minProperties: 1
    maxProperties: 1
    properties:
      eq:
        $ref: "#/$defs/binop"
      ne:
        $ref: "#/$defs/binop"
      in:
        $ref: "#/$defs/inop"
      regex:
        $ref: "#/$defs/binop"
      startswith:
        $ref: "#/$defs/binop"
      contains:
        $ref: "#/$defs/binop"
      always:
        type: boolean
      gt:
        $ref: "#/$defs/binop"
      ge:
        $ref: "#/$defs/binop"
      lt:
        $ref: "#/$defs/binop"
      le:
        $ref: "#/$defs/binop"
    additionalProperties: false
  binop:
    type: array
    items: {}
    minItems: 2
    maxItems: 2
  inop:
    type: array
    prefixItems:
      - {}
      - type: array
    items: false
    minItems: 2
    maxItems: 2
