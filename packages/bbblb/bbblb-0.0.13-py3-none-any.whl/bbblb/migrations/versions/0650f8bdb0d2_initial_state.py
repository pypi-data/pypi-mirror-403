"""initial state

Revision ID: 0650f8bdb0d2
Revises:
Create Date: 2025-11-18 17:31:57.213932

"""

from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = "0650f8bdb0d2"
down_revision: Union[str, Sequence[str], None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "locks",
        sa.Column("name", sa.String(), nullable=False),
        sa.Column("owner", sa.String(), nullable=False),
        sa.Column("ts", sa.DateTime(timezone=True), nullable=False),
        sa.PrimaryKeyConstraint("name", name="pk_locks"),
    )
    op.create_table(
        "servers",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("domain", sa.String(), nullable=False),
        sa.Column("secret", sa.String(), nullable=False),
        sa.Column("enabled", sa.Boolean(), nullable=False),
        sa.Column("health", sa.Integer(), nullable=False),
        sa.Column("errors", sa.Integer(), nullable=False),
        sa.Column("recover", sa.Integer(), nullable=False),
        sa.Column("load", sa.Float(), nullable=False),
        sa.PrimaryKeyConstraint("id", name="pk_servers"),
        sa.UniqueConstraint("domain", name="uq_servers_domain"),
    )
    op.create_table(
        "tenants",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sa.String(), nullable=False),
        sa.Column("realm", sa.String(), nullable=False),
        sa.Column("secret", sa.String(), nullable=False),
        sa.Column("enabled", sa.Boolean(), nullable=False),
        sa.PrimaryKeyConstraint("id", name="pk_tenants"),
        sa.UniqueConstraint("name", name="uq_tenants_name"),
        sa.UniqueConstraint("realm", name="uq_tenants_realm"),
        sa.UniqueConstraint("secret", name="uq_tenants_secret"),
    )
    op.create_table(
        "callbacks",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("uuid", sa.Uuid(), nullable=False),
        sa.Column("type", sa.String(), nullable=False),
        sa.Column("tenant_fk", sa.Integer(), nullable=False),
        sa.Column("server_fk", sa.Integer(), nullable=False),
        sa.Column("forward", sa.String(), nullable=True),
        sa.Column("created", sa.DateTime(timezone=True), nullable=False),
        sa.ForeignKeyConstraint(
            ["server_fk"], ["servers.id"], name="fk_callbacks_server_fk_servers"
        ),
        sa.ForeignKeyConstraint(
            ["tenant_fk"], ["tenants.id"], name="fk_callbacks_tenant_fk_tenants"
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_table(
        "meetings",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("external_id", sa.String(), nullable=False),
        sa.Column("internal_id", sa.String(), nullable=True),
        sa.Column("uuid", sa.Uuid(), nullable=False),
        sa.Column("tenant_fk", sa.Integer(), nullable=False),
        sa.Column("server_fk", sa.Integer(), nullable=False),
        sa.Column("created", sa.DateTime(timezone=True), nullable=False),
        sa.Column("modified", sa.DateTime(timezone=True), nullable=False),
        sa.ForeignKeyConstraint(
            ["server_fk"], ["servers.id"], name="fk_meetings_server_fk_servers"
        ),
        sa.ForeignKeyConstraint(
            ["tenant_fk"], ["tenants.id"], name="fk_meetings_tenant_fk_tenants"
        ),
        sa.PrimaryKeyConstraint("id", name="pk_meetings"),
        sa.UniqueConstraint("external_id", "tenant_fk", name="uq_meetings_external_id"),
        sa.UniqueConstraint("internal_id", name="uq_meetings_internal_id"),
        sa.UniqueConstraint("uuid", name="uq_meetings_uuid"),
    )
    op.create_table(
        "recordings",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("tenant_fk", sa.Integer(), nullable=True),
        sa.Column("record_id", sa.String(), nullable=False),
        sa.Column("external_id", sa.String(), nullable=False),
        sa.Column(
            "state",
            sa.Enum("PUBLISHED", "UNPUBLISHED", name="recordingstate"),
            nullable=False,
        ),
        sa.Column("meta", sa.JSON(), nullable=False),
        sa.Column("started", sa.DateTime(timezone=True), nullable=False),
        sa.Column("ended", sa.DateTime(timezone=True), nullable=False),
        sa.Column("participants", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(
            ["tenant_fk"], ["tenants.id"], name="fk_recordings_tenant_fk_tenants"
        ),
        sa.PrimaryKeyConstraint("id", name="pk_recordings"),
        sa.UniqueConstraint("record_id", name="uq_recordings_record_id"),
    )
    op.create_table(
        "playback",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("recording_fk", sa.Integer(), nullable=False),
        sa.Column("format", sa.String(), nullable=False),
        sa.Column("xml", sa.String(), nullable=False),
        sa.ForeignKeyConstraint(
            ["recording_fk"],
            ["recordings.id"],
            name="fk_playback_recording_fk_recordings",
        ),
        sa.PrimaryKeyConstraint("id", name="pk_playback"),
        sa.UniqueConstraint("recording_fk", "format", name="uq_playback_recording_fk"),
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table("playback")
    op.drop_table("recordings")
    op.drop_table("meetings")
    op.drop_table("callbacks")
    op.drop_table("tenants")
    op.drop_table("servers")
    op.drop_table("locks")
    # ### end Alembic commands ###
