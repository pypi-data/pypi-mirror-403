from fastapi import Request, status
from fastapi.responses import JSONResponse

from {{ domain_path }}.domain import (
    {{ entity_name }}NotFoundException,
    {{ entity_name }}AlreadyExistsException,
    Invalid{{ entity_name }}DataException,
)


EXCEPTION_STATUS_MAP = {
    {{ entity_name }}NotFoundException: status.HTTP_404_NOT_FOUND,
    {{ entity_name }}AlreadyExistsException: status.HTTP_409_CONFLICT,
    Invalid{{ entity_name }}DataException: status.HTTP_422_UNPROCESSABLE_ENTITY,
}


async def {{ entity_name_lower }}_exception_handler(request: Request, exc: Exception) -> JSONResponse:
    status_code = EXCEPTION_STATUS_MAP.get(type(exc), status.HTTP_500_INTERNAL_SERVER_ERROR)
    return JSONResponse(
        status_code=status_code,
        content={"detail": str(exc) or exc.__class__.__name__}
    )


def register_{{ entity_name_lower }}_exception_handlers(app):
    for exception_class in EXCEPTION_STATUS_MAP.keys():
        app.add_exception_handler(exception_class, {{ entity_name_lower }}_exception_handler)