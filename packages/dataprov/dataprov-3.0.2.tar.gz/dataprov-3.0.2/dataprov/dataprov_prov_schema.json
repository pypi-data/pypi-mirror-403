{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://dataprov.org/schemas/prov-json/v3.0",
  "title": "Dataprov PROV-JSON Schema",
  "description": "W3C PROV-JSON schema with dataprov extensions for data provenance tracking",
  "type": "object",
  "required": ["prefix"],
  "properties": {
    "prefix": {
      "type": "object",
      "description": "Namespace prefix declarations",
      "properties": {
        "dataprov": {
          "type": "string",
          "const": "https://ri-se.github.io/dataprov/ontology/dataprov.ttl#"
        },
        "prov": {
          "type": "string",
          "const": "http://www.w3.org/ns/prov#"
        },
        "xsd": {
          "type": "string",
          "const": "http://www.w3.org/2001/XMLSchema#"
        }
      },
      "required": ["dataprov", "prov", "xsd"],
      "additionalProperties": {
        "type": "string",
        "format": "uri"
      }
    },
    "entity": {
      "type": "object",
      "description": "PROV entities (data files, datasets, bundles)",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "prov:type": {
            "oneOf": [
              {"type": "string"},
              {
                "type": "object",
                "properties": {
                  "$": {"type": "string"},
                  "type": {"type": "string"}
                }
              }
            ]
          },
          "dataprov:checksum": {"type": "string"},
          "dataprov:format": {"type": "string"},
          "dataprov:sizeBytes": {"type": "integer"},
          "dataprov:originalPath": {"type": "string"},
          "dataprov:bundleChecksum": {"type": "string"},
          "dataprov:externalPath": {"type": "string"}
        }
      }
    },
    "activity": {
      "type": "object",
      "description": "PROV activities (processing steps)",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "prov:startedAtTime": {"type": "string", "format": "date-time"},
          "prov:endedAtTime": {"type": "string", "format": "date-time"},
          "prov:type": {"type": "string"},
          "dataprov:operation": {"type": "string"},
          "dataprov:arguments": {"type": "string"},
          "dataprov:outputLog": {"type": "string"},
          "dataprov:warnings": {"type": "string"},
          "dataprov:drl": {"type": "integer", "minimum": 0, "maximum": 9}
        }
      }
    },
    "agent": {
      "type": "object",
      "description": "PROV agents (tools, users, systems)",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "prov:type": {
            "oneOf": [
              {"type": "string"},
              {
                "type": "object",
                "properties": {
                  "$": {"type": "string"},
                  "type": {"type": "string"}
                }
              }
            ]
          },
          "dataprov:toolName": {"type": "string"},
          "dataprov:toolVersion": {"type": "string"},
          "dataprov:toolSource": {"type": "string"},
          "dataprov:user": {"type": "string"},
          "dataprov:hostname": {"type": "string"},
          "dataprov:agentType": {"type": "string", "enum": ["human", "automated"]},
          "dataprov:runtime": {"type": "string"},
          "dataprov:runtimeVersion": {"type": "string"},
          "dataprov:platform": {"type": "string"},
          "dataprov:machine": {"type": "string"},
          "dataprov:processor": {"type": "string"}
        }
      }
    },
    "used": {
      "type": "object",
      "description": "Usage relationships (activity uses entity)",
      "additionalProperties": {
        "type": "object",
        "required": ["prov:activity", "prov:entity"],
        "properties": {
          "prov:activity": {"type": "string"},
          "prov:entity": {"type": "string"},
          "prov:time": {"type": "string", "format": "date-time"},
          "dataprov:hadProvenance": {"type": "string"}
        }
      }
    },
    "wasGeneratedBy": {
      "type": "object",
      "description": "Generation relationships (entity was generated by activity)",
      "additionalProperties": {
        "type": "object",
        "required": ["prov:entity", "prov:activity"],
        "properties": {
          "prov:entity": {"type": "string"},
          "prov:activity": {"type": "string"},
          "prov:time": {"type": "string", "format": "date-time"}
        }
      }
    },
    "wasDerivedFrom": {
      "type": "object",
      "description": "Derivation relationships (entity was derived from entity)",
      "additionalProperties": {
        "type": "object",
        "required": ["prov:generatedEntity", "prov:usedEntity"],
        "properties": {
          "prov:generatedEntity": {"type": "string"},
          "prov:usedEntity": {"type": "string"},
          "prov:activity": {"type": "string"}
        }
      }
    },
    "wasAssociatedWith": {
      "type": "object",
      "description": "Association relationships (activity was associated with agent)",
      "additionalProperties": {
        "type": "object",
        "required": ["prov:activity", "prov:agent"],
        "properties": {
          "prov:activity": {"type": "string"},
          "prov:agent": {"type": "string"},
          "prov:role": {"type": "string"}
        }
      }
    },
    "wasAttributedTo": {
      "type": "object",
      "description": "Attribution relationships (entity was attributed to agent)",
      "additionalProperties": {
        "type": "object",
        "required": ["prov:entity", "prov:agent"],
        "properties": {
          "prov:entity": {"type": "string"},
          "prov:agent": {"type": "string"}
        }
      }
    },
    "bundle": {
      "type": "object",
      "description": "PROV bundles (inlined provenance chains)",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "entity": {"$ref": "#/properties/entity"},
          "activity": {"$ref": "#/properties/activity"},
          "agent": {"$ref": "#/properties/agent"},
          "used": {"$ref": "#/properties/used"},
          "wasGeneratedBy": {"$ref": "#/properties/wasGeneratedBy"},
          "wasDerivedFrom": {"$ref": "#/properties/wasDerivedFrom"},
          "wasAssociatedWith": {"$ref": "#/properties/wasAssociatedWith"},
          "wasAttributedTo": {"$ref": "#/properties/wasAttributedTo"}
        }
      }
    },
    "dataprov:metadata": {
      "type": "object",
      "description": "Dataprov-specific metadata",
      "properties": {
        "version": {"type": "string", "const": "3.0"},
        "created": {"type": "string", "format": "date-time"},
        "lastModified": {"type": "string", "format": "date-time"},
        "rootEntityId": {"type": "string"},
        "description": {"type": "string"},
        "initialSource": {"type": "string"},
        "tags": {
          "type": "array",
          "items": {"type": "string"}
        }
      },
      "required": ["version", "created", "lastModified", "rootEntityId"]
    }
  }
}
