Metadata-Version: 2.4
Name: portier-cli
Version: 0.1.4
Summary: Gestionnaire de ports pour vos applications Docker
Home-page: https://github.com/Landers9/portier
Author: Franck AÃGBA
Author-email: franckaigba4@gmail.com
Project-URL: Bug Tracker, https://github.com/Landers9/portier/issues
Project-URL: Documentation, https://github.com/Landers9/portier#readme
Project-URL: Source, https://github.com/Landers9/portier
Keywords: docker,ports,cli,devops,containers
Classifier: Development Status :: 4 - Beta
Classifier: Environment :: Console
Classifier: Intended Audience :: Developers
Classifier: Intended Audience :: System Administrators
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Topic :: System :: Systems Administration
Classifier: Topic :: Utilities
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: click>=8.0.0
Requires-Dist: pyyaml>=6.0
Requires-Dist: docker>=6.0.0
Requires-Dist: rich>=13.0.0
Dynamic: author
Dynamic: author-email
Dynamic: classifier
Dynamic: description
Dynamic: description-content-type
Dynamic: home-page
Dynamic: keywords
Dynamic: project-url
Dynamic: requires-dist
Dynamic: requires-python
Dynamic: summary

# Portier ğŸ”Œ

**Gestionnaire de ports pour vos applications Docker.**

Portier est un CLI qui rÃ©sout un problÃ¨me simple mais frÃ©quent : garder une trace des ports utilisÃ©s par vos applications Docker sur un VPS.

---

## Table des matiÃ¨res

- [Le problÃ¨me](#le-problÃ¨me)
- [PrÃ©requis](#prÃ©requis)
- [Installation](#installation)
- [Premier lancement](#premier-lancement--intÃ©grer-votre-environnement-existant)
- [Utilisation quotidienne](#utilisation-quotidienne)
- [RÃ©fÃ©rence des commandes](#rÃ©fÃ©rence-des-commandes)
- [Configuration](#configuration)
- [CatÃ©gories](#catÃ©gories)
- [Workflows](#workflow-complet--nouvelle-application)
- [IntÃ©grations](#intÃ©gration-avec-docker-compose)
- [Mise Ã  jour](#mise-Ã -jour)
- [DÃ©sinstallation](#dÃ©sinstallation)
- [Alternatives](#alternatives)

---

## Le problÃ¨me

Vous avez plusieurs applications Docker sur votre serveur. Chacune expose un port :

```yaml
# App 1
ports:
  - "3001:3000"

# App 2
ports:
  - "3002:3000"

# App 3
ports:
  - "???:3000"  # Lequel est libre dÃ©jÃ  ?
```

Ã€ chaque nouvelle application, vous devez :

1. Vous souvenir des ports dÃ©jÃ  utilisÃ©s
2. VÃ©rifier manuellement tous vos `docker-compose.yml`
3. VÃ©rifier vos configurations Nginx
4. EspÃ©rer ne pas avoir de conflit

**Portier Ã©limine ce problÃ¨me en maintenant un registre central de tous vos ports.**

---

## PrÃ©requis

- Python 3.8 ou supÃ©rieur
- Docker (pour les fonctionnalitÃ©s de scan et sync)

---

## Installation

### MÃ©thode 1 : Avec pipx (recommandÃ©)

`pipx` installe les CLI Python dans des environnements isolÃ©s. C'est la mÃ©thode recommandÃ©e sur Ubuntu 23.04+, Debian 12+ et les systÃ¨mes rÃ©cents.

```bash
# Installer pipx
sudo apt update
sudo apt install pipx -y

# Installer portier
pipx install portier-cli
```

#### ProblÃ¨me : `portier: command not found` aprÃ¨s l'installation ?

Si vous voyez ce message aprÃ¨s l'installation :

```
âš ï¸  Note: '/home/user/.local/bin' is not on your PATH environment variable.
```

ExÃ©cutez ces commandes :

```bash
# Ajouter le dossier au PATH
pipx ensurepath

# Recharger le terminal
source ~/.bashrc
```

Si Ã§a ne fonctionne toujours pas, ajoutez manuellement le PATH :

```bash
echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc
```

---

### MÃ©thode 2 : Avec pip (systÃ¨mes plus anciens)

Sur Ubuntu 22.04 et versions antÃ©rieures :

```bash
sudo apt update
sudo apt install python3-pip -y
pip install portier-cli
```

#### ProblÃ¨me : `externally-managed-environment` ?

Sur les systÃ¨mes rÃ©cents (Ubuntu 23.04+, Debian 12+), vous pouvez voir cette erreur :

```
error: externally-managed-environment
```

Dans ce cas, utilisez la **MÃ©thode 1 (pipx)** ou la **MÃ©thode 3 (environnement virtuel)**.

#### ProblÃ¨me : `portier: command not found` ?

Ajoutez le dossier des binaires pip Ã  votre PATH :

```bash
echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc
```

---

### MÃ©thode 3 : Dans un environnement virtuel

Si vous prÃ©fÃ©rez utiliser un environnement virtuel :

```bash
# CrÃ©er l'environnement
python3 -m venv ~/portier-env

# Installer portier
~/portier-env/bin/pip install portier-cli

# Ajouter un alias pour la commande
echo 'alias portier="~/portier-env/bin/portier"' >> ~/.bashrc
source ~/.bashrc
```

---

### VÃ©rifier l'installation

```bash
# Afficher la version
portier --version

# Afficher l'aide
portier --help
```

Vous devriez voir :

```
Usage: portier [OPTIONS] COMMAND [ARGS]...

  Portier - Gestionnaire de ports pour vos applications Docker

Options:
  --version  Show the version and exit.
  --help     Show this message and exit.

Commands:
  add         Attribue un port Ã  une nouvelle app
  categories  Liste les catÃ©gories configurÃ©es
  check       VÃ©rifie si un port est disponible
  config      GÃ¨re la configuration de portier
  init        Initialise portier
  list        Liste toutes les apps et leurs ports
  remove      Supprime une app et libÃ¨re son port
  scan        Scanne les conteneurs Docker existants
  sync        Synchronise le registre avec Docker
```

---

## Premier lancement : intÃ©grer votre environnement existant

Vous avez probablement dÃ©jÃ  des conteneurs Docker qui tournent. Voici comment intÃ©grer portier Ã  votre setup existant.

### Ã‰tape 1 : Initialiser portier

```bash
portier init
```

```
âœ“ Portier initialisÃ©
  Plage par dÃ©faut : 3000-3999
  Config : ~/.portier/config.yaml
  Registre : ~/.portier/registry.json
```

### Ã‰tape 2 : Scanner vos conteneurs existants

Regardez d'abord ce que portier dÃ©tecte :

```bash
portier scan
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Conteneur               â”‚ Port hÃ´te â”‚ Port conteneur  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ mon-api                 â”‚ 3001      â”‚ 3000/tcp        â”‚
â”‚ mon-frontend            â”‚ 3002      â”‚ 3000/tcp        â”‚
â”‚ postgres                â”‚ 5432      â”‚ 5432/tcp        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ã‰tape 3 : Importer dans le registre

Synchronisez pour importer vos conteneurs existants :

```bash
portier sync
```

```
Synchronisation...

âš  Conteneur 'mon-api' sur port 3001 (non enregistrÃ©)
  Ajouter au registre ? [O/n] O
  âœ“ "mon-api" ajoutÃ© (port 3001)

âš  Conteneur 'mon-frontend' sur port 3002 (non enregistrÃ©)
  Ajouter au registre ? [O/n] O
  âœ“ "mon-frontend" ajoutÃ© (port 3002)

âš  Conteneur 'postgres' sur port 5432 (non enregistrÃ©)
  Ajouter au registre ? [O/n] O
  âœ“ "postgres" ajoutÃ© (port 5432)

Synchronisation terminÃ©e.
```

### Ã‰tape 4 : VÃ©rifier le registre

```bash
portier list
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ App          â”‚ Port â”‚ CatÃ©gorie â”‚ Actif  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ mon-api      â”‚ 3001 â”‚ -         â”‚ âœ“      â”‚
â”‚ mon-frontend â”‚ 3002 â”‚ -         â”‚ âœ“      â”‚
â”‚ postgres     â”‚ 5432 â”‚ -         â”‚ âœ“      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3 apps Â· Ports : 3001, 3002, 5432
```

**Portier connaÃ®t maintenant tout votre environnement.** Ã€ partir de maintenant, utilisez-le pour gÃ©rer vos ports.

### Ã‰tape 5 (optionnel) : Organiser avec des catÃ©gories

Pour mieux structurer vos ports, crÃ©ez des catÃ©gories :

```bash
portier config add-category frontend --range=3000-3099 --description="Applications frontend"
portier config add-category backend --range=3100-3199 --description="APIs backend"
portier config add-category database --range=5400-5499 --description="Bases de donnÃ©es"
```

VÃ©rifiez vos catÃ©gories :

```bash
portier categories
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nom      â”‚ Plage       â”‚ Description              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ frontend â”‚ 3000-3099   â”‚ Applications frontend    â”‚
â”‚ backend  â”‚ 3100-3199   â”‚ APIs backend             â”‚
â”‚ database â”‚ 5400-5499   â”‚ Bases de donnÃ©es         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Utilisation quotidienne

### Ajouter une nouvelle application

```bash
portier add mon-nouveau-projet
```

```
âœ“ Port 3003 attribuÃ© Ã  "mon-nouveau-projet"

  Utilise dans ton docker-compose.yml :
  ports:
    - "3003:3000"
```

Avec une catÃ©gorie :

```bash
portier add mon-api-v2 --category=backend
```

```
âœ“ Port 3100 attribuÃ© Ã  "mon-api-v2"
  CatÃ©gorie : backend

  Utilise dans ton docker-compose.yml :
  ports:
    - "3100:3000"
```

### VÃ©rifier si un port est disponible

```bash
portier check 3005
```

```
âœ“ Port 3005 est disponible
```

```bash
portier check 3001
```

```
âœ— Port 3001 est utilisÃ© par "mon-api"
```

### Voir tous vos ports

```bash
portier list
```

### Supprimer une application

Quand vous supprimez un conteneur, libÃ©rez aussi son port :

```bash
docker compose down
portier remove mon-ancien-projet
```

```
âœ“ Port 3003 libÃ©rÃ© (app "mon-ancien-projet" supprimÃ©e)
```

### Resynchroniser aprÃ¨s des changements manuels

Si vous avez crÃ©Ã© ou supprimÃ© des conteneurs sans passer par portier :

```bash
portier sync
```

Portier dÃ©tectera les diffÃ©rences et vous proposera de mettre Ã  jour le registre.

---

## RÃ©fÃ©rence des commandes

### `portier init`

Initialise portier. CrÃ©e le dossier `~/.portier/` avec les fichiers de configuration.

```bash
portier init
```

Ã€ exÃ©cuter une seule fois lors de la premiÃ¨re utilisation.

---

### `portier add <app>`

Attribue un port Ã  une nouvelle application.

```bash
# Attribution automatique
portier add mon-api

# Avec une catÃ©gorie
portier add mon-site --category=frontend

# Avec un port spÃ©cifique
portier add mon-service --port=4000
```

**Options :**

| Option             | Description                                   |
| ------------------ | --------------------------------------------- |
| `--category`, `-c` | CatÃ©gorie de l'app (utilise la plage dÃ©finie) |
| `--port`, `-p`     | Port spÃ©cifique Ã  attribuer                   |

---

### `portier list`

Affiche toutes les applications enregistrÃ©es et leurs ports.

```bash
# Toutes les apps
portier list

# Filtrer par catÃ©gorie
portier list --category=frontend
```

La colonne "Actif" indique si un conteneur Docker utilise actuellement ce port.

---

### `portier check <port>`

VÃ©rifie si un port est disponible.

```bash
portier check 3500
```

Retourne :

- âœ“ si le port est disponible
- âœ— si le port est utilisÃ© par une app enregistrÃ©e
- âš  si le port est utilisÃ© par Docker mais non enregistrÃ©

---

### `portier remove <app>`

Supprime une application du registre et libÃ¨re son port.

```bash
portier remove mon-api
```

---

### `portier scan`

Affiche tous les conteneurs Docker en cours d'exÃ©cution avec leurs ports exposÃ©s.

```bash
portier scan
```

Utile pour voir l'Ã©tat actuel avant d'importer dans portier.

---

### `portier sync`

Synchronise le registre avec l'Ã©tat rÃ©el de Docker.

```bash
portier sync
```

Cette commande :

1. DÃ©tecte les apps dans le registre dont le conteneur n'existe plus
2. DÃ©tecte les conteneurs Docker non enregistrÃ©s
3. Propose de nettoyer/ajouter les entrÃ©es

---

### `portier categories`

Affiche toutes les catÃ©gories configurÃ©es.

```bash
portier categories
```

---

### `portier config add-category`

CrÃ©e une nouvelle catÃ©gorie avec sa plage de ports.

```bash
portier config add-category frontend --range=3000-3099 --description="Applications frontend"
```

**Options :**

| Option                | Description                                        |
| --------------------- | -------------------------------------------------- |
| `--range`             | Plage de ports (obligatoire, format : `start-end`) |
| `--description`, `-d` | Description de la catÃ©gorie (optionnel)            |

---

### `portier config remove-category`

Supprime une catÃ©gorie.

```bash
portier config remove-category staging
```

---

### `portier config set-range`

Modifie la plage de ports par dÃ©faut.

```bash
portier config set-range --start=4000 --end=4999
```

```
âœ“ Plage de ports mise Ã  jour : 4000-4999
```

**Options :**

| Option    | Description                           |
| --------- | ------------------------------------- |
| `--start` | Port de dÃ©but de la plage (obligatoire) |
| `--end`   | Port de fin de la plage (obligatoire)   |

Cette plage est utilisÃ©e quand vous ajoutez une app sans catÃ©gorie.

---

## Configuration

### Configuration de la plage par dÃ©faut

Par dÃ©faut, portier attribue les ports dans la plage **3000-3999**. Vous pouvez modifier cette plage.

#### Via la commande CLI

```bash
portier config set-range --start=4000 --end=4999
```

#### En modifiant le fichier de configuration

```bash
nano ~/.portier/config.yaml
```

```yaml
range:
  start: 4000
  end: 4999
```

### Fichiers de configuration

Portier stocke ses donnÃ©es dans `~/.portier/` :

#### `~/.portier/config.yaml`

Configuration gÃ©nÃ©rale et catÃ©gories.

```yaml
range:
  start: 3000
  end: 3999
categories:
  frontend:
    range:
      - 3000
      - 3099
    description: Applications frontend
  backend:
    range:
      - 3100
      - 3199
    description: APIs backend
default_category: null
```

#### `~/.portier/registry.json`

Registre des applications et leurs ports.

```json
{
  "apps": {
    "mon-api": {
      "port": 3100,
      "category": "backend",
      "created_at": "2025-01-30T10:30:00.000000"
    },
    "mon-site": {
      "port": 3000,
      "category": "frontend",
      "created_at": "2025-01-30T10:35:00.000000"
    }
  }
}
```

---

## CatÃ©gories

Les catÃ©gories permettent d'organiser vos ports par type d'application. Chaque catÃ©gorie a sa propre plage de ports.

### Exemple de configuration

```bash
portier config add-category frontend --range=3000-3099 --description="Applications frontend"
portier config add-category backend --range=3100-3199 --description="APIs et services backend"
portier config add-category staging --range=3200-3299 --description="Environnements de staging"
portier config add-category production --range=3300-3399 --description="Environnements de production"
```

### Avantages

- Organisation claire de vos services
- Plages de ports prÃ©visibles
- Facilite la configuration des firewalls
- Documentation implicite de votre infrastructure

---

## Workflow complet : nouvelle application

```bash
# 1. Demander un port
portier add mon-nouveau-projet --category=backend
# âœ“ Port 3100 attribuÃ© Ã  "mon-nouveau-projet" (catÃ©gorie: backend)

# 2. CrÃ©er le docker-compose.yml avec ce port
# ports:
#   - "3100:3000"

# 3. Configurer Nginx
# proxy_pass http://127.0.0.1:3100;

# 4. DÃ©marrer l'application
docker compose up -d
```

---

## Workflow complet : supprimer une application

```bash
# 1. ArrÃªter et supprimer le conteneur
docker compose down

# 2. LibÃ©rer le port dans portier
portier remove mon-projet
# âœ“ Port 3100 libÃ©rÃ©
```

---

## IntÃ©gration avec Docker Compose

Portier ne modifie pas vos fichiers. Il vous indique simplement quel port utiliser.

**Avant :**

```yaml
services:
  mon-app:
    image: mon-app:latest
    ports:
      - "???:3000" # Quel port choisir ?
```

**Avec portier :**

```bash
portier add mon-app
# âœ“ Port 3001 attribuÃ© Ã  "mon-app"
```

```yaml
services:
  mon-app:
    image: mon-app:latest
    ports:
      - "3001:3000" # Port donnÃ© par portier
```

---

## IntÃ©gration avec Nginx

Exemple de configuration Nginx utilisant le port attribuÃ© par portier :

```bash
portier add mon-api --category=backend
# âœ“ Port 3100 attribuÃ©
```

```nginx
server {
    server_name api.monsite.com;

    location / {
        proxy_pass http://127.0.0.1:3100;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    listen 443 ssl;
    ssl_certificate /etc/letsencrypt/live/api.monsite.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.monsite.com/privkey.pem;
}
```

---

## Mise Ã  jour

### Si installÃ© avec pipx

```bash
pipx upgrade portier-cli
```

### Si installÃ© avec pip

```bash
pip install --upgrade portier-cli
```

### Si installÃ© dans un environnement virtuel

```bash
~/portier-env/bin/pip install --upgrade portier-cli
```

### VÃ©rifier la version aprÃ¨s mise Ã  jour

```bash
portier --version
```

---

## DÃ©sinstallation

### Si installÃ© avec pipx

```bash
pipx uninstall portier-cli
```

### Si installÃ© avec pip

```bash
pip uninstall portier-cli
```

### Supprimer les fichiers de configuration

```bash
rm -rf ~/.portier
```

---

## Alternatives

Portier est conÃ§u pour ceux qui utilisent Docker avec une gestion manuelle des ports et Nginx. Si vous cherchez une solution plus automatisÃ©e, considÃ©rez :

- **Traefik** : Reverse proxy qui dÃ©couvre automatiquement les conteneurs Docker et Ã©limine le besoin de gÃ©rer les ports
- **Kubernetes** : Orchestration complÃ¨te avec service discovery
- **Docker Swarm** : Orchestration Docker native

Portier reste utile si vous prÃ©fÃ©rez garder le contrÃ´le manuel ou si vous ne souhaitez pas migrer vers ces solutions.

---

## Licence

MIT

---

## Contribuer

Les contributions sont les bienvenues ! N'hÃ©sitez pas Ã  ouvrir une issue ou une pull request sur GitHub.

---

## Auteur

DÃ©veloppÃ© par [Franck AÃGBA](https://github.com/Landers9)
