import{h as l}from"./user.BEEfOshe.js";import{o as R,m as p}from"./user.Bg1Nd46A.js";import{i as u,d}from"./loader.BQDlK3Tc.js";import{a as r}from"./notifications.NSMm1_5U.js";import{u as b}from"./index.CwJxcYEt.js";import{a as f}from"./index.BSdFiPHn.js";const i="/api",o=b(R),h=p({page:0,resources:[],total:0,isReady:!1});async function k(t){return h.set(t),h.get()}p([]);const N=async(t,a)=>{u();let s=`${i}/organization/${o.value}/snapshots?page=${t}&limit=10`;a&&(s=`${i}/organization/${o.value}/snapshots/search?pattern=${a}&page=${t}&limit=10`);try{const e=await fetch(s);if(e.status===403)l(o.value);else{const n=await e.json();let c={page:t,resources:n.items,total:n.count,isReady:!0};k(c)}}catch(e){const n={title:"Snapshots couldn't be fetched",message:e.message,type:"error"};r(n)}finally{d()}},y=f(null);async function j(t){return y.set(t),y.get()}const O=async()=>{u();let t=`${i}/organization/${o.value}/snapshots/config`;try{const a=await fetch(t);if(a.status===403)l(o.value);else{const s=await a.json();s!==null&&j(s)}}catch(a){const s={title:"The current snapshot configuration couldn't be fetched",message:a.message,type:"error"};r(s)}finally{d()}},J=async t=>{u();const a=`${i}/organization/${o.value}/snapshots`;try{const s=await fetch(a,{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify(t)});if(s.status===403)l(o.value);else if(s.status===409){let e=await s.json();r({title:"Resource discovery couldn't be configured",message:"A snapshot with the same name already exists",type:"error"})}else if(s.ok){const e=`${i}/organization/${o.value}/snapshots/refresh`,n=await fetch(e);if(n.status===403)l(o.value);else if(n.ok)window.location.assign("/resources/");else{let c=await n.json();r({title:"Resources couldn't be discovered",message:"An internal error prevented resources to be discovered. This could be an issue with Reliably or a misconfigured system",type:"error"})}}else throw new Error(s.statusText)}catch(s){const e={title:"Snapshot couldn't be created",message:s.message,type:"error"};r(e)}finally{d()}},V=async(t,a)=>{u();const s=`${i}/organization/${o.value}/snapshots/${t}`;try{const e=await fetch(s,{method:"PUT",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify(a)});if(e.status===403)l(o.value);else if(e.ok){const n=`${i}/organization/${o.value}/snapshots/refresh`,c=await fetch(n);if(c.status===403)l(o.value);else if(c.ok)window.location.assign("/resources/");else{let $=await c.json();r({title:"Resources couldn't be discovered",message:"An internal error prevented resources to be discovered. This could be an issue with Reliably or a misconfigured system",type:"error"})}}else throw new Error(e.statusText)}catch(e){const n={title:"Snapshot couldn't be updated",message:e.message,type:"error"};r(n)}finally{d()}},q=async()=>{u();const t=`${i}/organization/${o.value}/snapshots/refresh`;try{const a=await fetch(t);if(a.status===403)l(o.value);else if(a.ok)window.location.assign("/resources/");else{let s=await a.json();r({title:"Resources couldn't be discovered",message:"An internal error prevented resources to be discovered. This could be an issue with Reliably or a misconfigured system",type:"error"})}}finally{d()}},g=p({page:0,candidates:[],total:0,isReady:!1});async function z(t){return g.set(t),g.get()}const B=async t=>{u();const a=new URLSearchParams({query:t}),s=`${i}/organization/${o.value}/snapshots/resources/data?${a}`;try{const e=await fetch(s);if(e.status===403)l(o.value);else if(e.ok){let n=await e.json(),c={page:1,candidates:n.items,total:n.count,isReady:!0};z(c)}else{let n=await e.json();r({title:"Resource candidates couldn't be retrieved",message:"",type:"error"})}}finally{d()}},m=f(null),w=f(null),v=p({page:0,links:[],total:0,isReady:!1});async function S(t){return m.set(t),m.get()}async function T(t){return w.set(t),w.get()}async function C(t){return v.set(t),v.get()}const D=async t=>{u();const a=`${i}/organization/${o.value}/snapshots/resources/${t}`;try{const s=await fetch(a);if(s.status===403)l(o.value);else if(s.ok){const e=await s.json();S(e)}else throw new Error(s.statusText)}catch(s){const e={title:"Resource couldn't be fetched",message:s.message,type:"error"};r(e)}d()},F=async(t,a)=>{u();const s=`${i}/organization/${o.value}/snapshots/resources/${t}/links?page=${a}&limit=30`;try{const e=await fetch(s);if(e.status===403)l(o.value);else if(e.ok){const n=await e.json();let c={page:a,links:n.items,total:n.count,isReady:!0};C(c)}else throw new Error(e.statusText)}catch(e){const n={title:"Resource links couldn't be fetched",message:e.message,type:"error"};r(n)}d()},G=async t=>{u();const a=`${i}/organization/${o.value}/snapshots/resources/${t}/previous`;try{const s=await fetch(a);if(s.status===403)l(o.value);else if(s.ok){const e=await s.json();T(e)}}catch(s){const e={title:"Resource couldn't be fetched",message:s.message,type:"error"};r(e)}d()};export{O as a,J as b,g as c,N as d,q as e,B as f,D as g,F as h,G as i,m as j,v as k,w as p,h as r,y as s,V as u};
