.TH UL80 1 "November 2025" "um80 0.3.3" "User Commands"
.SH NAME
ul80 \- Microsoft LINK-80 compatible linker for 8080/Z80
.SH SYNOPSIS
.B ul80
[\fB\-v\fR]
[\fB\-o\fR \fIoutput.com\fR]
[\fB\-x\fR]
[\fB\-\-prl\fR]
[\fB\-s\fR]
[\fB\-S\fR \fIfile.sym\fR]
[\fB\-p\fR \fIorigin\fR]
.I file.rel
[\fIfile.rel\fR]...
.SH DESCRIPTION
.B ul80
is a Microsoft LINK-80 compatible linker that combines relocatable object files
(.REL) produced by
.BR um80 (1)
into executable CP/M .COM files.
.PP
The linker resolves external references, allocates memory for code, data, and
COMMON blocks, and produces a binary executable suitable for running under CP/M
or a CP/M emulator.
.SH OPTIONS
.TP
.B \-v\fR, \fB\-\-version
Display version information and exit.
.TP
.BI \-o " output.com"
Specify the output file name. Default is the first input file name with a .com extension.
.TP
.B \-x
Output Intel HEX format instead of binary. Useful for EPROM programmers.
.TP
.B \-\-prl
Output MP/M .PRL (Page Relocatable) format instead of binary .COM.
PRL files can be loaded at any page boundary in memory, useful for MP/M's
multi-user environment. The output file contains a 256-byte header with
code/BSS sizes, the code section, and a relocation bitmap that marks which
bytes need page adjustment when loaded at a different address.
.TP
.B \-s
Generate a symbol file (.SYM) with an auto-generated name based on the output file.
The symbol file contains all PUBLIC symbols and their final relocated addresses.
.TP
.BI \-S " file.sym"
Generate a symbol file with the specified name. Use this with the assembler's
\fB\-g\fR option to generate a complete symbol file including all labels:
.RS
.nf
um80 \-g program.mac
ul80 \-S program.sym program.rel
.fi
.RE
.TP
.BI \-p " origin"
Set the program origin address. Default is 100 (hex), the standard CP/M transient
program load address. Values are interpreted as hexadecimal by default (e.g., E000),
or can use prefixes: 0x for hex, 0o for octal.
.SH MEMORY LAYOUT
The linker arranges memory as follows:
.IP 1. 3
Code segment (CSEG) starting at the origin address
.IP 2.
Data segment (DSEG) immediately following code
.IP 3.
COMMON blocks following data
.PP
The first three bytes of a CP/M .COM file are typically a JMP instruction to the
actual entry point, so code starts at origin + 3 (0x103 by default).
.SH LINKING PROCESS
.IP 1. 3
Load all input .REL files
.IP 2.
Resolve external references between modules
.IP 3.
Allocate final addresses for all segments
.IP 4.
Perform address fixups for relocatable references
.IP 5.
Write output file
.PP
If an external symbol is not found in any loaded module, the linker reports an
error. The linker searches library files (.LIB) for undefined symbols when
specified on the command line.
.SH EXAMPLES
.TP
Link a single module:
.B ul80 program.rel
.TP
Link multiple modules:
.B ul80 \-o app.com main.rel io.rel util.rel
.TP
Generate symbol file:
.B ul80 \-s program.rel
.TP
Set custom origin (bare hex):
.B ul80 \-p E000 program.rel
.TP
Generate named symbol file:
.B ul80 \-S program.sym program.rel
.TP
Output Intel HEX:
.B ul80 \-x \-o program.hex program.rel
.TP
Output MP/M PRL:
.B ul80 \-\-prl program.rel
.TP
Link with library:
.B ul80 \-o program.com main.rel mylib.lib
.SH EXIT STATUS
.TP
.B 0
Linking successful.
.TP
.B 1
Linking failed due to errors (undefined symbols, etc.).
.SH FILES
.TP
.I input.rel
Relocatable object file (from um80).
.TP
.I input.lib
Library file (from ulib80).
.TP
.I output.com
CP/M executable binary.
.TP
.I output.hex
Intel HEX format (with \-x option).
.TP
.I output.prl
MP/M Page Relocatable format (with \-\-prl option).
.TP
.I output.sym
Symbol file (with \-s option).
.SH SYMBOL FILE FORMAT
The symbol file contains one line per symbol:
.PP
.RS
.nf
SYMBOL_NAME  XXXX
.fi
.RE
.PP
Where XXXX is the 16-bit hexadecimal address of the symbol.
.SH SEE ALSO
.BR um80 (1),
.BR ulib80 (1),
.BR ucref80 (1),
.BR ud80 (1)
.PP
The original Microsoft LINK-80 manual is available at docs/external/l80.pdf
.SH COMPATIBILITY
.B ul80
is compatible with Microsoft LINK-80 (L80). The .REL file format is
binary-compatible, allowing object files created by the original M80 to be
linked with ul80, and vice versa.
.SH NOTES
.IP \(bu 2
Libraries are searched in the order specified on the command line.
.IP \(bu 2
Only modules containing symbols that satisfy undefined references are
included from libraries.
.IP \(bu 2
COMMON blocks with the same name in different modules share storage;
the largest size requested is allocated.
.SH AUTHOR
um80 project contributors.
