const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./EditorSidePanel-BLIPel8z.js","./api-DyiqpKJK.js","./api-BDer3rj7.css","./ui-components-DQ2lkQGO.js","./vue-core-C3hq3bxF.js","./element-ui-CA4rbiJ9.js","./index-BrGO8rHI.js","./index-CjSe8i2q.css","./vue-flow-BEraqp1L.js","./js-yaml-yTPt38rv.js","./WorkflowStudio-cipvlP3c.js","./elkjs-daFYuoNQ.js","./WorkflowStudio-B8WFoV8O.css","./code-editor-DFIoHxr7.js","./EditorSidePanel-BNVms9Fq.css","./el-tag-DljBBxJR.css","./FeedbackPanel-DufEqQxi.js","./FormattedCodeViewer.vue_vue_type_script_setup_true_lang-D-r0d4Is.js","./highlightjs-D4ATuRwX.js","./FloatPagination-x9oqNWsY.js","./FloatPagination-C3Q9DXfH.css","./FeedbackPanel-CUndA78i.css","./el-empty-D4ZqTl4F.css","./NodeDetailWrapper-tuRfvIsa.js","./NodeDetailWrapper-KfsWKrNS.css","./el-collapse-item-D4LG0FJ0.css","./TracePanelWrapper-CGsS47oK.js","./TracePanelWrapper-BLAMynpF.css"])))=>i.map(i=>d[i]);
import{_ as de,a as ve}from"./index-BrGO8rHI.js";import{a as dt,d as ct}from"./api-DyiqpKJK.js";import{P as Fe,_ as ut,u as Pe,a as pt,b as gt,c as ft,d as mt}from"./vue-flow-BEraqp1L.js";import{j as Q,d as ue,l as ht}from"./js-yaml-yTPt38rv.js";import{u as fe,G as d,A as vt,W as A,a as yt,b as bt,B as Nt,c as _t,d as wt,e as kt,i as xt,l as $t}from"./WorkflowStudio-cipvlP3c.js";import{E as Qe,s as Xe,H as Et,t as s,l as Ct,h as It,a as Ht,d as Tt,b as At,i as Ot,c as St,r as Mt,e as Dt,f as Rt,y as Pt,g as Lt,T as Vt,j as Bt}from"./code-editor-DFIoHxr7.js";import{e as Ze,s as jt,d as Ft,a as te,h as Wt,t as zt,u as Ut,w as Gt,x as Kt,y as Yt,z as Jt}from"./element-ui-CA4rbiJ9.js";import{v as Y,i as T,r as V,w as oe,j as qt,x as S,y as x,I as U,B as g,O as p,L as re,F as $,K,u as v,c as z,H as Le,E as B,G as we,M as ae,a9 as ge,P as ke,k as Qt,al as We,W as xe,aF as ye,q as ze}from"./vue-core-C3hq3bxF.js";/* empty css               */import{u as J,U as et,$ as De}from"./ui-components-DQ2lkQGO.js";function Xt(){const I=fe().nodeSchemaMap,l=o=>{try{return Q.load(o),!0}catch(e){return console.error("YAML格式错误:",e),!1}},N=o=>{const e=[];try{const a=Q.load(o);return!a||typeof a!="object"||Array.isArray(a)?(e.push("工作流数据必须是一个对象"),{isValid:!1,errors:e}):((!("name"in a)||typeof a.name!="string")&&e.push("缺少必需的name字段或name字段不是字符串类型"),"description"in a&&typeof a.description!="string"&&e.push("description字段必须是字符串类型"),!("nodes"in a)||!Array.isArray(a.nodes)?(e.push("缺少必需的nodes字段或nodes字段不是数组类型"),{isValid:!1,errors:e}):(a.nodes.forEach((n,t)=>{if(!n||typeof n!="object"){e.push(`节点${t}不是一个对象`);return}(!("name"in n)||typeof n.name!="string")&&e.push(`节点${t}缺少必需的name字段或name字段不是字符串类型`),(!("type"in n)||typeof n.type!="string")&&e.push(`节点${t}缺少必需的type字段或type字段不是字符串类型`),"args"in n&&(n.args!==null&&typeof n.args!="object"||Array.isArray(n.args))&&e.push(`节点${t}的args字段必须是对象类型或null`),"outputs"in n&&(n.outputs!==null&&typeof n.outputs!="object"||Array.isArray(n.outputs))&&e.push(`节点${t}的outputs字段必须是对象类型或null`)}),"inputs"in a&&(a.inputs!==null&&!Array.isArray(a.inputs)?e.push("inputs字段必须是数组类型或null"):Array.isArray(a.inputs)&&a.inputs?.forEach((n,t)=>{if(!n||typeof n!="object"){e.push(`inputs[${t}]不是一个对象`);return}(!("name"in n)||typeof n.name!="string")&&e.push(`inputs[${t}]缺少必需的name字段或name字段不是字符串类型`),"port"in n?typeof n.port!="string"&&!Array.isArray(n.port)&&e.push(`inputs[${t}].port字段必须是字符串类型或字符串数组`):e.push(`inputs[${t}]缺少必需的port字段`)})),"outputs"in a&&(a.outputs!==null&&!Array.isArray(a.outputs)?e.push("outputs字段必须是数组类型或null"):Array.isArray(a.outputs)&&a.outputs?.forEach((n,t)=>{if(!n||typeof n!="object"){e.push(`outputs[${t}]不是一个对象`);return}(!("name"in n)||typeof n.name!="string")&&e.push(`outputs[${t}]缺少必需的name字段或name字段不是字符串类型`),(!("port"in n)||typeof n.port!="string")&&e.push(`outputs[${t}]缺少必需的port字段或port字段不是字符串类型`)})),{isValid:e.length===0,errors:e}))}catch(a){return console.error("验证数据结构失败:",a),{isValid:!1,errors:["数据解析失败"]}}},H=o=>{try{const e=Q.load(o),a=[];return e&&e.nodes&&Array.isArray(e.nodes)&&e.nodes.forEach(n=>{n.type&&!I.has(n.type)&&a.push(n.type)}),{isValid:a.length===0,invalidTypes:a}}catch(e){return console.error("验证节点类型失败:",e),{isValid:!1,invalidTypes:[]}}},f=o=>{try{const e=Q.load(o),a=[];if(!e||!e.nodes||!Array.isArray(e.nodes))return{isValid:!1,duplicateNames:[]};const n=new Map;return e.nodes.forEach(t=>{if(t.name){const r=n.get(t.name)||0;n.set(t.name,r+1)}}),n.forEach((t,r)=>{t>1&&a.push(r)}),{isValid:a.length===0,duplicateNames:a}}catch(e){return console.error("验证节点名称唯一性失败:",e),{isValid:!1,duplicateNames:[]}}},y=o=>{const e=I.get(o);return e?{inputs:Object.keys(e.inputs||{}),outputs:Object.keys(e.outputs||{})}:{inputs:[],outputs:[]}};return{validateYaml:l,validateWorkflowDataStructure:N,validateNodeTypes:H,validateNodeNamesUnique:f,validateNodeOutputs:o=>{const e=[];try{const a=Q.load(o);if(!a||!a.nodes||!Array.isArray(a.nodes))return e.push("工作流缺少nodes数组"),{isValid:!1,errors:e};const n=new Set;return a.nodes.forEach(t=>{t.name&&n.add(t.name)}),a.nodes.forEach(t=>{if(!t.outputs||typeof t.outputs!="object")return;const i=y(t.type).outputs;Object.entries(t.outputs).forEach(([m,u])=>{i.includes(m)||e.push(`节点"${t.name}"的输出端口"${m}"不是${t.type}类型的合法输出端口`);const c=E=>{const[M,w]=E?.split("|")||[];if(M&&!n.has(M)){e.push(`节点"${t.name}"的输出端口"${m}"指向的目标节点"${M}"不存在`);return}const b=a.nodes.find(F=>F.name===M);if(!b)return;const D=y(b.type).inputs;w&&!D.includes(w)&&e.push(`节点"${t.name}"的输出端口"${m}"指向的目标端口"${w}"不是${b.type}类型的合法输入端口`)};typeof u=="string"?c(u):Array.isArray(u)&&u.forEach(E=>c(E))})}),{isValid:e.length===0,errors:e}}catch(a){return console.error("验证节点outputs失败:",a),{isValid:!1,errors:["验证节点outputs时发生错误"]}}},validateNodeInputs:o=>{const e=[];try{const a=Q.load(o),n=new Map;a.nodes.forEach(r=>{!r.outputs||typeof r.outputs!="object"||Object.entries(r.outputs).forEach(([i,m])=>{(Array.isArray(m)?m:[m]).forEach(c=>{const[E,M]=c?.split("|")||[];!E||!M||(n.has(E)||n.set(E,new Set),n.get(E).add(M))})})});const t=new Map;return a.inputs&&Array.isArray(a.inputs)&&a.inputs.forEach(r=>{r.port&&r.port.includes("|")&&(Array.isArray(r.port)?r.port:[r.port]).forEach(m=>{const[u,c]=m?.split("|");!u||!c||(t.has(u)||t.set(u,new Set),t.get(u).add(c))})}),{isValid:e.length===0,errors:e}}catch(a){return console.error("验证节点输入失败:",a),{isValid:!1,errors:["验证节点输入时发生错误"]}}},validateWorkflowInputsOutputs:o=>{try{const e=Q.load(o),a=[];if(!e.inputs&&!e.outputs)return{isValid:!0,errors:[]};const n={};return e.nodes&&Array.isArray(e.nodes)&&e.nodes.forEach(t=>{n[t.name]=t.type}),e.inputs&&Array.isArray(e.inputs)&&e.inputs.forEach((t,r)=>{if(!t.name){a.push(`inputs[${r}]缺少name字段`);return}if(!t.port){a.push(`inputs[${r}].${t.name}缺少port字段`);return}const i=m=>{const u=m?.split("|")||[];if(u.length!==2){a.push(`inputs[${r}].${t.name}流向的目标格式不正确，应为"节点名|端口名"`);return}const[c,E]=u;if(!c||!n[c]){a.push(`inputs[${r}].${t.name}流向的节点"${c}"不存在`);return}const M=n[c],w=y(M);(!E||!w.inputs.includes(E))&&a.push(`inputs[${r}].${t.name}流向的端口"${E}"不是节点"${c}"(类型:${M})的合法输入端口`)};Array.isArray(t.port)?t.port.forEach(m=>i(m)):i(t.port)}),e.outputs&&Array.isArray(e.outputs)&&e.outputs.forEach((t,r)=>{if(!t.name){a.push(`outputs[${r}]缺少name字段`);return}if(!t.port){a.push(`outputs[${r}].${t.name}缺少port字段`);return}const i=t.port?.split("|");if(i.length!==2){a.push(`outputs[${r}].${t.name}.port格式不正确，应为"节点名|端口名"`);return}const[m,u]=i;if(!m||!n[m]){a.push(`outputs[${r}].${t.name}来源的节点"${m}"不存在`);return}const c=n[m],E=y(c);(!u||!E.outputs.includes(u))&&a.push(`outputs[${r}].${t.name}来源的端口"${u}"不是节点"${m}"(类型:${c})的合法输出端口`)}),{isValid:a.length===0,errors:a}}catch(e){return console.error("验证工作流输入输出失败:",e),{isValid:!1,errors:["验证工作流输入输出时发生错误"]}}}}}const $e={fontSize:"14px",fontFamily:"JetBrains Mono, Consolas, monospace",lineHeight:"1.6"},Zt={borderLeftWidth:"2px"},L={insertedTextDecoration:"none",deletedTextDecoration:"line-through",insertedLinePadding:"1px 3px",borderRadious:"3px"},X={border:"none",paddingRight:"8px",fontSize:"0.9em",fontWeight:"500",lineHeight:"1.78"},Ee={border:"none",borderRadius:"4px",padding:"2px 10px"},eo={borderRadius:"2px"},Ce={borderRadius:"2px"},Ie={borderRadius:"4px",padding:"0 5px",margin:"0 2px"},He={width:"12px",height:"12px",borderRadius:"6px"},be={borderRadius:"4px",padding:"2px 6px"},se={borderRadius:"4px",borderRadiusSelected:"3px",lineHeight:"1.3",padding:"4px 8px",paddingRight:"8px"},ie="#ffffff",P="#24292e",tt="#BBDFFF",le="#6e7781",Ue="#f6f8fa",to="#116329",W="#6a737d",Te="#6f42c1",G="#005cc5",pe="#d73a49",Ae="#032f62",Ge="#22863a",Z="#e36209",oo="#f1f8ff",ee="#e1e4e8",ao="#f8f9fa",ne="#cb2431",no="#BBDFFF20",Ne=ao,Oe=P,ro=tt,so="#e8f0fe",io="#0366d6",Ke="#b08800",Ye="#79b8ff40",Re="#0969da",lo="#8250df",Je="#e6ffec80",qe="#ffebe980",Se="#0f6d31",Me="#cf222e",co=Qe.theme({"&":{color:P,backgroundColor:ie,fontSize:$e.fontSize,fontFamily:$e.fontFamily},".cm-content":{caretColor:Oe,lineHeight:$e.lineHeight},".cm-cursor, .cm-dropCursor":{borderLeftColor:Oe,borderLeftWidth:Zt.borderLeftWidth},".cm-fat-cursor":{backgroundColor:`${Oe}99`,color:ie},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:ro,color:P},".cm-selectionLayer":{zIndex:100},".cm-searchMatch":{backgroundColor:"#daebff",outline:`1px solid ${G}`,color:P,borderRadius:be.borderRadius,"& span":{color:P}},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#79b8ff",color:ie,padding:be.padding,"& span":{color:ie}},".cm-search.cm-panel.cm-textfield":{color:P,borderRadius:be.borderRadius,padding:be.padding},".cm-panels":{backgroundColor:Ue,color:le,borderRadius:"0 0 4px 4px"},".cm-panels.cm-panels-top":{borderBottom:`1px solid ${ee}`},".cm-panels.cm-panels-bottom":{borderTop:`1px solid ${ee}`},".cm-panel button":{backgroundColor:ie,color:P,border:Ee.border,borderRadius:Ee.borderRadius,padding:Ee.padding},".cm-panel button:hover":{backgroundColor:"#f5f5f5"},".cm-activeLine":{backgroundColor:no,borderRadius:eo.borderRadius,zIndex:1},".cm-gutters":{backgroundColor:Ue,color:le,border:X.border,borderRight:`1px solid ${ee}`,paddingRight:X.paddingRight},".cm-activeLineGutter":{backgroundColor:oo,color:P,fontWeight:X.fontWeight},".cm-lineNumbers":{fontSize:X.fontSize,lineHeight:X.lineHeight},".cm-foldGutter":{fontSize:X.fontSize,lineHeight:X.lineHeight},".cm-foldGutter .cm-gutterElement":{color:le,cursor:"pointer"},".cm-foldGutter .cm-gutterElement:hover":{color:P},".cm-insertedLine":{textDecoration:L.insertedTextDecoration,backgroundColor:Je,color:Se,padding:L.insertedLinePadding,borderRadius:L.borderRadious},"ins.cm-insertedLine, ins.cm-insertedLine:not(:has(.cm-changedText))":{textDecoration:L.insertedTextDecoration,backgroundColor:`${Je} !important`,color:Se,padding:L.insertedLinePadding,borderRadius:L.borderRadious,border:`1px solid ${Se}30`},"ins.cm-insertedLine .cm-changedText":{background:"transparent !important"},".cm-deletedLine":{textDecoration:L.deletedTextDecoration,backgroundColor:qe,color:Me,padding:L.insertedLinePadding,borderRadius:L.borderRadious},"del.cm-deletedLine, del, del:not(:has(.cm-deletedText))":{textDecoration:L.deletedTextDecoration,backgroundColor:`${qe} !important`,color:Me,padding:L.insertedLinePadding,borderRadius:L.borderRadious,border:`1px solid ${Me}30`},"del .cm-deletedText, del .cm-changedText":{background:"transparent !important"},".cm-tooltip":{backgroundColor:Ne,border:`1px solid ${ee}`,borderRadius:se.borderRadius,padding:se.padding,boxShadow:"0 1px 5px rgba(0, 0, 0, 0.1)"},".cm-tooltip-autocomplete":{"& > ul":{backgroundColor:Ne,border:"none"},"& > ul > li":{padding:se.padding,lineHeight:se.lineHeight},"& > ul > li[aria-selected]":{backgroundColor:"#0366d630",color:P,borderRadius:se.borderRadiusSelected},"& > ul > li:hover":{backgroundColor:"#0366d615"},"& > ul > li > span.cm-completionIcon":{color:le,paddingRight:se.paddingRight},"& > ul > li > span.cm-completionDetail":{color:le,fontStyle:"italic"}},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:Ne,borderBottomColor:Ne},".cm-diagnostic":{"&-error":{borderLeft:`3px solid ${ne}`},"&-warning":{borderLeft:`3px solid ${Ke}`},"&-info":{borderLeft:`3px solid ${Re}`}},".cm-lintPoint-error":{borderBottom:`2px wavy ${ne}`},".cm-lintPoint-warning":{borderBottom:`2px wavy ${Ke}`},".cm-matchingBracket":{backgroundColor:so,outline:`1px solid ${io}80`,borderRadius:Ce.borderRadius},".cm-nonmatchingBracket":{backgroundColor:"#ffeef080",outline:`1px solid ${ne}`,borderRadius:Ce.borderRadius},".cm-selectionMatch":{backgroundColor:Ye,outline:`1px solid ${tt}50`,borderRadius:Ce.borderRadius},".cm-foldPlaceholder":{backgroundColor:Ye,color:le,border:`1px dotted ${ee}70`,borderRadius:Ie.borderRadius,padding:Ie.padding,margin:Ie.margin},"&.cm-focused":{outline:"none",boxShadow:`0 0 0 2px ${ie}, 0 0 0 3px ${Re}40`},"& .cm-scroller::-webkit-scrollbar":{width:He.width,height:He.height},"& .cm-scroller::-webkit-scrollbar-track":{background:ee},"& .cm-scroller::-webkit-scrollbar-thumb":{backgroundColor:P,borderRadius:He.borderRadius,border:`3px solid ${ee}`},"& .cm-scroller::-webkit-scrollbar-thumb:hover":{backgroundColor:W},".cm-ghostText":{opacity:"0.5",color:"#959da5"}},{dark:!1}),uo=Et.define([{tag:s.keyword,color:pe,fontWeight:"bold"},{tag:s.controlKeyword,color:pe,fontWeight:"bold"},{tag:s.moduleKeyword,color:pe,fontWeight:"bold"},{tag:[s.name,s.deleted,s.character,s.macroName],color:G},{tag:[s.variableName],color:G},{tag:[s.propertyName],color:Te,fontStyle:"normal"},{tag:[s.typeName],color:pe},{tag:[s.className],color:Te,fontStyle:"italic"},{tag:[s.namespace],color:G,fontStyle:"italic"},{tag:[s.operator,s.operatorKeyword],color:P},{tag:[s.bracket],color:W},{tag:[s.brace],color:W},{tag:[s.punctuation],color:W},{tag:[s.function(s.variableName),s.labelName],color:Ge},{tag:[s.definition(s.variableName)],color:G},{tag:s.number,color:Z},{tag:s.changed,color:Z},{tag:s.annotation,color:ne,fontStyle:"italic"},{tag:s.modifier,color:Z,fontStyle:"italic"},{tag:s.self,color:Z},{tag:[s.color,s.constant(s.name),s.standard(s.name)],color:Z},{tag:[s.atom,s.bool,s.special(s.variableName)],color:Z},{tag:[s.processingInstruction,s.inserted],color:Ge},{tag:[s.special(s.string),s.regexp],color:Ae},{tag:s.string,color:Ae},{tag:s.definition(s.typeName),color:pe,fontWeight:"bold"},{tag:s.meta,color:W},{tag:s.comment,fontStyle:"italic",color:W},{tag:s.docComment,fontStyle:"italic",color:W},{tag:[s.tagName],color:to},{tag:[s.attributeName],color:Te},{tag:[s.heading],fontWeight:"bold",color:G},{tag:[s.strong],fontWeight:"bold",color:G},{tag:[s.emphasis],fontStyle:"italic",color:Ae},{tag:[s.link],color:lo,fontWeight:"500",textDecoration:"underline",textUnderlinePosition:"under"},{tag:[s.url],color:Re,textDecoration:"underline",textUnderlineOffset:"2px"},{tag:[s.invalid],color:P,textDecoration:"underline wavy",borderBottom:`1px wavy ${ne}`},{tag:[s.strikethrough],color:ne,textDecoration:"line-through"},{tag:s.constant(s.name),color:Z},{tag:s.deleted,color:ne},{tag:s.squareBracket,color:W},{tag:s.angleBracket,color:W},{tag:s.monospace,color:P},{tag:[s.contentSeparator],color:G},{tag:s.quote,color:W}]),po=[co,Xe(uo)],go={class:"raw-editor"},fo={key:0,class:"warning-banner"},mo={class:"warning-content"},ho={class:"warning-text"},vo={key:1,class:"warning-banner"},yo={class:"warning-content"},bo={class:"warning-text"},No={class:"content-container"},_o={key:2,class:"editor-actions"},wo=Y({__name:"RawJsonEditor",setup(I){const l=T("workflowData"),N=T("isEditMode",!1),H=T("emitter"),f=V(`name: 
`),y=V("");let h=null;const k=V(!1),C=V("");let o=null;const e=[Ct(),It(),Ht(),Tt(),At(),Ot(),Xe(Bt,{fallback:!0}),St(),Mt(),Dt(),Rt(),Pt,Lt.tabSize.of(2),po,Qe.theme({"&":{height:"100%"}})],a=V(),n=w=>{a.value=w.view},t=w=>{h&&clearTimeout(h),y.value=w,h=setTimeout(()=>{y.value="",h=null},5e3)},r=()=>{y.value="",h&&(clearTimeout(h),h=null)},i=(w,b)=>{C.value=w,o=b,k.value=!0},m=w=>{k.value=!1,o&&(o(w),o=null)},u=Xt(),c=()=>{if(!u.validateYaml(f.value)){t("YAML格式错误，请检查输入！");return}const w=u.validateWorkflowDataStructure(f.value);if(!w.isValid){t(`数据结构不符合要求：${w.errors.join("；")}`);return}const b=u.validateNodeTypes(f.value);if(!b.isValid){t(`节点类型错误：${b.invalidTypes.join(", ")} 不存在于！`);return}const O=u.validateNodeNamesUnique(f.value);if(!O.isValid){t(`节点名称不唯一：${O.duplicateNames.join(", ")} 出现重复！`);return}const D=u.validateNodeOutputs(f.value);if(!D.isValid){t(`节点outputs验证失败：${D.errors.join("；")}`);return}const F=u.validateNodeInputs(f.value);if(!F.isValid){t(`节点输入验证失败：${F.errors.join("；")}`);return}const me=u.validateWorkflowInputsOutputs(f.value);if(!me.isValid){t(`工作流输入输出验证失败：${me.errors.join("；")}`);return}if(r(),H)try{const he=ht(f.value);H.emit("previewJson",ue(he,{indent:2}))}catch{t("预览失败，请检查YAML格式！")}},E=()=>{l?.value&&(f.value=ue(l.value,{indent:2}))},M=()=>{try{if(l?.value)try{f.value=ue(l.value,{indent:2})}catch(w){console.error("序列化失败:",w),f.value="{}"}(!f.value||f.value.trim()==="")&&(f.value="name: ")}catch(w){console.error("初始化编辑元素失败:",w),f.value="{}"}};return oe(()=>N,w=>{w&&setTimeout(()=>{M()},10)}),oe(()=>l?.value,(w,b)=>{if(w&&b&&N){const O=ue(w,{indent:2});f.value!==O&&i("工作流数据已更新，是否替换当前编辑内容？",D=>{D&&(f.value=O)})}else w&&!N&&(f.value=ue(w,{indent:2}))},{deep:!0}),qt(()=>{M()}),(w,b)=>{const O=Ze;return x(),S("div",go,[y.value?(x(),S("div",fo,[g("div",mo,[b[4]||(b[4]=g("span",{class:"warning-icon"},"⚠️",-1)),g("span",ho,re(y.value),1),p(O,{type:"warning",link:"",onClick:r},{default:$(()=>[...b[3]||(b[3]=[K("×",-1)])]),_:1})])])):U("",!0),k.value?(x(),S("div",vo,[g("div",yo,[b[7]||(b[7]=g("span",{class:"warning-icon"},"⚠️",-1)),g("span",bo,re(C.value),1),p(O,{type:"warning",link:"",onClick:b[0]||(b[0]=D=>m(!1))},{default:$(()=>[...b[5]||(b[5]=[K("取消",-1)])]),_:1}),p(O,{type:"warning",onClick:b[1]||(b[1]=D=>m(!0))},{default:$(()=>[...b[6]||(b[6]=[K("确定替换",-1)])]),_:1})])])):U("",!0),g("div",No,[p(v(Vt),{modelValue:f.value,"onUpdate:modelValue":b[2]||(b[2]=D=>f.value=D),extensions:e,disabled:!v(N),onReady:n},null,8,["modelValue","disabled"])]),v(N)?(x(),S("div",_o,[p(O,{type:"primary",onClick:c},{default:$(()=>[...b[8]||(b[8]=[K("预览",-1)])]),_:1}),p(O,{onClick:E},{default:$(()=>[...b[9]||(b[9]=[K("重置为原始数据",-1)])]),_:1})])):U("",!0)])}}}),ko=de(wo,[["__scopeId","data-v-c9e7ffc5"]]),xo={class:"handle-name"},$o=Y({__name:"NodeHandle",props:{handle:{}},setup(I){const l=I,N=T(A.NODE_DATA_MAP),H=fe().nodeSchemaMap,f=z(()=>{if(d.isModuleNode(l.handle.nodeId)){const y=N?.value?.get(l.handle.nodeId)?.type;if(!y)return!1;const h=H.get(y);return h?l.handle.type==="in"?l.handle.handleName in h.inputs:l.handle.handleName in h.outputs:!1}else return!0});return(y,h)=>{const k=jt;return x(),S("div",{class:Le([l.handle.type==="in"?"input-handle":"output-handle",{inValid:!f.value}])},[p(v(ut),{class:"handle-circle",id:v(d).getHandleId(l.handle),position:l.handle.type==="in"?v(Fe).Left:v(Fe).Right},null,8,["id","position"]),g("span",xo,re(l.handle.handleName),1),p(k,null,{default:$(()=>[g("p",null,[h[0]||(h[0]=g("span",{class:"injected-value-title"},"已注入值",-1)),g("span",null,re(l.handle.value),1)])]),reference:$(()=>[l.handle.value?(x(),B(v(vt),{key:0,class:"handle-value-mark"})):U("",!0)]),_:1})],2)}}}),_e=de($o,[["__scopeId","data-v-24475ffe"]]),_a=J({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{fill:"currentColor",d:"M224 480h640a32 32 0 1 1 0 64H224a32 32 0 0 1 0-64"},child:[]},{tag:"path",attr:{fill:"currentColor",d:"m237.248 512 265.408 265.344a32 32 0 0 1-45.312 45.312l-288-288a32 32 0 0 1 0-45.312l288-288a32 32 0 1 1 45.312 45.312z"},child:[]}]}),Eo=J({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m-55.808 536.384-99.52-99.584a38.4 38.4 0 1 0-54.336 54.336l126.72 126.72a38.272 38.272 0 0 0 54.336 0l262.4-262.464a38.4 38.4 0 1 0-54.272-54.336z"},child:[]}]}),Co=J({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m0 393.664L407.936 353.6a38.4 38.4 0 1 0-54.336 54.336L457.664 512 353.6 616.064a38.4 38.4 0 1 0 54.336 54.336L512 566.336 616.064 670.4a38.4 38.4 0 1 0 54.336-54.336L566.336 512 670.4 407.936a38.4 38.4 0 1 0-54.336-54.336z"},child:[]}]}),ot=J({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{fill:"currentColor",d:"M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32m0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32m448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32m-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32M195.2 195.2a32 32 0 0 1 45.248 0L376.32 331.008a32 32 0 0 1-45.248 45.248L195.2 240.448a32 32 0 0 1 0-45.248zm452.544 452.544a32 32 0 0 1 45.248 0L828.8 783.552a32 32 0 0 1-45.248 45.248L647.744 692.992a32 32 0 0 1 0-45.248zM828.8 195.264a32 32 0 0 1 0 45.184L692.992 376.32a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0m-452.544 452.48a32 32 0 0 1 0 45.248L240.448 828.8a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0z"},child:[]}]}),Io={class:"module-title"},Ho={class:"module-name"},To={class:"module-handles"},Ao={class:"module-inputs"},Oo={class:"content-list-container"},So={class:"module-outputs"},Mo={class:"content-list-container"},Do={class:"test-running-progress running-status"},Ro={class:"test-running-progress finished-status"},Po={class:"test-running-progress error-status"},Lo=Y({__name:"ModuleNode",props:{id:{},type:{},selected:{type:Boolean},connectable:{type:[Boolean,Number,String,Function]},position:{},dimensions:{},label:{},isValidTargetPos:{type:Function},isValidSourcePos:{type:Function},parent:{},parentNodeId:{},dragging:{type:Boolean},resizing:{type:Boolean},zIndex:{},targetPosition:{},sourcePosition:{},dragHandle:{},data:{},events:{}},setup(I){const l=I,N=T(A.NODE_DATA_MAP),H=T(A.NODE_FOR_INSPECTION),f=T(A.TEST_RUNNING_RECORD),y=fe().nodeSchemaMap,h=z(()=>N?.value?.get(l.id)),k=z(()=>H?.value?.id===l.id||l.selected),C=z(()=>h?.value?.type?y.has(h.value.type):!0),o=z(()=>{const e=d.nodeIdToName(l.id),a=f?.runningNodes.has(e),n=f?.finishedNodes.has(e);if(f?.errorNodes.has(e))return"error";if(a)return"running";if(n)return"finished"});return(e,a)=>{const n=Ft;return h.value?(x(),S("div",{key:0,class:Le(["module-node",{selected:k.value}])},[g("div",Io,[g("span",Ho,re(h.value?.name||"未命名模块"),1),p(n,{class:"module-type",type:C.value?"primary":"danger"},{default:$(()=>[K(re(h.value?.type||"未知类型"),1)]),_:1},8,["type"])]),g("div",To,[g("div",Ao,[a[0]||(a[0]=g("div",{class:"content-section-title"},"输入",-1)),g("div",Oo,[(x(!0),S(ae,null,ge(Object.entries(h.value?.inputs||{})||[],([t,r])=>(x(),B(_e,{key:t,handle:r},null,8,["handle"]))),128))])]),g("div",So,[a[1]||(a[1]=g("div",{class:"content-section-title"},"输出",-1)),g("div",Mo,[(x(!0),S(ae,null,ge(Object.entries(h.value?.outputs||{})||[],([t,r])=>(x(),B(_e,{key:t,handle:r},null,8,["handle"]))),128))])])]),we(g("div",Do,[p(v(ot),{class:"progress-status-icon"}),a[2]||(a[2]=g("span",{class:"progress-status-text"},"运行中",-1))],512),[[ke,o.value==="running"]]),we(g("div",Ro,[p(v(Eo),{class:"progress-status-icon"}),a[3]||(a[3]=g("span",{class:"progress-status-text"},"运行完毕",-1))],512),[[ke,o.value==="finished"]]),we(g("div",Po,[p(v(Co),{class:"progress-status-icon"}),a[4]||(a[4]=g("span",{class:"progress-status-text"},"运行出错",-1))],512),[[ke,o.value==="error"]])],2)):U("",!0)}}}),Vo=de(Lo,[["__scopeId","data-v-9a6cc41b"]]),Bo=J({tag:"svg",attr:{viewBox:"0 0 48 48",fill:"none"},child:[{tag:"path",attr:{d:"M41.5 10H35.5","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},child:[]},{tag:"path",attr:{d:"M27.5 6V14","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},child:[]},{tag:"path",attr:{d:"M27.5 10L5.5 10","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},child:[]},{tag:"path",attr:{d:"M13.5 24H5.5","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},child:[]},{tag:"path",attr:{d:"M21.5 20V28","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},child:[]},{tag:"path",attr:{d:"M43.5 24H21.5","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},child:[]},{tag:"path",attr:{d:"M41.5 38H35.5","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},child:[]},{tag:"path",attr:{d:"M27.5 34V42","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},child:[]},{tag:"path",attr:{d:"M27.5 38H5.5","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"},child:[]}]});function Ve(I){const l=T(A.WORKFLOW_DATA),N=T(A.NODE_DATA_MAP),H=fe().nodeSchemaMap,f=(o,e)=>{if(!H.has(o)){te.error(`节点类型 ${o} 不合法`);return}let a="新节点";for(;N?.value.has(d.configNameToNodeId(a));)a+="(1)";const n=d.configNameToNodeId(a);I.addNodes({id:n,type:"module",position:e??{x:0,y:0}});const t={name:a,type:o};l?.value?.nodes.push(t)},y=o=>{const e=o.source,a=o.target,n=N?.value.get(e),t=N?.value.get(a);if(d.isModuleNode(e)&&d.isModuleNode(a)){const r=Object.values(n?.outputs||{}).find(i=>d.getHandleId(i)===o.sourceHandle);if(r){const i=l?.value.nodes.find(m=>n?.name===m.name)?.outputs;if(typeof i?.[r.handleName]=="string"||i?.[r.handleName]===null)delete i[r.handleName];else if(Array.isArray(i?.[r.handleName])){const m=Object.values(t?.inputs||{}).find(u=>d.getHandleId(u)===o.targetHandle);i[r.handleName]=i[r.handleName].filter(u=>u!==`${t?.name}|${m?.handleName}`)}}}if(d.isInputNode(e)){const r=Object.values(n?.outputs||{}).find(i=>d.getHandleId(i)===o.sourceHandle);if(r){const i=l?.value.inputs?.find(m=>m.name===r.handleName);if(typeof i?.port=="string")i.port=[];else if(Array.isArray(i?.port)){const m=Object.values(t?.inputs||{}).find(u=>d.getHandleId(u)===o.targetHandle);i.port=i.port.filter(u=>u!==`${t?.name}|${m?.handleName}`)}}}if(d.isOutputNode(a)){const r=Object.values(t?.inputs||{}).find(i=>d.getHandleId(i)===o.targetHandle);if(r){const i=l?.value.outputs?.find(m=>m.name===r.handleName);i&&(i.port="")}}},h=o=>{const e=I.edges.value.filter(t=>t.targetHandle===o.targetHandle);if(e.some(t=>t.sourceHandle===o.sourceHandle)){te.warning("无需重复连线");return}for(const t of e)y(t);const a=d.getHandleType(o.sourceHandle||"",o.source),n=d.getHandleType(o.targetHandle||"",o.target);if(a!=="out"||n!=="in"){te.error("请从输出端口连接到输入端口");return}if(d.isInputNode(o.source)){if(!d.isModuleNode(o.target)){te.error("暂不支持从入口节点直连出口节点");return}const t=l?.value.inputs?.find(r=>d.getHandleId({nodeId:o.source,type:"out",handleName:r.name})===o.sourceHandle);t?.port?typeof t?.port=="string"?t.port=[t.port,`${d.nodeIdToName(o.target)}|${d.extractHandleName(o.targetHandle,o.target,"in")}`]:Array.isArray(t?.port)&&(t.port=[...t.port,`${d.nodeIdToName(o.target)}|${d.extractHandleName(o.targetHandle,o.target,"in")}`]):t.port=`${d.nodeIdToName(o.target)}|${d.extractHandleName(o.targetHandle,o.target,"in")}`}else if(d.isModuleNode(o.source)){if(d.isOutputNode(o.target)){const t=l?.value.outputs?.find(r=>d.getHandleId({nodeId:o.target,type:"in",handleName:r.name})===o.targetHandle);t&&(t.port=`${d.nodeIdToName(o.source)}|${d.extractHandleName(o.sourceHandle,o.source,"out")}`)}else if(d.isModuleNode(o.target)){const t=l?.value.nodes.find(i=>d.configNameToNodeId(i.name)===o.source)?.outputs,r=d.extractHandleName(o.sourceHandle,o.source,"out");t?.[r]===null?t[r]=[`${d.nodeIdToName(o.target)}|${d.extractHandleName(o.targetHandle,o.target,"in")}`]:t?.[r]&&typeof t?.[r]=="string"?t[r]=[t[r],`${d.nodeIdToName(o.target)}|${d.extractHandleName(o.targetHandle,o.target,"in")}`]:Array.isArray(t?.[r])?t[r]=[...t[r],`${d.nodeIdToName(o.target)}|${d.extractHandleName(o.targetHandle,o.target,"in")}`]:t&&!t[r]&&(t[r]=`${d.nodeIdToName(o.target)}|${d.extractHandleName(o.targetHandle,o.target,"in")}`)}}};return{addNewNode:f,disconnectEdge:y,connectEdge:h,renameNode:(o,e)=>{const a=[],n=[],t=d.configNameToNodeId(o),r=d.configNameToNodeId(e),i=I.edges.value.filter(c=>c.target===t);for(const c of i)a.push(c),n.push({source:c.source,sourceHandle:c.sourceHandle,target:r,targetHandle:d.getHandleId({nodeId:r,type:"in",handleName:d.extractHandleName(c.targetHandle,c.target,"in")})});const m=I.edges.value.filter(c=>c.source===t&&d.isOutputNode(c.target));for(const c of m)a.push(c),n.push({source:r,sourceHandle:d.getHandleId({nodeId:r,type:"out",handleName:d.extractHandleName(c.sourceHandle,c.source,"out")}),target:c.target,targetHandle:c.targetHandle});const u=l?.value.nodes.find(c=>c.name===o);u&&(u.name=e);for(const c of a)y(c);for(const c of n)h(c)},deleteHandle:o=>{const e=N?.value.get(o.nodeId);if(e)if(d.isInputNode(o.nodeId))o.type==="out"&&l?.value.inputs&&(l.value.inputs=l.value.inputs.filter(a=>a.name!==o.handleName));else if(d.isOutputNode(o.nodeId))o.type==="in"&&l?.value.outputs&&(l.value.outputs=l.value.outputs.filter(a=>a.name!==o.handleName));else{const a=H.get(e.type);if(a&&(o.type==="in"&&o.handleName in a.inputs||o.type==="out"&&o.handleName in a.outputs)){te.error(`不支持删除节点类型${e.type}中预定义的端口${o.handleName}`);return}const n=d.getHandleId(o);if(o.type==="in"){const t=I.edges.value.filter(r=>r.targetHandle===n);for(const r of t)y(r)}else if(o.type==="out"){const t=l?.value.nodes.find(i=>i.name===e.name);t?.outputs&&o.handleName in t.outputs&&delete t.outputs[o.handleName];const r=I.edges.value.filter(i=>i.sourceHandle===n&&d.isOutputNode(i.target));for(const i of r)y(i)}}}}}const jo={class:"menu-item"},Fo=Y({__name:"ElementContextMenu",props:{show:{type:Boolean},options:{}},emits:["close"],setup(I,{emit:l}){const N=I,H=l,f=T(A.WORKFLOW_DATA),y=Pe(),{disconnectEdge:h}=Ve(y),k=()=>{const C=new Set(y.getSelectedNodes.value.filter(e=>!d.isInputNode(e.id)&&!d.isOutputNode(e.id)).map(e=>e.id)),o=new Set(y.getSelectedEdges.value.filter(e=>!C.has(e.source)));y.edges.value.forEach(e=>{C.has(e.target)&&o.add(e)});for(const e of o)h(e);f&&(f.value.nodes=f?.value.nodes.filter(e=>!C.has(d.configNameToNodeId(e.name))))};return(C,o)=>(x(),B(v(et),{show:N.show,options:{...N.options,theme:"studio-canvas-context-menu"},onClose:o[0]||(o[0]=e=>H("close"))},{default:$(()=>[p(v(De),{class:"danger-item",onClick:k},{default:$(()=>[g("div",jo,[p(v(yt),{class:"menu-item-icon"}),o[1]||(o[1]=g("span",null,"删除",-1))])]),_:1})]),_:1},8,["show","options"]))}}),Wo=J({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M64 32C64 14.3 49.7 0 32 0S0 14.3 0 32V64 368 480c0 17.7 14.3 32 32 32s32-14.3 32-32V352l64.3-16.1c41.1-10.3 84.6-5.5 122.5 13.4c44.2 22.1 95.5 24.8 141.7 7.4l34.7-13c12.5-4.7 20.8-16.6 20.8-30V66.1c0-23-24.2-38-44.8-27.7l-9.6 4.8c-46.3 23.2-100.8 23.2-147.1 0c-35.1-17.6-75.4-22-113.5-12.5L64 48V32z"},child:[]}]}),zo=J({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"},child:[]}]}),Uo={class:"port-title"},Go={class:"port-handles"},Ko={key:0,class:"port-inputs"},Yo={class:"content-list-container"},Jo={key:1,class:"port-outputs"},qo={class:"content-list-container"},Qo=Y({__name:"WorkflowPortNode",props:{id:{},type:{},selected:{type:Boolean},connectable:{type:[Boolean,Number,String,Function]},position:{},dimensions:{},label:{},isValidTargetPos:{type:Function},isValidSourcePos:{type:Function},parent:{},parentNodeId:{},dragging:{type:Boolean},resizing:{type:Boolean},zIndex:{},targetPosition:{},sourcePosition:{},dragHandle:{},data:{},events:{}},setup(I){const l=I,N=T(A.NODE_DATA_MAP),H=T(A.NODE_FOR_INSPECTION),f=z(()=>d.isInputNode(l.id)?"in":"out"),y=z(()=>N?.value?.get(l.id)),h=z(()=>H?.value?.id===l.id||l.selected);return(k,C)=>(x(),S("div",{class:Le(["port-node",{selected:h.value}])},[g("div",Uo,[f.value==="in"?(x(),S(ae,{key:0},[p(v(zo),{class:"title-icon"}),C[0]||(C[0]=g("span",{class:"title-text"},"工作流入口",-1))],64)):(x(),S(ae,{key:1},[p(v(Wo),{class:"title-icon"}),C[1]||(C[1]=g("span",{class:"title-text"},"工作流出口",-1))],64))]),g("div",Go,[f.value==="out"&&Object.keys(y.value?.inputs||{}).length>0?(x(),S("div",Ko,[g("div",Yo,[(x(!0),S(ae,null,ge(Object.entries(y.value?.inputs||{})||[],([o,e])=>(x(),B(_e,{key:o,handle:e},null,8,["handle"]))),128))])])):U("",!0),f.value==="in"&&Object.keys(y.value?.outputs||{}).length>0?(x(),S("div",Jo,[g("div",qo,[(x(!0),S(ae,null,ge(Object.entries(y.value?.outputs||{})||[],([o,e])=>(x(),B(_e,{key:o,handle:e},null,8,["handle"]))),128))])])):U("",!0)])],2))}}),Xo=de(Qo,[["__scopeId","data-v-6369476f"]]),Zo=J({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},child:[{tag:"rect",attr:{width:"7",height:"9",x:"3",y:"3",rx:"1"},child:[]},{tag:"rect",attr:{width:"7",height:"5",x:"14",y:"3",rx:"1"},child:[]},{tag:"rect",attr:{width:"7",height:"9",x:"14",y:"12",rx:"1"},child:[]},{tag:"rect",attr:{width:"7",height:"5",x:"3",y:"16",rx:"1"},child:[]}]}),ea={class:"menu-item"},ta={class:"menu-item"},oa=Y({__name:"PaneContextMenu",props:{show:{type:Boolean},options:{}},emits:["close"],setup(I,{emit:l}){const N=I,H=l,f=T(A.IS_EDIT_MODE),y=T(A.WORKFLOW_NEED_LAYOUT),h=T(A.CREATE_NEW_NODE_OPEN),k=()=>{h&&(h.value=!0)},C=()=>{y&&(y.value=!0)};return(o,e)=>(x(),B(v(et),{show:N.show,options:{...N.options,theme:"studio-canvas-context-menu"},onClose:e[0]||(e[0]=a=>H("close"))},{default:$(()=>[v(f)?(x(),B(v(De),{key:0,onClick:k},{default:$(()=>[g("div",ea,[p(v(bt),{class:"menu-item-icon"}),e[1]||(e[1]=g("span",null,"新建节点",-1))])]),_:1})):U("",!0),p(v(De),{onClick:C},{default:$(()=>[g("div",ta,[p(v(Zo),{class:"menu-item-icon"}),e[2]||(e[2]=g("span",null,"重排布局",-1))])]),_:1})]),_:1},8,["show","options"]))}}),aa={class:"type-info"},na=Y({__name:"CreateNewNodeDialog",props:{pos:{}},setup(I){const l=I,N=T(A.CREATE_NEW_NODE_OPEN),H=fe().nodeSchemaMap,f=Pe(),{addNewNode:y}=Ve(f),h=z(()=>[...H.values()]),k=V(h.value[0]?.name??"");oe(h,()=>{h.value[0]&&(k.value=k.value||h.value[0]?.name)});const C=z(()=>H.get(k.value)),o=()=>{N&&(N.value=!1)},e=()=>{k.value&&(y(k.value,l.pos),N&&(N.value=!1))};return(a,n)=>{const t=zt,r=Ut,i=Gt,m=Kt,u=Ze,c=Wt;return x(),B(c,{modelValue:v(N),"onUpdate:modelValue":n[1]||(n[1]=E=>Qt(N)?N.value=E:null),title:"新建节点 · 选择节点类型","align-center":""},{default:$(()=>[p(r,{modelValue:k.value,"onUpdate:modelValue":n[0]||(n[0]=E=>k.value=E),placeholder:h.value[0]?.name},{default:$(()=>[(x(!0),S(ae,null,ge(h.value,E=>(x(),B(t,{key:E.name,label:E.name,value:E.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),g("div",aa,[g("div",null,[n[2]||(n[2]=g("p",{class:"type-info-entry-title"},"输入",-1)),p(m,{data:Object.values(C.value?.inputs||{})},{default:$(()=>[p(i,{prop:"name",label:"端口名",width:"140"}),p(i,{prop:"type",label:"数据类型"}),p(i,{prop:"default_value",label:"默认值"})]),_:1},8,["data"])]),g("div",null,[n[3]||(n[3]=g("p",{class:"type-info-entry-title"},"输出",-1)),p(m,{data:Object.values(C.value?.outputs||{})},{default:$(()=>[p(i,{prop:"name",label:"端口名",width:"140"}),p(i,{prop:"type",label:"数据类型"})]),_:1},8,["data"])])])]),footer:$(()=>[p(u,{onClick:o},{default:$(()=>[...n[4]||(n[4]=[K("取消",-1)])]),_:1}),p(u,{type:"primary",onClick:e,disabled:!k.value},{default:$(()=>[...n[5]||(n[5]=[K(" 新建 ",-1)])]),_:1},8,["disabled"])]),_:1},8,["modelValue"])}}}),ra=de(na,[["__scopeId","data-v-05389113"]]),sa={key:0,class:"trace-inspection-indicator"},ia={class:"trace-inspection-content"},la={class:"inspected-trace-id"},da=Y({__name:"WorkflowEditor",setup(I){const l=ye(()=>ve(()=>import("./EditorSidePanel-BLIPel8z.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url)),N=ye(()=>ve(()=>import("./FeedbackPanel-DufEqQxi.js"),__vite__mapDeps([16,1,2,10,6,4,3,7,5,9,11,12,17,18,19,20,15,8,13,21,22]),import.meta.url)),H=ye(()=>ve(()=>import("./NodeDetailWrapper-tuRfvIsa.js"),__vite__mapDeps([23,1,2,10,6,4,3,7,5,9,11,12,8,17,18,13,24,22,25,15]),import.meta.url)),f=ye(()=>ve(()=>import("./TracePanelWrapper-CGsS47oK.js"),__vite__mapDeps([26,4,1,2,10,6,3,7,5,9,11,12,19,20,15,17,18,8,13,27,22,25]),import.meta.url)),y=T(A.WORKFLOW_NEED_LAYOUT),h=T(A.NODE_DATA_MAP),k=T(A.TRACE_OPEN),C=T(A.FEEDBACK_OPEN),o=T(A.RAW_JSON_OPEN),e=T(A.IS_EDIT_MODE),a=V(Date.now().toString()),n=Pe(a.value),{connectEdge:t}=Ve(n),r={module:We(Vo),port:We(Xo)},i=V([]),m=V([]),u=V();oe(()=>n.getSelectedNodes.value,(_,R)=>{if(_.length===0){u.value=void 0;return}const j=new Set(R.map(q=>q.id)),ce=_.filter(q=>!j.has(q.id));ce.length>0&&(u.value=ce[ce.length-1])});const c=xe({});ze(A.NODE_FOR_INSPECTION,u),ze(A.TRACE_FOR_INSPECTION,c),oe(()=>h?.value,_=>{if(!_)return;const{nodes:R,edges:j}=xt(_,i.value);i.value=R,m.value=j},{immediate:!0}),oe([i,m,y],async()=>{if(!y?.value)return;const _=await $t(i.value,m.value,h?.value??new Map);y&&(y.value=!1),i.value=_},{immediate:!0});const E=()=>{u.value=void 0},M=()=>{c.detail=void 0,c.traceId=void 0},w=async()=>{if(c.traceId)try{const _=await dt.post("/detail",{trace_id:c.traceId},{base:ct()});c.detail=_.trace}catch{te.error("加载运行记录详情失败"),c.detail=null}};oe(()=>c.traceId,_=>{k&&_&&(k.value=!0),w()});const b=V(!1),O=xe({x:0,y:0}),D=V(!1),F=xe({x:0,y:0}),me=_=>{_.event.preventDefault(),_.node.selected?u.value=_.node:(n.setNodes(R=>R.map(j=>({...j,selected:j.id===_.node.id}))),n.removeSelectedEdges(n.edges.value)),e?.value&&(O.x=_.event.x,O.y=_.event.y,b.value=!0)},he=_=>{_.event.preventDefault(),_.edge.selected||(n.setEdges(R=>R.map(j=>({...j,selected:j.id===_.edge.id}))),n.removeSelectedNodes(n.nodes.value)),e?.value&&(O.x=_.event.x,O.y=_.event.y,b.value=!0)},at=_=>{_.preventDefault(),F.x=_.x,F.y=_.y,D.value=!0},nt=_=>{if(!e?.value){te.warning("请在编辑模式下进行连线编辑");return}t(_)},Be=()=>{b.value=!1},je=()=>{D.value=!1},rt=()=>{Be(),je()},st=()=>{k&&(k.value=!1)},it=()=>{C&&(C.value=!1)},lt=()=>{o&&(o.value=!1)};return(_,R)=>{const j=Yt,ce=Jt;return x(),B(ce,{class:"work-flow-editor"},{default:$(()=>[p(j,{class:"flow-wrapper",min:"5%"},{default:$(()=>[p(v(pt),{id:a.value,"node-types":r,nodes:i.value,"onUpdate:nodes":R[0]||(R[0]=q=>i.value=q),edges:m.value,"onUpdate:edges":R[1]||(R[1]=q=>m.value=q),"fit-view":"",class:"flow-canvas",onNodeContextMenu:me,onEdgeContextMenu:he,onPaneContextMenu:at,onMoveStart:rt,onConnect:nt},{default:$(()=>[p(v(gt)),p(v(ft)),p(v(mt),{pannable:"",zoomable:""})]),_:1},8,["id","nodes","edges"]),p(Fo,{show:b.value,options:O,onClose:Be},null,8,["show","options"]),p(oa,{show:D.value,options:F,onClose:je},null,8,["show","options"]),p(ra,{pos:{x:F.x,y:F.y}},null,8,["pos"])]),_:1}),p(v(l),{show:!!u.value,title:"节点信息",icon:v(Bo),"on-close":E},{default:$(()=>[p(v(H))]),_:1},8,["show","icon"]),p(v(l),{show:v(k),title:"运行记录",icon:v(Nt),"on-close":st},{default:$(()=>[p(v(f))]),_:1},8,["show","icon"]),p(v(l),{show:v(C),title:"反馈列表",icon:v(_t),"on-close":it},{default:$(()=>[p(v(N))]),_:1},8,["show","icon"]),p(v(l),{show:v(o),title:"配置文本",icon:v(wt),"on-close":lt},{default:$(()=>[p(ko)]),_:1},8,["show","icon"]),c.traceId?(x(),S("div",sa,[c.detail===void 0?(x(),B(v(ot),{key:0,class:"trace-detail-loading-icon"})):U("",!0),g("p",ia,[R[2]||(R[2]=g("span",{class:"trace-inspection-title"},"正在检视运行记录：",-1)),g("span",la,re(c.traceId),1)]),p(v(kt),{class:"trace-inspection-exit-btn",onClick:M})])):U("",!0)]),_:1})}}}),ca=de(da,[["__scopeId","data-v-af82ae33"]]),wa=Object.freeze(Object.defineProperty({__proto__:null,default:ca},Symbol.toStringTag,{value:"Module"}));export{_a as E,wa as W,Ve as u};
