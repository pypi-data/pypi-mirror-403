import{v as P,i as w,a8 as h,x as p,y as o,B as k,E as f,I as g,L as r,u as d,F as e,K as s,r as T,G as $,M as C,O as a,a9 as U,c as F,ad as M,aE as j,w as G,P as H}from"./vue-core-C3hq3bxF.js";import{a as q,d as J}from"./api-DyiqpKJK.js";import{W as O}from"./WorkflowStudio-cipvlP3c.js";/* empty css                 *//* empty css               */import{f as S,F as Q}from"./FloatPagination-x9oqNWsY.js";import{d as x,C as X,e as K,b as Y,v as V,G as Z,H as ee,F as te,D as ae,a as le}from"./element-ui-CA4rbiJ9.js";import{_ as D}from"./index-BrGO8rHI.js";/* empty css                         */import{E as se}from"./WorkflowEditor-D8-6OZ8Y.js";import{_ as oe}from"./FormattedCodeViewer.vue_vue_type_script_setup_true_lang-D-r0d4Is.js";import"./ui-components-DQ2lkQGO.js";import"./js-yaml-yTPt38rv.js";import"./elkjs-daFYuoNQ.js";import"./vue-flow-BEraqp1L.js";import"./code-editor-DFIoHxr7.js";import"./highlightjs-D4ATuRwX.js";const R={INTERNAL:0,SERVER:1,CLIENT:2,PRODUCER:3,CONSUMER:4},L={UNSET:0,OK:1,ERROR:2},ne={class:"trace-item-header"},re={class:"trace-time"},ie={class:"trace-id"},ce=P({__name:"TraceListItemCard",props:{trace:{}},setup(y){const n=w(O.TRACE_FOR_INSPECTION),v=y,{trace:t}=h(v),u=()=>{n&&(n.traceId=t.value.trace_id)};return(I,m)=>{const b=x;return o(),p("div",{class:"trace-list-item",onClick:u},[k("div",ne,[k("p",re,r(d(S)(d(t).timestamp,{absolute:!0,format:{second:"2-digit"}})),1),d(t).status_code===d(L).ERROR?(o(),f(b,{key:0,type:"danger"},{default:e(()=>[...m[0]||(m[0]=[s(" 运行出错 ",-1)])]),_:1})):g("",!0)]),k("div",null,[k("span",null,r(d(t).span_count),1),m[1]||(m[1]=s(" 条SPAN记录 ",-1))]),k("p",ie,r(d(t).trace_id),1)])}}}),de=D(ce,[["__scopeId","data-v-265b69b7"]]),ue={class:"trace-list-area"},_e={class:"trace-list"},pe=P({__name:"TraceListPanel",props:{loading:{type:Boolean},reload:{type:Function},traces:{},total:{},pageSize:{}},setup(y){const n=y,v=T(1);return(t,u)=>{const I=X,m=K,b=Y,_=V;return $((o(),p("div",ue,[n.traces.length>0?(o(),p(C,{key:0},[k("div",_e,[(o(!0),p(C,null,U(n.traces,(l,E)=>(o(),p(C,{key:l.trace_id},[a(de,{trace:l},null,8,["trace"]),E<n.traces.length-1?(o(),f(I,{key:0,class:"trace-item-divider"})):g("",!0)],64))),128))]),a(Q,{class:"float-pagination",total:n.total,"page-size":n.pageSize,reload:n.reload},null,8,["total","page-size","reload"])],64)):(o(),f(b,{key:1,class:"empty-state"},{default:e(()=>[a(m,{type:"primary",onClick:u[0]||(u[0]=l=>y.reload(v.value))},{default:e(()=>[...u[1]||(u[1]=[s("重新加载",-1)])]),_:1})]),_:1}))])),[[_,y.loading]])}}}),me=D(pe,[["__scopeId","data-v-40ae747e"]]),fe={class:"trace-detail-panel"},ve={class:"trace-detail-content"},be={class:"span-list-title"},Ee={key:0,class:"span-attributes-wrapper"},ke=P({__name:"TraceDetailPanel",setup(y){const n=w(O.TRACE_FOR_INSPECTION),v=F(()=>n?.traceId),t=F(()=>n?.detail),u=T([]),I=()=>{n&&(n.detail=void 0,n.traceId=void 0)},m=_=>{switch(_){case R.INTERNAL:return"Internal";case R.SERVER:return"Server";case R.CLIENT:return"Client";case R.PRODUCER:return"Producer";case R.CONSUMER:return"Consumer";default:return"Unknown"}},b=_=>{const l=[];_.span_id&&l.push(_.span_id),_.parent_span_id&&l.push(_.parent_span_id),u.value=l};return(_,l)=>{const E=K,c=Z,A=ee,N=x,B=te,W=ae,z=V;return o(),p("div",fe,[a(E,{icon:d(se),onClick:I},{default:e(()=>[...l[1]||(l[1]=[s("返回记录列表",-1)])]),_:1},8,["icon"]),$((o(),p("div",ve,[a(A,{title:v.value,column:1,border:"","label-width":150},M({_:2},[t.value?{name:"default",fn:e(()=>[a(c,{label:"Service Name"},{default:e(()=>[s(r(t.value.service_name),1)]),_:1}),a(c,{label:"Service Version"},{default:e(()=>[s(r(t.value.service_version),1)]),_:1}),a(c,{label:"Workflow Name"},{default:e(()=>[s(r(t.value.workflow_name),1)]),_:1}),a(c,{label:"Workflow Task ID"},{default:e(()=>[s(r(t.value.service_name),1)]),_:1}),a(c,{label:"Device Platform"},{default:e(()=>[s(r(t.value.device_platform),1)]),_:1}),a(c,{label:"User ID"},{default:e(()=>[s(r(t.value.user_id),1)]),_:1}),a(c,{label:"User Nickname"},{default:e(()=>[s(r(t.value.user_nickname),1)]),_:1}),a(c,{label:"Start Time"},{default:e(()=>[s(r(t.value.start_time?d(S)(t.value.start_time,{absolute:!0,format:{second:"2-digit"}}):""),1)]),_:1}),a(c,{label:"End Time"},{default:e(()=>[s(r(t.value.end_time?d(S)(t.value.end_time,{absolute:!0,format:{second:"2-digit"}}):""),1)]),_:1}),a(c,{label:"Has Error"},{default:e(()=>[s(r(t.value.has_error),1)]),_:1})]),key:"0"}:void 0]),1032,["title"]),t.value?(o(),p(C,{key:0},[k("h4",be,[k("span",null,r(t.value.span_count),1),l[2]||(l[2]=s(" 条Span记录 ",-1))]),a(W,{modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=i=>u.value=i)},{default:e(()=>[(o(!0),p(C,null,U(t.value.spans,i=>(o(),f(B,{key:i.span_id,name:i.span_id,title:i.span_id},{default:e(()=>[a(A,{column:1,"label-width":150},{default:e(()=>[a(c,{label:"Name","label-class-name":"span-attr-label"},{default:e(()=>[s(r(i.name),1)]),_:2},1024),a(c,{label:"Parent Span ID","label-class-name":"span-attr-label"},{default:e(()=>[i.parent_span_id?(o(),f(E,{key:0,type:"primary",link:"",onClick:Re=>b(i)},{default:e(()=>[s(r(i.parent_span_id),1)]),_:2},1032,["onClick"])):g("",!0)]),_:2},1024),a(c,{label:"Kind","label-class-name":"span-attr-label"},{default:e(()=>[i.kind!==void 0?(o(),f(N,{key:0,type:"primary"},{default:e(()=>[s(r(m(i.kind)),1)]),_:2},1024)):g("",!0)]),_:2},1024),a(c,{label:"Time","label-class-name":"span-attr-label"},{default:e(()=>[s(r(i.timestamp?d(S)(i.timestamp,{absolute:!0,format:{second:"2-digit"}}):""),1)]),_:2},1024),a(c,{label:"Duration Nano","label-class-name":"span-attr-label"},{default:e(()=>[s(r(i.duration_nano),1)]),_:2},1024),a(c,{label:"Kind","label-class-name":"span-attr-label"},{default:e(()=>[i.status_code===d(L).OK?(o(),f(N,{key:0,type:"success"},{default:e(()=>[...l[3]||(l[3]=[s("OK",-1)])]),_:1})):i.status_code===d(L).ERROR?(o(),f(N,{key:1,type:"danger"},{default:e(()=>[...l[4]||(l[4]=[s(" ERROR ",-1)])]),_:1})):(o(),f(N,{key:2,type:"info"},{default:e(()=>[...l[5]||(l[5]=[s("UNSET",-1)])]),_:1}))]),_:2},1024),a(c,{label:"Node Name","label-class-name":"span-attr-label"},{default:e(()=>[s(r(i.node_name),1)]),_:2},1024),a(c,{label:"Attributes","label-class-name":"span-attr-label"},{default:e(()=>[i.attributes?(o(),p("span",Ee,[a(oe,{content:i.attributes,lang:"json"},null,8,["content"])])):g("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["name","title"]))),128))]),_:1},8,["modelValue"])],64)):g("",!0)])),[[z,d(n)?.detail===void 0]])])}}}),ye=D(ke,[["__scopeId","data-v-7fb34464"]]),Ie={class:"trace-panel-wrapper"},ge=P({__name:"TracePanelWrapper",setup(y){const n=T(!1),v=T(),t=T(100),u=j(),I=F(()=>u.params.id),m=w(O.WORKFLOW_DATA),b=w(O.TRACE_FOR_INSPECTION),_=async l=>{if(I.value){n.value=!0;try{v.value=await q.post("/list",{workflow_name:m?.value?.name,offset:l?(l-1)*t.value:0,limit:t.value},{base:J()})}catch(E){le.error(E?.message||"加载记录失败"),console.error("Failed to load traces:",E)}finally{n.value=!1}}};return G(I,l=>{l&&_()},{immediate:!0}),(l,E)=>(o(),p("div",Ie,[$(a(me,{loading:n.value,traces:v.value?.traces||[],total:v.value?.total||0,reload:_,pageSize:t.value},null,8,["loading","traces","total","pageSize"]),[[H,!d(b)?.traceId]]),d(b)?.traceId?(o(),f(ye,{key:0})):g("",!0)]))}}),We=D(ge,[["__scopeId","data-v-139fdbd6"]]);export{We as default};
