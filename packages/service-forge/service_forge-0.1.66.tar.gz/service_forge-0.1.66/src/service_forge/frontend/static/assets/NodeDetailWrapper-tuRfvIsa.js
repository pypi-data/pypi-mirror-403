import"./api-DyiqpKJK.js";/* empty css                 */import{f as we,u as Ie,g as ae,G as E,W as w,h as Oe}from"./WorkflowStudio-cipvlP3c.js";/* empty css                         *//* empty css               */import{u as se}from"./vue-flow-BEraqp1L.js";import{u as ue}from"./ui-components-DQ2lkQGO.js";import{v as P,x as V,y as a,E as p,B as d,K as M,u as v,L as W,O as i,i as I,c as y,r as z,W as re,w as ie,I as h,F as u,M as B,a9 as U,n as ke,G as oe,P as le}from"./vue-core-C3hq3bxF.js";import{_ as J}from"./index-BrGO8rHI.js";import{u as de}from"./WorkflowEditor-D8-6OZ8Y.js";import{_ as Y}from"./FormattedCodeViewer.vue_vue_type_script_setup_true_lang-D-r0d4Is.js";import{j as pe,d as be,k as ce,D as Ee,F as Ve,e as me,i as fe,b as Te}from"./element-ui-CA4rbiJ9.js";import"./js-yaml-yTPt38rv.js";import"./elkjs-daFYuoNQ.js";import"./code-editor-DFIoHxr7.js";import"./highlightjs-D4ATuRwX.js";const De=ue({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{"fill-rule":"evenodd",d:"M7.28 7.72a.75.75 0 0 1 0 1.06l-2.47 2.47H21a.75.75 0 0 1 0 1.5H4.81l2.47 2.47a.75.75 0 1 1-1.06 1.06l-3.75-3.75a.75.75 0 0 1 0-1.06l3.75-3.75a.75.75 0 0 1 1.06 0Z",clipRule:"evenodd"},child:[]}]}),He=ue({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{"fill-rule":"evenodd",d:"M16.72 7.72a.75.75 0 0 1 1.06 0l3.75 3.75a.75.75 0 0 1 0 1.06l-3.75 3.75a.75.75 0 1 1-1.06-1.06l2.47-2.47H3a.75.75 0 0 1 0-1.5h16.19l-2.47-2.47a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"},child:[]}]}),Se={class:"flow-target-item"},Fe={class:"target-node-name"},Ce={class:"target-handle-name"},Re=P({__name:"FlowTargetItem",props:{nodeName:{},handleName:{},direction:{}},setup(H){const _=H;return(r,N)=>(a(),V("div",Se,[_.direction==="from"?(a(),p(v(De),{key:0,class:"flow-icon"})):(a(),p(v(He),{key:1,class:"flow-icon"})),d("span",Fe,W(_.nodeName||"?"),1),N[0]||(N[0]=M(" · ",-1)),d("span",Ce,W(_.handleName||"?"),1)]))}}),ee=J(Re,[["__scopeId","data-v-6fafc360"]]),$e={class:"operation-hint"},je=P({__name:"OperationHint",props:{content:{}},setup(H){const _=H;return(r,N)=>(a(),V("p",$e,[i(v(we),{class:"operation-hint-icon"}),M(" "+W(_.content),1)]))}}),te=J(je,[["__scopeId","data-v-f445d7ea"]]),Me={key:0,class:"node-detail-form-wrapper"},Ae={class:"target-list-wrapper"},xe={class:"record-parts"},Be={class:"code-viewer-wrapper"},Ue={class:"code-viewer-wrapper"},We={class:"record-parts"},Pe={class:"code-viewer-wrapper"},Le=P({__name:"ModuleNodeDetail",setup(H){const _=I(w.IS_EDIT_MODE),r=I(w.NODE_FOR_INSPECTION),N=I(w.NODE_DATA_MAP),S=I(w.WORKFLOW_DATA),F=I(w.TRACE_FOR_INSPECTION),A=I(w.TEST_RUNNING_RECORD),C=Ie().nodeSchemaMap,l=y(()=>N?.value?.get(r?.value?.id||"")),L=y(()=>{if(l.value?.outputs)return Object.keys(l.value.outputs)[0]}),x=y(()=>{if(l.value?.type)return C.get(l.value?.type)}),R=y(()=>{if(!F?.detail)return;const t={};return F.detail.spans.forEach(e=>{if(e.node_name===l.value?.name)try{const o=e.attributes?.["node.inputs"];o&&(t.input=JSON.parse(String(o)));const s=e.attributes?.["node.output"];s&&(t.output=JSON.parse(String(s)))}catch{}}),t}),g=y(()=>{if(!(!l.value||!A?.nodeOutput)&&l.value.name in A.nodeOutput){const t=A.nodeOutput[l.value.name];return typeof t=="object"?{output:t}:L.value?{output:{[L.value]:t}}:void 0}}),K=z(["inputs","outputs"]),Z=se(),{renameNode:Q,deleteHandle:G}=de(Z),n=re({type:"",name:"",args:{},inputs:{},outputs:{}}),m=z(),O=z(!1);ie(l,t=>{t&&(n.type=t.type,n.name=t.name,n.args=t.args||{},n.inputs=t.inputs||{},n.outputs=t.outputs||{}),O.value||ke(()=>{O.value=!0,m.value?.validate(()=>{}).finally()}).finally()},{immediate:!0,deep:!0});const k=y(()=>{const t=C?.get(l.value?.type||"");return new Set(Object.keys(n.inputs??{}).filter(e=>!t?.inputs?.[e]))}),$=y(()=>{const t=C?.get(l.value?.type||"");return new Set(Object.keys(n.outputs??{}).filter(e=>!t?.outputs?.[e]))}),X=(t,e)=>{n.inputs?.[t]?n.inputs[t].value=e:n.inputs={...n.inputs||{},[t]:{type:"in",handleName:t,nodeId:E.configNameToNodeId(n.name),value:"",hasSource:!1}}},c=(t,e,o)=>{if(!e){o("节点名称不能为空");return}if(e!==l.value?.name&&N?.value?.has(E.configNameToNodeId(e))){o("节点名称已存在");return}o()},T=(t,e,o)=>{const s=t.field?.split(".")?.[1];if(s){if(k.value.has(s)){o("输入端口不合法");return}o()}},ve=(t,e,o)=>{const s=t.field?.split(".")?.[1];if(s&&$.value.has(s)){o("输出端口不合法");return}for(const b of e.to||[]){const D=N?.value?.get(b.nodeId);if(!D){o("流向了不存在的节点");return}if(b.handleName&&!D.inputs?.[b.handleName]){o("流向了不存在的端口");return}}o()},_e=y(()=>{const t=Object.keys(l.value?.inputs||{}),e=Object.keys(l.value?.outputs||{}),o={type:[{required:!0,message:"节点类型不能为空",trigger:"blur"},{message:"节点类型不合法",validator:()=>!!x.value,trigger:"change"}],name:[{required:!0,trigger:"blur",validator:c}]};return t.forEach(s=>{o[`inputs.${s}`]=[{validator:T,trigger:"change"}]}),e.forEach(s=>{o[`outputs.${s}`]=[{validator:ve,trigger:"change"}]}),o}),ne=async t=>{if(!l.value||!await m.value?.validateField(t))return;const o=S?.value?.nodes?.find(s=>s.name===E.nodeIdToName(r?.value?.id||""));if(o)if(t.startsWith("inputs.")){const[s,b]=t.split(".");if(b){const D=n.inputs?.[b]?.value;D&&(o.args={...o.args,[b]:D})}}else t==="name"&&(Q(o.name,n.name),r&&(r.value.id=E.configNameToNodeId(n.name)))},ge=()=>{for(const t of k.value){const e=l.value?.inputs?.[t];console.log("inputHandle",t,e),e&&G(e)}},Ne=()=>{for(const t of $.value){const e=l.value?.outputs?.[t];e&&G(e)}};return(t,e)=>{const o=be,s=pe,b=ce,D=me,q=Ve,ye=Ee,he=fe;return l.value?(a(),V("div",Me,[i(he,{ref_key:"formRef",ref:m,disabled:!v(_),model:n,rules:_e.value,"label-position":"right","label-width":"auto"},{default:u(()=>[i(s,{label:"类型",prop:"type"},{default:u(()=>[i(o,{type:x.value?"primary":"danger"},{default:u(()=>[M(W(n.type),1)]),_:1},8,["type"])]),_:1}),i(s,{label:"名称",prop:"name"},{default:u(()=>[i(b,{modelValue:n.name,"onUpdate:modelValue":e[0]||(e[0]=f=>n.name=f),onBlur:e[1]||(e[1]=()=>ne("name"))},null,8,["modelValue"])]),_:1}),i(ye,{modelValue:K.value,"onUpdate:modelValue":e[2]||(e[2]=f=>K.value=f)},{default:u(()=>[i(te,{class:"operation-hint",content:"请在画布中进行端口连线，控制输入输出端口的流向。"}),Object.keys(n?.inputs||{}).length>0?(a(),p(q,{key:0,title:"输入端口·默认值",name:"inputs"},{default:u(()=>[k.value.size>0?(a(),p(D,{key:0,class:"clear-invalid-btn",type:"danger",plain:"",onClick:ge,icon:v(ae)},{default:u(()=>[...e[3]||(e[3]=[M(" 一键清理不合法端口 ",-1)])]),_:1},8,["icon"])):h("",!0),(a(!0),V(B,null,U(Object.keys(n?.inputs||{}),f=>(a(),p(s,{key:f,label:f,prop:`inputs.${f}`},{default:u(()=>[i(b,{placeholder:"请输入："+(x.value?.inputs?.[f]?.type??"未知类型"),"model-value":n.inputs?.[f]?.value,"onUpdate:modelValue":j=>X(f,j),onBlur:()=>ne(`inputs.${f}`)},null,8,["placeholder","model-value","onUpdate:modelValue","onBlur"])]),_:2},1032,["label","prop"]))),128))]),_:1})):h("",!0),Object.keys(n?.outputs||{}).length>0?(a(),p(q,{key:1,title:"输出端口·流向",name:"outputs"},{default:u(()=>[$.value.size>0?(a(),p(D,{key:0,class:"clear-invalid-btn",type:"danger",plain:"",onClick:Ne,icon:v(ae)},{default:u(()=>[...e[4]||(e[4]=[M(" 一键清理不合法端口 ",-1)])]),_:1},8,["icon"])):h("",!0),(a(!0),V(B,null,U(Object.keys(n?.outputs||{}),f=>(a(),p(s,{key:f,label:f,prop:`outputs.${f}`},{default:u(()=>[d("div",Ae,[(a(!0),V(B,null,U(n.outputs?.[f]?.to||[],j=>(a(),p(ee,{key:`${j.nodeId}|${j.handleName}`,"node-name":v(E).nodeIdToName(j.nodeId),"handle-name":j.handleName,direction:"to"},null,8,["node-name","handle-name"]))),128))])]),_:2},1032,["label","prop"]))),128))]),_:1})):h("",!0),R.value?(a(),p(q,{key:2,class:"record-group"},{title:u(()=>[...e[5]||(e[5]=[d("h4",{class:"strong-collapse-title"},"历史记录信息",-1)])]),default:u(()=>[d("div",xe,[d("div",null,[e[6]||(e[6]=d("h5",{class:"record-part-title"},"节点输入",-1)),d("div",Be,[i(Y,{class:"code-viewer",lang:"json",content:R.value?.input||null},null,8,["content"])])]),d("div",null,[e[7]||(e[7]=d("h5",{class:"record-part-title"},"节点输出",-1)),d("div",Ue,[i(Y,{class:"code-viewer",lang:"json",content:R.value?.output||null},null,8,["content"])])])])]),_:1})):h("",!0),g.value?(a(),p(q,{key:3,class:"record-group"},{title:u(()=>[...e[8]||(e[8]=[d("h4",{class:"strong-collapse-title"},"测试运行信息",-1)])]),default:u(()=>[d("div",We,[d("div",null,[e[9]||(e[9]=d("h5",{class:"record-part-title"},"节点输出",-1)),d("div",Pe,[i(Y,{class:"code-viewer",lang:"json",content:g.value?.output||null},null,8,["content"])])])])]),_:1})):h("",!0)]),_:1},8,["modelValue"])]),_:1},8,["disabled","model","rules"])])):h("",!0)}}}),Ke=J(Le,[["__scopeId","data-v-70b71c39"]]),Ge={class:"node-detail-wrapper"},qe={class:"node-detail-title"},ze={class:"flow-target-list"},Je=P({__name:"PortNodeDetail",props:{portType:{}},setup(H){const _=H,r=y(()=>_.portType),N=I(w.IS_EDIT_MODE),S=I(w.WORKFLOW_DATA),F=I(w.NODE_DATA_MAP),A=I(w.NODE_FOR_INSPECTION),C=y(()=>F?.value?.get(A?.value?.id||"")),l=y(()=>r.value==="input"?Object.values(C.value?.outputs||{}):Object.values(C.value?.inputs||{})),L=se(),{deleteHandle:x}=de(L),R=z(),g=re({newHandleName:"",inputValue:{}});ie(l,n=>{g.inputValue=Object.fromEntries(n.map(m=>[m.handleName,m.value||""]))},{immediate:!0});const K=(n,m,O)=>{if(m){if(l.value.some(k=>k.handleName===m)){O(new Error("与已存在的端口重名"));return}O()}},Z=y(()=>({newHandleName:[{validator:K,trigger:"blur"}]})),Q=async()=>{if(g.newHandleName){try{if(!await R.value?.validateField("newHandleName"))return}catch{return}r.value==="output"?S?.value.outputs?.push({name:g.newHandleName}):S?.value.inputs?.push({name:g.newHandleName})}},G=(n,m)=>{if(r.value!=="input")return;const O=S?.value.inputs?.find(k=>k.name===n);O&&(O.value=m)};return(n,m)=>{const O=me,k=ce,$=pe,X=fe;return a(),V("div",Ge,[d("h3",qe,W(r.value==="input"?"工作流入口":"工作流出口"),1),i(te,{class:"operation-hint",content:"请在画布中进行端口连线，控制流向。"}),v(N)?h("",!0):(a(),p(te,{key:0,class:"operation-hint",content:"进入编辑模式可增加或删除端口"})),i(X,{ref_key:"formRef",ref:R,disabled:!v(N),model:g,rules:Z.value,"label-position":"right","label-width":"auto"},{default:u(()=>[oe(i($,{prop:"newHandleName"},{default:u(()=>[i(k,{placeholder:"添加新端口名称",modelValue:g.newHandleName,"onUpdate:modelValue":m[0]||(m[0]=c=>g.newHandleName=c)},{append:u(()=>[i(O,{onClick:Q,disabled:!g.newHandleName},{default:u(()=>[...m[1]||(m[1]=[M("添加",-1)])]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1},512),[[le,v(N)]]),(a(!0),V(B,null,U(l.value,c=>(a(),V("div",{class:"handle-wrapper",key:c.handleName},[oe(i(v(Oe),{class:"delete-icon",onClick:T=>v(x)(c)},null,8,["onClick"]),[[le,v(N)]]),i($,{label:c.handleName,class:"handle-content-wrapper",prop:`inputValue.${c.handleName}`},{default:u(()=>[d("div",ze,[r.value==="output"&&c.from?(a(),p(ee,{key:0,class:"flow-target-item","node-name":v(E).nodeIdToName(c.from.nodeId),"handle-name":c.from.handleName,direction:"from"},null,8,["node-name","handle-name"])):h("",!0),r.value==="input"?(a(),p(k,{key:1,"model-value":g.inputValue[c.handleName],"onUpdate:modelValue":T=>g.inputValue[c.handleName]=T,onBlur:T=>G(c.handleName,g.inputValue[c.handleName]||"")},null,8,["model-value","onUpdate:modelValue","onBlur"])):h("",!0),r.value==="input"&&c.to?(a(!0),V(B,{key:2},U(c.to||[],T=>(a(),p(ee,{class:"flow-target-item","node-name":v(E).nodeIdToName(T.nodeId),"handle-name":T.handleName,direction:"to"},null,8,["node-name","handle-name"]))),256)):h("",!0)])]),_:2},1032,["label","prop"])]))),128))]),_:1},8,["disabled","model","rules"])])}}}),Ze=J(Je,[["__scopeId","data-v-c22cfc28"]]),mt=P({__name:"NodeDetailWrapper",setup(H){const _=I(w.NODE_FOR_INSPECTION),r=y(()=>_?.value?.id?E.isModuleNode(_.value.id)?"module":E.isInputNode(_.value.id)?"input":E.isOutputNode(_.value.id)?"output":"fallback":"fallback");return(N,S)=>{const F=Te;return r.value==="module"?(a(),p(Ke,{key:0})):r.value==="input"||r.value==="output"?(a(),p(Ze,{key:1,"port-type":r.value},null,8,["port-type"])):(a(),p(F,{key:2,description:"暂无节点数据"}))}}});export{mt as default};
