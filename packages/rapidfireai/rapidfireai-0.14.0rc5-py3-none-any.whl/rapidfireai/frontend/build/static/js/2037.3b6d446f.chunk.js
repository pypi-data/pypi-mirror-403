"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[2037],{25669:function(e,t,a){a.d(t,{W:function(){return m}});var i=a(32256),n=a(37733),s=a(34139),r=a(98374),o=a(53660),l=a(88952),d=a(51391);const m=({hideBorder:e=!0})=>{const[,t]=(0,l.sR)(),[a,m]=(0,o.an)(),{classNamePrefix:c}=(0,n.u)(),g=a||(0,o.mb)(),u=["TABLE","CHART"].includes(g)?"RUNS":g,T=1===t.length?t[0]:void 0;return(0,d.FD)(i.LegacyTabs,{dangerouslyAppendEmotionCSS:{[`.${c}-tabs-nav`]:{marginBottom:0,"::before":{display:e?"none":"block"}}},activeKey:u,onChange:e=>{const t=e;if(u!==t)return"RUNS"===t?m("TABLE"):void m(t,T)},children:[(0,d.Y)(i.LegacyTabs.TabPane,{tab:(0,d.Y)("span",{"data-testid":"experiment-runs-mode-switch-combined",children:(0,d.Y)(s.A,{id:"qpFaad",defaultMessage:"Runs"})})},"RUNS"),T&&(0,d.Y)(i.LegacyTabs.TabPane,{tab:(0,d.FD)("span",{"data-testid":"experiment-runs-mode-switch-models",children:[(0,d.Y)(s.A,{id:"b8rdDM",defaultMessage:"Models"}),(0,d.Y)(r.W,{})]})},"MODELS"),(0,d.Y)(i.LegacyTabs.TabPane,{tab:(0,d.Y)("span",{"data-testid":"experiment-runs-mode-switch-logs",children:(0,d.Y)(s.A,{id:"qVy1Y6",defaultMessage:"Logs"})})},"LOGS"),(0,d.Y)(i.LegacyTabs.TabPane,{tab:(0,d.Y)("span",{"data-testid":"experiment-runs-mode-switch-ic-logs",children:(0,d.Y)(s.A,{id:"I7mZY3",defaultMessage:"Interactive Control Logs"})})},"IC_LOGS")]})}},72037:function(e,t,a){a.d(t,{$:function(){return te}});var i=a(64819),n=a(37733),s=a(86279),r=a(25669),o=a(16936),l=a(76998),d=a(32256),m=a(29332),c=a(49818);function g(e){return[{key:"LAST_HOUR",label:e.formatMessage({id:"bjoGjg",defaultMessage:"Last hour"})},{key:"LAST_24_HOURS",label:e.formatMessage({id:"JChRnq",defaultMessage:"Last 24 hours"})},{key:"LAST_7_DAYS",label:e.formatMessage({id:"eQsXm7",defaultMessage:"Last 7 days"})},{key:"LAST_30_DAYS",label:e.formatMessage({id:"p1H1KR",defaultMessage:"Last 30 days"})},{key:"LAST_YEAR",label:e.formatMessage({id:"EI7moF",defaultMessage:"Last year"})},{key:"ALL",label:e.formatMessage({id:"HeNa8H",defaultMessage:"All"})},{key:"CUSTOM",label:e.formatMessage({id:"TpmJlu",defaultMessage:"Custom"})}]}var u=a(98512),T=a(45901),p=a(51391);const f=()=>({dateNow:new Date,setDateNow:e=>{}}),v=(0,l.createContext)(f()),b=({config:e,children:t})=>{const a=f(),i=(0,T.merge)({},a,e),[n,s]=l.useState(i.dateNow);return(0,p.Y)(v.Provider,{value:{...i,dateNow:n,setDateNow:s},children:t})},h=()=>{const e=(0,l.useContext)(v);return e||f()},S="startTimeLabel",y="startTime",Y="endTime",I="LAST_7_DAYS",L=()=>{var e;const t=h(),[a,i]=(0,u.ok)(),n=a.get(S)||I;let s=a.get(y)||void 0,r=null!==(e=a.get(Y))&&void 0!==e?e:void 0;if("CUSTOM"!==n){const e=w(t.dateNow,{startTimeLabel:n});s=e.startTime,r=e.endTime}else{var o;s=a.get(y)||void 0,r=null!==(o=a.get(Y))&&void 0!==o?o:void 0}const d=(0,l.useMemo)(()=>({startTimeLabel:n,startTime:s,endTime:r}),[n,s,r]),m=(0,l.useCallback)((e,t=!1)=>{i(t=>(void 0===(null===e||void 0===e?void 0:e.startTime)?t.delete(y):"CUSTOM"===e.startTimeLabel&&t.set(y,e.startTime),void 0===(null===e||void 0===e?void 0:e.endTime)?t.delete(Y):"CUSTOM"===e.startTimeLabel&&t.set(Y,e.endTime),void 0===(null===e||void 0===e?void 0:e.startTimeLabel)?t.delete(S):t.set(S,e.startTimeLabel),t),{replace:t})},[i]);return[d,m]};function w(e,t){return t.startTimeLabel&&"CUSTOM"!==t.startTimeLabel?function(e,t){switch(t){case"LAST_HOUR":return{startTime:new Date(new Date(e).setUTCHours((new Date).getUTCHours()-1)).toISOString(),endTime:e.toISOString()};case"LAST_24_HOURS":return{startTime:new Date(new Date(e).setUTCDate((new Date).getUTCDate()-1)).toISOString(),endTime:e.toISOString()};case"LAST_7_DAYS":return{startTime:new Date(new Date(e).setUTCDate((new Date).getUTCDate()-7)).toISOString(),endTime:e.toISOString()};case"LAST_30_DAYS":return{startTime:new Date(new Date(e).setUTCDate((new Date).getUTCDate()-30)).toISOString(),endTime:e.toISOString()};case"LAST_YEAR":return{startTime:new Date(new Date(e).setUTCFullYear((new Date).getUTCFullYear()-1)).toISOString(),endTime:e.toISOString()};case"ALL":return{startTime:void 0,endTime:e.toISOString()};default:throw new Error(`Unexpected start time label: ${t}`)}}(e,t.startTimeLabel):{startTime:t.startTime,endTime:t.endTime}}var x=a(27331);const C=l.memo(()=>{const e=(0,c.tz)(),{theme:t}=(0,n.u)(),[a,s]=L(),r=(0,l.useMemo)(()=>g(e),[e]),o=e.formatMessage({id:"BJvcsS",defaultMessage:"Time Range"}),u=h();return(0,p.FD)("div",{css:(0,i.AH)({display:"flex",gap:t.spacing.sm,alignItems:"center"},""),children:[(0,p.FD)(d.DialogCombobox,{componentId:"mlflow.experiment-evaluation-monitoring.date-selector",label:o,value:a.startTimeLabel?[a.startTimeLabel]:[I],children:[(0,p.Y)(d.DialogComboboxTrigger,{renderDisplayedValue:e=>{var t;return null===(t=r.find(t=>t.key===e))||void 0===t?void 0:t.label},allowClear:!(0,T.isNil)(a.startTimeLabel)&&a.startTimeLabel!==I,onClear:()=>{s({startTimeLabel:I})},"data-testid":"time-range-select-dropdown"}),(0,p.Y)(d.DialogComboboxContent,{children:(0,p.Y)(d.DialogComboboxOptionList,{children:r.map(e=>(0,p.Y)(d.DialogComboboxOptionListSelectItem,{checked:a.startTimeLabel===e.key||e.key===I&&(0,T.isNil)(a.startTimeLabel),title:e.label,"data-testid":`time-range-select-${e}`,value:e.key,onChange:()=>{s({...a,startTimeLabel:e.key})},children:e.label},e.key))})})]}),"CUSTOM"===a.startTimeLabel&&(0,p.Y)(p.FK,{children:(0,p.Y)(x.cv,{id:"date-picker-range",includeTime:!0,selected:{from:new Date(a.startTime),to:a.endTime?new Date(a.endTime):u.dateNow},onChange:e=>{const t=e.target.value;s({...a,startTime:null!==t&&void 0!==t&&t.from?t.from.toISOString():void 0,endTime:null!==t&&void 0!==t&&t.to?t.to.toISOString():void 0})},startDatePickerProps:{componentId:"experiment-evaluation-monitoring-start-date-picker",datePickerProps:{disabled:{after:u.dateNow}},value:a.startTime?new Date(a.startTime):void 0},endDatePickerProps:{componentId:"experiment-evaluation-monitoring-end-date-picker",datePickerProps:{disabled:{after:u.dateNow}},value:a.endTime?new Date(a.endTime):void 0}})}),(0,p.Y)(m.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:e.formatMessage({id:"Arvaod",defaultMessage:"Showing data up to {date}."},{date:u.dateNow.toLocaleString(navigator.language,{timeZoneName:"short"})}),children:(0,p.Y)(n.B,{type:"link",componentId:"mlflow.experiment-evaluation-monitoring.refresh-date-button",onClick:()=>u.setDateNow(new Date),children:(0,p.Y)(d.RefreshIcon,{})})})]})});var D=a(69129),M=a(35368),A=a(1073),k=a(23035),E=a(64874),N=a(26737),O=a(68826),R=a(35891),_=a(76714),F=a(75024);const U=e=>{const{experimentIds:t}=e,a=(0,c.tz)(),{data:i,isLoading:s,error:r}=(0,D.Zn)({experimentId:t[0],pageSize:1,limit:1}),{data:o,loading:m}=(0,O.L)({experimentId:t[0]}),u=o,T=(0,R.BH)(null===u||void 0===u?void 0:u.tags),f=(T===_.Gk.GENAI_DEVELOPMENT||_.Gk.GENAI_DEVELOPMENT_INFERRED,i&&i.length>0),[v,b]=L(),h=(0,l.useMemo)(()=>g(a),[a]),S=(0,p.Y)(n.B,{componentId:"traces-v3-empty-state-button",onClick:()=>b({startTimeLabel:"ALL"}),children:(0,p.Y)(c.sA,{id:"WpD2MA",defaultMessage:"View All"})});if(s||m)return(0,p.Y)(p.FK,{children:[...Array(10).keys()].map(e=>(0,p.Y)(d.ParagraphSkeleton,{label:"Loading...",seed:`s-${e}`},e))});if(r)return(0,p.Y)(d.Empty,{image:(0,p.Y)(n.k,{}),title:(0,p.Y)(c.sA,{id:"ZotI2j",defaultMessage:"Fetching traces failed"}),description:String(r)});if(f){var y;const e=(0,p.Y)(N.S,{}),t=(0,p.Y)(c.sA,{id:"XuzIWs",defaultMessage:'Some traces are hidden by your time range filter: "{filterLabel}"',values:{filterLabel:(0,p.Y)("strong",{children:(null===(y=h.find(e=>e.key===v.startTimeLabel))||void 0===y?void 0:y.label)||""})}});return(0,p.Y)(d.Empty,{title:(0,p.Y)(c.sA,{id:"Dhr3pC",defaultMessage:"No traces found"}),description:t,button:S,image:e})}return(0,p.Y)(F.i,{baseComponentId:"mlflow.traces"})};var P=a(1646);var H={name:"1dd35ky",styles:"display:flex;flex:1;overflow:hidden"},$={name:"1dd35ky",styles:"display:flex;flex:1;overflow:hidden"},B={name:"db3fum",styles:"display:flex;flex-direction:column;width:100%;gap:8px;padding:16px"},G={name:"1w1qal4",styles:"display:flex;align-items:center;justify-content:center;width:100%;height:100%"},q={name:"1nxh63r",styles:"overflow-y:hidden;height:100%;display:flex;flex-direction:column"};const V=l.memo(({experimentId:e,endpointName:t,timeRange:a,loggedModelId:i})=>{const s=(0,A.N9)(),r=(0,c.tz)(),m=(0,o.rE)(),{assessmentInfos:g,allColumns:T,totalCount:f,isLoading:v,error:b,isEmpty:h,tableFilterOptions:y}=(0,D.KW)({experimentId:e,timeRange:a,filterByLoggedModelId:i}),[Y,I]=(0,l.useState)(""),[w,x]=(0,D.R7)(),C=(0,P.jE)(),N=(0,l.useCallback)(e=>e.filter(e=>e.type===D.$6.ASSESSMENT||e.type===D.$6.INPUT||e.type===D.$6.TRACE_INFO&&[D.tj,D.Rl,D.Te,D.$W,D.YO].includes(e.id)||e.type===D.$6.INTERNAL_MONITOR_REQUEST_TIME),[]),{selectedColumns:O,toggleColumns:R,setSelectedColumns:_}=(0,D.K0)(e,T,N),[F,V]=(0,D.GY)(O,{key:D.Te,type:D.$6.TRACE_INFO,asc:!1}),{isInitialTimeFilterLoading:W}=(({experimentId:e,isTracesEmpty:t,isTraceMetadataLoading:a})=>{const[i]=(0,u.ok)(),[n,s]=L(),r=t&&!a&&!i.has(S),{data:o,isLoading:l}=(0,D.Zn)({experimentId:e,tableSort:{key:D.Te,type:D.$6.TRACE_INFO,asc:!1},disabled:!r,limit:500,pageSize:500});r&&o&&o.length>0&&!l&&s({startTimeLabel:"CUSTOM",startTime:o[o.length-1].request_time,endTime:(new Date).toISOString()});return{isInitialTimeFilterLoading:r&&l}})({experimentId:e,isTracesEmpty:h,isTraceMetadataLoading:v}),{data:j,isLoading:z,error:K}=(0,D.Zn)({experimentId:e,currentRunDisplayName:t,searchQuery:Y,filters:w,timeRange:a,filterByLoggedModelId:i,tableSort:F}),Z=(0,l.useCallback)(async(e,t)=>{var a;const[i,n]=await Promise.all([t?M.x.getExperimentTraceInfoV3(t):void 0,t?M.x.getExperimentTraceData(t):void 0]);return n?{info:(null===i||void 0===i||null===(a=i.trace)||void 0===a?void 0:a.trace_info)||{},data:n}:void 0},[]),Q=(0,k.C)(),{showEditTagsModalForTrace:J,EditTagsModal:X}=(0,E.$)({onSuccess:()=>(0,D.BL)({queryClient:C}),existingTagKeys:(0,D.d9)(j||[]),useV3Apis:!0}),ee=(0,l.useMemo)(()=>({deleteTracesAction:{deleteTraces:(e,t)=>Q.mutateAsync({experimentId:e,traceRequestIds:t})},exportToEvals:{exportToEvalsInstanceEnabled:!0,getTrace:Z},editTags:{showEditTagsModalForTrace:J,EditTagsModal:X}}),[Z,Q,J,X]),te=(0,l.useMemo)(()=>({currentCount:null===j||void 0===j?void 0:j.length,logCountLoading:z,totalCount:f,maxAllowedCount:(0,D.pR)()}),[j,f,z]),ae=z||W||v,ie=K||b,ne=h&&!ae&&!ie;return!m&&ne?(0,p.Y)(U,{experimentIds:[e]}):(0,p.Y)(D.sG,{children:(0,p.FD)("div",{css:q,children:[(0,p.Y)(D.w_,{experimentId:e,searchQuery:Y,setSearchQuery:I,filters:w,setFilters:x,assessmentInfos:g,traceInfos:j,tableFilterOptions:y,countInfo:te,traceActions:ee,tableSort:F,setTableSort:V,allColumns:T,selectedColumns:O,toggleColumns:R,setSelectedColumns:_,isMetadataLoading:v,metadataError:b}),!m&&ne?(0,p.Y)(U,{experimentIds:[e]}):(0,p.Y)("div",{css:H,children:(0,p.Y)("div",{css:$,children:ae?(0,p.Y)("div",{css:B,children:[...Array(10).keys()].map(e=>(0,p.Y)(d.ParagraphSkeleton,{label:"Loading...",seed:`s-${e}`},e))}):ie?(0,p.Y)("div",{css:G,children:(0,p.Y)(d.Empty,{image:(0,p.Y)(n.k,{}),title:r.formatMessage({id:"Bcr4hl",defaultMessage:"Fetching traces failed"}),description:ie.message})}):(0,p.Y)(D.tU,{makeHtml:s,children:(0,p.Y)(D._p,{experimentId:e,allColumns:T,currentTraceInfoV3:j||[],currentRunDisplayName:t,getTrace:Z,assessmentInfos:g,setFilters:x,filters:w,selectedColumns:O,tableSort:F})})})})]})})});var W=a(34515);var j={name:"1vfb318",styles:"flex:1;display:flex;align-items:center;justify-content:center"};const z=({error:e})=>{var t;return(0,p.Y)(d.PageWrapper,{css:j,children:(0,p.Y)(d.Empty,{"data-testid":"fallback",title:(0,p.Y)(c.sA,{id:"FbAMd+",defaultMessage:"Error"}),description:null!==(t=null===e||void 0===e?void 0:e.message)&&void 0!==t?t:(0,p.Y)(c.sA,{id:"CbzDeZ",defaultMessage:"An error occurred while rendering this component."}),image:(0,p.Y)(n.k,{})})})},K=({children:e})=>(0,p.Y)(W.tH,{fallback:(0,p.Y)(z,{}),children:e}),Z="viewState",Q=()=>{const{theme:e}=(0,n.u)();return(0,p.Y)("div",{css:(0,i.AH)({display:"flex",alignItems:"center",width:"100%",borderBottom:`1px solid ${e.colors.grey100}`,paddingBottom:`${e.spacing.sm}px`},""),children:(0,p.Y)(C,{})})},J=({viewState:e,experimentId:t,endpointName:a,timeRange:i})=>"logs"===e?(0,p.Y)(V,{experimentId:t||"",endpointName:a||"dummy-run",timeRange:i}):null,X=({experimentIds:e})=>{const{theme:t}=(0,n.u)(),[a,s]=L(),r=h(),d=e[0],[m]=(()=>{var e;const[t,a]=(0,u.ok)(),i=null!==(e=t.get(Z))&&void 0!==e?e:"logs",n=(0,l.useCallback)((e,t=!1)=>{a(t=>void 0===e?(t.delete(Z),t):(t.set(Z,e),t),{replace:t})},[a]);return[i,n]})(),c=(0,l.useMemo)(()=>{const{startTime:e,endTime:t}=w(r.dateNow,a);return{startTime:e?new Date(e).getTime().toString():void 0,endTime:t?new Date(t).getTime().toString():void 0}},[r.dateNow,a]);return(0,p.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm,height:"100%",overflowY:"hidden"},""),children:[(0,o.$Y)()&&(0,p.Y)(Q,{}),(0,p.Y)(J,{viewState:m,experimentId:d,timeRange:c})]})},ee=({experimentIds:e})=>(0,p.Y)(K,{children:(0,p.Y)(b,{children:(0,p.Y)(X,{experimentIds:e})})}),te=({experimentIds:e})=>{const{theme:t}=(0,n.u)();return(0,p.FD)("div",{css:(0,i.AH)({minHeight:225,display:"flex",flexDirection:"column",gap:t.spacing.sm,flex:1,overflow:"hidden"},""),children:[(0,o.w7)()?null:(0,p.Y)(r.W,{hideBorder:!1}),(0,p.Y)(ae,{experimentIds:e})]})},ae=({experimentIds:e})=>(0,o.v3)()||(0,o.$Y)()?(0,p.Y)(ee,{experimentIds:e}):(0,p.Y)(s.O,{experimentIds:e})}}]);
//# sourceMappingURL=2037.3b6d446f.chunk.js.map