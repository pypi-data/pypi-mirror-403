type: object
title: "Cloud Inventory"
description: "Definitions for a proxmox cloud, setup of proxmox clusters."
additionalProperties: false
required:
  - pve_cloud_domain
  - pve_clusters
  - pve_vm_subnet
  - bind_master_ip
  - bind_slave_ip
  - bind_arpa_zone_service_lxcs
  - bind_additional_arpa_zones
  - bind_zone_admin_email
  - kea_dhcp_main_ip
  - kea_dhcp_failover_ip
  - kea_dhcp_routers
  - kea_dhcp_pools
  - kea_dhcp_static_routes
properties:
  pve_vm_subnet:
    type: string
    description: "Subnet this PVE cluster uses for its VMs."
    examples:
      - 192.168.10.0/24
  pve_cloud_domain:
    type: string
    description: "The overarching domain for the cloud. Will also be used for ddns."
    examples:
      - your-cloud.example.com
  kea_dhcp_main_ip:
    type: string
    description: "Static assigned ip for the main dhcp server. This has to match your dhcp lxc inventory file!"
    examples:
      - 192.168.1.2
  kea_dhcp_failover_ip:
    type: string
    description: "Static ip for slave dhcp server. This has to match your dhcp lxc inventory file!"
    examples:
      - 192.168.1.3
  kea_dhcp_routers:
    type: string
    description: "option-data for kea dhcp routers. The default route router that the dhcp will communicate."
    exaxmples:
      - "192.168.1.1"
  kea_dhcp_pools:
    type: array
    description: "Address pools that the dhcp allocates from. Has to be within pve_vm_subnet cidr."
    items:
      type: string
      description: "IPV4 Address range in keas format."
      examples:
        - "192.168.1.30 - 192.168.1.254"
  kea_dhcp_static_routes:
    type: string
    description: |
      classless-static-routes for kea option-data. You can pass comma seperated extra routes you want the dhcp to communicate, for example to a custom VPN gateway.
    examples:
      - "0.0.0.0/0 - 192.168.1.1, 10.0.0.1/24 - 192.168.1.20"
  bind_master_ip:
    type: string
    description: "IP of the primary bind dns for this cluster, will be statically assigned. Has to match your bind lxc inventory file!"
    examples:
      - 192.168.1.4
  bind_slave_ip:
    type: string
    description: "IP of the slave bind dns for this cluster. Has to match your bind lxc inventory file!"
    examples:
      - 192.168.1.5
  bind_arpa_zone_service_lxcs:
    type: string
    description: "Arpa zone in which service lxcs with static ips will manuall get their reverse dns entries."
    examples:
      - "1.168.192.in-addr.arpa"
  bind_additional_arpa_zones:
    type: array
    description: "Additional arpa zones which should be created and managed in the dns / dhcp ddns."
    items:
      type: string
  pve_clusters:
    type: object
    additionalProperties: false
    description: "Definitions for specific Proxmox clusters that will be part of the cloud. Keys are hostnames."
    patternProperties:
      '^(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)(?:\.(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?))*$':
        type: object
        title: "Cloud config for specific proxmox clusters."
        additionalProperties: false
        description: "This object contains configuration parameters for a proxmox cluster within a proxmox cloud."
        required:
          - pve_unique_cloud_services
        properties:
          pve_haproxy_floating_ip_internal:
            type: string
            description: |
              Floating ip that is exclusively accessible from inside the cloud / location. External forwardings should be made to pve_haproxy_floating_ip_external.
              Inside the cloud if you define a certificate entry, some nodeport forward or default kubeapi access, this will all be available automatically on this ip.
            examples:
              - 192.168.10.6
          pve_haproxy_floating_ip_external:
            type: string
            description: "Floating ip of our central cluster HAProxy."
            examples:
              - 192.168.10.7
          pve_unique_cloud_services:
            type: array
            description: |
              Unique service the cluster provides for its cloud. Unique in the sense that only one cluster may provide each of the services for the entire cloud.
              Services like haproxy and backup servers can and should be provided by multiple clusters. 
            items:
              type: string
              enum:
                - dns
                - dhcp
                - psql-state
          pve_host_vars:
            type: object
            description: |
              Optional variables that will be specifically set for a pve host. Key is the simple host name. 
              This can be used to build your specialized pve cluster setup playbooks. You can do things like
              wakeonlan, driver and network configuration with these easily. Simply create your own playbook and
              run it even before the pxc.cloud.setup_pve_clusters on this inventory.
            additionalProperties: true
            properties:
              disable_ipmi:
                type: boolean
                description: |
                  If specified will disable the openipmi power managemend systemd service. This might fail on proxmox
                  hosts that dont support it and clutters up monitoring.
       
  bind_zone_admin_email:
    type: string
    description: "Required adminstrator email in bind format for bind zones."
    examples: 
      - admin.example.com.
  bind_forward_zones:
    type: array
    description: |
      Creates zone in bind and delegation ns records to the specified nameservers. This is very useful if you have other nameservers with 
      their own authoritative zones you want resolved within the cloud.
    items:
      type: object
      properties:
        zone:
          type: string
        nameservers:
          type: array
          items:
            type: string

  acme_contact:
    type: string
    description: "Email address to use for acme account creation."
    examples:
      - acme@example.com
  acme_method:
    type: string
    enum:
      - route53
      - ionos
      - ionos_cloud
    description: | 
      PVE Cloud included method for solving dns01 challenges. You need to have created the appropriate cloud secrets created.
  plugin:
    type: string
    description: "Id of ansible inventory plugin, needs to be set exactly."
    enum:
      - pxc.cloud.pve_cloud_inv
