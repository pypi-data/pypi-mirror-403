name: Secure Document Processing
description: |
  Hero example demonstrating AKIOS's security cage: PII redaction, Merkle audit trail,
  and sandboxed execution. This workflow reads a document, automatically redacts PII,
  generates a summary, and exports a tamper-evident audit report.

  **REQUIRES:** data/input/[filename] (supports .txt, .pdf, .docx - sample document_example.pdf provided)
  **OUTPUT:** data/output/run_*/summary.txt + audit report

  Shows: Security-first design, real-time PII protection, cryptographic integrity.

steps:
  # Step 1: Read document from secure filesystem (path whitelisted)
  - step: 1
    agent: filesystem
    config:
      allowed_paths: ["./data/input"]
    action: read
    parameters:
      path: "./data/input/document_example.pdf"  # Supports .txt, .pdf, .docx files
      # Security: Path is whitelisted, read-only access enforced
      # Note: document_example.pdf is provided as sample - replace with your own document

  # Step 2: Automatic PII redaction (enforced by security layer)
  # Note: PII redaction happens automatically before LLM processing
  # This step shows the redaction in action via audit logs

  # Step 3: LLM analysis with cost controls (max tokens, budget limits)
  - step: 2
    agent: llm
    config:
      provider: "${AKIOS_LLM_PROVIDER:-openai}"  # Env var override with default
      model: "${AKIOS_LLM_MODEL:-gpt-4o-mini}"  # Env var override with default
    action: complete
    parameters:
      prompt: |
        Analyze this document and provide a concise summary.
        Focus on key facts, entities, and main points.
        Document content (with any sensitive information automatically redacted):

        {previous_output}
      max_tokens: 300
      # Security: Token limits prevent runaway costs, automatic kill-switches

  # Step 4: Store processed result (path whitelisted, controlled access)
  - step: 3
    agent: filesystem
    config:
      allowed_paths: ["./data/output"]
      read_only: false
    action: write
    parameters:
      path: "./data/output/summary.txt"
      content: "{previous_output}"
      # Security: Write access controlled, path restrictions enforced

  # Step 5: Workflow completion (audit integrity maintained in audit_events.jsonl)
  - step: 4
    agent: tool_executor
    config:
      allowed_commands: ["echo"]
      timeout: 10
    action: run
    parameters:
      command: "echo"
      args: ["Document processing completed - cryptographic audit integrity verified in audit_events.jsonl"]
      # Note: Full audit export available via 'akios audit export' command
