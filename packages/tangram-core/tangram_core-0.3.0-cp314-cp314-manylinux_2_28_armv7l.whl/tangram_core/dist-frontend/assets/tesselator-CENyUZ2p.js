import{l as z,P as C,a as A,b as E,L as M,g as j,c as O}from"./layer-DPcO4AXQ.js";import{P as B,f as R,d as N}from"./webgl-developer-tools-utTNOsNf.js";import{v as U,B as w}from"./deep-equal-BTW2ZN6S.js";import{a as D}from"./assert-cyW4mg7q.js";const H={props:{},name:"gouraudMaterial",vs:E.replace("phongMaterial","gouraudMaterial"),fs:A.replace("phongMaterial","gouraudMaterial"),source:C.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:!0},dependencies:[z],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(b){const e={...b};return e.specularColor&&(e.specularColor=e.specularColor.map(r=>r/255)),{...H.defaultUniforms,...e}}},F="compositeLayer.renderLayers";class I extends M{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:r}=e;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(e.object=r.__source.object,e.index=r.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,r){return r&&r.length}getSubLayerClass(e,r){const{_subLayerProps:t}=this.props;return t&&t[e]&&t[e].type||r}getSubLayerRow(e,r,t){return e.__source={parent:this,object:r,index:t},e}getSubLayerAccessor(e){if(typeof e=="function"){const r={index:-1,data:this.props.data,target:[]};return(t,s)=>t&&t.__source?(r.index=t.__source.index,e(t.__source.object,r)):e(t,s)}return e}getSubLayerProps(e={}){const{opacity:r,pickable:t,visible:s,parameters:i,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:c,highlightColor:l,coordinateSystem:p,coordinateOrigin:u,wrapLongitude:n,positionFormat:h,modelMatrix:S,extensions:_,fetch:T,operation:v,_subLayerProps:L}=this.props,f={id:"",updateTriggers:{},opacity:r,pickable:t,visible:s,parameters:i,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:c,highlightColor:l,coordinateSystem:p,coordinateOrigin:u,wrapLongitude:n,positionFormat:h,modelMatrix:S,extensions:_,fetch:T,operation:v},d=L&&e.id&&L[e.id],x=d&&d.updateTriggers,P=e.id||"sublayer";if(d){const y=this.props[B],g=e.type?e.type._propTypes:{};for(const m in d){const G=g[m]||y[m];G&&G.type==="accessor"&&(d[m]=this.getSubLayerAccessor(d[m]))}}Object.assign(f,e,d),f.id=`${this.props.id}-${P}`,f.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...x};for(const y of _){const g=y.getSubLayerProps.call(this,y);g&&Object.assign(f,g,{updateTriggers:Object.assign(f.updateTriggers,g.updateTriggers)})}return f}_updateAutoHighlight(e){for(const r of this.getSubLayers())r.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,r){let t=this.internalState.subLayers;const s=!t||this.needsUpdate();if(s){const i=this.renderLayers();t=R(i,Boolean),this.internalState.subLayers=t}N(F,this,s,t);for(const i of t)i.parent=this}}I.layerName="CompositeLayer";class X{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:r={}}=e;this.typedArrayManager=U,this.attributes={},this._attributeDefs=r,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:r,buffers:t={},getGeometry:s,geometryBuffer:i,positionFormat:o,dataChanged:a,normalize:c=!0}=this.opts;if(this.data=r,this.getGeometry=s,this.positionSize=i&&i.size||(o==="XY"?2:3),this.buffers=t,this.normalize=c,i&&(D(r.startIndices),this.getGeometry=this.getGeometryFromBuffer(i),c||(t.vertexPositions=i)),this.geometryBuffer=t.vertexPositions,Array.isArray(a))for(const l of a)this._rebuildGeometry(l);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:r}){this._rebuildGeometry({startRow:e,endRow:r})}getGeometryFromBuffer(e){const r=e.value||e;return ArrayBuffer.isView(r)?j(r,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,r){const{attributes:t,buffers:s,_attributeDefs:i,typedArrayManager:o}=this;for(const a in i)if(a in s)o.release(t[a]),t[a]=null;else{const c=i[a];c.copy=r,t[a]=o.allocate(t[a],e,c)}}_forEachGeometry(e,r,t){const{data:s,getGeometry:i}=this,{iterable:o,objectInfo:a}=O(s,r,t);for(const c of o){a.index++;const l=i?i(c,a):null;e(l,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:r,vertexStarts:t,instanceCount:s}=this;const{data:i,geometryBuffer:o}=this,{startRow:a=0,endRow:c=1/0}=e||{},l={};if(e||(r=[0],t=[0]),this.normalize||!o)this._forEachGeometry((u,n)=>{const h=u&&this.normalizeGeometry(u);l[n]=h,t[n+1]=t[n]+(h?this.getGeometrySize(h):0)},a,c),s=t[t.length-1];else if(t=i.startIndices,s=t[i.length]||0,ArrayBuffer.isView(o))s=s||o.length/this.positionSize;else if(o instanceof w){const u=this.positionSize*4;s=s||o.byteLength/u}else if(o.buffer){const u=o.stride||this.positionSize*4;s=s||o.buffer.byteLength/u}else if(o.value){const u=o.value,n=o.stride/u.BYTES_PER_ELEMENT||this.positionSize;s=s||u.length/n}this._allocate(s,!!e),this.indexStarts=r,this.vertexStarts=t,this.instanceCount=s;const p={};this._forEachGeometry((u,n)=>{const h=l[n]||u;p.vertexStart=t[n],p.indexStart=r[n];const S=n<t.length-1?t[n+1]:s;p.geometrySize=S-t[n],p.geometryIndex=n,this.updateGeometryAttributes(h,p)},a,c),this.vertexCount=r[r.length-1]}}export{I as C,X as T,H as g};
//# sourceMappingURL=tesselator-CENyUZ2p.js.map
