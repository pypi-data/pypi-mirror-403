import{V as z,M as m,f as O,a as R,b as T,P as _,s as A,c as G,l as N,d as F,t as U,e as v}from"./deep-equal-BTW2ZN6S.js";const f=Math.PI/180,w=180/Math.PI,P=6370972,d=256;function V(){const u=d/P,t=Math.PI/180*d;return{unitsPerMeter:[u,u,u],unitsPerMeter2:[0,0,0],metersPerUnit:[1/u,1/u,1/u],unitsPerDegree:[t,t,u],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,1/u]}}class B extends z{constructor(t={}){const{longitude:s=0,zoom:o=0,nearZMultiplier:n=.5,farZMultiplier:e=1,resolution:a=10}=t;let{latitude:i=0,height:r,altitude:c=1.5,fovy:h}=t;i=Math.max(Math.min(i,m),-m),r=r||1,h?c=O(h):h=R(c);const M=Math.pow(2,o-g(i)),S=t.nearZ??n,p=t.farZ??(c+d*2*M/r)*e,l=new T().lookAt({eye:[0,-c,0],up:[0,0,1]});l.rotateX(i*f),l.rotateZ(-s*f),l.scale(M/r),super({...t,height:r,viewMatrix:l,longitude:s,latitude:i,zoom:o,distanceScales:V(),fovy:h,focalDistance:c,near:S,far:p}),this.scale=M,this.latitude=i,this.longitude=s,this.fovy=h,this.resolution=a}get projectionMode(){return _.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(t={}){const s={targetZ:t.z||0},o=this.unproject([0,this.height/2],s),n=this.unproject([this.width/2,0],s),e=this.unproject([this.width,this.height/2],s),a=this.unproject([this.width/2,this.height],s);return e[0]<this.longitude&&(e[0]+=360),o[0]>this.longitude&&(o[0]-=360),[Math.min(o[0],e[0],n[0],a[0]),Math.min(o[1],e[1],n[1],a[1]),Math.max(o[0],e[0],n[0],a[0]),Math.max(o[1],e[1],n[1],a[1])]}unproject(t,{topLeft:s=!0,targetZ:o}={}){const[n,e,a]=t,i=s?e:this.height-e,{pixelUnprojectionMatrix:r}=this;let c;if(Number.isFinite(a))c=E(r,[n,i,a,1]);else{const p=E(r,[n,i,-1,1]),l=E(r,[n,i,1,1]),b=((o||0)/P+1)*d,D=A(G([],p,l)),j=A(p),I=A(l),q=4*((4*j*I-(D-j-I)**2)/16)/D,x=Math.sqrt(j-q),y=Math.sqrt(Math.max(0,b*b-q)),Z=(x-y)/Math.sqrt(D);c=N([],p,l,Z)}const[h,M,S]=this.unprojectPosition(c);return Number.isFinite(a)?[h,M,S]:Number.isFinite(o)?[h,M,o]:[h,M]}projectPosition(t){const[s,o,n=0]=t,e=s*f,a=o*f,i=Math.cos(a),r=(n/P+1)*d;return[Math.sin(e)*i*r,-Math.cos(e)*i*r,Math.sin(a)*r]}unprojectPosition(t){const[s,o,n]=t,e=F(t),a=Math.asin(n/e),r=Math.atan2(s,-o)*w,c=a*w,h=(e/d-1)*P;return[r,c,h]}projectFlat(t){return t}unprojectFlat(t){return t}panByPosition([t,s,o],n,e){const i=.25/Math.pow(2,this.zoom-g(this.latitude)),r=t+i*(e[0]-n[0]);let c=s-i*(e[1]-n[1]);c=Math.max(Math.min(c,m),-m);const h={longitude:r,latitude:c,zoom:o-g(s)};return h.zoom+=g(h.latitude),h}}B.displayName="GlobeViewport";function g(u){const t=Math.PI*Math.cos(u*Math.PI/180);return Math.log2(t)}function E(u,t){const s=U([],t,u);return v(s,s,1/s[3]),s}export{B as G,g as z};
//# sourceMappingURL=globe-viewport-tqhQW7C4.js.map
