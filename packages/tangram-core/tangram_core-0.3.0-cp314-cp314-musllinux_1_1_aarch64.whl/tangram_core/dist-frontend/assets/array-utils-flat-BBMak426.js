import{R as u,y as l,E as v,F as h,G as w}from"./deep-equal-BTW2ZN6S.js";class m extends u{static defaultProps={...u.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=m.normalizeProps(e,t),super(e,t,m.defaultProps)}static normalizeProps(e,t){return t}}const E={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"};class c extends u{static SAMPLE=4;static STORAGE=8;static RENDER=16;static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static RENDER_ATTACHMENT=16;dimension;baseDimension;format;width;height;depth;mipLevels;updateTimestamp;get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}constructor(e,t){if(t=c.normalizeProps(e,t),super(e,t,c.defaultProps),this.dimension=this.props.dimension,this.baseDimension=E[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(e.isExternalImage(t.data)){const n=e.getExternalImageSize(t.data);this.width=n?.width||1,this.height=n?.height||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&l.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=e.incrementTimestamp()}setSampler(e){this.sampler=e instanceof m?e:this.device.createSampler(e)}clone(e){return this.device.createTexture({...this.props,...e})}static normalizeProps(e,t){const n={...t},{width:r,height:s}=n;return typeof r=="number"&&(n.width=Math.max(1,Math.ceil(r))),typeof s=="number"&&(n.height=Math.max(1,Math.ceil(s))),n}_initializeData(e){this.device.isExternalImage(e)?this.copyExternalImage({image:e,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):e&&this.copyImageData({data:e,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(e){const{width:t,height:n,depth:r}=this,s={...c.defaultCopyDataOptions,width:t,height:n,depth:r,...e},a=this.device.getTextureFormatInfo(this.format);if(!e.bytesPerRow&&!a.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return s.bytesPerRow=e.bytesPerRow||t*(a.bytesPerPixel||4),s.rowsPerImage=e.rowsPerImage||n,s}_normalizeCopyExternalImageOptions(e){const t=this.device.getExternalImageSize(e.image),n={...c.defaultCopyExternalImageOptions,...t,...e};return n.width=Math.min(n.width,this.width-n.x),n.height=Math.min(n.height,this.height-n.y),n}static defaultProps={...u.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:c.TEXTURE|c.RENDER_ATTACHMENT|c.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0};static defaultCopyDataOptions={data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"};static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}}class y extends u{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,y.defaultProps)}static defaultProps={...u.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0}}function P(o,e,t){let n="";const r=e.split(/\r?\n/),s=o.slice().sort((a,i)=>a.lineNum-i.lineNum);switch(t?.showSourceCode||"no"){case"all":let a=0;for(let i=1;i<=r.length;i++)for(n+=g(r[i-1],i,t);s.length>a&&s[a].lineNum===i;){const f=s[a++];n+=d(f,r,f.lineNum,{...t,inlineSource:!1})}for(;s.length>a;){const i=s[a++];n+=d(i,[],0,{...t,inlineSource:!1})}return n;case"issues":case"no":for(const i of o)n+=d(i,r,i.lineNum,{inlineSource:t?.showSourceCode!=="no"});return n}}function d(o,e,t,n){if(n?.inlineSource){const s=L(e,t),a=o.linePos>0?`${" ".repeat(o.linePos+5)}^^^
`:"";return`
${s}${a}${o.type.toUpperCase()}: ${o.message}

`}const r=o.type==="error"?"red":"#8B4000";return n?.html?`<div class='luma-compiler-log-error' style="color:${r};"><b> ${o.type.toUpperCase()}: ${o.message}</b></div>`:`${o.type.toUpperCase()}: ${o.message}`}function L(o,e,t){let n="";for(let r=e-2;r<=e;r++){const s=o[r-1];s!==void 0&&(n+=g(s,e,t))}return n}function g(o,e,t){const n=t?.html?T(o):o;return`${I(String(e),4)}: ${n}${t?.html?"<br/>":`
`}`}function I(o,e){let t="";for(let n=o.length;n<e;++n)t+=" ";return t+o}function T(o){return o.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class b extends u{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"},super(e,{id:A(t),...t},b.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const t=await this.getCompilationInfo();e==="warnings"&&t?.length===0||this._displayShaderLog(t,this.id)}_displayShaderLog(e,t){if(typeof document>"u"||!document?.createElement)return;const n=t,r=`${this.stage} shader "${n}"`;let s=P(e,this.source,{showSourceCode:"all",html:!0});const a=this.getTranslatedSource();a&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${a}</pre></code>`);const i=document.createElement("Button");i.innerHTML=`
<h1>Compilation error in ${r}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,i.style.top="10px",i.style.left="10px",i.style.position="absolute",i.style.zIndex="9999",i.style.width="100%",i.style.textAlign="left",document.body.appendChild(i),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),i.onclick=()=>{const S=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(S)}}static defaultProps={...u.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0}}function A(o){return M(o.source)||o.id||v(`unnamed ${o.stage}-shader`)}function M(o,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(o);return n?n[1]:e}class x extends u{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,x.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}static defaultProps={...u.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}}}function _(o){return $[o]}function C(o){const[e,t]=R[o],n=e==="i32"||e==="u32",r=e!=="u32",s=N[e]*t;return{primitiveType:e,components:t,byteLength:s,integer:n,signed:r}}const N={f32:4,f16:2,i32:4,u32:4},R={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},$={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function F(o,e){const t={};for(const n of o.attributes){const r=O(o,e,n.name);r&&(t[n.name]=r)}return t}function X(o,e,t=16){const n=F(o,e),r=new Array(t).fill(null);for(const s of Object.values(n))r[s.location]=s;return r}function O(o,e,t){const n=z(o,t),r=D(e,t);if(!n)return null;const s=C(n.type),a=w(s),i=r?.vertexFormat||a,f=h(i);return{attributeName:r?.attributeName||n.name,bufferName:r?.bufferName||n.name,location:n.location,shaderType:n.type,primitiveType:s.primitiveType,shaderComponents:s.components,vertexFormat:i,bufferDataType:f.type,bufferComponents:f.components,normalized:f.normalized,integer:s.integer,stepMode:r?.stepMode||n.stepMode||"vertex",byteOffset:r?.byteOffset||0,byteStride:r?.byteStride||0}}function z(o,e){const t=o.attributes.find(n=>n.name===e);return t||l.warn(`shader layout attribute "${e}" not present in shader`),t||null}function D(o,e){B(o);let t=U(o,e);return t||(t=Y(o,e),t)?t:(l.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function B(o){for(const e of o)(e.attributes&&e.format||!e.attributes&&!e.format)&&l.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function U(o,e){for(const t of o)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function Y(o,e){for(const t of o){let n=t.byteStride;if(typeof t.byteStride!="number")for(const s of t.attributes||[]){const a=h(s.format);n+=a.byteLength}const r=t.attributes?.find(s=>s.attribute===e);if(r)return{attributeName:r.attribute,bufferName:t.name,stepMode:t.stepMode,vertexFormat:r.format,byteOffset:r.byteOffset,byteStride:n}}return null}let p;function H(o){return(!p||p.byteLength<o)&&(p=new ArrayBuffer(o)),p}function k(o,e){const t=H(o.BYTES_PER_ELEMENT*e);return new o(t,0,e)}export{x as R,b as S,c as T,H as a,m as b,y as c,F as d,X as e,k as f,_ as g};
//# sourceMappingURL=array-utils-flat-BBMak426.js.map
