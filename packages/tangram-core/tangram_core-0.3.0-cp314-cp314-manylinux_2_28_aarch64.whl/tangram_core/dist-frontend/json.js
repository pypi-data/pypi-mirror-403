import{g as Ue}from"./assets/_commonjsHelpers-CqkleIqs.js";function W(e,t=""){if(!e)throw new Error(`JSON conversion error ${t}`)}function Te(e,t){const r=qe(t);let o=e;for(const u of r)o=Be(o)?o[u]:void 0;return o}function Be(e){return e!==null&&typeof e=="object"}const ce={};function qe(e){if(typeof e=="string"){let t=ce[e];return t||(t=e.split("."),ce[e]=t),t}return Array.isArray(e)?e:[e]}var j={exports:{}},le;function je(){return le||(le=1,(function(e,t){(function(r){var o="Compound",u="Identifier",E="MemberExpression",J="Literal",Oe="ThisExpression",Ce="CallExpression",ve="UnaryExpression",me="BinaryExpression",_e="LogicalExpression",Ne="ConditionalExpression",we="ArrayExpression",k=46,te=44,Se=39,Pe=34,M=40,U=41,X=91,$=93,xe=63,Ae=59,Je=58,p=function(i,n){var b=new Error(i+" at character "+n);throw b.index=n,b.description=i,b},I=!0,_={"-":I,"!":I,"~":I,"+":I},C={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},T=function(i){var n=0,b;for(var S in i)(b=S.length)>n&&i.hasOwnProperty(S)&&(n=b);return n},N=T(_),w=T(C),D={true:!0,false:!1,null:null},ke="this",re=function(i){return C[i]||0},ne=function(i,n,b){var S=i==="||"||i==="&&"?_e:me;return{type:S,operator:i,left:n,right:b}},F=function(i){return i>=48&&i<=57},R=function(i){return i===36||i===95||i>=65&&i<=90||i>=97&&i<=122||i>=128&&!C[String.fromCharCode(i)]},z=function(i){return i===36||i===95||i>=65&&i<=90||i>=97&&i<=122||i>=48&&i<=57||i>=128&&!C[String.fromCharCode(i)]},d=function(i){for(var n=0,b=i.charAt,S=i.charCodeAt,y=function(s){return b.call(i,s)},f=function(s){return S.call(i,s)},L=i.length,O=function(){for(var s=f(n);s===32||s===9||s===10||s===13;)s=f(++n)},P=function(){var s=Ie(),a,c;if(O(),f(n)===xe){if(n++,a=P(),a||p("Expected expression",n),O(),f(n)===Je)return n++,c=P(),c||p("Expected expression",n),{type:Ne,test:s,consequent:a,alternate:c};p("Expected :",n)}else return s},se=function(){O();for(var s=i.substr(n,w),a=s.length;a>0;){if(C.hasOwnProperty(s)&&(!R(f(n))||n+s.length<i.length&&!z(f(n+s.length))))return n+=a,s;s=s.substr(0,--a)}return!1},Ie=function(){var s,a,c,l,m,g,v,x,ue;if(g=B(),a=se(),!a)return g;for(m={value:a,prec:re(a)},v=B(),v||p("Expected expression after "+a,n),l=[g,m,v];(a=se())&&(c=re(a),c!==0);){for(m={value:a,prec:c},ue=a;l.length>2&&c<=l[l.length-2].prec;)v=l.pop(),a=l.pop().value,g=l.pop(),s=ne(a,g,v),l.push(s);s=B(),s||p("Expected expression after "+ue,n),l.push(m,s)}for(x=l.length-1,s=l[x];x>1;)s=ne(l[x-1].value,l[x-2],s),x-=2;return s},B=function(){var s,a,c;if(O(),s=f(n),F(s)||s===k)return De();if(s===Se||s===Pe)return Fe();if(s===X)return Me();for(a=i.substr(n,N),c=a.length;c>0;){if(_.hasOwnProperty(a)&&(!R(f(n))||n+a.length<i.length&&!z(f(n+a.length))))return n+=c,{type:ve,operator:a,argument:B(),prefix:!0};a=a.substr(0,--c)}return R(s)||s===M?Re():!1},De=function(){for(var s="",a,c;F(f(n));)s+=y(n++);if(f(n)===k)for(s+=y(n++);F(f(n));)s+=y(n++);if(a=y(n),a==="e"||a==="E"){for(s+=y(n++),a=y(n),(a==="+"||a==="-")&&(s+=y(n++));F(f(n));)s+=y(n++);F(f(n-1))||p("Expected exponent ("+s+y(n)+")",n)}return c=f(n),R(c)?p("Variable names cannot start with a number ("+s+y(n)+")",n):c===k&&p("Unexpected period",n),{type:J,value:parseFloat(s),raw:s}},Fe=function(){for(var s="",a=y(n++),c=!1,l;n<L;)if(l=y(n++),l===a){c=!0;break}else if(l==="\\")switch(l=y(n++),l){case"n":s+=`
`;break;case"r":s+="\r";break;case"t":s+="	";break;case"b":s+="\b";break;case"f":s+="\f";break;case"v":s+="\v";break;default:s+=l}else s+=l;return c||p('Unclosed quote after "'+s+'"',n),{type:J,value:s,raw:a+s+a}},ie=function(){var s=f(n),a=n,c;for(R(s)?n++:p("Unexpected "+y(n),n);n<L&&(s=f(n),z(s));)n++;return c=i.slice(a,n),D.hasOwnProperty(c)?{type:J,value:D[c],raw:c}:c===ke?{type:Oe}:{type:u,name:c}},oe=function(s){for(var a,c=[],l,m=!1,g=0;n<L;)if(O(),a=f(n),a===s){m=!0,n++,s===U&&g&&g>=c.length&&p("Unexpected token "+String.fromCharCode(s),n);break}else if(a===te){if(n++,g++,g!==c.length){if(s===U)p("Unexpected token ,",n);else if(s===$)for(var v=c.length;v<g;v++)c.push(null)}}else l=P(),(!l||l.type===o)&&p("Expected comma",n),c.push(l);return m||p("Expected "+String.fromCharCode(s),n),c},Re=function(){var s,a;for(s=f(n),s===M?a=Le():a=ie(),O(),s=f(n);s===k||s===X||s===M;)n++,s===k?(O(),a={type:E,computed:!1,object:a,property:ie()}):s===X?(a={type:E,computed:!0,object:a,property:P()},O(),s=f(n),s!==$&&p("Unclosed [",n),n++):s===M&&(a={type:Ce,arguments:oe(U),callee:a}),O(),s=f(n);return a},Le=function(){n++;var s=P();if(O(),f(n)===U)return n++,s;p("Unclosed (",n)},Me=function(){return n++,{type:we,elements:oe($)}},q=[],Y,ae;n<L;)Y=f(n),Y===Ae||Y===te?n++:(ae=P())?q.push(ae):n<L&&p('Unexpected "'+y(n)+'"',n);return q.length===1?q[0]:{type:o,body:q}};d.version="0.3.5",d.toString=function(){return"JavaScript Expression Parser (JSEP) v"+d.version},d.addUnaryOp=function(i){return N=Math.max(i.length,N),_[i]=I,this},d.addBinaryOp=function(i,n){return w=Math.max(i.length,w),C[i]=n,this},d.addLiteral=function(i,n){return D[i]=n,this},d.removeUnaryOp=function(i){return delete _[i],i.length===N&&(N=T(_)),this},d.removeAllUnaryOps=function(){return _={},N=0,this},d.removeBinaryOp=function(i){return delete C[i],i.length===w&&(w=T(C)),this},d.removeAllBinaryOps=function(){return C={},w=0,this},d.removeLiteral=function(i){return delete D[i],this},d.removeAllLiterals=function(){return D={},this},e.exports?t=e.exports=d:t.parse=d})()})(j,j.exports)),j.exports}var Ke=je();const Xe=Ue(Ke),fe={"||":(e,t)=>e||t,"&&":(e,t)=>e&&t,"|":(e,t)=>e|t,"^":(e,t)=>e^t,"&":(e,t)=>e&t,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,"===":(e,t)=>e===t,"!==":(e,t)=>e!==t,"<":(e,t)=>e<t,">":(e,t)=>e>t,"<=":(e,t)=>e<=t,">=":(e,t)=>e>=t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t},$e={"-":e=>-e,"+":e=>+e,"~":e=>~e,"!":e=>!e};function pe(e,t){return e.map(function(r){return h(r,t)})}function he(e,t){const r=h(e.object,t);let o;if(e.computed?o=h(e.property,t):o=e.property.name,/^__proto__|prototype|constructor$/.test(o))throw Error(`Access to member "${o}" disallowed.`);return[r,r[o]]}function h(e,t){const r=e;switch(r.type){case"ArrayExpression":return pe(r.elements,t);case"BinaryExpression":return fe[r.operator](h(r.left,t),h(r.right,t));case"CallExpression":let o,u,E;return r.callee.type==="MemberExpression"?(E=he(r.callee,t),o=E[0],u=E[1]):u=h(r.callee,t),typeof u!="function"?void 0:u.apply(o,pe(r.arguments,t));case"ConditionalExpression":return h(r.test,t)?h(r.consequent,t):h(r.alternate,t);case"Identifier":return t[r.name];case"Literal":return r.value;case"LogicalExpression":return r.operator==="||"?h(r.left,t)||h(r.right,t):r.operator==="&&"?h(r.left,t)&&h(r.right,t):fe[r.operator](h(r.left,t),h(r.right,t));case"MemberExpression":return he(r,t)[1];case"ThisExpression":return t;case"UnaryExpression":return $e[r.operator](h(r.argument,t));default:return}}const Q={"-":e=>e};function Ee(e,t){if(e in Q)return Q[e];let r;const o=Xe(e);return o.type==="Identifier"?r=u=>Te(u,e):(G(o,u=>{if(u.type==="CallExpression")throw new Error("Function calls not allowed in JSON expressions")}),r=u=>h(o,u)),Q[e]=r,r}function G(e,t){if(Array.isArray(e))e.forEach(r=>G(r,t));else if(e&&typeof e=="object"){e.type&&t(e);for(const r in e)G(e[r],t)}}const K="@@=",ye="@@#",ze="@@type",ge="@@function",de=e=>e&&typeof e=="object";class H{constructor(...t){this.typeKey=ze,this.functionKey=ge,this.log=console,this.classes={},this.reactComponents={},this.enumerations={},this.constants={},this.functions={},this.React=null,this.convertFunction=Ee,this.preProcessClassProps=(r,o)=>o,this.postProcessConvertedJson=r=>r;for(const r of t)this.merge(r)}merge(t){for(const r in t)switch(r){case"layers":case"views":Object.assign(this.classes,t[r]);break;default:if(r in this){const o=t[r];this[r]=de(this[r])?Object.assign(this[r],o):o}}}validate(t){return W(!this.typeKey||typeof this.typeKey=="string"),W(de(this.classes)),!0}}function Ye(e){return typeof e=="string"&&e.startsWith(K)}function Qe(e){return e.replace(K,"")}function be(e,t){const r={};for(const o in e){let u=e[o];Ye(u)&&(u=Qe(u),u=Ee(u)),r[o]=u}return r}function We(e,t,r){const o=r.classes[e],u=r.reactComponents[e];if(!o&&!u){const{log:E}=r;if(E){const J=JSON.stringify(t,null,0).slice(0,40);E.warn(`JSON converter: No registered class of type ${e}(${J}...)  `)}return null}return o?Ge(o,t,r):He(u,t,r)}function Ge(e,t,r){return r.preProcessClassProps&&(t=r.preProcessClassProps(e,t,r)),t=be(t),new e(t)}function He(e,t,r){const{React:o}=r,{children:u=[]}=t;return delete t.children,r.preProcessClassProps&&(t=r.preProcessClassProps(e,t,r)),t=be(t),o.createElement(e,t,u)}function Ve(e,t,r){const o=r.functions[e];if(!o){const{log:u}=r;if(u){const E=JSON.stringify(t,null,0).slice(0,40);u.warn(`JSON converter: No registered function ${e}(${E}...)  `)}return null}return o(t)}function Ze(e){return typeof e=="string"?JSON.parse(e):e}const V=e=>e&&typeof e=="object";class ot{constructor(t){this.log=console,this.onJSONChange=()=>{},this.json=null,this.convertedJson=null,this.setProps(t)}finalize(){}setProps(t){"configuration"in t&&(this.configuration=t.configuration instanceof H?t.configuration:new H(t.configuration)),"onJSONChange"in t&&(this.onJSONChange=t.onJSONChange)}mergeConfiguration(t){this.configuration.merge(t)}convert(t){if(!t||t===this.json)return this.convertedJson;this.json=t;const r=Ze(t);let o=et(r,this.configuration);return o=this.configuration.postProcessConvertedJson(o),this.convertedJson=o,o}convertJson(t){return this.convert(t)}}function et(e,t){return t=new H(t),Z(e,"",t)}function Z(e,t,r){return Array.isArray(e)?e.map((o,u)=>Z(o,String(u),r)):tt(e,r)?rt(e,r):V(e)?ge in e?nt(e,r):ee(e,r):typeof e=="string"?st(e,t,r):e}function tt(e,t){const{typeKey:r}=t;return V(e)&&!!e[r]}function rt(e,t){const{typeKey:r}=t,o=e[r];let u={...e};return delete u[r],u=ee(u,t),We(o,u,t)}function nt(e,t){const{functionKey:r}=t,o=e[r];let u={...e};return delete u[r],u=ee(u,t),Ve(o,u,t)}function ee(e,t){W(V(e));const r={};for(const o in e){const u=e[o];r[o]=Z(u,o,t)}return r}function st(e,t,r){if(e.startsWith(K)&&r.convertFunction)return e=e.replace(K,""),r.convertFunction(e,r);if(e.startsWith(ye)){if(e=e.replace(ye,""),r.constants[e])return r.constants[e];const[o,u]=e.split(".");return r.enumerations[o][u]}return e}const A={onInitialize:e=>e,onFinalize:e=>e,onMessage:e=>e};class at{static setCallbacks({onInitialize:t,onFinalize:r,onMessage:o}){t&&(A.onInitialize=t),r&&(A.onFinalize=r),o&&(A.onMessage=o)}constructor(t="Transport"){this._messageQueue=[],this.userData={},this._destroyed=!1,this.name=t}getRootDOMElement(){return typeof document<"u"?document.body:null}sendJSONMessage(){console.error("Back-channel not implemented for this transport")}sendBinaryMessage(){console.error("Back-channel not implemented for this transport")}_initialize(t={}){const r={transport:this,...t};A.onInitialize(r)}_finalize(t={}){const r={transport:this,...t};A.onFinalize(r),this._destroyed=!0}_messageReceived(t={}){t={transport:this,...t},console.debug("Delivering transport message",t),A.onMessage(t)}static _stringifyJSONSafe(t){const r=new Set;return JSON.stringify(t,(o,u)=>{if(typeof u=="object"&&u!==null){if(r.has(u))try{return JSON.parse(JSON.stringify(u))}catch{return}r.add(u)}return u})}}function ut(e,t){if(e===t)return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null||Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(!(r in t)||e[r]!==t[r])return!1;for(const r in t)if(!(r in e))return!1;return!0}export{H as JSONConfiguration,ot as JSONConverter,at as Transport,be as _convertFunctions,Ee as _parseExpressionString,ut as _shallowEqualObjects};
//# sourceMappingURL=json.js.map
