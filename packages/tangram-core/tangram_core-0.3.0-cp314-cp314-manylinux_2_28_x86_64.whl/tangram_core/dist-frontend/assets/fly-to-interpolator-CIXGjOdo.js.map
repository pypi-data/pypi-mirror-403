{"version":3,"file":"fly-to-interpolator-CIXGjOdo.js","sources":["../../../../node_modules/.pnpm/@math.gl+web-mercator@4.1.0/node_modules/@math.gl/web-mercator/dist/fly-to-viewport.js","../../../../node_modules/.pnpm/@deck.gl+core@9.2.6/node_modules/@deck.gl/core/dist/transitions/fly-to-interpolator.js"],"sourcesContent":["import { lerp } from \"./math-utils.js\";\nimport { scaleToZoom, zoomToScale, lngLatToWorld, worldToLngLat } from \"./web-mercator-utils.js\";\nimport { vec2 } from '@math.gl/core';\nconst EPSILON = 0.01;\nconst VIEWPORT_TRANSITION_PROPS = ['longitude', 'latitude', 'zoom'];\nconst DEFAULT_OPTS = {\n    curve: 1.414,\n    speed: 1.2\n    // screenSpeed and maxDuration are used only if specified\n};\n/**\n * mapbox-gl-js flyTo : https://www.mapbox.com/mapbox-gl-js/api/#map#flyto.\n * It implements “Smooth and efficient zooming and panning.” algorithm by\n * \"Jarke J. van Wijk and Wim A.A. Nuij\"\n */\nexport function flyToViewport(startProps, endProps, t, options) {\n    // Equations from above paper are referred where needed.\n    const { startZoom, startCenterXY, uDelta, w0, u1, S, rho, rho2, r0 } = getFlyToTransitionParams(startProps, endProps, options);\n    // If change in center is too small, do linear interpolaiton.\n    if (u1 < EPSILON) {\n        const viewport = {};\n        for (const key of VIEWPORT_TRANSITION_PROPS) {\n            const startValue = startProps[key];\n            const endValue = endProps[key];\n            // @ts-ignore-error properties are populated dynamically\n            viewport[key] = lerp(startValue, endValue, t);\n        }\n        // @ts-expect-error properties are populated dynamically\n        return viewport;\n    }\n    const s = t * S;\n    const w = Math.cosh(r0) / Math.cosh(r0 + rho * s);\n    const u = (w0 * ((Math.cosh(r0) * Math.tanh(r0 + rho * s) - Math.sinh(r0)) / rho2)) / u1;\n    const scaleIncrement = 1 / w; // Using w method for scaling.\n    const newZoom = startZoom + scaleToZoom(scaleIncrement);\n    const newCenterWorld = vec2.scale([], uDelta, u);\n    vec2.add(newCenterWorld, newCenterWorld, startCenterXY);\n    const newCenter = worldToLngLat(newCenterWorld);\n    return {\n        longitude: newCenter[0],\n        latitude: newCenter[1],\n        zoom: newZoom\n    };\n}\n// returns transition duration in milliseconds\nexport function getFlyToDuration(startProps, endProps, options) {\n    const opts = { ...DEFAULT_OPTS, ...options };\n    const { screenSpeed, speed, maxDuration } = opts;\n    const { S, rho } = getFlyToTransitionParams(startProps, endProps, opts);\n    const length = 1000 * S;\n    let duration;\n    if (Number.isFinite(screenSpeed)) {\n        duration = length / (screenSpeed / rho);\n    }\n    else {\n        duration = length / speed;\n    }\n    return Number.isFinite(maxDuration) && duration > maxDuration ? 0 : duration;\n}\n// Private Methods\n// Calculate all parameters that are static for given startProps and endProps\nfunction getFlyToTransitionParams(startProps, endProps, opts) {\n    opts = Object.assign({}, DEFAULT_OPTS, opts);\n    const rho = opts.curve;\n    const startZoom = startProps.zoom;\n    const startCenter = [startProps.longitude, startProps.latitude];\n    const startScale = zoomToScale(startZoom);\n    const endZoom = endProps.zoom;\n    const endCenter = [endProps.longitude, endProps.latitude];\n    const scale = zoomToScale(endZoom - startZoom);\n    const startCenterXY = lngLatToWorld(startCenter);\n    const endCenterXY = lngLatToWorld(endCenter);\n    const uDelta = vec2.sub([], endCenterXY, startCenterXY);\n    const w0 = Math.max(startProps.width, startProps.height);\n    const w1 = w0 / scale;\n    const u1 = vec2.length(uDelta) * startScale;\n    // u0 is treated as '0' in Eq (9).\n    // If u1 is too small, will generate invalid number\n    const _u1 = Math.max(u1, EPSILON);\n    // Implement Equation (9) from above algorithm.\n    const rho2 = rho * rho;\n    const b0 = (w1 * w1 - w0 * w0 + rho2 * rho2 * _u1 * _u1) / (2 * w0 * rho2 * _u1);\n    const b1 = (w1 * w1 - w0 * w0 - rho2 * rho2 * _u1 * _u1) / (2 * w1 * rho2 * _u1);\n    const r0 = Math.log(Math.sqrt(b0 * b0 + 1) - b0);\n    const r1 = Math.log(Math.sqrt(b1 * b1 + 1) - b1);\n    const S = (r1 - r0) / rho;\n    return { startZoom, startCenterXY, uDelta, w0, u1, S, rho, rho2, r0, r1 };\n}\n//# sourceMappingURL=fly-to-viewport.js.map","// deck.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\nimport TransitionInterpolator from \"./transition-interpolator.js\";\nimport { lerp } from '@math.gl/core';\nimport { flyToViewport, getFlyToDuration } from '@math.gl/web-mercator';\nconst LINEARLY_INTERPOLATED_PROPS = {\n    bearing: 0,\n    pitch: 0,\n    position: [0, 0, 0]\n};\nconst DEFAULT_OPTS = {\n    speed: 1.2,\n    curve: 1.414\n};\n/**\n * This class adapts mapbox-gl-js Map#flyTo animation so it can be used in\n * react/redux architecture.\n * mapbox-gl-js flyTo : https://www.mapbox.com/mapbox-gl-js/api/#map#flyto.\n * It implements “Smooth and efficient zooming and panning.” algorithm by\n * \"Jarke J. van Wijk and Wim A.A. Nuij\"\n */\nexport default class FlyToInterpolator extends TransitionInterpolator {\n    constructor(opts = {}) {\n        super({\n            compare: ['longitude', 'latitude', 'zoom', 'bearing', 'pitch', 'position'],\n            extract: ['width', 'height', 'longitude', 'latitude', 'zoom', 'bearing', 'pitch', 'position'],\n            required: ['width', 'height', 'latitude', 'longitude', 'zoom']\n        });\n        this.opts = { ...DEFAULT_OPTS, ...opts };\n    }\n    interpolateProps(startProps, endProps, t) {\n        const viewport = flyToViewport(startProps, endProps, t, this.opts);\n        // Linearly interpolate 'bearing', 'pitch' and 'position'.\n        // If they are not supplied, they are interpreted as zeros in viewport calculation\n        // (fallback defined in WebMercatorViewport)\n        // Because there is no guarantee that the current controller's ViewState normalizes\n        // these props, safe guard is needed to avoid generating NaNs\n        for (const key in LINEARLY_INTERPOLATED_PROPS) {\n            viewport[key] = lerp(startProps[key] || LINEARLY_INTERPOLATED_PROPS[key], endProps[key] || LINEARLY_INTERPOLATED_PROPS[key], t);\n        }\n        return viewport;\n    }\n    // computes the transition duration\n    getDuration(startProps, endProps) {\n        let { transitionDuration } = endProps;\n        if (transitionDuration === 'auto') {\n            // auto calculate duration based on start and end props\n            transitionDuration = getFlyToDuration(startProps, endProps, this.opts);\n        }\n        return transitionDuration;\n    }\n}\n//# sourceMappingURL=fly-to-interpolator.js.map"],"names":["EPSILON","VIEWPORT_TRANSITION_PROPS","DEFAULT_OPTS","flyToViewport","startProps","endProps","t","options","startZoom","startCenterXY","uDelta","w0","u1","S","rho","rho2","r0","getFlyToTransitionParams","viewport","key","startValue","endValue","lerp","s","w","u","scaleIncrement","newZoom","scaleToZoom","newCenterWorld","vec2.scale","vec2.add","newCenter","worldToLngLat","getFlyToDuration","opts","screenSpeed","speed","maxDuration","length","duration","startCenter","startScale","zoomToScale","endZoom","endCenter","scale","lngLatToWorld","endCenterXY","vec2.sub","w1","vec2.length","_u1","b0","b1","r1","LINEARLY_INTERPOLATED_PROPS","FlyToInterpolator","TransitionInterpolator","transitionDuration"],"mappings":"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","x_google_ignoreList":[0,1]}