import{D as z,y as o,E as L,F as M,B as H}from"./deep-equal-BTW2ZN6S.js";function E(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}class P{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=E(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(E()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class R{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:s}=e;let i=this.stats[t];return i||(e instanceof P?i=e:i=new P(t,s),this.stats[t]=i),i}}class W{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new R({id:e})),this.stats.get(e)}}const A=new W,a="texture-compression-bc",n="texture-compression-astc",c="texture-compression-etc2",O="texture-compression-etc1-webgl",f="texture-compression-pvrtc-webgl",C="texture-compression-atc-webgl",d="float32-renderable-webgl",T="float16-renderable-webgl",B="rgb9e5ufloat-renderable-webgl",S="snorm8-renderable-webgl",g="norm16-renderable-webgl",y="snorm16-renderable-webgl",p="float32-filterable",v="float16-filterable-webgl";function F(r){const e=V[r];if(!e)throw new Error(`Unsupported texture format ${r}`);return e}const G={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:S},rg8snorm:{render:S},"rgb8snorm-webgl":{},rgba8snorm:{render:S},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:g},rg16unorm:{render:g},"rgb16unorm-webgl":{f:g},rgba16unorm:{render:g},r16snorm:{f:y},rg16snorm:{render:y},"rgb16snorm-webgl":{f:g},rgba16snorm:{render:y},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:T,filter:"float16-filterable-webgl"},rg16float:{render:T,filter:v},rgba16float:{render:T,filter:v},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:d,filter:p},rg32float:{render:!1,filter:p},"rgb32float-webgl":{render:d,filter:p},rgba32float:{render:d,filter:p},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:B},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:d},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},$={"bc1-rgb-unorm-webgl":{f:a},"bc1-rgb-unorm-srgb-webgl":{f:a},"bc1-rgba-unorm":{f:a},"bc1-rgba-unorm-srgb":{f:a},"bc2-rgba-unorm":{f:a},"bc2-rgba-unorm-srgb":{f:a},"bc3-rgba-unorm":{f:a},"bc3-rgba-unorm-srgb":{f:a},"bc4-r-unorm":{f:a},"bc4-r-snorm":{f:a},"bc5-rg-unorm":{f:a},"bc5-rg-snorm":{f:a},"bc6h-rgb-ufloat":{f:a},"bc6h-rgb-float":{f:a},"bc7-rgba-unorm":{f:a},"bc7-rgba-unorm-srgb":{f:a},"etc2-rgb8unorm":{f:c},"etc2-rgb8unorm-srgb":{f:c},"etc2-rgb8a1unorm":{f:c},"etc2-rgb8a1unorm-srgb":{f:c},"etc2-rgba8unorm":{f:c},"etc2-rgba8unorm-srgb":{f:c},"eac-r11unorm":{f:c},"eac-r11snorm":{f:c},"eac-rg11unorm":{f:c},"eac-rg11snorm":{f:c},"astc-4x4-unorm":{f:n},"astc-4x4-unorm-srgb":{f:n},"astc-5x4-unorm":{f:n},"astc-5x4-unorm-srgb":{f:n},"astc-5x5-unorm":{f:n},"astc-5x5-unorm-srgb":{f:n},"astc-6x5-unorm":{f:n},"astc-6x5-unorm-srgb":{f:n},"astc-6x6-unorm":{f:n},"astc-6x6-unorm-srgb":{f:n},"astc-8x5-unorm":{f:n},"astc-8x5-unorm-srgb":{f:n},"astc-8x6-unorm":{f:n},"astc-8x6-unorm-srgb":{f:n},"astc-8x8-unorm":{f:n},"astc-8x8-unorm-srgb":{f:n},"astc-10x5-unorm":{f:n},"astc-10x5-unorm-srgb":{f:n},"astc-10x6-unorm":{f:n},"astc-10x6-unorm-srgb":{f:n},"astc-10x8-unorm":{f:n},"astc-10x8-unorm-srgb":{f:n},"astc-10x10-unorm":{f:n},"astc-10x10-unorm-srgb":{f:n},"astc-12x10-unorm":{f:n},"astc-12x10-unorm-srgb":{f:n},"astc-12x12-unorm":{f:n},"astc-12x12-unorm-srgb":{f:n},"pvrtc-rgb4unorm-webgl":{f},"pvrtc-rgba4unorm-webgl":{f},"pvrtc-rbg2unorm-webgl":{f},"pvrtc-rgba2unorm-webgl":{f},"etc1-rbg-unorm-webgl":{f:O},"atc-rgb-unorm-webgl":{f:C},"atc-rgba-unorm-webgl":{f:C},"atc-rgbai-unorm-webgl":{f:C}},V={...G,...$},U=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],X=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;class j{getInfo(e){return D(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return U.some(t=>e.startsWith(t))}getCapabilities(e){const t=F(e),s={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},i=D(e),l=e.startsWith("depth")||e.startsWith("stencil"),m=i?.signed,w=i?.integer,_=i?.webgl;return s.render&&=!m,s.filter&&=!l&&!m&&!w&&!_,s}}const x=new j;function D(r){let e=N(r);if(x.isCompressed(r)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const s=J(r);s&&(e.blockWidth=s.blockWidth,e.blockHeight=s.blockHeight)}const t=X.exec(r);if(t){const[,s,i,l,m,w]=t,_=`${l}${i}`,u=z(_),b=u.byteLength*8,h=s.length,I=[b,h>=2?b:0,h>=3?b:0,h>=4?b:0];e={format:r,attachment:e.attachment,dataType:u.signedType,components:h,channels:s,integer:u.integer,signed:u.signed,normalized:u.normalized,bitsPerChannel:I,bytesPerPixel:u.byteLength*s.length,packed:e.packed,srgb:e.srgb},w==="-webgl"&&(e.webgl=!0),m==="-srgb"&&(e.srgb=!0)}return r.endsWith("-webgl")&&(e.webgl=!0),r.endsWith("-srgb")&&(e.srgb=!0),e}function N(r){const e=F(r),t=e.bytesPerPixel||1,s=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:r,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:t,bitsPerChannel:s,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function J(r){const t=/.*-(\d+)x(\d+)-.*/.exec(r);if(t){const[,s,i]=t;return{blockWidth:Number(s),blockHeight:Number(i)}}return null}function q(r){return typeof ImageData<"u"&&r instanceof ImageData||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement||typeof VideoFrame<"u"&&r instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas}function K(r){if(typeof ImageData<"u"&&r instanceof ImageData||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas)return{width:r.width,height:r.height};if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)return{width:r.naturalWidth,height:r.naturalHeight};if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)return{width:r.videoWidth,height:r.videoHeight};if(typeof VideoFrame<"u"&&r instanceof VideoFrame)return{width:r.displayWidth,height:r.displayHeight};throw new Error("Unknown image type")}class Y{}class Z{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class k{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(e,t)=>{},onResize:(e,t)=>{const[s,i]=e.getDevicePixelSize();o.log(1,`${e} resized => ${s}x${i}px`)()},onPositionChange:(e,t)=>{const[s,i]=e.getPosition();o.log(1,`${e} repositioned => ${s},${i}`)()},onVisibilityChange:e=>o.log(1,`${e} Visibility changed ${e.isVisible}`)(),onDevicePixelRatioChange:(e,t)=>o.log(1,`${e} DPR changed ${t.oldRatio} => ${e.devicePixelRatio}`)(),debug:o.get("debug")||void 0,debugShaders:o.get("debug-shaders")||void 0,debugFramebuffers:!!o.get("debug-framebuffers"),debugFactories:!!o.get("debug-factories"),debugWebGL:!!o.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0};get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}id;props;userData={};statsManager=A;timestamp=0;_reused=!1;_lumaData={};_textureCaps={};constructor(e){this.props={...k.defaultProps,...e},this.id=this.props.id||L(this[Symbol.toStringTag].toLowerCase())}getVertexFormatInfo(e){return M(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return x.getInfo(e)}getTextureFormatCapabilities(e){let t=this._textureCaps[e];if(!t){const s=this._getDeviceTextureFormatCapabilities(e);t=this._getDeviceSpecificTextureFormatCapabilities(s),this._textureCaps[e]=t}return t}getMipLevelCount(e,t,s=1){const i=Math.max(e,t,s);return 1+Math.floor(Math.log2(i))}isExternalImage(e){return q(e)}getExternalImageSize(e){return K(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return x.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){this.commandEncoder?.popDebugGroup()}insertDebugMarker(e){this.commandEncoder?.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,t,...s){return this.props.onError(e,t)?()=>{}:o.error(e.message,t,...s)}debug(){if(this.props.debug)debugger;else o.once(0,`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`)()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){const t=x.getCapabilities(e),s=l=>(typeof l=="string"?this.features.has(l):l)??!0,i=s(t.create);return{format:e,create:i,render:i&&s(t.render),filter:i&&s(t.filter),blend:i&&s(t.blend),store:i&&s(t.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};if((e.usage||0)&H.INDEX&&(e.indexType||(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":e.data instanceof Uint8Array&&(t.data=new Uint16Array(e.data),t.indexType="uint16")),!t.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return t}}function ee(r,e){if(!r)throw new Error(e||"deck.gl: assertion failed.")}export{k as D,R as S,ee as a,Z as b,Y as c,A as l,x as t};
//# sourceMappingURL=assert-cyW4mg7q.js.map
