import{i as T,a as w}from"./webgl-developer-tools-utTNOsNf.js";const b="4.3.3",x=globalThis.loaders?.parseImageNode,m=typeof Image<"u",u=typeof ImageBitmap<"u",U=!!x,d=T?!0:U;function E(e){switch(e){case"auto":return u||m||d;case"imagebitmap":return u;case"image":return m;case"data":return d;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}function D(){if(u)return"imagebitmap";if(m)return"image";if(d)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function M(e){const t=B(e);if(!t)throw new Error("Not an image");return t}function S(e){switch(M(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function B(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}const A=/^data:image\/svg\+xml/,O=/\.svg((\?|#).*)?$/;function l(e){return e&&(A.test(e)||O.test(e))}function L(e,t){if(l(t)){let a=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(a=unescape(encodeURIComponent(a)))}catch(r){throw new Error(r.message)}return`data:image/svg+xml;base64,${btoa(a)}`}return h(e,t)}function h(e,t){if(l(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function I(e,t,n){const a=L(e,n),i=self.URL||self.webkitURL,r=typeof a!="string"&&i.createObjectURL(a);try{return await N(r||a,t)}finally{r&&i.revokeObjectURL(r)}}async function N(e,t){const n=new Image;return n.src=e,t.image&&t.image.decode&&n.decode?(await n.decode(),n):await new Promise((a,i)=>{try{n.onload=()=>a(n),n.onerror=r=>{const s=r instanceof Error?r.message:"error";i(new Error(s))}}catch(r){i(r)}})}const V={};let p=!0;async function P(e,t,n){let a;l(n)?a=await I(e,t,n):a=h(e,n);const i=t&&t.imagebitmap;return await _(a,i)}async function _(e,t=null){if((v(t)||!p)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(n){console.warn(n),p=!1}return await createImageBitmap(e)}function v(e){for(const t in e||V)return!1;return!0}function R(e){return!C(e,"ftyp",4)||(e[8]&96)===0?null:k(e)}function k(e){switch(G(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function G(e,t,n){return String.fromCharCode(...e.slice(t,n))}function j(e){return[...e].map(t=>t.charCodeAt(0))}function C(e,t,n=0){const a=j(t);for(let i=0;i<a.length;++i)if(a[i]!==e[i+n])return!1;return!0}const o=!1,f=!0;function y(e){const t=g(e);return J(t)||X(t)||$(t)||Y(t)||F(t)}function F(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),n=R(t);return n?{mimeType:n.mimeType,width:0,height:0}:null}function J(e){const t=g(e);return t.byteLength>=24&&t.getUint32(0,o)===2303741511?{mimeType:"image/png",width:t.getUint32(16,o),height:t.getUint32(20,o)}:null}function $(e){const t=g(e);return t.byteLength>=10&&t.getUint32(0,o)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,f),height:t.getUint16(8,f)}:null}function Y(e){const t=g(e);return t.byteLength>=14&&t.getUint16(0,o)===16973&&t.getUint32(2,f)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,f),height:t.getUint32(22,f)}:null}function X(e){const t=g(e);if(!(t.byteLength>=3&&t.getUint16(0,o)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:a,sofMarkers:i}=q();let r=2;for(;r+9<t.byteLength;){const s=t.getUint16(r,o);if(i.has(s))return{mimeType:"image/jpeg",height:t.getUint16(r+5,o),width:t.getUint16(r+7,o)};if(!a.has(s))return null;r+=2,r+=t.getUint16(r,o)}return null}function q(){const e=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)e.add(n);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function g(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function z(e,t){const{mimeType:n}=y(e)||{},a=globalThis.loaders?.parseImageNode;return w(a),await a(e,n)}async function H(e,t,n){t=t||{};const i=(t.image||{}).type||"auto",{url:r}=n||{},s=K(i);let c;switch(s){case"imagebitmap":c=await P(e,t,r);break;case"image":c=await I(e,t,r);break;case"data":c=await z(e);break;default:w(!1)}return i==="data"&&(c=S(c)),c}function K(e){switch(e){case"auto":case"data":return D();default:return E(e),e}}const Q=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],W=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Z={image:{type:"auto",decode:!0}},te={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:b,mimeTypes:W,extensions:Q,parse:H,tests:[e=>!!y(new DataView(e))],options:Z};export{te as I,S as a,y as g};
//# sourceMappingURL=image-loader-hHJsndO6.js.map
