{"version":3,"file":"mapbox.js","sources":["../../../node_modules/.pnpm/@deck.gl+mapbox@9.2.6_@deck.gl+core@9.2.6_@luma.gl+constants@9.2.6_@luma.gl+core@9.2.6_@math.gl+web-mercator@4.1.0/node_modules/@deck.gl/mapbox/dist/deck-utils.js","../../../node_modules/.pnpm/@deck.gl+mapbox@9.2.6_@deck.gl+core@9.2.6_@luma.gl+constants@9.2.6_@luma.gl+core@9.2.6_@math.gl+web-mercator@4.1.0/node_modules/@deck.gl/mapbox/dist/mapbox-layer.js","../../../node_modules/.pnpm/@deck.gl+mapbox@9.2.6_@deck.gl+core@9.2.6_@luma.gl+constants@9.2.6_@luma.gl+core@9.2.6_@math.gl+web-mercator@4.1.0/node_modules/@deck.gl/mapbox/dist/resolve-layers.js","../../../node_modules/.pnpm/@deck.gl+mapbox@9.2.6_@deck.gl+core@9.2.6_@luma.gl+constants@9.2.6_@luma.gl+core@9.2.6_@math.gl+web-mercator@4.1.0/node_modules/@deck.gl/mapbox/dist/mapbox-layer-group.js","../../../node_modules/.pnpm/@deck.gl+mapbox@9.2.6_@deck.gl+core@9.2.6_@luma.gl+constants@9.2.6_@luma.gl+core@9.2.6_@math.gl+web-mercator@4.1.0/node_modules/@deck.gl/mapbox/dist/resolve-layer-groups.js","../../../node_modules/.pnpm/@deck.gl+mapbox@9.2.6_@deck.gl+core@9.2.6_@luma.gl+constants@9.2.6_@luma.gl+core@9.2.6_@math.gl+web-mercator@4.1.0/node_modules/@deck.gl/mapbox/dist/mapbox-overlay.js"],"sourcesContent":["// deck.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\nimport { Deck, MapView, _GlobeView as GlobeView, _flatten as flatten } from '@deck.gl/core';\nimport { lngLatToWorld, unitsPerMeter } from '@math.gl/web-mercator';\nconst MAPBOX_VIEW_ID = 'mapbox';\n// Mercator constants\nconst TILE_SIZE = 512;\nconst DEGREES_TO_RADIANS = Math.PI / 180;\n// Create an interleaved deck instance.\nexport function getDeckInstance({ map, gl, deck }) {\n    // Only create one deck instance per context\n    if (map.__deck) {\n        return map.__deck;\n    }\n    // Only initialize certain props once per context\n    const customRender = deck?.props._customRender;\n    const onLoad = deck?.props.onLoad;\n    const deckProps = {\n        ...deck?.props,\n        _customRender: () => {\n            map.triggerRepaint();\n            // customRender may be subscribed by DeckGL React component to update child props\n            // make sure it is still called\n            // Hack - do not pass a redraw reason here to prevent the React component from clearing the context\n            // Rerender will be triggered by MapboxLayer's render()\n            customRender?.('');\n        }\n    };\n    deckProps.parameters = { ...getDefaultParameters(map, true), ...deckProps.parameters };\n    deckProps.views || (deckProps.views = getDefaultView(map));\n    let deckInstance;\n    if (!deck || deck.props.gl === gl) {\n        // If deck isn't defined (Internal MapboxLayer use case),\n        // or if deck is defined and is using the WebGLContext created by mapbox (MapboxOverlay and External MapboxLayer use case),\n        // block deck from setting the canvas size, and use the map's viewState to drive deck.\n        // Otherwise, we use deck's viewState to drive the map.\n        Object.assign(deckProps, {\n            gl,\n            width: null,\n            height: null,\n            touchAction: 'unset',\n            viewState: getViewState(map)\n        });\n        if (deck?.isInitialized) {\n            watchMapMove(deck, map);\n        }\n        else {\n            deckProps.onLoad = () => {\n                onLoad?.();\n                watchMapMove(deckInstance, map);\n            };\n        }\n    }\n    if (deck) {\n        deckInstance = deck;\n        deck.setProps(deckProps);\n        deck.userData.isExternal = true;\n    }\n    else {\n        deckInstance = new Deck(deckProps);\n        map.on('remove', () => {\n            removeDeckInstance(map);\n        });\n    }\n    deckInstance.userData.mapboxLayers = new Set();\n    // (deckInstance.userData as UserData).mapboxVersion = getMapboxVersion(map);\n    map.__deck = deckInstance;\n    map.on('render', () => {\n        if (deckInstance.isInitialized)\n            afterRender(deckInstance, map);\n    });\n    return deckInstance;\n}\nfunction watchMapMove(deck, map) {\n    const _handleMapMove = () => {\n        if (deck.isInitialized) {\n            // call view state methods\n            onMapMove(deck, map);\n        }\n        else {\n            // deregister itself when deck is finalized\n            map.off('move', _handleMapMove);\n        }\n    };\n    map.on('move', _handleMapMove);\n}\nexport function removeDeckInstance(map) {\n    map.__deck?.finalize();\n    map.__deck = null;\n}\nexport function getDefaultParameters(map, interleaved) {\n    const result = interleaved\n        ? {\n            depthWriteEnabled: true,\n            depthCompare: 'less-equal',\n            depthBias: 0,\n            blend: true,\n            blendColorSrcFactor: 'src-alpha',\n            blendColorDstFactor: 'one-minus-src-alpha',\n            blendAlphaSrcFactor: 'one',\n            blendAlphaDstFactor: 'one-minus-src-alpha',\n            blendColorOperation: 'add',\n            blendAlphaOperation: 'add'\n        }\n        : {};\n    if (getProjection(map) === 'globe') {\n        result.cullMode = 'back';\n    }\n    return result;\n}\nexport function addLayer(deck, layer) {\n    deck.userData.mapboxLayers.add(layer);\n    updateLayers(deck);\n}\nexport function removeLayer(deck, layer) {\n    deck.userData.mapboxLayers.delete(layer);\n    updateLayers(deck);\n}\nexport function updateLayer(deck, layer) {\n    updateLayers(deck);\n}\nexport function drawLayer(deck, map, layer, renderParameters) {\n    let { currentViewport } = deck.userData;\n    let clearStack = false;\n    if (!currentViewport) {\n        // This is the first layer drawn in this render cycle.\n        // Generate viewport from the current map state.\n        currentViewport = getViewport(deck, map, renderParameters);\n        deck.userData.currentViewport = currentViewport;\n        clearStack = true;\n    }\n    if (!deck.isInitialized) {\n        return;\n    }\n    deck._drawLayers('mapbox-repaint', {\n        viewports: [currentViewport],\n        layerFilter: params => (!deck.props.layerFilter || deck.props.layerFilter(params)) &&\n            (layer.id === params.layer.id || params.layer.props.operation.includes('terrain')),\n        clearStack,\n        clearCanvas: false\n    });\n}\nexport function drawLayerGroup(deck, map, group, renderParameters) {\n    let { currentViewport } = deck.userData;\n    let clearStack = false;\n    if (!currentViewport) {\n        // This is the first layer drawn in this render cycle.\n        // Generate viewport from the current map state.\n        currentViewport = getViewport(deck, map, renderParameters);\n        deck.userData.currentViewport = currentViewport;\n        clearStack = true;\n    }\n    if (!deck.isInitialized) {\n        return;\n    }\n    deck._drawLayers('mapbox-repaint', {\n        viewports: [currentViewport],\n        layerFilter: params => {\n            if (deck.props.layerFilter && !deck.props.layerFilter(params)) {\n                return false;\n            }\n            const layer = params.layer;\n            if (layer.props.beforeId === group.beforeId && layer.props.slot === group.slot) {\n                return true;\n            }\n            return false;\n        },\n        clearStack,\n        clearCanvas: false\n    });\n}\nexport function getProjection(map) {\n    const projection = map.getProjection?.();\n    const type = \n    // maplibre projection spec\n    projection?.type ||\n        // mapbox projection spec\n        projection?.name;\n    if (type === 'globe') {\n        return 'globe';\n    }\n    if (type && type !== 'mercator') {\n        throw new Error('Unsupported projection');\n    }\n    return 'mercator';\n}\nexport function getDefaultView(map) {\n    if (getProjection(map) === 'globe') {\n        return new GlobeView({ id: MAPBOX_VIEW_ID });\n    }\n    return new MapView({ id: MAPBOX_VIEW_ID });\n}\nexport function getViewState(map) {\n    const { lng, lat } = map.getCenter();\n    const viewState = {\n        // Longitude returned by getCenter can be outside of [-180, 180] when zooming near the anti meridian\n        // https://github.com/visgl/deck.gl/issues/6894\n        longitude: ((lng + 540) % 360) - 180,\n        latitude: lat,\n        zoom: map.getZoom(),\n        bearing: map.getBearing(),\n        pitch: map.getPitch(),\n        padding: map.getPadding(),\n        repeat: map.getRenderWorldCopies()\n    };\n    if (map.getTerrain?.()) {\n        // When the base map has terrain, we need to target the camera at the terrain surface\n        centerCameraOnTerrain(map, viewState);\n    }\n    return viewState;\n}\nfunction centerCameraOnTerrain(map, viewState) {\n    if (map.getFreeCameraOptions) {\n        // mapbox-gl v2\n        const { position } = map.getFreeCameraOptions();\n        if (!position || position.z === undefined) {\n            return;\n        }\n        // @ts-ignore transform is not typed\n        const height = map.transform.height;\n        const { longitude, latitude, pitch } = viewState;\n        // Convert mapbox mercator coordinate to deck common space\n        const cameraX = position.x * TILE_SIZE;\n        const cameraY = (1 - position.y) * TILE_SIZE;\n        const cameraZ = position.z * TILE_SIZE;\n        // Mapbox manipulates zoom in terrain mode, see discussion here: https://github.com/mapbox/mapbox-gl-js/issues/12040\n        const center = lngLatToWorld([longitude, latitude]);\n        const dx = cameraX - center[0];\n        const dy = cameraY - center[1];\n        const cameraToCenterDistanceGround = Math.sqrt(dx * dx + dy * dy);\n        const pitchRadians = pitch * DEGREES_TO_RADIANS;\n        const altitudePixels = 1.5 * height;\n        const scale = pitchRadians < 0.001\n            ? // Pitch angle too small to deduce the look at point, assume elevation is 0\n                (altitudePixels * Math.cos(pitchRadians)) / cameraZ\n            : (altitudePixels * Math.sin(pitchRadians)) / cameraToCenterDistanceGround;\n        viewState.zoom = Math.log2(scale);\n        const cameraZFromSurface = (altitudePixels * Math.cos(pitchRadians)) / scale;\n        const surfaceElevation = cameraZ - cameraZFromSurface;\n        viewState.position = [0, 0, surfaceElevation / unitsPerMeter(latitude)];\n    }\n    // @ts-ignore transform is not typed\n    else if (typeof map.transform.elevation === 'number') {\n        // maplibre-gl\n        // @ts-ignore transform is not typed\n        viewState.position = [0, 0, map.transform.elevation];\n    }\n}\nfunction getViewport(deck, map, renderParameters) {\n    const viewState = getViewState(map);\n    const { views } = deck.props;\n    const view = (views && flatten(views).find((v) => v.id === MAPBOX_VIEW_ID)) ||\n        getDefaultView(map);\n    if (renderParameters) {\n        // Called from MapboxLayer.render\n        // Magic number, matches mapbox-gl@>=1.3.0's projection matrix\n        view.props.nearZMultiplier = 0.2;\n    }\n    // Get the base map near/far plane\n    // renderParameters is maplibre API but not mapbox\n    // Transform is not an official API, properties could be undefined for older versions\n    const nearZ = renderParameters?.nearZ ?? map.transform._nearZ;\n    const farZ = renderParameters?.farZ ?? map.transform._farZ;\n    if (Number.isFinite(nearZ)) {\n        viewState.nearZ = nearZ / map.transform.height;\n        viewState.farZ = farZ / map.transform.height;\n    }\n    // Otherwise fallback to default calculation using nearZMultiplier/farZMultiplier\n    return view.makeViewport({\n        width: deck.width,\n        height: deck.height,\n        viewState\n    });\n}\nfunction afterRender(deck, map) {\n    const { mapboxLayers, isExternal } = deck.userData;\n    if (isExternal) {\n        // Draw non-Mapbox layers\n        const mapboxLayerIds = Array.from(mapboxLayers, layer => layer.id);\n        const deckLayers = flatten(deck.props.layers, Boolean);\n        const hasNonMapboxLayers = deckLayers.some(layer => layer && !mapboxLayerIds.includes(layer.id));\n        let viewports = deck.getViewports();\n        const mapboxViewportIdx = viewports.findIndex(vp => vp.id === MAPBOX_VIEW_ID);\n        const hasNonMapboxViews = viewports.length > 1 || mapboxViewportIdx < 0;\n        if (hasNonMapboxLayers || hasNonMapboxViews) {\n            if (mapboxViewportIdx >= 0) {\n                viewports = viewports.slice();\n                viewports[mapboxViewportIdx] = getViewport(deck, map);\n            }\n            deck._drawLayers('mapbox-repaint', {\n                viewports,\n                layerFilter: params => (!deck.props.layerFilter || deck.props.layerFilter(params)) &&\n                    (params.viewport.id !== MAPBOX_VIEW_ID || !mapboxLayerIds.includes(params.layer.id)),\n                clearCanvas: false\n            });\n        }\n    }\n    // End of render cycle, clear generated viewport\n    deck.userData.currentViewport = null;\n}\nfunction onMapMove(deck, map) {\n    deck.setProps({\n        viewState: getViewState(map)\n    });\n    // Camera changed, will trigger a map repaint right after this\n    // Clear any change flag triggered by setting viewState so that deck does not request\n    // a second repaint\n    deck.needsRedraw({ clearRedrawFlags: true });\n}\nfunction updateLayers(deck) {\n    if (deck.userData.isExternal) {\n        return;\n    }\n    const layers = [];\n    deck.userData.mapboxLayers.forEach(deckLayer => {\n        const LayerType = deckLayer.props.type;\n        const layer = new LayerType(deckLayer.props);\n        layers.push(layer);\n    });\n    deck.setProps({ layers });\n}\n//# sourceMappingURL=deck-utils.js.map","// deck.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\nimport { getDeckInstance, addLayer, removeLayer, updateLayer, drawLayer } from \"./deck-utils.js\";\nexport default class MapboxLayer {\n    /* eslint-disable no-this-before-super */\n    constructor(props) {\n        if (!props.id) {\n            throw new Error('Layer must have an unique id');\n        }\n        this.id = props.id;\n        this.type = 'custom';\n        this.renderingMode = props.renderingMode || '3d';\n        this.slot = props.slot;\n        this.map = null;\n        this.deck = null;\n        this.props = props;\n    }\n    /* Mapbox custom layer methods */\n    onAdd(map, gl) {\n        this.map = map;\n        this.deck = getDeckInstance({ map, gl, deck: this.props.deck });\n        addLayer(this.deck, this);\n    }\n    onRemove() {\n        if (this.deck) {\n            removeLayer(this.deck, this);\n        }\n    }\n    setProps(props) {\n        // id cannot be changed\n        Object.assign(this.props, props, { id: this.id });\n        // safe guard in case setProps is called before onAdd\n        if (this.deck) {\n            updateLayer(this.deck, this);\n        }\n    }\n    render(gl, renderParameters) {\n        drawLayer(this.deck, this.map, this, renderParameters);\n    }\n}\n//# sourceMappingURL=mapbox-layer.js.map","// deck.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\nimport { _flatten as flatten } from '@deck.gl/core';\nimport MapboxLayer from \"./mapbox-layer.js\";\nconst UNDEFINED_BEFORE_ID = '__UNDEFINED__';\n/** Insert Deck layers into the mapbox Map according to the user-defined order */\n// eslint-disable-next-line complexity, max-statements\nexport function resolveLayers(map, deck, oldLayers, newLayers) {\n    // Wait until map style is loaded\n    // @ts-ignore non-public map property\n    if (!map || !deck || !map.style || !map.style._loaded) {\n        return;\n    }\n    const layers = flatten(newLayers, Boolean);\n    if (oldLayers !== newLayers) {\n        // Step 1: remove layers that no longer exist\n        const prevLayers = flatten(oldLayers, Boolean);\n        const prevLayerIds = new Set(prevLayers.map(l => l.id));\n        for (const layer of layers) {\n            prevLayerIds.delete(layer.id);\n        }\n        for (const id of prevLayerIds) {\n            if (map.getLayer(id)) {\n                map.removeLayer(id);\n            }\n        }\n    }\n    // Step 2: add missing layers\n    for (const layer of layers) {\n        const mapboxLayer = map.getLayer(layer.id);\n        if (mapboxLayer) {\n            // Mapbox's map.getLayer() had a breaking change in v3.6.0, see https://github.com/visgl/deck.gl/issues/9086\n            // @ts-expect-error not typed\n            const layerInstance = mapboxLayer.implementation || mapboxLayer;\n            layerInstance.setProps(layer.props);\n        }\n        else {\n            map.addLayer(new MapboxLayer({\n                id: layer.id,\n                deck,\n                // @ts-expect-error slot is not defined in LayerProps\n                slot: layer.props.slot\n            }), \n            // @ts-expect-error beforeId is not defined in LayerProps\n            layer.props.beforeId);\n        }\n    }\n    // Step 3: check the order of layers\n    // If beforeId is defined, the deck layer should always render before the mapbox layer [beforeId]\n    // If beforeId is not defined, the deck layer should appear after all mapbox layers\n    // When two deck layers share the same beforeId, they are rendered in the order that is passed into Deck props.layers\n    // @ts-ignore non-public map property\n    const mapLayers = map.style._order;\n    // Group deck layers by beforeId\n    const layerGroups = {};\n    for (const layer of layers) {\n        // @ts-expect-error beforeId is not defined in LayerProps\n        let { beforeId } = layer.props;\n        if (!beforeId || !mapLayers.includes(beforeId)) {\n            beforeId = UNDEFINED_BEFORE_ID;\n        }\n        layerGroups[beforeId] = layerGroups[beforeId] || [];\n        layerGroups[beforeId].push(layer.id);\n    }\n    for (const beforeId in layerGroups) {\n        const layerGroup = layerGroups[beforeId];\n        let lastLayerIndex = beforeId === UNDEFINED_BEFORE_ID ? mapLayers.length : mapLayers.indexOf(beforeId);\n        let lastLayerId = beforeId === UNDEFINED_BEFORE_ID ? undefined : beforeId;\n        for (let i = layerGroup.length - 1; i >= 0; i--) {\n            const layerId = layerGroup[i];\n            const layerIndex = mapLayers.indexOf(layerId);\n            if (layerIndex !== lastLayerIndex - 1) {\n                map.moveLayer(layerId, lastLayerId);\n                if (layerIndex > lastLayerIndex) {\n                    // The last layer's index have changed\n                    lastLayerIndex++;\n                }\n            }\n            lastLayerIndex--;\n            lastLayerId = layerId;\n        }\n    }\n}\n//# sourceMappingURL=resolve-layers.js.map","// deck.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\nimport { getDeckInstance, drawLayerGroup } from \"./deck-utils.js\";\nimport { assert } from '@deck.gl/core';\nexport default class MapboxLayerGroup {\n    /* eslint-disable no-this-before-super */\n    constructor(props) {\n        assert(props.id, 'id is required');\n        this.id = props.id;\n        this.type = 'custom';\n        this.renderingMode = props.renderingMode || '3d';\n        this.slot = props.slot;\n        this.beforeId = props.beforeId;\n        this.map = null;\n        this.deck = null;\n    }\n    /* Mapbox custom layer methods */\n    onAdd(map, gl) {\n        this.map = map;\n        this.deck = getDeckInstance({ map, gl });\n    }\n    render(gl, renderParameters) {\n        if (!this.deck || !this.map)\n            return;\n        drawLayerGroup(this.deck, this.map, this, renderParameters);\n    }\n}\n//# sourceMappingURL=mapbox-layer-group.js.map","// deck.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\nimport { _flatten as flatten } from '@deck.gl/core';\nimport MapboxLayerGroup from \"./mapbox-layer-group.js\";\nconst UNDEFINED_BEFORE_ID = '__UNDEFINED__';\nfunction getLayerGroupId(layer) {\n    if (layer.props.beforeId) {\n        return `deck-layer-group-before:${layer.props.beforeId}`;\n    }\n    else if (layer.props.slot) {\n        return `deck-layer-group-slot:${layer.props.slot}`;\n    }\n    return 'deck-layer-group-last';\n}\n/** Group Deck layers into buckets (by beforeId or slot) and insert them\n *  into the mapbox Map according to the user-defined order\n **/\n// eslint-disable-next-line complexity, max-statements\nexport function resolveLayerGroups(map, oldLayers, newLayers) {\n    // Wait until map style is loaded\n    // @ts-ignore non-public map property\n    if (!map || !map.style || !map.style._loaded) {\n        return;\n    }\n    const layers = flatten(newLayers, Boolean);\n    if (oldLayers !== newLayers) {\n        // Step 1: remove \"group\" layers that no longer exist\n        const prevLayers = flatten(oldLayers, Boolean);\n        const prevLayerGroupIds = new Set(prevLayers.map(l => getLayerGroupId(l)));\n        const newLayerGroupIds = new Set(layers.map(l => getLayerGroupId(l)));\n        for (const groupId of prevLayerGroupIds) {\n            if (!newLayerGroupIds.has(groupId)) {\n                if (map.getLayer(groupId)) {\n                    map.removeLayer(groupId);\n                }\n            }\n        }\n    }\n    // Step 2: add missing \"group\" layers\n    const layerGroups = {};\n    for (const layer of layers) {\n        const groupId = getLayerGroupId(layer);\n        const mapboxGroup = map.getLayer(groupId);\n        if (mapboxGroup) {\n            // Mapbox's map.getLayer() had a breaking change in v3.6.0, see https://github.com/visgl/deck.gl/issues/9086\n            // @ts-expect-error not typed\n            const groupInstance = mapboxGroup.implementation || mapboxGroup;\n            layerGroups[groupId] = groupInstance;\n        }\n        else {\n            const newGroup = new MapboxLayerGroup({\n                id: groupId,\n                slot: layer.props.slot,\n                beforeId: layer.props.beforeId\n            });\n            layerGroups[groupId] = newGroup;\n            map.addLayer(newGroup, layer.props.beforeId);\n        }\n    }\n    // Step 3: check the order of layers\n    // If beforeId move \"group\" layers to proper position in the mapbox layer order\n    // @ts-ignore non-public map property\n    const mapLayers = map.style._order;\n    for (const [groupId, group] of Object.entries(layerGroups)) {\n        const beforeId = group.beforeId || UNDEFINED_BEFORE_ID;\n        const expectedGroupIndex = beforeId === UNDEFINED_BEFORE_ID ? mapLayers.length : mapLayers.indexOf(beforeId);\n        const currentGropupIndex = mapLayers.indexOf(groupId);\n        if (currentGropupIndex !== expectedGroupIndex - 1) {\n            const moveBeforeId = beforeId === UNDEFINED_BEFORE_ID ? undefined : beforeId;\n            map.moveLayer(groupId, moveBeforeId);\n        }\n    }\n}\n//# sourceMappingURL=resolve-layer-groups.js.map","// deck.gl\n// SPDX-License-Identifier: MIT\n// Copyright (c) vis.gl contributors\nimport { Deck, assert } from '@deck.gl/core';\nimport { getViewState, getDefaultView, getDeckInstance, removeDeckInstance, getDefaultParameters, getProjection } from \"./deck-utils.js\";\nimport { log } from '@deck.gl/core';\nimport { resolveLayers } from \"./resolve-layers.js\";\nimport { resolveLayerGroups } from \"./resolve-layer-groups.js\";\n/**\n * Implements Mapbox [IControl](https://docs.mapbox.com/mapbox-gl-js/api/markers/#icontrol) interface\n * Renders deck.gl layers over the base map and automatically synchronizes with the map's camera\n */\nexport default class MapboxOverlay {\n    constructor(props) {\n        this._handleStyleChange = () => {\n            this._resolveLayers(this._map, this._deck, this._props.layers, this._props.layers);\n            if (!this._map)\n                return;\n            // getProjection() returns undefined before style is loaded\n            const projection = getProjection(this._map);\n            if (projection && !this._props.views) {\n                this._deck?.setProps({ views: getDefaultView(this._map) });\n            }\n        };\n        this._updateContainerSize = () => {\n            if (this._map && this._container) {\n                const { clientWidth, clientHeight } = this._map.getContainer();\n                Object.assign(this._container.style, {\n                    width: `${clientWidth}px`,\n                    height: `${clientHeight}px`\n                });\n            }\n        };\n        this._updateViewState = () => {\n            const deck = this._deck;\n            const map = this._map;\n            if (deck && map) {\n                deck.setProps({\n                    views: this._props.views || getDefaultView(map),\n                    viewState: getViewState(map)\n                });\n                // Redraw immediately if view state has changed\n                if (deck.isInitialized) {\n                    deck.redraw();\n                }\n            }\n        };\n        // eslint-disable-next-line complexity\n        this._handleMouseEvent = (event) => {\n            const deck = this._deck;\n            if (!deck || !deck.isInitialized) {\n                return;\n            }\n            const mockEvent = {\n                type: event.type,\n                offsetCenter: event.point,\n                srcEvent: event\n            };\n            const lastDown = this._lastMouseDownPoint;\n            if (!event.point && lastDown) {\n                // drag* events do not contain a `point` field\n                mockEvent.deltaX = event.originalEvent.clientX - lastDown.clientX;\n                mockEvent.deltaY = event.originalEvent.clientY - lastDown.clientY;\n                mockEvent.offsetCenter = {\n                    x: lastDown.x + mockEvent.deltaX,\n                    y: lastDown.y + mockEvent.deltaY\n                };\n            }\n            switch (mockEvent.type) {\n                case 'mousedown':\n                    deck._onPointerDown(mockEvent);\n                    this._lastMouseDownPoint = {\n                        ...event.point,\n                        clientX: event.originalEvent.clientX,\n                        clientY: event.originalEvent.clientY\n                    };\n                    break;\n                case 'dragstart':\n                    mockEvent.type = 'panstart';\n                    deck._onEvent(mockEvent);\n                    break;\n                case 'drag':\n                    mockEvent.type = 'panmove';\n                    deck._onEvent(mockEvent);\n                    break;\n                case 'dragend':\n                    mockEvent.type = 'panend';\n                    deck._onEvent(mockEvent);\n                    break;\n                case 'click':\n                    mockEvent.tapCount = 1;\n                    deck._onEvent(mockEvent);\n                    break;\n                case 'dblclick':\n                    mockEvent.type = 'click';\n                    mockEvent.tapCount = 2;\n                    deck._onEvent(mockEvent);\n                    break;\n                case 'mousemove':\n                    mockEvent.type = 'pointermove';\n                    deck._onPointerMove(mockEvent);\n                    break;\n                case 'mouseout':\n                    mockEvent.type = 'pointerleave';\n                    deck._onPointerMove(mockEvent);\n                    break;\n                default:\n                    return;\n            }\n        };\n        const { interleaved = false } = props;\n        this._interleaved = interleaved;\n        this._renderLayersInGroups = props._renderLayersInGroups || false;\n        this._props = this.filterProps(props);\n    }\n    /** Filter out props to pass to Deck **/\n    filterProps(props) {\n        const { interleaved = false, useDevicePixels, ...deckProps } = props;\n        if (!interleaved && useDevicePixels !== undefined) {\n            // useDevicePixels cannot be used in interleaved mode\n            deckProps.useDevicePixels = useDevicePixels;\n        }\n        return deckProps;\n    }\n    /** Update (partial) props of the underlying Deck instance. */\n    setProps(props) {\n        if (this._interleaved && props.layers) {\n            this._resolveLayers(this._map, this._deck, this._props.layers, props.layers);\n        }\n        Object.assign(this._props, this.filterProps(props));\n        if (this._deck && this._map) {\n            this._deck.setProps({\n                ...this._props,\n                parameters: {\n                    ...getDefaultParameters(this._map, this._interleaved),\n                    ...this._props.parameters\n                }\n            });\n        }\n    }\n    // The local Map type is for internal typecheck only. It does not necesarily satisefy mapbox/maplibre types at runtime.\n    // Do not restrict the argument type here to avoid type conflict.\n    /** Called when the control is added to a map */\n    onAdd(map) {\n        this._map = map;\n        return this._interleaved ? this._onAddInterleaved(map) : this._onAddOverlaid(map);\n    }\n    _onAddOverlaid(map) {\n        /* global document */\n        const container = document.createElement('div');\n        Object.assign(container.style, {\n            position: 'absolute',\n            left: 0,\n            top: 0,\n            textAlign: 'initial',\n            pointerEvents: 'none'\n        });\n        this._container = container;\n        this._deck = new Deck({\n            ...this._props,\n            parent: container,\n            parameters: { ...getDefaultParameters(map, false), ...this._props.parameters },\n            views: this._props.views || getDefaultView(map),\n            viewState: getViewState(map)\n        });\n        map.on('resize', this._updateContainerSize);\n        map.on('render', this._updateViewState);\n        map.on('mousedown', this._handleMouseEvent);\n        map.on('dragstart', this._handleMouseEvent);\n        map.on('drag', this._handleMouseEvent);\n        map.on('dragend', this._handleMouseEvent);\n        map.on('mousemove', this._handleMouseEvent);\n        map.on('mouseout', this._handleMouseEvent);\n        map.on('click', this._handleMouseEvent);\n        map.on('dblclick', this._handleMouseEvent);\n        this._updateContainerSize();\n        return container;\n    }\n    _onAddInterleaved(map) {\n        // @ts-ignore non-public map property\n        const gl = map.painter.context.gl;\n        if (gl instanceof WebGLRenderingContext) {\n            log.warn('Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility')();\n        }\n        this._deck = getDeckInstance({\n            map,\n            gl,\n            deck: new Deck({\n                ...this._props,\n                gl,\n                parameters: { ...getDefaultParameters(map, true), ...this._props.parameters }\n            })\n        });\n        map.on('styledata', this._handleStyleChange);\n        this._resolveLayers(map, this._deck, [], this._props.layers);\n        return document.createElement('div');\n    }\n    _resolveLayers(map, deck, prevLayers, newLayers) {\n        if (this._renderLayersInGroups) {\n            resolveLayerGroups(map, prevLayers, newLayers);\n        }\n        else {\n            resolveLayers(map, deck, prevLayers, newLayers);\n        }\n    }\n    /** Called when the control is removed from a map */\n    onRemove() {\n        const map = this._map;\n        if (map) {\n            if (this._interleaved) {\n                this._onRemoveInterleaved(map);\n            }\n            else {\n                this._onRemoveOverlaid(map);\n            }\n        }\n        this._deck = undefined;\n        this._map = undefined;\n        this._container = undefined;\n    }\n    _onRemoveOverlaid(map) {\n        map.off('resize', this._updateContainerSize);\n        map.off('render', this._updateViewState);\n        map.off('mousedown', this._handleMouseEvent);\n        map.off('dragstart', this._handleMouseEvent);\n        map.off('drag', this._handleMouseEvent);\n        map.off('dragend', this._handleMouseEvent);\n        map.off('mousemove', this._handleMouseEvent);\n        map.off('mouseout', this._handleMouseEvent);\n        map.off('click', this._handleMouseEvent);\n        map.off('dblclick', this._handleMouseEvent);\n        this._deck?.finalize();\n    }\n    _onRemoveInterleaved(map) {\n        map.off('styledata', this._handleStyleChange);\n        this._resolveLayers(map, this._deck, this._props.layers, []);\n        removeDeckInstance(map);\n    }\n    getDefaultPosition() {\n        return 'top-left';\n    }\n    /** Forwards the Deck.pickObject method */\n    pickObject(params) {\n        assert(this._deck);\n        return this._deck.pickObject(params);\n    }\n    /** Forwards the Deck.pickMultipleObjects method */\n    pickMultipleObjects(params) {\n        assert(this._deck);\n        return this._deck.pickMultipleObjects(params);\n    }\n    /** Forwards the Deck.pickObjects method */\n    pickObjects(params) {\n        assert(this._deck);\n        return this._deck.pickObjects(params);\n    }\n    /** Remove from map and releases all resources */\n    finalize() {\n        if (this._map) {\n            this._map.removeControl(this);\n        }\n    }\n    /** If interleaved: true, returns base map's canvas, otherwise forwards the Deck.getCanvas method. */\n    getCanvas() {\n        if (!this._map) {\n            return null;\n        }\n        return this._interleaved ? this._map.getCanvas() : this._deck.getCanvas();\n    }\n}\n//# sourceMappingURL=mapbox-overlay.js.map"],"names":["MAPBOX_VIEW_ID","TILE_SIZE","DEGREES_TO_RADIANS","getDeckInstance","map","gl","deck","customRender","onLoad","deckProps","getDefaultParameters","getDefaultView","deckInstance","getViewState","watchMapMove","Deck","removeDeckInstance","afterRender","_handleMapMove","onMapMove","interleaved","result","getProjection","addLayer","layer","updateLayers","removeLayer","updateLayer","drawLayer","renderParameters","currentViewport","clearStack","getViewport","params","drawLayerGroup","group","projection","type","GlobeView","MapView","lng","lat","viewState","centerCameraOnTerrain","position","height","longitude","latitude","pitch","cameraX","cameraY","cameraZ","center","lngLatToWorld","dx","dy","cameraToCenterDistanceGround","pitchRadians","altitudePixels","scale","cameraZFromSurface","surfaceElevation","unitsPerMeter","views","view","flatten","v","nearZ","farZ","mapboxLayers","isExternal","mapboxLayerIds","hasNonMapboxLayers","viewports","mapboxViewportIdx","vp","hasNonMapboxViews","layers","deckLayer","LayerType","MapboxLayer","props","UNDEFINED_BEFORE_ID","resolveLayers","oldLayers","newLayers","prevLayers","prevLayerIds","l","id","mapboxLayer","mapLayers","layerGroups","beforeId","layerGroup","lastLayerIndex","lastLayerId","i","layerId","layerIndex","MapboxLayerGroup","assert","getLayerGroupId","resolveLayerGroups","prevLayerGroupIds","newLayerGroupIds","groupId","mapboxGroup","groupInstance","newGroup","expectedGroupIndex","moveBeforeId","MapboxOverlay","clientWidth","clientHeight","event","mockEvent","lastDown","useDevicePixels","container","log"],"mappings":"gcAKA,MAAMA,EAAiB,SAEjBC,EAAY,IACZC,EAAqB,KAAK,GAAK,IAE9B,SAASC,EAAgB,CAAE,IAAAC,EAAK,GAAAC,EAAI,KAAAC,CAAI,EAAI,CAE/C,GAAIF,EAAI,OACJ,OAAOA,EAAI,OAGf,MAAMG,EAAeD,GAAM,MAAM,cAC3BE,EAASF,GAAM,MAAM,OACrBG,EAAY,CACd,GAAGH,GAAM,MACT,cAAe,IAAM,CACjBF,EAAI,eAAc,EAKlBG,IAAe,EAAE,CACrB,CACR,EACIE,EAAU,WAAa,CAAE,GAAGC,EAAqBN,EAAK,EAAI,EAAG,GAAGK,EAAU,UAAU,EACpFA,EAAU,QAAUA,EAAU,MAAQE,EAAeP,CAAG,GACxD,IAAIQ,EACJ,OAAI,CAACN,GAAQA,EAAK,MAAM,KAAOD,KAK3B,OAAO,OAAOI,EAAW,CACrB,GAAAJ,EACA,MAAO,KACP,OAAQ,KACR,YAAa,QACb,UAAWQ,EAAaT,CAAG,CACvC,CAAS,EACGE,GAAM,cACNQ,EAAaR,EAAMF,CAAG,EAGtBK,EAAU,OAAS,IAAM,CACrBD,IAAM,EACNM,EAAaF,EAAcR,CAAG,CAClC,GAGJE,GACAM,EAAeN,EACfA,EAAK,SAASG,CAAS,EACvBH,EAAK,SAAS,WAAa,KAG3BM,EAAe,IAAIG,EAAKN,CAAS,EACjCL,EAAI,GAAG,SAAU,IAAM,CACnBY,EAAmBZ,CAAG,CAC1B,CAAC,GAELQ,EAAa,SAAS,aAAe,IAAI,IAEzCR,EAAI,OAASQ,EACbR,EAAI,GAAG,SAAU,IAAM,CACfQ,EAAa,eACbK,EAAYL,EAAcR,CAAG,CACrC,CAAC,EACMQ,CACX,CACA,SAASE,EAAaR,EAAMF,EAAK,CAC7B,MAAMc,EAAiB,IAAM,CACrBZ,EAAK,cAELa,EAAUb,EAAMF,CAAG,EAInBA,EAAI,IAAI,OAAQc,CAAc,CAEtC,EACAd,EAAI,GAAG,OAAQc,CAAc,CACjC,CACO,SAASF,EAAmBZ,EAAK,CACpCA,EAAI,QAAQ,SAAQ,EACpBA,EAAI,OAAS,IACjB,CACO,SAASM,EAAqBN,EAAKgB,EAAa,CACnD,MAAMC,EAASD,EACT,CACE,kBAAmB,GACnB,aAAc,aACd,UAAW,EACX,MAAO,GACP,oBAAqB,YACrB,oBAAqB,sBACrB,oBAAqB,MACrB,oBAAqB,sBACrB,oBAAqB,MACrB,oBAAqB,KACjC,EACU,CAAA,EACN,OAAIE,EAAclB,CAAG,IAAM,UACvBiB,EAAO,SAAW,QAEfA,CACX,CACO,SAASE,EAASjB,EAAMkB,EAAO,CAClClB,EAAK,SAAS,aAAa,IAAIkB,CAAK,EACpCC,EAAanB,CAAI,CACrB,CACO,SAASoB,EAAYpB,EAAMkB,EAAO,CACrClB,EAAK,SAAS,aAAa,OAAOkB,CAAK,EACvCC,EAAanB,CAAI,CACrB,CACO,SAASqB,EAAYrB,EAAMkB,EAAO,CACrCC,EAAanB,CAAI,CACrB,CACO,SAASsB,EAAUtB,EAAMF,EAAKoB,EAAOK,EAAkB,CAC1D,GAAI,CAAE,gBAAAC,GAAoBxB,EAAK,SAC3ByB,EAAa,GACZD,IAGDA,EAAkBE,EAAY1B,EAAMF,EAAKyB,CAAgB,EACzDvB,EAAK,SAAS,gBAAkBwB,EAChCC,EAAa,IAEZzB,EAAK,eAGVA,EAAK,YAAY,iBAAkB,CAC/B,UAAW,CAACwB,CAAe,EAC3B,YAAaG,IAAW,CAAC3B,EAAK,MAAM,aAAeA,EAAK,MAAM,YAAY2B,CAAM,KAC3ET,EAAM,KAAOS,EAAO,MAAM,IAAMA,EAAO,MAAM,MAAM,UAAU,SAAS,SAAS,GACpF,WAAAF,EACA,YAAa,EACrB,CAAK,CACL,CACO,SAASG,EAAe5B,EAAMF,EAAK+B,EAAON,EAAkB,CAC/D,GAAI,CAAE,gBAAAC,GAAoBxB,EAAK,SAC3ByB,EAAa,GACZD,IAGDA,EAAkBE,EAAY1B,EAAMF,EAAKyB,CAAgB,EACzDvB,EAAK,SAAS,gBAAkBwB,EAChCC,EAAa,IAEZzB,EAAK,eAGVA,EAAK,YAAY,iBAAkB,CAC/B,UAAW,CAACwB,CAAe,EAC3B,YAAaG,GAAU,CACnB,GAAI3B,EAAK,MAAM,aAAe,CAACA,EAAK,MAAM,YAAY2B,CAAM,EACxD,MAAO,GAEX,MAAMT,EAAQS,EAAO,MACrB,OAAIT,EAAM,MAAM,WAAaW,EAAM,UAAYX,EAAM,MAAM,OAASW,EAAM,IAI9E,EACA,WAAAJ,EACA,YAAa,EACrB,CAAK,CACL,CACO,SAAST,EAAclB,EAAK,CAC/B,MAAMgC,EAAahC,EAAI,gBAAa,EAC9BiC,EAEND,GAAY,MAERA,GAAY,KAChB,GAAIC,IAAS,QACT,MAAO,QAEX,GAAIA,GAAQA,IAAS,WACjB,MAAM,IAAI,MAAM,wBAAwB,EAE5C,MAAO,UACX,CACO,SAAS1B,EAAeP,EAAK,CAChC,OAAIkB,EAAclB,CAAG,IAAM,QAChB,IAAIkC,EAAU,CAAE,GAAItC,CAAc,CAAE,EAExC,IAAIuC,EAAQ,CAAE,GAAIvC,CAAc,CAAE,CAC7C,CACO,SAASa,EAAaT,EAAK,CAC9B,KAAM,CAAE,IAAAoC,EAAK,IAAAC,GAAQrC,EAAI,UAAS,EAC5BsC,EAAY,CAGd,WAAaF,EAAM,KAAO,IAAO,IACjC,SAAUC,EACV,KAAMrC,EAAI,QAAO,EACjB,QAASA,EAAI,WAAU,EACvB,MAAOA,EAAI,SAAQ,EACnB,QAASA,EAAI,WAAU,EACvB,OAAQA,EAAI,qBAAoB,CACxC,EACI,OAAIA,EAAI,gBAEJuC,EAAsBvC,EAAKsC,CAAS,EAEjCA,CACX,CACA,SAASC,EAAsBvC,EAAKsC,EAAW,CAC3C,GAAItC,EAAI,qBAAsB,CAE1B,KAAM,CAAE,SAAAwC,CAAQ,EAAKxC,EAAI,qBAAoB,EAC7C,GAAI,CAACwC,GAAYA,EAAS,IAAM,OAC5B,OAGJ,MAAMC,EAASzC,EAAI,UAAU,OACvB,CAAE,UAAA0C,EAAW,SAAAC,EAAU,MAAAC,CAAK,EAAKN,EAEjCO,EAAUL,EAAS,EAAI3C,EACvBiD,GAAW,EAAIN,EAAS,GAAK3C,EAC7BkD,EAAUP,EAAS,EAAI3C,EAEvBmD,EAASC,EAAc,CAACP,EAAWC,CAAQ,CAAC,EAC5CO,EAAKL,EAAUG,EAAO,CAAC,EACvBG,EAAKL,EAAUE,EAAO,CAAC,EACvBI,EAA+B,KAAK,KAAKF,EAAKA,EAAKC,EAAKA,CAAE,EAC1DE,EAAeT,EAAQ9C,EACvBwD,EAAiB,IAAMb,EACvBc,EAAQF,EAAe,KAEpBC,EAAiB,KAAK,IAAID,CAAY,EAAKN,EAC7CO,EAAiB,KAAK,IAAID,CAAY,EAAKD,EAClDd,EAAU,KAAO,KAAK,KAAKiB,CAAK,EAChC,MAAMC,EAAsBF,EAAiB,KAAK,IAAID,CAAY,EAAKE,EACjEE,EAAmBV,EAAUS,EACnClB,EAAU,SAAW,CAAC,EAAG,EAAGmB,EAAmBC,EAAcf,CAAQ,CAAC,CAC1E,MAES,OAAO3C,EAAI,UAAU,WAAc,WAGxCsC,EAAU,SAAW,CAAC,EAAG,EAAGtC,EAAI,UAAU,SAAS,EAE3D,CACA,SAAS4B,EAAY1B,EAAMF,EAAKyB,EAAkB,CAC9C,MAAMa,EAAY7B,EAAaT,CAAG,EAC5B,CAAE,MAAA2D,GAAUzD,EAAK,MACjB0D,EAAQD,GAASE,EAAQF,CAAK,EAAE,KAAMG,GAAMA,EAAE,KAAOlE,CAAc,GACrEW,EAAeP,CAAG,EAClByB,IAGAmC,EAAK,MAAM,gBAAkB,IAKjC,MAAMG,EAAQtC,GAAkB,OAASzB,EAAI,UAAU,OACjDgE,EAAOvC,GAAkB,MAAQzB,EAAI,UAAU,MACrD,OAAI,OAAO,SAAS+D,CAAK,IACrBzB,EAAU,MAAQyB,EAAQ/D,EAAI,UAAU,OACxCsC,EAAU,KAAO0B,EAAOhE,EAAI,UAAU,QAGnC4D,EAAK,aAAa,CACrB,MAAO1D,EAAK,MACZ,OAAQA,EAAK,OACb,UAAAoC,CACR,CAAK,CACL,CACA,SAASzB,EAAYX,EAAMF,EAAK,CAC5B,KAAM,CAAE,aAAAiE,EAAc,WAAAC,CAAU,EAAKhE,EAAK,SAC1C,GAAIgE,EAAY,CAEZ,MAAMC,EAAiB,MAAM,KAAKF,EAAc7C,GAASA,EAAM,EAAE,EAE3DgD,EADaP,EAAQ3D,EAAK,MAAM,OAAQ,OAAO,EACf,KAAKkB,GAASA,GAAS,CAAC+C,EAAe,SAAS/C,EAAM,EAAE,CAAC,EAC/F,IAAIiD,EAAYnE,EAAK,aAAY,EACjC,MAAMoE,EAAoBD,EAAU,UAAUE,GAAMA,EAAG,KAAO3E,CAAc,EACtE4E,EAAoBH,EAAU,OAAS,GAAKC,EAAoB,GAClEF,GAAsBI,KAClBF,GAAqB,IACrBD,EAAYA,EAAU,MAAK,EAC3BA,EAAUC,CAAiB,EAAI1C,EAAY1B,EAAMF,CAAG,GAExDE,EAAK,YAAY,iBAAkB,CAC/B,UAAAmE,EACA,YAAaxC,IAAW,CAAC3B,EAAK,MAAM,aAAeA,EAAK,MAAM,YAAY2B,CAAM,KAC3EA,EAAO,SAAS,KAAOjC,GAAkB,CAACuE,EAAe,SAAStC,EAAO,MAAM,EAAE,GACtF,YAAa,EAC7B,CAAa,EAET,CAEA3B,EAAK,SAAS,gBAAkB,IACpC,CACA,SAASa,EAAUb,EAAMF,EAAK,CAC1BE,EAAK,SAAS,CACV,UAAWO,EAAaT,CAAG,CACnC,CAAK,EAIDE,EAAK,YAAY,CAAE,iBAAkB,EAAI,CAAE,CAC/C,CACA,SAASmB,EAAanB,EAAM,CACxB,GAAIA,EAAK,SAAS,WACd,OAEJ,MAAMuE,EAAS,CAAA,EACfvE,EAAK,SAAS,aAAa,QAAQwE,GAAa,CAC5C,MAAMC,EAAYD,EAAU,MAAM,KAC5BtD,EAAQ,IAAIuD,EAAUD,EAAU,KAAK,EAC3CD,EAAO,KAAKrD,CAAK,CACrB,CAAC,EACDlB,EAAK,SAAS,CAAE,OAAAuE,EAAQ,CAC5B,CC7Te,MAAMG,CAAY,CAE7B,YAAYC,EAAO,CACf,GAAI,CAACA,EAAM,GACP,MAAM,IAAI,MAAM,8BAA8B,EAElD,KAAK,GAAKA,EAAM,GAChB,KAAK,KAAO,SACZ,KAAK,cAAgBA,EAAM,eAAiB,KAC5C,KAAK,KAAOA,EAAM,KAClB,KAAK,IAAM,KACX,KAAK,KAAO,KACZ,KAAK,MAAQA,CACjB,CAEA,MAAM7E,EAAKC,EAAI,CACX,KAAK,IAAMD,EACX,KAAK,KAAOD,EAAgB,CAAE,IAAAC,EAAK,GAAAC,EAAI,KAAM,KAAK,MAAM,KAAM,EAC9DkB,EAAS,KAAK,KAAM,IAAI,CAC5B,CACA,UAAW,CACH,KAAK,MACLG,EAAY,KAAK,KAAM,IAAI,CAEnC,CACA,SAASuD,EAAO,CAEZ,OAAO,OAAO,KAAK,MAAOA,EAAO,CAAE,GAAI,KAAK,GAAI,EAE5C,KAAK,MACLtD,EAAY,KAAK,IAAU,CAEnC,CACA,OAAOtB,EAAIwB,EAAkB,CACzBD,EAAU,KAAK,KAAM,KAAK,IAAK,KAAMC,CAAgB,CACzD,CACJ,CCnCA,MAAMqD,EAAsB,gBAGrB,SAASC,EAAc/E,EAAKE,EAAM8E,EAAWC,EAAW,CAG3D,GAAI,CAACjF,GAAO,CAACE,GAAQ,CAACF,EAAI,OAAS,CAACA,EAAI,MAAM,QAC1C,OAEJ,MAAMyE,EAASZ,EAAQoB,EAAW,OAAO,EACzC,GAAID,IAAcC,EAAW,CAEzB,MAAMC,EAAarB,EAAQmB,EAAW,OAAO,EACvCG,EAAe,IAAI,IAAID,EAAW,IAAIE,GAAKA,EAAE,EAAE,CAAC,EACtD,UAAWhE,KAASqD,EAChBU,EAAa,OAAO/D,EAAM,EAAE,EAEhC,UAAWiE,KAAMF,EACTnF,EAAI,SAASqF,CAAE,GACfrF,EAAI,YAAYqF,CAAE,CAG9B,CAEA,UAAWjE,KAASqD,EAAQ,CACxB,MAAMa,EAActF,EAAI,SAASoB,EAAM,EAAE,EACrCkE,GAGsBA,EAAY,gBAAkBA,GACtC,SAASlE,EAAM,KAAK,EAGlCpB,EAAI,SAAS,IAAI4E,EAAY,CACzB,GAAIxD,EAAM,GACV,KAAAlB,EAEA,KAAMkB,EAAM,MAAM,IAClC,CAAa,EAEDA,EAAM,MAAM,QAAQ,CAE5B,CAMA,MAAMmE,EAAYvF,EAAI,MAAM,OAEtBwF,EAAc,CAAA,EACpB,UAAWpE,KAASqD,EAAQ,CAExB,GAAI,CAAE,SAAAgB,GAAarE,EAAM,OACrB,CAACqE,GAAY,CAACF,EAAU,SAASE,CAAQ,KACzCA,EAAWX,GAEfU,EAAYC,CAAQ,EAAID,EAAYC,CAAQ,GAAK,CAAA,EACjDD,EAAYC,CAAQ,EAAE,KAAKrE,EAAM,EAAE,CACvC,CACA,UAAWqE,KAAYD,EAAa,CAChC,MAAME,EAAaF,EAAYC,CAAQ,EACvC,IAAIE,EAAiBF,IAAaX,EAAsBS,EAAU,OAASA,EAAU,QAAQE,CAAQ,EACjGG,EAAcH,IAAaX,EAAsB,OAAYW,EACjE,QAASI,EAAIH,EAAW,OAAS,EAAGG,GAAK,EAAGA,IAAK,CAC7C,MAAMC,EAAUJ,EAAWG,CAAC,EACtBE,EAAaR,EAAU,QAAQO,CAAO,EACxCC,IAAeJ,EAAiB,IAChC3F,EAAI,UAAU8F,EAASF,CAAW,EAC9BG,EAAaJ,GAEbA,KAGRA,IACAC,EAAcE,CAClB,CACJ,CACJ,CC9Ee,MAAME,CAAiB,CAElC,YAAYnB,EAAO,CACfoB,EAAOpB,EAAM,GAAI,gBAAgB,EACjC,KAAK,GAAKA,EAAM,GAChB,KAAK,KAAO,SACZ,KAAK,cAAgBA,EAAM,eAAiB,KAC5C,KAAK,KAAOA,EAAM,KAClB,KAAK,SAAWA,EAAM,SACtB,KAAK,IAAM,KACX,KAAK,KAAO,IAChB,CAEA,MAAM7E,EAAKC,EAAI,CACX,KAAK,IAAMD,EACX,KAAK,KAAOD,EAAgB,CAAE,IAAAC,EAAK,GAAAC,CAAE,CAAE,CAC3C,CACA,OAAOA,EAAIwB,EAAkB,CACrB,CAAC,KAAK,MAAQ,CAAC,KAAK,KAExBK,EAAe,KAAK,KAAM,KAAK,IAAK,KAAML,CAAgB,CAC9D,CACJ,CCtBA,MAAMqD,EAAsB,gBAC5B,SAASoB,EAAgB9E,EAAO,CAC5B,OAAIA,EAAM,MAAM,SACL,2BAA2BA,EAAM,MAAM,QAAQ,GAEjDA,EAAM,MAAM,KACV,yBAAyBA,EAAM,MAAM,IAAI,GAE7C,uBACX,CAKO,SAAS+E,EAAmBnG,EAAKgF,EAAWC,EAAW,CAG1D,GAAI,CAACjF,GAAO,CAACA,EAAI,OAAS,CAACA,EAAI,MAAM,QACjC,OAEJ,MAAMyE,EAASZ,EAAQoB,EAAW,OAAO,EACzC,GAAID,IAAcC,EAAW,CAEzB,MAAMC,EAAarB,EAAQmB,EAAW,OAAO,EACvCoB,EAAoB,IAAI,IAAIlB,EAAW,IAAIE,GAAKc,EAAgBd,CAAC,CAAC,CAAC,EACnEiB,EAAmB,IAAI,IAAI5B,EAAO,IAAIW,GAAKc,EAAgBd,CAAC,CAAC,CAAC,EACpE,UAAWkB,KAAWF,EACbC,EAAiB,IAAIC,CAAO,GACzBtG,EAAI,SAASsG,CAAO,GACpBtG,EAAI,YAAYsG,CAAO,CAIvC,CAEA,MAAMd,EAAc,CAAA,EACpB,UAAWpE,KAASqD,EAAQ,CACxB,MAAM6B,EAAUJ,EAAgB9E,CAAK,EAC/BmF,EAAcvG,EAAI,SAASsG,CAAO,EACxC,GAAIC,EAAa,CAGb,MAAMC,EAAgBD,EAAY,gBAAkBA,EACpDf,EAAYc,CAAO,EAAIE,CAC3B,KACK,CACD,MAAMC,EAAW,IAAIT,EAAiB,CAClC,GAAIM,EACJ,KAAMlF,EAAM,MAAM,KAClB,SAAUA,EAAM,MAAM,QACtC,CAAa,EACDoE,EAAYc,CAAO,EAAIG,EACvBzG,EAAI,SAASyG,EAAUrF,EAAM,MAAM,QAAQ,CAC/C,CACJ,CAIA,MAAMmE,EAAYvF,EAAI,MAAM,OAC5B,SAAW,CAACsG,EAASvE,CAAK,IAAK,OAAO,QAAQyD,CAAW,EAAG,CACxD,MAAMC,EAAW1D,EAAM,UAAY+C,EAC7B4B,EAAqBjB,IAAaX,EAAsBS,EAAU,OAASA,EAAU,QAAQE,CAAQ,EAE3G,GAD2BF,EAAU,QAAQe,CAAO,IACzBI,EAAqB,EAAG,CAC/C,MAAMC,EAAelB,IAAaX,EAAsB,OAAYW,EACpEzF,EAAI,UAAUsG,EAASK,CAAY,CACvC,CACJ,CACJ,CC7De,MAAMC,EAAc,CAC/B,YAAY/B,EAAO,CACf,KAAK,mBAAqB,IAAM,CAE5B,GADA,KAAK,eAAe,KAAK,KAAM,KAAK,MAAO,KAAK,OAAO,OAAQ,KAAK,OAAO,MAAM,EAC7E,CAAC,KAAK,KACN,OAEe3D,EAAc,KAAK,IAAI,GACxB,CAAC,KAAK,OAAO,OAC3B,KAAK,OAAO,SAAS,CAAE,MAAOX,EAAe,KAAK,IAAI,EAAG,CAEjE,EACA,KAAK,qBAAuB,IAAM,CAC9B,GAAI,KAAK,MAAQ,KAAK,WAAY,CAC9B,KAAM,CAAE,YAAAsG,EAAa,aAAAC,CAAY,EAAK,KAAK,KAAK,aAAY,EAC5D,OAAO,OAAO,KAAK,WAAW,MAAO,CACjC,MAAO,GAAGD,CAAW,KACrB,OAAQ,GAAGC,CAAY,IAC3C,CAAiB,CACL,CACJ,EACA,KAAK,iBAAmB,IAAM,CAC1B,MAAM5G,EAAO,KAAK,MACZF,EAAM,KAAK,KACbE,GAAQF,IACRE,EAAK,SAAS,CACV,MAAO,KAAK,OAAO,OAASK,EAAeP,CAAG,EAC9C,UAAWS,EAAaT,CAAG,CAC/C,CAAiB,EAEGE,EAAK,eACLA,EAAK,OAAM,EAGvB,EAEA,KAAK,kBAAqB6G,GAAU,CAChC,MAAM7G,EAAO,KAAK,MAClB,GAAI,CAACA,GAAQ,CAACA,EAAK,cACf,OAEJ,MAAM8G,EAAY,CACd,KAAMD,EAAM,KACZ,aAAcA,EAAM,MACpB,SAAUA,CAC1B,EACkBE,EAAW,KAAK,oBAUtB,OATI,CAACF,EAAM,OAASE,IAEhBD,EAAU,OAASD,EAAM,cAAc,QAAUE,EAAS,QAC1DD,EAAU,OAASD,EAAM,cAAc,QAAUE,EAAS,QAC1DD,EAAU,aAAe,CACrB,EAAGC,EAAS,EAAID,EAAU,OAC1B,EAAGC,EAAS,EAAID,EAAU,MAC9C,GAEoBA,EAAU,KAAI,CAClB,IAAK,YACD9G,EAAK,eAAe8G,CAAS,EAC7B,KAAK,oBAAsB,CACvB,GAAGD,EAAM,MACT,QAASA,EAAM,cAAc,QAC7B,QAASA,EAAM,cAAc,OACrD,EACoB,MACJ,IAAK,YACDC,EAAU,KAAO,WACjB9G,EAAK,SAAS8G,CAAS,EACvB,MACJ,IAAK,OACDA,EAAU,KAAO,UACjB9G,EAAK,SAAS8G,CAAS,EACvB,MACJ,IAAK,UACDA,EAAU,KAAO,SACjB9G,EAAK,SAAS8G,CAAS,EACvB,MACJ,IAAK,QACDA,EAAU,SAAW,EACrB9G,EAAK,SAAS8G,CAAS,EACvB,MACJ,IAAK,WACDA,EAAU,KAAO,QACjBA,EAAU,SAAW,EACrB9G,EAAK,SAAS8G,CAAS,EACvB,MACJ,IAAK,YACDA,EAAU,KAAO,cACjB9G,EAAK,eAAe8G,CAAS,EAC7B,MACJ,IAAK,WACDA,EAAU,KAAO,eACjB9G,EAAK,eAAe8G,CAAS,EAC7B,MACJ,QACI,MACpB,CACQ,EACA,KAAM,CAAE,YAAAhG,EAAc,EAAK,EAAK6D,EAChC,KAAK,aAAe7D,EACpB,KAAK,sBAAwB6D,EAAM,uBAAyB,GAC5D,KAAK,OAAS,KAAK,YAAYA,CAAK,CACxC,CAEA,YAAYA,EAAO,CACf,KAAM,CAAE,YAAA7D,EAAc,GAAO,gBAAAkG,EAAiB,GAAG7G,CAAS,EAAKwE,EAC/D,MAAI,CAAC7D,GAAekG,IAAoB,SAEpC7G,EAAU,gBAAkB6G,GAEzB7G,CACX,CAEA,SAASwE,EAAO,CACR,KAAK,cAAgBA,EAAM,QAC3B,KAAK,eAAe,KAAK,KAAM,KAAK,MAAO,KAAK,OAAO,OAAQA,EAAM,MAAM,EAE/E,OAAO,OAAO,KAAK,OAAQ,KAAK,YAAYA,CAAK,CAAC,EAC9C,KAAK,OAAS,KAAK,MACnB,KAAK,MAAM,SAAS,CAChB,GAAG,KAAK,OACR,WAAY,CACR,GAAGvE,EAAqB,KAAK,KAAM,KAAK,YAAY,EACpD,GAAG,KAAK,OAAO,UACnC,CACA,CAAa,CAET,CAIA,MAAMN,EAAK,CACP,YAAK,KAAOA,EACL,KAAK,aAAe,KAAK,kBAAkBA,CAAG,EAAI,KAAK,eAAeA,CAAG,CACpF,CACA,eAAeA,EAAK,CAEhB,MAAMmH,EAAY,SAAS,cAAc,KAAK,EAC9C,cAAO,OAAOA,EAAU,MAAO,CAC3B,SAAU,WACV,KAAM,EACN,IAAK,EACL,UAAW,UACX,cAAe,MAC3B,CAAS,EACD,KAAK,WAAaA,EAClB,KAAK,MAAQ,IAAIxG,EAAK,CAClB,GAAG,KAAK,OACR,OAAQwG,EACR,WAAY,CAAE,GAAG7G,EAAqBN,EAAK,EAAK,EAAG,GAAG,KAAK,OAAO,UAAU,EAC5E,MAAO,KAAK,OAAO,OAASO,EAAeP,CAAG,EAC9C,UAAWS,EAAaT,CAAG,CACvC,CAAS,EACDA,EAAI,GAAG,SAAU,KAAK,oBAAoB,EAC1CA,EAAI,GAAG,SAAU,KAAK,gBAAgB,EACtCA,EAAI,GAAG,YAAa,KAAK,iBAAiB,EAC1CA,EAAI,GAAG,YAAa,KAAK,iBAAiB,EAC1CA,EAAI,GAAG,OAAQ,KAAK,iBAAiB,EACrCA,EAAI,GAAG,UAAW,KAAK,iBAAiB,EACxCA,EAAI,GAAG,YAAa,KAAK,iBAAiB,EAC1CA,EAAI,GAAG,WAAY,KAAK,iBAAiB,EACzCA,EAAI,GAAG,QAAS,KAAK,iBAAiB,EACtCA,EAAI,GAAG,WAAY,KAAK,iBAAiB,EACzC,KAAK,qBAAoB,EAClBmH,CACX,CACA,kBAAkBnH,EAAK,CAEnB,MAAMC,EAAKD,EAAI,QAAQ,QAAQ,GAC/B,OAAIC,aAAc,uBACdmH,EAAI,KAAK,qGAAqG,EAAC,EAEnH,KAAK,MAAQrH,EAAgB,CACzB,IAAAC,EACA,GAAAC,EACA,KAAM,IAAIU,EAAK,CACX,GAAG,KAAK,OACR,GAAAV,EACA,WAAY,CAAE,GAAGK,EAAqBN,EAAK,EAAI,EAAG,GAAG,KAAK,OAAO,UAAU,CAC3F,CAAa,CACb,CAAS,EACDA,EAAI,GAAG,YAAa,KAAK,kBAAkB,EAC3C,KAAK,eAAeA,EAAK,KAAK,MAAO,GAAI,KAAK,OAAO,MAAM,EACpD,SAAS,cAAc,KAAK,CACvC,CACA,eAAeA,EAAKE,EAAMgF,EAAYD,EAAW,CACzC,KAAK,sBACLkB,EAAmBnG,EAAKkF,EAAYD,CAAS,EAG7CF,EAAc/E,EAAKE,EAAMgF,EAAYD,CAAS,CAEtD,CAEA,UAAW,CACP,MAAMjF,EAAM,KAAK,KACbA,IACI,KAAK,aACL,KAAK,qBAAqBA,CAAG,EAG7B,KAAK,kBAAkBA,CAAG,GAGlC,KAAK,MAAQ,OACb,KAAK,KAAO,OACZ,KAAK,WAAa,MACtB,CACA,kBAAkBA,EAAK,CACnBA,EAAI,IAAI,SAAU,KAAK,oBAAoB,EAC3CA,EAAI,IAAI,SAAU,KAAK,gBAAgB,EACvCA,EAAI,IAAI,YAAa,KAAK,iBAAiB,EAC3CA,EAAI,IAAI,YAAa,KAAK,iBAAiB,EAC3CA,EAAI,IAAI,OAAQ,KAAK,iBAAiB,EACtCA,EAAI,IAAI,UAAW,KAAK,iBAAiB,EACzCA,EAAI,IAAI,YAAa,KAAK,iBAAiB,EAC3CA,EAAI,IAAI,WAAY,KAAK,iBAAiB,EAC1CA,EAAI,IAAI,QAAS,KAAK,iBAAiB,EACvCA,EAAI,IAAI,WAAY,KAAK,iBAAiB,EAC1C,KAAK,OAAO,SAAQ,CACxB,CACA,qBAAqBA,EAAK,CACtBA,EAAI,IAAI,YAAa,KAAK,kBAAkB,EAC5C,KAAK,eAAeA,EAAK,KAAK,MAAO,KAAK,OAAO,OAAQ,EAAE,EAC3DY,EAAmBZ,CAAG,CAC1B,CACA,oBAAqB,CACjB,MAAO,UACX,CAEA,WAAW6B,EAAQ,CACf,OAAAoE,EAAO,KAAK,KAAK,EACV,KAAK,MAAM,WAAWpE,CAAM,CACvC,CAEA,oBAAoBA,EAAQ,CACxB,OAAAoE,EAAO,KAAK,KAAK,EACV,KAAK,MAAM,oBAAoBpE,CAAM,CAChD,CAEA,YAAYA,EAAQ,CAChB,OAAAoE,EAAO,KAAK,KAAK,EACV,KAAK,MAAM,YAAYpE,CAAM,CACxC,CAEA,UAAW,CACH,KAAK,MACL,KAAK,KAAK,cAAc,IAAI,CAEpC,CAEA,WAAY,CACR,OAAK,KAAK,KAGH,KAAK,aAAe,KAAK,KAAK,YAAc,KAAK,MAAM,UAAS,EAF5D,IAGf,CACJ","x_google_ignoreList":[0,1,2,3,4,5]}