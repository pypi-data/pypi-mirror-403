{
	"$schema": "metaschema/strict_meta_schema.json#",
	"$id": "scrnaseq_analysis",
	"title": "Analysis for Assay of scRNA",

	"definitions": {

		"entry": {
			"type": "object",
			"mergeStrategy": "objectMerge",
			"description": "A single analysis record from scRNA analysis.",
			"additionalProperties": false,
			"required": [
                "cimac_id",
                "clustering_rds",
                "report_html",
                "star_sorted_by_coord_bam",
                "star_sorted_by_coord_bam_bai",
                "star_log_final_out",
                "star_log_out",
                "star_log_progress_out",
                "star_sj_out",
                "star_barcode_stats",
                "star_gene_features_stats",
                "star_gene_summary_csv",
                "star_gene_umi_per_cell_sorted",
                "star_gene_filtered_features_tsv",
                "star_gene_filtered_barcodes",
                "star_gene_filtered_matrix",
                "star_gene_raw_features_tsv",
                "star_gene_raw_barcodes",
                "star_gene_raw_matrix"
			],
			"properties": {
                "cimac_id": {"$ref": "assays/components/ngs/ngs_assay_record.json#properties/cimac_id"},
                "clustering_rds": { "$ref": "artifacts/artifact_rds.json"},
                "report_html": { "$ref": "artifacts/artifact_html.json"},
                "star_sorted_by_coord_bam": { "$ref": "artifacts/artifact_bam.json"},
                "star_sorted_by_coord_bam_bai": { "$ref": "artifacts/artifact_bam_bai.json"},
                "star_log_final_out": { "$ref": "artifacts/artifact_out.json"},
                "star_log_out": { "$ref": "artifacts/artifact_out.json"},
                "star_log_progress_out": { "$ref": "artifacts/artifact_out.json"},
                "star_sj_out": { "$ref": "artifacts/artifact_tab.json"},
                "star_barcode_stats": { "$ref": "artifacts/artifact_stats.json"},
                "star_gene_features_stats": { "$ref": "artifacts/artifact_stats.json"},
                "star_gene_summary_csv": { "$ref": "artifacts/artifact_csv.json"},
                "star_gene_umi_per_cell_sorted": { "$ref": "artifacts/artifact_txt.json"},
                "star_gene_filtered_features_tsv": { "$ref": "artifacts/artifact_tsv.json"},
                "star_gene_filtered_barcodes": { "$ref": "artifacts/artifact_tsv.json"},
                "star_gene_filtered_matrix": { "$ref": "artifacts/artifact_mtx.json"},
                "star_gene_raw_features_tsv": { "$ref": "artifacts/artifact_tsv.json"},
                "star_gene_raw_barcodes": { "$ref": "artifacts/artifact_tsv.json"},
                "star_gene_raw_matrix": { "$ref": "artifacts/artifact_mtx.json"},
                "comments": {
                  "type": "string",
                  "description": "Comments on the scRNA analysis run."
                }
			}
		}
	},

	"type": "object",
	"additionalProperties": false,
	"required": [
        "records",
        "samples_metadata_csv",
        "config_yaml",
        "r_package_versions",
        "integration_rds",
        "integration_heatmap_plots",
        "integration_markers_zip",
        "integration_split_percent_plots",
        "integration_split_umap_plots",
        "integration_umap_plots",
        "batch_id"
	],
	"properties": {
        "batch_id":{
            "$ref": "assays/scrnaseq_assay.json#properties/batch_id"
        },
        "optional_id": {
            "description": "User provided optional id. Currently comes from CIDC Submission ID",
            "type": "string"
        },
        "records": {
            "type": "array",
            "mergeStrategy": "arrayMergeById",
            "mergeOptions": { "idRef": "/cimac_id" },
            "items": {
                "$ref": "assays/scrnaseq_analysis.json#definitions/entry"
            }
        },
        "excluded_samples": {
            "$ref": "assays/components/excluded_samples.json"
        },
        "samples_metadata_csv": { "$ref": "artifacts/artifact_csv.json"},
        "config_yaml": { "$ref": "artifacts/artifact_yaml.json"},
        "r_package_versions": { "$ref": "artifacts/artifact_csv.json"},
        "integration_rds": { "$ref": "artifacts/artifact_rds.json"},
        "integration_heatmap_plots": { "$ref": "artifacts/artifact_zip.json"},
        "integration_markers_zip": { "$ref": "artifacts/artifact_zip.json"},
        "integration_split_percent_plots": { "$ref": "artifacts/artifact_zip.json"},
        "integration_split_umap_plots": { "$ref": "artifacts/artifact_zip.json"},
        "integration_umap_plots": { "$ref": "artifacts/artifact_zip.json"}
    }
}
