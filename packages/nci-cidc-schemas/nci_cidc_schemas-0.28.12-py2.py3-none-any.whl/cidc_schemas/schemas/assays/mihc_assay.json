{
    "$schema": "metaschema/strict_meta_schema.json#",
    "$id": "mihc_assay",
    "title": "mIHC Assay",
    "type": "object",
    "$comment": "description used in docs/index.html and docs/assays.mihc.html",
    "description": "Mulitplex Immunohistochemestry (mIHC) assay",
    "additionalProperties": false,
    "definitions": {
        "record": {
            "type": "object",
            "mergeStrategy": "objectMerge",
            "description": "A single data record from a mIHC assay.",
            "additionalProperties": false,
            "required": [
                "cimac_id",
                "files"
            ],
            "properties": {
                "cimac_id": {
                    "description": "Id of an sample within this clinical trial, that this assay record is based upon.",
                    "$ref": "sample.json#properties/cimac_id"
                },
                "files": {
                    "$ref": "assays/components/mihc_input.json"
                }
            }
        }
    },
    "properties": {
        "assay_creator": {
            "$ref": "assays/components/assay_core.json#properties/assay_creator"
        },
        "slide_scanner_model": {"$ref": "assays/components/image.json#properties/slide_scanner_model"},
        "image_analysis_software": {"$ref": "assays/components/image.json#properties/image_analysis_software"},
        "image_analysis_software_version": {"$ref": "assays/components/image.json#properties/image_analysis_software_version"},
        "cell_segmentation_model": {"$ref": "assays/components/image.json#properties/cell_segmentation_model"},
        "positive_cell_detection": {"$ref": "assays/components/image.json#properties/positive_cell_detection"},

        "staining": {"$ref": "assays/components/imaging_data.json#properties/staining"},
        "staining_date": {"$ref": "assays/components/imaging_data.json#properties/staining_date"},
        "imaging_date": {"$ref": "assays/components/imaging_data.json#properties/imaging_date"},
        "imaging_status": {"$ref": "assays/components/imaging_data.json#properties/imaging_status"},

        "batch_id": {
            "description": "Batch identification number. Unique to every upload.",
            "type": "string"
        },
        "optional_id": {
            "description": "User provided optional id. Currently comes from CIDC Submission ID",
            "type": "string"
        },
        "samples_file": {"$ref": "artifacts/artifact_csv.json"},

        "panel": {"type": "string"},

        "antibodies": {
            "type": "array",
            "items": {
                "$ref": "assays/components/mihc_antibody.json"
            },
            "mergeStrategy": "arrayMergeById",
            "mergeOptions": {
                "idRef": "antibody"
            }
        },

        "records": {
            "type": "array",
            "description": "A single data record from a mIHC assay.",
            "items": {
                "$ref": "assays/mihc_assay.json#definitions/record"
            },
            "mergeStrategy": "append"
        }
    },
    "required": [
        "assay_creator",
        "batch_id",
        "samples_file",
        "records",
        "panel",
        "antibodies"
    ]
}

