import{e as N,j as e,r,B as C,n as H,P,I as v,T as $}from"./render-CcJq83Ld.js";import{B as L,b as G,c as W,d as X,e as I,f as j,g as q}from"./Base-DG8RQuPN.js";import{A as J}from"./Add-DF_nYmDf.js";import{D as V}from"./Delete-DsQQzLdF.js";import{E as Z}from"./Edit-BGn1m_qW.js";import{g as b,G as K}from"./utils-w7mD0LnI.js";import{R as B}from"./RequiredTextField-Bb6HLLm_.js";import{I as Q,D as Y}from"./ImageUpload-BlZsctFx.js";import{A as U}from"./Alert-rWDWC83z.js";import{B as h}from"./Button-CN6ewz-p.js";import{b as ee}from"./Dialog-CNsJRRbd.js";import"./SwitchBase-BsWn8bTb.js";const se=N(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39"}));function D({successCallback:m,failureCallback:t,cancelCallback:S,createMode:g,initialName:p,initialDescription:T,initialLogoUrl:u,organizationId:x}){const[i,f]=r.useState(p||""),[c,y]=r.useState(T||""),[k,d]=r.useState(""),[M,s]=r.useState(""),[o,z]=r.useState(null),[E,w]=r.useState(),_=localStorage.getItem("apiBaseUrl"),O=()=>{let a=!0;return i.trim()?d(""):(d(localeMessages.name_required),a=!1),c.trim()?s(""):(s(localeMessages.description_required),a=!1),a},R=()=>a=>{if(a.preventDefault(),!O())return;let n={name:i,description:c};o&&(n.logo=o),!o&&!u&&(n.remove_logo=!0),fetch(`${_}/organizations/${x}/`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":b("csrftoken")},body:JSON.stringify(n)}).then(l=>l.ok?l.json():l.json().then(F=>{throw F})).then(l=>{m(l)}).catch(l=>{w(localeMessages.error_try_again),t(l)})},A=()=>a=>{a.preventDefault(),O()&&fetch(`${_}/organizations/`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":b("csrftoken")},body:JSON.stringify({name:i,description:c,logo:o})}).then(n=>n.ok?n.json():n.json().then(l=>{throw l})).then(n=>{m(n)}).catch(n=>{setErrorMessages(localeMessages.error_try_again)})};return e.jsxs(C,{p:2,children:[E&&e.jsx(U,{severity:"error",sx:{mb:2},children:E}),e.jsx(B,{label:localeMessages.name,helperText:k,fullWidth:!0,margin:"normal",value:i,onChange:a=>f(a.target.value)}),e.jsx(B,{label:localeMessages.description,helperText:M,fullWidth:!0,margin:"normal",multiline:!0,rows:4,value:c,onChange:a=>y(a.target.value)}),e.jsx(Q,{initialUrl:u,onUploadSuccess:a=>{z(a.file_path)},onUploadError:a=>{setErrorMessages(localeMessages.logo_upload_failed)}}),e.jsxs(Y,{children:[e.jsx(h,{onClick:S,children:localeMessages.cancel}),e.jsx(h,{variant:"contained",type:"submit",color:"primary",onClick:g?A():R(),children:g?localeMessages.create:localeMessages.update})]})]})}function ae(){const[m,t]=r.useState(!1),[S,g]=r.useState(null),[p,T]=r.useState([]),[u,x]=r.useState([]);r.useEffect(()=>{fetch(`${i}/organizations/`,{method:"GET",headers:{"Content-Type":"application/json","X-CSRFToken":b("csrftoken")}}).then(s=>s.json()).then(s=>{T(s.organizations)}).catch(s=>{console.error("Error fetching organizations:",s)})},[u]);const i=localStorage.getItem("apiBaseUrl"),f=s=>{console.log("Organization created successfully:",s),t(!1),x(o=>[...o,s])},c=s=>{console.error("Error creating organization:",s)},y=s=>{window.open(s,"_blank")},k=s=>{fetch(`${i}/organizations/${s}/`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":b("csrftoken")}}).then(o=>{o.ok?(console.log("Organization deleted successfully"),x(z=>[...z,{deletedOrganizationId:s}])):console.error("Error deleting organization")}).catch(o=>{console.error("Error deleting organization:",o)})},d=document.getElementsByTagName("html")[0],M=s=>{g(e.jsxs(C,{sx:{p:2},children:[e.jsx($,{variant:"h6",children:localeMessages.confirm_deletion}),e.jsx(U,{severity:"warning",variant:"outlined",sx:{mt:1},children:localeMessages.are_you_sure_delete_org.replace("ORGANIZATION_NAME",s.name)}),e.jsxs(C,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:[e.jsx(h,{onClick:()=>t(!1),sx:{mr:1},children:localeMessages.cancel}),e.jsx(h,{variant:"contained",color:"error",onClick:()=>{k(s.id),t(!1)},children:localeMessages.delete})]})]})),t(!0)};return e.jsxs(L,{breadCrumbList:[{label:localeMessages.organizations,href:"#"}],showOrganizationSwitcher:!1,children:[e.jsx(K,{size:12,py:2,pl:2,children:e.jsxs(C,{p:2,sx:{border:"1px solid",borderColor:"grey.300",borderRadius:1,minHeight:300,width:{lg:"80%"}},children:[e.jsx(h,{variant:"contained",startIcon:e.jsx(J,{sx:{marginLeft:direction=="rtl"?1:0}}),sx:{marginBottom:2},onClick:()=>{g(e.jsx(D,{successCallback:f,failureCallback:c,cancelCallback:()=>t(!1),createMode:!0})),t(!0)},children:localeMessages.add_organization}),p.length>0&&e.jsx(G,{component:P,sx:{maxHeight:440,border:"1px solid",borderColor:"grey.300",borderRadius:1},children:e.jsxs(W,{children:[e.jsx(X,{children:e.jsxs(I,{children:[e.jsx(j,{dir:d.dir,sx:{textAlign:d.dir==="rtl"?"right":"left"},children:localeMessages.name}),e.jsx(j,{sx:{width:"100px"},children:localeMessages.actions})]})}),e.jsx(q,{children:p.map(s=>e.jsxs(I,{children:[e.jsx(j,{dir:d.dir,sx:{textAlign:d.dir==="rtl"?"right":"left"},children:s.name}),e.jsxs(j,{children:[e.jsx(v,{onClick:()=>y(s.public_url),children:e.jsx(se,{fontSize:"small"})}),e.jsx(v,{onClick:()=>{g(e.jsx(D,{successCallback:f,failureCallback:c,cancelCallback:()=>t(!1),createMode:!1,initialName:s.name,initialDescription:s.description,initialLogoUrl:s.logo,organizationId:s.id})),t(!0)},children:e.jsx(Z,{fontSize:"small"})}),e.jsx(v,{onClick:()=>M(s),children:e.jsx(V,{fontSize:"small"})})]})]},s.id))})]})})]})}),e.jsx(ee,{open:m,onClose:()=>t(!1),fullWidth:!0,maxWidth:"sm",children:S})]})}H({children:e.jsx(ae,{})});
//# sourceMappingURL=organizations-CHuLRZlb.js.map
