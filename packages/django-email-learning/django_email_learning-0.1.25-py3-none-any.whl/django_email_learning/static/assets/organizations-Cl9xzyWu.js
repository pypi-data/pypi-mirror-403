import{e as A,j as e,r as s,s as X,B as S,n as G,P as W,I as w,T as q}from"./render-CcJq83Ld.js";import{B as J,b as V,c as Z,d as K,e as B,f as C,g as Q}from"./Base-DG8RQuPN.js";import{A as Y}from"./Add-DF_nYmDf.js";import{D as ee}from"./Delete-DsQQzLdF.js";import{E as te}from"./Edit-BGn1m_qW.js";import{g as u,G as oe}from"./utils-w7mD0LnI.js";import{R}from"./RequiredTextField-Bb6HLLm_.js";import{B as g}from"./Button-CN6ewz-p.js";import{D as se}from"./DialogActions-Cye4fTOA.js";import{b as ae}from"./Dialog-CNsJRRbd.js";import{A as ne}from"./Alert-rWDWC83z.js";import"./SwitchBase-BsWn8bTb.js";const re=A(e.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"})),le=A(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39"}));function U({successCallback:p,failureCallback:a,cancelCallback:T,createMode:h,initialName:f,initialDescription:y,initialLogoUrl:k,organizationId:x}){const[i,j]=s.useState(f||""),[c,v]=s.useState(y||""),[z,d]=s.useState(""),[M,t]=s.useState(""),[r,b]=s.useState(null),[_,F]=s.useState(k||null),[m,I]=s.useState(null),[ce,O]=s.useState({}),E=localStorage.getItem("apiBaseUrl"),H=()=>{F(null),I(null),b(null)},D=()=>{let o=!0;return i.trim()?d(""):(d(localeMessages.name_required),o=!1),c.trim()?t(""):(t(localeMessages.description_required),o=!1),o},L=()=>o=>{if(o.preventDefault(),!D())return;let n={name:i,description:c};m&&(n.logo=m),!m&&!_&&(n.remove_logo=!0),fetch(`${E}/organizations/${x}/`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":u("csrftoken")},body:JSON.stringify(n)}).then(l=>l.ok?l.json():l.json().then($=>{throw $})).then(l=>{p(l)}).catch(l=>{O(localeMessages.error_try_again)})},N=()=>o=>{o.preventDefault(),D()&&fetch(`${E}/organizations/`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":u("csrftoken")},body:JSON.stringify({name:i,description:c,logo:m})}).then(n=>n.ok?n.json():n.json().then(l=>{throw l})).then(n=>{p(n)}).catch(n=>{O(localeMessages.error_try_again)})};s.useEffect(()=>{r&&fetch(`${E}/organizations/1/file/`,{method:"POST",headers:{"X-CSRFToken":u("csrftoken")},body:(()=>{const o=new FormData;return o.append("file",r),o})()}).then(o=>{if(!o.ok)throw new Error("File upload failed");return o.json()}).then(o=>{console.log("File uploaded successfully:",o),F(o.file_url),I(o.file_path),console.log("File path set to:",m)}).catch(o=>{console.error("Error uploading file:",o)})},[r]);const P=X("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1});return e.jsxs(S,{p:2,children:[e.jsx(R,{label:localeMessages.name,helperText:z,fullWidth:!0,margin:"normal",value:i,onChange:o=>j(o.target.value)}),e.jsx(R,{label:localeMessages.description,helperText:M,fullWidth:!0,margin:"normal",multiline:!0,rows:4,value:c,onChange:o=>v(o.target.value)}),_?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:_,alt:localeMessages.organization_logo,style:{marginTop:"10px",maxHeight:"100px"}}),e.jsx("br",{}),e.jsx(g,{variant:"text",color:"secondary",onClick:H,children:localeMessages.remove_logo})]}):e.jsxs(g,{component:"label",role:void 0,variant:"contained",tabIndex:-1,startIcon:e.jsx(re,{sx:{marginLeft:direction==="rtl"?1:0}}),sx:{textAlign:direction==="rtl"?"right":"left",mt:2,mb:2},dir:direction,children:[localeMessages.logo,e.jsx(P,{type:"file",onChange:o=>b(o.target.files[0])})]}),e.jsxs(se,{children:[e.jsx(g,{onClick:T,children:localeMessages.cancel}),e.jsx(g,{variant:"contained",type:"submit",color:"primary",onClick:h?N():L(),children:h?localeMessages.create:localeMessages.update})]})]})}function ie(){const[p,a]=s.useState(!1),[T,h]=s.useState(null),[f,y]=s.useState([]),[k,x]=s.useState([]);s.useEffect(()=>{fetch(`${i}/organizations/`,{method:"GET",headers:{"Content-Type":"application/json","X-CSRFToken":u("csrftoken")}}).then(t=>t.json()).then(t=>{y(t.organizations)}).catch(t=>{console.error("Error fetching organizations:",t)})},[k]);const i=localStorage.getItem("apiBaseUrl"),j=t=>{console.log("Organization created successfully:",t),a(!1),x(r=>[...r,t])},c=t=>{console.error("Error creating organization:",t)},v=t=>{window.open(t,"_blank")},z=t=>{fetch(`${i}/organizations/${t}/`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":u("csrftoken")}}).then(r=>{r.ok?(console.log("Organization deleted successfully"),x(b=>[...b,{deletedOrganizationId:t}])):console.error("Error deleting organization")}).catch(r=>{console.error("Error deleting organization:",r)})},d=document.getElementsByTagName("html")[0],M=t=>{h(e.jsxs(S,{sx:{p:2},children:[e.jsx(q,{variant:"h6",children:localeMessages.confirm_deletion}),e.jsx(ne,{severity:"warning",variant:"outlined",sx:{mt:1},children:localeMessages.are_you_sure_delete_org.replace("ORGANIZATION_NAME",t.name)}),e.jsxs(S,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:[e.jsx(g,{onClick:()=>a(!1),sx:{mr:1},children:localeMessages.cancel}),e.jsx(g,{variant:"contained",color:"error",onClick:()=>{z(t.id),a(!1)},children:localeMessages.delete})]})]})),a(!0)};return e.jsxs(J,{breadCrumbList:[{label:localeMessages.organizations,href:"#"}],showOrganizationSwitcher:!1,children:[e.jsx(oe,{size:12,py:2,pl:2,children:e.jsxs(S,{p:2,sx:{border:"1px solid",borderColor:"grey.300",borderRadius:1,minHeight:300,width:{lg:"80%"}},children:[e.jsx(g,{variant:"contained",startIcon:e.jsx(Y,{sx:{marginLeft:direction=="rtl"?1:0}}),sx:{marginBottom:2},onClick:()=>{h(e.jsx(U,{successCallback:j,failureCallback:c,cancelCallback:()=>a(!1),createMode:!0})),a(!0)},children:localeMessages.add_organization}),f.length>0&&e.jsx(V,{component:W,sx:{maxHeight:440,border:"1px solid",borderColor:"grey.300",borderRadius:1},children:e.jsxs(Z,{children:[e.jsx(K,{children:e.jsxs(B,{children:[e.jsx(C,{dir:d.dir,sx:{textAlign:d.dir==="rtl"?"right":"left"},children:localeMessages.name}),e.jsx(C,{sx:{width:"100px"},children:localeMessages.actions})]})}),e.jsx(Q,{children:f.map(t=>e.jsxs(B,{children:[e.jsx(C,{dir:d.dir,sx:{textAlign:d.dir==="rtl"?"right":"left"},children:t.name}),e.jsxs(C,{children:[e.jsx(w,{onClick:()=>v(t.public_url),children:e.jsx(le,{fontSize:"small"})}),e.jsx(w,{onClick:()=>{h(e.jsx(U,{successCallback:j,failureCallback:c,cancelCallback:()=>a(!1),createMode:!1,initialName:t.name,initialDescription:t.description,initialLogoUrl:t.logo,organizationId:t.id})),a(!0)},children:e.jsx(te,{fontSize:"small"})}),e.jsx(w,{onClick:()=>M(t),children:e.jsx(ee,{fontSize:"small"})})]})]},t.id))})]})})]})}),e.jsx(ae,{open:p,onClose:()=>a(!1),fullWidth:!0,maxWidth:"sm",children:T})]})}G({children:e.jsx(ie,{})});
//# sourceMappingURL=organizations-Cl9xzyWu.js.map
