# Example: Code-Based Tools with Full MassGen Features
#
# This config demonstrates a comprehensive MassGen setup with:
# - Code-based tools (CodeAct paradigm)
# - DSPy question paraphrasing for answer diversity
# - Orchestration restart for quality validation
# - Agent task planning with filesystem mode
# - Filesystem memory mode
# - Skills system
# - Advanced voting and answer control
#
# Benefits of Code-Based Tools:
# - 98% context reduction (import only needed tools)
# - Transparent (agents see code & docstrings)
# - Composable (create utils/ scripts combining multiple tools)
# - Async-friendly (write async workflows in utils/)
# - Data filtering (process large datasets before returning)
# - Shared tools directory (tools generated once, not duplicated in snapshots)
#
# Prerequisites:
# 0. Run `./scripts/init.sh`
# 1. Create .env file with API keys (see .env.example)
# 2. Docker running (for docker execution mode)
#
# IMPORTANT: This example uses auto_discover_custom_tools which includes tools
# requiring API keys. Ensure you have configured .env and command_line_docker_credentials
# to pass keys to Docker, otherwise tools will fail with authentication errors.
#
# Run with:
# uv run massgen --automation \
#   --config massgen/configs/tools/filesystem/code_based/example_code_based_tools.yaml \
#   "List all available tools by exploring the workspace filesystem. Show what MCP tools and custom tools are available."
# or to show power of skills (e.g., anthropic's website creation skill):
#   uv run massgen --config massgen/configs/tools/filesystem/code_based/example_code_based_tools.yaml "Create a website about Bob Dylan, ensuring that it is visually appealing and user friendly"

agents:
  - id: "agent_a"
    backend:
      # type: "gemini"
      # model: "gemini-3-pro-preview"
      # type: "openai"
      # model: "gpt-5-codex"
      type: "chatcompletion"
      base_url: "https://openrouter.ai/api/v1"
      model: "x-ai/grok-4.1-fast"
      # type: "claude"
      # model: "claude-sonnet-4-5-20250929"
      # enable_strict_tool_use: true
      # type: "claude_code"
      # model: "claude-opus-4-5-20251101"
      # type: "grok"
      # model: "grok-4-1-fast-reasoning"
      cwd: "workspace1"

      # Enable code-based tools (CodeAct paradigm)
      enable_code_based_tools: true          # MCP tools → Python code in servers/
      exclude_file_operation_mcps: true      # Use command-line for file ops (write_file/edit_file kept for clean file creation)
      enable_mcp_command_line: true          # Enable execute_command

      # Parallel tool execution - tools called together run simultaneously
      # WARNING: Do not call dependent tools together (e.g., mkdir + write to that dir)
      concurrent_tool_execution: true

      # Command line execution (required for code-based tools)
      command_line_execution_mode: "docker"
      command_line_docker_network_mode: "bridge"
      command_line_docker_enable_sudo: true

      # IMPORTANT: Pass API keys to Docker (required for most custom tools)
      # Most tools in massgen/tool/ need API keys (OPENAI_API_KEY, ANTHROPIC_API_KEY, etc.)
      # Check requirements: rg "^requires_api_keys:" massgen/tool/*/TOOL.md
      command_line_docker_credentials:
        env_file: ".env"  # Load from .env file in project root
        env_vars_from_file:
          - "OPENAI_API_KEY"
          - "GOOGLE_API_KEY"
          - "GEMINI_API_KEY"

      # Shared tools directory (optional) - tools generated once, shared across agents
      # If not specified, tools are generated in each agent's workspace
      shared_tools_directory: "shared_tools"

      # Custom tools - choose one approach:
      # Option 1: Auto-discover all tools from massgen/tool/ directory
      auto_discover_custom_tools: true

      # Option 2: Specify custom path (takes precedence over auto_discover)
      # custom_tools_path: "massgen/tool/_code_based_example"

      # Exclude specific custom tools (optional)
      # NOTE: Tools requiring unavailable API keys are AUTOMATICALLY excluded
      # This option is for manual exclusions (e.g., heavy dependencies, unwanted features)
      exclude_custom_tools:
        - "_computer_use"  # Manual exclusion: Requires OPENAI_API_KEY
        - "_claude_computer_use"  # Manual exclusion: Requires ANTHROPIC_API_KEY
        - "_gemini_computer_use"   # Manual exclusion: Requires GOOGLE_API_KEY
        - "_browser_automation"    # Manual exclusion: Better to just do via CLI else image gets passed
        # - "_video_tools"           # Manual exclusion: Heavy FFmpeg dependencies

      # MCP servers - these will be converted to Python wrappers in servers/
      # mcp_servers:
      #   - name: "weather"
      #     type: "stdio"
      #     command: "npx"
      #     args: ["-y", "@fak111/weather-mcp"]

  - id: "agent_b"
    backend:
      # type: "openai"
      # model: "gpt-5-codex"
      # type: "claude_code"
      # model: "claude-sonnet-4-5-20250929"
      type: "chatcompletion"
      base_url: "https://openrouter.ai/api/v1"
      model: "x-ai/grok-4.1-fast"
      # type: "claude"
      # model: "claude-sonnet-4-5-20250929"
      # enable_strict_tool_use: true
      # type: "grok"
      # model: "grok-4-1-fast-reasoning"
      cwd: "workspace2"

      # Enable code-based tools (CodeAct paradigm)
      enable_code_based_tools: true          # MCP tools → Python code in servers/
      exclude_file_operation_mcps: true      # Use command-line for file ops (write_file/edit_file kept for clean file creation)
      enable_mcp_command_line: true          # Enable execute_command

      # Parallel tool execution - tools called together run simultaneously
      # WARNING: Do not call dependent tools together (e.g., mkdir + write to that dir)
      concurrent_tool_execution: true

      # Command line execution (required for code-based tools)
      command_line_execution_mode: "docker"
      command_line_docker_network_mode: "bridge"
      command_line_docker_enable_sudo: true

      # IMPORTANT: Pass API keys to Docker (required for most custom tools)
      # Most tools in massgen/tool/ need API keys (OPENAI_API_KEY, ANTHROPIC_API_KEY, etc.)
      # Check requirements: rg "^requires_api_keys:" massgen/tool/*/TOOL.md
      command_line_docker_credentials:
        env_file: ".env"  # Load from .env file in project root
        env_vars_from_file:
          - "OPENAI_API_KEY"
          - "GOOGLE_API_KEY"
          - "GEMINI_API_KEY"

      # Shared tools directory (optional) - tools generated once, shared across agents
      # If not specified, tools are generated in each agent's workspace
      shared_tools_directory: "shared_tools"

      # Custom tools - choose one approach:
      # Option 1: Auto-discover all tools from massgen/tool/ directory
      auto_discover_custom_tools: true

      # Option 2: Specify custom path (takes precedence over auto_discover)
      # custom_tools_path: "massgen/tool/_code_based_example"

      # Exclude specific custom tools (optional)
      # NOTE: Tools requiring unavailable API keys are AUTOMATICALLY excluded
      # This option is for manual exclusions (e.g., heavy dependencies, unwanted features)
      exclude_custom_tools:
        - "_computer_use"  # Manual exclusion: Requires OPENAI_API_KEY
        - "_claude_computer_use"  # Manual exclusion: Requires ANTHROPIC_API_KEY
        - "_gemini_computer_use"   # Manual exclusion: Requires GOOGLE_API_KEY
        - "_browser_automation"    # Manual exclusion: Better to just do via CLI else image gets passed
        # - "_video_tools"           # Manual exclusion: Heavy FFmpeg dependencies

      # MCP servers - these will be converted to Python wrappers in servers/
      # mcp_servers:
      #   - name: "weather"
      #     type: "stdio"
      #     command: "npx"
      #     args: ["-y", "@fak111/weather-mcp"]

  # - id: "agent_b"
  #   backend:
  #     # type: "claude_code"
  #     # model: "claude-sonnet-4-5-20250929"
  #     type: "chatcompletion"
  #     base_url: "https://openrouter.ai/api/v1"
  #     model: "x-ai/grok-4.1-fast"
  #     # type: "claude"
  #     # model: "claude-sonnet-4-5-20250929"
  #     # enable_strict_tool_use: true
  #     # type: "grok"
  #     # model: "grok-4-1-fast-reasoning"
  #     cwd: "workspace2"

  #     # Enable code-based tools (CodeAct paradigm)
  #     enable_code_based_tools: true          # MCP tools → Python code in servers/
  #     exclude_file_operation_mcps: true      # Use command-line for file ops (write_file/edit_file kept for clean file creation)
  #     enable_mcp_command_line: true          # Enable execute_command

  #     # Parallel tool execution - tools called together run simultaneously
  #     # WARNING: Do not call dependent tools together (e.g., mkdir + write to that dir)
  #     concurrent_tool_execution: true

  #     # Command line execution (required for code-based tools)
  #     command_line_execution_mode: "docker"
  #     command_line_docker_network_mode: "bridge"
  #     command_line_docker_enable_sudo: true

  #     # IMPORTANT: Pass API keys to Docker (required for most custom tools)
  #     # Most tools in massgen/tool/ need API keys (OPENAI_API_KEY, ANTHROPIC_API_KEY, etc.)
  #     # Check requirements: rg "^requires_api_keys:" massgen/tool/*/TOOL.md
  #     command_line_docker_credentials:
  #       env_file: ".env"  # Load from .env file in project root
  #       env_vars_from_file:
  #         - "OPENAI_API_KEY"
  #         - "GOOGLE_API_KEY"
  #         - "GEMINI_API_KEY"

  #     # Shared tools directory (optional) - tools generated once, shared across agents
  #     # If not specified, tools are generated in each agent's workspace
  #     shared_tools_directory: "shared_tools"

  #     # Custom tools - choose one approach:
  #     # Option 1: Auto-discover all tools from massgen/tool/ directory
  #     auto_discover_custom_tools: true

  #     # Option 2: Specify custom path (takes precedence over auto_discover)
  #     # custom_tools_path: "massgen/tool/_code_based_example"

  #     # Exclude specific custom tools (optional)
  #     # NOTE: Tools requiring unavailable API keys are AUTOMATICALLY excluded
  #     # This option is for manual exclusions (e.g., heavy dependencies, unwanted features)
  #     exclude_custom_tools:
  #       - "_computer_use"  # Manual exclusion: Requires OPENAI_API_KEY
  #       - "_claude_computer_use"  # Manual exclusion: Requires ANTHROPIC_API_KEY
  #       - "_gemini_computer_use"   # Manual exclusion: Requires GOOGLE_API_KEY
  #       - "_browser_automation"    # Manual exclusion: Better to just do via CLI else image gets passed
  #       # - "_video_tools"           # Manual exclusion: Heavy FFmpeg dependencies

  #     # MCP servers - these will be converted to Python wrappers in servers/
  #     # mcp_servers:
  #     #   - name: "weather"
  #     #     type: "stdio"
  #     #     command: "npx"
  #     #     args: ["-y", "@fak111/weather-mcp"]

orchestrator:
  snapshot_storage: "snapshots"
  agent_temporary_workspace: "temp_workspaces"

  # ============ DSPy Question Paraphrasing ============
  # Generates diverse question variants to increase answer diversity
  # dspy:
  #   enabled: true
  #   backend:
  #     type: "gemini"
  #     model: "gemini-3-pro-preview"
  #   num_variants: 2                            # Number of question paraphrases (1-10)
  #   strategy: "balanced"                       # balanced, diverse, conservative, adaptive
  #   cache_enabled: true                        # Cache paraphrases for efficiency
  #   semantic_threshold: 0.85                   # Validation strictness (0.0-1.0)
  #   validate_semantics: true                   # Verify paraphrases preserve meaning
  #   use_chain_of_thought: false                # Better reasoning (higher cost)

  # ============ Voting & Answer Control ============
  # voting_sensitivity: "balanced"               # lenient, balanced, strict
  max_new_answers_per_agent: 5                 # Limit answers per agent (null=unlimited)
  # answer_novelty_requirement: "balanced"       # lenient, balanced, strict

  # ============ Coordination Settings ============
  coordination:
    # Orchestration Restart - retry if quality check fails
    max_orchestration_restarts: 2              # Allows 3 total attempts: initial + 2 restarts

    # Skills System
    use_skills: true
    skills_directory: ".agent/skills"

    # Agent Task Planning
    enable_agent_task_planning: true
    task_planning_filesystem_mode: true
    # max_tasks_per_plan: 10

    # Filesystem Memory Mode
    enable_memory_filesystem_mode: true
    # Compression settings for reactive compression (when context limit is exceeded)
    # Value between 0 and 1: 0.3 means preserve 30% of messages, summarize the rest
    compression_target_ratio: 0.30


# ============ Timeout Configuration ============
timeout_settings:
  orchestrator_timeout_seconds: 1800           # 30 minutes

# ============ UI Configuration ============
ui:
  type: "textual_terminal"
  logging_enabled: true
