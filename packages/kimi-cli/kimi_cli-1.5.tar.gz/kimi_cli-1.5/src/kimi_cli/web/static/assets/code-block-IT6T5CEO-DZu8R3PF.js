import{r as m,C as k,j as s,D as j,u as b}from"./mermaid-VLURNSYL-BVY_Rfvl.js";import{createHighlighter as v,createJavaScriptRegexEngine as N,bundledLanguages as w}from"./index-DO9p0zjW.js";import"./index-Dk53A5yn.js";import"./index-BpoLgcEt.js";var y=b("block","before:content-[counter(line)]","before:inline-block","before:[counter-increment:line]","before:w-4","before:mr-4","before:text-[13px]","before:text-right","before:text-muted-foreground/50","before:font-mono","before:select-none"),$=m.memo(({children:e,result:t,language:r,className:n,...l})=>{let a=m.useMemo(()=>({backgroundColor:t.bg,color:t.fg}),[t.bg,t.fg]);return s.jsx("pre",{className:b(n,"p-4 text-sm dark:bg-(--shiki-dark-bg)!"),"data-language":r,"data-streamdown":"code-block-body",style:a,...l,children:s.jsx("code",{className:"[counter-increment:line_0] [counter-reset:line]",children:t.tokens.map((i,d)=>s.jsx("span",{className:y,children:i.map((o,c)=>s.jsx("span",{className:"dark:bg-(--shiki-dark-bg)! dark:text-(--shiki-dark)!",style:{color:o.color,backgroundColor:o.bgColor,...o.htmlStyle},...o.htmlAttrs,children:o.content},c))},d))})})},(e,t)=>e.result===t.result&&e.language===t.language&&e.className===t.className),C=({className:e,language:t,style:r,...n})=>s.jsx("div",{className:b("my-4 w-full overflow-hidden rounded-xl border border-border",e),"data-language":t,"data-streamdown":"code-block",style:{contentVisibility:"auto",containIntrinsicSize:"auto 200px",...r},...n}),S=({language:e,children:t})=>s.jsxs("div",{className:"flex items-center justify-between bg-muted/80 p-3 text-muted-foreground text-xs","data-language":e,"data-streamdown":"code-block-header",children:[s.jsx("span",{className:"ml-1 font-mono lowercase",children:e}),s.jsx("div",{className:"flex items-center gap-2",children:t})]}),E=N({forgiving:!0}),u=new Map,h=new Map,g=new Map,M=(e,t)=>`${e}-${t[0]}-${t[1]}`,T=(e,t,r)=>{let n=e.slice(0,100),l=e.length>100?e.slice(-100):"";return`${t}:${r[0]}:${r[1]}:${e.length}:${n}:${l}`},x=e=>Object.hasOwn(w,e),A=(e,t)=>{let r=x(e)?e:"text",n=M(r,t);if(u.has(n))return u.get(n);let l=v({themes:t,langs:[r],engine:E});return u.set(n,l),l},f=(e,t,r,n)=>{let l=x(t)?t:"text",a=T(e,l,r);return h.has(a)?h.get(a):(n&&(g.has(a)||g.set(a,new Set),g.get(a).add(n)),A(l,r).then(i=>{let d=i.codeToTokens(e,{lang:l,themes:{light:r[0],dark:r[1]}});h.set(a,d);let o=g.get(a);if(o){for(let c of o)c(d);g.delete(a)}}).catch(i=>{console.error("Failed to highlight code:",i),g.delete(a)}),null)},z=({code:e,language:t,className:r,children:n,...l})=>{let{shikiTheme:a}=m.useContext(k),i=m.useMemo(()=>({bg:"transparent",fg:"inherit",tokens:e.split(`
`).map(c=>[{content:c,color:"inherit",bgColor:"transparent",htmlStyle:{},offset:0}])}),[e]),[d,o]=m.useState(i);return m.useEffect(()=>{let c=f(e,t,a);if(c){o(c);return}f(e,t,a,p=>{o(p)})},[e,t,a]),s.jsx(j.Provider,{value:{code:e},children:s.jsxs(C,{language:t,children:[s.jsx(S,{language:t,children:n}),s.jsx($,{className:r,language:t,result:d,...l})]})})};export{z as CodeBlock};
