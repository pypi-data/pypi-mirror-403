"""重构技能 Prompt 模板."""

from typing import Final

# 重构技能的 Prompt 模板
REFACTOR_SKILL_PROMPT: Final = """你是一个专业的 Agent-Skill 重构专家。

## 任务

分析并重构 Agent-Skill：{{skill_path}}

## 分析步骤

### 1. 当前状态分析
- 阅读 SKILL.md 了解技能功能
- 检查目录结构是否完整
- 评估代码质量和文档完整性

### 2. 问题识别
请检查以下方面：
- **命名规范**：目录名、文件名是否符合规范
- **结构完整性**：是否缺少必需目录或文件
- **内容质量**：描述是否清晰，示例是否完整
- **代码质量**：是否有重复代码、未使用的代码
- **性能问题**：是否有性能优化空间
- **安全性**：是否存在安全风险

### 3. 重构建议

根据发现的问题，提供具体的重构建议：

#### 结构优化
- [ ] 目录结构调整建议
- [ ] 文件组织优化建议
- [ ] 模块划分建议

#### 内容优化
- [ ] SKILL.md 内容精简或补充建议
- [ ] 文档结构优化建议
- [ ] 示例代码改进建议

#### 代码优化
- [ ] 代码重构建议
- [ ] 性能优化建议
- [ ] 错误处理改进建议

## 重构原则

1. **保持功能不变**：重构不应改变技能的核心功能
2. **渐进式改进**：优先修复高优先级问题
3. **向后兼容**：尽量保持接口兼容性
4. **文档同步**：代码和文档同步更新

## 输出格式

请按以下格式输出重构建议：

```markdown
# 重构分析报告

## 当前状态评估

### 基本信息
- 技能名称：{{name}}
- 模板类型：{{template}}
- 文件数量：{{count}}

### 质量评分
- 结构质量：[评分 0-100]
- 文档质量：[评分 0-100]
- 代码质量：[评分 0-100]
- 总体评分：[评分 0-100]

## 发现的问题

### 严重问题 (P0)
[列出必须修复的问题]

### 重要问题 (P1)
[列出建议修复的问题]

### 优化建议 (P2)
[列出可选的优化项]

## 重构建议

### 结构优化
[具体的结构优化建议]

### 内容优化
[具体的内容优化建议]

### 代码优化
[具体的代码优化建议]

## 实施计划

### 第一阶段（必须）
1. [ ] 修复 P0 问题
2. [ ] 更新文档

### 第二阶段（建议）
1. [ ] 修复 P1 问题
2. [ ] 代码优化

### 第三阶段（可选）
1. [ ] 性能优化
2. [ ] 功能增强
```
"""


def get_refactor_skill_prompt(skill_path: str, focus_areas: list[str] | None = None) -> str:
    """
    获取重构技能的 Prompt 模板.

    ## 完整模板内容

    这个Prompt模板指导AI进行全面的Agent-Skill重构分析，包含：

    1. **当前状态分析**: 评估技能功能、结构和质量
    2. **问题识别**: 检查命名、结构、内容、代码、性能、安全性
    3. **重构建议**: 分为结构优化、内容优化、代码优化
    4. **重构原则**: 保持功能不变、渐进式改进、向后兼容、文档同步
    5. **输出格式**: 结构化的重构分析报告

    ## 参数说明
    - skill_path: 要重构的技能目录路径
    - focus_areas: 重点关注领域（可选），如["structure", "documentation"]

    ## 返回值
    返回完整的重构Prompt，指导AI生成详细的重构建议

    ## 重构原则
    - **保持功能不变**: 重构不应改变核心功能
    - **渐进式改进**: 优先修复高优先级问题
    - **向后兼容**: 尽量保持接口兼容性
    - **文档同步**: 代码和文档同步更新

    ## 使用示例
    ```python
    prompt = get_refactor_skill_prompt("/path/to/skill", ["structure", "testing"])
    # 返回包含结构化和测试重点的Prompt
    ```

    Args:
        skill_path: 技能目录路径
        focus_areas: 重点关注领域（可选）

    Returns:
        Prompt 模板内容
    """
    focus_section = ""

    if focus_areas:
        focus_list = "、".join(f"`{area}`" for area in focus_areas)
        focus_section = f"\n\n### 重点关注领域\n{focus_list}\n请优先分析这些领域的问题。"

    return REFACTOR_SKILL_PROMPT.replace("{{skill_path}}", skill_path) + focus_section
