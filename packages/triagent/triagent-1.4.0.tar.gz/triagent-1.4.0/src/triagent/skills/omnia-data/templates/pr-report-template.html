<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{report_title}</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /*
         * Deloitte Omnia Design System - WHITE THEME
         * Matching: https://deloitteomniaame.deloitte.com/.../settings
         * Clean white backgrounds, minimal borders, flat design
         */
        :root {
            --primary: #007CB0;           /* Deloitte Teal */
            --primary-dark: #005A87;      /* Dark Teal */
            --accent: #86BC25;            /* Deloitte Green */
            --bg-light: #F8F8F8;          /* Very light gray (for subtle accents only) */
            --border: #E0E0E0;            /* Light border */
            --border-dark: #D0D0CE;       /* Darker border for sections */
            --text: #000000;              /* Primary Text */
            --text-light: #53565A;        /* Secondary Text */
            --error: #DA291C;             /* Error Red */
            --white: #ffffff;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Roboto', 'Segoe UI', sans-serif; background: var(--white); color: var(--text); line-height: 1.5; }
        .container { max-width: 1800px; margin: 0 auto; padding: 20px; }
        .header { background: var(--white); color: var(--text); padding: 20px 25px; border-bottom: 1px solid var(--border); margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 20px; font-weight: 500; }
        .header h1 .brand { color: var(--text); font-weight: 700; }
        .header h1 .brand-accent { color: var(--primary); font-weight: 400; }
        .header p { color: var(--text-light); font-size: 12px; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 20px; }
        .summary-card { background: var(--white); padding: 15px; border: 1px solid var(--border); border-radius: 2px; text-align: center; }
        .summary-card .value { font-size: 28px; font-weight: 600; color: var(--primary); }
        .summary-card .label { font-size: 11px; color: var(--text-light); text-transform: uppercase; }
        .author-section { background: var(--white); border: 1px solid var(--border); border-radius: 2px; padding: 15px; margin-bottom: 20px; }
        .author-section h2 { font-size: 14px; font-weight: 500; color: var(--text); margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--border); }
        .author-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 8px; }
        .author-chip { background: var(--white); padding: 8px 12px; border-radius: 2px; font-size: 12px; border: 1px solid var(--border); border-left: 3px solid var(--primary); }
        .author-chip .name { font-weight: 600; color: var(--primary-dark); }
        .author-chip .count { color: var(--text-light); }
        .main-content { background: var(--white); border: 1px solid var(--border); border-radius: 2px; padding: 20px; }
        .main-content h2 { font-size: 14px; font-weight: 500; color: var(--text); margin-bottom: 15px; }
        .filter-row { display: flex; gap: 12px; margin-bottom: 15px; flex-wrap: wrap; }
        .filter-row select, .filter-row input { padding: 8px 12px; border: 1px solid var(--border); border-radius: 2px; font-size: 13px; font-family: 'Roboto', sans-serif; background: var(--white); }
        .filter-row select:focus, .filter-row input:focus { outline: none; border-color: var(--primary); }
        .filter-row input { min-width: 300px; }
        .iteration-section { margin-bottom: 20px; border: 1px solid var(--border); border-radius: 2px; }
        .iteration-header { background: var(--white); color: var(--primary); padding: 12px 15px; font-weight: 500; font-size: 14px; display: flex; justify-content: space-between; cursor: pointer; border-bottom: 2px solid var(--primary); }
        .iteration-header:hover { background: var(--bg-light); }
        .iteration-count { background: var(--primary); color: var(--white); padding: 2px 10px; border-radius: 10px; font-size: 12px; }
        .iteration-content { padding: 0; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th { background: var(--white); color: var(--text); padding: 10px 8px; text-align: left; font-weight: 600; border-bottom: 1px solid var(--border-dark); }
        td { padding: 10px 8px; border-bottom: 1px solid var(--border); vertical-align: top; }
        tr:hover { background: #f8fbff; }
        .wi-link { color: var(--primary); text-decoration: none; font-weight: 600; }
        .wi-link:hover { text-decoration: underline; }
        .pr-list { display: flex; flex-wrap: wrap; gap: 4px; }
        .pr-chip { display: inline-flex; align-items: center; gap: 4px; padding: 3px 8px; background: #E5F4FB; border-radius: 2px; font-size: 11px; }
        .pr-chip a { color: var(--primary); text-decoration: none; font-weight: 600; }
        .pr-chip a:hover { text-decoration: underline; }
        .pr-chip .repo { color: var(--accent); font-size: 10px; }
        .pr-chip .author { color: var(--text-light); font-size: 10px; }
        .wi-type { display: inline-block; padding: 2px 6px; border-radius: 2px; font-size: 10px; font-weight: 500; }
        .wi-type.pbi { background: #E5F4FB; color: var(--primary); }
        .wi-type.defect { background: #FCE8E6; color: var(--error); }
        .wi-type.bug { background: #FCE8E6; color: var(--error); }
        .wi-type.feature { background: #EDF6E4; color: var(--accent); }
        .wi-type.enabler { background: #F5F5F5; color: var(--text-light); }
        .wi-state { display: inline-block; padding: 2px 6px; border-radius: 2px; font-size: 10px; }
        .wi-state.done { background: #EDF6E4; color: var(--accent); }
        .wi-state.new { background: #E5F4FB; color: var(--primary); }
        .wi-state.removed { background: #F5F5F5; color: var(--text-light); }
        .wi-state.active { background: #FFF4E6; color: #D83B01; }
        .wi-state.implementing { background: #FFF4E6; color: #D83B01; }
        .wi-state.ready { background: #E5F4FB; color: var(--primary); }
        .collapsible { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .collapsible.open { max-height: none; }
        .footer { text-align: center; padding: 20px; color: var(--text-light); font-size: 11px; border-top: 1px solid var(--border); margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1><span class="brand">Deloitte.</span> <span class="brand-accent">Omnia</span></h1>
                <p>{report_subtitle} | Generated: {generation_date}</p>
            </div>
            <p>{generation_date}</p>
        </div>

        <div class="summary-grid">
            <div class="summary-card"><div class="value">{total_prs}</div><div class="label">Total PRs</div></div>
            <div class="summary-card"><div class="value">{work_items}</div><div class="label">Work Items</div></div>
            <div class="summary-card"><div class="value">{authors}</div><div class="label">Authors</div></div>
            <div class="summary-card"><div class="value">{iterations}</div><div class="label">Iterations</div></div>
        </div>

        <div class="author-section">
            <h2>Author Summary (sorted by PR count)</h2>
            <div class="author-grid">
{author_chips}
            </div>
        </div>

        <div class="main-content">
            <h2>Work Items with Associated PRs</h2>
            <div class="filter-row">
                <select id="iterationFilter" onchange="filterContent()">
                    <option value="">All Iterations</option>
{iteration_options}
                </select>
                <select id="authorFilter" onchange="filterContent()">
                    <option value="">All Authors</option>
{author_options}
                </select>
                <input type="text" id="searchFilter" placeholder="Search work item title or PR..." onkeyup="filterContent()">
            </div>

{iteration_sections}
        </div>

        <div class="footer">Generated by Claude Code | {generation_date}</div>
    </div>

    <script>
        function toggleSection(header) {
            const content = header.nextElementSibling;
            content.classList.toggle('open');
        }

        function filterContent() {
            const iterationFilter = document.getElementById('iterationFilter').value;
            const authorFilter = document.getElementById('authorFilter').value.toLowerCase();
            const searchFilter = document.getElementById('searchFilter').value.toLowerCase();

            document.querySelectorAll('.iteration-section').forEach(section => {
                const iteration = section.getAttribute('data-iteration');
                const iterationMatch = !iterationFilter || iteration === iterationFilter;

                if (!iterationMatch) {
                    section.style.display = 'none';
                    return;
                }

                let hasVisibleRows = false;
                section.querySelectorAll('tbody tr, table tr:not(:first-child)').forEach(row => {
                    if (row.querySelector('th')) return;

                    const authors = (row.getAttribute('data-authors') || '').toLowerCase();
                    const text = row.textContent.toLowerCase();

                    const authorMatch = !authorFilter || authors.includes(authorFilter);
                    const searchMatch = !searchFilter || text.includes(searchFilter);

                    if (authorMatch && searchMatch) {
                        row.style.display = '';
                        hasVisibleRows = true;
                    } else {
                        row.style.display = 'none';
                    }
                });

                section.style.display = hasVisibleRows || (!authorFilter && !searchFilter) ? '' : 'none';
            });
        }
    </script>
</body>
</html>
