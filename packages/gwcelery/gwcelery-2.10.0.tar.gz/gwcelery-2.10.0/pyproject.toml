[project]
name = "gwcelery"
dynamic = ["version"]
description = "Low-latency pipeline for annotating IGWN events"
authors = [
    { name = "Deep Chatterjee", email = "deep.chatterjee@ligo.org" },
    { name = "Cody Messick", email = "cody.messick@ligo.org" },
    { name = "Geoffrey Mo", email = "geoffrey.mo@ligo.org" },
    { name = "Brandon Piotrzkowski", email = "brandon.piotrzkowski@ligo.org" },
    { name = "Leo Singer", email = "leo.singer@ligo.org" },
]
requires-python = ">=3.11,<3.13"
readme = "README.rst"
license = "GPL-2.0-or-later"
classifiers = [
    "Development Status :: 4 - Beta",
    "Environment :: Console",
    "Intended Audience :: Science/Research",
    "Operating System :: POSIX",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Topic :: Internet",
    "Topic :: Scientific/Engineering :: Astronomy",
    "Topic :: Scientific/Engineering :: Physics",
]
dependencies = [
    "adc-streaming>=2.3.0",  # https://github.com/astronomy-commons/adc-streaming/pull/62
    "astropy>=4.3.1,!=5.3",  # https://github.com/astropy/astropy/issues/11879, https://github.com/gwpy/gwpy/issues/1629
    "bilby==2.6.0",  # https://git.ligo.org/emfollow/gwcelery/-/merge_requests/1617#note_1413167
    "bilby_pipe==1.6.0",  # https://git.ligo.org/lscsoft/bilby_pipe/-/merge_requests/644
    "celery[redis]>=5.1, <5.4",  # https://git.ligo.org/emfollow/gwcelery/-/issues/804
    "click>=7",
    "comet",
    "confluent-kafka>=1.9.2",
    "flask>=2.2",
    "flask-caching",
    "flower>=2.0.1",  # https://git.ligo.org/emfollow/gwcelery/-/issues/688
    "gracedb-sdk>=0.2.1",  # https://git.ligo.org/emfollow/gwcelery/-/merge_requests/1606
    "gwdatafind>=1.1.1",
    "gwpy>=3.0.11",  # https://gitlab.com/gwpy/gwpy/-/merge_requests/1799
    "GWSkyNet>=2.5.2",  # https://git.ligo.org/manleong.chan/gwskynet/-/merge_requests/3
    "healpy",
    "hop-client>=0.7.0, <0.11.0",  # https://github.com/scimma/hop-client/pull/176 https://git.ligo.org/emfollow/gwcelery/-/issues/942
    "hpmoc>=1.0.0",
    "igwn-alert>=0.7.0",  # https://git.ligo.org/computing/igwn-alert/client/-/merge_requests/32
    "igwn-auth-utils>=1.4.0",  # https://git.ligo.org/computing/sccb/-/issues/1805
    "igwn-gwalert-schema>=1.0.0,<2",
    "igwn-ligolw",
    "igwn-segments",
    "imapclient",
    "importlib-metadata",
    "ipython",
    "jinja2>=2.11.2",  # https://github.com/pallets/jinja/issues/1168
    "ligo-cgmi>=1.0.5",  # https://git.ligo.org/emfollow/em-properties/cgmi/-/issues/9; https://git.ligo.org/emfollow/em-properties/cgmi/-/issues/10
    "ligo-followup-advocate>=1.3.10",  # To reduce memory usage
    "ligo-gracedb>=2.7.5",  # https://git.ligo.org/lscsoft/gracedb-client/-/issues/28
    "ligo-raven>=3.3,<4.0",
    "ligo.em-bright>=1.2.1",  # https://git.ligo.org/emfollow/gwcelery/-/issues/816
    "ligo.skymap>=2.4.1",  # https://git.ligo.org/lscsoft/ligo.skymap/-/merge_requests/456, https://git.ligo.org/lscsoft/ligo.skymap/-/merge_requests/498, https://git.ligo.org/lscsoft/ligo.skymap/-/merge_requests/499
    "lscsoft-glue",
    "lxml",
    "p_astro>=1.0.2",  # https://git.ligo.org/emfollow/gwcelery/-/issues/981
    "pesummary>=1.0.2",  # https://git.ligo.org/computing/sccb/-/issues/1350
    "platformdirs",
    "pygcn>=1.0.1",
    "pyxdg",
    "rapid-pe>=0.1.1,<0.2.0",  # https://git.ligo.org/computing/sccb/-/issues/1352
    "rapidpe-rift-pipe>=0.7.1,<0.8.0",  # https://git.ligo.org/computing/sccb/-/issues/1791
    "redis!=4.5.2,!=4.5.3",  # https://git.ligo.org/emfollow/gwcelery/-/issues/556
    "RIFT>=0.0.15.9",
    "scipy>=1.11.1,<1.17",  # https://git.ligo.org/emfollow/gwcelery/-/issues/679 https://git.ligo.org/emfollow/gwcelery/-/issues/1016
    "safe-netrc",
    "sentry-sdk[flask, tornado]",
    "service-identity",  # We don't actually use this package, but it silences some annoying warnings from twistd.
    "tensorflow<2.19",  # FIXME: This constraint should be in GWSkyNet, not GWCelery. See https://git.ligo.org/manleong.chan/gwskynet/-/merge_requests/4
    "voeventlib>=1.2",
    "werkzeug>=3.0.1",  # for werkzeug.middleware.proxy_fix.ProxyFix # https://git.ligo.org/emfollow/gwcelery/-/issues/736
    "zstandard",  # for task compression
    "ligo-rrt-chat>=0.1.5",  # https://git.ligo.org/computing/sccb/-/issues/1562"
]
[project.optional-dependencies]
condor = [
    "ezdag>=0.4.1",  # https://git.ligo.org/patrick.godwin/ezdag/-/issues/4
]
dev = [
    "ipykernel",
    "flake8>=7.0.0,<8",
    "isort>=5.13.2,<6",
]
doc = [
    "pep517",
    "sphinx>=4.0, <=5.3.0",  # https://git.ligo.org/andrew.toivonen/gwcelery/-/jobs/2447152
]
test = [
    "fastavro>=1.6.1,<2",
    "pytest-celery<1.0.0", # https://git.ligo.org/emfollow/gwcelery/-/issues/801
    "pytest-cov",
    "pytest-flask>=1.3.0",  # https://github.com/pytest-dev/pytest-flask/pull/168
    "pytest-socket",
]

[project.urls]
Homepage = "https://git.ligo.org/emfollow/gwcelery"
Repository = "https://git.ligo.org/emfollow/gwcelery"
Documentation = "https://gwcelery.readthedocs.io/"
"Bug Tracker" = "https://git.ligo.org/emfollow/gwcelery/issues"

[project.scripts]
gwcelery = "gwcelery:main"
gwcelery-condor-submit-helper = "gwcelery.tools.condor_submit_helper:main"

[project.entry-points."celery.commands"]
condor = "gwcelery.tools.condor:condor"
flask = "gwcelery.tools.flask:flask"
nagios = "gwcelery.tools.nagios:nagios"

[tool.setuptools_scm]

[tool.coverage.run]
source = ["gwcelery"]
omit = [
    "gwcelery/tests/*",
    "gwcelery/conf/development.py",
    "gwcelery/conf/playground.py",
    "gwcelery/conf/production.py",
    "gwcelery/conf/test.py"
]
parallel = true
concurrency = ["thread", "multiprocessing"]

[build-system]
requires = ["setuptools_scm>=8", "setuptools>=80"]
build-backend = "setuptools.build_meta"
