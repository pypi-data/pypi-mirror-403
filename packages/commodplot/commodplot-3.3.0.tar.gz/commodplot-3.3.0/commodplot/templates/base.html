<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    {# Plotly.js - Note: plotly-latest is stuck at v1.58.5, using explicit version #}
    {% block plotly_version %}
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js" charset="utf-8"></script>
    {% endblock plotly_version %}
    
    {# Bootstrap CSS - Can be overridden in child templates for different versions #}
    {% block bootstrap_css %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" 
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    {% endblock bootstrap_css %}
    
    <title>{% block title %}{{ data.title if data and data.title else pagetitle }}{% endblock %}</title>
    {% block additional_head %}{% endblock %}
    
    <style>
        /* Fixed navbar styling */
        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1050;
            padding: 0.25rem 1rem;
            min-height: 40px;
        }
        .navbar-brand {
            font-size: 1rem;
            padding-top: 0.25rem;
            padding-bottom: 0.25rem;
        }
        .navbar .nav-link {
            padding: 0.25rem 0.5rem;
            font-size: 0.9rem;
        }
        /* Prevent content hiding under navbar */
        body {
            padding-top: 55px;
        }
        /* Metadata styling in navbar */
        .navbar-metadata {
            font-size: 0.85rem;
            color: #6c757d;
        }
        /* Adjust floating ToC position if present */
        .floating-toc {
            top: 65px;
        }
    </style>
    {% block custom_styles %}{% endblock %}
</head>
<body>
    {% block header %}
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            {% block navbar_content %}
            <div class="navbar-nav me-auto">
                {% block navigation %}
                {# Child templates can add navigation items here #}
                {% endblock navigation %}
            </div>
            
            {# Metadata section on the right #}
            <div class="navbar-metadata d-flex align-items-center">
                <span class="me-3">
                    Last generated: {{ data.last_gen_time.strftime('%d %b %Y %H:%M') if data and data.last_gen_time else last_gen_time.strftime('%d %b %Y %H:%M') }}
                </span>
                {% if data and data.permalink %}
                <a href="{{ data.permalink }}" target="_blank" title="Production Permalink" class="me-2">
                    <span class="badge bg-success">ðŸ”— PROD</span>
                </a>
                {% endif %}
                {% if data and data.permalink_staging %}
                <a href="{{ data.permalink_staging }}" target="_blank" title="Staging Permalink" class="me-2">
                    <span class="badge bg-warning text-dark">ðŸ”— STG</span>
                </a>
                {% endif %}
                {% if data and data.flow_run_id %}
                <a href="{{ data.prefect_base_url | default('https://proximo.energy.local/prefect-3-server') }}/runs/flow-run/{{ data.flow_run_id }}"
                   target="_blank" title="Prefect Flow Run">
                    <img src="https://cdn.worldvectorlogo.com/logos/prefect-1.svg" alt="Prefect" width="20" height="20">
                </a>
                {% elif 'prefect_link' in data %}
                <a href="{{ data['prefect_link'] }}" title="Prefect Link">
                    <img src="https://cdn.worldvectorlogo.com/logos/prefect-1.svg" alt="Prefect" width="20" height="20">
                </a>
                {% endif %}
            </div>
            {% endblock navbar_content %}
        </div>
    </nav>
    {% endblock header %}

    <a id="top"></a>

    {% block page_title %}
    {# Optional: Override this block to add a custom page title section #}
    {% if data and data.title %}
    <h2>{{ data.title }}</h2>
    {% elif pagetitle %}
    <h2>{{ pagetitle }}</h2>
    {% endif %}
    {% endblock page_title %}

    {% block content %}
    {# Main content goes here - this must be overridden by child templates #}
    {% endblock content %}

    {% block footer %}
    <a href="#top">Back to top</a>
    {% endblock footer %}

    {% block scripts %}
    {# Additional scripts can be added here by child templates #}
    {% endblock scripts %}
</body>
</html>