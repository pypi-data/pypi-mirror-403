"use strict";(self.webpackChunkjupyterlab_cell_runner=self.webpackChunkjupyterlab_cell_runner||[]).push([[509],{509(o,e,l){l.r(e),l.d(e,{default:()=>n});var t=l(428);const n={id:"jupyterlab-cell-runner:plugin",description:"BlocklyBot cell runner - postMessage driven code insertion and execution",autoStart:!0,requires:[t.INotebookTracker],activate:(o,e)=>{function l(){const o=e.currentWidget;return o?o.content:(console.error("[BlocklyBot] 没有打开的 notebook"),null)}function n(o){if(!o.model)return 0;const e=o.model.cells.length;return e<=1?0:e-2}function c(o){const e=l();if(!e||!e.model)return;const t=n(e),c=e.model.cells.get(t);c&&(c.sharedModel.setSource(o),console.log("[BlocklyBot] 代码已写入 cell["+t+"]，长度:",o.length))}function r(){var o;const c=l();if(!c||!c.model)return;const r=n(c),s=c.model.cells.get(r);if(!s)return;if(!s.sharedModel.getSource().trim())return void console.log("[BlocklyBot] Cell 为空，无需执行");c.activeCellIndex=r;const i=null===(o=e.currentWidget)||void 0===o?void 0:o.sessionContext;i?(t.NotebookActions.run(c,i),console.log("[BlocklyBot] 已通过 NotebookActions.run() 执行 cell["+r+"]")):console.error("[BlocklyBot] 未找到 sessionContext"),setTimeout(()=>{const o=c.node;o&&(o.scrollTop=o.scrollHeight)},500)}function s(){const o=[".jp-WindowedPanel-outer",".jp-Notebook",".jp-NotebookPanel-notebook","#notebook-container"];for(const e of o){const o=document.querySelector(e);if(o&&o.scrollHeight>o.clientHeight)return o}const e=l();if(e){let o=e.node.parentElement;for(;o;){const e=window.getComputedStyle(o);if("auto"===e.overflowY||"scroll"===e.overflowY)return o;o=o.parentElement}}return null}console.log("[BlocklyBot] jupyterlab-cell-runner 已激活"),window.addEventListener("message",o=>{const e=o.data;e&&e.action&&(console.log("[BlocklyBot] 收到消息:",e),"insertCode"===e.action&&e.code?c(e.code):"runCode"===e.action?r():"clearExtraCells"===e.action?function(){const o=l();if(!o||!o.model)return;const e=o.model.cells.length;if(e<=1){const e=o.model.cells.get(0);return e&&e.sharedModel.setSource(""),void console.log("[BlocklyBot] 只有1个cell，已清空内容")}o.model.sharedModel.deleteCellRange(1,e);const t=o.model.cells.get(0);t&&t.sharedModel.setSource(""),console.log("[BlocklyBot] 已清空多余cell，从"+e+"个减为1个")}():"scrollToBottom"===e.action?function(){const o=s();if(o)o.scrollTop=o.scrollHeight,console.log("[BlocklyBot] 已滚动到底部, container:",o.className);else{const o=l();if(o&&o.model){const e=o.model.cells.length-1,l=o.widgets[e];l&&l.node.scrollIntoView(!1)}console.log("[BlocklyBot] 使用 scrollIntoView 滚动到底部")}}():"scrollToTop"===e.action&&function(){const o=s();if(o)o.scrollTop=0,console.log("[BlocklyBot] 已滚动到顶部, container:",o.className);else{const o=l();o&&o.widgets[0]&&o.widgets[0].node.scrollIntoView(!0),console.log("[BlocklyBot] 使用 scrollIntoView 滚动到顶部")}}())}),console.log("[BlocklyBot] postMessage 监听器已注册"),document.addEventListener("keydown",o=>"F4"!==o.key||o.ctrlKey||o.altKey?"F5"!==o.key||o.ctrlKey||o.altKey?void 0:(o.preventDefault(),void(window.parent&&window.parent!==window&&window.parent.postMessage({type:"keydown",keyCode:116,action:"runCode"},"*"))):(o.preventDefault(),void(window.parent&&window.parent!==window&&window.parent.postMessage({type:"keydown",keyCode:115,action:"toggleLeftPanel"},"*"))),!0),console.log("[BlocklyBot] 键盘快捷键已注册 (F4/F5)"),e.widgetAdded.connect(()=>{setTimeout(()=>{window.parent&&window.parent!==window&&(window.parent.postMessage({action:"requestCodeSync",source:"jupyter"},"*"),console.log("[BlocklyBot] 已向父页面发送代码同步请求"))},2e3)});const i={insertAndRun(o){c(o),setTimeout(()=>r(),100)},insertCode:c,runCode:r,getCellCount(){const o=l();return o&&o.model?o.model.cells.length:0}};window.cellRunner=i,console.log("[BlocklyBot] window.cellRunner 已就绪")}}}}]);